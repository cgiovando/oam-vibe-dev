(function(){const et=document.createElement("link").relList;if(et&&et.supports&&et.supports("modulepreload"))return;for(const at of document.querySelectorAll('link[rel="modulepreload"]'))ee(at);new MutationObserver(at=>{for(const tt of at)if(tt.type==="childList")for(const L of tt.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&ee(L)}).observe(document,{childList:!0,subtree:!0});function Fe(at){const tt={};return at.integrity&&(tt.integrity=at.integrity),at.referrerPolicy&&(tt.referrerPolicy=at.referrerPolicy),at.crossOrigin==="use-credentials"?tt.credentials="include":at.crossOrigin==="anonymous"?tt.credentials="omit":tt.credentials="same-origin",tt}function ee(at){if(at.ep)return;at.ep=!0;const tt=Fe(at);fetch(at.href,tt)}})();function b_(ae){return ae&&ae.__esModule&&Object.prototype.hasOwnProperty.call(ae,"default")?ae.default:ae}var gg={exports:{}},Np={};var Og;function w_(){if(Og)return Np;Og=1;var ae=Symbol.for("react.transitional.element"),et=Symbol.for("react.fragment");function Fe(ee,at,tt){var L=null;if(tt!==void 0&&(L=""+tt),at.key!==void 0&&(L=""+at.key),"key"in at){tt={};for(var d in at)d!=="key"&&(tt[d]=at[d])}else tt=at;return at=tt.ref,{$$typeof:ae,type:ee,key:L,ref:at!==void 0?at:null,props:tt}}return Np.Fragment=et,Np.jsx=Fe,Np.jsxs=Fe,Np}var Fg;function T_(){return Fg||(Fg=1,gg.exports=w_()),gg.exports}var ke=T_(),_g={exports:{}},ri={};var Ng;function S_(){if(Ng)return ri;Ng=1;var ae=Symbol.for("react.transitional.element"),et=Symbol.for("react.portal"),Fe=Symbol.for("react.fragment"),ee=Symbol.for("react.strict_mode"),at=Symbol.for("react.profiler"),tt=Symbol.for("react.consumer"),L=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),de=Symbol.for("react.suspense"),_e=Symbol.for("react.memo"),He=Symbol.for("react.lazy"),Re=Symbol.for("react.activity"),Ee=Symbol.iterator;function ct(le){return le===null||typeof le!="object"?null:(le=Ee&&le[Ee]||le["@@iterator"],typeof le=="function"?le:null)}var At={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rt=Object.assign,pe={};function mt(le,ze,it){this.props=le,this.context=ze,this.refs=pe,this.updater=it||At}mt.prototype.isReactComponent={},mt.prototype.setState=function(le,ze){if(typeof le!="object"&&typeof le!="function"&&le!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,le,ze,"setState")},mt.prototype.forceUpdate=function(le){this.updater.enqueueForceUpdate(this,le,"forceUpdate")};function Et(){}Et.prototype=mt.prototype;function ut(le,ze,it){this.props=le,this.context=ze,this.refs=pe,this.updater=it||At}var vt=ut.prototype=new Et;vt.constructor=ut,rt(vt,mt.prototype),vt.isPureReactComponent=!0;var Bt=Array.isArray;function Tt(){}var gt={H:null,A:null,T:null,S:null},Vt=Object.prototype.hasOwnProperty;function ti(le,ze,it){var Ue=it.ref;return{$$typeof:ae,type:le,key:ze,ref:Ue!==void 0?Ue:null,props:it}}function hi(le,ze){return ti(le.type,ze,le.props)}function si(le){return typeof le=="object"&&le!==null&&le.$$typeof===ae}function Jt(le){var ze={"=":"=0",":":"=2"};return"$"+le.replace(/[=:]/g,function(it){return ze[it]})}var di=/\/+/g;function an(le,ze){return typeof le=="object"&&le!==null&&le.key!=null?Jt(""+le.key):ze.toString(36)}function fn(le){switch(le.status){case"fulfilled":return le.value;case"rejected":throw le.reason;default:switch(typeof le.status=="string"?le.then(Tt,Tt):(le.status="pending",le.then(function(ze){le.status==="pending"&&(le.status="fulfilled",le.value=ze)},function(ze){le.status==="pending"&&(le.status="rejected",le.reason=ze)})),le.status){case"fulfilled":return le.value;case"rejected":throw le.reason}}throw le}function qe(le,ze,it,Ue,yt){var kt=typeof le;(kt==="undefined"||kt==="boolean")&&(le=null);var Nt=!1;if(le===null)Nt=!0;else switch(kt){case"bigint":case"string":case"number":Nt=!0;break;case"object":switch(le.$$typeof){case ae:case et:Nt=!0;break;case He:return Nt=le._init,qe(Nt(le._payload),ze,it,Ue,yt)}}if(Nt)return yt=yt(le),Nt=Ue===""?"."+an(le,0):Ue,Bt(yt)?(it="",Nt!=null&&(it=Nt.replace(di,"$&/")+"/"),qe(yt,ze,it,"",function(Jn){return Jn})):yt!=null&&(si(yt)&&(yt=hi(yt,it+(yt.key==null||le&&le.key===yt.key?"":(""+yt.key).replace(di,"$&/")+"/")+Nt)),ze.push(yt)),1;Nt=0;var yi=Ue===""?".":Ue+":";if(Bt(le))for(var Ai=0;Ai<le.length;Ai++)Ue=le[Ai],kt=yi+an(Ue,Ai),Nt+=qe(Ue,ze,it,kt,yt);else if(Ai=ct(le),typeof Ai=="function")for(le=Ai.call(le),Ai=0;!(Ue=le.next()).done;)Ue=Ue.value,kt=yi+an(Ue,Ai++),Nt+=qe(Ue,ze,it,kt,yt);else if(kt==="object"){if(typeof le.then=="function")return qe(fn(le),ze,it,Ue,yt);throw ze=String(le),Error("Objects are not valid as a React child (found: "+(ze==="[object Object]"?"object with keys {"+Object.keys(le).join(", ")+"}":ze)+"). If you meant to render a collection of children, use an array instead.")}return Nt}function We(le,ze,it){if(le==null)return le;var Ue=[],yt=0;return qe(le,Ue,"","",function(kt){return ze.call(it,kt,yt++)}),Ue}function pt(le){if(le._status===-1){var ze=le._result;ze=ze(),ze.then(function(it){(le._status===0||le._status===-1)&&(le._status=1,le._result=it)},function(it){(le._status===0||le._status===-1)&&(le._status=2,le._result=it)}),le._status===-1&&(le._status=0,le._result=ze)}if(le._status===1)return le._result.default;throw le._result}var Ve=typeof reportError=="function"?reportError:function(le){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ze=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof le=="object"&&le!==null&&typeof le.message=="string"?String(le.message):String(le),error:le});if(!window.dispatchEvent(ze))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",le);return}console.error(le)},St={map:We,forEach:function(le,ze,it){We(le,function(){ze.apply(this,arguments)},it)},count:function(le){var ze=0;return We(le,function(){ze++}),ze},toArray:function(le){return We(le,function(ze){return ze})||[]},only:function(le){if(!si(le))throw Error("React.Children.only expected to receive a single React element child.");return le}};return ri.Activity=Re,ri.Children=St,ri.Component=mt,ri.Fragment=Fe,ri.Profiler=at,ri.PureComponent=ut,ri.StrictMode=ee,ri.Suspense=de,ri.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=gt,ri.__COMPILER_RUNTIME={__proto__:null,c:function(le){return gt.H.useMemoCache(le)}},ri.cache=function(le){return function(){return le.apply(null,arguments)}},ri.cacheSignal=function(){return null},ri.cloneElement=function(le,ze,it){if(le==null)throw Error("The argument must be a React element, but you passed "+le+".");var Ue=rt({},le.props),yt=le.key;if(ze!=null)for(kt in ze.key!==void 0&&(yt=""+ze.key),ze)!Vt.call(ze,kt)||kt==="key"||kt==="__self"||kt==="__source"||kt==="ref"&&ze.ref===void 0||(Ue[kt]=ze[kt]);var kt=arguments.length-2;if(kt===1)Ue.children=it;else if(1<kt){for(var Nt=Array(kt),yi=0;yi<kt;yi++)Nt[yi]=arguments[yi+2];Ue.children=Nt}return ti(le.type,yt,Ue)},ri.createContext=function(le){return le={$$typeof:L,_currentValue:le,_currentValue2:le,_threadCount:0,Provider:null,Consumer:null},le.Provider=le,le.Consumer={$$typeof:tt,_context:le},le},ri.createElement=function(le,ze,it){var Ue,yt={},kt=null;if(ze!=null)for(Ue in ze.key!==void 0&&(kt=""+ze.key),ze)Vt.call(ze,Ue)&&Ue!=="key"&&Ue!=="__self"&&Ue!=="__source"&&(yt[Ue]=ze[Ue]);var Nt=arguments.length-2;if(Nt===1)yt.children=it;else if(1<Nt){for(var yi=Array(Nt),Ai=0;Ai<Nt;Ai++)yi[Ai]=arguments[Ai+2];yt.children=yi}if(le&&le.defaultProps)for(Ue in Nt=le.defaultProps,Nt)yt[Ue]===void 0&&(yt[Ue]=Nt[Ue]);return ti(le,kt,yt)},ri.createRef=function(){return{current:null}},ri.forwardRef=function(le){return{$$typeof:d,render:le}},ri.isValidElement=si,ri.lazy=function(le){return{$$typeof:He,_payload:{_status:-1,_result:le},_init:pt}},ri.memo=function(le,ze){return{$$typeof:_e,type:le,compare:ze===void 0?null:ze}},ri.startTransition=function(le){var ze=gt.T,it={};gt.T=it;try{var Ue=le(),yt=gt.S;yt!==null&&yt(it,Ue),typeof Ue=="object"&&Ue!==null&&typeof Ue.then=="function"&&Ue.then(Tt,Ve)}catch(kt){Ve(kt)}finally{ze!==null&&it.types!==null&&(ze.types=it.types),gt.T=ze}},ri.unstable_useCacheRefresh=function(){return gt.H.useCacheRefresh()},ri.use=function(le){return gt.H.use(le)},ri.useActionState=function(le,ze,it){return gt.H.useActionState(le,ze,it)},ri.useCallback=function(le,ze){return gt.H.useCallback(le,ze)},ri.useContext=function(le){return gt.H.useContext(le)},ri.useDebugValue=function(){},ri.useDeferredValue=function(le,ze){return gt.H.useDeferredValue(le,ze)},ri.useEffect=function(le,ze){return gt.H.useEffect(le,ze)},ri.useEffectEvent=function(le){return gt.H.useEffectEvent(le)},ri.useId=function(){return gt.H.useId()},ri.useImperativeHandle=function(le,ze,it){return gt.H.useImperativeHandle(le,ze,it)},ri.useInsertionEffect=function(le,ze){return gt.H.useInsertionEffect(le,ze)},ri.useLayoutEffect=function(le,ze){return gt.H.useLayoutEffect(le,ze)},ri.useMemo=function(le,ze){return gt.H.useMemo(le,ze)},ri.useOptimistic=function(le,ze){return gt.H.useOptimistic(le,ze)},ri.useReducer=function(le,ze,it){return gt.H.useReducer(le,ze,it)},ri.useRef=function(le){return gt.H.useRef(le)},ri.useState=function(le){return gt.H.useState(le)},ri.useSyncExternalStore=function(le,ze,it){return gt.H.useSyncExternalStore(le,ze,it)},ri.useTransition=function(){return gt.H.useTransition()},ri.version="19.2.1",ri}var jg;function Eg(){return jg||(jg=1,_g.exports=S_()),_g.exports}var Ut=Eg(),yg={exports:{}},jp={},vg={exports:{}},xg={};var Vg;function M_(){return Vg||(Vg=1,(function(ae){function et(qe,We){var pt=qe.length;qe.push(We);e:for(;0<pt;){var Ve=pt-1>>>1,St=qe[Ve];if(0<at(St,We))qe[Ve]=We,qe[pt]=St,pt=Ve;else break e}}function Fe(qe){return qe.length===0?null:qe[0]}function ee(qe){if(qe.length===0)return null;var We=qe[0],pt=qe.pop();if(pt!==We){qe[0]=pt;e:for(var Ve=0,St=qe.length,le=St>>>1;Ve<le;){var ze=2*(Ve+1)-1,it=qe[ze],Ue=ze+1,yt=qe[Ue];if(0>at(it,pt))Ue<St&&0>at(yt,it)?(qe[Ve]=yt,qe[Ue]=pt,Ve=Ue):(qe[Ve]=it,qe[ze]=pt,Ve=ze);else if(Ue<St&&0>at(yt,pt))qe[Ve]=yt,qe[Ue]=pt,Ve=Ue;else break e}}return We}function at(qe,We){var pt=qe.sortIndex-We.sortIndex;return pt!==0?pt:qe.id-We.id}if(ae.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var tt=performance;ae.unstable_now=function(){return tt.now()}}else{var L=Date,d=L.now();ae.unstable_now=function(){return L.now()-d}}var de=[],_e=[],He=1,Re=null,Ee=3,ct=!1,At=!1,rt=!1,pe=!1,mt=typeof setTimeout=="function"?setTimeout:null,Et=typeof clearTimeout=="function"?clearTimeout:null,ut=typeof setImmediate<"u"?setImmediate:null;function vt(qe){for(var We=Fe(_e);We!==null;){if(We.callback===null)ee(_e);else if(We.startTime<=qe)ee(_e),We.sortIndex=We.expirationTime,et(de,We);else break;We=Fe(_e)}}function Bt(qe){if(rt=!1,vt(qe),!At)if(Fe(de)!==null)At=!0,Tt||(Tt=!0,Jt());else{var We=Fe(_e);We!==null&&fn(Bt,We.startTime-qe)}}var Tt=!1,gt=-1,Vt=5,ti=-1;function hi(){return pe?!0:!(ae.unstable_now()-ti<Vt)}function si(){if(pe=!1,Tt){var qe=ae.unstable_now();ti=qe;var We=!0;try{e:{At=!1,rt&&(rt=!1,Et(gt),gt=-1),ct=!0;var pt=Ee;try{t:{for(vt(qe),Re=Fe(de);Re!==null&&!(Re.expirationTime>qe&&hi());){var Ve=Re.callback;if(typeof Ve=="function"){Re.callback=null,Ee=Re.priorityLevel;var St=Ve(Re.expirationTime<=qe);if(qe=ae.unstable_now(),typeof St=="function"){Re.callback=St,vt(qe),We=!0;break t}Re===Fe(de)&&ee(de),vt(qe)}else ee(de);Re=Fe(de)}if(Re!==null)We=!0;else{var le=Fe(_e);le!==null&&fn(Bt,le.startTime-qe),We=!1}}break e}finally{Re=null,Ee=pt,ct=!1}We=void 0}}finally{We?Jt():Tt=!1}}}var Jt;if(typeof ut=="function")Jt=function(){ut(si)};else if(typeof MessageChannel<"u"){var di=new MessageChannel,an=di.port2;di.port1.onmessage=si,Jt=function(){an.postMessage(null)}}else Jt=function(){mt(si,0)};function fn(qe,We){gt=mt(function(){qe(ae.unstable_now())},We)}ae.unstable_IdlePriority=5,ae.unstable_ImmediatePriority=1,ae.unstable_LowPriority=4,ae.unstable_NormalPriority=3,ae.unstable_Profiling=null,ae.unstable_UserBlockingPriority=2,ae.unstable_cancelCallback=function(qe){qe.callback=null},ae.unstable_forceFrameRate=function(qe){0>qe||125<qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Vt=0<qe?Math.floor(1e3/qe):5},ae.unstable_getCurrentPriorityLevel=function(){return Ee},ae.unstable_next=function(qe){switch(Ee){case 1:case 2:case 3:var We=3;break;default:We=Ee}var pt=Ee;Ee=We;try{return qe()}finally{Ee=pt}},ae.unstable_requestPaint=function(){pe=!0},ae.unstable_runWithPriority=function(qe,We){switch(qe){case 1:case 2:case 3:case 4:case 5:break;default:qe=3}var pt=Ee;Ee=qe;try{return We()}finally{Ee=pt}},ae.unstable_scheduleCallback=function(qe,We,pt){var Ve=ae.unstable_now();switch(typeof pt=="object"&&pt!==null?(pt=pt.delay,pt=typeof pt=="number"&&0<pt?Ve+pt:Ve):pt=Ve,qe){case 1:var St=-1;break;case 2:St=250;break;case 5:St=1073741823;break;case 4:St=1e4;break;default:St=5e3}return St=pt+St,qe={id:He++,callback:We,priorityLevel:qe,startTime:pt,expirationTime:St,sortIndex:-1},pt>Ve?(qe.sortIndex=pt,et(_e,qe),Fe(de)===null&&qe===Fe(_e)&&(rt?(Et(gt),gt=-1):rt=!0,fn(Bt,pt-Ve))):(qe.sortIndex=St,et(de,qe),At||ct||(At=!0,Tt||(Tt=!0,Jt()))),qe},ae.unstable_shouldYield=hi,ae.unstable_wrapCallback=function(qe){var We=Ee;return function(){var pt=Ee;Ee=We;try{return qe.apply(this,arguments)}finally{Ee=pt}}}})(xg)),xg}var Ug;function E_(){return Ug||(Ug=1,vg.exports=M_()),vg.exports}var bg={exports:{}},za={};var Gg;function A_(){if(Gg)return za;Gg=1;var ae=Eg();function et(de){var _e="https://react.dev/errors/"+de;if(1<arguments.length){_e+="?args[]="+encodeURIComponent(arguments[1]);for(var He=2;He<arguments.length;He++)_e+="&args[]="+encodeURIComponent(arguments[He])}return"Minified React error #"+de+"; visit "+_e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Fe(){}var ee={d:{f:Fe,r:function(){throw Error(et(522))},D:Fe,C:Fe,L:Fe,m:Fe,X:Fe,S:Fe,M:Fe},p:0,findDOMNode:null},at=Symbol.for("react.portal");function tt(de,_e,He){var Re=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:at,key:Re==null?null:""+Re,children:de,containerInfo:_e,implementation:He}}var L=ae.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(de,_e){if(de==="font")return"";if(typeof _e=="string")return _e==="use-credentials"?_e:""}return za.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ee,za.createPortal=function(de,_e){var He=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_e||_e.nodeType!==1&&_e.nodeType!==9&&_e.nodeType!==11)throw Error(et(299));return tt(de,_e,null,He)},za.flushSync=function(de){var _e=L.T,He=ee.p;try{if(L.T=null,ee.p=2,de)return de()}finally{L.T=_e,ee.p=He,ee.d.f()}},za.preconnect=function(de,_e){typeof de=="string"&&(_e?(_e=_e.crossOrigin,_e=typeof _e=="string"?_e==="use-credentials"?_e:"":void 0):_e=null,ee.d.C(de,_e))},za.prefetchDNS=function(de){typeof de=="string"&&ee.d.D(de)},za.preinit=function(de,_e){if(typeof de=="string"&&_e&&typeof _e.as=="string"){var He=_e.as,Re=d(He,_e.crossOrigin),Ee=typeof _e.integrity=="string"?_e.integrity:void 0,ct=typeof _e.fetchPriority=="string"?_e.fetchPriority:void 0;He==="style"?ee.d.S(de,typeof _e.precedence=="string"?_e.precedence:void 0,{crossOrigin:Re,integrity:Ee,fetchPriority:ct}):He==="script"&&ee.d.X(de,{crossOrigin:Re,integrity:Ee,fetchPriority:ct,nonce:typeof _e.nonce=="string"?_e.nonce:void 0})}},za.preinitModule=function(de,_e){if(typeof de=="string")if(typeof _e=="object"&&_e!==null){if(_e.as==null||_e.as==="script"){var He=d(_e.as,_e.crossOrigin);ee.d.M(de,{crossOrigin:He,integrity:typeof _e.integrity=="string"?_e.integrity:void 0,nonce:typeof _e.nonce=="string"?_e.nonce:void 0})}}else _e==null&&ee.d.M(de)},za.preload=function(de,_e){if(typeof de=="string"&&typeof _e=="object"&&_e!==null&&typeof _e.as=="string"){var He=_e.as,Re=d(He,_e.crossOrigin);ee.d.L(de,He,{crossOrigin:Re,integrity:typeof _e.integrity=="string"?_e.integrity:void 0,nonce:typeof _e.nonce=="string"?_e.nonce:void 0,type:typeof _e.type=="string"?_e.type:void 0,fetchPriority:typeof _e.fetchPriority=="string"?_e.fetchPriority:void 0,referrerPolicy:typeof _e.referrerPolicy=="string"?_e.referrerPolicy:void 0,imageSrcSet:typeof _e.imageSrcSet=="string"?_e.imageSrcSet:void 0,imageSizes:typeof _e.imageSizes=="string"?_e.imageSizes:void 0,media:typeof _e.media=="string"?_e.media:void 0})}},za.preloadModule=function(de,_e){if(typeof de=="string")if(_e){var He=d(_e.as,_e.crossOrigin);ee.d.m(de,{as:typeof _e.as=="string"&&_e.as!=="script"?_e.as:void 0,crossOrigin:He,integrity:typeof _e.integrity=="string"?_e.integrity:void 0})}else ee.d.m(de)},za.requestFormReset=function(de){ee.d.r(de)},za.unstable_batchedUpdates=function(de,_e){return de(_e)},za.useFormState=function(de,_e,He){return L.H.useFormState(de,_e,He)},za.useFormStatus=function(){return L.H.useHostTransitionStatus()},za.version="19.2.1",za}var qg;function C_(){if(qg)return bg.exports;qg=1;function ae(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ae)}catch(et){console.error(et)}}return ae(),bg.exports=A_(),bg.exports}var Zg;function z_(){if(Zg)return jp;Zg=1;var ae=E_(),et=Eg(),Fe=C_();function ee(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function at(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function tt(r){var s=r,c=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(c=s.return),r=s.return;while(r)}return s.tag===3?c:null}function L(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function d(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function de(r){if(tt(r)!==r)throw Error(ee(188))}function _e(r){var s=r.alternate;if(!s){if(s=tt(r),s===null)throw Error(ee(188));return s!==r?null:r}for(var c=r,g=s;;){var b=c.return;if(b===null)break;var M=b.alternate;if(M===null){if(g=b.return,g!==null){c=g;continue}break}if(b.child===M.child){for(M=b.child;M;){if(M===c)return de(b),r;if(M===g)return de(b),s;M=M.sibling}throw Error(ee(188))}if(c.return!==g.return)c=b,g=M;else{for(var k=!1,Z=b.child;Z;){if(Z===c){k=!0,c=b,g=M;break}if(Z===g){k=!0,g=b,c=M;break}Z=Z.sibling}if(!k){for(Z=M.child;Z;){if(Z===c){k=!0,c=M,g=b;break}if(Z===g){k=!0,g=M,c=b;break}Z=Z.sibling}if(!k)throw Error(ee(189))}}if(c.alternate!==g)throw Error(ee(190))}if(c.tag!==3)throw Error(ee(188));return c.stateNode.current===c?r:s}function He(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=He(r),s!==null)return s;r=r.sibling}return null}var Re=Object.assign,Ee=Symbol.for("react.element"),ct=Symbol.for("react.transitional.element"),At=Symbol.for("react.portal"),rt=Symbol.for("react.fragment"),pe=Symbol.for("react.strict_mode"),mt=Symbol.for("react.profiler"),Et=Symbol.for("react.consumer"),ut=Symbol.for("react.context"),vt=Symbol.for("react.forward_ref"),Bt=Symbol.for("react.suspense"),Tt=Symbol.for("react.suspense_list"),gt=Symbol.for("react.memo"),Vt=Symbol.for("react.lazy"),ti=Symbol.for("react.activity"),hi=Symbol.for("react.memo_cache_sentinel"),si=Symbol.iterator;function Jt(r){return r===null||typeof r!="object"?null:(r=si&&r[si]||r["@@iterator"],typeof r=="function"?r:null)}var di=Symbol.for("react.client.reference");function an(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===di?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case rt:return"Fragment";case mt:return"Profiler";case pe:return"StrictMode";case Bt:return"Suspense";case Tt:return"SuspenseList";case ti:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case At:return"Portal";case ut:return r.displayName||"Context";case Et:return(r._context.displayName||"Context")+".Consumer";case vt:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case gt:return s=r.displayName||null,s!==null?s:an(r.type)||"Memo";case Vt:s=r._payload,r=r._init;try{return an(r(s))}catch{}}return null}var fn=Array.isArray,qe=et.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,We=Fe.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,pt={pending:!1,data:null,method:null,action:null},Ve=[],St=-1;function le(r){return{current:r}}function ze(r){0>St||(r.current=Ve[St],Ve[St]=null,St--)}function it(r,s){St++,Ve[St]=r.current,r.current=s}var Ue=le(null),yt=le(null),kt=le(null),Nt=le(null);function yi(r,s){switch(it(kt,s),it(yt,r),it(Ue,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?ld(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=ld(s),r=hf(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ze(Ue),it(Ue,r)}function Ai(){ze(Ue),ze(yt),ze(kt)}function Jn(r){r.memoizedState!==null&&it(Nt,r);var s=Ue.current,c=hf(s,r.type);s!==c&&(it(yt,r),it(Ue,c))}function gr(r){yt.current===r&&(ze(Ue),ze(yt)),Nt.current===r&&(ze(Nt),fd._currentValue=pt)}var hr,Pa;function Zi(r){if(hr===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);hr=s&&s[1]||"",Pa=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+hr+r+Pa}var dr=!1;function _r(r,s){if(!r||dr)return"";dr=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(s){var st=function(){throw Error()};if(Object.defineProperty(st.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(st,[])}catch(Ne){var Be=Ne}Reflect.construct(r,[],st)}else{try{st.call()}catch(Ne){Be=Ne}r.call(st.prototype)}}else{try{throw Error()}catch(Ne){Be=Ne}(st=r())&&typeof st.catch=="function"&&st.catch(function(){})}}catch(Ne){if(Ne&&Be&&typeof Ne.stack=="string")return[Ne.stack,Be.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var M=g.DetermineComponentFrameRoot(),k=M[0],Z=M[1];if(k&&Z){var he=k.split(`
`),Le=Z.split(`
`);for(b=g=0;g<he.length&&!he[g].includes("DetermineComponentFrameRoot");)g++;for(;b<Le.length&&!Le[b].includes("DetermineComponentFrameRoot");)b++;if(g===he.length||b===Le.length)for(g=he.length-1,b=Le.length-1;1<=g&&0<=b&&he[g]!==Le[b];)b--;for(;1<=g&&0<=b;g--,b--)if(he[g]!==Le[b]){if(g!==1||b!==1)do if(g--,b--,0>b||he[g]!==Le[b]){var Xe=`
`+he[g].replace(" at new "," at ");return r.displayName&&Xe.includes("<anonymous>")&&(Xe=Xe.replace("<anonymous>",r.displayName)),Xe}while(1<=g&&0<=b);break}}}finally{dr=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?Zi(c):""}function pn(r,s){switch(r.tag){case 26:case 27:case 5:return Zi(r.type);case 16:return Zi("Lazy");case 13:return r.child!==s&&s!==null?Zi("Suspense Fallback"):Zi("Suspense");case 19:return Zi("SuspenseList");case 0:case 15:return _r(r.type,!1);case 11:return _r(r.type.render,!1);case 1:return _r(r.type,!0);case 31:return Zi("Activity");default:return""}}function xs(r){try{var s="",c=null;do s+=pn(r,c),c=r,r=r.return;while(r);return s}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var bs=Object.prototype.hasOwnProperty,Xs=ae.unstable_scheduleCallback,Wa=ae.unstable_cancelCallback,Ia=ae.unstable_shouldYield,gl=ae.unstable_requestPaint,er=ae.unstable_now,Vr=ae.unstable_getCurrentPriorityLevel,xe=ae.unstable_ImmediatePriority,V=ae.unstable_UserBlockingPriority,j=ae.unstable_NormalPriority,H=ae.unstable_LowPriority,oe=ae.unstable_IdlePriority,ce=ae.log,Se=ae.unstable_setDisableYieldValue,ye=null,fe=null;function Me(r){if(typeof ce=="function"&&Se(r),fe&&typeof fe.setStrictMode=="function")try{fe.setStrictMode(ye,r)}catch{}}var Ze=Math.clz32?Math.clz32:Pt,$e=Math.log,bt=Math.LN2;function Pt(r){return r>>>=0,r===0?32:31-($e(r)/bt|0)|0}var Gt=256,Ti=262144,fi=4194304;function be(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Ci(r,s,c){var g=r.pendingLanes;if(g===0)return 0;var b=0,M=r.suspendedLanes,k=r.pingedLanes;r=r.warmLanes;var Z=g&134217727;return Z!==0?(g=Z&~M,g!==0?b=be(g):(k&=Z,k!==0?b=be(k):c||(c=Z&~r,c!==0&&(b=be(c))))):(Z=g&~M,Z!==0?b=be(Z):k!==0?b=be(k):c||(c=g&~r,c!==0&&(b=be(c)))),b===0?0:s!==0&&s!==b&&(s&M)===0&&(M=b&-b,c=s&-s,M>=c||M===32&&(c&4194048)!==0)?s:b}function zn(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function Ht(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zi(){var r=fi;return fi<<=1,(fi&62914560)===0&&(fi=4194304),r}function Xn(r){for(var s=[],c=0;31>c;c++)s.push(r);return s}function Di(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Tn(r,s,c,g,b,M){var k=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var Z=r.entanglements,he=r.expirationTimes,Le=r.hiddenUpdates;for(c=k&~c;0<c;){var Xe=31-Ze(c),st=1<<Xe;Z[Xe]=0,he[Xe]=-1;var Be=Le[Xe];if(Be!==null)for(Le[Xe]=null,Xe=0;Xe<Be.length;Xe++){var Ne=Be[Xe];Ne!==null&&(Ne.lane&=-536870913)}c&=~st}g!==0&&Fi(r,g,0),M!==0&&b===0&&r.tag!==0&&(r.suspendedLanes|=M&~(k&~s))}function Fi(r,s,c){r.pendingLanes|=s,r.suspendedLanes&=~s;var g=31-Ze(s);r.entangledLanes|=s,r.entanglements[g]=r.entanglements[g]|1073741824|c&261930}function Dn(r,s){var c=r.entangledLanes|=s;for(r=r.entanglements;c;){var g=31-Ze(c),b=1<<g;b&s|r[g]&s&&(r[g]|=s),c&=~b}}function _l(r,s){var c=s&-s;return c=(c&42)!==0?1:Ao(c),(c&(r.suspendedLanes|s))!==0?0:c}function Ao(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function ot(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function yr(){var r=We.p;return r!==0?r:(r=window.event,r===void 0?32:Im(r.type))}function vr(r,s){var c=We.p;try{return We.p=r,s()}finally{We.p=c}}var Ra=Math.random().toString(36).slice(2),Hi="__reactFiber$"+Ra,ht="__reactProps$"+Ra,Xt="__reactContainer$"+Ra,Qt="__reactEvents$"+Ra,ea="__reactListeners$"+Ra,oc="__reactHandles$"+Ra,Qa="__reactResources$"+Ra,$t="__reactMarker$"+Ra;function Co(r){delete r[Hi],delete r[ht],delete r[Qt],delete r[ea],delete r[oc]}function Ka(r){var s=r[Hi];if(s)return s;for(var c=r.parentNode;c;){if(s=c[Xt]||c[Hi]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(r=ec(r);r!==null;){if(c=r[Hi])return c;r=ec(r)}return s}r=c,c=r.parentNode}return null}function ws(r){if(r=r[Hi]||r[Xt]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function Ja(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(ee(33))}function es(r){var s=r[Qa];return s||(s=r[Qa]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function mn(r){r[$t]=!0}var yl=new Set,xr={};function pi(r,s){Ts(r,s),Ts(r+"Capture",s)}function Ts(r,s){for(xr[r]=s,r=0;r<s.length;r++)yl.add(s[r])}var vl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xl={},Ys={};function La(r){return bs.call(Ys,r)?!0:bs.call(xl,r)?!1:vl.test(r)?Ys[r]=!0:(xl[r]=!0,!1)}function ou(r,s,c){if(La(s))if(c===null)r.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var g=s.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+c)}}function ts(r,s,c){if(c===null)r.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+c)}}function _a(r,s,c,g){if(g===null)r.removeAttribute(c);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(s,c,""+g)}}function vi(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function dh(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function xd(r,s,c){var g=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var b=g.get,M=g.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return b.call(this)},set:function(k){c=""+k,M.call(this,k)}}),Object.defineProperty(r,s,{enumerable:g.enumerable}),{getValue:function(){return c},setValue:function(k){c=""+k},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function zo(r){if(!r._valueTracker){var s=dh(r)?"checked":"value";r._valueTracker=xd(r,s,""+r[s])}}function fh(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var c=s.getValue(),g="";return r&&(g=dh(r)?r.checked?"true":"false":r.value),r=g,r!==c?(s.setValue(r),!0):!1}function lu(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var bd=/[\n"\\]/g;function Ar(r){return r.replace(bd,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function uu(r,s,c,g,b,M,k,Z){r.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?r.type=k:r.removeAttribute("type"),s!=null?k==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+vi(s)):r.value!==""+vi(s)&&(r.value=""+vi(s)):k!=="submit"&&k!=="reset"||r.removeAttribute("value"),s!=null?cu(r,k,vi(s)):c!=null?cu(r,k,vi(c)):g!=null&&r.removeAttribute("value"),b==null&&M!=null&&(r.defaultChecked=!!M),b!=null&&(r.checked=b&&typeof b!="function"&&typeof b!="symbol"),Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?r.name=""+vi(Z):r.removeAttribute("name")}function lc(r,s,c,g,b,M,k,Z){if(M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(r.type=M),s!=null||c!=null){if(!(M!=="submit"&&M!=="reset"||s!=null)){zo(r);return}c=c!=null?""+vi(c):"",s=s!=null?""+vi(s):c,Z||s===r.value||(r.value=s),r.defaultValue=s}g=g??b,g=typeof g!="function"&&typeof g!="symbol"&&!!g,r.checked=Z?r.checked:!!g,r.defaultChecked=!!g,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(r.name=k),zo(r)}function cu(r,s,c){s==="number"&&lu(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function Ws(r,s,c,g){if(r=r.options,s){s={};for(var b=0;b<c.length;b++)s["$"+c[b]]=!0;for(c=0;c<r.length;c++)b=s.hasOwnProperty("$"+r[c].value),r[c].selected!==b&&(r[c].selected=b),b&&g&&(r[c].defaultSelected=!0)}else{for(c=""+vi(c),s=null,b=0;b<r.length;b++){if(r[b].value===c){r[b].selected=!0,g&&(r[b].defaultSelected=!0);return}s!==null||r[b].disabled||(s=r[b])}s!==null&&(s.selected=!0)}}function wd(r,s,c){if(s!=null&&(s=""+vi(s),s!==r.value&&(r.value=s),c==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=c!=null?""+vi(c):""}function bl(r,s,c,g){if(s==null){if(g!=null){if(c!=null)throw Error(ee(92));if(fn(g)){if(1<g.length)throw Error(ee(93));g=g[0]}c=g}c==null&&(c=""),s=c}c=vi(s),r.defaultValue=c,g=r.textContent,g===c&&g!==""&&g!==null&&(r.value=g),zo(r)}function Ss(r,s){if(s){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=s;return}}r.textContent=s}var Td=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Do(r,s,c){var g=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?g?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":g?r.setProperty(s,c):typeof c!="number"||c===0||Td.has(s)?s==="float"?r.cssFloat=c:r[s]=(""+c).trim():r[s]=c+"px"}function uc(r,s,c){if(s!=null&&typeof s!="object")throw Error(ee(62));if(r=r.style,c!=null){for(var g in c)!c.hasOwnProperty(g)||s!=null&&s.hasOwnProperty(g)||(g.indexOf("--")===0?r.setProperty(g,""):g==="float"?r.cssFloat="":r[g]="");for(var b in s)g=s[b],s.hasOwnProperty(b)&&c[b]!==g&&Do(r,b,g)}else for(var M in s)s.hasOwnProperty(M)&&Do(r,M,s[M])}function Po(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qs=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),wl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Wt(r){return wl.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Ba(){}var ph=null;function hu(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Yn=null,Pn=null;function Wi(r){var s=ws(r);if(s&&(r=s.stateNode)){var c=r[ht]||null;e:switch(r=s.stateNode,s.type){case"input":if(uu(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Ar(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var g=c[s];if(g!==r&&g.form===r.form){var b=g[ht]||null;if(!b)throw Error(ee(90));uu(g,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<c.length;s++)g=c[s],g.form===r.form&&fh(g)}break e;case"textarea":wd(r,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&Ws(r,!!c.multiple,s,!1)}}}var jt=!1;function Ni(r,s,c){if(jt)return r(s,c);jt=!0;try{var g=r(s);return g}finally{if(jt=!1,(Yn!==null||Pn!==null)&&(Qh(),Yn&&(s=Yn,r=Pn,Pn=Yn=null,Wi(s),r)))for(s=0;s<r.length;s++)Wi(r[s])}}function ya(r,s){var c=r.stateNode;if(c===null)return null;var g=c[ht]||null;if(g===null)return null;c=g[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(r=r.type,g=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!g;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(ee(231,s,typeof c));return c}var gn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Cr=!1;if(gn)try{var Wn={};Object.defineProperty(Wn,"passive",{get:function(){Cr=!0}}),window.addEventListener("test",Wn,Wn),window.removeEventListener("test",Wn,Wn)}catch{Cr=!1}var ta=null,is=null,Qi=null;function Ks(){if(Qi)return Qi;var r,s=is,c=s.length,g,b="value"in ta?ta.value:ta.textContent,M=b.length;for(r=0;r<c&&s[r]===b[r];r++);var k=c-r;for(g=1;g<=k&&s[c-g]===b[M-g];g++);return Qi=b.slice(r,1<g?1-g:void 0)}function ia(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Io(){return!0}function zr(){return!1}function kn(r){function s(c,g,b,M,k){this._reactName=c,this._targetInst=b,this.type=g,this.nativeEvent=M,this.target=k,this.currentTarget=null;for(var Z in r)r.hasOwnProperty(Z)&&(c=r[Z],this[Z]=c?c(M):M[Z]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?Io:zr,this.isPropagationStopped=zr,this}return Re(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Io)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Io)},persist:function(){},isPersistent:Io}),s}var Dr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},du=kn(Dr),Ro=Re({},Dr,{view:0,detail:0}),Lo=kn(Ro),Pi,Js,ei,Yt=Re({},Ro,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mu,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==ei&&(ei&&r.type==="mousemove"?(Pi=r.screenX-ei.screenX,Js=r.screenY-ei.screenY):Js=Pi=0,ei=r),Pi)},movementY:function(r){return"movementY"in r?r.movementY:Js}}),Bo=kn(Yt),mi=Re({},Yt,{dataTransfer:0}),fu=kn(mi),va=Re({},Ro,{relatedTarget:0}),eo=kn(va),to=Re({},Dr,{animationName:0,elapsedTime:0,pseudoElement:0}),Sd=kn(to),pu=Re({},Dr,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),mh=kn(pu),If=Re({},Dr,{data:0}),gh=kn(If),Pr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ns={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ki={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ko(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=Ki[r])?!!s[r]:!1}function mu(){return ko}var gu=Re({},Ro,{key:function(r){if(r.key){var s=Pr[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=ia(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?ns[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mu,charCode:function(r){return r.type==="keypress"?ia(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ia(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),_n=kn(gu),Md=Re({},Yt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cc=kn(Md),Ed=Re({},Ro,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mu}),Rf=kn(Ed),Tl=Re({},Dr,{propertyName:0,elapsedTime:0,pseudoElement:0}),hc=kn(Tl),Sl=Re({},Yt,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),_h=kn(Sl),_u=Re({},Dr,{newState:0,oldState:0}),Ml=kn(_u),El=[9,13,27,32],Sn=gn&&"CompositionEvent"in window,Al=null;gn&&"documentMode"in document&&(Al=document.documentMode);var Cl=gn&&"TextEvent"in window&&!Al,zl=gn&&(!Sn||Al&&8<Al&&11>=Al),io=" ",Ad=!1;function yu(r,s){switch(r){case"keyup":return El.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Cd(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var ka=!1;function dc(r,s){switch(r){case"compositionend":return Cd(s);case"keypress":return s.which!==32?null:(Ad=!0,io);case"textInput":return r=s.data,r===io&&Ad?null:r;default:return null}}function zd(r,s){if(ka)return r==="compositionend"||!Sn&&yu(r,s)?(r=Ks(),Qi=is=ta=null,ka=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return zl&&s.locale!=="ko"?null:s.data;default:return null}}var Dd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function fc(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Dd[r.type]:s==="textarea"}function pc(r,s,c,g){Yn?Pn?Pn.push(g):Pn=[g]:Yn=g,s=rd(s,"onChange"),0<s.length&&(c=new du("onChange","change",null,c,g),r.push({event:c,listeners:s}))}var Oo=null,Dl=null;function Pd(r){pm(r,0)}function vu(r){var s=Ja(r);if(fh(s))return r}function no(r,s){if(r==="change")return s}var yh=!1;if(gn){var xu;if(gn){var ro="oninput"in document;if(!ro){var vh=document.createElement("div");vh.setAttribute("oninput","return;"),ro=typeof vh.oninput=="function"}xu=ro}else xu=!1;yh=xu&&(!document.documentMode||9<document.documentMode)}function bu(){Oo&&(Oo.detachEvent("onpropertychange",Id),Dl=Oo=null)}function Id(r){if(r.propertyName==="value"&&vu(Dl)){var s=[];pc(s,Dl,r,hu(r)),Ni(Pd,s)}}function Lf(r,s,c){r==="focusin"?(bu(),Oo=s,Dl=c,Oo.attachEvent("onpropertychange",Id)):r==="focusout"&&bu()}function Rd(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return vu(Dl)}function wu(r,s){if(r==="click")return vu(s)}function Ld(r,s){if(r==="input"||r==="change")return vu(s)}function xh(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Ur=typeof Object.is=="function"?Object.is:xh;function ao(r,s){if(Ur(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var c=Object.keys(r),g=Object.keys(s);if(c.length!==g.length)return!1;for(g=0;g<c.length;g++){var b=c[g];if(!bs.call(s,b)||!Ur(r[b],s[b]))return!1}return!0}function xa(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Tu(r,s){var c=xa(r);r=0;for(var g;c;){if(c.nodeType===3){if(g=r+c.textContent.length,r<=s&&g>=s)return{node:c,offset:s-r};r=g}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=xa(c)}}function mc(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?mc(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function gc(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=lu(r.document);s instanceof r.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)r=s.contentWindow;else break;s=lu(r.document)}return s}function Su(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var _c=gn&&"documentMode"in document&&11>=document.documentMode,ba=null,Mu=null,Eu=null,yc=!1;function Bd(r,s,c){var g=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;yc||ba==null||ba!==lu(g)||(g=ba,"selectionStart"in g&&Su(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Eu&&ao(Eu,g)||(Eu=g,g=rd(Mu,"onSelect"),0<g.length&&(s=new du("onSelect","select",null,s,c),r.push({event:s,listeners:g}),s.target=ba)))}function Fo(r,s){var c={};return c[r.toLowerCase()]=s.toLowerCase(),c["Webkit"+r]="webkit"+s,c["Moz"+r]="moz"+s,c}var No={animationend:Fo("Animation","AnimationEnd"),animationiteration:Fo("Animation","AnimationIteration"),animationstart:Fo("Animation","AnimationStart"),transitionrun:Fo("Transition","TransitionRun"),transitionstart:Fo("Transition","TransitionStart"),transitioncancel:Fo("Transition","TransitionCancel"),transitionend:Fo("Transition","TransitionEnd")},bh={},xi={};gn&&(xi=document.createElement("div").style,"AnimationEvent"in window||(delete No.animationend.animation,delete No.animationiteration.animation,delete No.animationstart.animation),"TransitionEvent"in window||delete No.transitionend.transition);function rs(r){if(bh[r])return bh[r];if(!No[r])return r;var s=No[r],c;for(c in s)if(s.hasOwnProperty(c)&&c in xi)return bh[r]=s[c];return r}var Au=rs("animationend"),Cu=rs("animationiteration"),vc=rs("animationstart"),jo=rs("transitionrun"),zu=rs("transitionstart"),Pl=rs("transitioncancel"),na=rs("transitionend"),wh=new Map,xc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");xc.push("scrollEnd");function ra(r,s){wh.set(r,s),pi(s,[r])}var as=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Ir=[],Ms=0,Vo=0;function Uo(){for(var r=Ms,s=Vo=Ms=0;s<r;){var c=Ir[s];Ir[s++]=null;var g=Ir[s];Ir[s++]=null;var b=Ir[s];Ir[s++]=null;var M=Ir[s];if(Ir[s++]=null,g!==null&&b!==null){var k=g.pending;k===null?b.next=b:(b.next=k.next,k.next=b),g.pending=b}M!==0&&Th(c,b,M)}}function Du(r,s,c,g){Ir[Ms++]=r,Ir[Ms++]=s,Ir[Ms++]=c,Ir[Ms++]=g,Vo|=g,r.lanes|=g,r=r.alternate,r!==null&&(r.lanes|=g)}function so(r,s,c,g){return Du(r,s,c,g),Il(r)}function wa(r,s){return Du(r,null,null,s),Il(r)}function Th(r,s,c){r.lanes|=c;var g=r.alternate;g!==null&&(g.lanes|=c);for(var b=!1,M=r.return;M!==null;)M.childLanes|=c,g=M.alternate,g!==null&&(g.childLanes|=c),M.tag===22&&(r=M.stateNode,r===null||r._visibility&1||(b=!0)),r=M,M=M.return;return r.tag===3?(M=r.stateNode,b&&s!==null&&(b=31-Ze(c),r=M.hiddenUpdates,g=r[b],g===null?r[b]=[s]:g.push(s),s.lane=c|536870912),M):null}function Il(r){if(50<Wh)throw Wh=0,sp=null,Error(ee(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var Kt={};function bc(r,s,c,g){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function aa(r,s,c,g){return new bc(r,s,c,g)}function wc(r){return r=r.prototype,!(!r||!r.isReactComponent)}function sa(r,s){var c=r.alternate;return c===null?(c=aa(r.tag,s,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=s,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,s=r.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function kd(r,s){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,s=c.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function Tc(r,s,c,g,b,M){var k=0;if(g=r,typeof r=="function")wc(r)&&(k=1);else if(typeof r=="string")k=Mp(r,c,Ue.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case ti:return r=aa(31,c,s,b),r.elementType=ti,r.lanes=M,r;case rt:return oo(c.children,b,M,s);case pe:k=8,b|=24;break;case mt:return r=aa(12,c,s,b|2),r.elementType=mt,r.lanes=M,r;case Bt:return r=aa(13,c,s,b),r.elementType=Bt,r.lanes=M,r;case Tt:return r=aa(19,c,s,b),r.elementType=Tt,r.lanes=M,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case ut:k=10;break e;case Et:k=9;break e;case vt:k=11;break e;case gt:k=14;break e;case Vt:k=16,g=null;break e}k=29,c=Error(ee(130,r===null?"null":typeof r,"")),g=null}return s=aa(k,c,s,b),s.elementType=r,s.type=g,s.lanes=M,s}function oo(r,s,c,g){return r=aa(7,r,g,s),r.lanes=c,r}function Sh(r,s,c){return r=aa(6,r,null,s),r.lanes=c,r}function Sc(r){var s=aa(18,null,null,0);return s.stateNode=r,s}function lo(r,s,c){return s=aa(4,r.children!==null?r.children:[],r.key,s),s.lanes=c,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var Pu=new WeakMap;function Rr(r,s){if(typeof r=="object"&&r!==null){var c=Pu.get(r);return c!==void 0?c:(s={value:r,source:s,stack:xs(s)},Pu.set(r,s),s)}return{value:r,source:s,stack:xs(s)}}var uo=[],co=0,Go=null,ho=0,tr=[],ir=0,ss=null,os=1,Gr="";function Es(r,s){uo[co++]=ho,uo[co++]=Go,Go=r,ho=s}function Mh(r,s,c){tr[ir++]=os,tr[ir++]=Gr,tr[ir++]=ss,ss=r;var g=os;r=Gr;var b=32-Ze(g)-1;g&=~(1<<b),c+=1;var M=32-Ze(s)+b;if(30<M){var k=b-b%5;M=(g&(1<<k)-1).toString(32),g>>=k,b-=k,os=1<<32-Ze(s)+b|c<<b|g,Gr=M+r}else os=1<<M|c<<b|g,Gr=r}function qo(r){r.return!==null&&(Es(r,1),Mh(r,1,0))}function Rl(r){for(;r===Go;)Go=uo[--co],uo[co]=null,ho=uo[--co],uo[co]=null;for(;r===ss;)ss=tr[--ir],tr[ir]=null,Gr=tr[--ir],tr[ir]=null,os=tr[--ir],tr[ir]=null}function Eh(r,s){tr[ir++]=os,tr[ir++]=Gr,tr[ir++]=ss,os=s.id,Gr=s.overflow,ss=r}var nr=null,ji=null,oi=!1,As=null,oa=!1,sn=Error(ee(519));function qr(r){var s=Error(ee(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Cs(Rr(s,r)),sn}function la(r){var s=r.stateNode,c=r.type,g=r.memoizedProps;switch(s[Hi]=r,s[ht]=g,c){case"dialog":_i("cancel",s),_i("close",s);break;case"iframe":case"object":case"embed":_i("load",s);break;case"video":case"audio":for(c=0;c<id.length;c++)_i(id[c],s);break;case"source":_i("error",s);break;case"img":case"image":case"link":_i("error",s),_i("load",s);break;case"details":_i("toggle",s);break;case"input":_i("invalid",s),lc(s,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":_i("invalid",s);break;case"textarea":_i("invalid",s),bl(s,g.value,g.defaultValue,g.children)}c=g.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||g.suppressHydrationWarning===!0||lf(s.textContent,c)?(g.popover!=null&&(_i("beforetoggle",s),_i("toggle",s)),g.onScroll!=null&&_i("scroll",s),g.onScrollEnd!=null&&_i("scrollend",s),g.onClick!=null&&(s.onclick=Ba),s=!0):s=!1,s||qr(r,!0)}function Iu(r){for(nr=r.return;nr;)switch(nr.tag){case 5:case 31:case 13:oa=!1;return;case 27:case 3:oa=!0;return;default:nr=nr.return}}function ls(r){if(r!==nr)return!1;if(!oi)return Iu(r),oi=!0,!1;var s=r.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||ud(r.type,r.memoizedProps)),c=!c),c&&ji&&qr(r),Iu(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ee(317));ji=eu(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ee(317));ji=eu(r)}else s===27?(s=ji,xn(r.type)?(r=mf,mf=null,ji=r):ji=s):ji=nr?vs(r.stateNode.nextSibling):null;return!0}function us(){ji=nr=null,oi=!1}function cs(){var r=As;return r!==null&&(Aa===null?Aa=r:Aa.push.apply(Aa,r),As=null),r}function Cs(r){As===null?As=[r]:As.push(r)}var zs=le(null),Ta=null,hs=null;function Ds(r,s,c){it(zs,s._currentValue),s._currentValue=c}function ds(r){r._currentValue=zs.current,ze(zs)}function Mc(r,s,c){for(;r!==null;){var g=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,g!==null&&(g.childLanes|=s)):g!==null&&(g.childLanes&s)!==s&&(g.childLanes|=s),r===c)break;r=r.return}}function Ec(r,s,c,g){var b=r.child;for(b!==null&&(b.return=r);b!==null;){var M=b.dependencies;if(M!==null){var k=b.child;M=M.firstContext;e:for(;M!==null;){var Z=M;M=b;for(var he=0;he<s.length;he++)if(Z.context===s[he]){M.lanes|=c,Z=M.alternate,Z!==null&&(Z.lanes|=c),Mc(M.return,c,r),g||(k=null);break e}M=Z.next}}else if(b.tag===18){if(k=b.return,k===null)throw Error(ee(341));k.lanes|=c,M=k.alternate,M!==null&&(M.lanes|=c),Mc(k,c,r),k=null}else k=b.child;if(k!==null)k.return=b;else for(k=b;k!==null;){if(k===r){k=null;break}if(b=k.sibling,b!==null){b.return=k.return,k=b;break}k=k.return}b=k}}function Sa(r,s,c,g){r=null;for(var b=s,M=!1;b!==null;){if(!M){if((b.flags&524288)!==0)M=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var k=b.alternate;if(k===null)throw Error(ee(387));if(k=k.memoizedProps,k!==null){var Z=b.type;Ur(b.pendingProps.value,k.value)||(r!==null?r.push(Z):r=[Z])}}else if(b===Nt.current){if(k=b.alternate,k===null)throw Error(ee(387));k.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(r!==null?r.push(fd):r=[fd])}b=b.return}r!==null&&Ec(s,r,c,g),s.flags|=262144}function Ll(r){for(r=r.firstContext;r!==null;){if(!Ur(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Ps(r){Ta=r,hs=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function In(r){return Ac(Ta,r)}function Ru(r,s){return Ta===null&&Ps(r),Ac(r,s)}function Ac(r,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},hs===null){if(r===null)throw Error(ee(308));hs=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else hs=hs.next=s;return c}var Ah=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(c,g){r.push(g)}};this.abort=function(){s.aborted=!0,r.forEach(function(c){return c()})}},Od=ae.unstable_scheduleCallback,Ch=ae.unstable_NormalPriority,on={$$typeof:ut,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function fo(){return{controller:new Ah,data:new Map,refCount:0}}function br(r){r.refCount--,r.refCount===0&&Od(Ch,function(){r.controller.abort()})}var Lr=null,Cc=0,wr=0,Bl=null;function kl(r,s){if(Lr===null){var c=Lr=[];Cc=0,wr=Kl(),Bl={status:"pending",value:void 0,then:function(g){c.push(g)}}}return Cc++,s.then(Ol,Ol),s}function Ol(){if(--Cc===0&&Lr!==null){Bl!==null&&(Bl.status="fulfilled");var r=Lr;Lr=null,wr=0,Bl=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function Lu(r,s){var c=[],g={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return r.then(function(){g.status="fulfilled",g.value=s;for(var b=0;b<c.length;b++)(0,c[b])(s)},function(b){for(g.status="rejected",g.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),g}var Zr=qe.S;qe.S=function(r,s){ip=er(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&kl(r,s),Zr!==null&&Zr(r,s)};var Oa=le(null);function Bu(){var r=Oa.current;return r!==null?r:nn.pooledCache}function po(r,s){s===null?it(Oa,Oa.current):it(Oa,s.pool)}function fs(){var r=Bu();return r===null?null:{parent:on._currentValue,pool:r}}var ft=Error(ee(460)),ku=Error(ee(474)),mo=Error(ee(542)),Ou={then:function(){}};function go(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Fl(r,s,c){switch(c=r[c],c===void 0?r.push(s):c!==s&&(s.then(Ba,Ba),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,zh(r),r;default:if(typeof s.status=="string")s.then(Ba,Ba);else{if(r=nn,r!==null&&100<r.shellSuspendCounter)throw Error(ee(482));r=s,r.status="pending",r.then(function(g){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=g}},function(g){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=g}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,zh(r),r}throw Zo=s,ft}}function ua(r){try{var s=r._init;return s(r._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(Zo=c,ft):c}}var Zo=null;function zc(){if(Zo===null)throw Error(ee(459));var r=Zo;return Zo=null,r}function zh(r){if(r===ft||r===mo)throw Error(ee(483))}var Ma=null,Fu=0;function Nu(r){var s=Fu;return Fu+=1,Ma===null&&(Ma=[]),Fl(Ma,r,s)}function _o(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function Dc(r,s){throw s.$$typeof===Ee?Error(ee(525)):(r=Object.prototype.toString.call(s),Error(ee(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function ju(r){function s(ve,ge){if(r){var Ie=ve.deletions;Ie===null?(ve.deletions=[ge],ve.flags|=16):Ie.push(ge)}}function c(ve,ge){if(!r)return null;for(;ge!==null;)s(ve,ge),ge=ge.sibling;return null}function g(ve){for(var ge=new Map;ve!==null;)ve.key!==null?ge.set(ve.key,ve):ge.set(ve.index,ve),ve=ve.sibling;return ge}function b(ve,ge){return ve=sa(ve,ge),ve.index=0,ve.sibling=null,ve}function M(ve,ge,Ie){return ve.index=Ie,r?(Ie=ve.alternate,Ie!==null?(Ie=Ie.index,Ie<ge?(ve.flags|=67108866,ge):Ie):(ve.flags|=67108866,ge)):(ve.flags|=1048576,ge)}function k(ve){return r&&ve.alternate===null&&(ve.flags|=67108866),ve}function Z(ve,ge,Ie,Qe){return ge===null||ge.tag!==6?(ge=Sh(Ie,ve.mode,Qe),ge.return=ve,ge):(ge=b(ge,Ie),ge.return=ve,ge)}function he(ve,ge,Ie,Qe){var Dt=Ie.type;return Dt===rt?Xe(ve,ge,Ie.props.children,Qe,Ie.key):ge!==null&&(ge.elementType===Dt||typeof Dt=="object"&&Dt!==null&&Dt.$$typeof===Vt&&ua(Dt)===ge.type)?(ge=b(ge,Ie.props),_o(ge,Ie),ge.return=ve,ge):(ge=Tc(Ie.type,Ie.key,Ie.props,null,ve.mode,Qe),_o(ge,Ie),ge.return=ve,ge)}function Le(ve,ge,Ie,Qe){return ge===null||ge.tag!==4||ge.stateNode.containerInfo!==Ie.containerInfo||ge.stateNode.implementation!==Ie.implementation?(ge=lo(Ie,ve.mode,Qe),ge.return=ve,ge):(ge=b(ge,Ie.children||[]),ge.return=ve,ge)}function Xe(ve,ge,Ie,Qe,Dt){return ge===null||ge.tag!==7?(ge=oo(Ie,ve.mode,Qe,Dt),ge.return=ve,ge):(ge=b(ge,Ie),ge.return=ve,ge)}function st(ve,ge,Ie){if(typeof ge=="string"&&ge!==""||typeof ge=="number"||typeof ge=="bigint")return ge=Sh(""+ge,ve.mode,Ie),ge.return=ve,ge;if(typeof ge=="object"&&ge!==null){switch(ge.$$typeof){case ct:return Ie=Tc(ge.type,ge.key,ge.props,null,ve.mode,Ie),_o(Ie,ge),Ie.return=ve,Ie;case At:return ge=lo(ge,ve.mode,Ie),ge.return=ve,ge;case Vt:return ge=ua(ge),st(ve,ge,Ie)}if(fn(ge)||Jt(ge))return ge=oo(ge,ve.mode,Ie,null),ge.return=ve,ge;if(typeof ge.then=="function")return st(ve,Nu(ge),Ie);if(ge.$$typeof===ut)return st(ve,Ru(ve,ge),Ie);Dc(ve,ge)}return null}function Be(ve,ge,Ie,Qe){var Dt=ge!==null?ge.key:null;if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return Dt!==null?null:Z(ve,ge,""+Ie,Qe);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case ct:return Ie.key===Dt?he(ve,ge,Ie,Qe):null;case At:return Ie.key===Dt?Le(ve,ge,Ie,Qe):null;case Vt:return Ie=ua(Ie),Be(ve,ge,Ie,Qe)}if(fn(Ie)||Jt(Ie))return Dt!==null?null:Xe(ve,ge,Ie,Qe,null);if(typeof Ie.then=="function")return Be(ve,ge,Nu(Ie),Qe);if(Ie.$$typeof===ut)return Be(ve,ge,Ru(ve,Ie),Qe);Dc(ve,Ie)}return null}function Ne(ve,ge,Ie,Qe,Dt){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number"||typeof Qe=="bigint")return ve=ve.get(Ie)||null,Z(ge,ve,""+Qe,Dt);if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case ct:return ve=ve.get(Qe.key===null?Ie:Qe.key)||null,he(ge,ve,Qe,Dt);case At:return ve=ve.get(Qe.key===null?Ie:Qe.key)||null,Le(ge,ve,Qe,Dt);case Vt:return Qe=ua(Qe),Ne(ve,ge,Ie,Qe,Dt)}if(fn(Qe)||Jt(Qe))return ve=ve.get(Ie)||null,Xe(ge,ve,Qe,Dt,null);if(typeof Qe.then=="function")return Ne(ve,ge,Ie,Nu(Qe),Dt);if(Qe.$$typeof===ut)return Ne(ve,ge,Ie,Ru(ge,Qe),Dt);Dc(ge,Qe)}return null}function It(ve,ge,Ie,Qe){for(var Dt=null,Ei=null,Ft=ge,ni=ge=0,gi=null;Ft!==null&&ni<Ie.length;ni++){Ft.index>ni?(gi=Ft,Ft=null):gi=Ft.sibling;var ki=Be(ve,Ft,Ie[ni],Qe);if(ki===null){Ft===null&&(Ft=gi);break}r&&Ft&&ki.alternate===null&&s(ve,Ft),ge=M(ki,ge,ni),Ei===null?Dt=ki:Ei.sibling=ki,Ei=ki,Ft=gi}if(ni===Ie.length)return c(ve,Ft),oi&&Es(ve,ni),Dt;if(Ft===null){for(;ni<Ie.length;ni++)Ft=st(ve,Ie[ni],Qe),Ft!==null&&(ge=M(Ft,ge,ni),Ei===null?Dt=Ft:Ei.sibling=Ft,Ei=Ft);return oi&&Es(ve,ni),Dt}for(Ft=g(Ft);ni<Ie.length;ni++)gi=Ne(Ft,ve,ni,Ie[ni],Qe),gi!==null&&(r&&gi.alternate!==null&&Ft.delete(gi.key===null?ni:gi.key),ge=M(gi,ge,ni),Ei===null?Dt=gi:Ei.sibling=gi,Ei=gi);return r&&Ft.forEach(function(dl){return s(ve,dl)}),oi&&Es(ve,ni),Dt}function qt(ve,ge,Ie,Qe){if(Ie==null)throw Error(ee(151));for(var Dt=null,Ei=null,Ft=ge,ni=ge=0,gi=null,ki=Ie.next();Ft!==null&&!ki.done;ni++,ki=Ie.next()){Ft.index>ni?(gi=Ft,Ft=null):gi=Ft.sibling;var dl=Be(ve,Ft,ki.value,Qe);if(dl===null){Ft===null&&(Ft=gi);break}r&&Ft&&dl.alternate===null&&s(ve,Ft),ge=M(dl,ge,ni),Ei===null?Dt=dl:Ei.sibling=dl,Ei=dl,Ft=gi}if(ki.done)return c(ve,Ft),oi&&Es(ve,ni),Dt;if(Ft===null){for(;!ki.done;ni++,ki=Ie.next())ki=st(ve,ki.value,Qe),ki!==null&&(ge=M(ki,ge,ni),Ei===null?Dt=ki:Ei.sibling=ki,Ei=ki);return oi&&Es(ve,ni),Dt}for(Ft=g(Ft);!ki.done;ni++,ki=Ie.next())ki=Ne(Ft,ve,ni,ki.value,Qe),ki!==null&&(r&&ki.alternate!==null&&Ft.delete(ki.key===null?ni:ki.key),ge=M(ki,ge,ni),Ei===null?Dt=ki:Ei.sibling=ki,Ei=ki);return r&&Ft.forEach(function(km){return s(ve,km)}),oi&&Es(ve,ni),Dt}function qi(ve,ge,Ie,Qe){if(typeof Ie=="object"&&Ie!==null&&Ie.type===rt&&Ie.key===null&&(Ie=Ie.props.children),typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case ct:e:{for(var Dt=Ie.key;ge!==null;){if(ge.key===Dt){if(Dt=Ie.type,Dt===rt){if(ge.tag===7){c(ve,ge.sibling),Qe=b(ge,Ie.props.children),Qe.return=ve,ve=Qe;break e}}else if(ge.elementType===Dt||typeof Dt=="object"&&Dt!==null&&Dt.$$typeof===Vt&&ua(Dt)===ge.type){c(ve,ge.sibling),Qe=b(ge,Ie.props),_o(Qe,Ie),Qe.return=ve,ve=Qe;break e}c(ve,ge);break}else s(ve,ge);ge=ge.sibling}Ie.type===rt?(Qe=oo(Ie.props.children,ve.mode,Qe,Ie.key),Qe.return=ve,ve=Qe):(Qe=Tc(Ie.type,Ie.key,Ie.props,null,ve.mode,Qe),_o(Qe,Ie),Qe.return=ve,ve=Qe)}return k(ve);case At:e:{for(Dt=Ie.key;ge!==null;){if(ge.key===Dt)if(ge.tag===4&&ge.stateNode.containerInfo===Ie.containerInfo&&ge.stateNode.implementation===Ie.implementation){c(ve,ge.sibling),Qe=b(ge,Ie.children||[]),Qe.return=ve,ve=Qe;break e}else{c(ve,ge);break}else s(ve,ge);ge=ge.sibling}Qe=lo(Ie,ve.mode,Qe),Qe.return=ve,ve=Qe}return k(ve);case Vt:return Ie=ua(Ie),qi(ve,ge,Ie,Qe)}if(fn(Ie))return It(ve,ge,Ie,Qe);if(Jt(Ie)){if(Dt=Jt(Ie),typeof Dt!="function")throw Error(ee(150));return Ie=Dt.call(Ie),qt(ve,ge,Ie,Qe)}if(typeof Ie.then=="function")return qi(ve,ge,Nu(Ie),Qe);if(Ie.$$typeof===ut)return qi(ve,ge,Ru(ve,Ie),Qe);Dc(ve,Ie)}return typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint"?(Ie=""+Ie,ge!==null&&ge.tag===6?(c(ve,ge.sibling),Qe=b(ge,Ie),Qe.return=ve,ve=Qe):(c(ve,ge),Qe=Sh(Ie,ve.mode,Qe),Qe.return=ve,ve=Qe),k(ve)):c(ve,ge)}return function(ve,ge,Ie,Qe){try{Fu=0;var Dt=qi(ve,ge,Ie,Qe);return Ma=null,Dt}catch(Ft){if(Ft===ft||Ft===mo)throw Ft;var Ei=aa(29,Ft,null,ve.mode);return Ei.lanes=Qe,Ei.return=ve,Ei}finally{}}}var ps=ju(!0),Pc=ju(!1),Is=!1;function Ic(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Fa(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function ui(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Rs(r,s,c){var g=r.updateQueue;if(g===null)return null;if(g=g.shared,(Ri&2)!==0){var b=g.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),g.pending=s,s=Il(r),Th(r,null,c),s}return Du(r,g,s,c),Il(r)}function yo(r,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var g=s.lanes;g&=r.pendingLanes,c|=g,s.lanes=c,Dn(r,c)}}function Ho(r,s){var c=r.updateQueue,g=r.alternate;if(g!==null&&(g=g.updateQueue,c===g)){var b=null,M=null;if(c=c.firstBaseUpdate,c!==null){do{var k={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};M===null?b=M=k:M=M.next=k,c=c.next}while(c!==null);M===null?b=M=s:M=M.next=s}else b=M=s;c={baseState:g.baseState,firstBaseUpdate:b,lastBaseUpdate:M,shared:g.shared,callbacks:g.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=s:r.next=s,c.lastBaseUpdate=s}var Vu=!1;function $o(){if(Vu){var r=Bl;if(r!==null)throw r}}function Nl(r,s,c,g){Vu=!1;var b=r.updateQueue;Is=!1;var M=b.firstBaseUpdate,k=b.lastBaseUpdate,Z=b.shared.pending;if(Z!==null){b.shared.pending=null;var he=Z,Le=he.next;he.next=null,k===null?M=Le:k.next=Le,k=he;var Xe=r.alternate;Xe!==null&&(Xe=Xe.updateQueue,Z=Xe.lastBaseUpdate,Z!==k&&(Z===null?Xe.firstBaseUpdate=Le:Z.next=Le,Xe.lastBaseUpdate=he))}if(M!==null){var st=b.baseState;k=0,Xe=Le=he=null,Z=M;do{var Be=Z.lane&-536870913,Ne=Be!==Z.lane;if(Ne?(li&Be)===Be:(g&Be)===Be){Be!==0&&Be===wr&&(Vu=!0),Xe!==null&&(Xe=Xe.next={lane:0,tag:Z.tag,payload:Z.payload,callback:null,next:null});e:{var It=r,qt=Z;Be=s;var qi=c;switch(qt.tag){case 1:if(It=qt.payload,typeof It=="function"){st=It.call(qi,st,Be);break e}st=It;break e;case 3:It.flags=It.flags&-65537|128;case 0:if(It=qt.payload,Be=typeof It=="function"?It.call(qi,st,Be):It,Be==null)break e;st=Re({},st,Be);break e;case 2:Is=!0}}Be=Z.callback,Be!==null&&(r.flags|=64,Ne&&(r.flags|=8192),Ne=b.callbacks,Ne===null?b.callbacks=[Be]:Ne.push(Be))}else Ne={lane:Be,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},Xe===null?(Le=Xe=Ne,he=st):Xe=Xe.next=Ne,k|=Be;if(Z=Z.next,Z===null){if(Z=b.shared.pending,Z===null)break;Ne=Z,Z=Ne.next,Ne.next=null,b.lastBaseUpdate=Ne,b.shared.pending=null}}while(!0);Xe===null&&(he=st),b.baseState=he,b.firstBaseUpdate=Le,b.lastBaseUpdate=Xe,M===null&&(b.shared.lanes=0),_s|=k,r.lanes=k,r.memoizedState=st}}function Rc(r,s){if(typeof r!="function")throw Error(ee(191,r));r.call(s)}function Dh(r,s){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)Rc(c[r],s)}var Br=le(null),Xo=le(0);function zt(r,s){r=nl,it(Xo,r),it(Br,s),nl=r|s.baseLanes}function Ot(){it(Xo,nl),it(Br,Br.current)}function vo(){nl=Xo.current,ze(Br),ze(Xo)}var kr=le(null),rr=null;function Mn(r){var s=r.alternate;it(En,En.current&1),it(kr,r),rr===null&&(s===null||Br.current!==null||s.memoizedState!==null)&&(rr=r)}function Or(r){it(En,En.current),it(kr,r),rr===null&&(rr=r)}function Ph(r){r.tag===22?(it(En,En.current),it(kr,r),rr===null&&(rr=r)):xo()}function xo(){it(En,En.current),it(kr,kr.current)}function Hr(r){ze(kr),rr===r&&(rr=null),ze(En)}var En=le(0);function Ls(r){for(var s=r;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||ma(c)||Kn(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Si=0,Lt=null,Vi=null,ln=null,Yo=!1,ca=!1,Bs=!1,jl=0,ks=0,Os=null,Ih=0;function un(){throw Error(ee(321))}function Na(r,s){if(s===null)return!1;for(var c=0;c<s.length&&c<r.length;c++)if(!Ur(r[c],s[c]))return!1;return!0}function Vl(r,s,c,g,b,M){return Si=M,Lt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,qe.H=r===null||r.memoizedState===null?jn:Fr,Bs=!1,M=c(g,b),Bs=!1,ca&&(M=Uu(s,c,g,b)),Ul(r),M}function Ul(r){qe.H=hn;var s=Vi!==null&&Vi.next!==null;if(Si=0,ln=Vi=Lt=null,Yo=!1,ks=0,Os=null,s)throw Error(ee(300));r===null||Vn||(r=r.dependencies,r!==null&&Ll(r)&&(Vn=!0))}function Uu(r,s,c,g){Lt=r;var b=0;do{if(ca&&(Os=null),ks=0,ca=!1,25<=b)throw Error(ee(301));if(b+=1,ln=Vi=null,r.updateQueue!=null){var M=r.updateQueue;M.lastEffect=null,M.events=null,M.stores=null,M.memoCache!=null&&(M.memoCache.index=0)}qe.H=en,M=s(c,g)}while(ca);return M}function Gu(){var r=qe.H,s=r.useState()[0];return s=typeof s.then=="function"?Wo(s):s,r=r.useState()[0],(Vi!==null?Vi.memoizedState:null)!==r&&(Lt.flags|=1024),s}function qu(){var r=jl!==0;return jl=0,r}function Fs(r,s,c){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~c}function Ns(r){if(Yo){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Yo=!1}Si=0,ln=Vi=Lt=null,ca=!1,ks=jl=0,Os=null}function fr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ln===null?Lt.memoizedState=ln=r:ln=ln.next=r,ln}function Ji(){if(Vi===null){var r=Lt.alternate;r=r!==null?r.memoizedState:null}else r=Vi.next;var s=ln===null?Lt.memoizedState:ln.next;if(s!==null)ln=s,Vi=r;else{if(r===null)throw Lt.alternate===null?Error(ee(467)):Error(ee(310));Vi=r,r={memoizedState:Vi.memoizedState,baseState:Vi.baseState,baseQueue:Vi.baseQueue,queue:Vi.queue,next:null},ln===null?Lt.memoizedState=ln=r:ln=ln.next=r}return ln}function ms(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Wo(r){var s=ks;return ks+=1,Os===null&&(Os=[]),r=Fl(Os,r,s),s=Lt,(ln===null?s.memoizedState:ln.next)===null&&(s=s.alternate,qe.H=s===null||s.memoizedState===null?jn:Fr),r}function Gl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Wo(r);if(r.$$typeof===ut)return In(r)}throw Error(ee(438,String(r)))}function ql(r){var s=null,c=Lt.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var g=Lt.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(s={data:g.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=ms(),Lt.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(r),g=0;g<r;g++)c[g]=hi;return s.index++,c}function ja(r,s){return typeof s=="function"?s(r):s}function m(r){var s=Ji();return t(s,Vi,r)}function t(r,s,c){var g=r.queue;if(g===null)throw Error(ee(311));g.lastRenderedReducer=c;var b=r.baseQueue,M=g.pending;if(M!==null){if(b!==null){var k=b.next;b.next=M.next,M.next=k}s.baseQueue=b=M,g.pending=null}if(M=r.baseState,b===null)r.memoizedState=M;else{s=b.next;var Z=k=null,he=null,Le=s,Xe=!1;do{var st=Le.lane&-536870913;if(st!==Le.lane?(li&st)===st:(Si&st)===st){var Be=Le.revertLane;if(Be===0)he!==null&&(he=he.next={lane:0,revertLane:0,gesture:null,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null}),st===wr&&(Xe=!0);else if((Si&Be)===Be){Le=Le.next,Be===wr&&(Xe=!0);continue}else st={lane:0,revertLane:Le.revertLane,gesture:null,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null},he===null?(Z=he=st,k=M):he=he.next=st,Lt.lanes|=Be,_s|=Be;st=Le.action,Bs&&c(M,st),M=Le.hasEagerState?Le.eagerState:c(M,st)}else Be={lane:st,revertLane:Le.revertLane,gesture:Le.gesture,action:Le.action,hasEagerState:Le.hasEagerState,eagerState:Le.eagerState,next:null},he===null?(Z=he=Be,k=M):he=he.next=Be,Lt.lanes|=st,_s|=st;Le=Le.next}while(Le!==null&&Le!==s);if(he===null?k=M:he.next=Z,!Ur(M,r.memoizedState)&&(Vn=!0,Xe&&(c=Bl,c!==null)))throw c;r.memoizedState=M,r.baseState=k,r.baseQueue=he,g.lastRenderedState=M}return b===null&&(g.lanes=0),[r.memoizedState,g.dispatch]}function a(r){var s=Ji(),c=s.queue;if(c===null)throw Error(ee(311));c.lastRenderedReducer=r;var g=c.dispatch,b=c.pending,M=s.memoizedState;if(b!==null){c.pending=null;var k=b=b.next;do M=r(M,k.action),k=k.next;while(k!==b);Ur(M,s.memoizedState)||(Vn=!0),s.memoizedState=M,s.baseQueue===null&&(s.baseState=M),c.lastRenderedState=M}return[M,g]}function l(r,s,c){var g=Lt,b=Ji(),M=oi;if(M){if(c===void 0)throw Error(ee(407));c=c()}else c=s();var k=!Ur((Vi||b).memoizedState,c);if(k&&(b.memoizedState=c,Vn=!0),b=b.queue,De(v.bind(null,g,b,r),[r]),b.getSnapshot!==s||k||ln!==null&&ln.memoizedState.tag&1){if(g.flags|=2048,te(9,{destroy:void 0},_.bind(null,g,b,c,s),null),nn===null)throw Error(ee(349));M||(Si&127)!==0||h(g,s,c)}return c}function h(r,s,c){r.flags|=16384,r={getSnapshot:s,value:c},s=Lt.updateQueue,s===null?(s=ms(),Lt.updateQueue=s,s.stores=[r]):(c=s.stores,c===null?s.stores=[r]:c.push(r))}function _(r,s,c,g){s.value=c,s.getSnapshot=g,w(s)&&S(r)}function v(r,s,c){return c(function(){w(s)&&S(r)})}function w(r){var s=r.getSnapshot;r=r.value;try{var c=s();return!Ur(r,c)}catch{return!0}}function S(r){var s=wa(r,2);s!==null&&Ca(s,r,2)}function A(r){var s=fr();if(typeof r=="function"){var c=r;if(r=c(),Bs){Me(!0);try{c()}finally{Me(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ja,lastRenderedState:r},s}function z(r,s,c,g){return r.baseState=c,t(r,Vi,typeof g=="function"?g:ja)}function R(r,s,c,g,b){if(Qn(r))throw Error(ee(485));if(r=s.action,r!==null){var M={payload:b,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){M.listeners.push(k)}};qe.T!==null?c(!0):M.isTransition=!1,g(M),c=s.pending,c===null?(M.next=s.pending=M,I(s,M)):(M.next=c.next,s.pending=c.next=M)}}function I(r,s){var c=s.action,g=s.payload,b=r.state;if(s.isTransition){var M=qe.T,k={};qe.T=k;try{var Z=c(b,g),he=qe.S;he!==null&&he(k,Z),F(r,s,Z)}catch(Le){X(r,s,Le)}finally{M!==null&&k.types!==null&&(M.types=k.types),qe.T=M}}else try{M=c(b,g),F(r,s,M)}catch(Le){X(r,s,Le)}}function F(r,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(g){U(r,s,g)},function(g){return X(r,s,g)}):U(r,s,c)}function U(r,s,c){s.status="fulfilled",s.value=c,W(s),r.state=c,s=r.pending,s!==null&&(c=s.next,c===s?r.pending=null:(c=c.next,s.next=c,I(r,c)))}function X(r,s,c){var g=r.pending;if(r.pending=null,g!==null){g=g.next;do s.status="rejected",s.reason=c,W(s),s=s.next;while(s!==g)}r.action=null}function W(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function Y(r,s){return s}function Q(r,s){if(oi){var c=nn.formState;if(c!==null){e:{var g=Lt;if(oi){if(ji){t:{for(var b=ji,M=oa;b.nodeType!==8;){if(!M){b=null;break t}if(b=vs(b.nextSibling),b===null){b=null;break t}}M=b.data,b=M==="F!"||M==="F"?b:null}if(b){ji=vs(b.nextSibling),g=b.data==="F!";break e}}qr(g)}g=!1}g&&(s=c[0])}}return c=fr(),c.memoizedState=c.baseState=s,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Y,lastRenderedState:s},c.queue=g,c=Ko.bind(null,Lt,g),g.dispatch=c,g=A(!1),M=Nn.bind(null,Lt,!1,g.queue),g=fr(),b={state:s,dispatch:null,action:r,pending:null},g.queue=b,c=R.bind(null,Lt,b,M,c),b.dispatch=c,g.memoizedState=r,[s,c,!1]}function ne(r){var s=Ji();return K(s,Vi,r)}function K(r,s,c){if(s=t(r,s,Y)[0],r=m(ja)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var g=Wo(s)}catch(k){throw k===ft?mo:k}else g=s;s=Ji();var b=s.queue,M=b.dispatch;return c!==s.memoizedState&&(Lt.flags|=2048,te(9,{destroy:void 0},se.bind(null,b,c),null)),[g,M,r]}function se(r,s){r.action=s}function ue(r){var s=Ji(),c=Vi;if(c!==null)return K(s,c,r);Ji(),s=s.memoizedState,c=Ji();var g=c.queue.dispatch;return c.memoizedState=r,[s,g,!1]}function te(r,s,c,g){return r={tag:r,create:c,deps:g,inst:s,next:null},s=Lt.updateQueue,s===null&&(s=ms(),Lt.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=r.next=r:(g=c.next,c.next=r,r.next=g,s.lastEffect=r),r}function me(){return Ji().memoizedState}function Ae(r,s,c,g){var b=fr();Lt.flags|=r,b.memoizedState=te(1|s,{destroy:void 0},c,g===void 0?null:g)}function we(r,s,c,g){var b=Ji();g=g===void 0?null:g;var M=b.memoizedState.inst;Vi!==null&&g!==null&&Na(g,Vi.memoizedState.deps)?b.memoizedState=te(s,M,c,g):(Lt.flags|=r,b.memoizedState=te(1|s,M,c,g))}function Ce(r,s){Ae(8390656,8,r,s)}function De(r,s){we(2048,8,r,s)}function Ke(r){Lt.flags|=4;var s=Lt.updateQueue;if(s===null)s=ms(),Lt.updateQueue=s,s.events=[r];else{var c=s.events;c===null?s.events=[r]:c.push(r)}}function lt(r){var s=Ji().memoizedState;return Ke({ref:s,nextImpl:r}),function(){if((Ri&2)!==0)throw Error(ee(440));return s.impl.apply(void 0,arguments)}}function Ye(r,s){return we(4,2,r,s)}function Ct(r,s){return we(4,4,r,s)}function Zt(r,s){if(typeof s=="function"){r=r();var c=s(r);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function wi(r,s,c){c=c!=null?c.concat([r]):null,we(4,4,Zt.bind(null,s,r),c)}function Ui(){}function Mi(r,s){var c=Ji();s=s===void 0?null:s;var g=c.memoizedState;return s!==null&&Na(s,g[1])?g[0]:(c.memoizedState=[r,s],r)}function Yi(r,s){var c=Ji();s=s===void 0?null:s;var g=c.memoizedState;if(s!==null&&Na(s,g[1]))return g[0];if(g=r(),Bs){Me(!0);try{r()}finally{Me(!1)}}return c.memoizedState=[g,s],g}function Ii(r,s,c){return c===void 0||(Si&1073741824)!==0&&(li&261930)===0?r.memoizedState=s:(r.memoizedState=c,r=Xc(),Lt.lanes|=r,_s|=r,c)}function On(r,s,c,g){return Ur(c,s)?c:Br.current!==null?(r=Ii(r,c,g),Ur(r,s)||(Vn=!0),r):(Si&42)===0||(Si&1073741824)!==0&&(li&261930)===0?(Vn=!0,r.memoizedState=c):(r=Xc(),Lt.lanes|=r,_s|=r,s)}function $i(r,s,c,g,b){var M=We.p;We.p=M!==0&&8>M?M:8;var k=qe.T,Z={};qe.T=Z,Nn(r,!1,s,c);try{var he=b(),Le=qe.S;if(Le!==null&&Le(Z,he),he!==null&&typeof he=="object"&&typeof he.then=="function"){var Xe=Lu(he,g);$r(r,s,Xe,Li(r))}else $r(r,s,g,Li(r))}catch(st){$r(r,s,{then:function(){},status:"rejected",reason:st},Li())}finally{We.p=M,k!==null&&Z.types!==null&&(k.types=Z.types),qe.T=k}}function Fn(){}function cn(r,s,c,g){if(r.tag!==5)throw Error(ee(476));var b=yn(r).queue;$i(r,b,s,pt,c===null?Fn:function(){return ar(r),c(g)})}function yn(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:pt,baseState:pt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ja,lastRenderedState:pt},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ja,lastRenderedState:c},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function ar(r){var s=yn(r);s.next===null&&(s=r.alternate.memoizedState),$r(r,s.next.queue,{},Li())}function pr(){return In(fd)}function Va(){return Ji().memoizedState}function js(){return Ji().memoizedState}function Qo(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var c=Li();r=ui(c);var g=Rs(s,r,c);g!==null&&(Ca(g,s,c),yo(g,s,c)),s={cache:fo()},r.payload=s;return}s=s.return}}function Lc(r,s,c){var g=Li();c={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Qn(r)?sr(s,c):(c=so(r,s,c,g),c!==null&&(Ca(c,r,g),ha(c,s,g)))}function Ko(r,s,c){var g=Li();$r(r,s,c,g)}function $r(r,s,c,g){var b={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Qn(r))sr(s,b);else{var M=r.alternate;if(r.lanes===0&&(M===null||M.lanes===0)&&(M=s.lastRenderedReducer,M!==null))try{var k=s.lastRenderedState,Z=M(k,c);if(b.hasEagerState=!0,b.eagerState=Z,Ur(Z,k))return Du(r,s,b,0),nn===null&&Uo(),!1}catch{}finally{}if(c=so(r,s,b,g),c!==null)return Ca(c,r,g),ha(c,s,g),!0}return!1}function Nn(r,s,c,g){if(g={lane:2,revertLane:Kl(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},Qn(r)){if(s)throw Error(ee(479))}else s=so(r,c,g,2),s!==null&&Ca(s,r,2)}function Qn(r){var s=r.alternate;return r===Lt||s!==null&&s===Lt}function sr(r,s){ca=Yo=!0;var c=r.pending;c===null?s.next=s:(s.next=c.next,c.next=s),r.pending=s}function ha(r,s,c){if((c&4194048)!==0){var g=s.lanes;g&=r.pendingLanes,c|=g,s.lanes=c,Dn(r,c)}}var hn={readContext:In,use:Gl,useCallback:un,useContext:un,useEffect:un,useImperativeHandle:un,useLayoutEffect:un,useInsertionEffect:un,useMemo:un,useReducer:un,useRef:un,useState:un,useDebugValue:un,useDeferredValue:un,useTransition:un,useSyncExternalStore:un,useId:un,useHostTransitionStatus:un,useFormState:un,useActionState:un,useOptimistic:un,useMemoCache:un,useCacheRefresh:un};hn.useEffectEvent=un;var jn={readContext:In,use:Gl,useCallback:function(r,s){return fr().memoizedState=[r,s===void 0?null:s],r},useContext:In,useEffect:Ce,useImperativeHandle:function(r,s,c){c=c!=null?c.concat([r]):null,Ae(4194308,4,Zt.bind(null,s,r),c)},useLayoutEffect:function(r,s){return Ae(4194308,4,r,s)},useInsertionEffect:function(r,s){Ae(4,2,r,s)},useMemo:function(r,s){var c=fr();s=s===void 0?null:s;var g=r();if(Bs){Me(!0);try{r()}finally{Me(!1)}}return c.memoizedState=[g,s],g},useReducer:function(r,s,c){var g=fr();if(c!==void 0){var b=c(s);if(Bs){Me(!0);try{c(s)}finally{Me(!1)}}}else b=s;return g.memoizedState=g.baseState=b,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:b},g.queue=r,r=r.dispatch=Lc.bind(null,Lt,r),[g.memoizedState,r]},useRef:function(r){var s=fr();return r={current:r},s.memoizedState=r},useState:function(r){r=A(r);var s=r.queue,c=Ko.bind(null,Lt,s);return s.dispatch=c,[r.memoizedState,c]},useDebugValue:Ui,useDeferredValue:function(r,s){var c=fr();return Ii(c,r,s)},useTransition:function(){var r=A(!1);return r=$i.bind(null,Lt,r.queue,!0,!1),fr().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,c){var g=Lt,b=fr();if(oi){if(c===void 0)throw Error(ee(407));c=c()}else{if(c=s(),nn===null)throw Error(ee(349));(li&127)!==0||h(g,s,c)}b.memoizedState=c;var M={value:c,getSnapshot:s};return b.queue=M,Ce(v.bind(null,g,M,r),[r]),g.flags|=2048,te(9,{destroy:void 0},_.bind(null,g,M,c,s),null),c},useId:function(){var r=fr(),s=nn.identifierPrefix;if(oi){var c=Gr,g=os;c=(g&~(1<<32-Ze(g)-1)).toString(32)+c,s="_"+s+"R_"+c,c=jl++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=Ih++,s="_"+s+"r_"+c.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:pr,useFormState:Q,useActionState:Q,useOptimistic:function(r){var s=fr();s.memoizedState=s.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=Nn.bind(null,Lt,!0,c),c.dispatch=s,[r,s]},useMemoCache:ql,useCacheRefresh:function(){return fr().memoizedState=Qo.bind(null,Lt)},useEffectEvent:function(r){var s=fr(),c={impl:r};return s.memoizedState=c,function(){if((Ri&2)!==0)throw Error(ee(440));return c.impl.apply(void 0,arguments)}}},Fr={readContext:In,use:Gl,useCallback:Mi,useContext:In,useEffect:De,useImperativeHandle:wi,useInsertionEffect:Ye,useLayoutEffect:Ct,useMemo:Yi,useReducer:m,useRef:me,useState:function(){return m(ja)},useDebugValue:Ui,useDeferredValue:function(r,s){var c=Ji();return On(c,Vi.memoizedState,r,s)},useTransition:function(){var r=m(ja)[0],s=Ji().memoizedState;return[typeof r=="boolean"?r:Wo(r),s]},useSyncExternalStore:l,useId:Va,useHostTransitionStatus:pr,useFormState:ne,useActionState:ne,useOptimistic:function(r,s){var c=Ji();return z(c,Vi,r,s)},useMemoCache:ql,useCacheRefresh:js};Fr.useEffectEvent=lt;var en={readContext:In,use:Gl,useCallback:Mi,useContext:In,useEffect:De,useImperativeHandle:wi,useInsertionEffect:Ye,useLayoutEffect:Ct,useMemo:Yi,useReducer:a,useRef:me,useState:function(){return a(ja)},useDebugValue:Ui,useDeferredValue:function(r,s){var c=Ji();return Vi===null?Ii(c,r,s):On(c,Vi.memoizedState,r,s)},useTransition:function(){var r=a(ja)[0],s=Ji().memoizedState;return[typeof r=="boolean"?r:Wo(r),s]},useSyncExternalStore:l,useId:Va,useHostTransitionStatus:pr,useFormState:ue,useActionState:ue,useOptimistic:function(r,s){var c=Ji();return Vi!==null?z(c,Vi,r,s):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:ql,useCacheRefresh:js};en.useEffectEvent=lt;function Rh(r,s,c,g){s=r.memoizedState,c=c(g,s),c=c==null?s:Re({},s,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var Bc={enqueueSetState:function(r,s,c){r=r._reactInternals;var g=Li(),b=ui(g);b.payload=s,c!=null&&(b.callback=c),s=Rs(r,b,g),s!==null&&(Ca(s,r,g),yo(s,r,g))},enqueueReplaceState:function(r,s,c){r=r._reactInternals;var g=Li(),b=ui(g);b.tag=1,b.payload=s,c!=null&&(b.callback=c),s=Rs(r,b,g),s!==null&&(Ca(s,r,g),yo(s,r,g))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var c=Li(),g=ui(c);g.tag=2,s!=null&&(g.callback=s),s=Rs(r,g,c),s!==null&&(Ca(s,r,c),yo(s,r,c))}};function kc(r,s,c,g,b,M,k){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(g,M,k):s.prototype&&s.prototype.isPureReactComponent?!ao(c,g)||!ao(b,M):!0}function Lh(r,s,c,g){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,g),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,g),s.state!==r&&Bc.enqueueReplaceState(s,s.state,null)}function da(r,s){var c=s;if("ref"in s){c={};for(var g in s)g!=="ref"&&(c[g]=s[g])}if(r=r.defaultProps){c===s&&(c=Re({},c));for(var b in r)c[b]===void 0&&(c[b]=r[b])}return c}function bo(r){as(r)}function Vs(r){console.error(r)}function Bh(r){as(r)}function Jo(r,s){try{var c=r.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(g){setTimeout(function(){throw g})}}function Oc(r,s,c){try{var g=r.onCaughtError;g(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function wo(r,s,c){return c=ui(c),c.tag=3,c.payload={element:null},c.callback=function(){Jo(r,s)},c}function Fc(r){return r=ui(r),r.tag=3,r}function Nc(r,s,c,g){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var M=g.value;r.payload=function(){return b(M)},r.callback=function(){Oc(s,c,g)}}var k=c.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(r.callback=function(){Oc(s,c,g),typeof b!="function"&&(Yl===null?Yl=new Set([this]):Yl.add(this));var Z=g.stack;this.componentDidCatch(g.value,{componentStack:Z!==null?Z:""})})}function Bf(r,s,c,g,b){if(c.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(s=c.alternate,s!==null&&Sa(s,c,b,!0),c=kr.current,c!==null){switch(c.tag){case 31:case 13:return rr===null?al():c.alternate===null&&qn===0&&(qn=3),c.flags&=-257,c.flags|=65536,c.lanes=b,g===Ou?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([g]):s.add(g),Jh(r,g,b)),!1;case 22:return c.flags|=65536,g===Ou?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([g])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([g]):c.add(g)),Jh(r,g,b)),!1}throw Error(ee(435,c.tag))}return Jh(r,g,b),al(),!1}if(oi)return s=kr.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,g!==sn&&(r=Error(ee(422),{cause:g}),Cs(Rr(r,c)))):(g!==sn&&(s=Error(ee(423),{cause:g}),Cs(Rr(s,c))),r=r.current.alternate,r.flags|=65536,b&=-b,r.lanes|=b,g=Rr(g,c),b=wo(r.stateNode,g,b),Ho(r,b),qn!==4&&(qn=2)),!1;var M=Error(ee(520),{cause:g});if(M=Rr(M,c),$h===null?$h=[M]:$h.push(M),qn!==4&&(qn=2),s===null)return!0;g=Rr(g,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,r=b&-b,c.lanes|=r,r=wo(c.stateNode,g,r),Ho(c,r),!1;case 1:if(s=c.type,M=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(Yl===null||!Yl.has(M))))return c.flags|=65536,b&=-b,c.lanes|=b,b=Fc(b),Nc(b,r,c,g),Ho(c,b),!1}c=c.return}while(c!==null);return!1}var kf=Error(ee(461)),Vn=!1;function Tr(r,s,c,g){s.child=r===null?Pc(s,null,c,g):ps(s,r.child,c,g)}function Of(r,s,c,g,b){c=c.render;var M=s.ref;if("ref"in g){var k={};for(var Z in g)Z!=="ref"&&(k[Z]=g[Z])}else k=g;return Ps(s),g=Vl(r,s,c,k,M,b),Z=qu(),r!==null&&!Vn?(Fs(r,s,b),Rn(r,s,b)):(oi&&Z&&qo(s),s.flags|=1,Tr(r,s,g,b),s.child)}function Zu(r,s,c,g,b){if(r===null){var M=c.type;return typeof M=="function"&&!wc(M)&&M.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=M,Gp(r,s,M,g,b)):(r=Tc(c.type,null,g,s,s.mode,b),r.ref=s.ref,r.return=s,s.child=r)}if(M=r.child,!qd(r,b)){var k=M.memoizedProps;if(c=c.compare,c=c!==null?c:ao,c(k,g)&&r.ref===s.ref)return Rn(r,s,b)}return s.flags|=1,r=sa(M,g),r.ref=s.ref,r.return=s,s.child=r}function Gp(r,s,c,g,b){if(r!==null){var M=r.memoizedProps;if(ao(M,g)&&r.ref===s.ref)if(Vn=!1,s.pendingProps=g=M,qd(r,b))(r.flags&131072)!==0&&(Vn=!0);else return s.lanes=r.lanes,Rn(r,s,b)}return Ff(r,s,c,g,b)}function Hu(r,s,c,g){var b=g.children,M=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((s.flags&128)!==0){if(M=M!==null?M.baseLanes|c:c,r!==null){for(g=s.child=r.child,b=0;g!==null;)b=b|g.lanes|g.childLanes,g=g.sibling;g=b&~M}else g=0,s.child=null;return kh(r,s,M,c,g)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&po(s,M!==null?M.cachePool:null),M!==null?zt(s,M):Ot(),Ph(s);else return g=s.lanes=536870912,kh(r,s,M!==null?M.baseLanes|c:c,c,g)}else M!==null?(po(s,M.cachePool),zt(s,M),xo(),s.memoizedState=null):(r!==null&&po(s,null),Ot(),xo());return Tr(r,s,b,c),s.child}function Zl(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function kh(r,s,c,g,b){var M=Bu();return M=M===null?null:{parent:on._currentValue,pool:M},s.memoizedState={baseLanes:c,cachePool:M},r!==null&&po(s,null),Ot(),Ph(s),r!==null&&Sa(r,s,g,!0),s.childLanes=b,null}function Fd(r,s){return s=Gd({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function qp(r,s,c){return ps(s,r.child,null,c),r=Fd(s,s.pendingProps),r.flags|=2,Hr(s),s.memoizedState=null,r}function Um(r,s,c){var g=s.pendingProps,b=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(oi){if(g.mode==="hidden")return r=Fd(s,g),s.lanes=536870912,Zl(null,r);if(Or(s),(r=ji)?(r=xp(r,oa),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:ss!==null?{id:os,overflow:Gr}:null,retryLane:536870912,hydrationErrors:null},c=Sc(r),c.return=s,s.child=c,nr=s,ji=null)):r=null,r===null)throw qr(s);return s.lanes=536870912,null}return Fd(s,g)}var M=r.memoizedState;if(M!==null){var k=M.dehydrated;if(Or(s),b)if(s.flags&256)s.flags&=-257,s=qp(r,s,c);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(ee(558));else if(Vn||Sa(r,s,c,!1),b=(c&r.childLanes)!==0,Vn||b){if(g=nn,g!==null&&(k=_l(g,c),k!==0&&k!==M.retryLane))throw M.retryLane=k,wa(r,k),Ca(g,r,k),kf;al(),s=qp(r,s,c)}else r=M.treeContext,ji=vs(k.nextSibling),nr=s,oi=!0,As=null,oa=!1,r!==null&&Eh(s,r),s=Fd(s,g),s.flags|=4096;return s}return r=sa(r.child,{mode:g.mode,children:g.children}),r.ref=s.ref,s.child=r,r.return=s,r}function Nd(r,s){var c=s.ref;if(c===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(ee(284));(r===null||r.ref!==c)&&(s.flags|=4194816)}}function Ff(r,s,c,g,b){return Ps(s),c=Vl(r,s,c,g,void 0,b),g=qu(),r!==null&&!Vn?(Fs(r,s,b),Rn(r,s,b)):(oi&&g&&qo(s),s.flags|=1,Tr(r,s,c,b),s.child)}function Nf(r,s,c,g,b,M){return Ps(s),s.updateQueue=null,c=Uu(s,g,c,b),Ul(r),g=qu(),r!==null&&!Vn?(Fs(r,s,M),Rn(r,s,M)):(oi&&g&&qo(s),s.flags|=1,Tr(r,s,c,M),s.child)}function jd(r,s,c,g,b){if(Ps(s),s.stateNode===null){var M=Kt,k=c.contextType;typeof k=="object"&&k!==null&&(M=In(k)),M=new c(g,M),s.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,M.updater=Bc,s.stateNode=M,M._reactInternals=s,M=s.stateNode,M.props=g,M.state=s.memoizedState,M.refs={},Ic(s),k=c.contextType,M.context=typeof k=="object"&&k!==null?In(k):Kt,M.state=s.memoizedState,k=c.getDerivedStateFromProps,typeof k=="function"&&(Rh(s,c,k,g),M.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(k=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),k!==M.state&&Bc.enqueueReplaceState(M,M.state,null),Nl(s,g,M,b),$o(),M.state=s.memoizedState),typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!0}else if(r===null){M=s.stateNode;var Z=s.memoizedProps,he=da(c,Z);M.props=he;var Le=M.context,Xe=c.contextType;k=Kt,typeof Xe=="object"&&Xe!==null&&(k=In(Xe));var st=c.getDerivedStateFromProps;Xe=typeof st=="function"||typeof M.getSnapshotBeforeUpdate=="function",Z=s.pendingProps!==Z,Xe||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(Z||Le!==k)&&Lh(s,M,g,k),Is=!1;var Be=s.memoizedState;M.state=Be,Nl(s,g,M,b),$o(),Le=s.memoizedState,Z||Be!==Le||Is?(typeof st=="function"&&(Rh(s,c,st,g),Le=s.memoizedState),(he=Is||kc(s,c,he,g,Be,Le,k))?(Xe||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(s.flags|=4194308)):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=g,s.memoizedState=Le),M.props=g,M.state=Le,M.context=k,g=he):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!1)}else{M=s.stateNode,Fa(r,s),k=s.memoizedProps,Xe=da(c,k),M.props=Xe,st=s.pendingProps,Be=M.context,Le=c.contextType,he=Kt,typeof Le=="object"&&Le!==null&&(he=In(Le)),Z=c.getDerivedStateFromProps,(Le=typeof Z=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(k!==st||Be!==he)&&Lh(s,M,g,he),Is=!1,Be=s.memoizedState,M.state=Be,Nl(s,g,M,b),$o();var Ne=s.memoizedState;k!==st||Be!==Ne||Is||r!==null&&r.dependencies!==null&&Ll(r.dependencies)?(typeof Z=="function"&&(Rh(s,c,Z,g),Ne=s.memoizedState),(Xe=Is||kc(s,c,Xe,g,Be,Ne,he)||r!==null&&r.dependencies!==null&&Ll(r.dependencies))?(Le||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(g,Ne,he),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(g,Ne,he)),typeof M.componentDidUpdate=="function"&&(s.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof M.componentDidUpdate!="function"||k===r.memoizedProps&&Be===r.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||k===r.memoizedProps&&Be===r.memoizedState||(s.flags|=1024),s.memoizedProps=g,s.memoizedState=Ne),M.props=g,M.state=Ne,M.context=he,g=Xe):(typeof M.componentDidUpdate!="function"||k===r.memoizedProps&&Be===r.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||k===r.memoizedProps&&Be===r.memoizedState||(s.flags|=1024),g=!1)}return M=g,Nd(r,s),g=(s.flags&128)!==0,M||g?(M=s.stateNode,c=g&&typeof c.getDerivedStateFromError!="function"?null:M.render(),s.flags|=1,r!==null&&g?(s.child=ps(s,r.child,null,b),s.child=ps(s,null,c,b)):Tr(r,s,c,b),s.memoizedState=M.state,r=s.child):r=Rn(r,s,b),r}function jf(r,s,c,g){return us(),s.flags|=256,Tr(r,s,c,g),s.child}var Vd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Vf(r){return{baseLanes:r,cachePool:fs()}}function Uf(r,s,c){return r=r!==null?r.childLanes&~c:0,s&&(r|=Za),r}function Gf(r,s,c){var g=s.pendingProps,b=!1,M=(s.flags&128)!==0,k;if((k=M)||(k=r!==null&&r.memoizedState===null?!1:(En.current&2)!==0),k&&(b=!0,s.flags&=-129),k=(s.flags&32)!==0,s.flags&=-33,r===null){if(oi){if(b?Mn(s):xo(),(r=ji)?(r=xp(r,oa),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:ss!==null?{id:os,overflow:Gr}:null,retryLane:536870912,hydrationErrors:null},c=Sc(r),c.return=s,s.child=c,nr=s,ji=null)):r=null,r===null)throw qr(s);return Kn(r)?s.lanes=32:s.lanes=536870912,null}var Z=g.children;return g=g.fallback,b?(xo(),b=s.mode,Z=Gd({mode:"hidden",children:Z},b),g=oo(g,b,c,null),Z.return=s,g.return=s,Z.sibling=g,s.child=Z,g=s.child,g.memoizedState=Vf(c),g.childLanes=Uf(r,k,c),s.memoizedState=Vd,Zl(null,g)):(Mn(s),Ud(s,Z))}var he=r.memoizedState;if(he!==null&&(Z=he.dehydrated,Z!==null)){if(M)s.flags&256?(Mn(s),s.flags&=-257,s=Oh(r,s,c)):s.memoizedState!==null?(xo(),s.child=r.child,s.flags|=128,s=null):(xo(),Z=g.fallback,b=s.mode,g=Gd({mode:"visible",children:g.children},b),Z=oo(Z,b,c,null),Z.flags|=2,g.return=s,Z.return=s,g.sibling=Z,s.child=g,ps(s,r.child,null,c),g=s.child,g.memoizedState=Vf(c),g.childLanes=Uf(r,k,c),s.memoizedState=Vd,s=Zl(null,g));else if(Mn(s),Kn(Z)){if(k=Z.nextSibling&&Z.nextSibling.dataset,k)var Le=k.dgst;k=Le,g=Error(ee(419)),g.stack="",g.digest=k,Cs({value:g,source:null,stack:null}),s=Oh(r,s,c)}else if(Vn||Sa(r,s,c,!1),k=(c&r.childLanes)!==0,Vn||k){if(k=nn,k!==null&&(g=_l(k,c),g!==0&&g!==he.retryLane))throw he.retryLane=g,wa(r,g),Ca(k,r,g),kf;ma(Z)||al(),s=Oh(r,s,c)}else ma(Z)?(s.flags|=192,s.child=r.child,s=null):(r=he.treeContext,ji=vs(Z.nextSibling),nr=s,oi=!0,As=null,oa=!1,r!==null&&Eh(s,r),s=Ud(s,g.children),s.flags|=4096);return s}return b?(xo(),Z=g.fallback,b=s.mode,he=r.child,Le=he.sibling,g=sa(he,{mode:"hidden",children:g.children}),g.subtreeFlags=he.subtreeFlags&65011712,Le!==null?Z=sa(Le,Z):(Z=oo(Z,b,c,null),Z.flags|=2),Z.return=s,g.return=s,g.sibling=Z,s.child=g,Zl(null,g),g=s.child,Z=r.child.memoizedState,Z===null?Z=Vf(c):(b=Z.cachePool,b!==null?(he=on._currentValue,b=b.parent!==he?{parent:he,pool:he}:b):b=fs(),Z={baseLanes:Z.baseLanes|c,cachePool:b}),g.memoizedState=Z,g.childLanes=Uf(r,k,c),s.memoizedState=Vd,Zl(r.child,g)):(Mn(s),c=r.child,r=c.sibling,c=sa(c,{mode:"visible",children:g.children}),c.return=s,c.sibling=null,r!==null&&(k=s.deletions,k===null?(s.deletions=[r],s.flags|=16):k.push(r)),s.child=c,s.memoizedState=null,c)}function Ud(r,s){return s=Gd({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function Gd(r,s){return r=aa(22,r,null,s),r.lanes=0,r}function Oh(r,s,c){return ps(s,r.child,null,c),r=Ud(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function qf(r,s,c){r.lanes|=s;var g=r.alternate;g!==null&&(g.lanes|=s),Mc(r.return,s,c)}function Fh(r,s,c,g,b,M){var k=r.memoizedState;k===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:g,tail:c,tailMode:b,treeForkCount:M}:(k.isBackwards=s,k.rendering=null,k.renderingStartTime=0,k.last=g,k.tail=c,k.tailMode=b,k.treeForkCount=M)}function jc(r,s,c){var g=s.pendingProps,b=g.revealOrder,M=g.tail;g=g.children;var k=En.current,Z=(k&2)!==0;if(Z?(k=k&1|2,s.flags|=128):k&=1,it(En,k),Tr(r,s,g,c),g=oi?ho:0,!Z&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&qf(r,c,s);else if(r.tag===19)qf(r,c,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(b){case"forwards":for(c=s.child,b=null;c!==null;)r=c.alternate,r!==null&&Ls(r)===null&&(b=c),c=c.sibling;c=b,c===null?(b=s.child,s.child=null):(b=c.sibling,c.sibling=null),Fh(s,!1,b,c,M,g);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=s.child,s.child=null;b!==null;){if(r=b.alternate,r!==null&&Ls(r)===null){s.child=b;break}r=b.sibling,b.sibling=c,c=b,b=r}Fh(s,!0,c,null,M,g);break;case"together":Fh(s,!1,null,null,void 0,g);break;default:s.memoizedState=null}return s.child}function Rn(r,s,c){if(r!==null&&(s.dependencies=r.dependencies),_s|=s.lanes,(c&s.childLanes)===0)if(r!==null){if(Sa(r,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(ee(153));if(s.child!==null){for(r=s.child,c=sa(r,r.pendingProps),s.child=c,c.return=s;r.sibling!==null;)r=r.sibling,c=c.sibling=sa(r,r.pendingProps),c.return=s;c.sibling=null}return s.child}function qd(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&Ll(r)))}function Zf(r,s,c){switch(s.tag){case 3:yi(s,s.stateNode.containerInfo),Ds(s,on,r.memoizedState.cache),us();break;case 27:case 5:Jn(s);break;case 4:yi(s,s.stateNode.containerInfo);break;case 10:Ds(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Or(s),null;break;case 13:var g=s.memoizedState;if(g!==null)return g.dehydrated!==null?(Mn(s),s.flags|=128,null):(c&s.child.childLanes)!==0?Gf(r,s,c):(Mn(s),r=Rn(r,s,c),r!==null?r.sibling:null);Mn(s);break;case 19:var b=(r.flags&128)!==0;if(g=(c&s.childLanes)!==0,g||(Sa(r,s,c,!1),g=(c&s.childLanes)!==0),b){if(g)return jc(r,s,c);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),it(En,En.current),g)break;return null;case 22:return s.lanes=0,Hu(r,s,c,s.pendingProps);case 24:Ds(s,on,r.memoizedState.cache)}return Rn(r,s,c)}function Zp(r,s,c){if(r!==null)if(r.memoizedProps!==s.pendingProps)Vn=!0;else{if(!qd(r,c)&&(s.flags&128)===0)return Vn=!1,Zf(r,s,c);Vn=(r.flags&131072)!==0}else Vn=!1,oi&&(s.flags&1048576)!==0&&Mh(s,ho,s.index);switch(s.lanes=0,s.tag){case 16:e:{var g=s.pendingProps;if(r=ua(s.elementType),s.type=r,typeof r=="function")wc(r)?(g=da(r,g),s.tag=1,s=jd(null,s,r,g,c)):(s.tag=0,s=Ff(null,s,r,g,c));else{if(r!=null){var b=r.$$typeof;if(b===vt){s.tag=11,s=Of(null,s,r,g,c);break e}else if(b===gt){s.tag=14,s=Zu(null,s,r,g,c);break e}}throw s=an(r)||r,Error(ee(306,s,""))}}return s;case 0:return Ff(r,s,s.type,s.pendingProps,c);case 1:return g=s.type,b=da(g,s.pendingProps),jd(r,s,g,b,c);case 3:e:{if(yi(s,s.stateNode.containerInfo),r===null)throw Error(ee(387));g=s.pendingProps;var M=s.memoizedState;b=M.element,Fa(r,s),Nl(s,g,null,c);var k=s.memoizedState;if(g=k.cache,Ds(s,on,g),g!==M.cache&&Ec(s,[on],c,!0),$o(),g=k.element,M.isDehydrated)if(M={element:g,isDehydrated:!1,cache:k.cache},s.updateQueue.baseState=M,s.memoizedState=M,s.flags&256){s=jf(r,s,g,c);break e}else if(g!==b){b=Rr(Error(ee(424)),s),Cs(b),s=jf(r,s,g,c);break e}else{switch(r=s.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(ji=vs(r.firstChild),nr=s,oi=!0,As=null,oa=!0,c=Pc(s,null,g,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(us(),g===b){s=Rn(r,s,c);break e}Tr(r,s,g,c)}s=s.child}return s;case 26:return Nd(r,s),r===null?(c=_f(s.type,null,s.pendingProps,null))?s.memoizedState=c:oi||(c=s.type,r=s.pendingProps,g=ol(kt.current).createElement(c),g[Hi]=s,g[ht]=r,Hn(g,c,r),mn(g),s.stateNode=g):s.memoizedState=_f(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return Jn(s),r===null&&oi&&(g=s.stateNode=xm(s.type,s.pendingProps,kt.current),nr=s,oa=!0,b=ji,xn(s.type)?(mf=b,ji=vs(g.firstChild)):ji=b),Tr(r,s,s.pendingProps.children,c),Nd(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&oi&&((b=g=ji)&&(g=or(g,s.type,s.pendingProps,oa),g!==null?(s.stateNode=g,nr=s,ji=vs(g.firstChild),oa=!1,b=!0):b=!1),b||qr(s)),Jn(s),b=s.type,M=s.pendingProps,k=r!==null?r.memoizedProps:null,g=M.children,ud(b,M)?g=null:k!==null&&ud(b,k)&&(s.flags|=32),s.memoizedState!==null&&(b=Vl(r,s,Gu,null,null,c),fd._currentValue=b),Nd(r,s),Tr(r,s,g,c),s.child;case 6:return r===null&&oi&&((r=c=ji)&&(c=lr(c,s.pendingProps,oa),c!==null?(s.stateNode=c,nr=s,ji=null,r=!0):r=!1),r||qr(s)),null;case 13:return Gf(r,s,c);case 4:return yi(s,s.stateNode.containerInfo),g=s.pendingProps,r===null?s.child=ps(s,null,g,c):Tr(r,s,g,c),s.child;case 11:return Of(r,s,s.type,s.pendingProps,c);case 7:return Tr(r,s,s.pendingProps,c),s.child;case 8:return Tr(r,s,s.pendingProps.children,c),s.child;case 12:return Tr(r,s,s.pendingProps.children,c),s.child;case 10:return g=s.pendingProps,Ds(s,s.type,g.value),Tr(r,s,g.children,c),s.child;case 9:return b=s.type._context,g=s.pendingProps.children,Ps(s),b=In(b),g=g(b),s.flags|=1,Tr(r,s,g,c),s.child;case 14:return Zu(r,s,s.type,s.pendingProps,c);case 15:return Gp(r,s,s.type,s.pendingProps,c);case 19:return jc(r,s,c);case 31:return Um(r,s,c);case 22:return Hu(r,s,c,s.pendingProps);case 24:return Ps(s),g=In(on),r===null?(b=Bu(),b===null&&(b=nn,M=fo(),b.pooledCache=M,M.refCount++,M!==null&&(b.pooledCacheLanes|=c),b=M),s.memoizedState={parent:g,cache:b},Ic(s),Ds(s,on,b)):((r.lanes&c)!==0&&(Fa(r,s),Nl(s,null,null,c),$o()),b=r.memoizedState,M=s.memoizedState,b.parent!==g?(b={parent:g,cache:g},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),Ds(s,on,g)):(g=M.cache,Ds(s,on,g),g!==b.cache&&Ec(s,[on],c,!0))),Tr(r,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(ee(156,s.tag))}function To(r){r.flags|=4}function Hf(r,s,c,g,b){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(b&335544128)===b)if(r.stateNode.complete)r.flags|=8192;else if(lp())r.flags|=8192;else throw Zo=Ou,ku}else r.flags&=-16777217}function Hp(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!Ep(s))if(lp())r.flags|=8192;else throw Zo=Ou,ku}function Nh(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?zi():536870912,r.lanes|=s,Hc|=s)}function jh(r,s){if(!oi)switch(r.tailMode){case"hidden":s=r.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:g.sibling=null}}function tn(r){var s=r.alternate!==null&&r.alternate.child===r.child,c=0,g=0;if(s)for(var b=r.child;b!==null;)c|=b.lanes|b.childLanes,g|=b.subtreeFlags&65011712,g|=b.flags&65011712,b.return=r,b=b.sibling;else for(b=r.child;b!==null;)c|=b.lanes|b.childLanes,g|=b.subtreeFlags,g|=b.flags,b.return=r,b=b.sibling;return r.subtreeFlags|=g,r.childLanes=c,s}function $p(r,s,c){var g=s.pendingProps;switch(Rl(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tn(s),null;case 1:return tn(s),null;case 3:return c=s.stateNode,g=null,r!==null&&(g=r.memoizedState.cache),s.memoizedState.cache!==g&&(s.flags|=2048),ds(on),Ai(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(ls(s)?To(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,cs())),tn(s),null;case 26:var b=s.type,M=s.memoizedState;return r===null?(To(s),M!==null?(tn(s),Hp(s,M)):(tn(s),Hf(s,b,null,g,c))):M?M!==r.memoizedState?(To(s),tn(s),Hp(s,M)):(tn(s),s.flags&=-16777217):(r=r.memoizedProps,r!==g&&To(s),tn(s),Hf(s,b,r,g,c)),null;case 27:if(gr(s),c=kt.current,b=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==g&&To(s);else{if(!g){if(s.stateNode===null)throw Error(ee(166));return tn(s),null}r=Ue.current,ls(s)?la(s):(r=xm(b,g,c),s.stateNode=r,To(s))}return tn(s),null;case 5:if(gr(s),b=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==g&&To(s);else{if(!g){if(s.stateNode===null)throw Error(ee(166));return tn(s),null}if(M=Ue.current,ls(s))la(s);else{var k=ol(kt.current);switch(M){case 1:M=k.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:M=k.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":M=k.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":M=k.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":M=k.createElement("div"),M.innerHTML="<script><\/script>",M=M.removeChild(M.firstChild);break;case"select":M=typeof g.is=="string"?k.createElement("select",{is:g.is}):k.createElement("select"),g.multiple?M.multiple=!0:g.size&&(M.size=g.size);break;default:M=typeof g.is=="string"?k.createElement(b,{is:g.is}):k.createElement(b)}}M[Hi]=s,M[ht]=g;e:for(k=s.child;k!==null;){if(k.tag===5||k.tag===6)M.appendChild(k.stateNode);else if(k.tag!==4&&k.tag!==27&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===s)break e;for(;k.sibling===null;){if(k.return===null||k.return===s)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}s.stateNode=M;e:switch(Hn(M,b,g),b){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&To(s)}}return tn(s),Hf(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,c),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==g&&To(s);else{if(typeof g!="string"&&s.stateNode===null)throw Error(ee(166));if(r=kt.current,ls(s)){if(r=s.stateNode,c=s.memoizedProps,g=null,b=nr,b!==null)switch(b.tag){case 27:case 5:g=b.memoizedProps}r[Hi]=s,r=!!(r.nodeValue===c||g!==null&&g.suppressHydrationWarning===!0||lf(r.nodeValue,c)),r||qr(s,!0)}else r=ol(r).createTextNode(g),r[Hi]=s,s.stateNode=r}return tn(s),null;case 31:if(c=s.memoizedState,r===null||r.memoizedState!==null){if(g=ls(s),c!==null){if(r===null){if(!g)throw Error(ee(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ee(557));r[Hi]=s}else us(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;tn(s),r=!1}else c=cs(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=c),r=!0;if(!r)return s.flags&256?(Hr(s),s):(Hr(s),null);if((s.flags&128)!==0)throw Error(ee(558))}return tn(s),null;case 13:if(g=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(b=ls(s),g!==null&&g.dehydrated!==null){if(r===null){if(!b)throw Error(ee(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(ee(317));b[Hi]=s}else us(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;tn(s),b=!1}else b=cs(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?(Hr(s),s):(Hr(s),null)}return Hr(s),(s.flags&128)!==0?(s.lanes=c,s):(c=g!==null,r=r!==null&&r.memoizedState!==null,c&&(g=s.child,b=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(b=g.alternate.memoizedState.cachePool.pool),M=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(M=g.memoizedState.cachePool.pool),M!==b&&(g.flags|=2048)),c!==r&&c&&(s.child.flags|=8192),Nh(s,s.updateQueue),tn(s),null);case 4:return Ai(),r===null&&sf(s.stateNode.containerInfo),tn(s),null;case 10:return ds(s.type),tn(s),null;case 19:if(ze(En),g=s.memoizedState,g===null)return tn(s),null;if(b=(s.flags&128)!==0,M=g.rendering,M===null)if(b)jh(g,!1);else{if(qn!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(M=Ls(r),M!==null){for(s.flags|=128,jh(g,!1),r=M.updateQueue,s.updateQueue=r,Nh(s,r),s.subtreeFlags=0,r=c,c=s.child;c!==null;)kd(c,r),c=c.sibling;return it(En,En.current&1|2),oi&&Es(s,g.treeForkCount),s.child}r=r.sibling}g.tail!==null&&er()>Xh&&(s.flags|=128,b=!0,jh(g,!1),s.lanes=4194304)}else{if(!b)if(r=Ls(M),r!==null){if(s.flags|=128,b=!0,r=r.updateQueue,s.updateQueue=r,Nh(s,r),jh(g,!0),g.tail===null&&g.tailMode==="hidden"&&!M.alternate&&!oi)return tn(s),null}else 2*er()-g.renderingStartTime>Xh&&c!==536870912&&(s.flags|=128,b=!0,jh(g,!1),s.lanes=4194304);g.isBackwards?(M.sibling=s.child,s.child=M):(r=g.last,r!==null?r.sibling=M:s.child=M,g.last=M)}return g.tail!==null?(r=g.tail,g.rendering=r,g.tail=r.sibling,g.renderingStartTime=er(),r.sibling=null,c=En.current,it(En,b?c&1|2:c&1),oi&&Es(s,g.treeForkCount),r):(tn(s),null);case 22:case 23:return Hr(s),vo(),g=s.memoizedState!==null,r!==null?r.memoizedState!==null!==g&&(s.flags|=8192):g&&(s.flags|=8192),g?(c&536870912)!==0&&(s.flags&128)===0&&(tn(s),s.subtreeFlags&6&&(s.flags|=8192)):tn(s),c=s.updateQueue,c!==null&&Nh(s,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),g=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),g!==c&&(s.flags|=2048),r!==null&&ze(Oa),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),ds(on),tn(s),null;case 25:return null;case 30:return null}throw Error(ee(156,s.tag))}function Xp(r,s){switch(Rl(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return ds(on),Ai(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return gr(s),null;case 31:if(s.memoizedState!==null){if(Hr(s),s.alternate===null)throw Error(ee(340));us()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(Hr(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(ee(340));us()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return ze(En),null;case 4:return Ai(),null;case 10:return ds(s.type),null;case 22:case 23:return Hr(s),vo(),r!==null&&ze(Oa),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return ds(on),null;case 25:return null;default:return null}}function Yp(r,s){switch(Rl(s),s.tag){case 3:ds(on),Ai();break;case 26:case 27:case 5:gr(s);break;case 4:Ai();break;case 31:s.memoizedState!==null&&Hr(s);break;case 13:Hr(s);break;case 19:ze(En);break;case 10:ds(s.type);break;case 22:case 23:Hr(s),vo(),r!==null&&ze(Oa);break;case 24:ds(on)}}function Vh(r,s){try{var c=s.updateQueue,g=c!==null?c.lastEffect:null;if(g!==null){var b=g.next;c=b;do{if((c.tag&r)===r){g=void 0;var M=c.create,k=c.inst;g=M(),k.destroy=g}c=c.next}while(c!==b)}}catch(Z){Bi(s,s.return,Z)}}function Hl(r,s,c){try{var g=s.updateQueue,b=g!==null?g.lastEffect:null;if(b!==null){var M=b.next;g=M;do{if((g.tag&r)===r){var k=g.inst,Z=k.destroy;if(Z!==void 0){k.destroy=void 0,b=s;var he=c,Le=Z;try{Le()}catch(Xe){Bi(b,he,Xe)}}}g=g.next}while(g!==M)}}catch(Xe){Bi(s,s.return,Xe)}}function Uh(r){var s=r.updateQueue;if(s!==null){var c=r.stateNode;try{Dh(s,c)}catch(g){Bi(r,r.return,g)}}}function Zd(r,s,c){c.props=da(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(g){Bi(r,s,g)}}function Vc(r,s){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var g=r.stateNode;break;case 30:g=r.stateNode;break;default:g=r.stateNode}typeof c=="function"?r.refCleanup=c(g):c.current=g}}catch(b){Bi(r,s,b)}}function Xr(r,s){var c=r.ref,g=r.refCleanup;if(c!==null)if(typeof g=="function")try{g()}catch(b){Bi(r,s,b)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){Bi(r,s,b)}else c.current=null}function Uc(r){var s=r.type,c=r.memoizedProps,g=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&g.focus();break e;case"img":c.src?g.src=c.src:c.srcSet&&(g.srcset=c.srcSet)}}catch(b){Bi(r,r.return,b)}}function $f(r,s,c){try{var g=r.stateNode;od(g,r.type,c,s),g[ht]=s}catch(b){Bi(r,r.return,b)}}function Wp(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&xn(r.type)||r.tag===4}function Xf(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Wp(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&xn(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Yf(r,s,c){var g=r.tag;if(g===5||g===6)r=r.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(r),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=Ba));else if(g!==4&&(g===27&&xn(r.type)&&(c=r.stateNode,s=null),r=r.child,r!==null))for(Yf(r,s,c),r=r.sibling;r!==null;)Yf(r,s,c),r=r.sibling}function Hd(r,s,c){var g=r.tag;if(g===5||g===6)r=r.stateNode,s?c.insertBefore(r,s):c.appendChild(r);else if(g!==4&&(g===27&&xn(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(Hd(r,s,c),r=r.sibling;r!==null;)Hd(r,s,c),r=r.sibling}function Qp(r){var s=r.stateNode,c=r.memoizedProps;try{for(var g=r.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);Hn(s,g,c),s[Hi]=r,s[ht]=c}catch(M){Bi(r,r.return,M)}}var el=!1,Un=!1,Wf=!1,Qf=typeof WeakSet=="function"?WeakSet:Set,Gn=null;function Gm(r,s){if(r=r.containerInfo,uf=oh,r=gc(r),Su(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var g=c.getSelection&&c.getSelection();if(g&&g.rangeCount!==0){c=g.anchorNode;var b=g.anchorOffset,M=g.focusNode;g=g.focusOffset;try{c.nodeType,M.nodeType}catch{c=null;break e}var k=0,Z=-1,he=-1,Le=0,Xe=0,st=r,Be=null;t:for(;;){for(var Ne;st!==c||b!==0&&st.nodeType!==3||(Z=k+b),st!==M||g!==0&&st.nodeType!==3||(he=k+g),st.nodeType===3&&(k+=st.nodeValue.length),(Ne=st.firstChild)!==null;)Be=st,st=Ne;for(;;){if(st===r)break t;if(Be===c&&++Le===b&&(Z=k),Be===M&&++Xe===g&&(he=k),(Ne=st.nextSibling)!==null)break;st=Be,Be=st.parentNode}st=Ne}c=Z===-1||he===-1?null:{start:Z,end:he}}else c=null}c=c||{start:0,end:0}}else c=null;for(cf={focusedElem:r,selectionRange:c},oh=!1,Gn=s;Gn!==null;)if(s=Gn,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,Gn=r;else for(;Gn!==null;){switch(s=Gn,M=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(c=0;c<r.length;c++)b=r[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&M!==null){r=void 0,c=s,b=M.memoizedProps,M=M.memoizedState,g=c.stateNode;try{var It=da(c.type,b);r=g.getSnapshotBeforeUpdate(It,M),g.__reactInternalSnapshotBeforeUpdate=r}catch(qt){Bi(c,c.return,qt)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,c=r.nodeType,c===9)Yr(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Yr(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(ee(163))}if(r=s.sibling,r!==null){r.return=s.return,Gn=r;break}Gn=s.return}}function An(r,s,c){var g=c.flags;switch(c.tag){case 0:case 11:case 15:So(r,c),g&4&&Vh(5,c);break;case 1:if(So(r,c),g&4)if(r=c.stateNode,s===null)try{r.componentDidMount()}catch(k){Bi(c,c.return,k)}else{var b=da(c.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(b,s,r.__reactInternalSnapshotBeforeUpdate)}catch(k){Bi(c,c.return,k)}}g&64&&Uh(c),g&512&&Vc(c,c.return);break;case 3:if(So(r,c),g&64&&(r=c.updateQueue,r!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{Dh(r,s)}catch(k){Bi(c,c.return,k)}}break;case 27:s===null&&g&4&&Qp(c);case 26:case 5:So(r,c),s===null&&g&4&&Uc(c),g&512&&Vc(c,c.return);break;case 12:So(r,c);break;case 31:So(r,c),g&4&&Kf(r,c);break;case 13:So(r,c),g&4&&Jf(r,c),g&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=Wm.bind(null,c),pf(r,c))));break;case 22:if(g=c.memoizedState!==null||el,!g){s=s!==null&&s.memoizedState!==null||Un,b=el;var M=Un;el=g,(Un=s)&&!M?tl(r,c,(c.subtreeFlags&8772)!==0):So(r,c),el=b,Un=M}break;case 30:break;default:So(r,c)}}function $u(r){var s=r.alternate;s!==null&&(r.alternate=null,$u(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&Co(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var vn=null,Nr=!1;function gs(r,s,c){for(c=c.child;c!==null;)Gc(r,s,c),c=c.sibling}function Gc(r,s,c){if(fe&&typeof fe.onCommitFiberUnmount=="function")try{fe.onCommitFiberUnmount(ye,c)}catch{}switch(c.tag){case 26:Un||Xr(c,s),gs(r,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Un||Xr(c,s);var g=vn,b=Nr;xn(c.type)&&(vn=c.stateNode,Nr=!1),gs(r,s,c),eh(c.stateNode),vn=g,Nr=b;break;case 5:Un||Xr(c,s);case 6:if(g=vn,b=Nr,vn=null,gs(r,s,c),vn=g,Nr=b,vn!==null)if(Nr)try{(vn.nodeType===9?vn.body:vn.nodeName==="HTML"?vn.ownerDocument.body:vn).removeChild(c.stateNode)}catch(M){Bi(c,s,M)}else try{vn.removeChild(c.stateNode)}catch(M){Bi(c,s,M)}break;case 18:vn!==null&&(Nr?(r=vn,ys(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),ch(r)):ys(vn,c.stateNode));break;case 4:g=vn,b=Nr,vn=c.stateNode.containerInfo,Nr=!0,gs(r,s,c),vn=g,Nr=b;break;case 0:case 11:case 14:case 15:Hl(2,c,s),Un||Hl(4,c,s),gs(r,s,c);break;case 1:Un||(Xr(c,s),g=c.stateNode,typeof g.componentWillUnmount=="function"&&Zd(c,s,g)),gs(r,s,c);break;case 21:gs(r,s,c);break;case 22:Un=(g=Un)||c.memoizedState!==null,gs(r,s,c),Un=g;break;default:gs(r,s,c)}}function Kf(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{ch(r)}catch(c){Bi(s,s.return,c)}}}function Jf(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{ch(r)}catch(c){Bi(s,s.return,c)}}function Gh(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new Qf),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new Qf),s;default:throw Error(ee(435,r.tag))}}function qc(r,s){var c=Gh(r);s.forEach(function(g){if(!c.has(g)){c.add(g);var b=Qm.bind(null,r,g);g.then(b,b)}})}function mr(r,s){var c=s.deletions;if(c!==null)for(var g=0;g<c.length;g++){var b=c[g],M=r,k=s,Z=k;e:for(;Z!==null;){switch(Z.tag){case 27:if(xn(Z.type)){vn=Z.stateNode,Nr=!1;break e}break;case 5:vn=Z.stateNode,Nr=!1;break e;case 3:case 4:vn=Z.stateNode.containerInfo,Nr=!0;break e}Z=Z.return}if(vn===null)throw Error(ee(160));Gc(M,k,b),vn=null,Nr=!1,M=b.alternate,M!==null&&(M.return=null),b.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Xu(s,r),s=s.sibling}var Ea=null;function Xu(r,s){var c=r.alternate,g=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:mr(s,r),Sr(r),g&4&&(Hl(3,r,r.return),Vh(3,r),Hl(5,r,r.return));break;case 1:mr(s,r),Sr(r),g&512&&(Un||c===null||Xr(c,c.return)),g&64&&el&&(r=r.updateQueue,r!==null&&(g=r.callbacks,g!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?g:c.concat(g))));break;case 26:var b=Ea;if(mr(s,r),Sr(r),g&512&&(Un||c===null||Xr(c,c.return)),g&4){var M=c!==null?c.memoizedState:null;if(g=r.memoizedState,c===null)if(g===null)if(r.stateNode===null){e:{g=r.type,c=r.memoizedProps,b=b.ownerDocument||b;t:switch(g){case"title":M=b.getElementsByTagName("title")[0],(!M||M[$t]||M[Hi]||M.namespaceURI==="http://www.w3.org/2000/svg"||M.hasAttribute("itemprop"))&&(M=b.createElement(g),b.head.insertBefore(M,b.querySelector("head > title"))),Hn(M,g,c),M[Hi]=r,mn(M),g=M;break e;case"link":var k=yf("link","href",b).get(g+(c.href||""));if(k){for(var Z=0;Z<k.length;Z++)if(M=k[Z],M.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&M.getAttribute("rel")===(c.rel==null?null:c.rel)&&M.getAttribute("title")===(c.title==null?null:c.title)&&M.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){k.splice(Z,1);break t}}M=b.createElement(g),Hn(M,g,c),b.head.appendChild(M);break;case"meta":if(k=yf("meta","content",b).get(g+(c.content||""))){for(Z=0;Z<k.length;Z++)if(M=k[Z],M.getAttribute("content")===(c.content==null?null:""+c.content)&&M.getAttribute("name")===(c.name==null?null:c.name)&&M.getAttribute("property")===(c.property==null?null:c.property)&&M.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&M.getAttribute("charset")===(c.charSet==null?null:c.charSet)){k.splice(Z,1);break t}}M=b.createElement(g),Hn(M,g,c),b.head.appendChild(M);break;default:throw Error(ee(468,g))}M[Hi]=r,mn(M),g=M}r.stateNode=g}else vf(b,r.type,r.stateNode);else r.stateNode=Mm(b,g,r.memoizedProps);else M!==g?(M===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):M.count--,g===null?vf(b,r.type,r.stateNode):Mm(b,g,r.memoizedProps)):g===null&&r.stateNode!==null&&$f(r,r.memoizedProps,c.memoizedProps)}break;case 27:mr(s,r),Sr(r),g&512&&(Un||c===null||Xr(c,c.return)),c!==null&&g&4&&$f(r,r.memoizedProps,c.memoizedProps);break;case 5:if(mr(s,r),Sr(r),g&512&&(Un||c===null||Xr(c,c.return)),r.flags&32){b=r.stateNode;try{Ss(b,"")}catch(It){Bi(r,r.return,It)}}g&4&&r.stateNode!=null&&(b=r.memoizedProps,$f(r,b,c!==null?c.memoizedProps:b)),g&1024&&(Wf=!0);break;case 6:if(mr(s,r),Sr(r),g&4){if(r.stateNode===null)throw Error(ee(162));g=r.memoizedProps,c=r.stateNode;try{c.nodeValue=g}catch(It){Bi(r,r.return,It)}}break;case 3:if(tc=null,b=Ea,Ea=th(s.containerInfo),mr(s,r),Ea=b,Sr(r),g&4&&c!==null&&c.memoizedState.isDehydrated)try{ch(s.containerInfo)}catch(It){Bi(r,r.return,It)}Wf&&(Wf=!1,Kp(r));break;case 4:g=Ea,Ea=th(r.stateNode.containerInfo),mr(s,r),Sr(r),Ea=g;break;case 12:mr(s,r),Sr(r);break;case 31:mr(s,r),Sr(r),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,qc(r,g)));break;case 13:mr(s,r),Sr(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&($c=er()),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,qc(r,g)));break;case 22:b=r.memoizedState!==null;var he=c!==null&&c.memoizedState!==null,Le=el,Xe=Un;if(el=Le||b,Un=Xe||he,mr(s,r),Un=Xe,el=Le,Sr(r),g&8192)e:for(s=r.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(c===null||he||el||Un||Ua(r)),c=null,s=r;;){if(s.tag===5||s.tag===26){if(c===null){he=c=s;try{if(M=he.stateNode,b)k=M.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{Z=he.stateNode;var st=he.memoizedProps.style,Be=st!=null&&st.hasOwnProperty("display")?st.display:null;Z.style.display=Be==null||typeof Be=="boolean"?"":(""+Be).trim()}}catch(It){Bi(he,he.return,It)}}}else if(s.tag===6){if(c===null){he=s;try{he.stateNode.nodeValue=b?"":he.memoizedProps}catch(It){Bi(he,he.return,It)}}}else if(s.tag===18){if(c===null){he=s;try{var Ne=he.stateNode;b?Jl(Ne,!0):Jl(he.stateNode,!1)}catch(It){Bi(he,he.return,It)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}g&4&&(g=r.updateQueue,g!==null&&(c=g.retryQueue,c!==null&&(g.retryQueue=null,qc(r,c))));break;case 19:mr(s,r),Sr(r),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,qc(r,g)));break;case 30:break;case 21:break;default:mr(s,r),Sr(r)}}function Sr(r){var s=r.flags;if(s&2){try{for(var c,g=r.return;g!==null;){if(Wp(g)){c=g;break}g=g.return}if(c==null)throw Error(ee(160));switch(c.tag){case 27:var b=c.stateNode,M=Xf(r);Hd(r,M,b);break;case 5:var k=c.stateNode;c.flags&32&&(Ss(k,""),c.flags&=-33);var Z=Xf(r);Hd(r,Z,k);break;case 3:case 4:var he=c.stateNode.containerInfo,Le=Xf(r);Yf(r,Le,he);break;default:throw Error(ee(161))}}catch(Xe){Bi(r,r.return,Xe)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function Kp(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;Kp(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function So(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)An(r,s.alternate,s),s=s.sibling}function Ua(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:Hl(4,s,s.return),Ua(s);break;case 1:Xr(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&Zd(s,s.return,c),Ua(s);break;case 27:eh(s.stateNode);case 26:case 5:Xr(s,s.return),Ua(s);break;case 22:s.memoizedState===null&&Ua(s);break;case 30:Ua(s);break;default:Ua(s)}r=r.sibling}}function tl(r,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var g=s.alternate,b=r,M=s,k=M.flags;switch(M.tag){case 0:case 11:case 15:tl(b,M,c),Vh(4,M);break;case 1:if(tl(b,M,c),g=M,b=g.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Le){Bi(g,g.return,Le)}if(g=M,b=g.updateQueue,b!==null){var Z=g.stateNode;try{var he=b.shared.hiddenCallbacks;if(he!==null)for(b.shared.hiddenCallbacks=null,b=0;b<he.length;b++)Rc(he[b],Z)}catch(Le){Bi(g,g.return,Le)}}c&&k&64&&Uh(M),Vc(M,M.return);break;case 27:Qp(M);case 26:case 5:tl(b,M,c),c&&g===null&&k&4&&Uc(M),Vc(M,M.return);break;case 12:tl(b,M,c);break;case 31:tl(b,M,c),c&&k&4&&Kf(b,M);break;case 13:tl(b,M,c),c&&k&4&&Jf(b,M);break;case 22:M.memoizedState===null&&tl(b,M,c),Vc(M,M.return);break;case 30:break;default:tl(b,M,c)}s=s.sibling}}function $d(r,s){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&br(c))}function Yu(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&br(r))}function Ga(r,s,c,g){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)ep(r,s,c,g),s=s.sibling}function ep(r,s,c,g){var b=s.flags;switch(s.tag){case 0:case 11:case 15:Ga(r,s,c,g),b&2048&&Vh(9,s);break;case 1:Ga(r,s,c,g);break;case 3:Ga(r,s,c,g),b&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&br(r)));break;case 12:if(b&2048){Ga(r,s,c,g),r=s.stateNode;try{var M=s.memoizedProps,k=M.id,Z=M.onPostCommit;typeof Z=="function"&&Z(k,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(he){Bi(s,s.return,he)}}else Ga(r,s,c,g);break;case 31:Ga(r,s,c,g);break;case 13:Ga(r,s,c,g);break;case 23:break;case 22:M=s.stateNode,k=s.alternate,s.memoizedState!==null?M._visibility&2?Ga(r,s,c,g):qh(r,s):M._visibility&2?Ga(r,s,c,g):(M._visibility|=2,Wu(r,s,c,g,(s.subtreeFlags&10256)!==0||!1)),b&2048&&$d(k,s);break;case 24:Ga(r,s,c,g),b&2048&&Yu(s.alternate,s);break;default:Ga(r,s,c,g)}}function Wu(r,s,c,g,b){for(b=b&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var M=r,k=s,Z=c,he=g,Le=k.flags;switch(k.tag){case 0:case 11:case 15:Wu(M,k,Z,he,b),Vh(8,k);break;case 23:break;case 22:var Xe=k.stateNode;k.memoizedState!==null?Xe._visibility&2?Wu(M,k,Z,he,b):qh(M,k):(Xe._visibility|=2,Wu(M,k,Z,he,b)),b&&Le&2048&&$d(k.alternate,k);break;case 24:Wu(M,k,Z,he,b),b&&Le&2048&&Yu(k.alternate,k);break;default:Wu(M,k,Z,he,b)}s=s.sibling}}function qh(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=r,g=s,b=g.flags;switch(g.tag){case 22:qh(c,g),b&2048&&$d(g.alternate,g);break;case 24:qh(c,g),b&2048&&Yu(g.alternate,g);break;default:qh(c,g)}s=s.sibling}}var Zh=8192;function Zc(r,s,c){if(r.subtreeFlags&Zh)for(r=r.child;r!==null;)Jp(r,s,c),r=r.sibling}function Jp(r,s,c){switch(r.tag){case 26:Zc(r,s,c),r.flags&Zh&&r.memoizedState!==null&&Em(c,Ea,r.memoizedState,r.memoizedProps);break;case 5:Zc(r,s,c);break;case 3:case 4:var g=Ea;Ea=th(r.stateNode.containerInfo),Zc(r,s,c),Ea=g;break;case 22:r.memoizedState===null&&(g=r.alternate,g!==null&&g.memoizedState!==null?(g=Zh,Zh=16777216,Zc(r,s,c),Zh=g):Zc(r,s,c));break;default:Zc(r,s,c)}}function em(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function il(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];Gn=g,im(g,r)}em(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)tm(r),r=r.sibling}function tm(r){switch(r.tag){case 0:case 11:case 15:il(r),r.flags&2048&&Hl(9,r,r.return);break;case 3:il(r);break;case 12:il(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,Hh(r)):il(r);break;default:il(r)}}function Hh(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];Gn=g,im(g,r)}em(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:Hl(8,s,s.return),Hh(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,Hh(s));break;default:Hh(s)}r=r.sibling}}function im(r,s){for(;Gn!==null;){var c=Gn;switch(c.tag){case 0:case 11:case 15:Hl(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var g=c.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:br(c.memoizedState.cache)}if(g=c.child,g!==null)g.return=c,Gn=g;else e:for(c=r;Gn!==null;){g=Gn;var b=g.sibling,M=g.return;if($u(g),g===c){Gn=null;break e}if(b!==null){b.return=M,Gn=b;break e}Gn=M}}}var qm={getCacheForType:function(r){var s=In(on),c=s.data.get(r);return c===void 0&&(c=r(),s.data.set(r,c)),c},cacheSignal:function(){return In(on).controller.signal}},Zm=typeof WeakMap=="function"?WeakMap:Map,Ri=0,nn=null,ci=null,li=0,Gi=0,qa=null,$l=!1,Qu=!1,Xd=!1,nl=0,qn=0,_s=0,Xl=0,tp=0,Za=0,Hc=0,$h=null,Aa=null,Yd=!1,$c=0,ip=0,Xh=1/0,Yh=null,Yl=null,Zn=0,Wl=null,Ku=null,rl=0,np=0,rp=null,ap=null,Wh=0,sp=null;function Li(){return(Ri&2)!==0&&li!==0?li&-li:qe.T!==null?Kl():yr()}function Xc(){if(Za===0)if((li&536870912)===0||oi){var r=Ti;Ti<<=1,(Ti&3932160)===0&&(Ti=262144),Za=r}else Za=536870912;return r=kr.current,r!==null&&(r.flags|=32),Za}function Ca(r,s,c){(r===nn&&(Gi===2||Gi===9)||r.cancelPendingCommit!==null)&&(Us(r,0),Ql(r,li,Za,!1)),Di(r,c),((Ri&2)===0||r!==nn)&&(r===nn&&((Ri&2)===0&&(Xl|=c),qn===4&&Ql(r,li,Za,!1)),qs(r))}function nm(r,s,c){if((Ri&6)!==0)throw Error(ee(327));var g=!c&&(s&127)===0&&(s&r.expiredLanes)===0||zn(r,s),b=g?$m(r,s):Kd(r,s,!0),M=g;do{if(b===0){Qu&&!g&&Ql(r,s,0,!1);break}else{if(c=r.current.alternate,M&&!rm(c)){b=Kd(r,s,!1),M=!1;continue}if(b===2){if(M=s,r.errorRecoveryDisabledLanes&M)var k=0;else k=r.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){s=k;e:{var Z=r;b=$h;var he=Z.current.memoizedState.isDehydrated;if(he&&(Us(Z,k).flags|=256),k=Kd(Z,k,!1),k!==2){if(Xd&&!he){Z.errorRecoveryDisabledLanes|=M,Xl|=M,b=4;break e}M=Aa,Aa=b,M!==null&&(Aa===null?Aa=M:Aa.push.apply(Aa,M))}b=k}if(M=!1,b!==2)continue}}if(b===1){Us(r,0),Ql(r,s,0,!0);break}e:{switch(g=r,M=b,M){case 0:case 1:throw Error(ee(345));case 4:if((s&4194048)!==s)break;case 6:Ql(g,s,Za,!$l);break e;case 2:Aa=null;break;case 3:case 5:break;default:throw Error(ee(329))}if((s&62914560)===s&&(b=$c+300-er(),10<b)){if(Ql(g,s,Za,!$l),Ci(g,0,!0)!==0)break e;rl=s,g.timeoutHandle=ff(op.bind(null,g,c,Aa,Yh,Yd,s,Za,Xl,Hc,$l,M,"Throttled",-0,0),b);break e}op(g,c,Aa,Yh,Yd,s,Za,Xl,Hc,$l,M,null,-0,0)}}break}while(!0);qs(r)}function op(r,s,c,g,b,M,k,Z,he,Le,Xe,st,Be,Ne){if(r.timeoutHandle=-1,st=s.subtreeFlags,st&8192||(st&16785408)===16785408){st={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ba},Jp(s,M,st);var It=(M&62914560)===M?$c-er():(M&4194048)===M?ip-er():0;if(It=Am(st,It),It!==null){rl=M,r.cancelPendingCommit=It(lm.bind(null,r,s,M,c,g,b,k,Z,he,Xe,st,null,Be,Ne)),Ql(r,M,k,!Le);return}}lm(r,s,M,c,g,b,k,Z,he)}function rm(r){for(var s=r;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var g=0;g<c.length;g++){var b=c[g],M=b.getSnapshot;b=b.value;try{if(!Ur(M(),b))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ql(r,s,c,g){s&=~tp,s&=~Xl,r.suspendedLanes|=s,r.pingedLanes&=~s,g&&(r.warmLanes|=s),g=r.expirationTimes;for(var b=s;0<b;){var M=31-Ze(b),k=1<<M;g[M]=-1,b&=~k}c!==0&&Fi(r,c,s)}function Qh(){return(Ri&6)===0?(Ju(0),!1):!0}function Wd(){if(ci!==null){if(Gi===0)var r=ci.return;else r=ci,hs=Ta=null,Ns(r),Ma=null,Fu=0,r=ci;for(;r!==null;)Yp(r.alternate,r),r=r.return;ci=null}}function Us(r,s){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,ig(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),rl=0,Wd(),nn=r,ci=c=sa(r.current,null),li=s,Gi=0,qa=null,$l=!1,Qu=zn(r,s),Xd=!1,Hc=Za=tp=Xl=_s=qn=0,Aa=$h=null,Yd=!1,(s&8)!==0&&(s|=s&32);var g=r.entangledLanes;if(g!==0)for(r=r.entanglements,g&=s;0<g;){var b=31-Ze(g),M=1<<b;s|=r[b],g&=~M}return nl=s,Uo(),c}function Qd(r,s){Lt=null,qe.H=hn,s===ft||s===mo?(s=zc(),Gi=3):s===ku?(s=zc(),Gi=4):Gi=s===kf?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,qa=s,ci===null&&(qn=1,Jo(r,Rr(s,r.current)))}function lp(){var r=kr.current;return r===null?!0:(li&4194048)===li?rr===null:(li&62914560)===li||(li&536870912)!==0?r===rr:!1}function up(){var r=qe.H;return qe.H=hn,r===null?hn:r}function Kh(){var r=qe.A;return qe.A=qm,r}function al(){qn=4,$l||(li&4194048)!==li&&kr.current!==null||(Qu=!0),(_s&134217727)===0&&(Xl&134217727)===0||nn===null||Ql(nn,li,Za,!1)}function Kd(r,s,c){var g=Ri;Ri|=2;var b=up(),M=Kh();(nn!==r||li!==s)&&(Yh=null,Us(r,s)),s=!1;var k=qn;e:do try{if(Gi!==0&&ci!==null){var Z=ci,he=qa;switch(Gi){case 8:Wd(),k=6;break e;case 3:case 2:case 9:case 6:kr.current===null&&(s=!0);var Le=Gi;if(Gi=0,qa=null,Yc(r,Z,he,Le),c&&Qu){k=0;break e}break;default:Le=Gi,Gi=0,qa=null,Yc(r,Z,he,Le)}}Hm(),k=qn;break}catch(Xe){Qd(r,Xe)}while(!0);return s&&r.shellSuspendCounter++,hs=Ta=null,Ri=g,qe.H=b,qe.A=M,ci===null&&(nn=null,li=0,Uo()),k}function Hm(){for(;ci!==null;)am(ci)}function $m(r,s){var c=Ri;Ri|=2;var g=up(),b=Kh();nn!==r||li!==s?(Yh=null,Xh=er()+500,Us(r,s)):Qu=zn(r,s);e:do try{if(Gi!==0&&ci!==null){s=ci;var M=qa;t:switch(Gi){case 1:Gi=0,qa=null,Yc(r,s,M,1);break;case 2:case 9:if(go(M)){Gi=0,qa=null,sm(s);break}s=function(){Gi!==2&&Gi!==9||nn!==r||(Gi=7),qs(r)},M.then(s,s);break e;case 3:Gi=7;break e;case 4:Gi=5;break e;case 7:go(M)?(Gi=0,qa=null,sm(s)):(Gi=0,qa=null,Yc(r,s,M,7));break;case 5:var k=null;switch(ci.tag){case 26:k=ci.memoizedState;case 5:case 27:var Z=ci;if(k?Ep(k):Z.stateNode.complete){Gi=0,qa=null;var he=Z.sibling;if(he!==null)ci=he;else{var Le=Z.return;Le!==null?(ci=Le,Jd(Le)):ci=null}break t}}Gi=0,qa=null,Yc(r,s,M,5);break;case 6:Gi=0,qa=null,Yc(r,s,M,6);break;case 8:Wd(),qn=6;break e;default:throw Error(ee(462))}}Xm();break}catch(Xe){Qd(r,Xe)}while(!0);return hs=Ta=null,qe.H=g,qe.A=b,Ri=c,ci!==null?0:(nn=null,li=0,Uo(),qn)}function Xm(){for(;ci!==null&&!Ia();)am(ci)}function am(r){var s=Zp(r.alternate,r,nl);r.memoizedProps=r.pendingProps,s===null?Jd(r):ci=s}function sm(r){var s=r,c=s.alternate;switch(s.tag){case 15:case 0:s=Nf(c,s,s.pendingProps,s.type,void 0,li);break;case 11:s=Nf(c,s,s.pendingProps,s.type.render,s.ref,li);break;case 5:Ns(s);default:Yp(c,s),s=ci=kd(s,nl),s=Zp(c,s,nl)}r.memoizedProps=r.pendingProps,s===null?Jd(r):ci=s}function Yc(r,s,c,g){hs=Ta=null,Ns(s),Ma=null,Fu=0;var b=s.return;try{if(Bf(r,b,s,c,li)){qn=1,Jo(r,Rr(c,r.current)),ci=null;return}}catch(M){if(b!==null)throw ci=b,M;qn=1,Jo(r,Rr(c,r.current)),ci=null;return}s.flags&32768?(oi||g===1?r=!0:Qu||(li&536870912)!==0?r=!1:($l=r=!0,(g===2||g===9||g===3||g===6)&&(g=kr.current,g!==null&&g.tag===13&&(g.flags|=16384))),om(s,r)):Jd(s)}function Jd(r){var s=r;do{if((s.flags&32768)!==0){om(s,$l);return}r=s.return;var c=$p(s.alternate,s,nl);if(c!==null){ci=c;return}if(s=s.sibling,s!==null){ci=s;return}ci=s=r}while(s!==null);qn===0&&(qn=5)}function om(r,s){do{var c=Xp(r.alternate,r);if(c!==null){c.flags&=32767,ci=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(r=r.sibling,r!==null)){ci=r;return}ci=r=c}while(r!==null);qn=6,ci=null}function lm(r,s,c,g,b,M,k,Z,he){r.cancelPendingCommit=null;do Wc();while(Zn!==0);if((Ri&6)!==0)throw Error(ee(327));if(s!==null){if(s===r.current)throw Error(ee(177));if(M=s.lanes|s.childLanes,M|=Vo,Tn(r,c,M,k,Z,he),r===nn&&(ci=nn=null,li=0),Ku=s,Wl=r,rl=c,np=M,rp=b,ap=g,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,Km(j,function(){return hp(),null})):(r.callbackNode=null,r.callbackPriority=0),g=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||g){g=qe.T,qe.T=null,b=We.p,We.p=2,k=Ri,Ri|=4;try{Gm(r,s,c)}finally{Ri=k,We.p=b,qe.T=g}}Zn=1,um(),cm(),hm()}}function um(){if(Zn===1){Zn=0;var r=Wl,s=Ku,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=qe.T,qe.T=null;var g=We.p;We.p=2;var b=Ri;Ri|=4;try{Xu(s,r);var M=cf,k=gc(r.containerInfo),Z=M.focusedElem,he=M.selectionRange;if(k!==Z&&Z&&Z.ownerDocument&&mc(Z.ownerDocument.documentElement,Z)){if(he!==null&&Su(Z)){var Le=he.start,Xe=he.end;if(Xe===void 0&&(Xe=Le),"selectionStart"in Z)Z.selectionStart=Le,Z.selectionEnd=Math.min(Xe,Z.value.length);else{var st=Z.ownerDocument||document,Be=st&&st.defaultView||window;if(Be.getSelection){var Ne=Be.getSelection(),It=Z.textContent.length,qt=Math.min(he.start,It),qi=he.end===void 0?qt:Math.min(he.end,It);!Ne.extend&&qt>qi&&(k=qi,qi=qt,qt=k);var ve=Tu(Z,qt),ge=Tu(Z,qi);if(ve&&ge&&(Ne.rangeCount!==1||Ne.anchorNode!==ve.node||Ne.anchorOffset!==ve.offset||Ne.focusNode!==ge.node||Ne.focusOffset!==ge.offset)){var Ie=st.createRange();Ie.setStart(ve.node,ve.offset),Ne.removeAllRanges(),qt>qi?(Ne.addRange(Ie),Ne.extend(ge.node,ge.offset)):(Ie.setEnd(ge.node,ge.offset),Ne.addRange(Ie))}}}}for(st=[],Ne=Z;Ne=Ne.parentNode;)Ne.nodeType===1&&st.push({element:Ne,left:Ne.scrollLeft,top:Ne.scrollTop});for(typeof Z.focus=="function"&&Z.focus(),Z=0;Z<st.length;Z++){var Qe=st[Z];Qe.element.scrollLeft=Qe.left,Qe.element.scrollTop=Qe.top}}oh=!!uf,cf=uf=null}finally{Ri=b,We.p=g,qe.T=c}}r.current=s,Zn=2}}function cm(){if(Zn===2){Zn=0;var r=Wl,s=Ku,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=qe.T,qe.T=null;var g=We.p;We.p=2;var b=Ri;Ri|=4;try{An(r,s.alternate,s)}finally{Ri=b,We.p=g,qe.T=c}}Zn=3}}function hm(){if(Zn===4||Zn===3){Zn=0,gl();var r=Wl,s=Ku,c=rl,g=ap;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Zn=5:(Zn=0,Ku=Wl=null,cp(r,r.pendingLanes));var b=r.pendingLanes;if(b===0&&(Yl=null),ot(c),s=s.stateNode,fe&&typeof fe.onCommitFiberRoot=="function")try{fe.onCommitFiberRoot(ye,s,void 0,(s.current.flags&128)===128)}catch{}if(g!==null){s=qe.T,b=We.p,We.p=2,qe.T=null;try{for(var M=r.onRecoverableError,k=0;k<g.length;k++){var Z=g[k];M(Z.value,{componentStack:Z.stack})}}finally{qe.T=s,We.p=b}}(rl&3)!==0&&Wc(),qs(r),b=r.pendingLanes,(c&261930)!==0&&(b&42)!==0?r===sp?Wh++:(Wh=0,sp=r):Wh=0,Ju(0)}}function cp(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,br(s)))}function Wc(){return um(),cm(),hm(),hp()}function hp(){if(Zn!==5)return!1;var r=Wl,s=np;np=0;var c=ot(rl),g=qe.T,b=We.p;try{We.p=32>c?32:c,qe.T=null,c=rp,rp=null;var M=Wl,k=rl;if(Zn=0,Ku=Wl=null,rl=0,(Ri&6)!==0)throw Error(ee(331));var Z=Ri;if(Ri|=4,tm(M.current),ep(M,M.current,k,c),Ri=Z,Ju(0,!1),fe&&typeof fe.onPostCommitFiberRoot=="function")try{fe.onPostCommitFiberRoot(ye,M)}catch{}return!0}finally{We.p=b,qe.T=g,cp(r,s)}}function sl(r,s,c){s=Rr(c,s),s=wo(r.stateNode,s,2),r=Rs(r,s,2),r!==null&&(Di(r,2),qs(r))}function Bi(r,s,c){if(r.tag===3)sl(r,r,c);else for(;s!==null;){if(s.tag===3){sl(s,r,c);break}else if(s.tag===1){var g=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Yl===null||!Yl.has(g))){r=Rr(c,r),c=Fc(2),g=Rs(s,c,2),g!==null&&(Nc(c,g,s,r),Di(g,2),qs(g));break}}s=s.return}}function Jh(r,s,c){var g=r.pingCache;if(g===null){g=r.pingCache=new Zm;var b=new Set;g.set(s,b)}else b=g.get(s),b===void 0&&(b=new Set,g.set(s,b));b.has(c)||(Xd=!0,b.add(c),r=Ym.bind(null,r,s,c),s.then(r,r))}function Ym(r,s,c){var g=r.pingCache;g!==null&&g.delete(s),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,nn===r&&(li&c)===c&&(qn===4||qn===3&&(li&62914560)===li&&300>er()-$c?(Ri&2)===0&&Us(r,0):tp|=c,Hc===li&&(Hc=0)),qs(r)}function dp(r,s){s===0&&(s=zi()),r=wa(r,s),r!==null&&(Di(r,s),qs(r))}function Wm(r){var s=r.memoizedState,c=0;s!==null&&(c=s.retryLane),dp(r,c)}function Qm(r,s){var c=0;switch(r.tag){case 31:case 13:var g=r.stateNode,b=r.memoizedState;b!==null&&(c=b.retryLane);break;case 19:g=r.stateNode;break;case 22:g=r.stateNode._retryCache;break;default:throw Error(ee(314))}g!==null&&g.delete(s),dp(r,c)}function Km(r,s){return Xs(r,s)}var ef=null,Qc=null,tf=!1,ed=!1,Gs=!1,fa=0;function qs(r){r!==Qc&&r.next===null&&(Qc===null?ef=Qc=r:Qc=Qc.next=r),ed=!0,tf||(tf=!0,fp())}function Ju(r,s){if(!Gs&&ed){Gs=!0;do for(var c=!1,g=ef;g!==null;){if(r!==0){var b=g.pendingLanes;if(b===0)var M=0;else{var k=g.suspendedLanes,Z=g.pingedLanes;M=(1<<31-Ze(42|r)+1)-1,M&=b&~(k&~Z),M=M&201326741?M&201326741|1:M?M|2:0}M!==0&&(c=!0,rf(g,M))}else M=li,M=Ci(g,g===nn?M:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(M&3)===0||zn(g,M)||(c=!0,rf(g,M));g=g.next}while(c);Gs=!1}}function Jm(){td()}function td(){ed=tf=!1;var r=0;fa!==0&&vp()&&(r=fa);for(var s=er(),c=null,g=ef;g!==null;){var b=g.next,M=nf(g,s);M===0?(g.next=null,c===null?ef=b:c.next=b,b===null&&(Qc=c)):(c=g,(r!==0||(M&3)!==0)&&(ed=!0)),g=b}Zn!==0&&Zn!==5||Ju(r),fa!==0&&(fa=0)}function nf(r,s){for(var c=r.suspendedLanes,g=r.pingedLanes,b=r.expirationTimes,M=r.pendingLanes&-62914561;0<M;){var k=31-Ze(M),Z=1<<k,he=b[k];he===-1?((Z&c)===0||(Z&g)!==0)&&(b[k]=Ht(Z,s)):he<=s&&(r.expiredLanes|=Z),M&=~Z}if(s=nn,c=li,c=Ci(r,r===s?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),g=r.callbackNode,c===0||r===s&&(Gi===2||Gi===9)||r.cancelPendingCommit!==null)return g!==null&&g!==null&&Wa(g),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||zn(r,c)){if(s=c&-c,s===r.callbackPriority)return s;switch(g!==null&&Wa(g),ot(c)){case 2:case 8:c=V;break;case 32:c=j;break;case 268435456:c=oe;break;default:c=j}return g=dm.bind(null,r),c=Xs(c,g),r.callbackPriority=s,r.callbackNode=c,s}return g!==null&&g!==null&&Wa(g),r.callbackPriority=2,r.callbackNode=null,2}function dm(r,s){if(Zn!==0&&Zn!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(Wc()&&r.callbackNode!==c)return null;var g=li;return g=Ci(r,r===nn?g:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),g===0?null:(nm(r,g,s),nf(r,er()),r.callbackNode!=null&&r.callbackNode===c?dm.bind(null,r):null)}function rf(r,s){if(Wc())return null;nm(r,s,!0)}function fp(){ii(function(){(Ri&6)!==0?Xs(xe,Jm):td()})}function Kl(){if(fa===0){var r=wr;r===0&&(r=Gt,Gt<<=1,(Gt&261888)===0&&(Gt=256)),fa=r}return fa}function pp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Wt(""+r)}function mp(r,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,r.id&&c.setAttribute("form",r.id),s.parentNode.insertBefore(c,s),r=new FormData(r),c.parentNode.removeChild(c),r}function gp(r,s,c,g,b){if(s==="submit"&&c&&c.stateNode===b){var M=pp((b[ht]||null).action),k=g.submitter;k&&(s=(s=k[ht]||null)?pp(s.formAction):k.getAttribute("formAction"),s!==null&&(M=s,k=null));var Z=new du("action","action",null,g,b);r.push({event:Z,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(fa!==0){var he=k?mp(b,k):new FormData(b);cn(c,{pending:!0,data:he,method:b.method,action:M},null,he)}}else typeof M=="function"&&(Z.preventDefault(),he=k?mp(b,k):new FormData(b),cn(c,{pending:!0,data:he,method:b.method,action:M},M,he))},currentTarget:b}]})}}for(var af=0;af<xc.length;af++){var Kc=xc[af],fm=Kc.toLowerCase(),eg=Kc[0].toUpperCase()+Kc.slice(1);ra(fm,"on"+eg)}ra(Au,"onAnimationEnd"),ra(Cu,"onAnimationIteration"),ra(vc,"onAnimationStart"),ra("dblclick","onDoubleClick"),ra("focusin","onFocus"),ra("focusout","onBlur"),ra(jo,"onTransitionRun"),ra(zu,"onTransitionStart"),ra(Pl,"onTransitionCancel"),ra(na,"onTransitionEnd"),Ts("onMouseEnter",["mouseout","mouseover"]),Ts("onMouseLeave",["mouseout","mouseover"]),Ts("onPointerEnter",["pointerout","pointerover"]),Ts("onPointerLeave",["pointerout","pointerover"]),pi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),pi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),pi("onBeforeInput",["compositionend","keypress","textInput","paste"]),pi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),pi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),pi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var id="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),tg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(id));function pm(r,s){s=(s&4)!==0;for(var c=0;c<r.length;c++){var g=r[c],b=g.event;g=g.listeners;e:{var M=void 0;if(s)for(var k=g.length-1;0<=k;k--){var Z=g[k],he=Z.instance,Le=Z.currentTarget;if(Z=Z.listener,he!==M&&b.isPropagationStopped())break e;M=Z,b.currentTarget=Le;try{M(b)}catch(Xe){as(Xe)}b.currentTarget=null,M=he}else for(k=0;k<g.length;k++){if(Z=g[k],he=Z.instance,Le=Z.currentTarget,Z=Z.listener,he!==M&&b.isPropagationStopped())break e;M=Z,b.currentTarget=Le;try{M(b)}catch(Xe){as(Xe)}b.currentTarget=null,M=he}}}}function _i(r,s){var c=s[Qt];c===void 0&&(c=s[Qt]=new Set);var g=r+"__bubble";c.has(g)||(_p(s,r,2,!1),c.add(g))}function nd(r,s,c){var g=0;s&&(g|=4),_p(c,r,g,s)}var Zs="_reactListening"+Math.random().toString(36).slice(2);function sf(r){if(!r[Zs]){r[Zs]=!0,yl.forEach(function(c){c!=="selectionchange"&&(tg.has(c)||nd(c,!1,r),nd(c,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Zs]||(s[Zs]=!0,nd("selectionchange",!1,s))}}function _p(r,s,c,g){switch(Im(s)){case 2:var b=Pp;break;case 8:b=Pm;break;default:b=nu}c=b.bind(null,s,c,r),b=void 0,!Cr||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),g?b!==void 0?r.addEventListener(s,c,{capture:!0,passive:b}):r.addEventListener(s,c,!0):b!==void 0?r.addEventListener(s,c,{passive:b}):r.addEventListener(s,c,!1)}function of(r,s,c,g,b){var M=g;if((s&1)===0&&(s&2)===0&&g!==null)e:for(;;){if(g===null)return;var k=g.tag;if(k===3||k===4){var Z=g.stateNode.containerInfo;if(Z===b)break;if(k===4)for(k=g.return;k!==null;){var he=k.tag;if((he===3||he===4)&&k.stateNode.containerInfo===b)return;k=k.return}for(;Z!==null;){if(k=Ka(Z),k===null)return;if(he=k.tag,he===5||he===6||he===26||he===27){g=M=k;continue e}Z=Z.parentNode}}g=g.return}Ni(function(){var Le=M,Xe=hu(c),st=[];e:{var Be=wh.get(r);if(Be!==void 0){var Ne=du,It=r;switch(r){case"keypress":if(ia(c)===0)break e;case"keydown":case"keyup":Ne=_n;break;case"focusin":It="focus",Ne=eo;break;case"focusout":It="blur",Ne=eo;break;case"beforeblur":case"afterblur":Ne=eo;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ne=Bo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ne=fu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ne=Rf;break;case Au:case Cu:case vc:Ne=Sd;break;case na:Ne=hc;break;case"scroll":case"scrollend":Ne=Lo;break;case"wheel":Ne=_h;break;case"copy":case"cut":case"paste":Ne=mh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ne=cc;break;case"toggle":case"beforetoggle":Ne=Ml}var qt=(s&4)!==0,qi=!qt&&(r==="scroll"||r==="scrollend"),ve=qt?Be!==null?Be+"Capture":null:Be;qt=[];for(var ge=Le,Ie;ge!==null;){var Qe=ge;if(Ie=Qe.stateNode,Qe=Qe.tag,Qe!==5&&Qe!==26&&Qe!==27||Ie===null||ve===null||(Qe=ya(ge,ve),Qe!=null&&qt.push(Jc(ge,Qe,Ie))),qi)break;ge=ge.return}0<qt.length&&(Be=new Ne(Be,It,null,c,Xe),st.push({event:Be,listeners:qt}))}}if((s&7)===0){e:{if(Be=r==="mouseover"||r==="pointerover",Ne=r==="mouseout"||r==="pointerout",Be&&c!==ph&&(It=c.relatedTarget||c.fromElement)&&(Ka(It)||It[Xt]))break e;if((Ne||Be)&&(Be=Xe.window===Xe?Xe:(Be=Xe.ownerDocument)?Be.defaultView||Be.parentWindow:window,Ne?(It=c.relatedTarget||c.toElement,Ne=Le,It=It?Ka(It):null,It!==null&&(qi=tt(It),qt=It.tag,It!==qi||qt!==5&&qt!==27&&qt!==6)&&(It=null)):(Ne=null,It=Le),Ne!==It)){if(qt=Bo,Qe="onMouseLeave",ve="onMouseEnter",ge="mouse",(r==="pointerout"||r==="pointerover")&&(qt=cc,Qe="onPointerLeave",ve="onPointerEnter",ge="pointer"),qi=Ne==null?Be:Ja(Ne),Ie=It==null?Be:Ja(It),Be=new qt(Qe,ge+"leave",Ne,c,Xe),Be.target=qi,Be.relatedTarget=Ie,Qe=null,Ka(Xe)===Le&&(qt=new qt(ve,ge+"enter",It,c,Xe),qt.target=Ie,qt.relatedTarget=qi,Qe=qt),qi=Qe,Ne&&It)t:{for(qt=mm,ve=Ne,ge=It,Ie=0,Qe=ve;Qe;Qe=qt(Qe))Ie++;Qe=0;for(var Dt=ge;Dt;Dt=qt(Dt))Qe++;for(;0<Ie-Qe;)ve=qt(ve),Ie--;for(;0<Qe-Ie;)ge=qt(ge),Qe--;for(;Ie--;){if(ve===ge||ge!==null&&ve===ge.alternate){qt=ve;break t}ve=qt(ve),ge=qt(ge)}qt=null}else qt=null;Ne!==null&&ad(st,Be,Ne,qt,!1),It!==null&&qi!==null&&ad(st,qi,It,qt,!0)}}e:{if(Be=Le?Ja(Le):window,Ne=Be.nodeName&&Be.nodeName.toLowerCase(),Ne==="select"||Ne==="input"&&Be.type==="file")var Ei=no;else if(fc(Be))if(yh)Ei=Ld;else{Ei=Rd;var Ft=Lf}else Ne=Be.nodeName,!Ne||Ne.toLowerCase()!=="input"||Be.type!=="checkbox"&&Be.type!=="radio"?Le&&Po(Le.elementType)&&(Ei=no):Ei=wu;if(Ei&&(Ei=Ei(r,Le))){pc(st,Ei,c,Xe);break e}Ft&&Ft(r,Be,Le),r==="focusout"&&Le&&Be.type==="number"&&Le.memoizedProps.value!=null&&cu(Be,"number",Be.value)}switch(Ft=Le?Ja(Le):window,r){case"focusin":(fc(Ft)||Ft.contentEditable==="true")&&(ba=Ft,Mu=Le,Eu=null);break;case"focusout":Eu=Mu=ba=null;break;case"mousedown":yc=!0;break;case"contextmenu":case"mouseup":case"dragend":yc=!1,Bd(st,c,Xe);break;case"selectionchange":if(_c)break;case"keydown":case"keyup":Bd(st,c,Xe)}var ni;if(Sn)e:{switch(r){case"compositionstart":var gi="onCompositionStart";break e;case"compositionend":gi="onCompositionEnd";break e;case"compositionupdate":gi="onCompositionUpdate";break e}gi=void 0}else ka?yu(r,c)&&(gi="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(gi="onCompositionStart");gi&&(zl&&c.locale!=="ko"&&(ka||gi!=="onCompositionStart"?gi==="onCompositionEnd"&&ka&&(ni=Ks()):(ta=Xe,is="value"in ta?ta.value:ta.textContent,ka=!0)),Ft=rd(Le,gi),0<Ft.length&&(gi=new gh(gi,r,null,c,Xe),st.push({event:gi,listeners:Ft}),ni?gi.data=ni:(ni=Cd(c),ni!==null&&(gi.data=ni)))),(ni=Cl?dc(r,c):zd(r,c))&&(gi=rd(Le,"onBeforeInput"),0<gi.length&&(Ft=new gh("onBeforeInput","beforeinput",null,c,Xe),st.push({event:Ft,listeners:gi}),Ft.data=ni)),gp(st,r,Le,c,Xe)}pm(st,s)})}function Jc(r,s,c){return{instance:r,listener:s,currentTarget:c}}function rd(r,s){for(var c=s+"Capture",g=[];r!==null;){var b=r,M=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||M===null||(b=ya(r,c),b!=null&&g.unshift(Jc(r,b,M)),b=ya(r,s),b!=null&&g.push(Jc(r,b,M))),r.tag===3)return g;r=r.return}return[]}function mm(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function ad(r,s,c,g,b){for(var M=s._reactName,k=[];c!==null&&c!==g;){var Z=c,he=Z.alternate,Le=Z.stateNode;if(Z=Z.tag,he!==null&&he===g)break;Z!==5&&Z!==26&&Z!==27||Le===null||(he=Le,b?(Le=ya(c,M),Le!=null&&k.unshift(Jc(c,Le,he))):b||(Le=ya(c,M),Le!=null&&k.push(Jc(c,Le,he)))),c=c.return}k.length!==0&&r.push({event:s,listeners:k})}var gm=/\r\n?/g,sd=/\u0000|\uFFFD/g;function yp(r){return(typeof r=="string"?r:""+r).replace(gm,`
`).replace(sd,"")}function lf(r,s){return s=yp(s),yp(r)===s}function Xi(r,s,c,g,b,M){switch(c){case"children":typeof g=="string"?s==="body"||s==="textarea"&&g===""||Ss(r,g):(typeof g=="number"||typeof g=="bigint")&&s!=="body"&&Ss(r,""+g);break;case"className":ts(r,"class",g);break;case"tabIndex":ts(r,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":ts(r,c,g);break;case"style":uc(r,g,M);break;case"data":if(s!=="object"){ts(r,"data",g);break}case"src":case"href":if(g===""&&(s!=="a"||c!=="href")){r.removeAttribute(c);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){r.removeAttribute(c);break}g=Wt(""+g),r.setAttribute(c,g);break;case"action":case"formAction":if(typeof g=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof M=="function"&&(c==="formAction"?(s!=="input"&&Xi(r,s,"name",b.name,b,null),Xi(r,s,"formEncType",b.formEncType,b,null),Xi(r,s,"formMethod",b.formMethod,b,null),Xi(r,s,"formTarget",b.formTarget,b,null)):(Xi(r,s,"encType",b.encType,b,null),Xi(r,s,"method",b.method,b,null),Xi(r,s,"target",b.target,b,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){r.removeAttribute(c);break}g=Wt(""+g),r.setAttribute(c,g);break;case"onClick":g!=null&&(r.onclick=Ba);break;case"onScroll":g!=null&&_i("scroll",r);break;case"onScrollEnd":g!=null&&_i("scrollend",r);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(ee(61));if(c=g.__html,c!=null){if(b.children!=null)throw Error(ee(60));r.innerHTML=c}}break;case"multiple":r.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":r.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){r.removeAttribute("xlink:href");break}c=Wt(""+g),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,""+g):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":g===!0?r.setAttribute(c,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,g):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?r.setAttribute(c,g):r.removeAttribute(c);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?r.removeAttribute(c):r.setAttribute(c,g);break;case"popover":_i("beforetoggle",r),_i("toggle",r),ou(r,"popover",g);break;case"xlinkActuate":_a(r,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":_a(r,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":_a(r,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":_a(r,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":_a(r,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":_a(r,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":_a(r,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":_a(r,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":_a(r,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":ou(r,"is",g);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Qs.get(c)||c,ou(r,c,g))}}function pa(r,s,c,g,b,M){switch(c){case"style":uc(r,g,M);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(ee(61));if(c=g.__html,c!=null){if(b.children!=null)throw Error(ee(60));r.innerHTML=c}}break;case"children":typeof g=="string"?Ss(r,g):(typeof g=="number"||typeof g=="bigint")&&Ss(r,""+g);break;case"onScroll":g!=null&&_i("scroll",r);break;case"onScrollEnd":g!=null&&_i("scrollend",r);break;case"onClick":g!=null&&(r.onclick=Ba);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!xr.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),s=c.slice(2,b?c.length-7:void 0),M=r[ht]||null,M=M!=null?M[c]:null,typeof M=="function"&&r.removeEventListener(s,M,b),typeof g=="function")){typeof M!="function"&&M!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(s,g,b);break e}c in r?r[c]=g:g===!0?r.setAttribute(c,""):ou(r,c,g)}}}function Hn(r,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":_i("error",r),_i("load",r);var g=!1,b=!1,M;for(M in c)if(c.hasOwnProperty(M)){var k=c[M];if(k!=null)switch(M){case"src":g=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(ee(137,s));default:Xi(r,s,M,k,c,null)}}b&&Xi(r,s,"srcSet",c.srcSet,c,null),g&&Xi(r,s,"src",c.src,c,null);return;case"input":_i("invalid",r);var Z=M=k=b=null,he=null,Le=null;for(g in c)if(c.hasOwnProperty(g)){var Xe=c[g];if(Xe!=null)switch(g){case"name":b=Xe;break;case"type":k=Xe;break;case"checked":he=Xe;break;case"defaultChecked":Le=Xe;break;case"value":M=Xe;break;case"defaultValue":Z=Xe;break;case"children":case"dangerouslySetInnerHTML":if(Xe!=null)throw Error(ee(137,s));break;default:Xi(r,s,g,Xe,c,null)}}lc(r,M,Z,he,Le,k,b,!1);return;case"select":_i("invalid",r),g=k=M=null;for(b in c)if(c.hasOwnProperty(b)&&(Z=c[b],Z!=null))switch(b){case"value":M=Z;break;case"defaultValue":k=Z;break;case"multiple":g=Z;default:Xi(r,s,b,Z,c,null)}s=M,c=k,r.multiple=!!g,s!=null?Ws(r,!!g,s,!1):c!=null&&Ws(r,!!g,c,!0);return;case"textarea":_i("invalid",r),M=b=g=null;for(k in c)if(c.hasOwnProperty(k)&&(Z=c[k],Z!=null))switch(k){case"value":g=Z;break;case"defaultValue":b=Z;break;case"children":M=Z;break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(ee(91));break;default:Xi(r,s,k,Z,c,null)}bl(r,g,b,M);return;case"option":for(he in c)if(c.hasOwnProperty(he)&&(g=c[he],g!=null))switch(he){case"selected":r.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:Xi(r,s,he,g,c,null)}return;case"dialog":_i("beforetoggle",r),_i("toggle",r),_i("cancel",r),_i("close",r);break;case"iframe":case"object":_i("load",r);break;case"video":case"audio":for(g=0;g<id.length;g++)_i(id[g],r);break;case"image":_i("error",r),_i("load",r);break;case"details":_i("toggle",r);break;case"embed":case"source":case"link":_i("error",r),_i("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Le in c)if(c.hasOwnProperty(Le)&&(g=c[Le],g!=null))switch(Le){case"children":case"dangerouslySetInnerHTML":throw Error(ee(137,s));default:Xi(r,s,Le,g,c,null)}return;default:if(Po(s)){for(Xe in c)c.hasOwnProperty(Xe)&&(g=c[Xe],g!==void 0&&pa(r,s,Xe,g,c,void 0));return}}for(Z in c)c.hasOwnProperty(Z)&&(g=c[Z],g!=null&&Xi(r,s,Z,g,c,null))}function od(r,s,c,g){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,M=null,k=null,Z=null,he=null,Le=null,Xe=null;for(Ne in c){var st=c[Ne];if(c.hasOwnProperty(Ne)&&st!=null)switch(Ne){case"checked":break;case"value":break;case"defaultValue":he=st;default:g.hasOwnProperty(Ne)||Xi(r,s,Ne,null,g,st)}}for(var Be in g){var Ne=g[Be];if(st=c[Be],g.hasOwnProperty(Be)&&(Ne!=null||st!=null))switch(Be){case"type":M=Ne;break;case"name":b=Ne;break;case"checked":Le=Ne;break;case"defaultChecked":Xe=Ne;break;case"value":k=Ne;break;case"defaultValue":Z=Ne;break;case"children":case"dangerouslySetInnerHTML":if(Ne!=null)throw Error(ee(137,s));break;default:Ne!==st&&Xi(r,s,Be,Ne,g,st)}}uu(r,k,Z,he,Le,Xe,M,b);return;case"select":Ne=k=Z=Be=null;for(M in c)if(he=c[M],c.hasOwnProperty(M)&&he!=null)switch(M){case"value":break;case"multiple":Ne=he;default:g.hasOwnProperty(M)||Xi(r,s,M,null,g,he)}for(b in g)if(M=g[b],he=c[b],g.hasOwnProperty(b)&&(M!=null||he!=null))switch(b){case"value":Be=M;break;case"defaultValue":Z=M;break;case"multiple":k=M;default:M!==he&&Xi(r,s,b,M,g,he)}s=Z,c=k,g=Ne,Be!=null?Ws(r,!!c,Be,!1):!!g!=!!c&&(s!=null?Ws(r,!!c,s,!0):Ws(r,!!c,c?[]:"",!1));return;case"textarea":Ne=Be=null;for(Z in c)if(b=c[Z],c.hasOwnProperty(Z)&&b!=null&&!g.hasOwnProperty(Z))switch(Z){case"value":break;case"children":break;default:Xi(r,s,Z,null,g,b)}for(k in g)if(b=g[k],M=c[k],g.hasOwnProperty(k)&&(b!=null||M!=null))switch(k){case"value":Be=b;break;case"defaultValue":Ne=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(ee(91));break;default:b!==M&&Xi(r,s,k,b,g,M)}wd(r,Be,Ne);return;case"option":for(var It in c)if(Be=c[It],c.hasOwnProperty(It)&&Be!=null&&!g.hasOwnProperty(It))switch(It){case"selected":r.selected=!1;break;default:Xi(r,s,It,null,g,Be)}for(he in g)if(Be=g[he],Ne=c[he],g.hasOwnProperty(he)&&Be!==Ne&&(Be!=null||Ne!=null))switch(he){case"selected":r.selected=Be&&typeof Be!="function"&&typeof Be!="symbol";break;default:Xi(r,s,he,Be,g,Ne)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var qt in c)Be=c[qt],c.hasOwnProperty(qt)&&Be!=null&&!g.hasOwnProperty(qt)&&Xi(r,s,qt,null,g,Be);for(Le in g)if(Be=g[Le],Ne=c[Le],g.hasOwnProperty(Le)&&Be!==Ne&&(Be!=null||Ne!=null))switch(Le){case"children":case"dangerouslySetInnerHTML":if(Be!=null)throw Error(ee(137,s));break;default:Xi(r,s,Le,Be,g,Ne)}return;default:if(Po(s)){for(var qi in c)Be=c[qi],c.hasOwnProperty(qi)&&Be!==void 0&&!g.hasOwnProperty(qi)&&pa(r,s,qi,void 0,g,Be);for(Xe in g)Be=g[Xe],Ne=c[Xe],!g.hasOwnProperty(Xe)||Be===Ne||Be===void 0&&Ne===void 0||pa(r,s,Xe,Be,g,Ne);return}}for(var ve in c)Be=c[ve],c.hasOwnProperty(ve)&&Be!=null&&!g.hasOwnProperty(ve)&&Xi(r,s,ve,null,g,Be);for(st in g)Be=g[st],Ne=c[st],!g.hasOwnProperty(st)||Be===Ne||Be==null&&Ne==null||Xi(r,s,st,Be,g,Ne)}function _m(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ym(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,c=performance.getEntriesByType("resource"),g=0;g<c.length;g++){var b=c[g],M=b.transferSize,k=b.initiatorType,Z=b.duration;if(M&&Z&&_m(k)){for(k=0,Z=b.responseEnd,g+=1;g<c.length;g++){var he=c[g],Le=he.startTime;if(Le>Z)break;var Xe=he.transferSize,st=he.initiatorType;Xe&&_m(st)&&(he=he.responseEnd,k+=Xe*(he<Z?1:(Z-Le)/(he-Le)))}if(--g,s+=8*(M+k)/(b.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var uf=null,cf=null;function ol(r){return r.nodeType===9?r:r.ownerDocument}function ld(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function hf(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function ud(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var df=null;function vp(){var r=window.event;return r&&r.type==="popstate"?r===df?!1:(df=r,!0):(df=null,!1)}var ff=typeof setTimeout=="function"?setTimeout:void 0,ig=typeof clearTimeout=="function"?clearTimeout:void 0,vm=typeof Promise=="function"?Promise:void 0,ii=typeof queueMicrotask=="function"?queueMicrotask:typeof vm<"u"?function(r){return vm.resolve(null).then(r).catch(ll)}:ff;function ll(r){setTimeout(function(){throw r})}function xn(r){return r==="head"}function ys(r,s){var c=s,g=0;do{var b=c.nextSibling;if(r.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(g===0){r.removeChild(b),ch(s);return}g--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")g++;else if(c==="html")eh(r.ownerDocument.documentElement);else if(c==="head"){c=r.ownerDocument.head,eh(c);for(var M=c.firstChild;M;){var k=M.nextSibling,Z=M.nodeName;M[$t]||Z==="SCRIPT"||Z==="STYLE"||Z==="LINK"&&M.rel.toLowerCase()==="stylesheet"||c.removeChild(M),M=k}}else c==="body"&&eh(r.ownerDocument.body);c=b}while(c);ch(s)}function Jl(r,s){var c=r;r=0;do{var g=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(r===0)break;r--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||r++;c=g}while(c)}function Yr(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Yr(c),Co(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function or(r,s,c,g){for(;r.nodeType===1;){var b=c;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!g&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(g){if(!r[$t])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(M=r.getAttribute("rel"),M==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(M!==b.rel||r.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||r.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||r.getAttribute("title")!==(b.title==null?null:b.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(M=r.getAttribute("src"),(M!==(b.src==null?null:b.src)||r.getAttribute("type")!==(b.type==null?null:b.type)||r.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&M&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var M=b.name==null?null:""+b.name;if(b.type==="hidden"&&r.getAttribute("name")===M)return r}else return r;if(r=vs(r.nextSibling),r===null)break}return null}function lr(r,s,c){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=vs(r.nextSibling),r===null))return null;return r}function xp(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=vs(r.nextSibling),r===null))return null;return r}function ma(r){return r.data==="$?"||r.data==="$~"}function Kn(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function pf(r,s){var c=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||c.readyState!=="loading")s();else{var g=function(){s(),c.removeEventListener("DOMContentLoaded",g)};c.addEventListener("DOMContentLoaded",g),r._reactRetry=g}}function vs(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var mf=null;function eu(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var c=r.data;if(c==="/$"||c==="/&"){if(s===0)return vs(r.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}r=r.nextSibling}return null}function ec(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return r;s--}else c!=="/$"&&c!=="/&"||s++}r=r.previousSibling}return null}function xm(r,s,c){switch(s=ol(c),r){case"html":if(r=s.documentElement,!r)throw Error(ee(452));return r;case"head":if(r=s.head,!r)throw Error(ee(453));return r;case"body":if(r=s.body,!r)throw Error(ee(454));return r;default:throw Error(ee(451))}}function eh(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);Co(r)}var Ha=new Map,bp=new Set;function th(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Mo=We.d;We.d={f:wp,r:Wr,D:tu,C:gf,L:Tp,m:bm,X:Tm,S:wm,M:Sm};function wp(){var r=Mo.f(),s=Qh();return r||s}function Wr(r){var s=ws(r);s!==null&&s.tag===5&&s.type==="form"?ar(s):Mo.r(r)}var Qr=typeof document>"u"?null:document;function jr(r,s,c){var g=Qr;if(g&&typeof s=="string"&&s){var b=Ar(s);b='link[rel="'+r+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),bp.has(b)||(bp.add(b),r={rel:r,crossOrigin:c,href:s},g.querySelector(b)===null&&(s=g.createElement("link"),Hn(s,"link",r),mn(s),g.head.appendChild(s)))}}function tu(r){Mo.D(r),jr("dns-prefetch",r,null)}function gf(r,s){Mo.C(r,s),jr("preconnect",r,s)}function Tp(r,s,c){Mo.L(r,s,c);var g=Qr;if(g&&r&&s){var b='link[rel="preload"][as="'+Ar(s)+'"]';s==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+Ar(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+Ar(c.imageSizes)+'"]')):b+='[href="'+Ar(r)+'"]';var M=b;switch(s){case"style":M=ul(r);break;case"script":M=iu(r)}Ha.has(M)||(r=Re({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:r,as:s},c),Ha.set(M,r),g.querySelector(b)!==null||s==="style"&&g.querySelector(ih(M))||s==="script"&&g.querySelector(rh(M))||(s=g.createElement("link"),Hn(s,"link",r),mn(s),g.head.appendChild(s)))}}function bm(r,s){Mo.m(r,s);var c=Qr;if(c&&r){var g=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+Ar(g)+'"][href="'+Ar(r)+'"]',M=b;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":M=iu(r)}if(!Ha.has(M)&&(r=Re({rel:"modulepreload",href:r},s),Ha.set(M,r),c.querySelector(b)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(rh(M)))return}g=c.createElement("link"),Hn(g,"link",r),mn(g),c.head.appendChild(g)}}}function wm(r,s,c){Mo.S(r,s,c);var g=Qr;if(g&&r){var b=es(g).hoistableStyles,M=ul(r);s=s||"default";var k=b.get(M);if(!k){var Z={loading:0,preload:null};if(k=g.querySelector(ih(M)))Z.loading=5;else{r=Re({rel:"stylesheet",href:r,"data-precedence":s},c),(c=Ha.get(M))&&ah(r,c);var he=k=g.createElement("link");mn(he),Hn(he,"link",r),he._p=new Promise(function(Le,Xe){he.onload=Le,he.onerror=Xe}),he.addEventListener("load",function(){Z.loading|=1}),he.addEventListener("error",function(){Z.loading|=2}),Z.loading|=4,cd(k,s,g)}k={type:"stylesheet",instance:k,count:1,state:Z},b.set(M,k)}}}function Tm(r,s){Mo.X(r,s);var c=Qr;if(c&&r){var g=es(c).hoistableScripts,b=iu(r),M=g.get(b);M||(M=c.querySelector(rh(b)),M||(r=Re({src:r,async:!0},s),(s=Ha.get(b))&&sh(r,s),M=c.createElement("script"),mn(M),Hn(M,"link",r),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(b,M))}}function Sm(r,s){Mo.M(r,s);var c=Qr;if(c&&r){var g=es(c).hoistableScripts,b=iu(r),M=g.get(b);M||(M=c.querySelector(rh(b)),M||(r=Re({src:r,async:!0,type:"module"},s),(s=Ha.get(b))&&sh(r,s),M=c.createElement("script"),mn(M),Hn(M,"link",r),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(b,M))}}function _f(r,s,c,g){var b=(b=kt.current)?th(b):null;if(!b)throw Error(ee(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=ul(c.href),c=es(b).hoistableStyles,g=c.get(s),g||(g={type:"style",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=ul(c.href);var M=es(b).hoistableStyles,k=M.get(r);if(k||(b=b.ownerDocument||b,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},M.set(r,k),(M=b.querySelector(ih(r)))&&!M._p&&(k.instance=M,k.state.loading=5),Ha.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Ha.set(r,c),M||nh(b,r,c,k.state))),s&&g===null)throw Error(ee(528,""));return k}if(s&&g!==null)throw Error(ee(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=iu(c),c=es(b).hoistableScripts,g=c.get(s),g||(g={type:"script",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(ee(444,r))}}function ul(r){return'href="'+Ar(r)+'"'}function ih(r){return'link[rel="stylesheet"]['+r+"]"}function Sp(r){return Re({},r,{"data-precedence":r.precedence,precedence:null})}function nh(r,s,c,g){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?g.loading=1:(s=r.createElement("link"),g.preload=s,s.addEventListener("load",function(){return g.loading|=1}),s.addEventListener("error",function(){return g.loading|=2}),Hn(s,"link",c),mn(s),r.head.appendChild(s))}function iu(r){return'[src="'+Ar(r)+'"]'}function rh(r){return"script[async]"+r}function Mm(r,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var g=r.querySelector('style[data-href~="'+Ar(c.href)+'"]');if(g)return s.instance=g,mn(g),g;var b=Re({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return g=(r.ownerDocument||r).createElement("style"),mn(g),Hn(g,"style",b),cd(g,c.precedence,r),s.instance=g;case"stylesheet":b=ul(c.href);var M=r.querySelector(ih(b));if(M)return s.state.loading|=4,s.instance=M,mn(M),M;g=Sp(c),(b=Ha.get(b))&&ah(g,b),M=(r.ownerDocument||r).createElement("link"),mn(M);var k=M;return k._p=new Promise(function(Z,he){k.onload=Z,k.onerror=he}),Hn(M,"link",g),s.state.loading|=4,cd(M,c.precedence,r),s.instance=M;case"script":return M=iu(c.src),(b=r.querySelector(rh(M)))?(s.instance=b,mn(b),b):(g=c,(b=Ha.get(M))&&(g=Re({},c),sh(g,b)),r=r.ownerDocument||r,b=r.createElement("script"),mn(b),Hn(b,"link",g),r.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(ee(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(g=s.instance,s.state.loading|=4,cd(g,c.precedence,r));return s.instance}function cd(r,s,c){for(var g=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=g.length?g[g.length-1]:null,M=b,k=0;k<g.length;k++){var Z=g[k];if(Z.dataset.precedence===s)M=Z;else if(M!==b)break}M?M.parentNode.insertBefore(r,M.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(r,s.firstChild))}function ah(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function sh(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var tc=null;function yf(r,s,c){if(tc===null){var g=new Map,b=tc=new Map;b.set(c,g)}else b=tc,g=b.get(c),g||(g=new Map,b.set(c,g));if(g.has(r))return g;for(g.set(r,null),c=c.getElementsByTagName(r),b=0;b<c.length;b++){var M=c[b];if(!(M[$t]||M[Hi]||r==="link"&&M.getAttribute("rel")==="stylesheet")&&M.namespaceURI!=="http://www.w3.org/2000/svg"){var k=M.getAttribute(s)||"";k=r+k;var Z=g.get(k);Z?Z.push(M):g.set(k,[M])}}return g}function vf(r,s,c){r=r.ownerDocument||r,r.head.insertBefore(c,s==="title"?r.querySelector("head > title"):null)}function Mp(r,s,c){if(c===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return r=s.disabled,typeof s.precedence=="string"&&r==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Ep(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function Em(r,s,c,g){if(c.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=ul(g.href),M=s.querySelector(ih(b));if(M){s=M._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=hd.bind(r),s.then(r,r)),c.state.loading|=4,c.instance=M,mn(M);return}M=s.ownerDocument||s,g=Sp(g),(b=Ha.get(b))&&ah(g,b),M=M.createElement("link"),mn(M);var k=M;k._p=new Promise(function(Z,he){k.onload=Z,k.onerror=he}),Hn(M,"link",g),c.instance=M}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(r.count++,c=hd.bind(r),s.addEventListener("load",c),s.addEventListener("error",c))}}var xf=0;function Am(r,s){return r.stylesheets&&r.count===0&&dd(r,r.stylesheets),0<r.count||0<r.imgCount?function(c){var g=setTimeout(function(){if(r.stylesheets&&dd(r,r.stylesheets),r.unsuspend){var M=r.unsuspend;r.unsuspend=null,M()}},6e4+s);0<r.imgBytes&&xf===0&&(xf=62500*ym());var b=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&dd(r,r.stylesheets),r.unsuspend)){var M=r.unsuspend;r.unsuspend=null,M()}},(r.imgBytes>xf?50:800)+s);return r.unsuspend=c,function(){r.unsuspend=null,clearTimeout(g),clearTimeout(b)}}:null}function hd(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)dd(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var bf=null;function dd(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,bf=new Map,s.forEach(ng,r),bf=null,hd.call(r))}function ng(r,s){if(!(s.state.loading&4)){var c=bf.get(r);if(c)var g=c.get(null);else{c=new Map,bf.set(r,c);for(var b=r.querySelectorAll("link[data-precedence],style[data-precedence]"),M=0;M<b.length;M++){var k=b[M];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(c.set(k.dataset.precedence,k),g=k)}g&&c.set(null,g)}b=s.instance,k=b.getAttribute("data-precedence"),M=c.get(k)||g,M===g&&c.set(null,b),c.set(k,b),this.count++,g=hd.bind(this),b.addEventListener("load",g),b.addEventListener("error",g),M?M.parentNode.insertBefore(b,M.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(b,r.firstChild)),s.state.loading|=4}}var fd={$$typeof:ut,Provider:null,Consumer:null,_currentValue:pt,_currentValue2:pt,_threadCount:0};function Ap(r,s,c,g,b,M,k,Z,he){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Xn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xn(0),this.hiddenUpdates=Xn(null),this.identifierPrefix=g,this.onUncaughtError=b,this.onCaughtError=M,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=he,this.incompleteTransitions=new Map}function Cp(r,s,c,g,b,M,k,Z,he,Le,Xe,st){return r=new Ap(r,s,c,k,he,Le,Xe,st,Z),s=1,M===!0&&(s|=24),M=aa(3,null,null,s),r.current=M,M.stateNode=r,s=fo(),s.refCount++,r.pooledCache=s,s.refCount++,M.memoizedState={element:g,isDehydrated:c,cache:s},Ic(M),r}function Cm(r){return r?(r=Kt,r):Kt}function zm(r,s,c,g,b,M){b=Cm(b),g.context===null?g.context=b:g.pendingContext=b,g=ui(s),g.payload={element:c},M=M===void 0?null:M,M!==null&&(g.callback=M),c=Rs(r,g,s),c!==null&&(Ca(c,r,s),yo(c,r,s))}function zp(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<s?c:s}}function ic(r,s){zp(r,s),(r=r.alternate)&&zp(r,s)}function Dp(r){if(r.tag===13||r.tag===31){var s=wa(r,67108864);s!==null&&Ca(s,r,67108864),ic(r,67108864)}}function Dm(r){if(r.tag===13||r.tag===31){var s=Li();s=Ao(s);var c=wa(r,s);c!==null&&Ca(c,r,s),ic(r,s)}}var oh=!0;function Pp(r,s,c,g){var b=qe.T;qe.T=null;var M=We.p;try{We.p=2,nu(r,s,c,g)}finally{We.p=M,qe.T=b}}function Pm(r,s,c,g){var b=qe.T;qe.T=null;var M=We.p;try{We.p=8,nu(r,s,c,g)}finally{We.p=M,qe.T=b}}function nu(r,s,c,g){if(oh){var b=wf(g);if(b===null)of(r,s,g,Tf,c),Rp(r,g);else if(ag(b,r,s,c,g))g.stopPropagation();else if(Rp(r,g),s&4&&-1<rg.indexOf(r)){for(;b!==null;){var M=ws(b);if(M!==null)switch(M.tag){case 3:if(M=M.stateNode,M.current.memoizedState.isDehydrated){var k=be(M.pendingLanes);if(k!==0){var Z=M;for(Z.pendingLanes|=2,Z.entangledLanes|=2;k;){var he=1<<31-Ze(k);Z.entanglements[1]|=he,k&=~he}qs(M),(Ri&6)===0&&(Xh=er()+500,Ju(0))}}break;case 31:case 13:Z=wa(M,2),Z!==null&&Ca(Z,M,2),Qh(),ic(M,2)}if(M=wf(g),M===null&&of(r,s,g,Tf,c),M===b)break;b=M}b!==null&&g.stopPropagation()}else of(r,s,g,null,c)}}function wf(r){return r=hu(r),nc(r)}var Tf=null;function nc(r){if(Tf=null,r=Ka(r),r!==null){var s=tt(r);if(s===null)r=null;else{var c=s.tag;if(c===13){if(r=L(s),r!==null)return r;r=null}else if(c===31){if(r=d(s),r!==null)return r;r=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return Tf=r,null}function Im(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Vr()){case xe:return 2;case V:return 8;case j:case H:return 32;case oe:return 268435456;default:return 32}default:return 32}}var Ip=!1,cl=null,hl=null,ru=null,pd=new Map,md=new Map,au=[],rg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Rp(r,s){switch(r){case"focusin":case"focusout":cl=null;break;case"dragenter":case"dragleave":hl=null;break;case"mouseover":case"mouseout":ru=null;break;case"pointerover":case"pointerout":pd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":md.delete(s.pointerId)}}function Hs(r,s,c,g,b,M){return r===null||r.nativeEvent!==M?(r={blockedOn:s,domEventName:c,eventSystemFlags:g,nativeEvent:M,targetContainers:[b]},s!==null&&(s=ws(s),s!==null&&Dp(s)),r):(r.eventSystemFlags|=g,s=r.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),r)}function ag(r,s,c,g,b){switch(s){case"focusin":return cl=Hs(cl,r,s,c,g,b),!0;case"dragenter":return hl=Hs(hl,r,s,c,g,b),!0;case"mouseover":return ru=Hs(ru,r,s,c,g,b),!0;case"pointerover":var M=b.pointerId;return pd.set(M,Hs(pd.get(M)||null,r,s,c,g,b)),!0;case"gotpointercapture":return M=b.pointerId,md.set(M,Hs(md.get(M)||null,r,s,c,g,b)),!0}return!1}function lh(r){var s=Ka(r.target);if(s!==null){var c=tt(s);if(c!==null){if(s=c.tag,s===13){if(s=L(c),s!==null){r.blockedOn=s,vr(r.priority,function(){Dm(c)});return}}else if(s===31){if(s=d(c),s!==null){r.blockedOn=s,vr(r.priority,function(){Dm(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Sf(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var c=wf(r.nativeEvent);if(c===null){c=r.nativeEvent;var g=new c.constructor(c.type,c);ph=g,c.target.dispatchEvent(g),ph=null}else return s=ws(c),s!==null&&Dp(s),r.blockedOn=c,!1;s.shift()}return!0}function Rm(r,s,c){Sf(r)&&c.delete(s)}function sg(){Ip=!1,cl!==null&&Sf(cl)&&(cl=null),hl!==null&&Sf(hl)&&(hl=null),ru!==null&&Sf(ru)&&(ru=null),pd.forEach(Rm),md.forEach(Rm)}function uh(r,s){r.blockedOn===s&&(r.blockedOn=null,Ip||(Ip=!0,ae.unstable_scheduleCallback(ae.unstable_NormalPriority,sg)))}var gd=null;function Lm(r){gd!==r&&(gd=r,ae.unstable_scheduleCallback(ae.unstable_NormalPriority,function(){gd===r&&(gd=null);for(var s=0;s<r.length;s+=3){var c=r[s],g=r[s+1],b=r[s+2];if(typeof g!="function"){if(nc(g||c)===null)continue;break}var M=ws(c);M!==null&&(r.splice(s,3),s-=3,cn(M,{pending:!0,data:b,method:c.method,action:g},g,b))}}))}function ch(r){function s(he){return uh(he,r)}cl!==null&&uh(cl,r),hl!==null&&uh(hl,r),ru!==null&&uh(ru,r),pd.forEach(s),md.forEach(s);for(var c=0;c<au.length;c++){var g=au[c];g.blockedOn===r&&(g.blockedOn=null)}for(;0<au.length&&(c=au[0],c.blockedOn===null);)lh(c),c.blockedOn===null&&au.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(g=0;g<c.length;g+=3){var b=c[g],M=c[g+1],k=b[ht]||null;if(typeof M=="function")k||Lm(c);else if(k){var Z=null;if(M&&M.hasAttribute("formAction")){if(b=M,k=M[ht]||null)Z=k.formAction;else if(nc(b)!==null)continue}else Z=k.action;typeof Z=="function"?c[g+1]=Z:(c.splice(g,3),g-=3),Lm(c)}}}function Lp(){function r(M){M.canIntercept&&M.info==="react-transition"&&M.intercept({handler:function(){return new Promise(function(k){return b=k})},focusReset:"manual",scroll:"manual"})}function s(){b!==null&&(b(),b=null),g||setTimeout(c,20)}function c(){if(!g&&!navigation.transition){var M=navigation.currentEntry;M&&M.url!=null&&navigation.navigate(M.url,{state:M.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,b=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){g=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),b!==null&&(b(),b=null)}}}function Mf(r){this._internalRoot=r}Ef.prototype.render=Mf.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(ee(409));var c=s.current,g=Li();zm(c,g,r,s,null,null)},Ef.prototype.unmount=Mf.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;zm(r.current,2,null,r,null,null),Qh(),s[Xt]=null}};function Ef(r){this._internalRoot=r}Ef.prototype.unstable_scheduleHydration=function(r){if(r){var s=yr();r={blockedOn:null,target:r,priority:s};for(var c=0;c<au.length&&s!==0&&s<au[c].priority;c++);au.splice(c,0,r),c===0&&lh(r)}};var Bp=et.version;if(Bp!=="19.2.1")throw Error(ee(527,Bp,"19.2.1"));We.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(ee(188)):(r=Object.keys(r).join(","),Error(ee(268,r)));return r=_e(s),r=r!==null?He(r):null,r=r===null?null:r.stateNode,r};var Bm={bundleType:0,version:"19.2.1",rendererPackageName:"react-dom",currentDispatcherRef:qe,reconcilerVersion:"19.2.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Af=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Af.isDisabled&&Af.supportsFiber)try{ye=Af.inject(Bm),fe=Af}catch{}}return jp.createRoot=function(r,s){if(!at(r))throw Error(ee(299));var c=!1,g="",b=bo,M=Vs,k=Bh;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(g=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(M=s.onCaughtError),s.onRecoverableError!==void 0&&(k=s.onRecoverableError)),s=Cp(r,1,!1,null,null,c,g,null,b,M,k,Lp),r[Xt]=s.current,sf(r),new Mf(s)},jp.hydrateRoot=function(r,s,c){if(!at(r))throw Error(ee(299));var g=!1,b="",M=bo,k=Vs,Z=Bh,he=null;return c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(M=c.onUncaughtError),c.onCaughtError!==void 0&&(k=c.onCaughtError),c.onRecoverableError!==void 0&&(Z=c.onRecoverableError),c.formState!==void 0&&(he=c.formState)),s=Cp(r,1,!0,s,c??null,g,b,he,M,k,Z,Lp),s.context=Cm(null),c=s.current,g=Li(),g=Ao(g),b=ui(g),b.callback=null,Rs(c,b,g),c=g,s.current.lanes=c,Di(s,c),qs(s),r[Xt]=s.current,sf(r),new Ef(s)},jp.version="19.2.1",jp}var Hg;function D_(){if(Hg)return yg.exports;Hg=1;function ae(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ae)}catch(et){console.error(et)}}return ae(),yg.exports=z_(),yg.exports}var P_=D_(),$g=63710088e-1;function r_(ae,et,Fe={}){const ee={type:"Feature"};return(Fe.id===0||Fe.id)&&(ee.id=Fe.id),Fe.bbox&&(ee.bbox=Fe.bbox),ee.properties=et||{},ee.geometry=ae,ee}function I_(ae,et,Fe={}){if(!ae)throw new Error("coordinates is required");if(!Array.isArray(ae))throw new Error("coordinates must be an Array");if(ae.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Xg(ae[0])||!Xg(ae[1]))throw new Error("coordinates must contain numbers");return r_({type:"Point",coordinates:ae},et,Fe)}function R_(ae,et,Fe={}){for(const at of ae){if(at.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(at[at.length-1].length!==at[0].length)throw new Error("First and last Position are not equivalent.");for(let tt=0;tt<at[at.length-1].length;tt++)if(at[at.length-1][tt]!==at[0][tt])throw new Error("First and last Position are not equivalent.")}return r_({type:"Polygon",coordinates:ae},et,Fe)}function Nm(ae,et={}){const Fe={type:"FeatureCollection"};return et.id&&(Fe.id=et.id),et.bbox&&(Fe.bbox=et.bbox),Fe.features=ae,Fe}function Xg(ae){return!isNaN(ae)&&ae!==null&&!Array.isArray(ae)}function a_(ae,et,Fe){if(ae!==null)for(var ee,at,tt,L,d,de,_e,He=0,Re=0,Ee,ct=ae.type,At=ct==="FeatureCollection",rt=ct==="Feature",pe=At?ae.features.length:1,mt=0;mt<pe;mt++){_e=At?ae.features[mt].geometry:rt?ae.geometry:ae,Ee=_e?_e.type==="GeometryCollection":!1,d=Ee?_e.geometries.length:1;for(var Et=0;Et<d;Et++){var ut=0,vt=0;if(L=Ee?_e.geometries[Et]:_e,L!==null){de=L.coordinates;var Bt=L.type;switch(He=0,Bt){case null:break;case"Point":if(et(de,Re,mt,ut,vt)===!1)return!1;Re++,ut++;break;case"LineString":case"MultiPoint":for(ee=0;ee<de.length;ee++){if(et(de[ee],Re,mt,ut,vt)===!1)return!1;Re++,Bt==="MultiPoint"&&ut++}Bt==="LineString"&&ut++;break;case"Polygon":case"MultiLineString":for(ee=0;ee<de.length;ee++){for(at=0;at<de[ee].length-He;at++){if(et(de[ee][at],Re,mt,ut,vt)===!1)return!1;Re++}Bt==="MultiLineString"&&ut++,Bt==="Polygon"&&vt++}Bt==="Polygon"&&ut++;break;case"MultiPolygon":for(ee=0;ee<de.length;ee++){for(vt=0,at=0;at<de[ee].length;at++){for(tt=0;tt<de[ee][at].length-He;tt++){if(et(de[ee][at][tt],Re,mt,ut,vt)===!1)return!1;Re++}vt++}ut++}break;case"GeometryCollection":for(ee=0;ee<L.geometries.length;ee++)if(a_(L.geometries[ee],et)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function L_(ae,et){var Fe,ee,at,tt,L,d,de,_e,He,Re,Ee=0,ct=ae.type==="FeatureCollection",At=ae.type==="Feature",rt=ct?ae.features.length:1;for(Fe=0;Fe<rt;Fe++){for(d=ct?ae.features[Fe].geometry:At?ae.geometry:ae,_e=ct?ae.features[Fe].properties:At?ae.properties:{},He=ct?ae.features[Fe].bbox:At?ae.bbox:void 0,Re=ct?ae.features[Fe].id:At?ae.id:void 0,de=d?d.type==="GeometryCollection":!1,L=de?d.geometries.length:1,at=0;at<L;at++){if(tt=de?d.geometries[at]:d,tt===null){if(et(null,Ee,_e,He,Re)===!1)return!1;continue}switch(tt.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(et(tt,Ee,_e,He,Re)===!1)return!1;break}case"GeometryCollection":{for(ee=0;ee<tt.geometries.length;ee++)if(et(tt.geometries[ee],Ee,_e,He,Re)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Ee++}}function B_(ae,et,Fe){var ee=Fe;return L_(ae,function(at,tt,L,d,de){tt===0&&Fe===void 0?ee=at:ee=et(ee,at,tt,L,d,de)}),ee}function s_(ae,et={}){if(ae.bbox!=null&&et.recompute!==!0)return ae.bbox;const Fe=[1/0,1/0,-1/0,-1/0];return a_(ae,ee=>{Fe[0]>ee[0]&&(Fe[0]=ee[0]),Fe[1]>ee[1]&&(Fe[1]=ee[1]),Fe[2]<ee[0]&&(Fe[2]=ee[0]),Fe[3]<ee[1]&&(Fe[3]=ee[1])}),Fe}var Vp=s_;function k_({feature:ae,onSelect:et,isSelected:Fe,isPreviewOn:ee,onTogglePreview:at}){const[tt,L]=Ut.useState(!1),[d,de]=Ut.useState(null),_e=Ut.useRef(null);Ut.useEffect(()=>{Fe?(L(!0),setTimeout(()=>{_e.current&&_e.current.scrollIntoView({behavior:"smooth",block:"center"})},100)):L(!1)},[Fe]);const He=ae.properties,Re=Tt=>!Tt||Tt==="Unknown Date"?"Unknown Date":new Date(Tt).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}),Ee=Tt=>Tt?Tt.charAt(0).toUpperCase()+Tt.slice(1).toLowerCase():"",ct=Tt=>{if(!Tt)return"Unknown";const gt=Tt.toLowerCase();return gt==="uav"||gt==="drone"?"Drone":Ee(Tt)},At=()=>{const gt=He.uuid.split("/"),Vt=gt[gt.length-1].replace(".tif","").replace(".tiff","");return{uploadId:gt[gt.length-3],filename:Vt}},rt=()=>{const{uploadId:Tt,filename:gt}=At();return`https://tiles.openaerialmap.org/${Tt}/0/${gt}/{z}/{x}/{y}`},pe=Tt=>{Tt.stopPropagation(),L(!tt)},mt=Tt=>{Tt.stopPropagation(),et(null)},Et=(Tt,gt,Vt)=>{Tt.stopPropagation(),navigator.clipboard.writeText(gt),de(Vt),setTimeout(()=>de(null),2e3)},ut=Tt=>{Tt.stopPropagation(),at()},vt=async Tt=>{Tt.stopPropagation();const gt=rt(),Vt=`OAM - ${He.title||He.id}`,ti=`tms[22]:${gt}`,hi=`http://127.0.0.1:8111/imagery?title=${encodeURIComponent(Vt)}&type=tms&url=${encodeURIComponent(ti)}`;try{await fetch(hi)}catch{alert("Could not connect to JOSM. Make sure JOSM is running and 'Remote Control' is enabled.")}},Bt=Tt=>{Tt.stopPropagation();const gt=rt(),Vt=Vp(ae),ti=(Vt[0]+Vt[2])/2,hi=(Vt[1]+Vt[3])/2,si=16,Jt=`custom:${gt}`,di=`https://www.openstreetmap.org/edit?editor=id#map=${si}/${hi}/${ti}&background=${encodeURIComponent(Jt)}`;window.open(di,"_blank")};return ke.jsxs("div",{ref:_e,onClick:()=>et(ae),className:`group border-b transition-all duration-200 relative ${Fe?"bg-white border-l-4 border-l-cyan-500 shadow-md my-2 rounded-r-md":"border-gray-100 bg-white hover:bg-gray-50 border-l-4 border-l-transparent"}`,children:[Fe&&ke.jsx("button",{onClick:mt,className:"absolute top-2 right-2 text-gray-400 hover:text-cyan-600 p-1 hover:bg-gray-100 rounded-full z-10",title:"Deselect",children:ke.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:ke.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),ke.jsxs("div",{className:"p-4",children:[ke.jsxs("div",{className:"aspect-video bg-gray-100 rounded-md mb-3 overflow-hidden relative border border-gray-200 shadow-inner",children:[He.thumbnail?ke.jsx("img",{src:He.thumbnail,alt:"Preview",className:"w-full h-full object-cover",loading:"lazy"}):ke.jsx("div",{className:"flex items-center justify-center h-full text-gray-400 text-xs",children:"No Preview"}),ke.jsx("button",{onClick:ut,className:`absolute top-2 left-2 p-1.5 rounded shadow-sm border transition-all z-10 ${ee?"bg-cyan-500 text-white border-cyan-600 hover:bg-cyan-600":"bg-white/90 text-gray-500 border-gray-200 hover:text-cyan-600 hover:bg-white"}`,title:ee?"Hide on map":"Show on map",children:ee?ke.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[ke.jsx("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),ke.jsx("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}):ke.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),ke.jsx("div",{className:"flex justify-between items-start gap-2 pr-6",children:ke.jsx("h3",{className:`font-bold text-sm leading-tight ${Fe?"text-cyan-700":"text-gray-800"}`,children:He.title})}),ke.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-2",children:[ke.jsx("span",{className:"font-medium text-gray-700",children:Re(He.date)}),ke.jsx("span",{className:"text-gray-300",children:""}),ke.jsx("span",{className:"truncate max-w-[150px]",title:He.provider,children:He.provider})]}),ke.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-100",children:[ke.jsxs("button",{onClick:pe,className:"flex-1 text-xs font-semibold text-gray-500 hover:text-cyan-600 flex items-center justify-center gap-1 py-1.5 transition-colors",children:[tt?"Hide Details":"Show Details",ke.jsx("span",{className:"text-[9px] transform transition-transform duration-200",style:{transform:tt?"rotate(180deg)":"rotate(0deg)"},children:""})]}),ke.jsx("a",{href:He.uuid,target:"_blank",rel:"noreferrer",download:!0,onClick:Tt=>Tt.stopPropagation(),className:"flex-1 text-xs font-semibold text-cyan-600 bg-cyan-50 hover:bg-cyan-100 py-1.5 rounded text-center transition-colors",children:"Download GeoTIFF"})]})]}),tt&&ke.jsxs("div",{className:"bg-gray-50 px-4 py-4 text-xs border-t border-gray-100 text-gray-600 animate-fade-in",children:[ke.jsx("div",{className:"mb-4 pb-3 border-b border-gray-200",children:ke.jsxs("div",{className:"flex gap-2",children:[ke.jsx("button",{onClick:Tt=>Et(Tt,rt(),"tms"),className:"flex-1 bg-white border border-gray-300 text-gray-600 py-1.5 rounded hover:bg-gray-100 hover:border-gray-400 transition-all shadow-sm",children:d==="tms"?ke.jsx("span",{className:"text-green-600 font-bold",children:"Copied!"}):"Copy TMS"}),ke.jsx("button",{onClick:Bt,className:"flex-1 bg-white border border-gray-300 text-gray-600 py-1.5 rounded hover:bg-gray-100 hover:border-gray-400 transition-all shadow-sm",children:"Open iD"}),ke.jsx("button",{onClick:vt,className:"flex-1 bg-white border border-gray-300 text-gray-600 py-1.5 rounded hover:bg-gray-100 hover:border-gray-400 transition-all shadow-sm",children:"Open JOSM"})]})}),ke.jsxs("div",{className:"grid grid-cols-2 gap-y-3 gap-x-4",children:[ke.jsxs("div",{children:[ke.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"Platform Type"}),ct(He.platform)]}),ke.jsxs("div",{children:[ke.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"Sensor"}),Ee(He.sensor)]}),ke.jsxs("div",{children:[ke.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"GSD (Resolution)"}),He.gsd]}),ke.jsxs("div",{children:[ke.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"File Size"}),He.file_size||"Unknown"]}),ke.jsxs("div",{children:[ke.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"License"}),ke.jsx("a",{href:"https://creativecommons.org/licenses/",target:"_blank",rel:"noreferrer",className:"hover:underline hover:text-cyan-600 truncate block",title:He.license,children:He.license})]}),ke.jsxs("div",{className:"min-w-0",children:[ke.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"ID"}),ke.jsx("span",{className:"font-mono text-[10px] text-gray-500 block truncate select-all cursor-text bg-gray-100 px-1 rounded",title:He.id,children:He.id})]})]})]})]})}const wg=10;function O_({features:ae,onSelect:et,selectedFeature:Fe,isLoading:ee,limit:at,layerMode:tt,previewedIds:L,hiddenIds:d,onTogglePreview:de}){const[_e,He]=Ut.useState(wg),Re=Ut.useRef(null);Ut.useEffect(()=>{He(wg),Re.current&&(Re.current.scrollTop=0)},[ae]),Ut.useEffect(()=>{if(Fe){const pe=ae.findIndex(mt=>mt.properties.id===Fe.properties.id);pe>=_e&&He(pe+5)}},[Fe,ae,_e]);const Ee=()=>{He(pe=>Math.min(pe+wg,ae.length))},ct=()=>ee?"Loading...":ae.length===0?"No images found in view":ae.length>=at?`Showing most recent ${at} images`:`${ae.length} image${ae.length!==1?"s":""} in view`,At=ae.slice(0,_e),rt=pe=>tt==="previews"?!d.has(pe):L.has(pe);return ke.jsxs("div",{ref:Re,className:"flex-1 overflow-y-auto bg-gray-50 relative scroll-smooth font-sans",children:[ke.jsxs("div",{className:"p-5 border-b border-gray-200 bg-white sticky top-0 z-20 shadow-sm",children:[ke.jsx("div",{className:"flex items-center gap-3 mb-2",children:ke.jsx("img",{src:"https://map.openaerialmap.org/static/media/oam-logo-h-pos.a507b97d.svg",alt:"OpenAerialMap",className:"h-8"})}),ke.jsxs("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider flex items-center gap-2",children:[ke.jsx("span",{className:`w-2 h-2 rounded-full ${ee?"bg-gray-300 animate-pulse":"bg-cyan-500"}`}),ct()]})]}),ke.jsx("div",{className:"p-4 space-y-4",children:ee&&ae.length===0?ke.jsx("div",{className:"flex justify-center py-8",children:ke.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-700"})}):ae.length>0?ke.jsxs(ke.Fragment,{children:[At.map(pe=>ke.jsx(k_,{feature:pe,onSelect:et,isSelected:Fe&&Fe.properties.id===pe.properties.id,isPreviewOn:rt(pe.properties.id),onTogglePreview:()=>de(pe.properties.id)},pe.properties.id)),_e<ae.length&&ke.jsxs("button",{onClick:Ee,className:"w-full py-3 bg-white border border-gray-300 text-gray-600 font-semibold rounded hover:bg-gray-50 hover:text-cyan-600 transition-colors shadow-sm",children:["Load More (",ae.length-_e," remaining)"]})]}):!ee&&ke.jsx("p",{className:"text-center text-gray-500 py-8",children:"Try moving the map or changing filters."})}),ee&&ae.length>0&&ke.jsx("div",{className:"absolute inset-0 bg-white/50 z-30 pointer-events-none flex items-start justify-center pt-20",children:ke.jsx("div",{className:"bg-white p-2 rounded-full shadow-md",children:ke.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-cyan-700"})})})]})}var Vm={exports:{}};var F_=Vm.exports,Yg;function N_(){return Yg||(Yg=1,(function(ae,et){(function(Fe,ee){ae.exports=ee()})(F_,(function(){var Fe={},ee={};function at(L,d,de){if(ee[L]=de,L==="index"){var _e="var sharedModule = {}; ("+ee.shared+")(sharedModule); ("+ee.worker+")(sharedModule);",He={};return ee.shared(He),ee.index(Fe,He),typeof window<"u"&&Fe.setWorkerUrl(window.URL.createObjectURL(new Blob([_e],{type:"text/javascript"}))),Fe}}at("shared",["exports"],(function(L){function d(n,e,i,o){return new(i||(i=Promise))((function(u,f){function p(T){try{x(o.next(T))}catch(E){f(E)}}function y(T){try{x(o.throw(T))}catch(E){f(E)}}function x(T){var E;T.done?u(T.value):(E=T.value,E instanceof i?E:new i((function(C){C(E)}))).then(p,y)}x((o=o.apply(n,e||[])).next())}))}function de(n,e){this.x=n,this.y=e}function _e(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var He,Re;typeof SuppressedError=="function"&&SuppressedError,de.prototype={clone(){return new de(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround(n,e){const i=Math.cos(n),o=Math.sin(n),u=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:de},de.convert=function(n){if(n instanceof de)return n;if(Array.isArray(n))return new de(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new de(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var Ee=(function(){if(Re)return He;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return Re=1,He=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=f/p}var y=0,x=1;for(o=e,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));u++)e>f?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},He})(),ct=_e(Ee);let At,rt;function pe(){return At==null&&(At=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),At}function mt(){if(rt==null&&(rt=!1,pe())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const i=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&i[o]!==o){rt=!0;break}}}return rt||!1}var Et=1e-6,ut=typeof Float32Array<"u"?Float32Array:Array;function vt(){var n=new ut(9);return ut!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Bt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Tt(){var n=new ut(3);return ut!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function gt(n){var e=n[0],i=n[1],o=n[2];return Math.sqrt(e*e+i*i+o*o)}function Vt(n,e,i){var o=new ut(3);return o[0]=n,o[1]=e,o[2]=i,o}function ti(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function hi(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function si(n,e,i){var o=e[0],u=e[1],f=e[2],p=i[0],y=i[1],x=i[2];return n[0]=u*x-f*y,n[1]=f*p-o*x,n[2]=o*y-u*p,n}var Jt,di=gt;function an(n,e,i){var o=e[0],u=e[1],f=e[2],p=e[3];return n[0]=i[0]*o+i[4]*u+i[8]*f+i[12]*p,n[1]=i[1]*o+i[5]*u+i[9]*f+i[13]*p,n[2]=i[2]*o+i[6]*u+i[10]*f+i[14]*p,n[3]=i[3]*o+i[7]*u+i[11]*f+i[15]*p,n}function fn(){var n=new ut(4);return ut!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function qe(n,e,i,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",f=Math.PI/360;e*=f,o*=f,i*=f;var p=Math.sin(e),y=Math.cos(e),x=Math.sin(i),T=Math.cos(i),E=Math.sin(o),C=Math.cos(o);switch(u){case"xyz":n[0]=p*T*C+y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C-p*x*E;break;case"xzy":n[0]=p*T*C-y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C+p*x*E;break;case"yxz":n[0]=p*T*C+y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C+p*x*E;break;case"yzx":n[0]=p*T*C+y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C-p*x*E;break;case"zxy":n[0]=p*T*C-y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C-p*x*E;break;case"zyx":n[0]=p*T*C-y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C+p*x*E;break;default:throw new Error("Unknown angle order "+u)}return n}function We(){var n=new ut(2);return ut!=Float32Array&&(n[0]=0,n[1]=0),n}function pt(n,e){var i=new ut(2);return i[0]=n,i[1]=e,i}Tt(),Jt=new ut(4),ut!=Float32Array&&(Jt[0]=0,Jt[1]=0,Jt[2]=0,Jt[3]=0),Tt(),Vt(1,0,0),Vt(0,1,0),fn(),fn(),vt(),We();const Ve=8192;function St(n,e,i){return e*(Ve/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function le(n,e){return(n%e+e)%e}function ze(n,e,i){return n*(1-i)+e*i}function it(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function Ue(n,e,i,o){const u=new ct(n,e,i,o);return f=>u.solve(f)}const yt=Ue(.25,.1,.25,1);function kt(n,e,i){return Math.min(i,Math.max(e,n))}function Nt(n,e,i){const o=i-e,u=((n-e)%o+o)%o+e;return u===e?i:u}function yi(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let Ai=1;function Jn(n,e,i){const o={};for(const u in n)o[u]=e.call(this,n[u],u,n);return o}function gr(n,e,i){const o={};for(const u in n)e.call(this,n[u],u,n)&&(o[u]=n[u]);return o}function hr(n){return Array.isArray(n)?n.map(hr):typeof n=="object"&&n?Jn(n,hr):n}const Pa={};function Zi(n){Pa[n]||(typeof console<"u"&&console.warn(n),Pa[n]=!0)}function dr(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function _r(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let pn=null;function xs(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const bs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Xs(n,e,i,o,u){return d(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(n,{timestamp:0});try{const p=f?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const y=p.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield f.copyTo(x,(function(T,E,C,D,P){const B=4*Math.max(-E,0),O=(Math.max(0,C)-C)*D*4+B,N=4*D,G=Math.max(0,E),J=Math.max(0,C);return{rect:{x:G,y:J,width:Math.min(T.width,E+D)-G,height:Math.min(T.height,C+P)-J},layout:[{offset:O,stride:N}]}})(n,e,i,o,u)),y)for(let T=0;T<x.length;T+=4){const E=x[T];x[T]=x[T+2],x[T+2]=E}return x}finally{f.close()}}))}let Wa,Ia;function gl(n,e,i,o){return n.addEventListener(e,i,o),{unsubscribe:()=>{n.removeEventListener(e,i,o)}}}function er(n){return n*Math.PI/180}function Vr(n){return n/Math.PI*180}const xe={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},V={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},j="AbortError";class H extends Error{constructor(e=j){super(e instanceof Error?e.message:e),this.name=j,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function oe(n){return n.name===j}const ce={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Se(n){return ce.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const ye="global-dispatcher";class fe extends Error{constructor(e,i,o,u){super(`AJAXError: ${i} (${e}): ${o}`),this.status=e,this.statusText=i,this.url=o,this.body=u}}const Me=()=>_r(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ze=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=Se(n.url);if(o)return o(n,e);if(_r(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:ye},e)}if(!(/^file:/.test(i=n.url)||/^file:/.test(Me())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return d(this,void 0,void 0,(function*(){const f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Me(),signal:u.signal});let p,y;o.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");try{p=yield fetch(f)}catch(T){throw oe(T)?T:new fe(0,T.message,o.url,new Blob)}if(!p.ok){const T=yield p.blob();throw new fe(p.status,p.statusText,o.url,T)}y=o.type==="arrayBuffer"||o.type==="image"?p.arrayBuffer():o.type==="json"?p.json():p.text();const x=yield y;return u.signal.throwIfAborted(),{data:x,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}}))})(n,e);if(_r(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:ye},e)}var i;return(function(o,u){return new Promise(((f,p)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const T in o.headers)x.setRequestHeader(T,o.headers[T]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(o.type==="json")try{T=JSON.parse(x.response)}catch(E){return void p(E)}f({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});p(new fe(x.status,x.statusText,o.url,T))}},u.signal.addEventListener("abort",(()=>{x.abort(),p(new H(u.signal.reason))})),x.send(o.body)}))})(n,e)};function $e(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function bt(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Pt(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class Gt{constructor(e,i={}){yi(this,i),this.type=e}}class Ti extends Gt{constructor(e,i={}){super("error",yi({error:e},i))}}class fi{on(e,i){return this._listeners=this._listeners||{},bt(e,i,this._listeners),{unsubscribe:()=>{this.off(e,i)}}}off(e,i){return Pt(e,i,this._listeners),Pt(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},bt(e,i,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,i){typeof e=="string"&&(e=new Gt(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of f)Pt(o,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(yi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof Ti&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ci=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function zn(n,e){const i={};for(const o in n)o!=="ref"&&(i[o]=n[o]);return Ci.forEach((o=>{o in e&&(i[o]=e[o])})),i}function Ht(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Ht(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!Ht(n[i],e[i]))return!1;return!0}return n===e}function zi(n,e){n.push(e)}function Xn(n,e,i){zi(i,{command:"addSource",args:[n,e[n]]})}function Di(n,e,i){zi(e,{command:"removeSource",args:[n]}),i[n]=!0}function Tn(n,e,i,o){Di(n,i,o),Xn(n,e,i)}function Fi(n,e,i){let o;for(o in n[i])if(Object.prototype.hasOwnProperty.call(n[i],o)&&o!=="data"&&!Ht(n[i][o],e[i][o]))return!1;for(o in e[i])if(Object.prototype.hasOwnProperty.call(e[i],o)&&o!=="data"&&!Ht(n[i][o],e[i][o]))return!1;return!0}function Dn(n,e,i,o,u,f){n=n||{},e=e||{};for(const p in n)Object.prototype.hasOwnProperty.call(n,p)&&(Ht(n[p],e[p])||i.push({command:f,args:[o,p,e[p],u]}));for(const p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(n,p)&&(Ht(n[p],e[p])||i.push({command:f,args:[o,p,e[p],u]}))}function _l(n){return n.id}function Ao(n,e){return n[e.id]=e,n}class ot{constructor(e,i,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function yr(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class vr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Ra{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,u]of i)this.bindings[o]=u}concat(e){return new Ra(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Hi={kind:"null"},ht={kind:"number"},Xt={kind:"string"},Qt={kind:"boolean"},ea={kind:"color"},oc={kind:"projectionDefinition"},Qa={kind:"object"},$t={kind:"value"},Co={kind:"collator"},Ka={kind:"formatted"},ws={kind:"padding"},Ja={kind:"colorArray"},es={kind:"numberArray"},mn={kind:"resolvedImage"},yl={kind:"variableAnchorOffsetCollection"};function xr(n,e){return{kind:"array",itemType:n,N:e}}function pi(n){if(n.kind==="array"){const e=pi(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const Ts=[Hi,ht,Xt,Qt,ea,oc,Ka,Qa,xr($t),ws,es,Ja,mn,yl];function vl(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!vl(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of Ts)if(!vl(i,e))return null}}return`Expected ${pi(n)} but found ${pi(e)} instead.`}function xl(n,e){return e.some((i=>i.kind===n.kind))}function Ys(n,e){return e.some((i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n))}function La(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const ou=.96422,ts=.82521,_a=4/29,vi=6/29,dh=3*vi*vi,xd=vi*vi*vi,zo=Math.PI/180,fh=180/Math.PI;function lu(n){return(n%=360)<0&&(n+=360),n}function bd([n,e,i,o]){let u,f;const p=uu((.2225045*(n=Ar(n))+.7168786*(e=Ar(e))+.0606169*(i=Ar(i)))/1);n===e&&e===i?u=f=p:(u=uu((.4360747*n+.3850649*e+.1430804*i)/ou),f=uu((.0139322*n+.0971045*e+.7141733*i)/ts));const y=116*p-16;return[y<0?0:y,500*(u-p),200*(p-f),o]}function Ar(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function uu(n){return n>xd?Math.pow(n,1/3):n/dh+_a}function lc([n,e,i,o]){let u=(n+16)/116,f=isNaN(e)?u:u+e/500,p=isNaN(i)?u:u-i/200;return u=1*Ws(u),f=ou*Ws(f),p=ts*Ws(p),[cu(3.1338561*f-1.6168667*u-.4906146*p),cu(-.9787684*f+1.9161415*u+.033454*p),cu(.0719453*f-.2289914*u+1.4052427*p),o]}function cu(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function Ws(n){return n>vi?n*n*n:dh*(n-_a)}const wd=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function bl(n,e){return wd(n,e)?n[e]:void 0}function Ss(n){return parseInt(n.padEnd(2,n),16)/255}function Td(n,e){return Do(e?n/100:n,0,1)}function Do(n,e,i){return Math.min(Math.max(e,n),i)}function uc(n){return!n.some(Number.isNaN)}const Po={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Qs(n,e,i){return n+i*(e-n)}function wl(n,e,i){return n.map(((o,u)=>Qs(o,e[u],i)))}class Wt{constructor(e,i,o,u=1,f=!0){this.r=e,this.g=i,this.b=o,this.a=u,f||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,i,o,u]))}static parse(e){if(e instanceof Wt)return e;if(typeof e!="string")return;const i=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=bl(Po,o);if(u){const[p,y,x]=u;return[p/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const p=o.length<6?1:2;let y=1;return[Ss(o.slice(y,y+=p)),Ss(o.slice(y,y+=p)),Ss(o.slice(y,y+=p)),Ss(o.slice(y,y+p)||"ff")]}if(o.startsWith("rgb")){const p=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[y,x,T,E,C,D,P,B,O,N,G,J]=p,q=[E||" ",P||" ",N].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const $=[T,D,O].join(""),ie=$==="%%%"?100:$===""?255:0;if(ie){const re=[Do(+x/ie,0,1),Do(+C/ie,0,1),Do(+B/ie,0,1),G?Td(+G,J):1];if(uc(re))return re}}return}}const f=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[p,y,x,T,E,C,D,P,B]=f,O=[x||" ",E||" ",D].join("");if(O==="  "||O==="  /"||O===",,"||O===",,,"){const N=[+y,Do(+T,0,100),Do(+C,0,100),P?Td(+P,B):1];if(uc(N))return(function([G,J,q,$]){function ie(re){const Te=(re+G/30)%12,Ge=J*Math.min(q,1-q);return q-Ge*Math.max(-1,Math.min(Te-3,9-Te,1))}return G=lu(G),J/=100,q/=100,[ie(0),ie(8),ie(4),$]})(N)}}})(e);return i?new Wt(...i,!1):void 0}get rgb(){const{r:e,g:i,b:o,a:u}=this,f=u||1/0;return this.overwriteGetter("rgb",[e/f,i/f,o/f,u])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[i,o,u,f]=bd(e),p=Math.sqrt(o*o+u*u);return[Math.round(1e4*p)?lu(Math.atan2(u,o)*fh):NaN,p,i,f]})(this.rgb))}get lab(){return this.overwriteGetter("lab",bd(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,o,u]=this.rgb;return`rgba(${[e,i,o].map((f=>Math.round(255*f))).join(",")},${u})`}static interpolate(e,i,o,u="rgb"){switch(u){case"rgb":{const[f,p,y,x]=wl(e.rgb,i.rgb,o);return new Wt(f,p,y,x,!1)}case"hcl":{const[f,p,y,x]=e.hcl,[T,E,C,D]=i.hcl;let P,B;if(isNaN(f)||isNaN(T))isNaN(f)?isNaN(T)?P=NaN:(P=T,y!==1&&y!==0||(B=E)):(P=f,C!==1&&C!==0||(B=p));else{let q=T-f;T>f&&q>180?q-=360:T<f&&f-T>180&&(q+=360),P=f+o*q}const[O,N,G,J]=(function([q,$,ie,re]){return q=isNaN(q)?0:q*zo,lc([ie,Math.cos(q)*$,Math.sin(q)*$,re])})([P,B??Qs(p,E,o),Qs(y,C,o),Qs(x,D,o)]);return new Wt(O,N,G,J,!1)}case"lab":{const[f,p,y,x]=lc(wl(e.lab,i.lab,o));return new Wt(f,p,y,x,!1)}}}}Wt.black=new Wt(0,0,0,1),Wt.white=new Wt(1,1,1,1),Wt.transparent=new Wt(0,0,0,0),Wt.red=new Wt(1,0,0,1);class Ba{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const ph=["bottom","center","top"];class hu{constructor(e,i,o,u,f,p){this.text=e,this.image=i,this.scale=o,this.fontStack=u,this.textColor=f,this.verticalAlign=p}}class Yn{constructor(e){this.sections=e}static fromString(e){return new Yn([new hu(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof Yn?e:Yn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Pn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Pn)return e;if(typeof e=="number")return new Pn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Pn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new Pn(wl(e.values,i.values,o))}}class Wi{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Wi)return e;if(typeof e=="number")return new Wi([e]);if(Array.isArray(e)){for(const i of e)if(typeof i!="number")return;return new Wi(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new Wi(wl(e.values,i.values,o))}}class jt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof jt)return e;if(typeof e=="string"){const o=Wt.parse(e);return o?new jt([o]):void 0}if(!Array.isArray(e))return;const i=[];for(const o of e){if(typeof o!="string")return;const u=Wt.parse(o);if(!u)return;i.push(u)}return new jt(i)}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o,u="rgb"){const f=[];if(e.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let p=0;p<e.values.length;p++)f.push(Wt.interpolate(e.values[p],i.values[p],o,u));return new jt(f)}}class Ni extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const ya=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class gn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof gn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let i=0;i<e.length;i+=2){const o=e[i],u=e[i+1];if(typeof o!="string"||!ya.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new gn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){const u=e.values,f=i.values;if(u.length!==f.length)throw new Ni(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${i.toString()}`);const p=[];for(let y=0;y<u.length;y+=2){if(u[y]!==f[y])throw new Ni(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${u[y]}, to[${y}]: ${f[y]}`);p.push(u[y]);const[x,T]=u[y+1],[E,C]=f[y+1];p.push([Qs(x,E,o),Qs(T,C,o)])}return new gn(p)}}class Cr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Cr({name:e,available:!1}):null}}class Wn{constructor(e,i,o){this.from=e,this.to=i,this.transition=o}static interpolate(e,i,o){return new Wn(e,i,o)}static parse(e){return e instanceof Wn?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Wn(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Wn(e.from,e.to,e.transition):typeof e=="string"?new Wn(e,e,1):void 0}}function ta(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function is(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Wn||n instanceof Wt||n instanceof Ba||n instanceof Yn||n instanceof Pn||n instanceof Wi||n instanceof jt||n instanceof gn||n instanceof Cr)return!0;if(Array.isArray(n)){for(const e of n)if(!is(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!is(n[e]))return!1;return!0}return!1}function Qi(n){if(n===null)return Hi;if(typeof n=="string")return Xt;if(typeof n=="boolean")return Qt;if(typeof n=="number")return ht;if(n instanceof Wt)return ea;if(n instanceof Wn)return oc;if(n instanceof Ba)return Co;if(n instanceof Yn)return Ka;if(n instanceof Pn)return ws;if(n instanceof Wi)return es;if(n instanceof jt)return Ja;if(n instanceof gn)return yl;if(n instanceof Cr)return mn;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const u=Qi(o);if(i){if(i===u)continue;i=$t;break}i=u}return xr(i||$t,e)}return Qa}function Ks(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Wt||n instanceof Wn||n instanceof Yn||n instanceof Pn||n instanceof Wi||n instanceof jt||n instanceof gn||n instanceof Cr?n.toString():JSON.stringify(n)}class ia{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!is(e[1]))return i.error("invalid value");const o=e[1];let u=Qi(o);const f=i.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new ia(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Io={string:Xt,number:ht,boolean:Qt,object:Qa};class zr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,u=1;const f=e[0];if(f==="array"){let y,x;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Io)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Io[T],u++}else y=$t;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],u++}o=xr(y,x)}else{if(!Io[f])throw new Error(`Types doesn't contain name = ${f}`);o=Io[f]}const p=[];for(;u<e.length;u++){const y=i.parse(e[u],u,$t);if(!y)return null;p.push(y)}return new zr(o,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!vl(this.type,Qi(o)))return o;if(i===this.args.length-1)throw new Ni(`Expected value to be of type ${pi(this.type)}, but found ${pi(Qi(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const kn={"to-boolean":Qt,"to-color":ea,"to-number":ht,"to-string":Xt};class Dr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(!kn[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const u=kn[o],f=[];for(let p=1;p<e.length;p++){const y=i.parse(e[p],p,$t);if(!y)return null;f.push(y)}return new Dr(u,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,o;for(const u of this.args){if(i=u.evaluate(e),o=null,i instanceof Wt)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ta(i[0],i[1],i[2],i[3]),!o))return new Wt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ni(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(e);const u=Pn.parse(i);if(u)return u}throw new Ni(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=Wi.parse(i);if(u)return u}throw new Ni(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=jt.parse(i);if(u)return u}throw new Ni(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(e);const u=gn.parse(i);if(u)return u}throw new Ni(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Ni(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return Yn.fromString(Ks(this.args[0].evaluate(e)));case"resolvedImage":return Cr.fromString(Ks(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Ks(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const du=["Unknown","Point","LineString","Polygon"];class Ro{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?du[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache.get(e);return i||(i=Wt.parse(e),this._parseColorCache.set(e,i)),i}}class Lo{constructor(e,i,o=[],u,f=new Ra,p=[]){this.registry=e,this.path=o,this.key=o.map((y=>`[${y}]`)).join(""),this.scope=f,this.errors=p,this.expectedType=u,this._isConstant=i}parse(e,i,o,u,f={}){return i?this.concat(i,o,u)._parse(e,f):this._parse(e,f)}_parse(e,i){function o(u,f,p){return p==="assert"?new zr(f,[u]):p==="coerce"?new Dr(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let p=f.parse(e,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,x=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(x.kind)||y.kind==="colorArray"&&["value","string","array"].includes(x.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))p=o(p,y,i.typeAnnotation||"coerce");else if(this.checkSubtype(y,x))return null}else p=o(p,y,i.typeAnnotation||"assert")}if(!(p instanceof ia)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const y=new Ro;try{p=new ia(p.type,p.evaluate(y))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const u=typeof e=="number"?this.path.concat(e):this.path,f=o?this.scope.concat(o):this.scope;return new Lo(this.registry,this._isConstant,u,i||null,f,this.errors)}error(e,...i){const o=`${this.key}${i.map((u=>`[${u}]`)).join("")}`;this.errors.push(new vr(o,e))}checkSubtype(e,i){const o=vl(e,i);return o&&this.error(o),o}}class Pi{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let f=1;f<e.length-1;f+=2){const p=e[f];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,f);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=i.parse(e[f+1],f+1);if(!y)return null;o.push([p,y])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return u?new Pi(o,u):null}outputDefined(){return this.result.outputDefined()}}class Js{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Js(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class ei{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,ht),u=i.parse(e[2],2,xr(i.expectedType||$t));return o&&u?new ei(u.type.itemType,o,u):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Ni(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Ni(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Ni(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Yt{constructor(e,i){this.type=Qt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,$t),u=i.parse(e[2],2,$t);return o&&u?xl(o.type,[Qt,Xt,ht,Hi,$t])?new Yt(o,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Ys(i,["boolean","string","number","null"]))throw new Ni(`Expected first argument to be of type boolean, string, number or null, but found ${pi(Qi(i))} instead.`);if(!Ys(o,["string","array"]))throw new Ni(`Expected second argument to be of type array or string, but found ${pi(Qi(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Bo{constructor(e,i,o){this.type=ht,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,$t),u=i.parse(e[2],2,$t);if(!o||!u)return null;if(!xl(o.type,[Qt,Xt,ht,Hi,$t]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,ht);return f?new Bo(o,u,f):null}return new Bo(o,u)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Ys(i,["boolean","string","number","null"]))throw new Ni(`Expected first argument to be of type boolean, string, number or null, but found ${pi(Qi(i))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),Ys(o,["string"])){const f=o.indexOf(i,u);return f===-1?-1:[...o.slice(0,f)].length}if(Ys(o,["array"]))return o.indexOf(i,u);throw new Ni(`Expected second argument to be of type array or string, but found ${pi(Qi(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class mi{constructor(e,i,o,u,f,p){this.inputType=e,this.type=i,this.input=o,this.cases=u,this.outputs=f,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const f={},p=[];for(let T=2;T<e.length-1;T+=2){let E=e[T];const C=e[T+1];Array.isArray(E)||(E=[E]);const D=i.concat(T);if(E.length===0)return D.error("Expected at least one branch label.");for(const B of E){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,Qi(B)))return null}else o=Qi(B);if(f[String(B)]!==void 0)return D.error("Branch labels must be unique.");f[String(B)]=p.length}const P=i.parse(C,T,u);if(!P)return null;u=u||P.type,p.push(P)}const y=i.parse(e[1],1,$t);if(!y)return null;const x=i.parse(e[e.length-1],e.length-1,u);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(o,y.type)?null:new mi(o,u,y,f,p,x):null}evaluate(e){const i=this.input.evaluate(e);return(Qi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class fu{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const y=i.parse(e[p],p,Qt);if(!y)return null;const x=i.parse(e[p+1],p+1,o);if(!x)return null;u.push([y,x]),o=o||x.type}const f=i.parse(e[e.length-1],e.length-1,o);if(!f)return null;if(!o)throw new Error("Can't infer output type");return new fu(o,u,f)}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class va{constructor(e,i,o,u){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,$t),u=i.parse(e[2],2,ht);if(!o||!u)return null;if(!xl(o.type,[xr($t),Xt,$t]))return i.error(`Expected first argument to be of type array or string, but found ${pi(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,ht);return f?new va(o.type,o,u,f):null}return new va(o.type,o,u)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),Ys(i,["string"]))return[...i].slice(o,u).join("");if(Ys(i,["array"]))return i.slice(o,u);throw new Ni(`Expected first argument to be of type array or string, but found ${pi(Qi(i))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function eo(n,e){const i=n.length-1;let o,u,f=0,p=i,y=0;for(;f<=p;)if(y=Math.floor((f+p)/2),o=n[y],u=n[y+1],o<=e){if(y===i||e<u)return y;f=y+1}else{if(!(o>e))throw new Ni("Input is not a number.");p=y-1}return 0}class to{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of o)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,ht);if(!o)return null;const u=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],x=e[p+1],T=p,E=p+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=i.parse(x,E,f);if(!C)return null;f=f||C.type,u.push([y,C])}return new to(f,o,u)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const f=i.length;return u>=i[f-1]?o[f-1].evaluate(e):o[eo(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Sd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var pu,mh,If=(function(){if(mh)return pu;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return mh=1,pu=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=f/p}var y=0,x=1;for(o=e,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));u++)e>f?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},pu})(),gh=Sd(If);class Pr{constructor(e,i,o,u,f){this.type=e,this.operator=i,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[p,y]of f)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,i,o,u){let f=0;if(e.name==="exponential")f=ns(i,e.base,o,u);else if(e.name==="linear")f=ns(i,1,o,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;f=new gh(p[0],p[1],p[2],p[3]).solve(ns(i,1,o,u))}return f}static parse(e,i){let[o,u,f,...p]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some((E=>typeof E!="number"||E<0||E>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,ht),!f)return null;const y=[];let x=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==Ja?i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType):x=ea;for(let T=0;T<p.length;T+=2){const E=p[T],C=p[T+1],D=T+3,P=T+4;if(typeof E!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=E)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=i.parse(C,P,x);if(!B)return null;x=x||B.type,y.push([E,B])}return La(x,ht)||La(x,oc)||La(x,ea)||La(x,ws)||La(x,es)||La(x,Ja)||La(x,yl)||La(x,xr(ht))?new Pr(x,o,u,f,y):i.error(`Type ${pi(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const f=i.length;if(u>=i[f-1])return o[f-1].evaluate(e);const p=eo(i,u),y=Pr.interpolationFactor(this.interpolation,u,i[p],i[p+1]),x=o[p].evaluate(e),T=o[p+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Qs(x,T,y);case"color":return Wt.interpolate(x,T,y);case"padding":return Pn.interpolate(x,T,y);case"colorArray":return jt.interpolate(x,T,y);case"numberArray":return Wi.interpolate(x,T,y);case"variableAnchorOffsetCollection":return gn.interpolate(x,T,y);case"array":return wl(x,T,y);case"projectionDefinition":return Wn.interpolate(x,T,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return Wt.interpolate(x,T,y,"hcl");case"colorArray":return jt.interpolate(x,T,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Wt.interpolate(x,T,y,"lab");case"colorArray":return jt.interpolate(x,T,y,"lab")}}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function ns(n,e,i,o){const u=o-i,f=n-i;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}const Ki={color:Wt.interpolate,number:Qs,padding:Pn.interpolate,numberArray:Wi.interpolate,colorArray:jt.interpolate,variableAnchorOffsetCollection:gn.interpolate,array:wl};class ko{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=null;const u=i.expectedType;u&&u.kind!=="value"&&(o=u);const f=[];for(const y of e.slice(1)){const x=i.parse(y,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,f.push(x)}if(!o)throw new Error("No output type");const p=u&&f.some((y=>vl(u,y.type)));return new ko(p?$t:o,f)}evaluate(e){let i,o=null,u=0;for(const f of this.args)if(u++,o=f.evaluate(e),o&&o instanceof Cr&&!o.available&&(i||(i=o.name),o=null,u===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function mu(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function gu(n,e,i,o){return o.compare(e,i)===0}function _n(n,e,i){const o=n!=="=="&&n!=="!=";return class o_{constructor(f,p,y){this.type=Qt,this.lhs=f,this.rhs=p,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||p.type.kind==="value"}static parse(f,p){if(f.length!==3&&f.length!==4)return p.error("Expected two or three arguments.");const y=f[0];let x=p.parse(f[1],1,$t);if(!x)return null;if(!mu(y,x.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${pi(x.type)}'.`);let T=p.parse(f[2],2,$t);if(!T)return null;if(!mu(y,T.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${pi(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${pi(x.type)}' and '${pi(T.type)}'.`);o&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new zr(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new zr(x.type,[T])));let E=null;if(f.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(f[3],3,Co),!E)return null}return new o_(x,T,E)}evaluate(f){const p=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const x=Qi(p),T=Qi(y);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new Ni(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Qi(p),T=Qi(y);if(x.kind!=="string"||T.kind!=="string")return e(f,p,y)}return this.collator?i(f,p,y,this.collator.evaluate(f)):e(f,p,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const Md=_n("==",(function(n,e,i){return e===i}),gu),cc=_n("!=",(function(n,e,i){return e!==i}),(function(n,e,i,o){return!gu(0,e,i,o)})),Ed=_n("<",(function(n,e,i){return e<i}),(function(n,e,i,o){return o.compare(e,i)<0})),Rf=_n(">",(function(n,e,i){return e>i}),(function(n,e,i,o){return o.compare(e,i)>0})),Tl=_n("<=",(function(n,e,i){return e<=i}),(function(n,e,i,o){return o.compare(e,i)<=0})),hc=_n(">=",(function(n,e,i){return e>=i}),(function(n,e,i,o){return o.compare(e,i)>=0}));class Sl{constructor(e,i,o){this.type=Co,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const u=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Qt);if(!u)return null;const f=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Qt);if(!f)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,Xt),!p)?null:new Sl(u,f,p)}evaluate(e){return new Ba(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class _h{constructor(e,i,o,u,f){this.type=Xt,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,ht);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parse(u.locale,1,Xt),!f))return null;let p=null;if(u.currency&&(p=i.parse(u.currency,1,Xt),!p))return null;let y=null;if(u["min-fraction-digits"]&&(y=i.parse(u["min-fraction-digits"],1,ht),!y))return null;let x=null;return u["max-fraction-digits"]&&(x=i.parse(u["max-fraction-digits"],1,ht),!x)?null:new _h(o,f,p,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class _u{constructor(e){this.type=Ka,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,ht),!x))return null;let T=null;if(y["text-font"]&&(T=i.parse(y["text-font"],1,xr(Xt)),!T))return null;let E=null;if(y["text-color"]&&(E=i.parse(y["text-color"],1,ea),!E))return null;let C=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!ph.includes(y["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(C=i.parse(y["vertical-align"],1,Xt),!C)return null}const D=u[u.length-1];D.scale=x,D.font=T,D.textColor=E,D.verticalAlign=C}else{const x=i.parse(e[p],1,$t);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new _u(u)}evaluate(e){return new Yn(this.sections.map((i=>{const o=i.content.evaluate(e);return Qi(o)===mn?new hu("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(e):null):new hu(Ks(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null,i.verticalAlign?i.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor),i.verticalAlign&&e(i.verticalAlign)}outputDefined(){return!1}}class Ml{constructor(e){this.type=mn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,Xt);return o?new Ml(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=Cr.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class El{constructor(e){this.type=ht,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${pi(o.type)} instead.`):new El(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Ni(`Expected value to be of type string or array, but found ${pi(Qi(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Sn=8192;function Al(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Sn),Math.round(o*u*Sn)]}function Cl(n,e){const i=Math.pow(2,e.z);return[(u=(n[0]/Sn+e.x)/i,360*u-180),(o=(n[1]/Sn+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function zl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function io(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Ad(n,e,i){const o=n[0]-e[0],u=n[1]-e[1],f=n[0]-i[0],p=n[1]-i[1];return o*p-f*u==0&&o*f<=0&&u*p<=0}function yu(n,e,i,o){return(u=[o[0]-i[0],o[1]-i[1]])[0]*(f=[e[0]-n[0],e[1]-n[1]])[1]-u[1]*f[0]!=0&&!(!fc(n,e,i,o)||!fc(i,o,n,e));var u,f}function Cd(n,e,i){for(const o of i)for(let u=0;u<o.length-1;++u)if(yu(n,e,o[u],o[u+1]))return!0;return!1}function ka(n,e,i=!1){let o=!1;for(const y of e)for(let x=0;x<y.length-1;x++){if(Ad(n,y[x],y[x+1]))return i;(f=y[x])[1]>(u=n)[1]!=(p=y[x+1])[1]>u[1]&&u[0]<(p[0]-f[0])*(u[1]-f[1])/(p[1]-f[1])+f[0]&&(o=!o)}var u,f,p;return o}function dc(n,e){for(const i of e)if(ka(n,i))return!0;return!1}function zd(n,e){for(const i of n)if(!ka(i,e))return!1;for(let i=0;i<n.length-1;++i)if(Cd(n[i],n[i+1],e))return!1;return!0}function Dd(n,e){for(const i of e)if(zd(n,i))return!0;return!1}function fc(n,e,i,o){const u=o[0]-i[0],f=o[1]-i[1],p=(n[0]-i[0])*f-u*(n[1]-i[1]),y=(e[0]-i[0])*f-u*(e[1]-i[1]);return p>0&&y<0||p<0&&y>0}function pc(n,e,i){const o=[];for(let u=0;u<n.length;u++){const f=[];for(let p=0;p<n[u].length;p++){const y=Al(n[u][p],i);zl(e,y),f.push(y)}o.push(f)}return o}function Oo(n,e,i){const o=[];for(let u=0;u<n.length;u++){const f=pc(n[u],e,i);o.push(f)}return o}function Dl(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const u=.5*o;let f=n[0]-i[0]>u?-o:i[0]-n[0]>u?o:0;f===0&&(f=n[0]-i[2]>u?-o:i[2]-n[0]>u?o:0),n[0]+=f}zl(e,n)}function Pd(n,e,i,o){const u=Math.pow(2,o.z)*Sn,f=[o.x*Sn,o.y*Sn],p=[];for(const y of n)for(const x of y){const T=[x.x+f[0],x.y+f[1]];Dl(T,e,i,u),p.push(T)}return p}function vu(n,e,i,o){const u=Math.pow(2,o.z)*Sn,f=[o.x*Sn,o.y*Sn],p=[];for(const x of n){const T=[];for(const E of x){const C=[E.x+f[0],E.y+f[1]];zl(e,C),T.push(C)}p.push(T)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of p)for(const T of x)Dl(T,e,i,u)}var y;return p}class no{constructor(e,i){this.type=Qt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(is(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const f of o.features){const{type:p,coordinates:y}=f.geometry;p==="Polygon"&&u.push(y),p==="MultiPolygon"&&u.push(...y)}if(u.length)return new no(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new no(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new no(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=pc(o.coordinates,f,p),x=Pd(i.geometry(),u,f,p);if(!io(u,f))return!1;for(const T of x)if(!ka(T,y))return!1}if(o.type==="MultiPolygon"){const y=Oo(o.coordinates,f,p),x=Pd(i.geometry(),u,f,p);if(!io(u,f))return!1;for(const T of x)if(!dc(T,y))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=pc(o.coordinates,f,p),x=vu(i.geometry(),u,f,p);if(!io(u,f))return!1;for(const T of x)if(!zd(T,y))return!1}if(o.type==="MultiPolygon"){const y=Oo(o.coordinates,f,p),x=vu(i.geometry(),u,f,p);if(!io(u,f))return!1;for(const T of x)if(!Dd(T,y))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let yh=class{constructor(n=[],e=(i,o)=>i<o?-1:i>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:i}=this,o=e[n];for(;n>0;){const u=n-1>>1,f=e[u];if(i(o,f)>=0)break;e[n]=f,n=u}e[n]=o}_down(n){const{data:e,compare:i}=this,o=this.length>>1,u=e[n];for(;n<o;){let f=1+(n<<1);const p=f+1;if(p<this.length&&i(e[p],e[f])<0&&(f=p),i(e[f],u)>=0)break;e[n]=e[f],n=f}e[n]=u}};function xu(n,e,i=0,o=n.length-1,u=vh){for(;o>i;){if(o-i>600){const x=o-i+1,T=e-i+1,E=Math.log(x),C=.5*Math.exp(2*E/3),D=.5*Math.sqrt(E*C*(x-C)/x)*(T-x/2<0?-1:1);xu(n,e,Math.max(i,Math.floor(e-T*C/x+D)),Math.min(o,Math.floor(e+(x-T)*C/x+D)),u)}const f=n[e];let p=i,y=o;for(ro(n,i,e),u(n[o],f)>0&&ro(n,i,o);p<y;){for(ro(n,p,y),p++,y--;u(n[p],f)<0;)p++;for(;u(n[y],f)>0;)y--}u(n[i],f)===0?ro(n,i,y):(y++,ro(n,y,o)),y<=e&&(i=y+1),e<=y&&(o=y-1)}}function ro(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function vh(n,e){return n<e?-1:n>e?1:0}function bu(n,e){if(n.length<=1)return[n];const i=[];let o,u;for(const f of n){const p=Lf(f);p!==0&&(f.area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[f]):o.push(f))}if(o&&i.push(o),e>1)for(let f=0;f<i.length;f++)i[f].length<=e||(xu(i[f],e,1,i[f].length-1,Id),i[f]=i[f].slice(0,e));return i}function Id(n,e){return e.area-n.area}function Lf(n){let e=0;for(let i,o,u=0,f=n.length,p=f-1;u<f;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}const Rd=1/298.257223563,wu=Rd*(2-Rd),Ld=Math.PI/180;class xh{constructor(e){const i=6378.137*Ld*1e3,o=Math.cos(e*Ld),u=1/(1-wu*(1-o*o)),f=Math.sqrt(u);this.kx=i*f*o,this.ky=i*f*u*(1-wu)}distance(e,i){const o=this.wrap(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(e,i){let o,u,f,p,y=1/0;for(let x=0;x<e.length-1;x++){let T=e[x][0],E=e[x][1],C=this.wrap(e[x+1][0]-T)*this.kx,D=(e[x+1][1]-E)*this.ky,P=0;C===0&&D===0||(P=(this.wrap(i[0]-T)*this.kx*C+(i[1]-E)*this.ky*D)/(C*C+D*D),P>1?(T=e[x+1][0],E=e[x+1][1]):P>0&&(T+=C/this.kx*P,E+=D/this.ky*P)),C=this.wrap(i[0]-T)*this.kx,D=(i[1]-E)*this.ky;const B=C*C+D*D;B<y&&(y=B,o=T,u=E,f=x,p=P)}return{point:[o,u],index:f,t:Math.max(0,Math.min(1,p))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Ur(n,e){return e[0]-n[0]}function ao(n){return n[1]-n[0]+1}function xa(n,e){return n[1]>=n[0]&&n[1]<e}function Tu(n,e){if(n[0]>n[1])return[null,null];const i=ao(n);if(e){if(i===2)return[n,null];const u=Math.floor(i/2);return[[n[0],n[0]+u],[n[0]+u,n[1]]]}if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function mc(n,e){if(!xa(e,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)zl(i,n[o]);return i}function gc(n){const e=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const o of i)zl(e,o);return e}function Su(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function _c(n,e,i){if(!Su(n)||!Su(e))return NaN;let o=0,u=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(u=n[1]-e[3]),n[3]<e[1]&&(u=e[1]-n[3]),i.distance([0,0],[o,u])}function ba(n,e,i){const o=i.pointOnLine(e,n);return i.distance(n,o.point)}function Mu(n,e,i,o,u){const f=Math.min(ba(n,[i,o],u),ba(e,[i,o],u)),p=Math.min(ba(i,[n,e],u),ba(o,[n,e],u));return Math.min(f,p)}function Eu(n,e,i,o,u){if(!xa(e,n.length)||!xa(o,i.length))return 1/0;let f=1/0;for(let p=e[0];p<e[1];++p){const y=n[p],x=n[p+1];for(let T=o[0];T<o[1];++T){const E=i[T],C=i[T+1];if(yu(y,x,E,C))return 0;f=Math.min(f,Mu(y,x,E,C,u))}}return f}function yc(n,e,i,o,u){if(!xa(e,n.length)||!xa(o,i.length))return NaN;let f=1/0;for(let p=e[0];p<=e[1];++p)for(let y=o[0];y<=o[1];++y)if(f=Math.min(f,u.distance(n[p],i[y])),f===0)return f;return f}function Bd(n,e,i){if(ka(n,e,!0))return 0;let o=1/0;for(const u of e){const f=u[0],p=u[u.length-1];if(f!==p&&(o=Math.min(o,ba(n,[p,f],i)),o===0))return o;const y=i.pointOnLine(u,n);if(o=Math.min(o,i.distance(n,y.point)),o===0)return o}return o}function Fo(n,e,i,o){if(!xa(e,n.length))return NaN;for(let f=e[0];f<=e[1];++f)if(ka(n[f],i,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f){const p=n[f],y=n[f+1];for(const x of i)for(let T=0,E=x.length,C=E-1;T<E;C=T++){const D=x[C],P=x[T];if(yu(p,y,D,P))return 0;u=Math.min(u,Mu(p,y,D,P,o))}}return u}function No(n,e){for(const i of n)for(const o of i)if(ka(o,e,!0))return!0;return!1}function bh(n,e,i,o=1/0){const u=gc(n),f=gc(e);if(o!==1/0&&_c(u,f,i)>=o)return o;if(io(u,f)){if(No(n,e))return 0}else if(No(e,n))return 0;let p=1/0;for(const y of n)for(let x=0,T=y.length,E=T-1;x<T;E=x++){const C=y[E],D=y[x];for(const P of e)for(let B=0,O=P.length,N=O-1;B<O;N=B++){const G=P[N],J=P[B];if(yu(C,D,G,J))return 0;p=Math.min(p,Mu(C,D,G,J,i))}}return p}function xi(n,e,i,o,u,f){if(!f)return;const p=_c(mc(o,f),u,i);p<e&&n.push([p,f,[0,0]])}function rs(n,e,i,o,u,f,p){if(!f||!p)return;const y=_c(mc(o,f),mc(u,p),i);y<e&&n.push([y,f,p])}function Au(n,e,i,o,u=1/0){let f=Math.min(o.distance(n[0],i[0][0]),u);if(f===0)return f;const p=new yh([[0,[0,n.length-1],[0,0]]],Ur),y=gc(i);for(;p.length>0;){const x=p.pop();if(x[0]>=f)continue;const T=x[1],E=e?50:100;if(ao(T)<=E){if(!xa(T,n.length))return NaN;if(e){const C=Fo(n,T,i,o);if(isNaN(C)||C===0)return C;f=Math.min(f,C)}else for(let C=T[0];C<=T[1];++C){const D=Bd(n[C],i,o);if(f=Math.min(f,D),f===0)return 0}}else{const C=Tu(T,e);xi(p,f,o,n,y,C[0]),xi(p,f,o,n,y,C[1])}}return f}function Cu(n,e,i,o,u,f=1/0){let p=Math.min(f,u.distance(n[0],i[0]));if(p===0)return p;const y=new yh([[0,[0,n.length-1],[0,i.length-1]]],Ur);for(;y.length>0;){const x=y.pop();if(x[0]>=p)continue;const T=x[1],E=x[2],C=e?50:100,D=o?50:100;if(ao(T)<=C&&ao(E)<=D){if(!xa(T,n.length)&&xa(E,i.length))return NaN;let P;if(e&&o)P=Eu(n,T,i,E,u),p=Math.min(p,P);else if(e&&!o){const B=n.slice(T[0],T[1]+1);for(let O=E[0];O<=E[1];++O)if(P=ba(i[O],B,u),p=Math.min(p,P),p===0)return p}else if(!e&&o){const B=i.slice(E[0],E[1]+1);for(let O=T[0];O<=T[1];++O)if(P=ba(n[O],B,u),p=Math.min(p,P),p===0)return p}else P=yc(n,T,i,E,u),p=Math.min(p,P)}else{const P=Tu(T,e),B=Tu(E,o);rs(y,p,u,n,i,P[0],B[0]),rs(y,p,u,n,i,P[0],B[1]),rs(y,p,u,n,i,P[1],B[0]),rs(y,p,u,n,i,P[1],B[1])}}return p}function vc(n){return n.type==="MultiPolygon"?n.coordinates.map((e=>({type:"Polygon",coordinates:e}))):n.type==="MultiLineString"?n.coordinates.map((e=>({type:"LineString",coordinates:e}))):n.type==="MultiPoint"?n.coordinates.map((e=>({type:"Point",coordinates:e}))):[n]}class jo{constructor(e,i){this.type=ht,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(is(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new jo(o,o.features.map((u=>vc(u.geometry))).flat());if(o.type==="Feature")return new jo(o,vc(o.geometry));if("type"in o&&"coordinates"in o)return new jo(o,vc(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=i.geometry(),f=u.flat().map((x=>Cl([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new xh(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Cu(f,!1,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Cu(f,!1,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Au(f,!1,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=i.geometry(),f=u.flat().map((x=>Cl([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new xh(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Cu(f,!0,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Cu(f,!0,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Au(f,!0,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(i,o){const u=i.geometry();if(u.length===0||u[0].length===0)return NaN;const f=bu(u,0).map((x=>x.map((T=>T.map((E=>Cl([E.x,E.y],i.canonical))))))),p=new xh(f[0][0][0][1]);let y=1/0;for(const x of o)for(const T of f){switch(x.type){case"Point":y=Math.min(y,Au([x.coordinates],!1,T,p,y));break;case"LineString":y=Math.min(y,Au(x.coordinates,!0,T,p,y));break;case"Polygon":y=Math.min(y,bh(T,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class zu{constructor(e){this.type=$t,this.key=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new zu(o)}evaluate(e){var i;const o=(i=e.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?bl(o,this.key):null}eachChild(){}outputDefined(){return!1}}const Pl={"==":Md,"!=":cc,">":Rf,"<":Ed,">=":hc,"<=":Tl,array:zr,at:ei,boolean:zr,case:fu,coalesce:ko,collator:Sl,format:_u,image:Ml,in:Yt,"index-of":Bo,interpolate:Pr,"interpolate-hcl":Pr,"interpolate-lab":Pr,length:El,let:Pi,literal:ia,match:mi,number:zr,"number-format":_h,object:zr,slice:va,step:to,string:zr,"to-boolean":Dr,"to-color":Dr,"to-number":Dr,"to-string":Dr,var:Js,within:no,distance:jo,"global-state":zu};class na{constructor(e,i,o,u){this.name=e,this.type=i,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const o=e[0],u=na.definitions[o];if(!u)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=p.filter((([T])=>!Array.isArray(T)||T.length===e.length-1));let x=null;for(const[T,E]of y){x=new Lo(i.registry,Ir,i.path,null,i.scope);const C=[];let D=!1;for(let P=1;P<e.length;P++){const B=e[P],O=Array.isArray(T)?T[P-1]:T.type,N=x.parse(B,1+C.length,O);if(!N){D=!0;break}C.push(N)}if(!D)if(Array.isArray(T)&&T.length!==C.length)x.error(`Expected ${T.length} arguments, but found ${C.length} instead.`);else{for(let P=0;P<C.length;P++){const B=Array.isArray(T)?T[P]:T.type,O=C[P];x.concat(P+1).checkSubtype(B,O.type)}if(x.errors.length===0)return new na(o,f,E,C)}}if(y.length===1)i.errors.push(...x.errors);else{const T=(y.length?y:p).map((([C])=>{return D=C,Array.isArray(D)?`(${D.map(pi).join(", ")})`:`(${pi(D.type)}...)`;var D})).join(" | "),E=[];for(let C=1;C<e.length;C++){const D=i.parse(e[C],1+E.length);if(!D)return null;E.push(pi(D.type))}i.error(`Expected arguments of type ${T}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){na.definitions=i;for(const o in i)e[o]=na}}function wh(n,[e,i,o,u]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const f=u?u.evaluate(n):1,p=ta(e,i,o,f);if(p)throw new Ni(p);return new Wt(e/255,i/255,o/255,f,!1)}function xc(n,e){return n in e}function ra(n,e){const i=e[n];return i===void 0?null:i}function as(n){return{type:n}}function Ir(n){if(n instanceof Js)return Ir(n.boundExpression);if(n instanceof na&&n.name==="error"||n instanceof Sl||n instanceof no||n instanceof jo||n instanceof zu)return!1;const e=n instanceof Dr||n instanceof zr;let i=!0;return n.eachChild((o=>{i=e?i&&Ir(o):i&&o instanceof ia})),!!i&&Ms(n)&&Uo(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Ms(n){if(n instanceof na&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof no||n instanceof jo)return!1;let e=!0;return n.eachChild((i=>{e&&!Ms(i)&&(e=!1)})),e}function Vo(n){if(n instanceof na&&n.name==="feature-state")return!1;let e=!0;return n.eachChild((i=>{e&&!Vo(i)&&(e=!1)})),e}function Uo(n,e){if(n instanceof na&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild((o=>{i&&!Uo(o,e)&&(i=!1)})),i}function Du(n){return{result:"success",value:n}}function so(n){return{result:"error",value:n}}function wa(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Th(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Il(n){return!!n.expression&&n.expression.interpolated}function Kt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function bc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Qi(n)===Qa}function aa(n){return n}function wc(n,e){const i=n.stops&&typeof n.stops[0][0]=="object",o=i||!(i||n.property!==void 0),u=n.type||(Il(e)?"exponential":"interval"),f=(function(E){switch(E.type){case"color":return Wt.parse;case"padding":return Pn.parse;case"numberArray":return Wi.parse;case"colorArray":return jt.parse;default:return null}})(e);if(f&&((n=yr({},n)).stops&&(n.stops=n.stops.map((E=>[E[0],f(E[1])]))),n.default=f(n.default?n.default:e.default)),n.colorSpace&&(p=n.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var p;const y=(function(E){switch(E){case"exponential":return oo;case"interval":return Tc;case"categorical":return kd;case"identity":return Sh;default:throw new Error(`Unknown function type "${E}"`)}})(u);let x,T;if(u==="categorical"){x=Object.create(null);for(const E of n.stops)x[E[0]]=E[1];T=typeof n.stops[0][0]}if(i){const E={},C=[];for(let B=0;B<n.stops.length;B++){const O=n.stops[B],N=O[0].zoom;E[N]===void 0&&(E[N]={zoom:N,type:n.type,property:n.property,default:n.default,stops:[]},C.push(N)),E[N].stops.push([O[0].value,O[1]])}const D=[];for(const B of C)D.push([E[B].zoom,wc(E[B],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Pr.interpolationFactor.bind(void 0,P),zoomStops:D.map((B=>B[0])),evaluate:({zoom:B},O)=>oo({stops:D,base:n.base},e,B).evaluate(B,O)}}if(o){const E=u==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Pr.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map((C=>C[0])),evaluate:({zoom:C})=>y(n,e,C,x,T)}}return{kind:"source",evaluate(E,C){const D=C&&C.properties?C.properties[n.property]:void 0;return D===void 0?sa(n.default,e.default):y(n,e,D,x,T)}}}function sa(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function kd(n,e,i,o,u){return sa(typeof i===u?o[i]:void 0,n.default,e.default)}function Tc(n,e,i){if(Kt(i)!=="number")return sa(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const u=eo(n.stops.map((f=>f[0])),i);return n.stops[u][1]}function oo(n,e,i){const o=n.base!==void 0?n.base:1;if(Kt(i)!=="number")return sa(n.default,e.default);const u=n.stops.length;if(u===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const f=eo(n.stops.map((E=>E[0])),i),p=(function(E,C,D,P){const B=P-D,O=E-D;return B===0?0:C===1?O/B:(Math.pow(C,O)-1)/(Math.pow(C,B)-1)})(i,o,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],x=n.stops[f+1][1],T=Ki[e.type]||aa;return typeof y.evaluate=="function"?{evaluate(...E){const C=y.evaluate.apply(void 0,E),D=x.evaluate.apply(void 0,E);if(C!==void 0&&D!==void 0)return T(C,D,p,n.colorSpace)}}:T(y,x,p,n.colorSpace)}function Sh(n,e,i){switch(e.type){case"color":i=Wt.parse(i);break;case"formatted":i=Yn.fromString(i.toString());break;case"resolvedImage":i=Cr.fromString(i.toString());break;case"padding":i=Pn.parse(i);break;case"colorArray":i=jt.parse(i);break;case"numberArray":i=Wi.parse(i);break;default:Kt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return sa(i,n.default,e.default)}na.register(Pl,{error:[{kind:"error"},[Xt],(n,[e])=>{throw new Ni(e.evaluate(n))}],typeof:[Xt,[$t],(n,[e])=>pi(Qi(e.evaluate(n)))],"to-rgba":[xr(ht,4),[ea],(n,[e])=>{const[i,o,u,f]=e.evaluate(n).rgb;return[255*i,255*o,255*u,f]}],rgb:[ea,[ht,ht,ht],wh],rgba:[ea,[ht,ht,ht,ht],wh],has:{type:Qt,overloads:[[[Xt],(n,[e])=>xc(e.evaluate(n),n.properties())],[[Xt,Qa],(n,[e,i])=>xc(e.evaluate(n),i.evaluate(n))]]},get:{type:$t,overloads:[[[Xt],(n,[e])=>ra(e.evaluate(n),n.properties())],[[Xt,Qa],(n,[e,i])=>ra(e.evaluate(n),i.evaluate(n))]]},"feature-state":[$t,[Xt],(n,[e])=>ra(e.evaluate(n),n.featureState||{})],properties:[Qa,[],n=>n.properties()],"geometry-type":[Xt,[],n=>n.geometryType()],id:[$t,[],n=>n.id()],zoom:[ht,[],n=>n.globals.zoom],"heatmap-density":[ht,[],n=>n.globals.heatmapDensity||0],elevation:[ht,[],n=>n.globals.elevation||0],"line-progress":[ht,[],n=>n.globals.lineProgress||0],accumulated:[$t,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[ht,as(ht),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[ht,as(ht),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:ht,overloads:[[[ht,ht],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[ht],(n,[e])=>-e.evaluate(n)]]},"/":[ht,[ht,ht],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[ht,[ht,ht],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[ht,[],()=>Math.LN2],pi:[ht,[],()=>Math.PI],e:[ht,[],()=>Math.E],"^":[ht,[ht,ht],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[ht,[ht],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[ht,[ht],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[ht,[ht],(n,[e])=>Math.log(e.evaluate(n))],log2:[ht,[ht],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[ht,[ht],(n,[e])=>Math.sin(e.evaluate(n))],cos:[ht,[ht],(n,[e])=>Math.cos(e.evaluate(n))],tan:[ht,[ht],(n,[e])=>Math.tan(e.evaluate(n))],asin:[ht,[ht],(n,[e])=>Math.asin(e.evaluate(n))],acos:[ht,[ht],(n,[e])=>Math.acos(e.evaluate(n))],atan:[ht,[ht],(n,[e])=>Math.atan(e.evaluate(n))],min:[ht,as(ht),(n,e)=>Math.min(...e.map((i=>i.evaluate(n))))],max:[ht,as(ht),(n,e)=>Math.max(...e.map((i=>i.evaluate(n))))],abs:[ht,[ht],(n,[e])=>Math.abs(e.evaluate(n))],round:[ht,[ht],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[ht,[ht],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[ht,[ht],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Qt,[Xt,$t],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Qt,[$t],(n,[e])=>n.id()===e.value],"filter-type-==":[Qt,[Xt],(n,[e])=>n.geometryType()===e.value],"filter-<":[Qt,[Xt,$t],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Qt,[$t],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Qt,[Xt,$t],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>u}],"filter-id->":[Qt,[$t],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Qt,[Xt,$t],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Qt,[$t],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Qt,[Xt,$t],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Qt,[$t],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Qt,[$t],(n,[e])=>e.value in n.properties()],"filter-has-id":[Qt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Qt,[xr(Xt)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Qt,[xr($t)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Qt,[Xt,xr($t)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Qt,[Xt,xr($t)],(n,[e,i])=>(function(o,u,f,p){for(;f<=p;){const y=f+p>>1;if(u[y]===o)return!0;u[y]>o?p=y-1:f=y+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Qt,overloads:[[[Qt,Qt],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[as(Qt),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Qt,overloads:[[[Qt,Qt],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[as(Qt),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Qt,[Qt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Qt,[Xt],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Xt,[Xt],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Xt,[Xt],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Xt,as($t),(n,e)=>e.map((i=>Ks(i.evaluate(n)))).join("")],"resolved-locale":[Xt,[Co],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Sc{constructor(e,i,o){this.expression=e,this._warningHistory={},this._evaluator=new Ro,this._defaultValue=i?(function(u){if(u.type==="color"&&bc(u.default))return new Wt(0,0,0,0);switch(u.type){case"color":return Wt.parse(u.default)||null;case"padding":return Pn.parse(u.default)||null;case"numberArray":return Wi.parse(u.default)||null;case"colorArray":return jt.parse(u.default)||null;case"variableAnchorOffsetCollection":return gn.parse(u.default)||null;case"projectionDefinition":return Wn.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=ir(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,u,f,p){this._globalState&&(e=ir(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Ni(`Expected value to be one of ${Object.keys(this._enumValues).map((x=>JSON.stringify(x))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function lo(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Pl}function Pu(n,e,i){const o=new Lo(Pl,Ir,[],e?(function(f){const p={color:ea,string:Xt,number:ht,enum:Xt,boolean:Qt,formatted:Ka,padding:ws,numberArray:es,colorArray:Ja,projectionDefinition:oc,resolvedImage:mn,variableAnchorOffsetCollection:yl};return f.type==="array"?xr(p[f.value]||$t,f.length):p[f.type]})(e):void 0),u=o.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Du(new Sc(u,e,i)):so(o.errors)}class Rr{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Vo(i.expression),this.globalStateRefs=tr(i.expression),this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=ir(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,f,p)}evaluate(e,i,o,u,f,p){return this._globalState&&(e=ir(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,f,p)}}class uo{constructor(e,i,o,u,f){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Vo(i.expression),this.globalStateRefs=tr(i.expression),this.interpolationType=u,this._globalState=f}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=ir(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,f,p)}evaluate(e,i,o,u,f,p){return this._globalState&&(e=ir(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,f,p)}interpolationFactor(e,i,o){return this.interpolationType?Pr.interpolationFactor(this.interpolationType,e,i,o):0}}function co(n,e,i){const o=Pu(n,e,i);if(o.result==="error")return o;const u=o.value.expression,f=Ms(u);if(!f&&!wa(e))return so([new vr("","data expressions not supported")]);const p=Uo(u,["zoom"]);if(!p&&!Th(e))return so([new vr("","zoom expressions not supported")]);const y=ho(u);return y||p?y instanceof vr?so([y]):y instanceof Pr&&!Il(e)?so([new vr("",'"interpolate" expressions cannot be used with this property')]):Du(y?new uo(f?"camera":"composite",o.value,y.labels,y instanceof Pr?y.interpolation:void 0,i):new Rr(f?"constant":"source",o.value,i)):so([new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Go{constructor(e,i){this._parameters=e,this._specification=i,yr(this,wc(this._parameters,this._specification))}static deserialize(e){return new Go(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ho(n){let e=null;if(n instanceof Pi)e=ho(n.result);else if(n instanceof ko){for(const i of n.args)if(e=ho(i),e)break}else(n instanceof to||n instanceof Pr)&&n.input instanceof na&&n.input.name==="zoom"&&(e=n);return e instanceof vr||n.eachChild((i=>{const o=ho(i);o instanceof vr?e=o:!e&&o?e=new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function tr(n,e=new Set){return n instanceof zu&&e.add(n.key),n.eachChild((i=>{tr(i,e)})),e}function ir(n,e){const{zoom:i,heatmapDensity:o,elevation:u,lineProgress:f,isSupportedScript:p,accumulated:y}=n??{};return{zoom:i,heatmapDensity:o,elevation:u,lineProgress:f,isSupportedScript:p,accumulated:y,globalState:e}}function ss(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!ss(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const os={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Gr(n,e){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};ss(n)||(n=qo(n));const i=Pu(n,os,e);if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,f)=>i.value.evaluate(o,u,{},f),needGeometry:Mh(n),getGlobalStateRefs:()=>tr(i.value.expression)}}function Es(n,e){return n<e?-1:n>e?1:0}function Mh(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(Mh(n[e]))return!0;return!1}function qo(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Rl(n[1],n[2],"=="):e==="!="?ji(Rl(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Rl(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(qo))):e==="all"?["all"].concat(n.slice(1).map(qo)):e==="none"?["all"].concat(n.slice(1).map(qo).map(ji)):e==="in"?Eh(n[1],n.slice(2)):e==="!in"?ji(Eh(n[1],n.slice(2))):e==="has"?nr(n[1]):e!=="!has"||ji(nr(n[1]));var i}function Rl(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Eh(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",n,["literal",e.sort(Es)]]:["filter-in-small",n,["literal",e]]}}function nr(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ji(n){return["!",n]}function oi(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let u="[";for(const f of n)u+=`${oi(f)},`;return`${u}]`}const i=Object.keys(n).sort();let o="{";for(let u=0;u<i.length;u++)o+=`${JSON.stringify(i[u])}:${oi(n[i[u]])},`;return`${o}}`}function As(n){let e="";for(const i of Ci)e+=`/${oi(n[i])}`;return e}function oa(n){const e=n.value;return e?[new ot(n.key,e,"constants have been deprecated as of v8")]:[]}function sn(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function qr(n){if(Array.isArray(n))return n.map(qr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=qr(n[i]);return e}return sn(n)}function la(n){const e=n.key,i=n.value,o=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,p=n.styleSpec,y=n.validateSpec;let x=[];const T=Kt(i);if(T!=="object")return[new ot(e,i,`object expected, ${T} found`)];for(const E in i){const C=E.split(".")[0],D=bl(o,C)||o["*"];let P;if(bl(u,C))P=u[C];else if(bl(o,C))P=y;else if(u["*"])P=u["*"];else{if(!o["*"]){x.push(new ot(e,i[E],`unknown property "${E}"`));continue}P=y}x=x.concat(P({key:(e&&`${e}.`)+E,value:i[E],valueSpec:D,style:f,styleSpec:p,object:i,objectKey:E,validateSpec:y},i))}for(const E in o)u[E]||o[E].required&&o[E].default===void 0&&i[E]===void 0&&x.push(new ot(e,i,`missing required property "${E}"`));return x}function Iu(n){const e=n.value,i=n.valueSpec,o=n.style,u=n.styleSpec,f=n.key,p=n.arrayElementValidator||n.validateSpec;if(Kt(e)!=="array")return[new ot(f,e,`array expected, ${Kt(e)} found`)];if(i.length&&e.length!==i.length)return[new ot(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new ot(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let y={type:i.value,values:i.values};u.$version<7&&(y.function=i.function),Kt(i.value)==="object"&&(y=i.value);let x=[];for(let T=0;T<e.length;T++)x=x.concat(p({array:e,arrayIndex:T,value:e[T],valueSpec:y,validateSpec:n.validateSpec,style:o,styleSpec:u,key:`${f}[${T}]`}));return x}function ls(n){const e=n.key,i=n.value,o=n.valueSpec;let u=Kt(i);return u==="number"&&i!=i&&(u="NaN"),u!=="number"?[new ot(e,i,`number expected, ${u} found`)]:"minimum"in o&&i<o.minimum?[new ot(e,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new ot(e,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function us(n){const e=n.valueSpec,i=sn(n.value.type);let o,u,f,p={};const y=i!=="categorical"&&n.value.property===void 0,x=!y,T=Kt(n.value.stops)==="array"&&Kt(n.value.stops[0])==="array"&&Kt(n.value.stops[0][0])==="object",E=la({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(P){if(i==="identity")return[new ot(P.key,P.value,'identity function may not have a "stops" property')];let B=[];const O=P.value;return B=B.concat(Iu({key:P.key,value:O,valueSpec:P.valueSpec,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,arrayElementValidator:C})),Kt(O)==="array"&&O.length===0&&B.push(new ot(P.key,O,"array must have at least one stop")),B},default:function(P){return P.validateSpec({key:P.key,value:P.value,valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec})}}});return i==="identity"&&y&&E.push(new ot(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||E.push(new ot(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!Il(n.valueSpec)&&E.push(new ot(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!wa(n.valueSpec)?E.push(new ot(n.key,n.value,"property functions not supported")):y&&!Th(n.valueSpec)&&E.push(new ot(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!T||n.value.property!==void 0||E.push(new ot(n.key,n.value,'"property" property is required')),E;function C(P){let B=[];const O=P.value,N=P.key;if(Kt(O)!=="array")return[new ot(N,O,`array expected, ${Kt(O)} found`)];if(O.length!==2)return[new ot(N,O,`array length 2 expected, length ${O.length} found`)];if(T){if(Kt(O[0])!=="object")return[new ot(N,O,`object expected, ${Kt(O[0])} found`)];if(O[0].zoom===void 0)return[new ot(N,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new ot(N,O,"object stop key must have value")];if(f&&f>sn(O[0].zoom))return[new ot(N,O[0].zoom,"stop zoom values must appear in ascending order")];sn(O[0].zoom)!==f&&(f=sn(O[0].zoom),u=void 0,p={}),B=B.concat(la({key:`${N}[0]`,value:O[0],valueSpec:{zoom:{}},validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec,objectElementValidators:{zoom:ls,value:D}}))}else B=B.concat(D({key:`${N}[0]`,value:O[0],validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec},O));return lo(qr(O[1]))?B.concat([new ot(`${N}[1]`,O[1],"expressions are not allowed in function stops.")]):B.concat(P.validateSpec({key:`${N}[1]`,value:O[1],valueSpec:e,validateSpec:P.validateSpec,style:P.style,styleSpec:P.styleSpec}))}function D(P,B){const O=Kt(P.value),N=sn(P.value),G=P.value!==null?P.value:B;if(o){if(O!==o)return[new ot(P.key,G,`${O} stop domain type must match previous stop domain type ${o}`)]}else o=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new ot(P.key,G,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&i!=="categorical"){let J=`number expected, ${O} found`;return wa(e)&&i===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ot(P.key,G,J)]}return i!=="categorical"||O!=="number"||isFinite(N)&&Math.floor(N)===N?i!=="categorical"&&O==="number"&&u!==void 0&&N<u?[new ot(P.key,G,"stop domain values must appear in ascending order")]:(u=N,i==="categorical"&&N in p?[new ot(P.key,G,"stop domain values must be unique")]:(p[N]=!0,[])):[new ot(P.key,G,`integer expected, found ${N}`)]}}function cs(n){const e=(n.expressionContext==="property"?co:Pu)(qr(n.value),n.valueSpec);if(e.result==="error")return e.value.map((o=>new ot(`${n.key}${o.key}`,n.value,o.message)));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new ot(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Vo(i))return[new ot(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Vo(i))return[new ot(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Uo(i,["zoom","feature-state"]))return[new ot(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!Ms(i))return[new ot(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cs(n){const e=n.key,i=n.value,o=Kt(i);return o!=="string"?[new ot(e,i,`color expected, ${o} found`)]:Wt.parse(String(i))?[]:[new ot(e,i,`color expected, "${i}" found`)]}function zs(n){const e=n.key,i=n.value,o=n.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(sn(i))===-1&&u.push(new ot(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(sn(i))===-1&&u.push(new ot(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function Ta(n){return ss(qr(n.value))?cs(yr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):hs(n)}function hs(n){const e=n.value,i=n.key;if(Kt(e)!=="array")return[new ot(i,e,`array expected, ${Kt(e)} found`)];const o=n.styleSpec;let u,f=[];if(e.length<1)return[new ot(i,e,"filter array must have at least 1 element")];switch(f=f.concat(zs({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),sn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&sn(e[1])==="$type"&&f.push(new ot(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new ot(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Kt(e[1]),u!=="string"&&f.push(new ot(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let p=2;p<e.length;p++)u=Kt(e[p]),sn(e[1])==="$type"?f=f.concat(zs({key:`${i}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new ot(`${i}[${p}]`,e[p],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)f=f.concat(hs({key:`${i}[${p}]`,value:e[p],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Kt(e[1]),e.length!==2?f.push(new ot(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new ot(`${i}[1]`,e[1],`string expected, ${u} found`))}return f}function Ds(n,e){const i=n.key,o=n.validateSpec,u=n.style,f=n.styleSpec,p=n.value,y=n.objectKey,x=f[`${e}_${n.layerType}`];if(!x)return[];const T=y.match(/^(.*)-transition$/);if(e==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return o({key:i,value:p,valueSpec:f.transition,style:u,styleSpec:f});const E=n.valueSpec||x[y];if(!E)return[new ot(i,p,`unknown property "${y}"`)];let C;if(Kt(p)==="string"&&wa(E)&&!E.tokens&&(C=/^{([^}]+)}$/.exec(p)))return[new ot(i,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const D=[];return n.layerType==="symbol"&&y==="text-font"&&bc(qr(p))&&sn(p.type)==="identity"&&D.push(new ot(i,p,'"text-font" does not support identity functions')),D.concat(o({key:n.key,value:p,valueSpec:E,style:u,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:y}))}function ds(n){return Ds(n,"paint")}function Mc(n){return Ds(n,"layout")}function Ec(n){let e=[];const i=n.value,o=n.key,u=n.style,f=n.styleSpec;if(Kt(i)!=="object")return[new ot(o,i,`object expected, ${Kt(i)} found`)];i.type||i.ref||e.push(new ot(o,i,'either "type" or "ref" is required'));let p=sn(i.type);const y=sn(i.ref);if(i.id){const x=sn(i.id);for(let T=0;T<n.arrayIndex;T++){const E=u.layers[T];sn(E.id)===x&&e.push(new ot(o,i.id,`duplicate layer id "${i.id}", previously used at line ${E.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach((T=>{T in i&&e.push(new ot(o,i[T],`"${T}" is prohibited for ref layers`))})),u.layers.forEach((T=>{sn(T.id)===y&&(x=T)})),x?x.ref?e.push(new ot(o,i.ref,"ref cannot reference another ref layer")):p=sn(x.type):e.push(new ot(o,i.ref,`ref layer "${y}" not found`))}else if(p!=="background")if(i.source){const x=u.sources&&u.sources[i.source],T=x&&sn(x.type);x?T==="vector"&&p==="raster"?e.push(new ot(o,i.source,`layer "${i.id}" requires a raster source`)):T!=="raster-dem"&&p==="hillshade"||T!=="raster-dem"&&p==="color-relief"?e.push(new ot(o,i.source,`layer "${i.id}" requires a raster-dem source`)):T==="raster"&&p!=="raster"?e.push(new ot(o,i.source,`layer "${i.id}" requires a vector source`)):T!=="vector"||i["source-layer"]?T==="raster-dem"&&p!=="hillshade"&&p!=="color-relief"?e.push(new ot(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):p!=="line"||!i.paint||!i.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||e.push(new ot(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ot(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new ot(o,i.source,`source "${i.source}" not found`))}else e.push(new ot(o,i,'missing required property "source"'));return e=e.concat(la({key:o,value:i,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:i.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:Ta,layout:x=>la({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>Mc(yr({layerType:p},T))}}),paint:x=>la({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>ds(yr({layerType:p},T))}})}})),e}function Sa(n){const e=n.value,i=n.key,o=Kt(e);return o!=="string"?[new ot(i,e,`string expected, ${o} found`)]:[]}const Ll={promoteId:function({key:n,value:e}){if(Kt(e)==="string")return Sa({key:n,value:e});{const i=[];for(const o in e)i.push(...Sa({key:`${n}.${o}`,value:e[o]}));return i}}};function Ps(n){const e=n.value,i=n.key,o=n.styleSpec,u=n.style,f=n.validateSpec;if(!e.type)return[new ot(i,e,'"type" is required')];const p=sn(e.type);let y;switch(p){case"vector":case"raster":return y=la({key:i,value:e,valueSpec:o[`source_${p.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:Ll,validateSpec:f}),y;case"raster-dem":return y=(function(x){var T;const E=(T=x.sourceName)!==null&&T!==void 0?T:"",C=x.value,D=x.styleSpec,P=D.source_raster_dem,B=x.style;let O=[];const N=Kt(C);if(C===void 0)return O;if(N!=="object")return O.push(new ot("source_raster_dem",C,`object expected, ${N} found`)),O;const G=sn(C.encoding)==="custom",J=["redFactor","greenFactor","blueFactor","baseShift"],q=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const $ in C)!G&&J.includes($)?O.push(new ot($,C[$],`In "${E}": "${$}" is only valid when "encoding" is set to "custom". ${q} encoding found`)):P[$]?O=O.concat(x.validateSpec({key:$,value:C[$],valueSpec:P[$],validateSpec:x.validateSpec,style:B,styleSpec:D})):O.push(new ot($,C[$],`unknown property "${$}"`));return O})({sourceName:i,value:e,style:n.style,styleSpec:o,validateSpec:f}),y;case"geojson":if(y=la({key:i,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:f,objectElementValidators:Ll}),e.cluster)for(const x in e.clusterProperties){const[T,E]=e.clusterProperties[x],C=typeof T=="string"?[T,["accumulated"],["get",x]]:T;y.push(...cs({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),y.push(...cs({key:`${i}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return la({key:i,value:e,valueSpec:o.source_video,style:u,validateSpec:f,styleSpec:o});case"image":return la({key:i,value:e,valueSpec:o.source_image,style:u,validateSpec:f,styleSpec:o});case"canvas":return[new ot(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zs({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function In(n){const e=n.value,i=n.styleSpec,o=i.light,u=n.style;let f=[];const p=Kt(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new ot("light",e,`object expected, ${p} found`)]),f;for(const y in e){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&o[x[1]]&&o[x[1]].transition?n.validateSpec({key:y,value:e[y],valueSpec:i.transition,validateSpec:n.validateSpec,style:u,styleSpec:i}):o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new ot(y,e[y],`unknown property "${y}"`)])}return f}function Ru(n){const e=n.value,i=n.styleSpec,o=i.sky,u=n.style,f=Kt(e);if(e===void 0)return[];if(f!=="object")return[new ot("sky",e,`object expected, ${f} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new ot(y,e[y],`unknown property "${y}"`)]);return p}function Ac(n){const e=n.value,i=n.styleSpec,o=i.terrain,u=n.style;let f=[];const p=Kt(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new ot("terrain",e,`object expected, ${p} found`)]),f;for(const y in e)f=f.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new ot(y,e[y],`unknown property "${y}"`)]);return f}function Ah(n){let e=[];const i=n.value,o=n.key;if(Array.isArray(i)){const u=[],f=[];for(const p in i)i[p].id&&u.includes(i[p].id)&&e.push(new ot(o,i,`all the sprites' ids must be unique, but ${i[p].id} is duplicated`)),u.push(i[p].id),i[p].url&&f.includes(i[p].url)&&e.push(new ot(o,i,`all the sprites' URLs must be unique, but ${i[p].url} is duplicated`)),f.push(i[p].url),e=e.concat(la({key:`${o}[${p}]`,value:i[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return Sa({key:o,value:i})}function Od(n){return e=n.value,e&&e.constructor===Object?[]:[new ot(n.key,n.value,`object expected, ${Kt(n.value)} found`)];var e}const Ch={"*":()=>[],array:Iu,boolean:function(n){const e=n.value,i=n.key,o=Kt(e);return o!=="boolean"?[new ot(i,e,`boolean expected, ${o} found`)]:[]},number:ls,color:Cs,constants:oa,enum:zs,filter:Ta,function:us,layer:Ec,object:la,source:Ps,light:In,sky:Ru,terrain:Ac,projection:function(n){const e=n.value,i=n.styleSpec,o=i.projection,u=n.style,f=Kt(e);if(e===void 0)return[];if(f!=="object")return[new ot("projection",e,`object expected, ${f} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new ot(y,e[y],`unknown property "${y}"`)]);return p},projectionDefinition:function(n){const e=n.key;let i=n.value;i=i instanceof String?i.valueOf():i;const o=Kt(i);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(i)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(i)?["array","string"].includes(o)?[]:[new ot(e,i,`projection expected, invalid type "${o}" found`)]:[new ot(e,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Sa,formatted:function(n){return Sa(n).length===0?[]:cs(n)},resolvedImage:function(n){return Sa(n).length===0?[]:cs(n)},padding:function(n){const e=n.key,i=n.value;if(Kt(i)==="array"){if(i.length<1||i.length>4)return[new ot(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let u=[];for(let f=0;f<i.length;f++)u=u.concat(n.validateSpec({key:`${e}[${f}]`,value:i[f],validateSpec:n.validateSpec,valueSpec:o}));return u}return ls({key:e,value:i,valueSpec:{}})},numberArray:function(n){const e=n.key,i=n.value;if(Kt(i)==="array"){const o={type:"number"};if(i.length<1)return[new ot(e,i,"array length at least 1 expected, length 0 found")];let u=[];for(let f=0;f<i.length;f++)u=u.concat(n.validateSpec({key:`${e}[${f}]`,value:i[f],validateSpec:n.validateSpec,valueSpec:o}));return u}return ls({key:e,value:i,valueSpec:{}})},colorArray:function(n){const e=n.key,i=n.value;if(Kt(i)==="array"){if(i.length<1)return[new ot(e,i,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<i.length;u++)o=o.concat(Cs({key:`${e}[${u}]`,value:i[u]}));return o}return Cs({key:e,value:i})},variableAnchorOffsetCollection:function(n){const e=n.key,i=n.value,o=Kt(i),u=n.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new ot(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let p=0;p<i.length;p+=2)f=f.concat(zs({key:`${e}[${p}]`,value:i[p],valueSpec:u.layout_symbol["text-anchor"]})),f=f.concat(Iu({key:`${e}[${p+1}]`,value:i[p+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:u}));return f},sprite:Ah,state:Od};function on(n){const e=n.value,i=n.valueSpec,o=n.styleSpec;return n.validateSpec=on,i.expression&&bc(sn(e))?us(n):i.expression&&lo(qr(e))?cs(n):i.type&&Ch[i.type]?Ch[i.type](n):la(yr({},n,{valueSpec:i.type?o[i.type]:i}))}function fo(n){const e=n.value,i=n.key,o=Sa(n);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new ot(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new ot(i,e,'"glyphs" url must include a "{range}" token'))),o}function br(n,e=be){let i=[];return i=i.concat(on({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:on,objectElementValidators:{glyphs:fo,"*":()=>[]}})),n.constants&&(i=i.concat(oa({key:"constants",value:n.constants}))),Cc(i)}function Lr(n){return function(e){return n(Object.assign({},e,{validateSpec:on}))}}function Cc(n){return[].concat(n).sort(((e,i)=>e.line-i.line))}function wr(n){return function(...e){return Cc(n.apply(this,e))}}br.source=wr(Lr(Ps)),br.sprite=wr(Lr(Ah)),br.glyphs=wr(Lr(fo)),br.light=wr(Lr(In)),br.sky=wr(Lr(Ru)),br.terrain=wr(Lr(Ac)),br.state=wr(Lr(Od)),br.layer=wr(Lr(Ec)),br.filter=wr(Lr(Ta)),br.paintProperty=wr(Lr(ds)),br.layoutProperty=wr(Lr(Mc));const Bl=be,kl=br,Ol=kl.light,Lu=kl.sky,Zr=kl.paintProperty,Oa=kl.layoutProperty;function Bu(n,e){let i=!1;if(e&&e.length)for(const o of e)n.fire(new Ti(new Error(o.message))),i=!0;return i}class po{constructor(e,i,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(i=p[1])+2*(o=p[2]);for(let x=0;x<this.d*this.d;x++){const T=p[3+x],E=p[3+x+1];u.push(T===E?null:p.subarray(T,E))}const y=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],y),this.bboxes=p.subarray(y),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let p=0;p<this.d*this.d;p++)u.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=o,this.scale=i/e,this.uid=0;const f=o/i*e;this.min=-f,this.max=e+f}insert(e,i,o,u,f){this._forEachCell(i,o,u,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,o,u,f,p){this.cells[f].push(p)}query(e,i,o,u,f){const p=this.min,y=this.max;if(e<=p&&i<=p&&y<=o&&y<=u&&!f)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(e,i,o,u,this._queryCell,x,{},f),x}}_queryCell(e,i,o,u,f,p,y,x){const T=this.cells[f];if(T!==null){const E=this.keys,C=this.bboxes;for(let D=0;D<T.length;D++){const P=T[D];if(y[P]===void 0){const B=4*P;(x?x(C[B+0],C[B+1],C[B+2],C[B+3]):e<=C[B+2]&&i<=C[B+3]&&o>=C[B+0]&&u>=C[B+1])?(y[P]=!0,p.push(E[P])):y[P]=!1}}}}_forEachCell(e,i,o,u,f,p,y,x){const T=this._convertToCellCoord(e),E=this._convertToCellCoord(i),C=this._convertToCellCoord(o),D=this._convertToCellCoord(u);for(let P=T;P<=C;P++)for(let B=E;B<=D;B++){const O=this.d*B+P;if((!x||x(this._convertFromCellCoord(P),this._convertFromCellCoord(B),this._convertFromCellCoord(P+1),this._convertFromCellCoord(B+1)))&&f.call(this,e,i,o,u,O,p,y,x))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const u=new Int32Array(i+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let f=i;for(let p=0;p<e.length;p++){const y=e[p];u[3+p]=f,u.set(y,f),f+=y.length}return u[3+e.length]=f,u.set(this.keys,f),f+=this.keys.length,u[3+e.length+1]=f,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer}static serialize(e,i){const o=e.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(e){return new po(e.buffer)}}const fs={};function ft(n,e,i={}){if(fs[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),fs[n]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}ft("Object",Object),ft("Set",Set),ft("TransferableGridIndex",po),ft("Color",Wt),ft("Error",Error),ft("AJAXError",fe),ft("ResolvedImage",Cr),ft("StylePropertyFunction",Go),ft("StyleExpression",Sc,{omit:["_evaluator"]}),ft("ZoomDependentExpression",uo),ft("ZoomConstantExpression",Rr),ft("CompoundExpression",na,{omit:["_evaluate"]});for(const n in Pl)Pl[n]._classRegistryKey||ft(`Expression_${n}`,Pl[n]);function ku(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function mo(n){return n.$name||n.constructor._classRegistryKey}function Ou(n){return!(function(e){if(e===null||typeof e!="object")return!1;const i=mo(e);return!(!i||i==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||ku(n)||xs(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function go(n,e){if(Ou(n))return(ku(n)||xs(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const f=[];for(const p of n)f.push(go(p,e));return f}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const i=mo(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!fs[i])throw new Error(`${i} is not registered.`);const{klass:o}=fs[i],u=o.serialize?o.serialize(n,e):{};if(o.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in n){if(!n.hasOwnProperty(f)||fs[i].omit.indexOf(f)>=0)continue;const p=n[f];u[f]=fs[i].shallow.indexOf(f)>=0?p:go(p,e)}n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(u.$name=i),u}function Fl(n){if(Ou(n))return n;if(Array.isArray(n))return n.map(Fl);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=mo(n)||"Object";if(!fs[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=fs[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const u of Object.keys(n)){if(u==="$name")continue;const f=n[u];o[u]=fs[e].shallow.indexOf(u)>=0?f:Fl(f)}return o}class ua{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function Zo(n){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function zc(n){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function zh(n){return/\s/u.test(String.fromCodePoint(n))}function Ma(n){for(const e of n)if(zc(e.codePointAt(0)))return!0;return!1}function Fu(n){for(const e of n)if(!Dc(e.codePointAt(0)))return!1;return!0}function Nu(n){const e=n.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(e.join("|"),"u")}const _o=Nu(["Arab","Dupl","Mong","Ougr","Syrc"]);function Dc(n){return!_o.test(String.fromCodePoint(n))}function ju(n){return!(zc(n)||(e=n,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const ps=Nu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Pc(n){return ps.test(String.fromCodePoint(n))}function Is(n,e){return!(!e&&Pc(n)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(n)))}function Ic(n){for(const e of n)if(Pc(e.codePointAt(0)))return!0;return!1}const Fa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Fa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return d(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const i=n.pluginURL,o=new Promise((f=>{this.loadScriptResolve=f}));e(i);const u=new Promise((f=>setTimeout((()=>f()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const f={pluginStatus:"loaded",pluginURL:i};return this.setState(f),f}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class ui{constructor(e,i){this.isSupportedScript=Rs,this.zoom=e,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new ua,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ua,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function Rs(n){return(function(e,i){for(const o of e)if(!Is(o.codePointAt(0),i))return!1;return!0})(n,Fa.getRTLTextPluginStatus()==="loaded")}const yo="-transition";class Ho{constructor(e,i,o){this.property=e,this.value=i,this.expression=(function(u,f,p){if(bc(u))return new Go(u,f);if(lo(u)){const y=co(u,f,p);if(y.result==="error")throw new Error(y.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return y.value}{let y=u;return f.type==="color"&&typeof u=="string"?y=Wt.parse(u):f.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?f.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?f.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?y=gn.parse(u):f.type==="projectionDefinition"&&typeof u=="string"&&(y=Wn.parse(u)):y=jt.parse(u):y=Wi.parse(u):y=Pn.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}})(i===void 0?e.specification.default:i,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class Vu{constructor(e,i){this.property=e,this.value=new Ho(e,void 0,i)}transitioned(e,i){return new Nl(this.property,this.value,i,yi({},e.transition,this.transition),e.now)}untransitioned(){return new Nl(this.property,this.value,null,{},0)}}class $o{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=i}getValue(e){return hr(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Vu(this._values[e].property,this._globalState)),this._values[e].value=new Ho(this._values[e].property,i===null?void 0:hr(i),this._globalState)}getTransition(e){return hr(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Vu(this._values[e].property,this._globalState)),this._values[e].transition=hr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const u=this.getTransition(i);u!==void 0&&(e[`${i}${yo}`]=u)}return e}transitioned(e,i){const o=new Rc(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,i._values[u]);return o}untransitioned(){const e=new Rc(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Nl{constructor(e,i,o,u,f){this.property=e,this.value=i,this.begin=f+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,o),p=this.prior;if(p){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return p.possiblyEvaluate(e,i,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,o),f,it(y))}}return f}}class Rc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const u=new Xo(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Dh{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=i}hasValue(e){return this._values[e].value!==void 0}getValue(e){return hr(this._values[e].value)}setValue(e,i){this._values[e]=new Ho(this._values[e].property,i===null?void 0:hr(i),this._globalState)}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const u=new Xo(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,o);return u}}class Br{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,u){return this.property.evaluate(this.value,this.parameters,e,i,o,u)}}class Xo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class zt{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,o){const u=Ki[this.specification.type];return u?u(e,i,o):e}}class Ot{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,u){return new Br(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,u)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Br(this,{kind:"constant",value:void 0},e.parameters);const u=Ki[this.specification.type];if(u){const f=u(e.value.value,i.value.value,o);return new Br(this,{kind:"constant",value:f},e.parameters)}return e}evaluate(e,i,o,u,f,p){return e.kind==="constant"?e.value:e.evaluate(i,o,u,f,p)}}class vo extends Ot{possiblyEvaluate(e,i,o,u){if(e.value===void 0)return new Br(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},o,u),p=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(p,p,p,i);return new Br(this,{kind:"constant",value:y},i)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Br(this,{kind:"constant",value:f},i)}return new Br(this,e.expression,i)}evaluate(e,i,o,u,f,p){if(e.kind==="source"){const y=e.evaluate(i,o,u,f,p);return this._calculate(y,y,y,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,u),e.evaluate({zoom:Math.floor(i.zoom)},o,u),e.evaluate({zoom:Math.floor(i.zoom)+1},o,u),i):e.value}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class kr{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},o,u);return this._calculate(f,f,f,i)}return this._calculate(e.expression.evaluate(new ui(Math.floor(i.zoom-1),i)),e.expression.evaluate(new ui(Math.floor(i.zoom),i)),e.expression.evaluate(new ui(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class rr{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){return!!e.expression.evaluate(i,null,{},o,u)}interpolate(){return!1}}class Mn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const u=this.defaultPropertyValues[i]=new Ho(o,void 0,void 0),f=this.defaultTransitionablePropertyValues[i]=new Vu(o,void 0);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate({})}}}ft("DataDrivenProperty",Ot),ft("DataConstantProperty",zt),ft("CrossFadedDataDrivenProperty",vo),ft("CrossFadedProperty",kr),ft("ColorRampProperty",rr);class Or extends fi{constructor(e,i,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Gr(e.filter,o)),i.layout&&(this._unevaluatedLayout=new Dh(i.layout,o)),i.paint)){this._transitionablePaint=new $o(i.paint,o);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xo(i.paint)}}setFilter(e){this.filter=e,this._featureFilter=Gr(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const u of o.getGlobalStateRefs())e.add(u)}for(const i of this._featureFilter.getGlobalStateRefs())e.add(i);return e}getPaintAffectingGlobalStateRefs(){var e;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const f of u.getGlobalStateRefs()){const p=(e=i.get(f))!==null&&e!==void 0?e:[];p.push({name:o,value:u.value}),i.set(f,p)}}return i}setLayoutProperty(e,i,o={}){i!=null&&this._validate(Oa,`layers.${this.id}.layout.${e}`,e,i,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return e.endsWith(yo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(Zr,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(e.endsWith(yo))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.property.specification["property-type"]==="cross-faded-data-driven",p=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||f||this._handleOverridablePaintPropertyUpdate(e,y,x)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e,i=!1){return!!(this.minzoom&&e<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),gr(e,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}_validate(e,i,o,u,f={}){return(!f||f.validate!==!1)&&Bu(this,e.call(kl,{key:i,layerType:this.type,objectKey:o,value:u,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Br&&wa(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let Ph;var xo={get paint(){return Ph=Ph||new Mn({"raster-opacity":new zt(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new zt(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zt(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zt(be.paint_raster["raster-brightness-max"]),"raster-saturation":new zt(be.paint_raster["raster-saturation"]),"raster-contrast":new zt(be.paint_raster["raster-contrast"]),"raster-resampling":new zt(be.paint_raster["raster-resampling"]),"raster-fade-duration":new zt(be.paint_raster["raster-fade-duration"])})}};class Hr extends Or{constructor(e,i){super(e,xo,i)}}const En={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ls{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Si{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Lt(n,e=1){let i=0,o=0;return{members:n.map((u=>{const f=En[u.type].BYTES_PER_ELEMENT,p=i=Vi(i,Math.max(e,f)),y=u.components||1;return o=Math.max(o,f),i+=f*y,{name:u.name,type:u.type,components:y,offset:p}})),size:Vi(i,Math.max(o,e)),alignment:e}}function Vi(n,e){return Math.ceil(n/e)*e}class ln extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=o,e}}ln.prototype.bytesPerElement=4,ft("StructArrayLayout2i4",ln);class Yo extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=u,e}}Yo.prototype.bytesPerElement=6,ft("StructArrayLayout3i6",Yo);class ca extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=u,this.int16[p+3]=f,e}}ca.prototype.bytesPerElement=8,ft("StructArrayLayout4i8",ca);class Bs extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=p,this.int16[x+5]=y,e}}Bs.prototype.bytesPerElement=12,ft("StructArrayLayout2i4i12",Bs);class jl extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=4*e,T=8*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.uint8[T+4]=u,this.uint8[T+5]=f,this.uint8[T+6]=p,this.uint8[T+7]=y,e}}jl.prototype.bytesPerElement=8,ft("StructArrayLayout2i4ub8",jl);class ks extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=o,e}}ks.prototype.bytesPerElement=8,ft("StructArrayLayout2f8",ks);class Os extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,u,f,p,y,x,T,E)}emplace(e,i,o,u,f,p,y,x,T,E,C){const D=10*e;return this.uint16[D+0]=i,this.uint16[D+1]=o,this.uint16[D+2]=u,this.uint16[D+3]=f,this.uint16[D+4]=p,this.uint16[D+5]=y,this.uint16[D+6]=x,this.uint16[D+7]=T,this.uint16[D+8]=E,this.uint16[D+9]=C,e}}Os.prototype.bytesPerElement=20,ft("StructArrayLayout10ui20",Os);class Ih extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,o,u,f,p,y,x)}emplace(e,i,o,u,f,p,y,x,T){const E=8*e;return this.uint16[E+0]=i,this.uint16[E+1]=o,this.uint16[E+2]=u,this.uint16[E+3]=f,this.uint16[E+4]=p,this.uint16[E+5]=y,this.uint16[E+6]=x,this.uint16[E+7]=T,e}}Ih.prototype.bytesPerElement=16,ft("StructArrayLayout8ui16",Ih);class un extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,C,D){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,o,u,f,p,y,x,T,E,C,D)}emplace(e,i,o,u,f,p,y,x,T,E,C,D,P){const B=12*e;return this.int16[B+0]=i,this.int16[B+1]=o,this.int16[B+2]=u,this.int16[B+3]=f,this.uint16[B+4]=p,this.uint16[B+5]=y,this.uint16[B+6]=x,this.uint16[B+7]=T,this.int16[B+8]=E,this.int16[B+9]=C,this.int16[B+10]=D,this.int16[B+11]=P,e}}un.prototype.bytesPerElement=24,ft("StructArrayLayout4i4ui4i24",un);class Na extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=u,e}}Na.prototype.bytesPerElement=12,ft("StructArrayLayout3f12",Na);class Vl extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Vl.prototype.bytesPerElement=4,ft("StructArrayLayout1ul4",Vl);class Ul extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,o,u,f,p,y,x,T)}emplace(e,i,o,u,f,p,y,x,T,E){const C=10*e,D=5*e;return this.int16[C+0]=i,this.int16[C+1]=o,this.int16[C+2]=u,this.int16[C+3]=f,this.int16[C+4]=p,this.int16[C+5]=y,this.uint32[D+3]=x,this.uint16[C+8]=T,this.uint16[C+9]=E,e}}Ul.prototype.bytesPerElement=20,ft("StructArrayLayout6i1ul2ui20",Ul);class Uu extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=p,this.int16[x+5]=y,e}}Uu.prototype.bytesPerElement=12,ft("StructArrayLayout2i2i2i12",Uu);class Gu extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,u,f)}emplace(e,i,o,u,f,p){const y=4*e,x=8*e;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[x+6]=f,this.int16[x+7]=p,e}}Gu.prototype.bytesPerElement=16,ft("StructArrayLayout2f1f2i16",Gu);class qu extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=16*e,T=4*e,E=8*e;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[T+1]=u,this.float32[T+2]=f,this.int16[E+6]=p,this.int16[E+7]=y,e}}qu.prototype.bytesPerElement=16,ft("StructArrayLayout2ub2f2i16",qu);class Fs extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=u,e}}Fs.prototype.bytesPerElement=6,ft("StructArrayLayout3ui6",Fs);class Ns extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,C,D,P,B,O,N,G){const J=this.length;return this.resize(J+1),this.emplace(J,e,i,o,u,f,p,y,x,T,E,C,D,P,B,O,N,G)}emplace(e,i,o,u,f,p,y,x,T,E,C,D,P,B,O,N,G,J){const q=24*e,$=12*e,ie=48*e;return this.int16[q+0]=i,this.int16[q+1]=o,this.uint16[q+2]=u,this.uint16[q+3]=f,this.uint32[$+2]=p,this.uint32[$+3]=y,this.uint32[$+4]=x,this.uint16[q+10]=T,this.uint16[q+11]=E,this.uint16[q+12]=C,this.float32[$+7]=D,this.float32[$+8]=P,this.uint8[ie+36]=B,this.uint8[ie+37]=O,this.uint8[ie+38]=N,this.uint32[$+10]=G,this.int16[q+22]=J,e}}Ns.prototype.bytesPerElement=48,ft("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ns);class fr extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,C,D,P,B,O,N,G,J,q,$,ie,re,Te,Ge,Oe,Je,dt,nt){const je=this.length;return this.resize(je+1),this.emplace(je,e,i,o,u,f,p,y,x,T,E,C,D,P,B,O,N,G,J,q,$,ie,re,Te,Ge,Oe,Je,dt,nt)}emplace(e,i,o,u,f,p,y,x,T,E,C,D,P,B,O,N,G,J,q,$,ie,re,Te,Ge,Oe,Je,dt,nt,je){const Pe=32*e,wt=16*e;return this.int16[Pe+0]=i,this.int16[Pe+1]=o,this.int16[Pe+2]=u,this.int16[Pe+3]=f,this.int16[Pe+4]=p,this.int16[Pe+5]=y,this.int16[Pe+6]=x,this.int16[Pe+7]=T,this.uint16[Pe+8]=E,this.uint16[Pe+9]=C,this.uint16[Pe+10]=D,this.uint16[Pe+11]=P,this.uint16[Pe+12]=B,this.uint16[Pe+13]=O,this.uint16[Pe+14]=N,this.uint16[Pe+15]=G,this.uint16[Pe+16]=J,this.uint16[Pe+17]=q,this.uint16[Pe+18]=$,this.uint16[Pe+19]=ie,this.uint16[Pe+20]=re,this.uint16[Pe+21]=Te,this.uint16[Pe+22]=Ge,this.uint32[wt+12]=Oe,this.float32[wt+13]=Je,this.float32[wt+14]=dt,this.uint16[Pe+30]=nt,this.uint16[Pe+31]=je,e}}fr.prototype.bytesPerElement=64,ft("StructArrayLayout8i15ui1ul2f2ui64",fr);class Ji extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ji.prototype.bytesPerElement=4,ft("StructArrayLayout1f4",Ji);class ms extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.uint16[6*e+0]=i,this.float32[f+1]=o,this.float32[f+2]=u,e}}ms.prototype.bytesPerElement=12,ft("StructArrayLayout1ui2f12",ms);class Wo extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=4*e;return this.uint32[2*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=u,e}}Wo.prototype.bytesPerElement=8,ft("StructArrayLayout1ul2ui8",Wo);class Gl extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=o,e}}Gl.prototype.bytesPerElement=4,ft("StructArrayLayout2ui4",Gl);class ql extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}ql.prototype.bytesPerElement=2,ft("StructArrayLayout1ui2",ql);class ja extends Si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=u,this.float32[p+3]=f,e}}ja.prototype.bytesPerElement=16,ft("StructArrayLayout4f16",ja);class m extends Ls{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new de(this.anchorPointX,this.anchorPointY)}}m.prototype.size=20;class t extends Ul{get(e){return new m(this,e)}}ft("CollisionBoxArray",t);class a extends Ls{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}a.prototype.size=48;class l extends Ns{get(e){return new a(this,e)}}ft("PlacedSymbolArray",l);class h extends Ls{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}h.prototype.size=64;class _ extends fr{get(e){return new h(this,e)}}ft("SymbolInstanceArray",_);class v extends Ji{getoffsetX(e){return this.float32[1*e+0]}}ft("GlyphOffsetArray",v);class w extends Yo{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}ft("SymbolLineVertexArray",w);class S extends Ls{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}S.prototype.size=12;class A extends ms{get(e){return new S(this,e)}}ft("TextAnchorOffsetArray",A);class z extends Ls{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}z.prototype.size=8;class R extends Wo{get(e){return new z(this,e)}}ft("FeatureIndexArray",R);class I extends ln{}class F extends ln{}class U extends ln{}class X extends Bs{}class W extends jl{}class Y extends ks{}class Q extends Os{}class ne extends Ih{}class K extends un{}class se extends Na{}class ue extends Vl{}class te extends Uu{}class me extends qu{}class Ae extends Fs{}class we extends Gl{}const Ce=Lt([{name:"a_pos",components:2,type:"Int16"}],4),{members:De}=Ce;class Ke{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,i,o,u){const f=this.segments[this.segments.length-1];return e>Ke.MAX_VERTEX_ARRAY_LENGTH&&Zi(`Max vertices per segment is ${Ke.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ke.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!f||f.vertexLength+e>Ke.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u?this.createNewSegment(i,o,u):f}createNewSegment(e,i,o){const u={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,i,o){return this.prepareSegment(0,e,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,u){return new Ke([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function lt(n,e){return 256*(n=kt(Math.floor(n),0,255))+kt(Math.floor(e),0,255)}Ke.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ft("SegmentVector",Ke);const Ye=Lt([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ct=Lt([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Zt,wi,Ui,Mi={exports:{}},Yi={exports:{}},Ii={exports:{}},On=(function(){if(Ui)return Mi.exports;Ui=1;var n=(Zt||(Zt=1,Yi.exports=function(i,o){var u,f,p,y,x,T,E,C;for(f=i.length-(u=3&i.length),p=o,x=3432918353,T=461845907,C=0;C<f;)E=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,p=27492+(65535&(y=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(E=0,u){case 3:E^=(255&i.charCodeAt(C+2))<<16;case 2:E^=(255&i.charCodeAt(C+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(C)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),Yi.exports),e=(wi||(wi=1,Ii.exports=function(i,o){for(var u,f=i.length,p=o^f,y=0;f>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Ii.exports);return Mi.exports=n,Mi.exports.murmur3=n,Mi.exports.murmur2=e,Mi.exports})(),$i=_e(On);class Fn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,u){this.ids.push(cn(e)),this.positions.push(i,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=cn(e);let o=0,u=this.ids.length-1;for(;o<u;){const p=o+u>>1;this.ids[p]>=i?u=p:o=p+1}const f=[];for(;this.ids[o]===i;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(e,i){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return yn(o,u,0,o.length-1),i&&i.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const i=new Fn;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function cn(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:$i(String(n))}function yn(n,e,i,o){for(;i<o;){const u=n[i+o>>1];let f=i-1,p=o+1;for(;;){do f++;while(n[f]<u);do p--;while(n[p]>u);if(f>=p)break;ar(n,f,p),ar(e,3*f,3*p),ar(e,3*f+1,3*p+1),ar(e,3*f+2,3*p+2)}p-i<o-p?(yn(n,e,i,p),i=p+1):(yn(n,e,p+1,o),o=p)}}function ar(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}ft("FeaturePositionMap",Fn);class pr{constructor(e,i){this.gl=e.gl,this.location=i}}class Va extends pr{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class js extends pr{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Qo extends pr{constructor(e,i){super(e,i),this.current=Wt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Lc=new Float32Array(16);function Ko(n){return[lt(255*n.r,255*n.g),lt(255*n.b,255*n.a)]}class $r{constructor(e,i,o){this.value=e,this.uniformNames=i.map((u=>`u_${u}`)),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new Qo(e,i):new Va(e,i)}}class Nn{constructor(e,i){this.uniformNames=i.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,i){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(e,i,o,u){let f=null;u==="u_pattern_to"?f=this.patternTo:u==="u_pattern_from"?f=this.patternFrom:u==="u_dasharray_to"?f=this.dashTo:u==="u_dasharray_from"?f=this.dashFrom:u==="u_pixel_ratio_to"?f=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(f=this.pixelRatioFrom),f!==null&&e.set(f)}getBinding(e,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new js(e,i):new Va(e,i)}}class Qn{constructor(e,i,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,i,o){const u=this.paintVertexArray.length,f=this.expression.evaluate(new ui(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,f)}updatePaintArray(e,i,o,u,f){const p=this.expression.evaluate(new ui(0,f),o,u);this._setPaintValue(e,i,p)}_setPaintValue(e,i,o){if(this.type==="color"){const u=Ko(o);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class sr{constructor(e,i,o,u,f,p){this.expression=e,this.uniformNames=i.map((y=>`u_${y}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map((y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,i,o){const u=this.expression.evaluate(new ui(this.zoom,o),i,{},o.canonical,[],o.formattedSection),f=this.expression.evaluate(new ui(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(p,e,u,f)}updatePaintArray(e,i,o,u,f){const p=this.expression.evaluate(new ui(this.zoom,f),o,u),y=this.expression.evaluate(new ui(this.zoom+1,f),o,u);this._setPaintValue(e,i,p,y)}_setPaintValue(e,i,o,u){if(this.type==="color"){const f=Ko(o),p=Ko(u);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,f[0],f[1],p[0],p[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=kt(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,i,o){return new Va(e,i)}}class ha{constructor(e,i,o,u,f,p){this.expression=e,this.type=i,this.useIntegerZoom=o,this.zoom=u,this.layerId=p,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,i,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(i),o)}updatePaintArray(e,i,o,u,f){this._setPaintValues(e,i,this.getPositionIds(o),f)}_setPaintValues(e,i,o,u){const f=this.getPositions(u);if(!f||!o)return;const p=f[o.min],y=f[o.mid],x=f[o.max];if(p&&y&&x)for(let T=e;T<i;T++)this.emplace(this.zoomInPaintVertexArray,T,y,p),this.emplace(this.zoomOutPaintVertexArray,T,y,x)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class hn extends ha{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Ye.members}emplace(e,i,o,u){e.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class jn extends ha{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Ct.members}emplace(e,i,o,u){e.emplace(i,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class Fr{constructor(e,i,o){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!o(f))continue;const p=e.paint.get(f);if(!(p instanceof Br&&wa(p.property.specification)))continue;const y=Rh(f,e.type),x=p.value,T=p.property.specification.type,E=p.property.useIntegerZoom,C=p.property.specification["property-type"],D=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[f]=D?new Nn(x.value,y):new $r(x.value,y,T),u.push(`/u_${f}`);else if(x.kind==="source"||D){const P=Bc(f,T,"source");this.binders[f]=D?f==="line-dasharray"?new jn(x,T,E,i,P,e.id):new hn(x,T,E,i,P,e.id):new Qn(x,y,T,P),u.push(`/a_${f}`)}else{const P=Bc(f,T,"composite");this.binders[f]=new sr(x,y,T,E,i,P),u.push(`/z_${f}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Qn||i instanceof sr?i.maxValue:0}populatePaintArrays(e,i,o){for(const u in this.binders){const f=this.binders[u];(f instanceof Qn||f instanceof sr||f instanceof ha)&&f.populatePaintArray(e,i,o)}}setConstantPatternPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof Nn&&u.setConstantPatternPositions(e,i)}}setConstantDashPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof Nn&&u.setConstantDashPositions(e,i)}}updatePaintArrays(e,i,o,u,f){let p=!1;for(const y in e){const x=i.getPositions(y);for(const T of x){const E=o.feature(T.index);for(const C in this.binders){const D=this.binders[C];if((D instanceof Qn||D instanceof sr||D instanceof ha)&&D.expression.isStateDependent===!0){const P=u.paint.get(C);D.expression=P.value,D.updatePaintArray(T.start,T.end,E,e[y],f),p=!0}}}}return p}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof $r||o instanceof Nn)&&e.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Qn||o instanceof sr)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof ha){const u=o.getVertexAttributes();for(const f of u)e.push(f.name)}}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof $r||o instanceof Nn||o instanceof sr)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof $r||f instanceof Nn||f instanceof sr){for(const p of f.uniformNames)if(i[p]){const y=f.getBinding(e,i[p],p);o.push({name:p,property:u,binding:y})}}}return o}setUniforms(e,i,o,u){for(const{name:f,property:p,binding:y}of i)this.binders[p].setUniform(y,u,o.get(p),f)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof ha){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Qn||o instanceof sr)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Qn||o instanceof sr||o instanceof ha)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Qn||i instanceof sr||i instanceof ha)&&i.destroy()}}}class en{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Fr(u,i,o);this.needsUpload=!1,this._featureMap=new Fn,this._bufferOffset=0}populatePaintArrays(e,i,o,u){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,i,u);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,u){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,i,f,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Rh(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function Bc(n,e,i){const o={color:{source:ks,composite:ja},number:{source:Ji,composite:ks}},u=(function(f){return{"line-pattern":{source:Q,composite:Q},"fill-pattern":{source:Q,composite:Q},"fill-extrusion-pattern":{source:Q,composite:Q},"line-dasharray":{source:ne,composite:ne}}[f]})(n);return u&&u[i]||o[e][i]}ft("ConstantBinder",$r),ft("CrossFadedConstantBinder",Nn),ft("SourceExpressionBinder",Qn),ft("CrossFadedPatternBinder",hn),ft("CrossFadedDasharrayBinder",jn),ft("CompositeExpressionBinder",sr),ft("ProgramConfiguration",Fr,{omit:["_buffers"]}),ft("ProgramConfigurationSet",en);const kc=Math.pow(2,14)-1,Lh=-kc-1;function da(n){const e=Ve/n.extent,i=n.loadGeometry();for(let o=0;o<i.length;o++){const u=i[o];for(let f=0;f<u.length;f++){const p=u[f],y=Math.round(p.x*e),x=Math.round(p.y*e);p.x=kt(y,Lh,kc),p.y=kt(x,Lh,kc),(y<p.x||y>p.x+1||x<p.y||x>p.y+1)&&Zi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function bo(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?da(n):[]}}const Vs=-32768;function Bh(n,e,i,o,u){n.emplaceBack(Vs+8*e+o,Vs+8*i+u)}class Jo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new F,this.indexArray=new Ae,this.segments=new Ke,this.programConfigurations=new en(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){const u=this.layers[0],f=[];let p=null,y=!1,x=u.type==="heatmap";if(u.type==="circle"){const E=u;p=E.layout.get("circle-sort-key"),y=!p.isConstant(),x=x||E.paint.get("circle-pitch-alignment")==="map"}const T=x?i.subdivisionGranularity.circle:1;for(const{feature:E,id:C,index:D,sourceLayerIndex:P}of e){const B=this.layers[0]._featureFilter.needGeometry,O=bo(E,B);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),O,o))continue;const N=y?p.evaluate(O,{},o):void 0,G={id:C,properties:E.properties,type:E.type,sourceLayerIndex:P,index:D,geometry:B?O.geometry:da(E),patterns:{},sortKey:N};f.push(G)}y&&f.sort(((E,C)=>E.sortKey-C.sortKey));for(const E of f){const{geometry:C,index:D,sourceLayerIndex:P}=E,B=e[D].feature;this.addFeature(E,C,D,o,T),i.featureIndex.insert(B,C,D,P,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,De),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,u,f=1){let p;switch(f){case 1:p=[0,7];break;case 3:p=[0,2,5,7];break;case 5:p=[0,1,3,4,6,7];break;case 7:p=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${f}; valid values are 1, 3, 5, 7.`)}const y=p.length;for(const x of i)for(const T of x){const E=T.x,C=T.y;if(E<0||E>=Ve||C<0||C>=Ve)continue;const D=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,e.sortKey),P=D.vertexLength;for(let B=0;B<y;B++)for(let O=0;O<y;O++)Bh(this.layoutVertexArray,E,C,p[O],p[B]);for(let B=0;B<y-1;B++)for(let O=0;O<y-1;O++){const N=P+B*y+O,G=P+(B+1)*y+O;this.indexArray.emplaceBack(N,G+1,N+1),this.indexArray.emplaceBack(N,G,G+1)}D.vertexLength+=y*y,D.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:u})}}function Oc(n,e){for(let i=0;i<n.length;i++)if(Zu(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Zu(n,e[i]))return!0;return!!Bf(n,e)}function wo(n,e,i){return!!Zu(n,e)||!!Vn(e,n,i)}function Fc(n,e){if(n.length===1)return Of(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let u=0;u<o.length;u++)if(Zu(n,o[u]))return!0}for(let i=0;i<n.length;i++)if(Of(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Bf(n,e[i]))return!0;return!1}function Nc(n,e,i){if(n.length>1){if(Bf(n,e))return!0;for(let o=0;o<e.length;o++)if(Vn(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(Vn(n[o],e,i))return!0;return!1}function Bf(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],u=n[i+1];for(let f=0;f<e.length-1;f++)if(kf(o,u,e[f],e[f+1]))return!0}return!1}function kf(n,e,i,o){return dr(n,i,o)!==dr(e,i,o)&&dr(n,e,i)!==dr(n,e,o)}function Vn(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(Tr(n,e[u-1],e[u])<o)return!0;return!1}function Tr(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function Of(n,e){let i,o,u,f=!1;for(let p=0;p<n.length;p++){i=n[p];for(let y=0,x=i.length-1;y<i.length;x=y++)o=i[y],u=i[x],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(f=!f)}return f}function Zu(n,e){let i=!1;for(let o=0,u=n.length-1;o<n.length;u=o++){const f=n[o],p=n[u];f.y>e.y!=p.y>e.y&&e.x<(p.x-f.x)*(e.y-f.y)/(p.y-f.y)+f.x&&(i=!i)}return i}function Gp(n,e,i){const o=i[0],u=i[2];if(n.x<o.x&&e.x<o.x||n.x>u.x&&e.x>u.x||n.y<o.y&&e.y<o.y||n.y>u.y&&e.y>u.y)return!1;const f=dr(n,e,i[0]);return f!==dr(n,e,i[1])||f!==dr(n,e,i[2])||f!==dr(n,e,i[3])}function Hu(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Zl(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function kh(n,e,i,o,u){if(!e[0]&&!e[1])return n;const f=de.convert(e)._mult(u);i==="viewport"&&f._rotate(-o);const p=[];for(let y=0;y<n.length;y++)p.push(n[y].sub(f));return p}function Fd(n){const e=[];for(let i=0;i<n.length;i++){const o=n[i],u=e.at(-1);(i===0||u&&!o.equals(u))&&e.push(o)}return e}function qp({queryGeometry:n,size:e},i){return wo(n,i,e)}function Um({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){return wo(n,f,e*(i.projectTileCoordinates(f.x,f.y,o,u).signedDistanceFromCamera/i.cameraToCenterDistance))}function Nd({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){const p=i.projectTileCoordinates(f.x,f.y,o,u).signedDistanceFromCamera,y=e*(i.cameraToCenterDistance/p);return wo(n,jd(f,i,o,u),y)}function Ff({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){return wo(n,jd(f,i,o,u),e)}function Nf({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u,pitchAlignment:f="map",pitchScale:p="map"},y){const x=f==="map"?p==="map"?qp:Um:p==="map"?Nd:Ff,T={queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u};for(const E of y)for(const C of E)if(x(T,C))return!0;return!1}function jd(n,e,i,o){const u=e.projectTileCoordinates(n.x,n.y,i,o).point;return new de((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let jf,Vd;ft("CircleBucket",Jo,{omit:["layers"]});var Vf={get paint(){return Vd=Vd||new Mn({"circle-radius":new Ot(be.paint_circle["circle-radius"]),"circle-color":new Ot(be.paint_circle["circle-color"]),"circle-blur":new Ot(be.paint_circle["circle-blur"]),"circle-opacity":new Ot(be.paint_circle["circle-opacity"]),"circle-translate":new zt(be.paint_circle["circle-translate"]),"circle-translate-anchor":new zt(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zt(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zt(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ot(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ot(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ot(be.paint_circle["circle-stroke-opacity"])})},get layout(){return jf=jf||new Mn({"circle-sort-key":new Ot(be.layout_circle["circle-sort-key"])})}};class Uf extends Or{constructor(e,i){super(e,Vf,i)}createBucket(e){return new Jo(e)}queryRadius(e){const i=e;return Hu("circle-radius",this,i)+Hu("circle-stroke-width",this,i)+Zl(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){const T=kh(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-f.bearingInRadians,p),E=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),C=this.paint.get("circle-pitch-scale"),D=this.paint.get("circle-pitch-alignment");let P,B;return D==="map"?(P=T,B=E*p):(P=(function(O,N,G,J){return O.map((q=>jd(q,N,G,J)))})(T,f,y,x),B=E),Nf({queryGeometry:P,size:B,transform:f,unwrappedTileID:y,getElevation:x,pitchAlignment:D,pitchScale:C},u)}}class Gf extends Jo{}let Ud;ft("HeatmapBucket",Gf,{omit:["layers"]});var Gd={get paint(){return Ud=Ud||new Mn({"heatmap-radius":new Ot(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ot(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zt(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rr(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zt(be.paint_heatmap["heatmap-opacity"])})}};function Oh(n,{width:e,height:i},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*i*o}`)}else u=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=u,n}function qf(n,{width:e,height:i},o){if(e===n.width&&i===n.height)return;const u=Oh({},{width:e,height:i},o);Fh(n,u,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,i)},o),n.width=e,n.height=i,n.data=u.data}function Fh(n,e,i,o,u,f){if(u.width===0||u.height===0)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const p=n.data,y=e.data;if(p===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const T=((i.y+x)*n.width+i.x)*f,E=((o.y+x)*e.width+o.x)*f;for(let C=0;C<u.width*f;C++)y[E+C]=p[T+C]}return e}class jc{constructor(e,i){Oh(this,e,1,i)}resize(e){qf(this,e,1)}clone(){return new jc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,f){Fh(e,i,o,u,f,1)}}class Rn{constructor(e,i){Oh(this,e,4,i)}resize(e){qf(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Rn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,f){Fh(e,i,o,u,f,4)}setPixel(e,i,o){const u=4*(e*this.width+i);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function qd(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,u=n.image||new Rn({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const f=(p,y,x)=>{e[n.evaluationKey]=x;const T=n.expression.evaluate(e);u.setPixel(p/4/i,y/4,T)};if(n.clips)for(let p=0,y=0;p<o;++p,y+=4*i)for(let x=0,T=0;x<i;x++,T+=4){const E=x/(i-1),{start:C,end:D}=n.clips[p];f(y,T,C*(1-E)+D*E)}else for(let p=0,y=0;p<i;p++,y+=4)f(0,y,p/(i-1));return u}ft("AlphaImage",jc),ft("RGBAImage",Rn);const Zf="big-fb";class Zp extends Or{createBucket(e){return new Gf(e)}constructor(e,i){super(e,Gd,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Zf)&&this.heatmapFbos.delete(Zf)}queryRadius(e){return Hu("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){return Nf({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(i,o)*p,transform:f,unwrappedTileID:y,getElevation:x},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let To;var Hf={get paint(){return To=To||new Mn({"hillshade-illumination-direction":new zt(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new zt(be.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new zt(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zt(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zt(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zt(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zt(be.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new zt(be.paint_hillshade["hillshade-method"])})}};class Hp extends Or{constructor(e,i){super(e,Hf,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const f=Math.max(e.length,i.length,o.length,u.length);e=e.concat(Array(f-e.length).fill(e.at(-1))),i=i.concat(Array(f-i.length).fill(i.at(-1))),o=o.concat(Array(f-o.length).fill(o.at(-1))),u=u.concat(Array(f-u.length).fill(u.at(-1)));const p=i.map(er);return{directionRadians:e.map(er),altitudeRadians:p,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Nh;var jh={get paint(){return Nh=Nh||new Mn({"color-relief-opacity":new zt(be["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new rr(be["paint_color-relief"]["color-relief-color"])})}};class tn{constructor(e,i,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,o){const{width:u,height:f}=e,p=!(this.size&&this.size[0]===u&&this.size[1]===f||o),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(i&&i.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),p)this.size=[u,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||xs(e)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,f,0,this.format,x.UNSIGNED_BYTE,e.data);else{const{x:T,y:E}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||xs(e)?x.texSubImage2D(x.TEXTURE_2D,0,T,E,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,T,E,u,f,x.RGBA,x.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,i,o){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),o!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,o||e),this.filter=e),i!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class $p{constructor(e,i,o,u=1,f=1,p=1,y=0){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Zi(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=f,this.blueFactor=p,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let E=0;E<x;E++){const C=this.get(T,E);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(e,i){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,i);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}unpack(e,i,o){return e*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return Xp(e,this.getUnpackVector())}getPixels(){return new Rn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,p=o*this.dim,y=o*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(o){case-1:p=y-1;break;case 1:y=p+1}const x=-i*this.dim,T=-o*this.dim;for(let E=p;E<y;E++)for(let C=u;C<f;C++)this.data[this._idx(C,E)]=e.data[this._idx(C+x,E+T)]}}function Xp(n,e){const i=e[0],o=e[1],u=e[2],f=e[3],p=Math.min(i,o,u),y=Math.round((n+f)/p);return{r:Math.floor(y*p/i)%256,g:Math.floor(y*p/o)%256,b:Math.floor(y*p/u)%256}}ft("DEMData",$p);class Yp extends Or{constructor(e,i){super(e,jh,i)}_createColorRamp(e){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof Rr&&o._styleExpression.expression instanceof Pr){this.colorRampExpression=o;const p=o._styleExpression.expression;i.elevationStops=p.labels,i.colorStops=[];for(const y of i.elevationStops)i.colorStops.push(p.evaluate({globals:{elevation:y}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Wt.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=e)return i;const u={elevationStops:[],colorStops:[]},f=(i.elevationStops.length-1)/(e-1);for(let p=0;p<i.elevationStops.length-.5;p+=f)u.elevationStops.push(i.elevationStops[Math.round(p)]),u.colorStops.push(i.colorStops[Math.round(p)]);return Zi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${i.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(i),f=new Rn({width:u.colorStops.length,height:1}),p=new Rn({width:u.colorStops.length,height:1});for(let y=0;y<u.elevationStops.length;y++){const x=Xp(u.elevationStops[y],o);p.setPixel(0,y,new Wt(x.r/255,x.g/255,x.b/255,1)),f.setPixel(0,y,u.colorStops[y])}return this.colorRampTextures={elevationTexture:new tn(e,p,e.gl.RGBA),colorTexture:new tn(e,f,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Vh=Lt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hl}=Vh;function Uh(n,e,i){const o=i.patternDependencies;let u=!1;for(const f of e){const p=f.paint.get(`${n}-pattern`);p.isConstant()||(u=!0);const y=p.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function Zd(n,e,i,o,u){const{zoom:f}=o,p=u.patternDependencies;for(const y of e){const x=y.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:f-1},i,{},u.availableImages),E=x.evaluate({zoom:f},i,{},u.availableImages),C=x.evaluate({zoom:f+1},i,{},u.availableImages);T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,C=C&&C.name?C.name:C,p[T]=!0,p[E]=!0,p[C]=!0,i.patterns[y.id]={min:T,mid:E,max:C}}}return i}function Vc(n,e,i,o,u){let f;if(u===(function(p,y,x,T){let E=0;for(let C=y,D=x-T;C<x;C+=T)E+=(p[D]-p[C])*(p[C+1]+p[D+1]),D=C;return E})(n,e,i,o)>0)for(let p=e;p<i;p+=o)f=Jf(p/o|0,n[p],n[p+1],f);else for(let p=i-o;p>=e;p-=o)f=Jf(p/o|0,n[p],n[p+1],f);return f&&$u(f,f.next)&&(Gh(f),f=f.next),f}function Xr(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!$u(o,o.next)&&An(o.prev,o,o.next)!==0)o=o.next;else{if(Gh(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Uc(n,e,i,o,u,f,p){if(!n)return;!p&&f&&(function(x,T,E,C){let D=x;do D.z===0&&(D.z=Un(D.x,D.y,T,E,C)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,(function(P){let B,O=1;do{let N,G=P;P=null;let J=null;for(B=0;G;){B++;let q=G,$=0;for(let re=0;re<O&&($++,q=q.nextZ,q);re++);let ie=O;for(;$>0||ie>0&&q;)$!==0&&(ie===0||!q||G.z<=q.z)?(N=G,G=G.nextZ,$--):(N=q,q=q.nextZ,ie--),J?J.nextZ=N:P=N,N.prevZ=J,J=N;G=q}J.nextZ=null,O*=2}while(B>1)})(D)})(n,o,u,f);let y=n;for(;n.prev!==n.next;){const x=n.prev,T=n.next;if(f?Wp(n,o,u,f):$f(n))e.push(x.i,n.i,T.i),Gh(n),n=T.next,y=T.next;else if((n=T)===y){p?p===1?Uc(n=Xf(Xr(n),e),e,i,o,u,f,2):p===2&&Yf(n,e,i,o,u,f):Uc(Xr(n),e,i,o,u,f,1);break}}}function $f(n){const e=n.prev,i=n,o=n.next;if(An(e,i,o)>=0)return!1;const u=e.x,f=i.x,p=o.x,y=e.y,x=i.y,T=o.y,E=Math.min(u,f,p),C=Math.min(y,x,T),D=Math.max(u,f,p),P=Math.max(y,x,T);let B=o.next;for(;B!==e;){if(B.x>=E&&B.x<=D&&B.y>=C&&B.y<=P&&Gn(u,y,f,x,p,T,B.x,B.y)&&An(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function Wp(n,e,i,o){const u=n.prev,f=n,p=n.next;if(An(u,f,p)>=0)return!1;const y=u.x,x=f.x,T=p.x,E=u.y,C=f.y,D=p.y,P=Math.min(y,x,T),B=Math.min(E,C,D),O=Math.max(y,x,T),N=Math.max(E,C,D),G=Un(P,B,e,i,o),J=Un(O,N,e,i,o);let q=n.prevZ,$=n.nextZ;for(;q&&q.z>=G&&$&&$.z<=J;){if(q.x>=P&&q.x<=O&&q.y>=B&&q.y<=N&&q!==u&&q!==p&&Gn(y,E,x,C,T,D,q.x,q.y)&&An(q.prev,q,q.next)>=0||(q=q.prevZ,$.x>=P&&$.x<=O&&$.y>=B&&$.y<=N&&$!==u&&$!==p&&Gn(y,E,x,C,T,D,$.x,$.y)&&An($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;q&&q.z>=G;){if(q.x>=P&&q.x<=O&&q.y>=B&&q.y<=N&&q!==u&&q!==p&&Gn(y,E,x,C,T,D,q.x,q.y)&&An(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;$&&$.z<=J;){if($.x>=P&&$.x<=O&&$.y>=B&&$.y<=N&&$!==u&&$!==p&&Gn(y,E,x,C,T,D,$.x,$.y)&&An($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function Xf(n,e){let i=n;do{const o=i.prev,u=i.next.next;!$u(o,u)&&vn(o,i,i.next,u)&&Gc(o,u)&&Gc(u,o)&&(e.push(o.i,i.i,u.i),Gh(i),Gh(i.next),i=n=u),i=i.next}while(i!==n);return Xr(i)}function Yf(n,e,i,o,u,f){let p=n;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&Gm(p,y)){let x=Kf(p,y);return p=Xr(p,p.next),x=Xr(x,x.next),Uc(p,e,i,o,u,f,0),void Uc(x,e,i,o,u,f,0)}y=y.next}p=p.next}while(p!==n)}function Hd(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function Qp(n,e){const i=(function(u,f){let p=f;const y=u.x,x=u.y;let T,E=-1/0;if($u(u,p))return p;do{if($u(u,p.next))return p.next;if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){const O=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(O<=y&&O>E&&(E=O,T=p.x<p.next.x?p:p.next,O===y))return T}p=p.next}while(p!==f);if(!T)return null;const C=T,D=T.x,P=T.y;let B=1/0;p=T;do{if(y>=p.x&&p.x>=D&&y!==p.x&&Qf(x<P?y:E,x,D,P,x<P?E:y,x,p.x,p.y)){const O=Math.abs(x-p.y)/(y-p.x);Gc(p,u)&&(O<B||O===B&&(p.x>T.x||p.x===T.x&&el(T,p)))&&(T=p,B=O)}p=p.next}while(p!==C);return T})(n,e);if(!i)return e;const o=Kf(i,n);return Xr(o,o.next),Xr(i,i.next)}function el(n,e){return An(n.prev,n,e.prev)<0&&An(e.next,n,n.next)<0}function Un(n,e,i,o,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Wf(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function Qf(n,e,i,o,u,f,p,y){return(u-p)*(e-y)>=(n-p)*(f-y)&&(n-p)*(o-y)>=(i-p)*(e-y)&&(i-p)*(f-y)>=(u-p)*(o-y)}function Gn(n,e,i,o,u,f,p,y){return!(n===p&&e===y)&&Qf(n,e,i,o,u,f,p,y)}function Gm(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,o){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==o.i&&u.next.i!==o.i&&vn(u,u.next,i,o))return!0;u=u.next}while(u!==i);return!1})(n,e)&&(Gc(n,e)&&Gc(e,n)&&(function(i,o){let u=i,f=!1;const p=(i.x+o.x)/2,y=(i.y+o.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&p<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==i);return f})(n,e)&&(An(n.prev,n,e.prev)||An(n,e.prev,e))||$u(n,e)&&An(n.prev,n,n.next)>0&&An(e.prev,e,e.next)>0)}function An(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function $u(n,e){return n.x===e.x&&n.y===e.y}function vn(n,e,i,o){const u=gs(An(n,e,i)),f=gs(An(n,e,o)),p=gs(An(i,o,n)),y=gs(An(i,o,e));return u!==f&&p!==y||!(u!==0||!Nr(n,i,e))||!(f!==0||!Nr(n,o,e))||!(p!==0||!Nr(i,n,o))||!(y!==0||!Nr(i,e,o))}function Nr(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function gs(n){return n>0?1:n<0?-1:0}function Gc(n,e){return An(n.prev,n,n.next)<0?An(n,e,n.next)>=0&&An(n,n.prev,e)>=0:An(n,e,n.prev)<0||An(n,n.next,e)<0}function Kf(n,e){const i=qc(n.i,n.x,n.y),o=qc(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,o.next=i,i.prev=o,f.next=o,o.prev=f,o}function Jf(n,e,i,o){const u=qc(n,e,i);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function Gh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function qc(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class mr{constructor(e,i){if(i>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=i}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Ea{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Ea.noSubdivision=new Ea({fill:new mr(0,0),line:new mr(0,0),tile:new mr(0,0),stencil:new mr(0,0),circle:1}),ft("SubdivisionGranularityExpression",mr),ft("SubdivisionGranularitySetting",Ea);const Xu=-32768,Sr=32767;class Kp{constructor(e,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Ve/e,this._canonical=i}_getKey(e,i){return(e+=32768)<<16|i+32768}_vertexToIndex(e,i){if(e<-32768||i<-32768||e>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),u=0|Math.round(i),f=this._getKey(o,u);if(this._vertexDictionary.has(f))return this._vertexDictionary.get(f);const p=this._vertexBuffer.length/2;return this._vertexDictionary.set(f,p),this._vertexBuffer.push(o,u),p}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(u,f){const p=[];for(let y=0;y<f.length;y+=3){const x=f[y],T=f[y+1],E=f[y+2],C=u[2*x],D=u[2*x+1];(u[2*T]-C)*(u[2*E+1]-D)-(u[2*T+1]-D)*(u[2*E]-C)>0?(p.push(x),p.push(E),p.push(T)):(p.push(x),p.push(T),p.push(E))}return p})(this._vertexBuffer,e);const i=[],o=e.length;for(let u=0;u<o;u+=3){const f=[e[u+0],e[u+1],e[u+2]],p=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let y=1/0,x=1/0,T=-1/0,E=-1/0;for(let O=0;O<3;O++){const N=p[2*O],G=p[2*O+1];y=Math.min(y,N),T=Math.max(T,N),x=Math.min(x,G),E=Math.max(E,G)}if(y===T||x===E)continue;const C=Math.floor(y/this._granularityCellSize),D=Math.ceil(T/this._granularityCellSize),P=Math.floor(x/this._granularityCellSize),B=Math.ceil(E/this._granularityCellSize);if(C!==D||P!==B)for(let O=P;O<B;O++){const N=this._scanlineGenerateVertexRingForCellRow(O,p,f);tl(this._vertexBuffer,N,i)}else i.push(...f)}return i}_scanlineGenerateVertexRingForCellRow(e,i,o){const u=e*this._granularityCellSize,f=u+this._granularityCellSize,p=[];for(let y=0;y<3;y++){const x=i[2*y],T=i[2*y+1],E=i[2*(y+1)%6],C=i[(2*(y+1)+1)%6],D=i[2*(y+2)%6],P=i[(2*(y+2)+1)%6],B=E-x,O=C-T,N=B===0,G=O===0,J=(u-T)/O,q=(f-T)/O,$=Math.min(J,q),ie=Math.max(J,q);if(!G&&($>=1||ie<=0)||G&&(T<u||T>f)){C>=u&&C<=f&&p.push(o[(y+1)%3]);continue}!G&&$>0&&p.push(this._vertexToIndex(x+B*$,T+O*$));const re=x+B*Math.max($,0),Te=x+B*Math.min(ie,1);N||this._generateIntraEdgeVertices(p,x,T,E,C,re,Te),!G&&ie<1&&p.push(this._vertexToIndex(x+B*ie,T+O*ie)),(G||C>=u&&C<=f)&&p.push(o[(y+1)%3]),!G&&(C<=u||C>=f)&&this._generateInterEdgeVertices(p,x,T,E,C,D,P,Te,u,f)}return p}_generateIntraEdgeVertices(e,i,o,u,f,p,y){const x=u-i,T=f-o,E=T===0,C=E?Math.min(i,u):Math.min(p,y),D=E?Math.max(i,u):Math.max(p,y),P=Math.floor(C/this._granularityCellSize)+1,B=Math.ceil(D/this._granularityCellSize)-1;if(E?i<u:p<y)for(let O=P;O<=B;O++){const N=O*this._granularityCellSize;e.push(this._vertexToIndex(N,o+T*(N-i)/x))}else for(let O=B;O>=P;O--){const N=O*this._granularityCellSize;e.push(this._vertexToIndex(N,o+T*(N-i)/x))}}_generateInterEdgeVertices(e,i,o,u,f,p,y,x,T,E){const C=f-o,D=p-u,P=y-f,B=(T-f)/P,O=(E-f)/P,N=Math.min(B,O),G=Math.max(B,O),J=u+D*N;let q=Math.floor(Math.min(J,x)/this._granularityCellSize)+1,$=Math.ceil(Math.max(J,x)/this._granularityCellSize)-1,ie=x<J;const re=P===0;if(re&&(y===T||y===E))return;if(re||N>=1||G<=0){const Ge=o-y,Oe=p+(i-p)*Math.min((T-y)/Ge,(E-y)/Ge);q=Math.floor(Math.min(Oe,x)/this._granularityCellSize)+1,$=Math.ceil(Math.max(Oe,x)/this._granularityCellSize)-1,ie=x<Oe}const Te=C>0?E:T;if(ie)for(let Ge=q;Ge<=$;Ge++)e.push(this._vertexToIndex(Ge*this._granularityCellSize,Te));else for(let Ge=$;Ge>=q;Ge--)e.push(this._vertexToIndex(Ge*this._granularityCellSize,Te))}_generateOutline(e){const i=[];for(const o of e){const u=Ua(o,this._granularity,!0),f=this._pointArrayToIndices(u),p=[];for(let y=1;y<f.length;y++)p.push(f[y-1]),p.push(f[y]);i.push(p)}return i}_handlePoles(e){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(e,i,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let i=0;i<e.length;i+=2){const o=e[i+1];o===Xu&&(e[i+1]=-32767),o===Sr&&(e[i+1]=32766)}}_generatePoleQuad(e,i,o,u,f,p){u>f!=(p===Xu)?(e.push(i),e.push(o),e.push(this._vertexToIndex(u,p)),e.push(o),e.push(this._vertexToIndex(f,p)),e.push(this._vertexToIndex(u,p))):(e.push(o),e.push(i),e.push(this._vertexToIndex(u,p)),e.push(this._vertexToIndex(f,p)),e.push(o),e.push(this._vertexToIndex(u,p)))}_fillPoles(e,i,o){const u=this._vertexBuffer,f=Ve,p=e.length;for(let y=2;y<p;y+=3){const x=e[y-2],T=e[y-1],E=e[y],C=u[2*x],D=u[2*x+1],P=u[2*T],B=u[2*T+1],O=u[2*E],N=u[2*E+1];i&&(D===0&&B===0&&this._generatePoleQuad(e,x,T,C,P,Xu),B===0&&N===0&&this._generatePoleQuad(e,T,E,P,O,Xu),N===0&&D===0&&this._generatePoleQuad(e,E,x,O,C,Xu)),o&&(D===f&&B===f&&this._generatePoleQuad(e,x,T,C,P,Sr),B===f&&N===f&&this._generatePoleQuad(e,T,E,P,O,Sr),N===f&&D===f&&this._generatePoleQuad(e,E,x,O,C,Sr))}}_initializeVertices(e){for(let i=0;i<e.length;i+=2)this._vertexToIndex(e[i],e[i+1])}subdividePolygonInternal(e,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(y){const x=[],T=[];for(const E of y)if(E.length!==0){E!==y[0]&&x.push(T.length/2);for(let C=0;C<E.length;C++)T.push(E[C].x),T.push(E[C].y)}return{flattened:T,holeIndices:x}})(e);let f;this._initializeVertices(o);try{const y=(function(T,E,C=2){const D=E&&E.length,P=D?E[0]*C:T.length;let B=Vc(T,0,P,C,!0);const O=[];if(!B||B.next===B.prev)return O;let N,G,J;if(D&&(B=(function(q,$,ie,re){const Te=[];for(let Ge=0,Oe=$.length;Ge<Oe;Ge++){const Je=Vc(q,$[Ge]*re,Ge<Oe-1?$[Ge+1]*re:q.length,re,!1);Je===Je.next&&(Je.steiner=!0),Te.push(Wf(Je))}Te.sort(Hd);for(let Ge=0;Ge<Te.length;Ge++)ie=Qp(Te[Ge],ie);return ie})(T,E,B,C)),T.length>80*C){N=T[0],G=T[1];let q=N,$=G;for(let ie=C;ie<P;ie+=C){const re=T[ie],Te=T[ie+1];re<N&&(N=re),Te<G&&(G=Te),re>q&&(q=re),Te>$&&($=Te)}J=Math.max(q-N,$-G),J=J!==0?32767/J:0}return Uc(B,O,C,N,G,J,0),O})(o,u),x=this._convertIndices(o,y);f=this._subdivideTrianglesScanline(x)}catch(y){console.error(y)}let p=[];return i&&(p=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(f),{verticesFlattened:this._vertexBuffer,indicesTriangles:f,indicesLineList:p}}_convertIndices(e,i){const o=[];for(let u=0;u<i.length;u++)o.push(this._vertexToIndex(e[2*i[u]],e[2*i[u]+1]));return o}_pointArrayToIndices(e){const i=[];for(let o=0;o<e.length;o++){const u=e[o];i.push(this._vertexToIndex(u.x,u.y))}return i}}function So(n,e,i,o=!0){return new Kp(i,e).subdividePolygonInternal(n,o)}function Ua(n,e,i=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],u=n[n.length-1],f=i&&(o.x!==u.x||o.y!==u.y);if(e<2)return f?[...n,n[0]]:[...n];const p=Math.floor(Ve/e),y=[];y.push(new de(n[0].x,n[0].y));const x=n.length,T=f?x:x-1;for(let E=0;E<T;E++){const C=n[E],D=E<x-1?n[E+1]:n[0],P=C.x,B=C.y,O=D.x,N=D.y,G=P!==O,J=B!==N;if(!G&&!J)continue;const q=O-P,$=N-B,ie=Math.abs(q),re=Math.abs($);let Te=P,Ge=B;for(;;){const Je=q>0?(Math.floor(Te/p)+1)*p:(Math.ceil(Te/p)-1)*p,dt=$>0?(Math.floor(Ge/p)+1)*p:(Math.ceil(Ge/p)-1)*p,nt=Math.abs(Te-Je),je=Math.abs(Ge-dt),Pe=Math.abs(Te-O),wt=Math.abs(Ge-N),xt=G?nt/ie:Number.POSITIVE_INFINITY,Mt=J?je/re:Number.POSITIVE_INFINITY;if((Pe<=nt||!G)&&(wt<=je||!J))break;if(xt<Mt&&G||!J){Te=Je,Ge+=$*xt;const _t=new de(Te,Math.round(Ge));y[y.length-1].x===_t.x&&y[y.length-1].y===_t.y||y.push(_t)}else{Te+=q*Mt,Ge=dt;const _t=new de(Math.round(Te),Ge);y[y.length-1].x===_t.x&&y[y.length-1].y===_t.y||y.push(_t)}}const Oe=new de(O,N);y[y.length-1].x===Oe.x&&y[y.length-1].y===Oe.y||y.push(Oe)}return y}function tl(n,e,i){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=n[2*e[0]];for(let x=1;x<e.length;x++){const T=n[2*e[x]];T<u&&(u=T,o=x)}const f=e.length;let p=o,y=(p+1)%f;for(;;){const x=p-1>=0?p-1:f-1,T=(y+1)%f,E=n[2*e[x]],C=n[2*e[T]],D=n[2*e[p]],P=n[2*e[p]+1],B=n[2*e[y]+1];let O=!1;if(E<C)O=!0;else if(E>C)O=!1;else{const N=B-P,G=-(n[2*e[y]]-D),J=P<B?1:-1;((E-D)*N+(n[2*e[x]+1]-P)*G)*J>((C-D)*N+(n[2*e[T]+1]-P)*G)*J&&(O=!0)}if(O){const N=e[x],G=e[p],J=e[y];N!==G&&N!==J&&G!==J&&i.push(J,G,N),p--,p<0&&(p=f-1)}else{const N=e[T],G=e[p],J=e[y];N!==G&&N!==J&&G!==J&&i.push(J,G,N),y++,y>=f&&(y=0)}if(x===T)break}}function $d(n,e,i,o,u,f,p,y,x){const T=u.length/2,E=p&&y&&x;if(T<Ke.MAX_VERTEX_ARRAY_LENGTH){const C=e.prepareSegment(T,i,o),D=C.vertexLength;for(let O=0;O<f.length;O+=3)o.emplaceBack(D+f[O],D+f[O+1],D+f[O+2]);let P,B;C.vertexLength+=T,C.primitiveLength+=f.length/3,E&&(B=p.prepareSegment(T,i,y),P=B.vertexLength,B.vertexLength+=T);for(let O=0;O<u.length;O+=2)n(u[O],u[O+1]);if(E)for(let O=0;O<x.length;O++){const N=x[O];for(let G=1;G<N.length;G+=2)y.emplaceBack(P+N[G-1],P+N[G]);B.primitiveLength+=N.length/2}}else(function(C,D,P,B,O,N){const G=[];for(let re=0;re<B.length/2;re++)G.push(-1);const J={count:0};let q=0,$=C.getOrCreateLatestSegment(D,P),ie=$.vertexLength;for(let re=2;re<O.length;re+=3){const Te=O[re-2],Ge=O[re-1],Oe=O[re];let Je=G[Te]<q,dt=G[Ge]<q,nt=G[Oe]<q;$.vertexLength+((Je?1:0)+(dt?1:0)+(nt?1:0))>Ke.MAX_VERTEX_ARRAY_LENGTH&&($=C.createNewSegment(D,P),q=J.count,Je=!0,dt=!0,nt=!0,ie=0);const je=Yu(G,B,N,J,Te,Je,$),Pe=Yu(G,B,N,J,Ge,dt,$),wt=Yu(G,B,N,J,Oe,nt,$);P.emplaceBack(ie+je-q,ie+Pe-q,ie+wt-q),$.primitiveLength++}})(e,i,o,u,f,n),E&&(function(C,D,P,B,O,N){const G=[];for(let re=0;re<B.length/2;re++)G.push(-1);const J={count:0};let q=0,$=C.getOrCreateLatestSegment(D,P),ie=$.vertexLength;for(let re=0;re<O.length;re++){const Te=O[re];for(let Ge=1;Ge<O[re].length;Ge+=2){const Oe=Te[Ge-1],Je=Te[Ge];let dt=G[Oe]<q,nt=G[Je]<q;$.vertexLength+((dt?1:0)+(nt?1:0))>Ke.MAX_VERTEX_ARRAY_LENGTH&&($=C.createNewSegment(D,P),q=J.count,dt=!0,nt=!0,ie=0);const je=Yu(G,B,N,J,Oe,dt,$),Pe=Yu(G,B,N,J,Je,nt,$);P.emplaceBack(ie+je-q,ie+Pe-q),$.primitiveLength++}}})(p,i,y,u,x,n),e.forceNewSegmentOnNextPrepare(),p?.forceNewSegmentOnNextPrepare()}function Yu(n,e,i,o,u,f,p){if(f){const y=o.count;return i(e[2*u],e[2*u+1]),n[u]=o.count,o.count++,p.vertexLength++,y}return n[u]}class Ga{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new U,this.indexArray=new Ae,this.indexArray2=new we,this.programConfigurations=new en(e.layers,e.zoom),this.segments=new Ke,this.segments2=new Ke,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Uh("fill",this.layers,i);const u=this.layers[0].layout.get("fill-sort-key"),f=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,D=bo(y,C);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),D,o))continue;const P=f?u.evaluate(D,{},o,i.availableImages):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?D.geometry:da(y),patterns:{},sortKey:P};p.push(B)}f&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:E}=y;if(this.hasDependencies){const C=Zd("fill",this.layers,y,{zoom:this.zoom},i);this.patternFeatures.push(C)}else this.addFeature(y,x,T,o,{},i.subdivisionGranularity);i.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,i,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hl),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,u,f,p){for(const y of bu(i,500)){const x=So(y,u,p.fill.getGranularityForZoomLevel(u.z)),T=this.layoutVertexArray;$d(((E,C)=>{T.emplaceBack(E,C)}),this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,canonical:u})}}let ep,Wu;ft("FillBucket",Ga,{omit:["layers","patternFeatures"]});var qh={get paint(){return Wu=Wu||new Mn({"fill-antialias":new zt(be.paint_fill["fill-antialias"]),"fill-opacity":new Ot(be.paint_fill["fill-opacity"]),"fill-color":new Ot(be.paint_fill["fill-color"]),"fill-outline-color":new Ot(be.paint_fill["fill-outline-color"]),"fill-translate":new zt(be.paint_fill["fill-translate"]),"fill-translate-anchor":new zt(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new vo(be.paint_fill["fill-pattern"])})},get layout(){return ep=ep||new Mn({"fill-sort-key":new Ot(be.layout_fill["fill-sort-key"])})}};class Zh extends Or{constructor(e,i){super(e,qh,i)}recalculate(e,i){super.recalculate(e,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Ga(e)}queryRadius(){return Zl(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:i,transform:o,pixelsToTileUnits:u}){return Fc(kh(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),i)}isTileClipped(){return!0}}const Zc=Lt([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Jp=Lt([{name:"a_centroid",components:2,type:"Int16"}],4),{members:em}=Zc;class il{constructor(e,i,o,u,f){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=f,e.readFields(tm,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,o=[];let u,f=1,p=0,y=0,x=0;for(;e.pos<i;){if(p<=0){const T=e.readVarint();f=7&T,p=T>>3}if(p--,f===1||f===2)y+=e.readSVarint(),x+=e.readSVarint(),f===1&&(u&&o.push(u),u=[]),u&&u.push(new de(y,x));else{if(f!==7)throw new Error(`unknown command ${f}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let o=1,u=0,f=0,p=0,y=1/0,x=-1/0,T=1/0,E=-1/0;for(;e.pos<i;){if(u<=0){const C=e.readVarint();o=7&C,u=C>>3}if(u--,o===1||o===2)f+=e.readSVarint(),p+=e.readSVarint(),f<y&&(y=f),f>x&&(x=f),p<T&&(T=p),p>E&&(E=p);else if(o!==7)throw new Error(`unknown command ${o}`)}return[y,T,x,E]}toGeoJSON(e,i,o){const u=this.extent*Math.pow(2,o),f=this.extent*e,p=this.extent*i,y=this.loadGeometry();function x(D){return[360*(D.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+p)/u)*Math.PI))-90]}function T(D){return D.map(x)}let E;if(this.type===1){const D=[];for(const B of y)D.push(B[0]);const P=T(D);E=D.length===1?{type:"Point",coordinates:P[0]}:{type:"MultiPoint",coordinates:P}}else if(this.type===2){const D=y.map(T);E=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=Hh(y),P=[];for(const B of D)P.push(B.map(T));E=P.length===1?{type:"Polygon",coordinates:P[0]}:{type:"MultiPolygon",coordinates:P}}}const C={type:"Feature",geometry:E,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function tm(n,e,i){n===1?e.id=i.readVarint():n===2?(function(o,u){const f=o.readVarint()+o.pos;for(;o.pos<f;){const p=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[p]=y}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function Hh(n){const e=n.length;if(e<=1)return[n];const i=[];let o,u;for(let f=0;f<e;f++){const p=im(n[f]);p!==0&&(u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[n[f]]):o&&o.push(n[f]))}return o&&i.push(o),i}function im(n){let e=0;for(let i,o,u=0,f=n.length,p=f-1;u<f;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}il.types=["Unknown","Point","LineString","Polygon"];class qm{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Zm,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new il(this._pbf,i,this.extent,this._keys,this._values)}}function Zm(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(o){let u=null;const f=o.readVarint()+o.pos;for(;o.pos<f;){const p=o.readVarint()>>3;u=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(i))}class Ri{constructor(e,i){this.layers=e.readFields(nn,{},i)}}function nn(n,e,i){if(n===3){const o=new qm(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}const ci=Math.pow(2,13);function li(n,e,i,o,u,f,p,y){n.emplaceBack(e,i,2*Math.floor(o*ci)+p,u*ci*2,f*ci*2,Math.round(y))}class Gi{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new X,this.centroidVertexArray=new I,this.indexArray=new Ae,this.programConfigurations=new en(e.layers,e.zoom),this.segments=new Ke,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.features=[],this.hasDependencies=Uh("fill-extrusion",this.layers,i);for(const{feature:u,id:f,index:p,sourceLayerIndex:y}of e){const x=this.layers[0]._featureFilter.needGeometry,T=bo(u,x);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),T,o))continue;const E={id:f,sourceLayerIndex:y,index:p,geometry:x?T.geometry:da(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Zd("fill-extrusion",this.layers,E,{zoom:this.zoom},i)):this.addFeature(E,E.geometry,p,o,{},i.subdivisionGranularity),i.featureIndex.insert(u,E.geometry,p,y,this.index,!0)}}addFeatures(e,i,o){for(const u of this.features){const{geometry:f}=u;this.addFeature(u,f,u.index,i,o,e.subdivisionGranularity)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,em),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Jp.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,o,u,f,p){for(const y of bu(i,500)){const x={x:0,y:0,sampleCount:0},T=this.layoutVertexArray.length;this.processPolygon(x,u,e,y,p);const E=this.layoutVertexArray.length-T,C=Math.floor(x.x/x.sampleCount),D=Math.floor(x.y/x.sampleCount);for(let P=0;P<E;P++)this.centroidVertexArray.emplaceBack(C,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,canonical:u})}processPolygon(e,i,o,u,f){if(u.length<1||Qu(u[0]))return;for(const C of u)C.length!==0&&qa(e,C);const p={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=f.fill.getGranularityForZoomLevel(i.z),x=il.types[o.type]==="Polygon";for(const C of u){if(C.length===0||Qu(C))continue;const D=Ua(C,y,x);this._generateSideFaces(D,p)}if(!x)return;const T=So(u,i,y,!1),E=this.layoutVertexArray;$d(((C,D)=>{li(E,C,D,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles)}_generateSideFaces(e,i){let o=0;for(let u=1;u<e.length;u++){const f=e[u],p=e[u-1];if($l(f,p))continue;i.segment.vertexLength+4>Ke.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=f.sub(p)._perp()._unit(),x=p.dist(f);o+x>32768&&(o=0),li(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,0,o),li(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,1,o),o+=x,li(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,0,o),li(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,1,o);const T=i.segment.vertexLength;this.indexArray.emplaceBack(T,T+2,T+1),this.indexArray.emplaceBack(T+1,T+2,T+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function qa(n,e){for(let i=0;i<e.length;i++){const o=e[i];i===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function $l(n,e){return n.x===e.x&&(n.x<0||n.x>Ve)||n.y===e.y&&(n.y<0||n.y>Ve)}function Qu(n){return n.every((e=>e.x<0))||n.every((e=>e.x>Ve))||n.every((e=>e.y<0))||n.every((e=>e.y>Ve))}let Xd;ft("FillExtrusionBucket",Gi,{omit:["layers","features"]});var nl={get paint(){return Xd=Xd||new Mn({"fill-extrusion-opacity":new zt(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ot(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zt(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zt(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vo(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ot(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ot(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zt(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class qn extends Or{constructor(e,i){super(e,nl,i)}createBucket(e){return new Gi(e)}queryRadius(){return Zl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,pixelPosMatrix:y}){const x=kh(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-f.bearingInRadians,p),T=this.paint.get("fill-extrusion-height").evaluate(i,o),E=this.paint.get("fill-extrusion-base").evaluate(i,o),C=(function(P,B){const O=[];for(const N of P){const G=[N.x,N.y,0,1];an(G,G,B),O.push(new de(G[0]/G[3],G[1]/G[3]))}return O})(x,y),D=(function(P,B,O,N){const G=[],J=[],q=N[8]*B,$=N[9]*B,ie=N[10]*B,re=N[11]*B,Te=N[8]*O,Ge=N[9]*O,Oe=N[10]*O,Je=N[11]*O;for(const dt of P){const nt=[],je=[];for(const Pe of dt){const wt=Pe.x,xt=Pe.y,Mt=N[0]*wt+N[4]*xt+N[12],_t=N[1]*wt+N[5]*xt+N[13],Rt=N[2]*wt+N[6]*xt+N[14],bi=N[3]*wt+N[7]*xt+N[15],ai=Rt+ie,bn=bi+re,Kr=Mt+Te,ur=_t+Ge,wn=Rt+Oe,dn=bi+Je,Oi=new de((Mt+q)/bn,(_t+$)/bn);Oi.z=ai/bn,nt.push(Oi);const Ln=new de(Kr/dn,ur/dn);Ln.z=wn/dn,je.push(Ln)}G.push(nt),J.push(je)}return[G,J]})(u,E,T,y);return(function(P,B,O){let N=1/0;Fc(O,B)&&(N=Xl(O,B[0]));for(let G=0;G<B.length;G++){const J=B[G],q=P[G];for(let $=0;$<J.length-1;$++){const ie=J[$],re=[ie,J[$+1],q[$+1],q[$],ie];Oc(O,re)&&(N=Math.min(N,Xl(O,re)))}}return N!==1/0&&N})(D[0],D[1],C)}}function _s(n,e){return n.x*e.x+n.y*e.y}function Xl(n,e){if(n.length===1){let i=0;const o=e[i++];let u;for(;!u||o.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],p=n[0],y=u.sub(o),x=f.sub(o),T=p.sub(o),E=_s(y,y),C=_s(y,x),D=_s(x,x),P=_s(T,y),B=_s(T,x),O=E*D-C*C,N=(D*P-C*B)/O,G=(E*B-C*P)/O,J=o.z*(1-N-G)+u.z*N+f.z*G;if(isFinite(J))return J}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}const tp=Lt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Za}=tp,Hc=Lt([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:$h}=Hc,Aa=Math.cos(Math.PI/180*37.5),Yd=Math.pow(2,14)/.5;class $c{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new W,this.layoutVertexArray2=new Y,this.indexArray=new Ae,this.programConfigurations=new en(e.layers,e.zoom),this.segments=new Ke,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Uh("line",this.layers,i)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),f=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,D=bo(y,C);if(!this.layers[0]._featureFilter.filter(new ui(this.zoom),D,o))continue;const P=f?u.evaluate(D,{},o):void 0,B={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?D.geometry:da(y),patterns:{},dashes:{},sortKey:P};p.push(B)}f&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:E}=y;this.hasDependencies?(Uh("line",this.layers,i)?Zd("line",this.layers,y,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,i),this.patternFeatures.push(y)):this.addFeature(y,x,T,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(e,i,o,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,o,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,$h)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Za),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,u,f,p,y){const x=this.layers[0].layout,T=x.get("line-join").evaluate(e,{}),E=x.get("line-cap"),C=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of i)this.addLine(P,e,T,E,C,D,u,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,dashPositions:p,canonical:u})}addLine(e,i,o,u,f,p,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Ua(e,y?x.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<e.length-1;q++)this.totalDistance+=e[q].dist(e[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=il.types[i.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let C=0;for(;C<E-1&&e[C].equals(e[C+1]);)C++;if(E<(T?3:2))return;o==="bevel"&&(f=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let B,O,N,G,J;this.e1=this.e2=-1,T&&(B=e[E-2],J=e[C].sub(B)._unit()._perp());for(let q=C;q<E;q++){if(N=q===E-1?T?e[C+1]:void 0:e[q+1],N&&e[q].equals(N))continue;J&&(G=J),B&&(O=B),B=e[q],J=N?N.sub(B)._unit()._perp():G,G=G||J;let $=G.add(J);$.x===0&&$.y===0||$._unit();const ie=G.x*J.x+G.y*J.y,re=$.x*J.x+$.y*J.y,Te=re!==0?1/re:1/0,Ge=2*Math.sqrt(2-2*re),Oe=re<Aa&&O&&N,Je=G.x*J.y-G.y*J.x>0;if(Oe&&q>C){const je=B.dist(O);if(je>2*D){const Pe=B.sub(B.sub(O)._mult(D/je)._round());this.updateDistance(O,Pe),this.addCurrentVertex(Pe,G,0,0,P),O=Pe}}const dt=O&&N;let nt=dt?o:T?"butt":u;if(dt&&nt==="round"&&(Te<p?nt="miter":Te<=2&&(nt="fakeround")),nt==="miter"&&Te>f&&(nt="bevel"),nt==="bevel"&&(Te>2&&(nt="flipbevel"),Te<f&&(nt="miter")),O&&this.updateDistance(O,B),nt==="miter")$._mult(Te),this.addCurrentVertex(B,$,0,0,P);else if(nt==="flipbevel"){if(Te>100)$=J.mult(-1);else{const je=Te*G.add(J).mag()/G.sub(J).mag();$._perp()._mult(je*(Je?-1:1))}this.addCurrentVertex(B,$,0,0,P),this.addCurrentVertex(B,$.mult(-1),0,0,P)}else if(nt==="bevel"||nt==="fakeround"){const je=-Math.sqrt(Te*Te-1),Pe=Je?je:0,wt=Je?0:je;if(O&&this.addCurrentVertex(B,G,Pe,wt,P),nt==="fakeround"){const xt=Math.round(180*Ge/Math.PI/20);for(let Mt=1;Mt<xt;Mt++){let _t=Mt/xt;if(_t!==.5){const bi=_t-.5;_t+=_t*bi*(_t-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*bi*bi+(.848013+ie*(.215638*ie-1.06021)))}const Rt=J.sub(G)._mult(_t)._add(G)._unit()._mult(Je?-1:1);this.addHalfVertex(B,Rt.x,Rt.y,!1,Je,0,P)}}N&&this.addCurrentVertex(B,J,-Pe,-wt,P)}else if(nt==="butt")this.addCurrentVertex(B,$,0,0,P);else if(nt==="square"){const je=O?1:-1;this.addCurrentVertex(B,$,je,je,P)}else nt==="round"&&(O&&(this.addCurrentVertex(B,G,0,0,P),this.addCurrentVertex(B,G,1,1,P,!0)),N&&(this.addCurrentVertex(B,J,-1,-1,P,!0),this.addCurrentVertex(B,J,0,0,P)));if(Oe&&q<E-1){const je=B.dist(N);if(je>2*D){const Pe=B.add(N.sub(B)._mult(D/je)._round());this.updateDistance(B,Pe),this.addCurrentVertex(Pe,J,0,0,P),B=Pe}}}}addCurrentVertex(e,i,o,u,f,p=!1){const y=i.y*u-i.x,x=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,p,!1,o,f),this.addHalfVertex(e,y,x,p,!0,-u,f),this.distance>Yd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,i,o,u,f,p))}addHalfVertex({x:e,y:i},o,u,f,p,y,x){const T=.5*(this.lineClips?this.scaledDistance*(Yd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,E,this.e2),x.primitiveLength++),p?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}hasLineDasharray(e){for(const i of e){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,i,o,u){for(const f of e){const p=f.paint.get("line-dasharray");if(!p||p.value.kind==="constant")continue;const y=f.layout.get("line-cap")==="round",x={dasharray:p.value.evaluate({zoom:o-1},i,{}),round:y},T={dasharray:p.value.evaluate({zoom:o},i,{}),round:y},E={dasharray:p.value.evaluate({zoom:o+1},i,{}),round:y},C=`${x.dasharray.join(",")},${x.round}`,D=`${T.dasharray.join(",")},${T.round}`,P=`${E.dasharray.join(",")},${E.round}`;u.dashDependencies[C]=x,u.dashDependencies[D]=T,u.dashDependencies[P]=E,i.dashes[f.id]={min:C,mid:D,max:P}}}}let ip,Xh;ft("LineBucket",$c,{omit:["layers","patternFeatures"]});var Yh={get paint(){return Xh=Xh||new Mn({"line-opacity":new Ot(be.paint_line["line-opacity"]),"line-color":new Ot(be.paint_line["line-color"]),"line-translate":new zt(be.paint_line["line-translate"]),"line-translate-anchor":new zt(be.paint_line["line-translate-anchor"]),"line-width":new Ot(be.paint_line["line-width"]),"line-gap-width":new Ot(be.paint_line["line-gap-width"]),"line-offset":new Ot(be.paint_line["line-offset"]),"line-blur":new Ot(be.paint_line["line-blur"]),"line-dasharray":new vo(be.paint_line["line-dasharray"]),"line-pattern":new vo(be.paint_line["line-pattern"]),"line-gradient":new rr(be.paint_line["line-gradient"])})},get layout(){return ip=ip||new Mn({"line-cap":new zt(be.layout_line["line-cap"]),"line-join":new Ot(be.layout_line["line-join"]),"line-miter-limit":new zt(be.layout_line["line-miter-limit"]),"line-round-limit":new zt(be.layout_line["line-round-limit"]),"line-sort-key":new Ot(be.layout_line["line-sort-key"])})}};class Yl extends Ot{possiblyEvaluate(e,i){return i=new ui(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,u){return i=yi({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,u)}}let Zn;class Wl extends Or{constructor(e,i){super(e,Yh,i),this.gradientVersion=0,Zn||(Zn=new Yl(Yh.paint.properties["line-width"].specification),Zn.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof to,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=Zn.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new $c(e)}queryRadius(e){const i=e,o=Ku(Hu("line-width",this,i),Hu("line-gap-width",this,i)),u=Hu("line-offset",this,i);return o/2+Math.abs(u)+Zl(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p}){const y=kh(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-f.bearingInRadians,p),x=p/2*Ku(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),T=this.paint.get("line-offset").evaluate(i,o);return T&&(u=(function(E,C){const D=[];for(let P=0;P<E.length;P++){const B=Fd(E[P]),O=[];for(let N=0;N<B.length;N++){const G=B[N],J=B[N-1],q=B[N+1],$=N===0?new de(0,0):G.sub(J)._unit()._perp(),ie=N===B.length-1?new de(0,0):q.sub(G)._unit()._perp(),re=$._add(ie)._unit(),Te=re.x*ie.x+re.y*ie.y;Te!==0&&re._mult(1/Te),O.push(re._mult(C)._add(G))}D.push(O)}return D})(u,T*p)),(function(E,C,D){for(let P=0;P<C.length;P++){const B=C[P];if(E.length>=3){for(let O=0;O<B.length;O++)if(Zu(E,B[O]))return!0}if(Nc(E,B,D))return!0}return!1})(y,u,x)}isTileClipped(){return!0}}function Ku(n,e){return e>0?e+2*n:n}const rl=Lt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),np=Lt([{name:"a_projected_pos",components:3,type:"Float32"}],4);Lt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const rp=Lt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Lt([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ap=Lt([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Wh=Lt([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function sp(n,e,i){return n.sections.forEach((o=>{o.text=(function(u,f,p){const y=f.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Fa.applyArabicShaping&&(u=Fa.applyArabicShaping(u)),u})(o.text,e,i)})),n}Lt([{name:"triangle",components:3,type:"Uint16"}]),Lt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Lt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Lt([{type:"Float32",name:"offsetX"}]),Lt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Lt([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Li=24;const Xc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Ca={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},nm={40:!0};function op(n,e,i,o,u,f){if("fontStack"in e){const p=i[e.fontStack],y=p&&p[n];return y?y.metrics.advance*e.scale+u:0}{const p=o[e.imageName];return p?p.displaySize[0]*e.scale*Li/f+u:0}}function rm(n,e,i,o){const u=Math.pow(n-e,2);return o?n<e?u/2:2*u:u+Math.abs(i)*i}function Ql(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Qh(n,e,i,o,u,f){let p=null,y=rm(e,i,u,f);for(const x of o){const T=rm(e-x.x,i,u,f)+x.badness;T<=y&&(p=x,y=T)}return{index:n,x:e,priorBreak:p,badness:y}}function Wd(n){return n?Wd(n.priorBreak).concat(n.index):[]}class Us{constructor(e="",i=[],o=[]){this.text=e,this.sections=i,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,i){const o=new Us;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?o.addImageSection(f):o.addTextSection(f,i)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let i="",o={premature:!0,value:void 0};const u=e[Symbol.iterator]();let f=u.next();const p=e[Symbol.iterator]();p.next();let y=p.next();for(;!f.done;)i+=!y.done&&ju(y.value.codePointAt(0))&&!Xc[y.value]||!o.premature&&ju(o.value.codePointAt(0))&&!Xc[o.value]||!Xc[f.value]?f.value:Xc[f.value],o={value:f.value,premature:!1},f=u.next(),y=p.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),i=e?e[0].length:0,o=this.text.match(/\S\s*$/),u=o?o[0].length-1:0;this.text=this.text.substring(i,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-u)}substring(e,i){const o=[...this.text].slice(e,i).join(""),u=this.sectionIndex.slice(e,i);return new Us(o,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}getMaxImageSize(e){let i=0,o=0;for(let u=0;u<this.length();u++){const f=this.getSection(u);if("imageName"in f){const p=e[f.imageName];if(!p)continue;const y=p.displaySize;i=Math.max(i,y[0]),o=Math.max(o,y[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(e,i){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||i});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Zi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):Zi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,i,o,u,f){const p=[],y=this.determineAverageLineWidth(e,i,o,u,f),x=this.hasZeroWidthSpaces();let T=0,E=0;const C=this.text[Symbol.iterator]();let D=C.next();const P=this.text[Symbol.iterator]();P.next();let B=P.next();const O=this.text[Symbol.iterator]();O.next(),O.next();let N=O.next();for(;!D.done;){const G=this.getSection(E),J=D.value.codePointAt(0);if(zh(J)||(T+=op(J,G,o,u,e,f)),!B.done){const q=Zo(J),$=B.value.codePointAt(0);(Ca[J]||q||"imageName"in G||!N.done&&nm[$])&&p.push(Qh(E+1,T,y,p,Ql(J,$,q&&x),!1))}E++,D=C.next(),B=P.next(),N=O.next()}return Wd(Qh(this.length(),T,y,p,0,!0))}determineAverageLineWidth(e,i,o,u,f){let p=0,y=0;for(const x of this.text){const T=this.getSection(y);p+=op(x.codePointAt(0),T,o,u,e,f),y++}return p/Math.max(1,Math.ceil(p/i))}}const Qd=4294967296,lp=1/Qd,up=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Kh{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,i,o=this.length){for(;this.pos<o;){const u=this.readVarint(),f=u>>3,p=this.pos;this.type=7&u,e(f,i,this),this.pos===p&&this.skip(u)}return i}readMessage(e,i){return this.readFields(e,i,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Qd;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Qd;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const i=this.buf;let o,u;return u=i[this.pos++],o=127&u,u<128?o:(u=i[this.pos++],o|=(127&u)<<7,u<128?o:(u=i[this.pos++],o|=(127&u)<<14,u<128?o:(u=i[this.pos++],o|=(127&u)<<21,u<128?o:(u=i[this.pos],o|=(15&u)<<28,(function(f,p,y){const x=y.buf;let T,E;if(E=x[y.pos++],T=(112&E)>>4,E<128||(E=x[y.pos++],T|=(127&E)<<3,E<128)||(E=x[y.pos++],T|=(127&E)<<10,E<128)||(E=x[y.pos++],T|=(127&E)<<17,E<128)||(E=x[y.pos++],T|=(127&E)<<24,E<128)||(E=x[y.pos++],T|=(1&E)<<31,E<128))return al(f,T,p);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=12&&up?up.decode(this.buf.subarray(i,e)):(function(o,u,f){let p="",y=u;for(;y<f;){const x=o[y];let T,E,C,D=null,P=x>239?4:x>223?3:x>191?2:1;if(y+P>f)break;P===1?x<128&&(D=x):P===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):P===3?(T=o[y+1],E=o[y+2],(192&T)==128&&(192&E)==128&&(D=(15&x)<<12|(63&T)<<6|63&E,(D<=2047||D>=55296&&D<=57343)&&(D=null))):P===4&&(T=o[y+1],E=o[y+2],C=o[y+3],(192&T)==128&&(192&E)==128&&(192&C)==128&&(D=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&C,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,P=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=P}return p})(this.buf,i,e)}readBytes(){const e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i}readPackedVarint(e=[],i){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(i));return e}readPackedSVarint(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const i=7&e;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(e,i){this.writeVarint(e<<3|i)}realloc(e){let i=this.length||16;for(;i<this.pos+e;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*lp),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*lp),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(i,o){let u,f;if(i>=0?(u=i%4294967296|0,f=i/4294967296|0):(u=~(-i%4294967296),f=~(-i/4294967296),4294967295^u?u=u+1|0:(u=0,f=f+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(p,y,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)})(u,0,o),(function(p,y){const x=(7&p)<<4;y.buf[y.pos++]|=x|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))})(f,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const i=this.pos;this.pos=(function(u,f,p){for(let y,x,T=0;T<f.length;T++){if(y=f.charCodeAt(T),y>55295&&y<57344){if(!x){y>56319||T+1===f.length?(u[p++]=239,u[p++]=191,u[p++]=189):x=y;continue}if(y<56320){u[p++]=239,u[p++]=191,u[p++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(u[p++]=239,u[p++]=191,u[p++]=189,x=null);y<128?u[p++]=y:(y<2048?u[p++]=y>>6|192:(y<65536?u[p++]=y>>12|224:(u[p++]=y>>18|240,u[p++]=y>>12&63|128),u[p++]=y>>6&63|128),u[p++]=63&y|128)}return p})(this.buf,e,this.pos);const o=this.pos-i;o>=128&&Kd(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const i=e.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,i){this.pos++;const o=this.pos;e(i,this);const u=this.pos-o;u>=128&&Kd(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(e,i,o){this.writeTag(e,2),this.writeRawMessage(i,o)}writePackedVarint(e,i){i.length&&this.writeMessage(e,Hm,i)}writePackedSVarint(e,i){i.length&&this.writeMessage(e,$m,i)}writePackedBoolean(e,i){i.length&&this.writeMessage(e,sm,i)}writePackedFloat(e,i){i.length&&this.writeMessage(e,Xm,i)}writePackedDouble(e,i){i.length&&this.writeMessage(e,am,i)}writePackedFixed32(e,i){i.length&&this.writeMessage(e,Yc,i)}writePackedSFixed32(e,i){i.length&&this.writeMessage(e,Jd,i)}writePackedFixed64(e,i){i.length&&this.writeMessage(e,om,i)}writePackedSFixed64(e,i){i.length&&this.writeMessage(e,lm,i)}writeBytesField(e,i){this.writeTag(e,2),this.writeBytes(i)}writeFixed32Field(e,i){this.writeTag(e,5),this.writeFixed32(i)}writeSFixed32Field(e,i){this.writeTag(e,5),this.writeSFixed32(i)}writeFixed64Field(e,i){this.writeTag(e,1),this.writeFixed64(i)}writeSFixed64Field(e,i){this.writeTag(e,1),this.writeSFixed64(i)}writeVarintField(e,i){this.writeTag(e,0),this.writeVarint(i)}writeSVarintField(e,i){this.writeTag(e,0),this.writeSVarint(i)}writeStringField(e,i){this.writeTag(e,2),this.writeString(i)}writeFloatField(e,i){this.writeTag(e,5),this.writeFloat(i)}writeDoubleField(e,i){this.writeTag(e,1),this.writeDouble(i)}writeBooleanField(e,i){this.writeVarintField(e,+i)}}function al(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function Kd(n,e,i){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(let u=i.pos-1;u>=n;u--)i.buf[u+o]=i.buf[u]}function Hm(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function $m(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function Xm(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function am(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function sm(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function Yc(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function Jd(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function om(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function lm(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}function um(n,e,i){n===1&&i.readMessage(cm,e)}function cm(n,e,i){if(n===3){const{id:o,bitmap:u,width:f,height:p,left:y,top:x,advance:T}=i.readMessage(hm,{});e.push({id:o,bitmap:new jc({width:f+6,height:p+6},u),metrics:{width:f,height:p,left:y,top:x,advance:T}})}}function hm(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}function cp(n){let e=0,i=0;for(const p of n)e+=p.w*p.h,i=Math.max(i,p.w);n.sort(((p,y)=>y.h-p.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const p of n)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,f=Math.max(f,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===x.w&&p.h===x.h){const T=o.pop();T&&y<o.length&&(o[y]=T)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}class Wc{constructor(e,{pixelRatio:i,version:o,stretchX:u,stretchY:f,content:p,textFitWidth:y,textFitHeight:x}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=f,this.content=p,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class hp{constructor(e,i){const o={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,o,f),this.addImages(i,u,f);const{w:p,h:y}=cp(f),x=new Rn({width:p||1,height:y||1});for(const T in e){const E=e[T],C=o[T].paddedRect;Rn.copy(E.data,x,{x:0,y:0},{x:C.x+1,y:C.y+1},E.data)}for(const T in i){const E=i[T],C=u[T].paddedRect,D=C.x+1,P=C.y+1,B=E.data.width,O=E.data.height;Rn.copy(E.data,x,{x:0,y:0},{x:D,y:P},E.data),Rn.copy(E.data,x,{x:0,y:O-1},{x:D,y:P-1},{width:B,height:1}),Rn.copy(E.data,x,{x:0,y:0},{x:D,y:P+O},{width:B,height:1}),Rn.copy(E.data,x,{x:B-1,y:0},{x:D-1,y:P},{width:1,height:O}),Rn.copy(E.data,x,{x:0,y:0},{x:D+B,y:P},{width:1,height:O})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(e,i,o){for(const u in e){const f=e[u],p={x:0,y:0,w:f.data.width+2,h:f.data.height+2};o.push(p),i[u]=new Wc(p,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,f]=e.tl;o.update(i.data,void 0,{x:u,y:f})}}var sl;function Bi(n,e,i,o,u,f,p,y,x,T,E,C,D,P,B){const O=Us.fromFeature(n,u);let N;C===L.aA.vertical&&O.verticalizePunctuation();let G=O.determineLineBreaks(T,f,e,o,P);const{processBidirectionalText:J,processStyledBidirectionalText:q}=Fa;if(J&&O.sections.length===1){N=[],G=G.map((Te=>O.toCodeUnitIndex(Te)));const re=J(O.toString(),G);for(const Te of re){const Ge=[...Te].map((()=>0));N.push(new Us(Te,O.sections,Ge))}}else if(q){N=[],G=G.map((Oe=>O.toCodeUnitIndex(Oe)));let re=0;const Te=[];for(const Oe of O.text)Te.push(...Array(Oe.length).fill(O.sectionIndex[re])),re++;const Ge=q(O.text,Te,G);for(const Oe of Ge){const Je=[];let dt="";for(const nt of Oe[0])Je.push(Oe[1][dt.length]),dt+=nt;N.push(new Us(Oe[0],O.sections,Je))}}else N=(function(re,Te){const Ge=[];let Oe=0;for(const Je of Te)Ge.push(re.substring(Oe,Je)),Oe=Je;return Oe<re.length()&&Ge.push(re.substring(Oe,re.length())),Ge})(O,G);const $=[],ie={positionedLines:$,text:O.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:C,iconsInText:!1,verticalizable:!1};return(function(re,Te,Ge,Oe,Je,dt,nt,je,Pe,wt,xt,Mt){let _t=0,Rt=0,bi=0,ai=0;const bn=je==="right"?1:je==="left"?0:.5,Kr=Li/Mt;let ur=0;for(const Oi of Je){Oi.trim();const Ln=Oi.getMaxScale(),$n={positionedGlyphs:[],lineOffset:0};re.positionedLines[ur]=$n;const rn=$n.positionedGlyphs;let $a=0;if(!Oi.length()){Rt+=dt,++ur;continue}const Jr=Ym(Oe,Oi,Kr);let Xa=0;for(const Mr of Oi.text){const Cn=Oi.getSection(Xa),cr=Mr.codePointAt(0),Bn=Wm(Pe,xt,cr),Er={glyph:cr,imageName:null,x:_t,y:Rt+-17,vertical:Bn,scale:1,fontStack:"",sectionIndex:Oi.getSectionIndex(Xa),metrics:null,rect:null};let rc;if("fontStack"in Cn){if(rc=Qm(Cn,cr,Bn,Jr,Te,Ge),!rc)continue;Er.fontStack=Cn.fontStack}else{if(re.iconsInText=!0,Cn.scale*=Kr,rc=Km(Cn,Bn,Ln,Jr,Oe),!rc)continue;$a=Math.max($a,rc.imageOffset),Er.imageName=Cn.imageName}const{rect:fl,metrics:Fp,baselineOffset:hh}=rc;Er.y+=hh,Er.scale=Cn.scale,Er.metrics=Fp,Er.rect=fl,rn.push(Er),Bn?(re.verticalizable=!0,_t+=("imageName"in Cn?Fp.advance:Li)*Cn.scale+wt):_t+=Fp.advance*Cn.scale+wt,Xa++}rn.length!==0&&(bi=Math.max(_t-wt,bi),ef(rn,0,rn.length-1,bn)),_t=0,$n.lineOffset=Math.max($a,(Ln-1)*Li);const Eo=dt*Ln+$a;Rt+=Eo,ai=Math.max(Eo,ai),++ur}const{horizontalAlign:wn,verticalAlign:dn}=Jh(nt);(function(Oi,Ln,$n,rn,$a,Jr,Xa,Eo,Mr){const Cn=(Ln-$n)*$a;let cr=0;cr=Jr!==Xa?-Eo*rn- -17:-rn*Mr*Xa+.5*Xa;for(const Bn of Oi)for(const Er of Bn.positionedGlyphs)Er.x+=Cn,Er.y+=cr})(re.positionedLines,bn,wn,dn,bi,ai,dt,Rt,Je.length),re.top+=-dn*Rt,re.bottom=re.top+Rt,re.left+=-wn*bi,re.right=re.left+bi})(ie,e,i,o,N,p,y,x,C,T,D,B),!(function(re){for(const Te of re)if(Te.positionedGlyphs.length!==0)return!1;return!0})($)&&ie}function Jh(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Ym(n,e,i){const o=e.getMaxScale()*Li,{maxImageWidth:u,maxImageHeight:f}=e.getMaxImageSize(n),p=Math.max(o,f*i);return{verticalLineContentWidth:Math.max(o,u*i),horizontalLineContentHeight:p}}function dp(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function Wm(n,e,i){return!(n===L.aA.horizontal||!e&&!zc(i)||e&&(zh(i)||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Qm(n,e,i,o,u,f){const p=f[n.fontStack],y=(function(T,E,C,D){if(T&&T.rect)return T;const P=E[C.fontStack],B=P&&P[D];return B?{rect:null,metrics:B.metrics}:null})(p&&p[e],u,n,e);if(y===null)return null;let x;if(i)x=o.verticalLineContentWidth-n.scale*Li;else{const T=dp(n.verticalAlign);x=(o.horizontalLineContentHeight-n.scale*Li)*T}return{rect:y.rect,metrics:y.metrics,baselineOffset:x}}function Km(n,e,i,o,u){const f=u[n.imageName];if(!f)return null;const p=f.paddedRect,y=f.displaySize,x={width:y[0],height:y[1],left:1,top:-3,advance:e?y[1]:y[0]};let T;if(e)T=o.verticalLineContentWidth-y[1]*n.scale;else{const E=dp(n.verticalAlign);T=(o.horizontalLineContentHeight-y[1]*n.scale)*E}return{rect:p,metrics:x,baselineOffset:T,imageOffset:(e?y[0]:y[1])*n.scale-Li*i}}function ef(n,e,i,o){if(o===0)return;const u=n[i],f=(n[i].x+u.metrics.advance*u.scale)*o;for(let p=e;p<=i;p++)n[p].x-=f}function Qc(n,e,i){const{horizontalAlign:o,verticalAlign:u}=Jh(i),f=e[0]-n.displaySize[0]*o,p=e[1]-n.displaySize[1]*u;return{image:n,top:p,bottom:p+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function tf(n){var e,i;let o=n.left,u=n.top,f=n.right-o,p=n.bottom-u;const y=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",x=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",T=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&f/p<T||y==="proportional"){const E=Math.ceil(p*T);o*=E/f,f=E}}else if(y==="proportional"&&x==="stretchOnly"&&T!==0&&f/p>T){const E=Math.ceil(f/T);u*=E/p,p=E}return{x1:o,y1:u,x2:o+f,y2:u+p}}function ed(n,e,i,o,u,f){const p=n.image;let y;if(p.content){const N=p.content,G=p.pixelRatio||1;y=[N[0]/G,N[1]/G,p.displaySize[0]-N[2]/G,p.displaySize[1]-N[3]/G]}const x=e.left*f,T=e.right*f;let E,C,D,P;i==="width"||i==="both"?(P=u[0]+x-o[3],C=u[0]+T+o[1]):(P=u[0]+(x+T-p.displaySize[0])/2,C=P+p.displaySize[0]);const B=e.top*f,O=e.bottom*f;return i==="height"||i==="both"?(E=u[1]+B-o[0],D=u[1]+O+o[2]):(E=u[1]+(B+O-p.displaySize[1])/2,D=E+p.displaySize[1]),{image:p,top:E,right:C,bottom:D,left:P,collisionPadding:y}}ft("ImagePosition",Wc),ft("ImageAtlas",hp),L.aA=void 0,(sl=L.aA||(L.aA={}))[sl.none=0]="none",sl[sl.horizontal=1]="horizontal",sl[sl.vertical=2]="vertical",sl[sl.horizontalOnly=3]="horizontalOnly";const Gs=128,fa=32640;function qs(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new ui(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=i;let f=0;for(;f<o.length&&o[f]<=n;)f++;f=Math.max(0,f-1);let p=f;for(;p<o.length&&o[p]<n+1;)p++;p=Math.min(o.length-1,p);const y=o[f],x=o[p];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new ui(y)),maxSize:i.evaluate(new ui(x)),interpolationType:u}}}function Ju(n,e,i){let o="never";const u=n.get(e);return u?o=u:n.get(i)&&(o="always"),o}const Jm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function td(n,e,i,o,u,f,p,y,x,T,E,C,D){const P=y?Math.min(fa,Math.round(y[0])):0,B=y?Math.min(fa,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*u),f,p,(P<<1)+(x?1:0),B,16*T,16*E,256*C,256*D)}function nf(n,e,i){n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i)}function dm(n){for(const e of n.sections)if(Ic(e.text))return!0;return!1}class rf{constructor(e){this.layoutVertexArray=new K,this.indexArray=new Ae,this.programConfigurations=e,this.segments=new Ke,this.dynamicLayoutVertexArray=new se,this.opacityVertexArray=new ue,this.hasVisibleVertices=!1,this.placedSymbolArray=new l}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rl.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,np.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Jm,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ft("SymbolBuffers",rf);class fp{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new Ke,this.collisionVertexArray=new me}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,rp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ft("CollisionBuffers",fp);class Kl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((p=>p.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qs(this.zoom,i["text-size"]),this.iconSizeData=qs(this.zoom,i["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=Ju(o,"text-overlap","text-allow-overlap")!=="never"||Ju(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((p=>L.aA[p]))),this.stateDependentLayerIds=this.layers.filter((p=>p.isStateDependent())).map((p=>p.id)),this.sourceID=e.sourceID}createArrays(){this.text=new rf(new en(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new rf(new en(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new v,this.lineVertexArray=new w,this.symbolInstances=new _,this.textAnchorOffsets=new A}calculateGlyphDependencies(e,i,o,u,f){for(const p of e)if(i[p.codePointAt(0)]=!0,(o||u)&&f){const y=Xc[p];y&&(i[y.codePointAt(0)]=!0)}}populate(e,i,o){const u=this.layers[0],f=u.layout,p=f.get("text-font"),y=f.get("text-field"),x=f.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof Yn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=f.get("symbol-sort-key");if(this.features=[],!T&&!E)return;const D=i.iconDependencies,P=i.glyphDependencies,B=i.availableImages,O=new ui(this.zoom);for(const{feature:N,id:G,index:J,sourceLayerIndex:q}of e){const $=u._featureFilter.needGeometry,ie=bo(N,$);if(!u._featureFilter.filter(O,ie,o))continue;let re,Te;if($||(ie.geometry=da(N)),T){const Oe=u.getValueAndResolveTokens("text-field",ie,o,B),Je=Yn.factory(Oe),dt=this.hasRTLText=this.hasRTLText||dm(Je);(!dt||Fa.getRTLTextPluginStatus()==="unavailable"||dt&&Fa.isParsed())&&(re=sp(Je,u,ie))}if(E){const Oe=u.getValueAndResolveTokens("icon-image",ie,o,B);Te=Oe instanceof Cr?Oe:Cr.fromString(Oe)}if(!re&&!Te)continue;const Ge=this.sortFeaturesByKey?C.evaluate(ie,{},o):void 0;if(this.features.push({id:G,text:re,icon:Te,index:J,sourceLayerIndex:q,geometry:ie.geometry,properties:N.properties,type:il.types[N.type],sortKey:Ge}),Te&&(D[Te.name]=!0),re){const Oe=p.evaluate(ie,{},o).join(","),Je=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(L.aA.vertical)>=0;for(const dt of re.sections)if(dt.image)D[dt.image.name]=!0;else{const nt=Ma(re.toString()),je=dt.fontStack||Oe,Pe=P[je]=P[je]||{};this.calculateGlyphDependencies(dt.text,Pe,Je,this.allowVerticalPlacement,nt)}}}f.get("symbol-placement")==="line"&&(this.features=(function(N){const G={},J={},q=[];let $=0;function ie(Oe){q.push(N[Oe]),$++}function re(Oe,Je,dt){const nt=J[Oe];return delete J[Oe],J[Je]=nt,q[nt].geometry[0].pop(),q[nt].geometry[0]=q[nt].geometry[0].concat(dt[0]),nt}function Te(Oe,Je,dt){const nt=G[Je];return delete G[Je],G[Oe]=nt,q[nt].geometry[0].shift(),q[nt].geometry[0]=dt[0].concat(q[nt].geometry[0]),nt}function Ge(Oe,Je,dt){const nt=dt?Je[0][Je[0].length-1]:Je[0][0];return`${Oe}:${nt.x}:${nt.y}`}for(let Oe=0;Oe<N.length;Oe++){const Je=N[Oe],dt=Je.geometry,nt=Je.text?Je.text.toString():null;if(!nt){ie(Oe);continue}const je=Ge(nt,dt),Pe=Ge(nt,dt,!0);if(je in J&&Pe in G&&J[je]!==G[Pe]){const wt=Te(je,Pe,dt),xt=re(je,Pe,q[wt].geometry);delete G[je],delete J[Pe],J[Ge(nt,q[xt].geometry,!0)]=xt,q[wt].geometry=null}else je in J?re(je,Pe,dt):Pe in G?Te(je,Pe,dt):(ie(Oe),G[je]=$-1,J[Pe]=$-1)}return q.filter((Oe=>Oe.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((N,G)=>N.sortKey-G.sortKey))}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(i[e.segment+1]),f=e.dist(i[e.segment]);const p={};for(let y=e.segment+1;y<i.length;y++)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:u},y<i.length-1&&(u+=i[y+1].dist(i[y]));for(let y=e.segment||0;y>=0;y--)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=i[y-1].dist(i[y]));for(let y=0;y<i.length;y++){const x=p[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,u,f,p,y,x,T,E,C,D){const P=e.indexArray,B=e.layoutVertexArray,O=e.segments.prepareSegment(4*i.length,B,P,this.canOverlap?p.sortKey:void 0),N=this.glyphOffsetArray.length,G=O.vertexLength,J=this.allowVerticalPlacement&&y===L.aA.vertical?Math.PI/2:0,q=p.text&&p.text.sections;for(let $=0;$<i.length;$++){const{tl:ie,tr:re,bl:Te,br:Ge,tex:Oe,pixelOffsetTL:Je,pixelOffsetBR:dt,minFontScaleX:nt,minFontScaleY:je,glyphOffset:Pe,isSDF:wt,sectionIndex:xt}=i[$],Mt=O.vertexLength,_t=Pe[1];td(B,x.x,x.y,ie.x,_t+ie.y,Oe.x,Oe.y,o,wt,Je.x,Je.y,nt,je),td(B,x.x,x.y,re.x,_t+re.y,Oe.x+Oe.w,Oe.y,o,wt,dt.x,Je.y,nt,je),td(B,x.x,x.y,Te.x,_t+Te.y,Oe.x,Oe.y+Oe.h,o,wt,Je.x,dt.y,nt,je),td(B,x.x,x.y,Ge.x,_t+Ge.y,Oe.x+Oe.w,Oe.y+Oe.h,o,wt,dt.x,dt.y,nt,je),nf(e.dynamicLayoutVertexArray,x,J),P.emplaceBack(Mt,Mt+2,Mt+1),P.emplaceBack(Mt+1,Mt+2,Mt+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pe[0]),$!==i.length-1&&xt===i[$+1].sectionIndex||e.programConfigurations.populatePaintArrays(B.length,p,p.index,{imagePositions:{},canonical:D,formattedSection:q&&q[xt]})}e.placedSymbolArray.emplaceBack(x.x,x.y,N,this.glyphOffsetArray.length-N,G,T,E,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,C)}_addCollisionDebugVertex(e,i,o,u,f,p){return i.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,f,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,i,o,u,f,p,y){const x=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),T=x.vertexLength,E=f.layoutVertexArray,C=f.collisionVertexArray,D=y.anchorX,P=y.anchorY;this._addCollisionDebugVertex(E,C,p,D,P,new de(e,i)),this._addCollisionDebugVertex(E,C,p,D,P,new de(o,i)),this._addCollisionDebugVertex(E,C,p,D,P,new de(o,u)),this._addCollisionDebugVertex(E,C,p,D,P,new de(e,u)),x.vertexLength+=4;const B=f.indexArray;B.emplaceBack(T,T+1),B.emplaceBack(T+1,T+2),B.emplaceBack(T+2,T+3),B.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(e,i,o,u){for(let f=e;f<i;f++){const p=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,u?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fp(te,ap.members,we),this.iconCollisionBox=new fp(te,ap.members,we);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,o,u,f,p,y,x,T){const E={};for(let C=i;C<o;C++){const D=e.get(C);E.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.textFeatureIndex=D.featureIndex;break}for(let C=u;C<f;C++){const D=e.get(C);E.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalTextFeatureIndex=D.featureIndex;break}for(let C=p;C<y;C++){const D=e.get(C);E.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.iconFeatureIndex=D.featureIndex;break}for(let C=x;C<T;C++){const D=e.get(C);E.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalIconFeatureIndex=D.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),u=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+2,f+1),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),u=[],f=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(i*x.anchorX+o*x.anchorY)),f.push(x.featureIndex)}return p.sort(((y,x)=>u[y]-u[x]||f[x]-f[y])),p}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,f,p)=>{u>=0&&p.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let pp,mp;ft("SymbolBucket",Kl,{omit:["layers","collisionBoxArray","features","compareText"]}),Kl.MAX_GLYPHS=65535,Kl.addDynamicAttributes=nf;var gp={get paint(){return mp=mp||new Mn({"icon-opacity":new Ot(be.paint_symbol["icon-opacity"]),"icon-color":new Ot(be.paint_symbol["icon-color"]),"icon-halo-color":new Ot(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ot(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ot(be.paint_symbol["icon-halo-blur"]),"icon-translate":new zt(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new zt(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ot(be.paint_symbol["text-opacity"]),"text-color":new Ot(be.paint_symbol["text-color"],{runtimeType:ea,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Ot(be.paint_symbol["text-halo-color"]),"text-halo-width":new Ot(be.paint_symbol["text-halo-width"]),"text-halo-blur":new Ot(be.paint_symbol["text-halo-blur"]),"text-translate":new zt(be.paint_symbol["text-translate"]),"text-translate-anchor":new zt(be.paint_symbol["text-translate-anchor"])})},get layout(){return pp=pp||new Mn({"symbol-placement":new zt(be.layout_symbol["symbol-placement"]),"symbol-spacing":new zt(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zt(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ot(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zt(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zt(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new zt(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new zt(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new zt(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zt(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ot(be.layout_symbol["icon-size"]),"icon-text-fit":new zt(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ot(be.layout_symbol["icon-image"]),"icon-rotate":new Ot(be.layout_symbol["icon-rotate"]),"icon-padding":new Ot(be.layout_symbol["icon-padding"]),"icon-keep-upright":new zt(be.layout_symbol["icon-keep-upright"]),"icon-offset":new Ot(be.layout_symbol["icon-offset"]),"icon-anchor":new Ot(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zt(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zt(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zt(be.layout_symbol["text-rotation-alignment"]),"text-field":new Ot(be.layout_symbol["text-field"]),"text-font":new Ot(be.layout_symbol["text-font"]),"text-size":new Ot(be.layout_symbol["text-size"]),"text-max-width":new Ot(be.layout_symbol["text-max-width"]),"text-line-height":new zt(be.layout_symbol["text-line-height"]),"text-letter-spacing":new Ot(be.layout_symbol["text-letter-spacing"]),"text-justify":new Ot(be.layout_symbol["text-justify"]),"text-radial-offset":new Ot(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zt(be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ot(be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ot(be.layout_symbol["text-anchor"]),"text-max-angle":new zt(be.layout_symbol["text-max-angle"]),"text-writing-mode":new zt(be.layout_symbol["text-writing-mode"]),"text-rotate":new Ot(be.layout_symbol["text-rotate"]),"text-padding":new zt(be.layout_symbol["text-padding"]),"text-keep-upright":new zt(be.layout_symbol["text-keep-upright"]),"text-transform":new Ot(be.layout_symbol["text-transform"]),"text-offset":new Ot(be.layout_symbol["text-offset"]),"text-allow-overlap":new zt(be.layout_symbol["text-allow-overlap"]),"text-overlap":new zt(be.layout_symbol["text-overlap"]),"text-ignore-placement":new zt(be.layout_symbol["text-ignore-placement"]),"text-optional":new zt(be.layout_symbol["text-optional"])})}};class af{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Hi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ft("FormatSectionOverride",af,{omit:["defaultValue"]});class Kc extends Or{constructor(e,i){super(e,gp,i)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const f of o)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,u){const f=this.layout.get(e).evaluate(i,{},o,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||lo(p.value)||!f?f:(function(y,x){return x.replace(/{([^{}]+)}/g,((T,E)=>y&&E in y?String(y[E]):""))})(i.properties,f)}createBucket(e){return new Kl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of gp.paint.overridableProperties){if(!Kc.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new af(i),u=new Sc(o,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new Rr("source",u):new uo("composite",u,i.value.zoomStops),this.paint._values[e]=new Br(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Kc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),u=gp.paint.properties[i];let f=!1;const p=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Yn)p(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const y=T=>{f||(T instanceof ia&&Qi(T.value)===Ka?p(T.value.sections):T instanceof _u?p(T.sections):T.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return f}}let fm;var eg={get paint(){return fm=fm||new Mn({"background-color":new zt(be.paint_background["background-color"]),"background-pattern":new kr(be.paint_background["background-pattern"]),"background-opacity":new zt(be.paint_background["background-opacity"])})}};class id extends Or{constructor(e,i){super(e,eg,i)}}class tg extends Or{constructor(e,i){super(e,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class pm{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const _i={once:!0},nd=63710088e-1;class Zs{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Zs(Nt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,u=e.lat*i,f=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return nd*Math.acos(Math.min(f,1))}static convert(e){if(e instanceof Zs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Zs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Zs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const sf=2*Math.PI*nd;function _p(n){return sf*Math.cos(n*Math.PI/180)}function of(n){return(180+n)/360}function Jc(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function rd(n,e){return n/_p(e)}function mm(n){return 360*n-180}function ad(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function gm(n,e){return n*_p(ad(e))}class sd{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=Zs.convert(e);return new sd(of(o.lng),Jc(o.lat),rd(i,o.lat))}toLngLat(){return new Zs(mm(this.x),ad(this.y))}toAltitude(){return gm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/sf*(e=ad(this.y),1/Math.cos(e*Math.PI/180));var e}}function yp(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class lf{constructor(e,i,o){if(!(function(u,f,p){return!(u<0||u>25||p<0||p>=Math.pow(2,u)||f<0||f>=Math.pow(2,u))})(e,i,o))throw new Error(`x=${i}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=o,this.key=Hn(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,o){const u=(function(p,y,x){var T=yp(256*p,256*(y=Math.pow(2,x)-y-1),x),E=yp(256*(p+1),256*(y+1),x);return T[0]+","+T[1]+","+E[0]+","+E[1]})(this.x,this.y,this.z),f=(function(p,y,x){let T,E="";for(let C=p;C>0;C--)T=1<<C-1,E+=(y&T?1:0)+(x&T?2:0);return E})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,f).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new de((e.x*i-this.x)*Ve,(e.y*i-this.y)*Ve)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Xi{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Hn(e,i.z,i.z,i.x,i.y)}}class pa{constructor(e,i,o,u,f){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=i,this.canonical=new lf(o,+u,+f),this.key=Hn(i,e,o,u,f)}clone(){return new pa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new pa(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new pa(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Hn(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):Hn(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-e.canonical.z;return!(i<0)&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new pa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new pa(i,this.wrap,i,o,u),new pa(i,this.wrap,i,o+1,u),new pa(i,this.wrap,i,o,u+1),new pa(i,this.wrap,i,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new pa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new pa(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Xi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new sd(e.x-this.wrap,e.y))}}function Hn(n,e,i,o,u){(n*=2)<0&&(n=-1*n-1);const f=1<<i;return(f*f*n+f*u+o).toString(36)+i.toString(36)+e.toString(36)}function od(n,e){return e?n.properties[e]:n.id}function _m(n,e){const i={id:n.id};if(e.removeAllProperties&&(delete n.removeProperties,delete n.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const u=n.addOrUpdateProperties.findIndex((f=>f.key===o));u>-1&&n.addOrUpdateProperties.splice(u,1)}return(n.removeAllProperties||e.removeAllProperties)&&(i.removeAllProperties=!0),(n.removeProperties||e.removeProperties)&&(i.removeProperties=[...n.removeProperties||[],...e.removeProperties||[]]),(n.addOrUpdateProperties||e.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...n.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(n.newGeometry||e.newGeometry)&&(i.newGeometry=e.newGeometry||n.newGeometry),i}function ym(n){var e,i;if(!n)return{};const o={};return o.removeAll=n.removeAll,o.remove=new Set(n.remove||[]),o.add=new Map((e=n.add)===null||e===void 0?void 0:e.map((u=>[u.id,u]))),o.update=new Map((i=n.update)===null||i===void 0?void 0:i.map((u=>[u.id,u]))),o}ft("CanonicalTileID",lf),ft("OverscaledTileID",pa,{omit:["terrainRttPosMatrix32f"]});class uf{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class cf{constructor(e,i,o,u,f){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=u,this._z=i,this.properties=e.properties,this.id=f}projectPoint(e,i,o,u){return[360*(e.x+i)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/u)*Math.PI))-90]}projectLine(e,i,o,u){return e.map((f=>this.projectPoint(f,i,o,u)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,i=e.extent*Math.pow(2,this._z),o=e.extent*this._x,u=e.extent*this._y,f=e.loadGeometry();switch(e.type){case 1:{const p=[];for(const x of f)p.push(x[0]);const y=this.projectLine(p,o,u,i);this._geometry=p.length===1?{type:"Point",coordinates:y[0]}:{type:"MultiPoint",coordinates:y};break}case 2:{const p=f.map((y=>this.projectLine(y,o,u,i)));this._geometry=p.length===1?{type:"LineString",coordinates:p[0]}:{type:"MultiLineString",coordinates:p};break}case 3:{const p=Hh(f),y=[];for(const x of p)y.push(x.map((T=>this.projectLine(T,o,u,i))));this._geometry=y.length===1?{type:"Polygon",coordinates:y[0]}:{type:"MultiPolygon",coordinates:y};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&i!=="_x"&&i!=="_y"&&i!=="_z"&&(e[i]=this[i]);return e}}class ol{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,i,o){this._name=e,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class ld extends ol{}class hf extends ld{getValueFromBuffer(e){return this.dataBuffer[e]}}class ud extends ld{getValueFromBuffer(e){return this.dataBuffer[e]}}class df extends ol{delta;constructor(e,i,o,u){super(e,i,u),this.delta=o}}class vp extends df{constructor(e,i,o,u){super(e,Int32Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class ff extends ol{constructor(e,i,o){super(e,Int32Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class ig{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,i,o,u,f=4096){this._name=e,this._geometryVector=i,this._idVector=o,this._propertyVectors=u,this._extent=f}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const u=e?.next().value,f={};for(const p of this.propertyVectors){if(!p)continue;const y=p.name,x=p.getValue(i);x!==null&&(f[y]=x)}i++,yield{id:o,geometry:u,properties:f}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const f={coordinates:i[o],type:this.geometryVector.geometryType(o)},p={};for(const y of this.propertyVectors){if(!y)continue;const x=y.name,T=y.getValue(o);T!==null&&(p[x]=T)}e.push({id:u,geometry:f,properties:p})}return e}containsMaxSaveIntegerValues(e){return e instanceof hf||e instanceof ff&&e instanceof vp||e instanceof ud}}class vm{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var ii,ll,xn,ys,Jl,Yr,or,lr,xp,ma;function Kn(n,e,i){const o=new Int32Array(i);let u=0,f=e.get();for(let p=0;p<o.length;p++){let y=n[f++],x=127&y;y<128||(y=n[f++],x|=(127&y)<<7,y<128||(y=n[f++],x|=(127&y)<<14,y<128||(y=n[f++],x|=(127&y)<<21,y<128||(y=n[f++],x|=(15&y)<<28)))),o[u++]=x}return e.set(f),o}function pf(n,e,i){const o=new BigInt64Array(i);for(let u=0;u<o.length;u++)o[u]=xm(n,e);return o}function vs(n,e){let i,o;return o=n[e.get()],e.increment(),i=127&o,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<7,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<14,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<21,o<128?i:(o=n[e.get()],i|=(15&o)<<28,(function(u,f,p){let y,x;if(x=f[p.get()],p.increment(),y=(112&x)>>4,x<128||(x=f[p.get()],p.increment(),y|=(127&x)<<3,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<10,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<17,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<24,x<128)||(x=f[p.get()],p.increment(),y|=(1&x)<<31,x<128))return 4294967296*y+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,n,e)))))}function mf(n,e,i,o){throw new Error("FastPFor is not implemented yet.")}function eu(n){return n>>>1^-(1&n)}function ec(n){return n>>1n^-(1n&n)}function xm(n,e){let i=0n,o=0,u=e.get();for(;u<n.length;){const f=n[u++];if(i|=BigInt(127&f)<<BigInt(o),!(128&f))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(u),i}function eh(n,e,i){const o=new Int32Array(i);let u=0;for(let f=0;f<e;f++){const p=n[f];o.fill(n[f+e],u,u+p),u+=p}return o}function Ha(n,e,i){const o=new BigInt64Array(i);let u=0;for(let f=0;f<e;f++){const p=Number(n[f]);o.fill(n[f+e],u,u+p),u+=p}return o}function bp(n,e,i){const o=new Float64Array(i);let u=0;for(let f=0;f<e;f++){const p=n[f];o.fill(n[f+e],u,u+p),u+=p}return o}function th(n){const e=n.length/4*4;let i=1;if(e>=4)for(let o=n[0];i<e-4;i+=4)o=n[i]+=o,o=n[i+1]+=o,o=n[i+2]+=o,o=n[i+3]+=o;for(;i!=n.length;)n[i]+=n[i-1],++i}function Mo(n){n[0]=n[0]>>>1^-(1&n[0]),n[1]=n[1]>>>1^-(1&n[1]);const e=n.length/4*4;let i=2;if(e>=4)for(;i<e-4;i+=4){const o=n[i],u=n[i+1],f=n[i+2],p=n[i+3];n[i]=(o>>>1^-(1&o))+n[i-2],n[i+1]=(u>>>1^-(1&u))+n[i-1],n[i+2]=(f>>>1^-(1&f))+n[i],n[i+3]=(p>>>1^-(1&p))+n[i+1]}for(;i!=n.length;i+=2)n[i]=(n[i]>>>1^-(1&n[i]))+n[i-2],n[i+1]=(n[i+1]>>>1^-(1&n[i+1]))+n[i-1]}(function(n){n.NONE="NONE",n.DELTA="DELTA",n.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",n.RLE="RLE",n.MORTON="MORTON",n.PDE="PDE"})(ii||(ii={})),(function(n){n.NONE="NONE",n.FAST_PFOR="FAST_PFOR",n.VARINT="VARINT",n.ALP="ALP"})(ll||(ll={})),(function(n){n.PRESENT="PRESENT",n.DATA="DATA",n.OFFSET="OFFSET",n.LENGTH="LENGTH"})(xn||(xn={}));class wp{_dictionaryType;_offsetType;_lengthType;constructor(e,i,o){this._dictionaryType=e,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Wr(n,e){const i=(function(o,u){const f=o[u.get()],p=Object.values(xn)[f>>4];let y=null;switch(p){case xn.DATA:y=new wp(Object.values(ys)[15&f]);break;case xn.OFFSET:y=new wp(null,Object.values(Jl)[15&f]);break;case xn.LENGTH:y=new wp(null,null,Object.values(Yr)[15&f])}u.increment();const x=o[u.get()],T=Object.values(ii)[x>>5],E=Object.values(ii)[x>>2&7],C=Object.values(ll)[3&x];u.increment();const D=Kn(o,u,2),P=D[0];return{physicalStreamType:p,logicalStreamType:y,logicalLevelTechnique1:T,logicalLevelTechnique2:E,physicalLevelTechnique:C,numValues:P,byteLength:D[1],decompressedCount:P}})(n,e);return i.logicalLevelTechnique1===ii.MORTON?(function(o,u,f){const p=Kn(u,f,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:p[0],coordinateShift:p[1]}})(i,n,e):ii.RLE!==i.logicalLevelTechnique1&&ii.RLE!==i.logicalLevelTechnique2||ll.NONE===i.physicalLevelTechnique?i:(function(o,u,f){const p=Kn(u,f,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:p[1],runs:p[0],numRleValues:p[1]}})(i,n,e)}(function(n){n.NONE="NONE",n.SINGLE="SINGLE",n.SHARED="SHARED",n.VERTEX="VERTEX",n.MORTON="MORTON",n.FSST="FSST"})(ys||(ys={})),(function(n){n.VERTEX="VERTEX",n.INDEX="INDEX",n.STRING="STRING",n.KEY="KEY"})(Jl||(Jl={})),(function(n){n.VAR_BINARY="VAR_BINARY",n.GEOMETRIES="GEOMETRIES",n.PARTS="PARTS",n.RINGS="RINGS",n.TRIANGLES="TRIANGLES",n.SYMBOL="SYMBOL",n.DICTIONARY="DICTIONARY"})(Yr||(Yr={})),(function(n){n[n.FLAT=0]="FLAT",n[n.CONST=1]="CONST",n[n.SEQUENCE=2]="SEQUENCE",n[n.DICTIONARY=3]="DICTIONARY",n[n.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(or||(or={}));class Qr{values;_size;constructor(e,i){this.values=e,this._size=i}get(e){const i=Math.floor(e/8);return(this.values[i]>>e%8&1)==1}set(e,i){const o=Math.floor(e/8);this.values[o]=this.values[o]|(i?1:0)<<e%8}getInt(e){const i=Math.floor(e/8);return this.values[i]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function jr(n,e,i,o,u){return(function(f,p,y){switch(p.logicalLevelTechnique1){case ii.DELTA:return p.logicalLevelTechnique2===ii.RLE?(function(x,T,E){const C=new Int32Array(E);let D=0,P=0;for(let B=0;B<T;B++){const O=x[B],N=eu(x[B+T]);for(let G=0;G<O;G++)P+=N,C[D++]=P}return C})(f,p.runs,p.numRleValues):((function(x){x[0]=x[0]>>>1^-(1&x[0]);const T=x.length/4*4;let E=1;if(T>=4)for(;E<T-4;E+=4){const C=x[E],D=x[E+1],P=x[E+2],B=x[E+3];x[E]=(C>>>1^-(1&C))+x[E-1],x[E+1]=(D>>>1^-(1&D))+x[E],x[E+2]=(P>>>1^-(1&P))+x[E+1],x[E+3]=(B>>>1^-(1&B))+x[E+2]}for(;E!=x.length;++E)x[E]=(x[E]>>>1^-(1&x[E]))+x[E-1]})(f),f);case ii.RLE:return(function(x,T,E){return E?(function(C,D,P){const B=new Int32Array(P);let O=0;for(let N=0;N<D;N++){const G=C[N];let J=C[N+D];J=J>>>1^-(1&J),B.fill(J,O,O+G),O+=G}return B})(x,T.runs,T.numRleValues):eh(x,T.runs,T.numRleValues)})(f,p,y);case ii.MORTON:return th(f),f;case ii.COMPONENTWISE_DELTA:return Mo(f),f;case ii.NONE:return y&&(function(x){for(let T=0;T<x.length;T++){const E=x[T];x[T]=E>>>1^-(1&E)}})(f),f;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}})(gf(n,e,i),i,o)}function tu(n,e,i){return(function(o,u){if(u.logicalLevelTechnique1===ii.DELTA&&u.logicalLevelTechnique2===ii.NONE)return(function(p){const y=new Int32Array(p.length+1);y[0]=0,y[1]=eu(p[0]);let x=y[1],T=2;for(;T!=y.length;++T){const E=p[T-1];x+=E>>>1^-(1&E),y[T]=y[T-1]+x}return y})(o);if(u.logicalLevelTechnique1===ii.RLE&&u.logicalLevelTechnique2===ii.NONE)return(function(p,y,x){const T=new Int32Array(x+1);T[0]=0;let E=1,C=T[0];for(let D=0;D<y;D++){const P=p[D],B=p[D+y];for(let O=E;O<E+P;O++)T[O]=B+C,C=T[O];E+=P}return T})(o,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===ii.NONE&&u.logicalLevelTechnique2===ii.NONE){(function(p){let y=0;for(let x=0;x<p.length;x++)p[x]+=y,y=p[x]})(o);const f=new Int32Array(u.numValues+1);return f[0]=0,f.set(o,1),f}if(u.logicalLevelTechnique1===ii.DELTA&&u.logicalLevelTechnique2===ii.RLE){const f=(function(p,y,x){const T=new Int32Array(x+1);T[0]=0;let E=1,C=T[0];for(let D=0;D<y;D++){const P=p[D];let B=p[D+y];B=B>>>1^-(1&B);for(let O=E;O<E+P;O++)T[O]=B+C,C=T[O];E+=P}return T})(o,u.runs,u.numRleValues);return th(f),f}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(gf(n,e,i),i)}function gf(n,e,i){const o=i.physicalLevelTechnique;if(o===ll.FAST_PFOR)return mf();if(o===ll.VARINT)return Kn(n,e,i.numValues);if(o===ll.NONE){const u=e.get();e.add(i.byteLength);const f=n.subarray(u,e.get());return new Int32Array(f)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Tp(n,e,i,o){const u=gf(n,e,i);if(u.length===1){const f=u[0];return o?eu(f):f}return o?(function(f){return eu(f[1])})(u):(function(f){return f[1]})(u)}function bm(n,e,i){return(function(o){if(o.length==2){const u=eu(o[1]);return[u,u]}return[eu(o[2]),eu(o[3])]})(gf(n,e,i))}function wm(n,e,i){return(function(o){if(o.length==2){const u=ec(o[1]);return[u,u]}return[ec(o[2]),ec(o[3])]})(pf(n,e,i.numValues))}function Tm(n,e,i,o){return(function(u,f,p){switch(f.logicalLevelTechnique1){case ii.DELTA:return f.logicalLevelTechnique2===ii.RLE?(function(y,x,T){const E=new BigInt64Array(T);let C=0,D=0n;for(let P=0;P<x;P++){const B=Number(y[P]),O=ec(y[P+x]);for(let N=0;N<B;N++)D+=O,E[C++]=D}return E})(u,f.runs,f.numRleValues):((function(y){y[0]=y[0]>>1n^-(1n&y[0]);const x=y.length/4*4;let T=1;if(x>=4)for(;T<x-4;T+=4){const E=y[T],C=y[T+1],D=y[T+2],P=y[T+3];y[T]=(E>>1n^-(1n&E))+y[T-1],y[T+1]=(C>>1n^-(1n&C))+y[T],y[T+2]=(D>>1n^-(1n&D))+y[T+1],y[T+3]=(P>>1n^-(1n&P))+y[T+2]}for(;T!=y.length;++T)y[T]=(y[T]>>1n^-(1n&y[T]))+y[T-1]})(u),u);case ii.RLE:return(function(y,x,T){return T?(function(E,C,D){const P=new BigInt64Array(D);let B=0;for(let O=0;O<C;O++){const N=Number(E[O]);let G=E[O+C];G=G>>1n^-(1n&G),P.fill(G,B,B+N),B+=N}return P})(y,x.runs,x.numRleValues):Ha(y,x.runs,x.numRleValues)})(u,f,p);case ii.NONE:return p&&(function(y){for(let x=0;x<y.length;x++){const T=y[x];y[x]=T>>1n^-(1n&T)}})(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${f.logicalLevelTechnique1}`)}})(pf(n,e,i.numValues),i,o)}function Sm(n,e,i,o){const u=pf(n,e,i.numValues);if(u.length===1){const f=u[0];return o?ec(f):f}return o?(function(f){return ec(f[1])})(u):(function(f){return f[1]})(u)}function _f(n,e,i,o,u){return(function(f,p,y,x){switch(p.logicalLevelTechnique1){case ii.DELTA:return p.logicalLevelTechnique2===ii.RLE&&(f=eh(f,p.runs,p.numRleValues)),(function(T,E){const C=new Int32Array(T.size());let D=0;T.get(0)?(C[0]=T.get(0)?E[0]>>>1^-(1&E[0]):0,D=1):C[0]=0;let P=1;for(;P!=C.length;++P)C[P]=T.get(P)?C[P-1]+(E[D]>>>1^-(1&E[D++])):C[P-1];return C})(x,f);case ii.RLE:return(function(T,E,C,D){const P=E;return C?(function(B,O,N){const G=new Int32Array(B.size());let J=0;for(let q=0;q<N;q++){const $=O[q];let ie=O[q+N];ie=ie>>>1^-(1&ie);for(let re=J;re<J+$;re++)B.get(re)?G[re]=ie:(G[re]=0,J++);J+=$}return G})(D,T,P.runs):(function(B,O,N){const G=new Int32Array(B.size());let J=0;for(let q=0;q<N;q++){const $=O[q],ie=O[q+N];for(let re=J;re<J+$;re++)B.get(re)?G[re]=ie:(G[re]=0,J++);J+=$}return G})(D,T,P.runs)})(f,p,y,x);case ii.MORTON:return th(f),f;case ii.COMPONENTWISE_DELTA:return Mo(f),f;case ii.NONE:return f=y?(function(T,E){const C=new Int32Array(T.size());let D=0,P=0;for(;P!=C.length;++P)if(T.get(P)){const B=E[D++];C[P]=B>>>1^-(1&B)}else C[P]=0;return C})(x,f):(function(T,E){const C=new Int32Array(T.size());let D=0,P=0;for(;P!=C.length;++P)C[P]=T.get(P)?E[D++]:0;return C})(x,f),f;default:throw new Error("The specified Logical level technique is not supported")}})(i.physicalLevelTechnique===ll.FAST_PFOR?mf():Kn(n,e,i.numValues),i,o,u)}function ul(n,e,i,o){const u=n.logicalLevelTechnique1;if(u===ii.RLE)return n.runs===1?or.CONST:or.FLAT;const f=e instanceof Qr?e.size():e;if(u===ii.DELTA&&n.logicalLevelTechnique2===ii.RLE){const p=n.runs,y=2;if(n.numRleValues!==f)return or.FLAT;if(p===1)return or.SEQUENCE;if(p===2){const x=o.get();let T;if(n.physicalLevelTechnique===ll.VARINT)T=Kn(i,o,4);else{const E=o.get();T=new Int32Array(i.buffer,i.byteOffset+E,4)}if(o.set(x),T[2]===y&&T[3]===y)return or.SEQUENCE}}return n.numValues===1?or.CONST:or.FLAT}class ih extends ld{getValueFromBuffer(e){return this.dataBuffer[e]}}class Sp extends df{constructor(e,i,o,u){super(e,BigInt64Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class nh{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,i,o){this._geometryOffsets=e,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function iu(n,e,i){return{x:rh(n,e)-i,y:rh(n>>1,e)-i}}function rh(n,e){let i=0;for(let o=0;o<e;o++)i|=(n&1<<2*o)>>o;return i}(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON",n[n.MULTIPOINT=3]="MULTIPOINT",n[n.MULTILINESTRING=4]="MULTILINESTRING",n[n.MULTIPOLYGON=5]="MULTIPOLYGON"})(lr||(lr={})),(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON"})(xp||(xp={})),(function(n){n[n.MORTON=0]="MORTON",n[n.VEC_2=1]="VEC_2",n[n.VEC_3=2]="VEC_3"})(ma||(ma={}));class Mm{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((i=>[i]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,i){return[e].concat(i)}createMultiPolygon(e){return e.flat()}}function cd(n){const e=new Array(n.numGeometries);let i=1,o=1,u=1,f=0;const p=new Mm;let y=0,x=0;const T=n.mortonSettings,E=n.topologyVector,C=E.geometryOffsets,D=E.partOffsets,P=E.ringOffsets,B=n.vertexOffsets,O=n.containsPolygonGeometry(),N=n.vertexBuffer;for(let G=0;G<n.numGeometries;G++){const J=n.geometryType(G);if(J===lr.POINT){if(B&&B.length!==0)if(n.vertexBufferType===ma.VEC_2){const q=2*B[x++],$=new de(N[q],N[q+1]);e[f++]=p.createPoint($)}else{const q=iu(N[B[x++]],T.numBits,T.coordinateShift),$=new de(q.x,q.y);e[f++]=p.createPoint($)}else{const q=new de(N[y++],N[y++]);e[f++]=p.createPoint(q)}C&&u++,D&&i++,P&&o++}else if(J===lr.MULTIPOINT){const q=C[u]-C[u-1];u++;const $=new Array(q);if(B&&B.length!==0){for(let ie=0;ie<q;ie++){const re=2*B[x++];$[ie]=new de(N[re],N[re+1])}e[f++]=p.createMultiPoint($)}else{for(let ie=0;ie<q;ie++){const re=N[y++],Te=N[y++];$[ie]=new de(re,Te)}e[f++]=p.createMultiPoint($)}}else if(J===lr.LINESTRING){let q,$=0;O?($=P[o]-P[o-1],o++):$=D[i]-D[i-1],i++,B&&B.length!==0?(q=n.vertexBufferType===ma.VEC_2?vf(N,B,x,$,!1):Mp(N,B,x,$,!1,T),x+=$):(q=yf(N,y,$,!1),y+=2*$),e[f++]=p.createLineString(q),C&&u++}else if(J===lr.POLYGON){const q=D[i]-D[i-1];i++;const $=new Array(q-1);let ie=P[o]-P[o-1];if(o++,B&&B.length!==0){const re=n.vertexBufferType===ma.VEC_2?sh(N,B,x,ie):tc(N,B,x,ie,0,T);x+=ie;for(let Te=0;Te<$.length;Te++)ie=P[o]-P[o-1],o++,$[Te]=n.vertexBufferType===ma.VEC_2?sh(N,B,x,ie):tc(N,B,x,ie,0,T),x+=ie;e[f++]=p.createPolygon(re,$)}else{const re=ah(N,y,ie);y+=2*ie;for(let Te=0;Te<$.length;Te++)ie=P[o]-P[o-1],o++,$[Te]=ah(N,y,ie),y+=2*ie;e[f++]=p.createPolygon(re,$)}C&&u++}else if(J===lr.MULTILINESTRING){const q=C[u]-C[u-1];u++;const $=new Array(q);if(B&&B.length!==0){for(let ie=0;ie<q;ie++){let re=0;O?(re=P[o]-P[o-1],o++):re=D[i]-D[i-1],i++;const Te=n.vertexBufferType===ma.VEC_2?vf(N,B,x,re,!1):Mp(N,B,x,re,!1,T);$[ie]=Te,x+=re}e[f++]=p.createMultiLineString($)}else{for(let ie=0;ie<q;ie++){let re=0;O?(re=P[o]-P[o-1],o++):re=D[i]-D[i-1],i++,$[ie]=yf(N,y,re,!1),y+=2*re}e[f++]=p.createMultiLineString($)}}else{if(J!==lr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const q=C[u]-C[u-1];u++;const $=new Array(q);let ie=0;if(B&&B.length!==0){for(let re=0;re<q;re++){const Te=D[i]-D[i-1];i++;const Ge=new Array(Te-1);ie=P[o]-P[o-1],o++;const Oe=n.vertexBufferType===ma.VEC_2?sh(N,B,x,ie):tc(N,B,x,ie,0,T);x+=ie;for(let Je=0;Je<Ge.length;Je++)ie=P[o]-P[o-1],o++,Ge[Je]=n.vertexBufferType===ma.VEC_2?sh(N,B,x,ie):tc(N,B,x,ie,0,T),x+=ie;$[re]=p.createPolygon(Oe,Ge)}e[f++]=p.createMultiPolygon($)}else{for(let re=0;re<q;re++){const Te=D[i]-D[i-1];i++;const Ge=new Array(Te-1);ie=P[o]-P[o-1],o++;const Oe=ah(N,y,ie);y+=2*ie;for(let Je=0;Je<Ge.length;Je++){const dt=P[o]-P[o-1];o++,Ge[Je]=ah(N,y,dt),y+=2*dt}$[re]=p.createPolygon(Oe,Ge)}e[f++]=p.createMultiPolygon($)}}}}return e}function ah(n,e,i){return yf(n,e,i,!0)}function sh(n,e,i,o){return vf(n,e,i,o,!0)}function tc(n,e,i,o,u,f){return Mp(n,e,i,o,!0,f)}function yf(n,e,i,o){const u=new Array(o?i+1:i);for(let f=0;f<2*i;f+=2)u[f/2]=new de(n[e+f],n[e+f+1]);return o&&(u[u.length-1]=u[0]),u}function vf(n,e,i,o,u){const f=new Array(u?o+1:o);for(let p=0;p<2*o;p+=2){const y=2*e[i+p/2];f[p/2]=new de(n[y],n[y+1])}return u&&(f[f.length-1]=f[0]),f}function Mp(n,e,i,o,u,f){const p=new Array(u?o+1:o);for(let y=0;y<o;y++){const x=iu(n[e[i+y]],f.numBits,f.coordinateShift);p[y]=new de(x.x,x.y)}return u&&(p[p.length-1]=p[0]),p}class Ep{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,i,o,u,f){this._vertexBufferType=e,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=u,this._mortonSettings=f}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=cd(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:e[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(e){const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=iu(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return cd(this)}get mortonSettings(){return this._mortonSettings}}class Em extends Ep{_numGeometries;_geometryType;constructor(e,i,o,u,f,p,y){super(o,u,f,p,y),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===lr.POLYGON||this._geometryType===lr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class xf extends Ep{_geometryTypes;constructor(e,i,o,u,f,p){super(e,o,u,f,p),this._geometryTypes=i}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===lr.POLYGON||this.geometryType(e)===lr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class Am{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,i,o,u){this._triangleOffsets=e,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,u=i.ringOffsets,f=i.geometryOffsets;let p=0,y=1,x=1,T=1;for(let E=0;E<this.numGeometries;E++)switch(this.geometryType(E)){case lr.POLYGON:{const C=o[y]-o[y-1];y++;const D=[];for(let P=0;P<C;P++){const B=u[x]-u[x-1];x++;const O=[];for(let N=0;N<B;N++){const G=this._vertexBuffer[p++],J=this._vertexBuffer[p++];O.push(new de(G,J))}O.length>0&&O.push(O[0]),D.push(O)}e[E]=D,f&&T++}break;case lr.MULTIPOLYGON:{const C=f[T]-f[T-1];T++;const D=[];for(let P=0;P<C;P++){const B=o[y]-o[y-1];y++;for(let O=0;O<B;O++){const N=u[x]-u[x-1];x++;const G=[];for(let J=0;J<N;J++){const q=this._vertexBuffer[p++],$=this._vertexBuffer[p++];G.push(new de(q,$))}G.length>0&&G.push(G[0]),D.push(G)}}e[E]=D}}return e}[Symbol.iterator](){return null}}function hd(n,e,i,o,u,f){return new bf(n,e,i,o,u,f)}class bf extends Am{_numGeometries;_geometryType;constructor(e,i,o,u,f,p){super(o,u,f,p),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function dd(n,e,i,o,u){return new ng(n,e,i,o,u)}class ng extends Am{_geometryTypes;constructor(e,i,o,u,f){super(i,o,u,f),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function fd(n,e,i,o,u){const f=Wr(n,i);let p=null,y=null,x=null,T=null,E=null,C=null,D=null,P=null;if(ul(f,o,n,i)===or.CONST){const O=Tp(n,i,f,!1);for(let N=0;N<e-1;N++){const G=Wr(n,i);switch(G.physicalStreamType){case xn.LENGTH:switch(G.logicalStreamType.lengthType){case Yr.GEOMETRIES:p=tu(n,i,G);break;case Yr.PARTS:y=tu(n,i,G);break;case Yr.RINGS:x=tu(n,i,G);break;case Yr.TRIANGLES:D=tu(n,i,G)}break;case xn.OFFSET:switch(G.logicalStreamType.offsetType){case Jl.VERTEX:T=jr(n,i,G,!1);break;case Jl.INDEX:P=jr(n,i,G,!1)}break;case xn.DATA:ys.VERTEX===G.logicalStreamType.dictionaryType?E=jr(n,i,G,!0):(C={numBits:G.numBits,coordinateShift:G.coordinateShift},E=jr(n,i,G,!1))}}return P!==null?p!=null||y!=null?hd(o,O,D,P,E,new nh(p,y,x)):hd(o,O,D,P,E):C===null?(function(N,G,J,q,$){return new Em(N,G,ma.VEC_2,J,q,$)})(o,O,new nh(p,y,x),T,E):(function(N,G,J,q,$,ie){return new Em(N,G,ma.MORTON,J,q,$,ie)})(o,O,new nh(p,y,x),T,E,C)}const B=jr(n,i,f,!1);for(let O=0;O<e-1;O++){const N=Wr(n,i);switch(N.physicalStreamType){case xn.LENGTH:switch(N.logicalStreamType.lengthType){case Yr.GEOMETRIES:p=jr(n,i,N,!1);break;case Yr.PARTS:y=jr(n,i,N,!1);break;case Yr.RINGS:x=jr(n,i,N,!1);break;case Yr.TRIANGLES:D=tu(n,i,N)}break;case xn.OFFSET:switch(N.logicalStreamType.offsetType){case Jl.VERTEX:T=jr(n,i,N,!1);break;case Jl.INDEX:P=jr(n,i,N,!1)}break;case xn.DATA:ys.VERTEX===N.logicalStreamType.dictionaryType?E=jr(n,i,N,!0):(C={numBits:N.numBits,coordinateShift:N.coordinateShift},E=jr(n,i,N,!1))}}return P!==null&&y===null?dd(B,D,P,E):(p!==null?(p=Ap(B,p,2),y!==null&&x!==null?(y=Cp(B,p,y,!1),x=(function(O,N,G,J){const q=new Int32Array(G[G.length-1]+1);let $=0;q[0]=$;let ie=1,re=1,Te=0;for(let Ge=0;Ge<O.length;Ge++){const Oe=O[Ge],Je=N[Ge+1]-N[Ge];if(Oe!==0&&Oe!==3)for(let dt=0;dt<Je;dt++){const nt=G[ie]-G[ie-1];ie++;for(let je=0;je<nt;je++)$=q[re++]=$+J[Te++]}else for(let dt=0;dt<Je;dt++)q[re++]=++$,ie++}return q})(B,p,y,x)):y!==null&&(y=(function(O,N,G){const J=new Int32Array(N[N.length-1]+1);let q=0;J[0]=q;let $=1,ie=0;for(let re=0;re<O.length;re++){const Te=O[re],Ge=N[re+1]-N[re];if(Te===4||Te===1)for(let Oe=0;Oe<Ge;Oe++)q=J[$++]=q+G[ie++];else for(let Oe=0;Oe<Ge;Oe++)J[$++]=++q}return J})(B,p,y))):y!==null&&x!==null?(y=Ap(B,y,1),x=Cp(B,y,x,!0)):y!==null&&(y=Ap(B,y,0)),P!==null?dd(B,D,P,E,new nh(p,y,x)):C===null?(function(O,N,G,J){return new xf(ma.VEC_2,O,N,G,J)})(B,new nh(p,y,x),T,E):(function(O,N,G,J,q){return new xf(ma.MORTON,O,N,G,J,q)})(B,new nh(p,y,x),T,E,C))}function Ap(n,e,i){const o=new Int32Array(n.length+1);let u=0;o[0]=u;let f=0;for(let p=0;p<n.length;p++)u=o[p+1]=u+(n[p]>i?e[f++]:1);return o}function Cp(n,e,i,o){const u=new Int32Array(e[e.length-1]+1);let f=0;u[0]=f;let p=1,y=0;for(let x=0;x<n.length;x++){const T=n[x],E=e[x+1]-e[x];if(T===5||T===2||o&&(T===4||T===1))for(let C=0;C<E;C++)f=u[p++]=f+i[y++];else for(let C=0;C<E;C++)u[p++]=++f}return u}class Cm extends ol{dataVector;constructor(e,i,o){super(e,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(e){return this.dataVector.get(e)}}class zm extends ld{getValueFromBuffer(e){return this.dataBuffer[e]}}class zp extends ol{constructor(e,i,o){super(e,BigInt64Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function ic(n,e,i){return Dp(n,Math.ceil(e/8),i)}function Dp(n,e,i){const o=new Uint8Array(e);let u=0;for(;u<e;){const f=n[i.increment()];if(f<=127){const p=f+3,y=n[i.increment()],x=u+p;o.fill(y,u,x),u=x}else{const p=256-f;for(let y=0;y<p;y++)o[u++]=n[i.increment()]}}return o}const Dm=new TextDecoder;function oh(n,e,i){return i-e>=12?Dm.decode(n.subarray(e,i)):(function(o,u,f){let p="",y=u;for(;y<f;){const x=o[y];let T,E,C,D=null,P=x>239?4:x>223?3:x>191?2:1;if(y+P>f)break;P===1?x<128&&(D=x):P===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):P===3?(T=o[y+1],E=o[y+2],(192&T)==128&&(192&E)==128&&(D=(15&x)<<12|(63&T)<<6|63&E,(D<=2047||D>=55296&&D<=57343)&&(D=null))):P===4&&(T=o[y+1],E=o[y+2],C=o[y+3],(192&T)==128&&(192&E)==128&&(192&C)==128&&(D=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&C,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,P=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=P}return p})(n,e,i)}class Pp extends ol{offsetBuffer;constructor(e,i,o,u){super(e,o,u),this.offsetBuffer=i}}class Pm extends Pp{textEncoder;constructor(e,i,o,u){super(e,i,o,u??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return oh(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class nu extends Pp{indexBuffer;textEncoder;constructor(e,i,o,u,f){super(e,o,u,f??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const i=this.indexBuffer[e];return oh(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class wf extends Pp{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,i,o,u,f,p,y){super(e,o,u,y),this.indexBuffer=i,this.symbolOffsetBuffer=f,this.symbolTableBuffer=p,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,u,f){const p=[],y=new Array(u.length).fill(0);for(let x=1;x<u.length;x++)y[x]=y[x-1]+u[x-1];for(let x=0;x<f.length;x++)if(f[x]===255)p.push(f[++x]);else{const T=u[f[x]],E=y[f[x]];for(let C=0;C<T;C++)p.push(o[E+C])}return new Uint8Array(p)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[e];return oh(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(e){const i=new Uint32Array(e.length-1);let o=e[0];for(let u=1;u<e.length;u++){const f=e[u];i[u-1]=f-o,o=f}return i}}function Tf(n,e,i,o,u,f){return i.type==="scalarType"?(function(p,y,x,T,E,C){let D=null,P=0;if(p===0)return null;if(C.nullable){const O=Wr(y,x);P=O.numValues;const N=x.get(),G=ic(y,P,x);x.set(N+O.byteLength),D=new Qr(G,O.numValues)}const B=D??T;switch(E.physicalType){case 4:case 3:return(function(O,N,G,J,q){const $=Wr(O,N),ie=ul($,q,O,N),re=J.physicalType===3;if(ie===or.FLAT){const Te=nc(q)?_f(O,N,$,re,q):jr(O,N,$,re);return new hf(G.name,Te,q)}if(ie===or.SEQUENCE){const Te=bm(O,N,$);return new vp(G.name,Te[0],Te[1],$.numRleValues)}{const Te=Tp(O,N,$,re);return new ff(G.name,Te,q)}})(y,x,C,E,B);case 9:return(function(O,N,G,J,q){let $=null,ie=null,re=null,Te=null,Ge=null,Oe=null,Je=null,dt=null;for(let nt=0;nt<J;nt++){const je=Wr(N,G);if(je.byteLength!==0)switch(je.physicalStreamType){case xn.PRESENT:{const Pe=ic(N,je.numValues,G);Oe=new Qr(Pe,je.numValues);break}case xn.OFFSET:ie=q!=null||Oe!=null?_f(N,G,je,!1,q??Oe):jr(N,G,je,!1);break;case xn.LENGTH:{const Pe=tu(N,G,je);Yr.DICTIONARY===je.logicalStreamType.lengthType?$=Pe:Yr.SYMBOL===je.logicalStreamType.lengthType?Te=Pe:Je=Pe;break}case xn.DATA:{const Pe=N.subarray(G.get(),G.get()+je.byteLength);G.add(je.byteLength);const wt=je.logicalStreamType.dictionaryType;ys.FSST===wt?Ge=Pe:ys.SINGLE===wt||ys.SHARED===wt?re=Pe:ys.NONE===wt&&(dt=Pe);break}}}return(function(nt,je,Pe,wt,xt,Mt,_t){return je?new wf(nt,Pe,wt,xt,Mt,je,_t):null})(O,Ge,ie,$,re,Te,q??Oe)??(function(nt,je,Pe,wt,xt){return je?xt?new nu(nt,Pe,wt,je,xt):new nu(nt,Pe,wt,je):null})(O,re,ie,$,q??Oe)??(function(nt,je,Pe,wt,xt){if(!je||!Pe)return null;if(wt)return xt?new nu(nt,wt,je,Pe,xt):new nu(nt,wt,je,Pe);if(xt&&xt.size()!==je.length-1){const Mt=new Int32Array(xt.size());let _t=0;for(let Rt=0;Rt<xt.size();Rt++)Mt[Rt]=xt.get(Rt)?_t++:0;return new nu(nt,Mt,je,Pe,xt)}return xt?new Pm(nt,je,Pe,xt):new Pm(nt,je,Pe)})(O,Je,dt,ie,q??Oe)})(C.name,y,x,C.nullable?p-1:p,D);case 0:return(function(O,N,G,J,q){const $=Wr(O,N),ie=$.numValues,re=N.get(),Te=nc(q)?(function(Oe,Je,dt,nt){const je=Dp(Oe,Math.ceil(Je/8),dt),Pe=new Qr(je,Je),wt=nt.size(),xt=new Qr(new Uint8Array(wt),wt);let Mt=0;for(let _t=0;_t<nt.size();_t++){const Rt=!!nt.get(_t)&&Pe.get(Mt++);xt.set(_t,Rt)}return xt.getBuffer()})(O,ie,N,q):ic(O,ie,N);N.set(re+$.byteLength);const Ge=new Qr(Te,ie);return new Cm(G.name,Ge,q)})(y,x,C,0,B);case 6:case 5:return(function(O,N,G,J,q){const $=Wr(O,N),ie=ul($,J,O,N),re=q.physicalType===5;if(ie===or.FLAT){const Te=nc(J)?(function(Ge,Oe,Je,dt,nt){return(function(je,Pe,wt,xt){switch(Pe.logicalLevelTechnique1){case ii.DELTA:return Pe.logicalLevelTechnique2===ii.RLE&&(je=Ha(je,Pe.runs,Pe.numRleValues)),(function(Mt,_t){const Rt=new BigInt64Array(Mt.size());let bi=0;Mt.get(0)?(Rt[0]=Mt.get(0)?_t[0]>>1n^-(1n&_t[0]):0n,bi=1):Rt[0]=0n;let ai=1;for(;ai!=Rt.length;++ai)Rt[ai]=Mt.get(ai)?Rt[ai-1]+(_t[bi]>>1n^-(1n&_t[bi++])):Rt[ai-1];return Rt})(xt,je);case ii.RLE:return(function(Mt,_t,Rt,bi){const ai=_t;return Rt?(function(bn,Kr,ur){const wn=new BigInt64Array(bn.size());let dn=0;for(let Oi=0;Oi<ur;Oi++){const Ln=Number(Kr[Oi]);let $n=Kr[Oi+ur];$n=$n>>1n^-(1n&$n);for(let rn=dn;rn<dn+Ln;rn++)bn.get(rn)?wn[rn]=$n:(wn[rn]=0n,dn++);dn+=Ln}return wn})(bi,Mt,ai.runs):(function(bn,Kr,ur){const wn=new BigInt64Array(bn.size());let dn=0;for(let Oi=0;Oi<ur;Oi++){const Ln=Number(Kr[Oi]),$n=Kr[Oi+ur];for(let rn=dn;rn<dn+Ln;rn++)bn.get(rn)?wn[rn]=$n:(wn[rn]=0n,dn++);dn+=Ln}return wn})(bi,Mt,ai.runs)})(je,Pe,wt,xt);case ii.NONE:return je=wt?(function(Mt,_t){const Rt=new BigInt64Array(Mt.size());let bi=0,ai=0;for(;ai!=Rt.length;++ai)if(Mt.get(ai)){const bn=_t[bi++];Rt[ai]=bn>>1n^-(1n&bn)}else Rt[ai]=0n;return Rt})(xt,je):(function(Mt,_t){const Rt=new BigInt64Array(Mt.size());let bi=0,ai=0;for(;ai!=Rt.length;++ai)Rt[ai]=Mt.get(ai)?_t[bi++]:0n;return Rt})(xt,je),je;default:throw new Error("The specified Logical level technique is not supported")}})(pf(Ge,Oe,Je.numValues),Je,dt,nt)})(O,N,$,re,J):Tm(O,N,$,re);return new ih(G.name,Te,J)}if(ie===or.SEQUENCE){const Te=wm(O,N,$);return new Sp(G.name,Te[0],Te[1],$.numRleValues)}{const Te=Sm(O,N,$,re);return new zp(G.name,Te,J)}})(y,x,C,B,E);case 7:return(function(O,N,G,J){const q=Wr(O,N),$=nc(J)?(function(ie,re,Te,Ge){const Oe=re.get(),Je=Oe+Ge*Float32Array.BYTES_PER_ELEMENT,dt=new Uint8Array(ie.subarray(Oe,Je)).buffer,nt=new Float32Array(dt);re.set(Je);const je=Te.size(),Pe=new Float32Array(je);let wt=0;for(let xt=0;xt<je;xt++)Pe[xt]=Te.get(xt)?nt[wt++]:0;return Pe})(O,N,J,q.numValues):(function(ie,re,Te){const Ge=re.get(),Oe=Ge+Te*Float32Array.BYTES_PER_ELEMENT,Je=new Uint8Array(ie.subarray(Ge,Oe)).buffer,dt=new Float32Array(Je);return re.set(Oe),dt})(O,N,q.numValues);return new zm(G.name,$,J)})(y,x,C,B);case 8:return(function(O,N,G,J){const q=Wr(O,N),$=nc(J)?(function(ie,re,Te,Ge){const Oe=re.get(),Je=Oe+Ge*Float64Array.BYTES_PER_ELEMENT,dt=new Uint8Array(ie.subarray(Oe,Je)).buffer,nt=new Float64Array(dt);re.set(Je);const je=Te.size(),Pe=new Float64Array(je);let wt=0;for(let xt=0;xt<je;xt++)Pe[xt]=Te.get(xt)?nt[wt++]:0;return Pe})(O,N,J,q.numValues):(function(ie,re,Te){const Ge=re.get(),Oe=Ge+Te*Float64Array.BYTES_PER_ELEMENT,Je=new Uint8Array(ie.subarray(Ge,Oe)).buffer,dt=new Float64Array(Je);return re.set(Oe),dt})(O,N,q.numValues);return new ud(G.name,$,J)})(y,x,C,B);default:throw new Error(`The specified data type for the field is currently not supported: ${E}`)}})(o,n,e,u,i.scalarType,i):o!=1?null:(function(p,y,x,T){let E=null,C=null,D=null,P=null,B=!1;for(;!B;){const J=Wr(p,y);switch(J.physicalStreamType){case xn.LENGTH:Yr.DICTIONARY===J.logicalStreamType.lengthType?E=tu(p,y,J):D=tu(p,y,J);break;case xn.DATA:ys.SINGLE===J.logicalStreamType.dictionaryType||ys.SHARED===J.logicalStreamType.dictionaryType?(C=p.subarray(y.get(),y.get()+J.byteLength),B=!0):P=p.subarray(y.get(),y.get()+J.byteLength),y.add(J.byteLength)}}const O=x.complexType.children,N=[];let G=0;for(const J of O){const q=Kn(p,y,1)[0];if(q==0)continue;const $=`${x.name}${J.name==="default"?"":":"+J.name}`;if(q!==2||J.type!=="scalarField"||J.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const ie=Wr(p,y),re=ic(p,ie.numValues,y),Te=Wr(p,y),Ge=Te.decompressedCount!==T?_f(p,y,Te,!1,new Qr(re,ie.numValues)):jr(p,y,Te,!1);N[G++]=P?new wf($,Ge,E,C,D,P,new Qr(re,ie.numValues)):new nu($,Ge,E,C,new Qr(re,ie.numValues))}return N})(n,e,i,u)}function nc(n){return n instanceof Qr}function Im(n){if(n.name==="id")return!1;if(n.type==="scalarType"){const e=n.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(n.type==="complexType"){const e=n.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",n),!1}const Ip=new TextDecoder;function cl(n,e){const i=Kn(n,e,1)[0];if(i===0)return"";const o=e.get(),u=n.subarray(o,o+i);return e.add(i),Ip.decode(u)}function hl(n,e){const i=Kn(n,e,1)[0]>>>0,o=!!(4&i),u=!!(2&i),f=Kn(n,e,1)[0]>>>0,p={};if(1&i&&(p.nullable=!0),u){const y={};if(o?(y.type="logicalType",y.logicalType=f):(y.type="physicalType",y.physicalType=f),8&i){const x=Kn(n,e,1)[0]>>>0;y.children=new Array(x);for(let T=0;T<x;T++)y.children[T]=hl(n,e)}p.type="complexField",p.complexField=y}else{const y={};o?(y.type="logicalType",y.logicalType=f):(y.type="physicalType",y.physicalType=f),p.type="scalarField",p.scalarField=y}return p}function ru(n,e){const i=Kn(n,e,1)[0]>>>0,o=(function(u){switch(u){case 0:case 1:case 2:case 3:{const f={};f.nullable=!!(1&u),f.columnScope=0;const p={};return p.physicalType=u>1?6:4,p.type="physicalType",f.scalarType=p,f.type="scalarType",f}case 4:{const f={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:0};return f.type="complexType",f.complexType=p,f}case 30:{const f={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:1};return f.type="complexType",f.complexType=p,f}default:return(function(f){let p=null;switch(f){case 10:case 11:p=0;break;case 12:case 13:p=1;break;case 14:case 15:p=2;break;case 16:case 17:p=3;break;case 18:case 19:p=4;break;case 20:case 21:p=5;break;case 22:case 23:p=6;break;case 24:case 25:p=7;break;case 26:case 27:p=8;break;case 28:case 29:p=9;break;default:return null}const y={};y.nullable=!!(1&f),y.columnScope=0;const x={type:"physicalType"};return x.physicalType=p,y.type="scalarType",y.scalarType=x,y})(u)}})(i);if(!o)throw new Error(`Unsupported column type code: ${i}`);if((function(u){return u>=10})(i)?o.name=cl(n,e):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),(function(u){return u===30})(i)){const u=Kn(n,e,1)[0]>>>0,f=o.complexType;f.children=new Array(u);for(let p=0;p<u;p++)f.children[p]=hl(n,e)}return o}function pd(n,e){const i={featureTables:[]},o={};o.name=cl(n,e);const u=Kn(n,e,1)[0]>>>0,f=Kn(n,e,1)[0]>>>0;o.columns=new Array(f);for(let p=0;p<f;p++)o.columns[p]=ru(n,e);return i.featureTables.push(o),[i,u]}function md(n,e,i,o,u,f,p=!1){const y=e.scalarType.physicalType,x=ul(u,f,n,i);if(y===4)switch(x){case or.FLAT:{const T=jr(n,i,u,!1);return new hf(o,T,f)}case or.SEQUENCE:{const T=bm(n,i,u);return new vp(o,T[0],T[1],u.numRleValues)}case or.CONST:{const T=Tp(n,i,u,!1);return new ff(o,T,f)}}else switch(x){case or.FLAT:{if(p){const E=(function(C,D,P,B){const O=(function(N,G,J){const q=new Float64Array(G);for(let $=0;$<G;$++)q[$]=vs(N,J);return q})(C,P.numValues,D);return(function(N,G,J){switch(G.logicalLevelTechnique1){case ii.DELTA:return G.logicalLevelTechnique2===ii.RLE&&(N=bp(N,G.runs,G.numRleValues)),(function(q){q[0]=q[0]%2==1?(q[0]+1)/-2:q[0]/2;const $=q.length/4*4;let ie=1;if($>=4)for(;ie<$-4;ie+=4){const re=q[ie],Te=q[ie+1],Ge=q[ie+2],Oe=q[ie+3];q[ie]=(re%2==1?(re+1)/-2:re/2)+q[ie-1],q[ie+1]=(Te%2==1?(Te+1)/-2:Te/2)+q[ie],q[ie+2]=(Ge%2==1?(Ge+1)/-2:Ge/2)+q[ie+1],q[ie+3]=(Oe%2==1?(Oe+1)/-2:Oe/2)+q[ie+2]}for(;ie!=q.length;++ie)q[ie]=(q[ie]%2==1?(q[ie]+1)/-2:q[ie]/2)+q[ie-1]})(N),N;case ii.RLE:return(function(q,$,ie){return bp(q,$.runs,$.numRleValues)})(N,G);case ii.NONE:return N;default:throw new Error(`The specified Logical level technique is not supported: ${G.logicalLevelTechnique1}`)}})(O,P)})(n,i,u);return new ud(o,E,f)}const T=Tm(n,i,u,!1);return new ih(o,T,f)}case or.SEQUENCE:{const T=wm(n,i,u);return new Sp(o,T[0],T[1],u.numRleValues)}case or.CONST:{const T=Sm(n,i,u,!1);return new zp(o,T,f)}}throw new Error("Vector type not supported for id column.")}class au{constructor(e,i){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case lr.POINT:case lr.MULTIPOINT:this.type=1;break;case lr.LINESTRING:case lr.MULTILINESTRING:this.type=2;break;case lr.POLYGON:case lr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const u of i)o.push(new de(u.x,u.y));e.push(o)}return e}}class rg{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new au(this.features[e],this.extent)}}class Rp{constructor(e){this.layers={};const i=(function(o,u,f=!0){const p=new vm(0),y=[];for(;p.get()<o.length;){const x=Kn(o,p,1)[0]>>>0,T=p.get()+x;if(T>o.length)throw new Error(`Block overruns tile: ${T} > ${o.length}`);if(Kn(o,p,1)[0]>>>0!=1){p.set(T);continue}const E=pd(o,p),C=E[1],D=E[0].featureTables[0];let P=null,B=null;const O=[];let N=0;for(const J of D.columns){const q=J.name;if(q==="id"){let $=null;if(J.nullable){const re=Wr(o,p),Te=p.get(),Ge=ic(o,re.numValues,p);p.set(Te+re.byteLength),$=new Qr(Ge,re.numValues)}const ie=Wr(o,p);N=ie.decompressedCount,P=md(o,J,p,q,ie,$??N,f)}else if(q==="geometry"){const $=Kn(o,p,1)[0];if(N===0){const ie=p.get();N=Wr(o,p).decompressedCount,p.set(ie)}B=fd(o,$,p,N)}else{const $=Im(J)?Kn(o,p,1)[0]:1;if($===0&&J.type==="scalarType")continue;const ie=Tf(o,p,J,$,N);if(ie)if(Array.isArray(ie))for(const re of ie)O.push(re);else O.push(ie)}}const G=new ig(D.name,B,P,O,C);y.push(G),p.set(T)}return y})(new Uint8Array(e));this.layers=i.reduce(((o,u)=>Object.assign(Object.assign({},o),{[u.name]:new rg(u)})),{})}}class Hs{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const i=new Hs;return i.extend(e(new de(this.minX,this.minY))),i.extend(e(new de(this.maxX,this.minY))),i.extend(e(new de(this.minX,this.maxY))),i.extend(e(new de(this.maxX,this.maxY))),i}static fromPoints(e){const i=new Hs;for(const o of e)i.extend(o);return i}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class ag{constructor(e,i){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=i,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],i=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of i){const u=[];for(const f of o)u.push(new de(f[0],f[1]));e.push(u)}return e}}const lh="_geojsonTileLayer";function Sf(n,e){e.writeVarintField(15,n.version||1),e.writeStringField(1,n.name||""),e.writeVarintField(5,n.extent||4096);const i={keys:[],values:[],keycache:{},valuecache:{}};for(let f=0;f<n.length;f++)i.feature=n.feature(f),e.writeMessage(2,Rm,i);const o=i.keys;for(const f of o)e.writeStringField(3,f);const u=i.values;for(const f of u)e.writeMessage(4,ch,f)}function Rm(n,e){if(!n.feature)return;const i=n.feature;i.id!==void 0&&e.writeVarintField(1,i.id),e.writeMessage(2,sg,n),e.writeVarintField(3,i.type),e.writeMessage(4,Lm,i)}function sg(n,e){for(const i in n.feature?.properties){let o=n.feature.properties[i],u=n.keycache[i];if(o===null)continue;u===void 0&&(n.keys.push(i),u=n.keys.length-1,n.keycache[i]=u),e.writeVarint(u),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const f=typeof o+":"+o;let p=n.valuecache[f];p===void 0&&(n.values.push(o),p=n.values.length-1,n.valuecache[f]=p),e.writeVarint(p)}}function uh(n,e){return(e<<3)+(7&n)}function gd(n){return n<<1^n>>31}function Lm(n,e){const i=n.loadGeometry(),o=n.type;let u=0,f=0;for(const p of i){let y=1;o===1&&(y=p.length),e.writeVarint(uh(1,y));const x=o===3?p.length-1:p.length;for(let T=0;T<x;T++){T===1&&o!==1&&e.writeVarint(uh(2,x-1));const E=p[T].x-u,C=p[T].y-f;e.writeVarint(gd(E)),e.writeVarint(gd(C)),u+=E,f+=C}n.type===3&&e.writeVarint(uh(7,1))}}function ch(n,e){const i=typeof n;i==="string"?e.writeStringField(1,n):i==="boolean"?e.writeBooleanField(7,n):i==="number"&&(n%1!=0?e.writeDoubleField(3,n):n<0?e.writeSVarintField(6,n):e.writeVarintField(5,n))}class Lp{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new po(Ve,16,0),this.grid3D=new po(Ve,16,0),this.featureIndexArray=new R,this.promoteId=i}insert(e,i,o,u,f,p){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,f);const x=p?this.grid3D:this.grid;for(let T=0;T<i.length;T++){const E=i[T],C=[1/0,1/0,-1/0,-1/0];for(let D=0;D<E.length;D++){const P=E[D];C[0]=Math.min(C[0],P.x),C[1]=Math.min(C[1],P.y),C[2]=Math.max(C[2],P.x),C[3]=Math.max(C[3],P.y)}C[0]<Ve&&C[1]<Ve&&C[2]>=0&&C[3]>=0&&x.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new Ri(new Kh(this.rawTileData)).layers:new Rp(this.rawTileData).layers,this.sourceLayerCoder=new uf(this.vtLayers?Object.keys(this.vtLayers).sort():[lh])),this.vtLayers}query(e,i,o,u){this.loadVTLayers();const f=e.params,p=Ve/e.tileSize/e.scale,y=Gr(f.filter,f.globalState),x=e.queryGeometry,T=e.queryPadding*p,E=Hs.fromPoints(x),C=this.grid.query(E.minX-T,E.minY-T,E.maxX+T,E.maxY+T),D=Hs.fromPoints(e.cameraQueryGeometry).expandBy(T),P=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,((N,G,J,q)=>(function($,ie,re,Te,Ge){for(const Je of $)if(ie<=Je.x&&re<=Je.y&&Te>=Je.x&&Ge>=Je.y)return!0;const Oe=[new de(ie,re),new de(ie,Ge),new de(Te,Ge),new de(Te,re)];if($.length>2){for(const Je of Oe)if(Zu($,Je))return!0}for(let Je=0;Je<$.length-1;Je++)if(Gp($[Je],$[Je+1],Oe))return!0;return!1})(e.cameraQueryGeometry,N-T,G-T,J+T,q+T)));for(const N of P)C.push(N);C.sort(Ef);const B={};let O;for(let N=0;N<C.length;N++){const G=C[N];if(G===O)continue;O=G;const J=this.featureIndexArray.get(G);let q=null;this.loadMatchingFeature(B,J.bucketIndex,J.sourceLayerIndex,J.featureIndex,y,f.layers,f.availableImages,i,o,u,(($,ie,re)=>(q||(q=da($)),ie.queryIntersectsFeature({queryGeometry:x,feature:$,featureState:re,geometry:q,zoom:this.z,transform:e.transform,pixelsToTileUnits:p,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return B}loadMatchingFeature(e,i,o,u,f,p,y,x,T,E,C){const D=this.bucketLayerIDs[i];if(p&&!D.some((N=>p.has(N))))return;const P=this.sourceLayerCoder.decode(o),B=this.vtLayers[P].feature(u);if(f.needGeometry){const N=bo(B,!0);if(!f.filter(new ui(this.tileID.overscaledZ),N,this.tileID.canonical))return}else if(!f.filter(new ui(this.tileID.overscaledZ),B))return;const O=this.getId(B,P);for(let N=0;N<D.length;N++){const G=D[N];if(p&&!p.has(G))continue;const J=x[G];if(!J)continue;let q={};O&&E&&(q=E.getState(J.sourceLayer||lh,O));const $=yi({},T[G]);$.paint=Mf($.paint,J.paint,B,q,y),$.layout=Mf($.layout,J.layout,B,q,y);const ie=!C||C(B,J,q);if(!ie)continue;const re=new cf(B,this.z,this.x,this.y,O);re.layer=$;let Te=e[G];Te===void 0&&(Te=e[G]=[]),Te.push({featureIndex:u,feature:re,intersectionZ:ie})}}lookupSymbolFeatures(e,i,o,u,f,p,y,x){const T={};this.loadVTLayers();const E=Gr(f.filterSpec,f.globalState);for(const C of e)this.loadMatchingFeature(T,o,u,C,E,p,y,x,i);return T}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){var o;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function Mf(n,e,i,o,u){return Jn(n,((f,p)=>{const y=e instanceof Xo?e.get(p):null;return y&&y.evaluate?y.evaluate(i,o,u):y}))}function Ef(n,e){return e-n}function Bp(n,e,i,o,u){const f=[];for(let p=0;p<n.length;p++){const y=n[p];let x;for(let T=0;T<y.length-1;T++){let E=y[T],C=y[T+1];E.x<e&&C.x<e||(E.x<e?E=new de(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x<e&&(C=new de(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y<i&&C.y<i||(E.y<i?E=new de(E.x+(i-E.y)/(C.y-E.y)*(C.x-E.x),i)._round():C.y<i&&(C=new de(E.x+(i-E.y)/(C.y-E.y)*(C.x-E.x),i)._round()),E.x>=o&&C.x>=o||(E.x>=o?E=new de(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x>=o&&(C=new de(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y>=u&&C.y>=u||(E.y>=u?E=new de(E.x+(u-E.y)/(C.y-E.y)*(C.x-E.x),u)._round():C.y>=u&&(C=new de(E.x+(u-E.y)/(C.y-E.y)*(C.x-E.x),u)._round()),x&&E.equals(x[x.length-1])||(x=[E],f.push(x)),x.push(C)))))}}return f}function Bm(n,e,i,o,u){switch(e){case 1:return(function(f,p,y,x){const T=[];for(const E of f)for(const C of E){const D=x===0?C.x:C.y;D>=p&&D<=y&&T.push([C])}return T})(n,i,o,u);case 2:return r(n,i,o,u,!1);case 3:return r(n,i,o,u,!0)}return[]}function Af(n,e,i,o,u){const f=o===0?s:c;let p=[];const y=[];for(let E=0;E<n.length-1;E++){const C=n[E],D=n[E+1],P=o===0?C.x:C.y,B=o===0?D.x:D.y;let O=!1;P<e?B>e&&p.push(f(C,D,e)):P>i?B<i&&p.push(f(C,D,i)):p.push(C),B<e&&P>=e&&(p.push(f(C,D,e)),O=!0),B>i&&P<=i&&(p.push(f(C,D,i)),O=!0),!u&&O&&(y.push(p),p=[])}const x=n.length-1,T=o===0?n[x].x:n[x].y;return T>=e&&T<=i&&p.push(n[x]),u&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(new de(p[0].x,p[0].y)),p.length>0&&y.push(p),y}function r(n,e,i,o,u){const f=[];for(const p of n){const y=Af(p,e,i,o,u);y.length>0&&f.push(...y)}return f}function s(n,e,i){return new de(i,n.y+(i-n.x)/(e.x-n.x)*(e.y-n.y))}function c(n,e,i){return new de(n.x+(i-n.y)/(e.y-n.y)*(e.x-n.x),i)}ft("FeatureIndex",Lp,{omit:["rawTileData","sourceLayerCoder"]});class g extends de{constructor(e,i,o,u){super(e,i),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new g(this.x,this.y,this.angle,this.segment)}}function b(n,e,i,o,u){if(e.segment===void 0||i===0)return!0;let f=e,p=e.segment+1,y=0;for(;y>-i/2;){if(p--,p<0)return!1;y-=n[p].dist(f),f=n[p]}y+=n[p].dist(n[p+1]),p++;const x=[];let T=0;for(;y<i/2;){const E=n[p],C=n[p+1];if(!C)return!1;let D=n[p-1].angleTo(E)-E.angleTo(C);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:D}),T+=D;y-x[0].distance>o;)T-=x.shift().angleDelta;if(T>u)return!1;p++,y+=E.dist(C)}return!0}function M(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function k(n,e,i){return n?.6*e*i:0}function Z(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function he(n,e,i,o,u,f){const p=k(i,u,f),y=Z(i,o)*f;let x=0;const T=M(n)/2;for(let E=0;E<n.length-1;E++){const C=n[E],D=n[E+1],P=C.dist(D);if(x+P>T){const B=(T-x)/P,O=Ki.number(C.x,D.x,B),N=Ki.number(C.y,D.y,B),G=new g(O,N,D.angleTo(C),E);return G._round(),!p||b(n,G,y,p,e)?G:void 0}x+=P}}function Le(n,e,i,o,u,f,p,y,x){const T=k(o,f,p),E=Z(o,u),C=E*p,D=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-C<e/4&&(e=C+e/4),Xe(n,D?e/2*y%e:(E/2+2*f)*p*y%e,e,T,i,C,D,!1,x)}function Xe(n,e,i,o,u,f,p,y,x){const T=f/2,E=M(n);let C=0,D=e-i,P=[];for(let B=0;B<n.length-1;B++){const O=n[B],N=n[B+1],G=O.dist(N),J=N.angleTo(O);for(;D+i<C+G;){D+=i;const q=(D-C)/G,$=Ki.number(O.x,N.x,q),ie=Ki.number(O.y,N.y,q);if($>=0&&$<x&&ie>=0&&ie<x&&D-T>=0&&D+T<=E){const re=new g($,ie,J,B);re._round(),o&&!b(n,re,f,o,u)||P.push(re)}}C+=G}return y||P.length||p||(P=Xe(n,C/2,i,o,u,f,p,!0,x)),P}function st(n,e,i,o){const u=[],f=n.image,p=f.pixelRatio,y=f.paddedRect.w-2,x=f.paddedRect.h-2;let T={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const E=f.stretchX||[[0,y]],C=f.stretchY||[[0,x]],D=(Pe,wt)=>Pe+wt[1]-wt[0],P=E.reduce(D,0),B=C.reduce(D,0),O=y-P,N=x-B;let G=0,J=P,q=0,$=B,ie=0,re=O,Te=0,Ge=N;if(f.content&&o){const Pe=f.content,wt=Pe[2]-Pe[0],xt=Pe[3]-Pe[1];(f.textFitWidth||f.textFitHeight)&&(T=tf(n)),G=Be(E,0,Pe[0]),q=Be(C,0,Pe[1]),J=Be(E,Pe[0],Pe[2]),$=Be(C,Pe[1],Pe[3]),ie=Pe[0]-G,Te=Pe[1]-q,re=wt-J,Ge=xt-$}const Oe=T.x1,Je=T.y1,dt=T.x2-Oe,nt=T.y2-Je,je=(Pe,wt,xt,Mt)=>{const _t=It(Pe.stretch-G,J,dt,Oe),Rt=qt(Pe.fixed-ie,re,Pe.stretch,P),bi=It(wt.stretch-q,$,nt,Je),ai=qt(wt.fixed-Te,Ge,wt.stretch,B),bn=It(xt.stretch-G,J,dt,Oe),Kr=qt(xt.fixed-ie,re,xt.stretch,P),ur=It(Mt.stretch-q,$,nt,Je),wn=qt(Mt.fixed-Te,Ge,Mt.stretch,B),dn=new de(_t,bi),Oi=new de(bn,bi),Ln=new de(bn,ur),$n=new de(_t,ur),rn=new de(Rt/p,ai/p),$a=new de(Kr/p,wn/p),Jr=e*Math.PI/180;if(Jr){const Mr=Math.sin(Jr),Cn=Math.cos(Jr),cr=[Cn,-Mr,Mr,Cn];dn._matMult(cr),Oi._matMult(cr),$n._matMult(cr),Ln._matMult(cr)}const Xa=Pe.stretch+Pe.fixed,Eo=wt.stretch+wt.fixed;return{tl:dn,tr:Oi,bl:$n,br:Ln,tex:{x:f.paddedRect.x+1+Xa,y:f.paddedRect.y+1+Eo,w:xt.stretch+xt.fixed-Xa,h:Mt.stretch+Mt.fixed-Eo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:rn,pixelOffsetBR:$a,minFontScaleX:re/p/dt,minFontScaleY:Ge/p/nt,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const Pe=Ne(E,O,P),wt=Ne(C,N,B);for(let xt=0;xt<Pe.length-1;xt++){const Mt=Pe[xt],_t=Pe[xt+1];for(let Rt=0;Rt<wt.length-1;Rt++)u.push(je(Mt,wt[Rt],_t,wt[Rt+1]))}}else u.push(je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function Be(n,e,i){let o=0;for(const u of n)o+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return o}function Ne(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[u,f]of n){const p=o[o.length-1];o.push({fixed:u-p.stretch,stretch:p.stretch}),o.push({fixed:u-p.stretch,stretch:p.stretch+(f-u)})}return o.push({fixed:e+1,stretch:i}),o}function It(n,e,i,o){return n/e*i+o}function qt(n,e,i,o){return n-e*i/o}ft("Anchor",g);class qi{constructor(e,i,o,u,f,p,y,x,T,E){var C;if(this.boxStartIndex=e.length,T){let D=p.top,P=p.bottom;const B=p.collisionPadding;B&&(D-=B[1],P+=B[3]);let O=P-D;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{const D=!((C=p.image)===null||C===void 0)&&C.content&&(p.image.textFitWidth||p.image.textFitHeight)?tf(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};D.y1=D.y1*y-x[0],D.y2=D.y2*y+x[2],D.x1=D.x1*y-x[3],D.x2=D.x2*y+x[1];const P=p.collisionPadding;if(P&&(D.x1-=P[0]*y,D.y1-=P[1]*y,D.x2+=P[2]*y,D.y2+=P[3]*y),E){const B=new de(D.x1,D.y1),O=new de(D.x2,D.y1),N=new de(D.x1,D.y2),G=new de(D.x2,D.y2),J=E*Math.PI/180;B._rotate(J),O._rotate(J),N._rotate(J),G._rotate(J),D.x1=Math.min(B.x,O.x,N.x,G.x),D.x2=Math.max(B.x,O.x,N.x,G.x),D.y1=Math.min(B.y,O.y,N.y,G.y),D.y2=Math.max(B.y,O.y,N.y,G.y)}e.emplaceBack(i.x,i.y,D.x1,D.y1,D.x2,D.y2,o,u,f)}this.boxEndIndex=e.length}}class ve{constructor(e=[],i=(o,u)=>o<u?-1:o>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,u=i[e];for(;e>0;){const f=e-1>>1,p=i[f];if(o(u,p)>=0)break;i[e]=p,e=f}i[e]=u}_down(e){const{data:i,compare:o}=this,u=this.length>>1,f=i[e];for(;e<u;){let p=1+(e<<1);const y=p+1;if(y<this.length&&o(i[y],i[p])<0&&(p=y),o(i[p],f)>=0)break;i[e]=i[p],e=p}i[e]=f}}function ge(n,e=1,i=!1){const o=Hs.fromPoints(n[0]),u=Math.min(o.width(),o.height());let f=u/2;const p=new ve([],Ie),{minX:y,minY:x,maxX:T,maxY:E}=o;if(u===0)return new de(y,x);for(let P=y;P<T;P+=u)for(let B=x;B<E;B+=u)p.push(new Qe(P+f,B+f,f,n));let C=(function(P){let B=0,O=0,N=0;const G=P[0];for(let J=0,q=G.length,$=q-1;J<q;$=J++){const ie=G[J],re=G[$],Te=ie.x*re.y-re.x*ie.y;O+=(ie.x+re.x)*Te,N+=(ie.y+re.y)*Te,B+=3*Te}return new Qe(O/B,N/B,0,P)})(n),D=p.length;for(;p.length;){const P=p.pop();(P.d>C.d||!C.d)&&(C=P,i&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,D)),P.max-C.d<=e||(f=P.h/2,p.push(new Qe(P.p.x-f,P.p.y-f,f,n)),p.push(new Qe(P.p.x+f,P.p.y-f,f,n)),p.push(new Qe(P.p.x-f,P.p.y+f,f,n)),p.push(new Qe(P.p.x+f,P.p.y+f,f,n)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${C.d}`)),C.p}function Ie(n,e){return e.max-n.max}function Qe(n,e,i,o){this.p=new de(n,e),this.h=i,this.d=(function(u,f){let p=!1,y=1/0;for(let x=0;x<f.length;x++){const T=f[x];for(let E=0,C=T.length,D=C-1;E<C;D=E++){const P=T[E],B=T[D];P.y>u.y!=B.y>u.y&&u.x<(B.x-P.x)*(u.y-P.y)/(B.y-P.y)+P.x&&(p=!p),y=Math.min(y,Tr(u,P,B))}}return(p?1:-1)*Math.sqrt(y)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Dt;L.aQ=void 0,(Dt=L.aQ||(L.aQ={}))[Dt.center=1]="center",Dt[Dt.left=2]="left",Dt[Dt.right=3]="right",Dt[Dt.top=4]="top",Dt[Dt.bottom=5]="bottom",Dt[Dt["top-left"]=6]="top-left",Dt[Dt["top-right"]=7]="top-right",Dt[Dt["bottom-left"]=8]="bottom-left",Dt[Dt["bottom-right"]=9]="bottom-right";const Ei=Number.POSITIVE_INFINITY;function Ft(n,e){return e[1]!==Ei?(function(i,o,u){let f=0,p=0;switch(o=Math.abs(o),u=Math.abs(u),i){case"top-right":case"top-left":case"top":p=u-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-u}switch(i){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,p]})(n,e[0],e[1]):(function(i,o){let u=0,f=0;o<0&&(o=0);const p=o/Math.SQRT2;switch(i){case"top-right":case"top-left":f=p-7;break;case"bottom-right":case"bottom-left":f=7-p;break;case"bottom":f=7-o;break;case"top":f=o-7}switch(i){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=o;break;case"right":u=-o}return[u,f]})(n,e[0])}function ni(n,e,i){var o;const u=n.layout,f=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},i);if(f){const y=f.values,x=[];for(let T=0;T<y.length;T+=2){const E=x[T]=y[T],C=y[T+1].map((D=>D*Li));E.startsWith("top")?C[1]-=7:E.startsWith("bottom")&&(C[1]+=7),x[T+1]=C}return new gn(x)}const p=u.get("text-variable-anchor");if(p){let y;y=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},i)*Li,Ei]:u.get("text-offset").evaluate(e,{},i).map((T=>T*Li));const x=[];for(const T of p)x.push(T,Ft(T,y));return new gn(x)}return null}function gi(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ki(n,e,i,o,u,f,p,y,x,T,E,C){let D=f.textMaxSize.evaluate(e,{});D===void 0&&(D=p);const P=n.layers[0].layout,B=P.get("icon-offset").evaluate(e,{},E),O=km(i.horizontal),N=p/24,G=n.tilePixelRatio*N,J=n.tilePixelRatio*D/24,q=n.tilePixelRatio*y,$=n.tilePixelRatio*P.get("symbol-spacing"),ie=P.get("text-padding")*n.tilePixelRatio,re=(function(xt,Mt,_t,Rt=1){const bi=xt.get("icon-padding").evaluate(Mt,{},_t),ai=bi&&bi.values;return[ai[0]*Rt,ai[1]*Rt,ai[2]*Rt,ai[3]*Rt]})(P,e,E,n.tilePixelRatio),Te=P.get("text-max-angle")/180*Math.PI,Ge=P.get("text-rotation-alignment")!=="viewport"&&P.get("symbol-placement")!=="point",Oe=P.get("icon-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",Je=P.get("symbol-placement"),dt=$/2,nt=P.get("icon-text-fit");let je;o&&nt!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(je=ed(o,i.vertical,nt,P.get("icon-text-fit-padding"),B,N)),O&&(o=ed(o,O,nt,P.get("icon-text-fit-padding"),B,N)));const Pe=E?C.line.getGranularityForZoomLevel(E.z):1,wt=(xt,Mt)=>{Mt.x<0||Mt.x>=Ve||Mt.y<0||Mt.y>=Ve||(function(_t,Rt,bi,ai,bn,Kr,ur,wn,dn,Oi,Ln,$n,rn,$a,Jr,Xa,Eo,Mr,Cn,cr,Bn,Er,rc,fl,Fp){const hh=_t.addToLineVertexArray(Rt,bi);let _d,Cf,zf,Df,Dg=0,Pg=0,Ig=0,Rg=0,pg=-1,mg=-1;const ac={};let Lg=$i("");if(_t.allowVerticalPlacement&&ai.vertical){const ga=wn.layout.get("text-rotate").evaluate(Bn,{},fl)+90;zf=new qi(dn,Rt,Oi,Ln,$n,ai.vertical,rn,$a,Jr,ga),ur&&(Df=new qi(dn,Rt,Oi,Ln,$n,ur,Eo,Mr,Jr,ga))}if(bn){const ga=wn.layout.get("icon-rotate").evaluate(Bn,{}),$s=wn.layout.get("icon-text-fit")!=="none",yd=st(bn,ga,rc,$s),ml=ur?st(ur,ga,rc,$s):void 0;Cf=new qi(dn,Rt,Oi,Ln,$n,bn,Eo,Mr,!1,ga),Dg=4*yd.length;const vd=_t.iconSizeData;let su=null;vd.kind==="source"?(su=[Gs*wn.layout.get("icon-size").evaluate(Bn,{})],su[0]>fa&&Zi(`${_t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):vd.kind==="composite"&&(su=[Gs*Er.compositeIconSizes[0].evaluate(Bn,{},fl),Gs*Er.compositeIconSizes[1].evaluate(Bn,{},fl)],(su[0]>fa||su[1]>fa)&&Zi(`${_t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),_t.addSymbols(_t.icon,yd,su,cr,Cn,Bn,L.aA.none,Rt,hh.lineStartIndex,hh.lineLength,-1,fl),pg=_t.icon.placedSymbolArray.length-1,ml&&(Pg=4*ml.length,_t.addSymbols(_t.icon,ml,su,cr,Cn,Bn,L.aA.vertical,Rt,hh.lineStartIndex,hh.lineLength,-1,fl),mg=_t.icon.placedSymbolArray.length-1)}const Bg=Object.keys(ai.horizontal);for(const ga of Bg){const $s=ai.horizontal[ga];if(!_d){Lg=$i($s.text);const ml=wn.layout.get("text-rotate").evaluate(Bn,{},fl);_d=new qi(dn,Rt,Oi,Ln,$n,$s,rn,$a,Jr,ml)}const yd=$s.positionedLines.length===1;if(Ig+=dl(_t,Rt,$s,Kr,wn,Jr,Bn,Xa,hh,ai.vertical?L.aA.horizontal:L.aA.horizontalOnly,yd?Bg:[ga],ac,pg,Er,fl),yd)break}ai.vertical&&(Rg+=dl(_t,Rt,ai.vertical,Kr,wn,Jr,Bn,Xa,hh,L.aA.vertical,["vertical"],ac,mg,Er,fl));const c_=_d?_d.boxStartIndex:_t.collisionBoxArray.length,h_=_d?_d.boxEndIndex:_t.collisionBoxArray.length,d_=zf?zf.boxStartIndex:_t.collisionBoxArray.length,f_=zf?zf.boxEndIndex:_t.collisionBoxArray.length,p_=Cf?Cf.boxStartIndex:_t.collisionBoxArray.length,m_=Cf?Cf.boxEndIndex:_t.collisionBoxArray.length,g_=Df?Df.boxStartIndex:_t.collisionBoxArray.length,__=Df?Df.boxEndIndex:_t.collisionBoxArray.length;let pl=-1;const Fm=(ga,$s)=>ga&&ga.circleDiameter?Math.max(ga.circleDiameter,$s):$s;pl=Fm(_d,pl),pl=Fm(zf,pl),pl=Fm(Cf,pl),pl=Fm(Df,pl);const kg=pl>-1?1:0;kg&&(pl*=Fp/Li),_t.glyphOffsetArray.length>=Kl.MAX_GLYPHS&&Zi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Bn.sortKey!==void 0&&_t.addToSortKeyRanges(_t.symbolInstances.length,Bn.sortKey);const y_=ni(wn,Bn,fl),[v_,x_]=(function(ga,$s){const yd=ga.length,ml=$s?.values;if(ml?.length>0)for(let vd=0;vd<ml.length;vd+=2){const su=ml[vd+1];ga.emplaceBack(L.aQ[ml[vd]],su[0],su[1])}return[yd,ga.length]})(_t.textAnchorOffsets,y_);_t.symbolInstances.emplaceBack(Rt.x,Rt.y,ac.right>=0?ac.right:-1,ac.center>=0?ac.center:-1,ac.left>=0?ac.left:-1,ac.vertical||-1,pg,mg,Lg,c_,h_,d_,f_,p_,m_,g_,__,Oi,Ig,Rg,Dg,Pg,kg,0,rn,pl,v_,x_)})(n,Mt,xt,i,o,u,je,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,G,[ie,ie,ie,ie],Ge,x,q,re,Oe,B,e,f,T,E,p)};if(Je==="line")for(const xt of Bp(e.geometry,0,0,Ve,Ve)){const Mt=Ua(xt,Pe),_t=Le(Mt,$,Te,i.vertical||O,o,24,J,n.overscaling,Ve);for(const Rt of _t)O&&l_(n,O.text,dt,Rt)||wt(Mt,Rt)}else if(Je==="line-center"){for(const xt of e.geometry)if(xt.length>1){const Mt=Ua(xt,Pe),_t=he(Mt,Te,i.vertical||O,o,24,J);_t&&wt(Mt,_t)}}else if(e.type==="Polygon")for(const xt of bu(e.geometry,0)){const Mt=ge(xt,16);wt(Ua(xt[0],Pe,!0),new g(Mt.x,Mt.y,0))}else if(e.type==="LineString")for(const xt of e.geometry){const Mt=Ua(xt,Pe);wt(Mt,new g(Mt[0].x,Mt[0].y,0))}else if(e.type==="Point")for(const xt of e.geometry)for(const Mt of xt)wt([Mt],new g(Mt.x,Mt.y,0))}function dl(n,e,i,o,u,f,p,y,x,T,E,C,D,P,B){const O=(function(J,q,$,ie,re,Te,Ge,Oe){const Je=ie.layout.get("text-rotate").evaluate(Te,{})*Math.PI/180,dt=[];for(const nt of q.positionedLines)for(const je of nt.positionedGlyphs){if(!je.rect)continue;const Pe=je.rect||{};let wt=4,xt=!0,Mt=1,_t=0;const Rt=(re||Oe)&&je.vertical,bi=je.metrics.advance*je.scale/2;if(Oe&&q.verticalizable&&(_t=nt.lineOffset/2-(je.imageName?-(Li-je.metrics.width*je.scale)/2:(je.scale-1)*Li)),je.imageName){const Mr=Ge[je.imageName];xt=Mr.sdf,Mt=Mr.pixelRatio,wt=1/Mt}const ai=re?[je.x+bi,je.y]:[0,0];let bn=re?[0,0]:[je.x+bi+$[0],je.y+$[1]-_t],Kr=[0,0];Rt&&(Kr=bn,bn=[0,0]);const ur=je.metrics.isDoubleResolution?2:1,wn=(je.metrics.left-wt)*je.scale-bi+bn[0],dn=(-je.metrics.top-wt)*je.scale+bn[1],Oi=wn+Pe.w/ur*je.scale/Mt,Ln=dn+Pe.h/ur*je.scale/Mt,$n=new de(wn,dn),rn=new de(Oi,dn),$a=new de(wn,Ln),Jr=new de(Oi,Ln);if(Rt){const Mr=new de(-bi,bi- -17),Cn=-Math.PI/2,cr=12-bi,Bn=new de(22-cr,-(je.imageName?cr:0)),Er=new de(...Kr);$n._rotateAround(Cn,Mr)._add(Bn)._add(Er),rn._rotateAround(Cn,Mr)._add(Bn)._add(Er),$a._rotateAround(Cn,Mr)._add(Bn)._add(Er),Jr._rotateAround(Cn,Mr)._add(Bn)._add(Er)}if(Je){const Mr=Math.sin(Je),Cn=Math.cos(Je),cr=[Cn,-Mr,Mr,Cn];$n._matMult(cr),rn._matMult(cr),$a._matMult(cr),Jr._matMult(cr)}const Xa=new de(0,0),Eo=new de(0,0);dt.push({tl:$n,tr:rn,bl:$a,br:Jr,tex:Pe,writingMode:q.writingMode,glyphOffset:ai,sectionIndex:je.sectionIndex,isSDF:xt,pixelOffsetTL:Xa,pixelOffsetBR:Eo,minFontScaleX:0,minFontScaleY:0})}return dt})(0,i,y,u,f,p,o,n.allowVerticalPlacement),N=n.textSizeData;let G=null;N.kind==="source"?(G=[Gs*u.layout.get("text-size").evaluate(p,{})],G[0]>fa&&Zi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):N.kind==="composite"&&(G=[Gs*P.compositeTextSizes[0].evaluate(p,{},B),Gs*P.compositeTextSizes[1].evaluate(p,{},B)],(G[0]>fa||G[1]>fa)&&Zi(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,O,G,y,f,p,T,e,x.lineStartIndex,x.lineLength,D,B);for(const J of E)C[J]=n.text.placedSymbolArray.length-1;return 4*O.length}function km(n){for(const e in n)return n[e];return null}function l_(n,e,i,o){const u=n.compareText;if(e in u){const f=u[e];for(let p=f.length-1;p>=0;p--)if(o.dist(f[p])<i)return!0}else u[e]=[];return u[e].push(o),!1}const Ag=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class og{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=Ag[15&o];if(!f)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new og(y,p,f,e)}constructor(e,i=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=Ag.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return lg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:p,nodeSize:y}=this,x=[0,f.length-1,0],T=[];for(;x.length;){const E=x.pop()||0,C=x.pop()||0,D=x.pop()||0;if(C-D<=y){for(let N=D;N<=C;N++){const G=p[2*N],J=p[2*N+1];G>=e&&G<=o&&J>=i&&J<=u&&T.push(f[N])}continue}const P=D+C>>1,B=p[2*P],O=p[2*P+1];B>=e&&B<=o&&O>=i&&O<=u&&T.push(f[P]),(E===0?e<=B:i<=O)&&(x.push(D),x.push(P-1),x.push(1-E)),(E===0?o>=B:u>=O)&&(x.push(P+1),x.push(C),x.push(1-E))}return T}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:p}=this,y=[0,u.length-1,0],x=[],T=o*o;for(;y.length;){const E=y.pop()||0,C=y.pop()||0,D=y.pop()||0;if(C-D<=p){for(let N=D;N<=C;N++)zg(f[2*N],f[2*N+1],e,i)<=T&&x.push(u[N]);continue}const P=D+C>>1,B=f[2*P],O=f[2*P+1];zg(B,O,e,i)<=T&&x.push(u[P]),(E===0?e-o<=B:i-o<=O)&&(y.push(D),y.push(P-1),y.push(1-E)),(E===0?e+o>=B:i+o>=O)&&(y.push(P+1),y.push(C),y.push(1-E))}return x}}function lg(n,e,i,o,u,f){if(u-o<=i)return;const p=o+u>>1;Cg(n,e,p,o,u,f),lg(n,e,i,o,p-1,1-f),lg(n,e,i,p+1,u,1-f)}function Cg(n,e,i,o,u,f){for(;u>o;){if(u-o>600){const T=u-o+1,E=i-o+1,C=Math.log(T),D=.5*Math.exp(2*C/3),P=.5*Math.sqrt(C*D*(T-D)/T)*(E-T/2<0?-1:1);Cg(n,e,i,Math.max(o,Math.floor(i-E*D/T+P)),Math.min(u,Math.floor(i+(T-E)*D/T+P)),f)}const p=e[2*i+f];let y=o,x=u;for(kp(n,e,o,i),e[2*u+f]>p&&kp(n,e,o,u);y<x;){for(kp(n,e,y,x),y++,x--;e[2*y+f]<p;)y++;for(;e[2*x+f]>p;)x--}e[2*o+f]===p?kp(n,e,o,x):(x++,kp(n,e,x,u)),x<=i&&(o=x+1),i<=x&&(u=x-1)}}function kp(n,e,i,o){ug(n,i,o),ug(e,2*i,2*o),ug(e,2*i+1,2*o+1)}function ug(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function zg(n,e,i,o){const u=n-i,f=e-o;return u*u+f*f}var cg;L.cI=void 0,(cg=L.cI||(L.cI={})).create="create",cg.load="load",cg.fullLoad="fullLoad";let Om=null,Op=[];const hg=1e3/60,dg="loadTime",fg="fullLoadTime",u_={mark(n){performance.mark(n)},frame(n){const e=n;Om!=null&&Op.push(e-Om),Om=e},clearMetrics(){Om=null,Op=[],performance.clearMeasures(dg),performance.clearMeasures(fg);for(const n in L.cI)performance.clearMarks(L.cI[n])},getPerformanceMetrics(){performance.measure(dg,L.cI.create,L.cI.load),performance.measure(fg,L.cI.create,L.cI.fullLoad);const n=performance.getEntriesByName(dg)[0].duration,e=performance.getEntriesByName(fg)[0].duration,i=Op.length,o=1/(Op.reduce(((f,p)=>f+p),0)/i/1e3),u=Op.filter((f=>f>hg)).reduce(((f,p)=>f+(p-hg)/hg),0);return{loadTime:n,fullLoadTime:e,fps:o,percentDroppedFrames:u/(i+u)*100,totalFrames:i}}};L.$=pe,L.A=ut,L.B=Bu,L.C=kl,L.D=zt,L.E=fi,L.F=function([n,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(i),y:n*Math.sin(e)*Math.sin(i),z:n*Math.cos(i)}},L.G=Ki,L.H=ui,L.I=Wc,L.J=Lu,L.K=function(n){if(pn==null){const e=n.navigator?n.navigator.userAgent:null;pn=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return pn},L.L=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new pm((()=>this.process())),this.subscription=gl(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=_r(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}unregisterMessageHandler(n){delete this.messageHandlers[n]}sendAsync(n,e){return new Promise(((i,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),f=e?gl(e.signal,"abort",(()=>{f?.unsubscribe(),delete this.resolveRejects[u];const x={id:u,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)}),_i):null;this.resolveRejects[u]={resolve:x=>{f?.unsubscribe(),i(x)},reject:x=>{f?.unsubscribe(),o(x)}};const p=[],y=Object.assign(Object.assign({},n),{id:u,sourceMapId:this.mapId,origin:location.origin,data:go(n.data,p)});this.target.postMessage(y,{transfer:p})}))}receive(n){const e=n.data,i=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(_r(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return d(this,void 0,void 0,(function*(){if(e.type==="<response>"){const u=this.resolveRejects[n];return delete this.resolveRejects[n],u?void(e.error?u.reject(Fl(e.error)):u.resolve(Fl(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=Fl(e.data),o=new AbortController;this.abortControllers[n]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,i,o);this.completeTask(n,null,u)}catch(u){this.completeTask(n,u)}}))}completeTask(n,e,i){const o=[];delete this.abortControllers[n];const u={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?go(e):null,data:go(i,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},L.M=ye,L.N=function(){var n=new ut(16);return ut!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},L.O=function(n,e,i){var o,u,f,p,y,x,T,E,C,D,P,B,O=i[0],N=i[1],G=i[2];return e===n?(n[12]=e[0]*O+e[4]*N+e[8]*G+e[12],n[13]=e[1]*O+e[5]*N+e[9]*G+e[13],n[14]=e[2]*O+e[6]*N+e[10]*G+e[14],n[15]=e[3]*O+e[7]*N+e[11]*G+e[15]):(u=e[1],f=e[2],p=e[3],y=e[4],x=e[5],T=e[6],E=e[7],C=e[8],D=e[9],P=e[10],B=e[11],n[0]=o=e[0],n[1]=u,n[2]=f,n[3]=p,n[4]=y,n[5]=x,n[6]=T,n[7]=E,n[8]=C,n[9]=D,n[10]=P,n[11]=B,n[12]=o*O+y*N+C*G+e[12],n[13]=u*O+x*N+D*G+e[13],n[14]=f*O+T*N+P*G+e[14],n[15]=p*O+E*N+B*G+e[15]),n},L.P=de,L.Q=function(n,e,i){var o=i[0],u=i[1],f=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},L.R=Rn,L.S=function(n,e,i){var o=e[0],u=e[1],f=e[2],p=e[3],y=e[4],x=e[5],T=e[6],E=e[7],C=e[8],D=e[9],P=e[10],B=e[11],O=e[12],N=e[13],G=e[14],J=e[15],q=i[0],$=i[1],ie=i[2],re=i[3];return n[0]=q*o+$*y+ie*C+re*O,n[1]=q*u+$*x+ie*D+re*N,n[2]=q*f+$*T+ie*P+re*G,n[3]=q*p+$*E+ie*B+re*J,n[4]=(q=i[4])*o+($=i[5])*y+(ie=i[6])*C+(re=i[7])*O,n[5]=q*u+$*x+ie*D+re*N,n[6]=q*f+$*T+ie*P+re*G,n[7]=q*p+$*E+ie*B+re*J,n[8]=(q=i[8])*o+($=i[9])*y+(ie=i[10])*C+(re=i[11])*O,n[9]=q*u+$*x+ie*D+re*N,n[10]=q*f+$*T+ie*P+re*G,n[11]=q*p+$*E+ie*B+re*J,n[12]=(q=i[12])*o+($=i[13])*y+(ie=i[14])*C+(re=i[15])*O,n[13]=q*u+$*x+ie*D+re*N,n[14]=q*f+$*T+ie*P+re*G,n[15]=q*p+$*E+ie*B+re*J,n},L.T=tn,L.U=function(n,e){const i={};for(let o=0;o<e.length;o++){const u=e[o];u in n&&(i[u]=n[u])}return i},L.V=Zs,L.W=Nt,L.X=Jc,L.Y=of,L.Z=oe,L._=d,L.a=H,L.a$=gm,L.a0=mt,L.a1=Xs,L.a2=pa,L.a3=mm,L.a4=ad,L.a5=Ve,L.a6=function(n,e,i){if(!n)return e||{};if(!e)return n||{};const o=ym(n),u=ym(e);(function(p,y){y.removeAll&&(p.add.clear(),p.update.clear(),p.remove.clear(),y.remove.clear());for(const x of y.remove)p.add.delete(x),p.update.delete(x);for(const[x,T]of y.update){const E=p.update.get(x);E&&(y.update.set(x,_m(E,T)),p.update.delete(x))}})(o,u);const f={};if((o.removeAll||u.removeAll)&&(f.removeAll=!0),f.remove=new Set([...o.remove,...u.remove]),f.add=new Map([...o.add,...u.add]),f.update=new Map([...o.update,...u.update]),f.remove.size&&f.add.size)for(const p of f.add.keys())f.remove.delete(p);return(function(p){const y={};return p.removeAll&&(y.removeAll=p.removeAll),p.remove&&(y.remove=Array.from(p.remove)),p.add&&(y.add=Array.from(p.add.values())),p.update&&(y.update=Array.from(p.update.values())),y})(f)},L.a7=function(n,e){if(n==null||n.type==null)return!0;if(n.type==="Feature")return od(n,e)!=null;if(n.type==="FeatureCollection"){const i=new Set;for(const o of n.features){const u=od(o,e);if(u==null||i.has(u))return!1;i.add(u)}return!0}return!1},L.a8=function(n,e){const i=new Map;if(!(n==null||n.type==null))if(n.type==="Feature")i.set(od(n,e),n);else for(const o of n.features)i.set(od(o,e),o);return i},L.a9=function(n,e,i){var o,u;if(e.removeAll)n.clear();else if(e.remove)for(const f of e.remove)n.delete(f);if(e.add)for(const f of e.add){const p=od(f,i);p!=null&&n.set(p,f)}if(e.update)for(const f of e.update){let p=n.get(f.id);if(!p)continue;const y=!!f.newGeometry,x=f.removeAllProperties||((o=f.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=f.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if((y||x)&&(p=Object.assign({},p),n.set(f.id,p),y&&(p.geometry=f.newGeometry),x)){if(p.properties=f.removeAllProperties?{}:Object.assign({},p.properties||{}),f.removeProperties)for(const T of f.removeProperties)delete p.properties[T];if(f.addOrUpdateProperties)for(const{key:T,value:E}of f.addOrUpdateProperties)p.properties[T]=E}}},L.aB=function(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:u}){return n.kind==="source"?o/Gs:n.kind==="composite"?Ki.number(o/Gs,u/Gs,i):e},L.aC=function(n,e){var i=e[0],o=e[1],u=e[2],f=e[3],p=e[4],y=e[5],x=e[6],T=e[7],E=e[8],C=e[9],D=e[10],P=e[11],B=e[12],O=e[13],N=e[14],G=e[15],J=i*y-o*p,q=i*x-u*p,$=i*T-f*p,ie=o*x-u*y,re=o*T-f*y,Te=u*T-f*x,Ge=E*O-C*B,Oe=E*N-D*B,Je=E*G-P*B,dt=C*N-D*O,nt=C*G-P*O,je=D*G-P*N,Pe=J*je-q*nt+$*dt+ie*Je-re*Oe+Te*Ge;return Pe?(n[0]=(y*je-x*nt+T*dt)*(Pe=1/Pe),n[1]=(u*nt-o*je-f*dt)*Pe,n[2]=(O*Te-N*re+G*ie)*Pe,n[3]=(D*re-C*Te-P*ie)*Pe,n[4]=(x*Je-p*je-T*Oe)*Pe,n[5]=(i*je-u*Je+f*Oe)*Pe,n[6]=(N*$-B*Te-G*q)*Pe,n[7]=(E*Te-D*$+P*q)*Pe,n[8]=(p*nt-y*Je+T*Ge)*Pe,n[9]=(o*Je-i*nt-f*Ge)*Pe,n[10]=(B*re-O*$+G*J)*Pe,n[11]=(C*$-E*re-P*J)*Pe,n[12]=(y*Oe-p*dt-x*Ge)*Pe,n[13]=(i*dt-o*Oe+u*Ge)*Pe,n[14]=(O*q-B*ie-N*J)*Pe,n[15]=(E*ie-C*q+D*J)*Pe,n):null},L.aD=We,L.aE=function(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)},L.aF=function(n){return n[0]=0,n[1]=0,n},L.aG=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n},L.aH=nf,L.aI=an,L.aJ=function(n,e,i,o){const u=e.y-n.y,f=e.x-n.x,p=o.y-i.y,y=o.x-i.x,x=p*f-y*u;if(x===0)return null;const T=(y*(n.y-i.y)-p*(n.x-i.x))/x;return new de(n.x+T*f,n.y+T*u)},L.aK=Bp,L.aL=Oc,L.aM=function(n){let e=1/0,i=1/0,o=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),i=Math.min(i,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return[e,i,o,u]},L.aN=Li,L.aO=St,L.aP=function(n,e,i,o,u=!1){if(!i[0]&&!i[1])return[0,0];const f=u?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(f){const p=Math.sin(f),y=Math.cos(f);i=[i[0]*y-i[1]*p,i[0]*p+i[1]*y]}return[u?i[0]:St(e,i[0],n.zoom),u?i[1]:St(e,i[1],n.zoom)]},L.aR=Ju,L.aS=gi,L.aT=Jh,L.aU=og,L.aV=Lt,L.aW=Ea,L.aX=I,L.aY=Ke,L.aZ=Ae,L.a_=Vr,L.aa=lh,L.ab=sd,L.ac=Hs,L.ad=25,L.ae=lf,L.af=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const o of n){const u=window.document.createElement("source");$e(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}}))},L.ag=ot,L.ah=function(){return Ai++},L.ai=t,L.aj=Kl,L.ak=Gr,L.al=bo,L.am=cf,L.an=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,u,f)=>{const p=u||f;return e[o]=!p||p.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e},L.ao=kt,L.ap=85.051129,L.aq=er,L.ar=function(n){return Math.pow(2,n)},L.as=Bt,L.at=rd,L.au=function(n){return Math.log(n)/Math.LN2},L.av=function(n){var e=n[0],i=n[1];return e*e+i*i},L.aw=function(n){if(!n.length)return new Set;const e=Math.max(...n.map((x=>x.canonical.z)));let i=1/0,o=-1/0,u=1/0,f=-1/0;const p=[];for(const x of n){const{x:T,y:E,z:C}=x.canonical,D=Math.pow(2,e-C),P=T*D,B=E*D;p.push({id:x,x:P,y:B}),P<i&&(i=P),P>o&&(o=P),B<u&&(u=B),B>f&&(f=B)}const y=new Set;for(const x of p)x.x!==i&&x.x!==o&&x.y!==u&&x.y!==f||y.add(x.id);return y},L.ax=function(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||o-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x},L.ay=class{constructor(n,e){this.max=n,this.onRemove=e,this.reset()}reset(){for(const n in this.data)for(const e of this.data[n])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(n,e,i){const o=n.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const u={value:e,timeout:void 0};if(i!==void 0&&(u.timeout=setTimeout((()=>{this.remove(n,u)}),i)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const e=this.data[n].shift();return e.timeout&&clearTimeout(e.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),e.value}getByKey(n){const e=this.data[n];return e?e[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,e){if(!this.has(n))return this;const i=n.wrapped().key,o=e===void 0?0:this.data[i].indexOf(e),u=this.data[i][o];return this.data[i].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(u.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(n){const e=[];for(const i in this.data)for(const o of this.data[i])n(o.value)||e.push(o);for(const i of e)this.remove(i.value.tileID,i)}},L.az=function(n,e){let i=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:p}=n,y=u?kt(Pr.interpolationFactor(u,e,f,p),0,1):0;n.kind==="camera"?o=Ki.number(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:o}},L.b=xs,L.b$=class extends pr{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},L.b0=hi,L.b1=ti,L.b2=function(n){var e=new ut(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},L.b3=function(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n},L.b4=function(n,e){var i=e[0],o=e[1],u=e[2],f=i*i+o*o+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n},L.b5=si,L.b6=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},L.b7=function(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n[3]=e[3]*i[3],n},L.b8=gt,L.b9=function(n,e,i){const o=e[0]*i[0]+e[1]*i[1]+e[2]*i[2];return o===0?null:(-(n[0]*i[0]+n[1]*i[1]+n[2]*i[2])-i[3])/o},L.bA=function(){return new Float64Array(3)},L.bB=function(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n},L.bC=qe,L.bD=function(n,e,i){var o=i[0],u=i[1],f=i[2],p=i[3],y=e[0],x=e[1],T=e[2],E=u*T-f*x,C=f*y-o*T,D=o*x-u*y;return n[0]=y+p*(E+=E)+u*(D+=D)-f*(C+=C),n[1]=x+p*C+f*E-o*D,n[2]=T+p*D+o*C-u*E,n},L.bE=function(n,e,i){const o=(function(x){var T=x[3],E=x[4],C=x[5],D=x[6],P=x[7],B=x[8];return x[0]*(B*E-C*P)+x[1]*(-B*T+C*D)+x[2]*(P*T-E*D)})([n[0],n[1],n[2],e[0],e[1],e[2],i[0],i[1],i[2]]);if(o===0)return null;const u=si([],[e[0],e[1],e[2]],[i[0],i[1],i[2]]),f=si([],[i[0],i[1],i[2]],[n[0],n[1],n[2]]),p=si([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),y=hi([],u,-n[3]);return ti(y,y,hi([],f,-e[3])),ti(y,y,hi([],p,-i[3])),hi(y,y,1/o),y},L.bF=nd,L.bG=function(){return new Float64Array(4)},L.bH=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),f[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),f[2]=u[2],n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},L.bI=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[0],f[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),f[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},L.bJ=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),f[1]=u[1],f[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},L.bK=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[0],p=e[1],y=e[2],x=e[3],T=e[8],E=e[9],C=e[10],D=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-T*o,n[1]=p*u-E*o,n[2]=y*u-C*o,n[3]=x*u-D*o,n[8]=f*o+T*u,n[9]=p*o+E*u,n[10]=y*o+C*u,n[11]=x*o+D*u,n},L.bL=function(n,e){const i=le(n,360),o=le(e,360),u=o-i,f=o>i?u-360:u+360;return Math.abs(u)<Math.abs(f)?u:f},L.bM=function(n){return n[0]=0,n[1]=0,n[2]=0,n},L.bN=function(n,e,i,o){const u=Math.sqrt(n*n+e*e),f=Math.sqrt(i*i+o*o);n/=u,e/=u,i/=f,o/=f;const p=Math.acos(n*i+e*o);return-e*i+n*o>0?p:-p},L.bO=function(n,e){const i=le(n,2*Math.PI),o=le(e,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},L.bP=function(){const n={},e=be.$version;for(const i in be.$root){const o=be.$root[i];if(o.required){let u=null;u=i==="version"?e:o.type==="array"?[]:{},u!=null&&(n[i]=u)}}return n},L.bQ=Me,L.bR=ua,L.bS=function n(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],i[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object"||Object.keys(e).length!==Object.keys(i).length)return!1;for(const o in e)if(!n(e[o],i[o]))return!1;return!0}return e===i},L.bT=function(n){n=n.slice();const e=Object.create(null);for(let i=0;i<n.length;i++)e[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=zn(n[i],e[n[i].ref]));return n},L.bU=function(n,e){if(n.type==="custom")return new tg(n,e);switch(n.type){case"background":return new id(n,e);case"circle":return new Uf(n,e);case"color-relief":return new Yp(n,e);case"fill":return new Zh(n,e);case"fill-extrusion":return new qn(n,e);case"heatmap":return new Zp(n,e);case"hillshade":return new Hp(n,e);case"line":return new Wl(n,e);case"raster":return new Hr(n,e);case"symbol":return new Kc(n,e)}},L.bV=n=>n.type==="raster",L.bW=hr,L.bX=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let i=[];try{if(!Ht(n.version,e.version))return[{command:"setStyle",args:[e]}];Ht(n.center,e.center)||i.push({command:"setCenter",args:[e.center]}),Ht(n.state,e.state)||i.push({command:"setGlobalState",args:[e.state]}),Ht(n.centerAltitude,e.centerAltitude)||i.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Ht(n.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),Ht(n.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),Ht(n.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),Ht(n.roll,e.roll)||i.push({command:"setRoll",args:[e.roll]}),Ht(n.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),Ht(n.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),Ht(n.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),Ht(n.light,e.light)||i.push({command:"setLight",args:[e.light]}),Ht(n.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),Ht(n.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),Ht(n.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const o={},u=[];(function(p,y,x,T){let E;for(E in y=y||{},p=p||{})Object.prototype.hasOwnProperty.call(p,E)&&(Object.prototype.hasOwnProperty.call(y,E)||Di(E,x,T));for(E in y)Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(p,E)?Ht(p[E],y[E])||(p[E].type==="geojson"&&y[E].type==="geojson"&&Fi(p,y,E)?zi(x,{command:"setGeoJSONSourceData",args:[E,y[E].data]}):Tn(E,y,x,T)):Xn(E,y,x))})(n.sources,e.sources,u,o);const f=[];n.layers&&n.layers.forEach((p=>{"source"in p&&o[p.source]?i.push({command:"removeLayer",args:[p.id]}):f.push(p)})),i=i.concat(u),(function(p,y,x){y=y||[];const T=(p=p||[]).map(_l),E=y.map(_l),C=p.reduce(Ao,{}),D=y.reduce(Ao,{}),P=T.slice(),B=Object.create(null);let O,N,G,J,q;for(let $=0,ie=0;$<T.length;$++)O=T[$],Object.prototype.hasOwnProperty.call(D,O)?ie++:(zi(x,{command:"removeLayer",args:[O]}),P.splice(P.indexOf(O,ie),1));for(let $=0,ie=0;$<E.length;$++)O=E[E.length-1-$],P[P.length-1-$]!==O&&(Object.prototype.hasOwnProperty.call(C,O)?(zi(x,{command:"removeLayer",args:[O]}),P.splice(P.lastIndexOf(O,P.length-ie),1)):ie++,J=P[P.length-$],zi(x,{command:"addLayer",args:[D[O],J]}),P.splice(P.length-$,0,O),B[O]=!0);for(let $=0;$<E.length;$++)if(O=E[$],N=C[O],G=D[O],!B[O]&&!Ht(N,G))if(Ht(N.source,G.source)&&Ht(N["source-layer"],G["source-layer"])&&Ht(N.type,G.type)){for(q in Dn(N.layout,G.layout,x,O,null,"setLayoutProperty"),Dn(N.paint,G.paint,x,O,null,"setPaintProperty"),Ht(N.filter,G.filter)||zi(x,{command:"setFilter",args:[O,G.filter]}),Ht(N.minzoom,G.minzoom)&&Ht(N.maxzoom,G.maxzoom)||zi(x,{command:"setLayerZoomRange",args:[O,G.minzoom,G.maxzoom]}),N)Object.prototype.hasOwnProperty.call(N,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?Dn(N[q],G[q],x,O,q.slice(6),"setPaintProperty"):Ht(N[q],G[q])||zi(x,{command:"setLayerProperty",args:[O,q,G[q]]}));for(q in G)Object.prototype.hasOwnProperty.call(G,q)&&!Object.prototype.hasOwnProperty.call(N,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?Dn(N[q],G[q],x,O,q.slice(6),"setPaintProperty"):Ht(N[q],G[q])||zi(x,{command:"setLayerProperty",args:[O,q,G[q]]}))}else zi(x,{command:"removeLayer",args:[O]}),J=P[P.lastIndexOf(O)+1],zi(x,{command:"addLayer",args:[G,J]})})(f,e.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[e]}]}return i},L.bY=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},L.bZ=Jn,L.b_=gr,L.ba=di,L.bb=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n},L.bc=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},L.bd=Xi,L.be=Hn,L.bf=function(n,e,i,o,u){var f=1/Math.tan(e/2);if(n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,u!=null&&u!==1/0){var p=1/(o-u);n[10]=(u+o)*p,n[14]=2*u*o*p}else n[10]=-1,n[14]=-2*o;return n},L.bg=function(n){var e=new ut(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},L.bh=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[0],p=e[1],y=e[2],x=e[3],T=e[4],E=e[5],C=e[6],D=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+T*o,n[1]=p*u+E*o,n[2]=y*u+C*o,n[3]=x*u+D*o,n[4]=T*u-f*o,n[5]=E*u-p*o,n[6]=C*u-y*o,n[7]=D*u-x*o,n},L.bi=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[4],p=e[5],y=e[6],x=e[7],T=e[8],E=e[9],C=e[10],D=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+T*o,n[5]=p*u+E*o,n[6]=y*u+C*o,n[7]=x*u+D*o,n[8]=T*u-f*o,n[9]=E*u-p*o,n[10]=C*u-y*o,n[11]=D*u-x*o,n},L.bj=function(){const n=new Float32Array(16);return Bt(n),n},L.bk=function(){const n=new Float64Array(16);return Bt(n),n},L.bl=function(){return new Float64Array(16)},L.bm=function(n,e,i){const o=new Float64Array(4);return qe(o,n,e-90,i),o},L.bn=function(n,e,i,o){var u,f,p,y,x,T=e[0],E=e[1],C=e[2],D=e[3],P=i[0],B=i[1],O=i[2],N=i[3];return(f=T*P+E*B+C*O+D*N)<0&&(f=-f,P=-P,B=-B,O=-O,N=-N),1-f>Et?(u=Math.acos(f),p=Math.sin(u),y=Math.sin((1-o)*u)/p,x=Math.sin(o*u)/p):(y=1-o,x=o),n[0]=y*T+x*P,n[1]=y*E+x*B,n[2]=y*C+x*O,n[3]=y*D+x*N,n},L.bo=function(n){const e=new Float64Array(9);(function(f,p){var y=p[0],x=p[1],T=p[2],E=p[3],C=y+y,D=x+x,P=T+T,B=y*C,O=x*C,N=x*D,G=T*C,J=T*D,q=T*P,$=E*C,ie=E*D,re=E*P;f[0]=1-N-q,f[3]=O-re,f[6]=G+ie,f[1]=O+re,f[4]=1-B-q,f[7]=J-$,f[2]=G-ie,f[5]=J+$,f[8]=1-B-N})(e,n);const i=Vr(-Math.asin(kt(e[2],-1,1)));let o,u;return Math.hypot(e[5],e[8])<.001?(o=0,u=-Vr(Math.atan2(e[3],e[4]))):(o=Vr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),u=Vr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:i+90,bearing:u}},L.bp=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},L.bq=Wt,L.br=Va,L.bs=Xu,L.bt=Sr,L.bu=mr,L.bv=ze,L.bw=it,L.bx=Wn,L.by=function(n,e,i,o,u){return ze(o,u,kt((n-e)/(i-e),0,1))},L.bz=le,L.c=ce,L.c$=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},L.c0=Qo,L.c1=class extends pr{constructor(n,e){super(n,e),this.current=Lc}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},L.c2=js,L.c3=class extends pr{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},L.c4=class extends pr{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},L.c5=vt,L.c6=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},L.c7=function(n,e,i){var o=e[0],u=e[1],f=e[2];return n[0]=o*i[0]+u*i[3]+f*i[6],n[1]=o*i[1]+u*i[4]+f*i[7],n[2]=o*i[2]+u*i[5]+f*i[8],n},L.c8=function(n,e,i,o,u,f,p){var y=1/(e-i),x=1/(o-u),T=1/(f-p);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+i)*y,n[13]=(u+o)*x,n[14]=(p+f)*T,n[15]=1,n},L.c9=class extends pr{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(4*n.length);for(let i=0;i<n.length;i++)e[4*i]=n[i].r,e[4*i+1]=n[i].g,e[4*i+2]=n[i].b,e[4*i+3]=n[i].a;this.gl.uniform4fv(this.location,e)}}},L.cA=function(n,e){return V[e]&&(n instanceof MouseEvent||n instanceof WheelEvent)},L.cB=function(n,e){return xe[e]&&"touches"in n},L.cC=function(n){return xe[n]||V[n]},L.cD=function(n,e,i){var o=e[0],u=e[1];return n[0]=i[0]*o+i[4]*u+i[12],n[1]=i[1]*o+i[5]*u+i[13],n},L.cE=function(n,e){const{x:i,y:o}=sd.fromLngLat(e);return!(n<0||n>25||o<0||o>=1||i<0||i>=1)},L.cF=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},L.cG=class extends Yo{},L.cH=u_,L.cJ=fe,L.cK=function(n,e){ce.REGISTERED_PROTOCOLS[n]=e},L.cL=function(n){delete ce.REGISTERED_PROTOCOLS[n]},L.cM=function(n,e){const i={};for(let u=0;u<n.length;u++){const f=e&&e[n[u].id]||As(n[u]);e&&(e[n[u].id]=f);let p=i[f];p||(p=i[f]=[]),p.push(n[u])}const o=[];for(const u in i)o.push(i[u]);return o},L.cN=ft,L.cO=uf,L.cP=Lp,L.cQ=hp,L.cR=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Ve/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],i=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new ui(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new ui(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new ui(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new ui(T),n.canonical),o["text-size"].possiblyEvaluate(new ui(E),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new ui(T),n.canonical),o["icon-size"].possiblyEvaluate(new ui(E),n.canonical)]}const f=i.get("text-line-height")*Li,p=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",y=i.get("text-keep-upright"),x=i.get("text-size");for(const T of n.bucket.features){const E=i.get("text-font").evaluate(T,{},n.canonical).join(","),C=x.evaluate(T,{},n.canonical),D=u.layoutTextSize.evaluate(T,{},n.canonical),P=u.layoutIconSize.evaluate(T,{},n.canonical),B={horizontal:{},vertical:void 0},O=T.text;let N,G=[0,0];if(O){const $=O.toString(),ie=i.get("text-letter-spacing").evaluate(T,{},n.canonical)*Li,re=Fu($)?ie:0,Te=i.get("text-anchor").evaluate(T,{},n.canonical),Ge=ni(e,T,n.canonical);if(!Ge){const nt=i.get("text-radial-offset").evaluate(T,{},n.canonical);G=nt?Ft(Te,[nt*Li,Ei]):i.get("text-offset").evaluate(T,{},n.canonical).map((je=>je*Li))}let Oe=p?"center":i.get("text-justify").evaluate(T,{},n.canonical);const Je=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(T,{},n.canonical)*Li:1/0,dt=()=>{n.bucket.allowVerticalPlacement&&Ma($)&&(B.vertical=Bi(O,n.glyphMap,n.glyphPositions,n.imagePositions,E,Je,f,Te,"left",re,G,L.aA.vertical,!0,D,C))};if(!p&&Ge){const nt=new Set;if(Oe==="auto")for(let Pe=0;Pe<Ge.values.length;Pe+=2)nt.add(gi(Ge.values[Pe]));else nt.add(Oe);let je=!1;for(const Pe of nt)if(!B.horizontal[Pe])if(je)B.horizontal[Pe]=B.horizontal[0];else{const wt=Bi(O,n.glyphMap,n.glyphPositions,n.imagePositions,E,Je,f,"center",Pe,re,G,L.aA.horizontal,!1,D,C);wt&&(B.horizontal[Pe]=wt,je=wt.positionedLines.length===1)}dt()}else{Oe==="auto"&&(Oe=gi(Te));const nt=Bi(O,n.glyphMap,n.glyphPositions,n.imagePositions,E,Je,f,Te,Oe,re,G,L.aA.horizontal,!1,D,C);nt&&(B.horizontal[Oe]=nt),dt(),Ma($)&&p&&y&&(B.vertical=Bi(O,n.glyphMap,n.glyphPositions,n.imagePositions,E,Je,f,Te,Oe,re,G,L.aA.vertical,!1,D,C))}}let J=!1;if(T.icon&&T.icon.name){const $=n.imageMap[T.icon.name];$&&(N=Qc(n.imagePositions[T.icon.name],i.get("icon-offset").evaluate(T,{},n.canonical),i.get("icon-anchor").evaluate(T,{},n.canonical)),J=!!$.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=J:n.bucket.sdfIcons!==J&&Zi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const q=km(B.horizontal)||B.vertical;n.bucket.iconsInText=!!q&&q.iconsInText,(q||N)&&ki(n.bucket,T,B,N,n.imageMap,u,D,P,G,J,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},L.cS=Ga,L.cT=Gi,L.cU=$c,L.cV=function(n){const e=new Kh;return(function(i,o){for(const u in i.layers)o.writeMessage(3,Sf,i.layers[u])})(n,e),e.finish()},L.cW=function(n,e,i,o,u,f){let p=Bm(n,e,i,u,0);return p=Bm(p,e,o,f,1),p},L.cX=class{constructor(n){this.maxEntries=n,this.map=new Map}get(n){const e=this.map.get(n);return e!==void 0&&(this.map.delete(n),this.map.set(n,e)),e}set(n,e){if(this.map.has(n))this.map.delete(n);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(n,e)}clear(){this.map.clear()}},L.cY=Ri,L.cZ=Kh,L.c_=Rp,L.ca=class extends pr{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},L.cb=class extends Gu{},L.cc=Wh,L.cd=class extends Fs{},L.ce=Zf,L.cf=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},L.cg=qd,L.ch=function(n,e,i){var o=e[0],u=e[1],f=e[2],p=i[3]*o+i[7]*u+i[11]*f+i[15];return n[0]=(i[0]*o+i[4]*u+i[8]*f+i[12])/(p=p||1),n[1]=(i[1]*o+i[5]*u+i[9]*f+i[13])/p,n[2]=(i[2]*o+i[6]*u+i[10]*f+i[14])/p,n},L.ci=class extends ca{},L.cj=class extends ql{},L.ck=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},L.cl=function(n,e){var i=n[0],o=n[1],u=n[2],f=n[3],p=n[4],y=n[5],x=n[6],T=n[7],E=n[8],C=n[9],D=n[10],P=n[11],B=n[12],O=n[13],N=n[14],G=n[15],J=e[0],q=e[1],$=e[2],ie=e[3],re=e[4],Te=e[5],Ge=e[6],Oe=e[7],Je=e[8],dt=e[9],nt=e[10],je=e[11],Pe=e[12],wt=e[13],xt=e[14],Mt=e[15];return Math.abs(i-J)<=Et*Math.max(1,Math.abs(i),Math.abs(J))&&Math.abs(o-q)<=Et*Math.max(1,Math.abs(o),Math.abs(q))&&Math.abs(u-$)<=Et*Math.max(1,Math.abs(u),Math.abs($))&&Math.abs(f-ie)<=Et*Math.max(1,Math.abs(f),Math.abs(ie))&&Math.abs(p-re)<=Et*Math.max(1,Math.abs(p),Math.abs(re))&&Math.abs(y-Te)<=Et*Math.max(1,Math.abs(y),Math.abs(Te))&&Math.abs(x-Ge)<=Et*Math.max(1,Math.abs(x),Math.abs(Ge))&&Math.abs(T-Oe)<=Et*Math.max(1,Math.abs(T),Math.abs(Oe))&&Math.abs(E-Je)<=Et*Math.max(1,Math.abs(E),Math.abs(Je))&&Math.abs(C-dt)<=Et*Math.max(1,Math.abs(C),Math.abs(dt))&&Math.abs(D-nt)<=Et*Math.max(1,Math.abs(D),Math.abs(nt))&&Math.abs(P-je)<=Et*Math.max(1,Math.abs(P),Math.abs(je))&&Math.abs(B-Pe)<=Et*Math.max(1,Math.abs(B),Math.abs(Pe))&&Math.abs(O-wt)<=Et*Math.max(1,Math.abs(O),Math.abs(wt))&&Math.abs(N-xt)<=Et*Math.max(1,Math.abs(N),Math.abs(xt))&&Math.abs(G-Mt)<=Et*Math.max(1,Math.abs(G),Math.abs(Mt))},L.cm=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},L.cn=n=>n.type==="symbol",L.co=n=>n.type==="circle",L.cp=n=>n.type==="heatmap",L.cq=n=>n.type==="line",L.cr=n=>n.type==="fill",L.cs=n=>n.type==="fill-extrusion",L.ct=n=>n.type==="hillshade",L.cu=n=>n.type==="color-relief",L.cv=n=>n.type==="background",L.cw=n=>n.type==="custom",L.cx=Ue,L.cy=function(n,e,i){const o=pt(e.x-i.x,e.y-i.y),u=pt(n.x-i.x,n.y-i.y),f=Math.atan2(o[0]*u[1]-o[1]*u[0],(function(p,y){return p[0]*y[0]+p[1]*y[1]})(o,u));return Vr(f)},L.cz=yt,L.d=$e,L.d0=function(n,e,i,o,u){return d(this,void 0,void 0,(function*(){if(mt())try{return yield Xs(n,e,i,o,u)}catch{}return(function(f,p,y,x,T){const E=f.width,C=f.height;Wa&&Ia||(Wa=new OffscreenCanvas(E,C),Ia=Wa.getContext("2d",{willReadFrequently:!0})),Wa.width=E,Wa.height=C,Ia.drawImage(f,0,0,E,C);const D=Ia.getImageData(p,y,x,T);return Ia.clearRect(0,0,E,C),D.data})(n,e,i,o,u)}))},L.d1=$p,L.d2=_e,L.d3=class{constructor(n,e){this.layers={[lh]:this},this.name=lh,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=n.length,this.features=n}feature(n){return new ag(this.features[n],this.extent)}},L.d4=Pu,L.d5=Fa,L.e=yi,L.f=n=>d(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),L.g=Se,L.h=n=>new Promise(((e,i)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=bs}))},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(u):bs})),L.i=_r,L.j=(n,e)=>Ze(yi(n,{type:"json"}),e),L.k=Ti,L.l=Gt,L.m=Ze,L.n=(n,e)=>Ze(yi(n,{type:"arrayBuffer"}),e),L.o=function(n){return new Kh(n).readFields(um,[])},L.p=cp,L.q=function(n){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))},L.r=jc,L.s=gl,L.t=Mn,L.u=be,L.v=Bl,L.w=Zi,L.x=$o,L.y=Ol,L.z=yo})),at("worker",["./shared"],(function(L){class d{constructor(V,j){this.keyCache={},V&&this.replace(V,j)}replace(V,j){this._layerConfigs={},this._layers={},this.update(V,[],j)}update(V,j,H){for(const ce of V){this._layerConfigs[ce.id]=ce;const Se=this._layers[ce.id]=L.bU(ce,H);Se._featureFilter=L.ak(Se.filter,H),this.keyCache[ce.id]&&delete this.keyCache[ce.id]}for(const ce of j)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};const oe=L.cM(Object.values(this._layerConfigs),this.keyCache);for(const ce of oe){const Se=ce.map((bt=>this._layers[bt.id])),ye=Se[0];if(ye.visibility==="none")continue;const fe=ye.source||"";let Me=this.familiesBySource[fe];Me||(Me=this.familiesBySource[fe]={});const Ze=ye.sourceLayer||L.aa;let $e=Me[Ze];$e||($e=Me[Ze]=[]),$e.push(Se)}}}class de{constructor(V){const j={},H=[];for(const ye in V){const fe=V[ye],Me=j[ye]={};for(const Ze in fe){const $e=fe[+Ze];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const bt={x:0,y:0,w:$e.bitmap.width+2,h:$e.bitmap.height+2};H.push(bt),Me[Ze]={rect:bt,metrics:$e.metrics}}}const{w:oe,h:ce}=L.p(H),Se=new L.r({width:oe||1,height:ce||1});for(const ye in V){const fe=V[ye];for(const Me in fe){const Ze=fe[+Me];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const $e=j[ye][Me].rect;L.r.copy(Ze.bitmap,Se,{x:0,y:0},{x:$e.x+1,y:$e.y+1},Ze.bitmap)}}this.image=Se,this.positions=j}}L.cN("GlyphAtlas",de);class _e{constructor(V){this.tileID=new L.a2(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,j,H,oe,ce){return L._(this,void 0,void 0,(function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new L.ai;const Se=new L.cO(Object.keys(V.layers).sort()),ye=new L.cP(this.tileID,this.promoteId);ye.bucketLayerIDs=[];const fe={},Me={featureIndex:ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:H,subdivisionGranularity:ce},Ze=j.familiesBySource[this.source];for(const Fi in Ze){const Dn=V.layers[Fi];if(!Dn)continue;Dn.version===1&&L.w(`Vector tile source "${this.source}" layer "${Fi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _l=Se.encode(Fi),Ao=[];for(let ot=0;ot<Dn.length;ot++){const yr=Dn.feature(ot),vr=ye.getId(yr,Fi);Ao.push({feature:yr,id:vr,index:ot,sourceLayerIndex:_l})}for(const ot of Ze[Fi]){const yr=ot[0];yr.source!==this.source&&L.w(`layer.source = ${yr.source} does not equal this.source = ${this.source}`),yr.isHidden(this.zoom,!0)||(He(ot,this.zoom,H),(fe[yr.id]=yr.createBucket({index:ye.bucketLayerIDs.length,layers:ot,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_l,sourceID:this.source})).populate(Ao,Me,this.tileID.canonical),ye.bucketLayerIDs.push(ot.map((vr=>vr.id))))}}const $e=L.bZ(Me.glyphDependencies,(Fi=>Object.keys(Fi).map(Number)));this.inFlightDependencies.forEach((Fi=>Fi?.abort())),this.inFlightDependencies=[];let bt=Promise.resolve({});if(Object.keys($e).length){const Fi=new AbortController;this.inFlightDependencies.push(Fi),bt=oe.sendAsync({type:"GG",data:{stacks:$e,source:this.source,tileID:this.tileID,type:"glyphs"}},Fi)}const Pt=Object.keys(Me.iconDependencies);let Gt=Promise.resolve({});if(Pt.length){const Fi=new AbortController;this.inFlightDependencies.push(Fi),Gt=oe.sendAsync({type:"GI",data:{icons:Pt,source:this.source,tileID:this.tileID,type:"icons"}},Fi)}const Ti=Object.keys(Me.patternDependencies);let fi=Promise.resolve({});if(Ti.length){const Fi=new AbortController;this.inFlightDependencies.push(Fi),fi=oe.sendAsync({type:"GI",data:{icons:Ti,source:this.source,tileID:this.tileID,type:"patterns"}},Fi)}const be=Me.dashDependencies;let Ci=Promise.resolve({});if(Object.keys(be).length){const Fi=new AbortController;this.inFlightDependencies.push(Fi),Ci=oe.sendAsync({type:"GDA",data:{dashes:be}},Fi)}const[zn,Ht,zi,Xn]=yield Promise.all([bt,Gt,fi,Ci]),Di=new de(zn),Tn=new L.cQ(Ht,zi);for(const Fi in fe){const Dn=fe[Fi];Dn instanceof L.aj?(He(Dn.layers,this.zoom,H),L.cR({bucket:Dn,glyphMap:zn,glyphPositions:Di.positions,imageMap:Ht,imagePositions:Tn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Me.subdivisionGranularity})):Dn.hasDependencies&&(Dn instanceof L.cS||Dn instanceof L.cT||Dn instanceof L.cU)&&(He(Dn.layers,this.zoom,H),Dn.addFeatures(Me,this.tileID.canonical,Tn.patternPositions,Xn))}return this.status="done",{buckets:Object.values(fe).filter((Fi=>!Fi.isEmpty())),featureIndex:ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Di.image,imageAtlas:Tn,dashPositions:Xn,glyphMap:this.returnDependencies?zn:null,iconMap:this.returnDependencies?Ht:null,glyphPositions:this.returnDependencies?Di.positions:null}}))}}function He(xe,V,j){const H=new L.H(V);for(const oe of xe)oe.recalculate(H,j)}class Re{constructor(V,j,H,oe,ce){this.type=V,this.properties=H||{},this.extent=ce,this.pointsArray=j,this.id=oe}loadGeometry(){return this.pointsArray.map((V=>V.map((j=>new L.P(j.x,j.y)))))}}class Ee{constructor(V,j,H){this.version=2,this._myFeatures=V,this.name=j,this.length=V.length,this.extent=H}feature(V){return this._myFeatures[V]}}class ct{constructor(){this.layers={}}addLayer(V){this.layers[V.name]=V}}function At(xe){let V=L.cV(xe);return V.byteOffset===0&&V.byteLength===V.buffer.byteLength||(V=new Uint8Array(V)),{vectorTile:xe,rawData:V.buffer}}function rt(xe,V,j){const{extent:H}=xe,oe=Math.pow(2,j.z-V.z),ce=(j.x-V.x*oe)*H,Se=(j.y-V.y*oe)*H,ye=[];for(let fe=0;fe<xe.length;fe++){const Me=xe.feature(fe);let Ze=Me.loadGeometry();for(const bt of Ze)for(const Pt of bt)Pt.x=Pt.x*oe-ce,Pt.y=Pt.y*oe-Se;const $e=128;Ze=L.cW(Ze,Me.type,-$e,-$e,H+$e,H+$e),Ze.length!==0&&ye.push(new Re(Me.type,Ze,Me.properties,Me.id,H))}return new Ee(ye,xe.name,H)}class pe{constructor(V,j,H){this.actor=V,this.layerIndex=j,this.availableImages=H,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new L.cX(1e3)}loadVectorTile(V,j){return L._(this,void 0,void 0,(function*(){const H=yield L.n(V.request,j);try{return{vectorTile:V.encoding!=="mlt"?new L.cY(new L.cZ(H.data)):new L.c_(H.data),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(oe){const ce=new Uint8Array(H.data);let Se=`Unable to parse the tile at ${V.request.url}, `;throw Se+=ce[0]===31&&ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${oe.message}`,new Error(Se)}}))}loadTile(V){return L._(this,void 0,void 0,(function*(){const{uid:j,overzoomParameters:H}=V;H&&(V.request=H.overzoomRequest);const oe=!!(V&&V.request&&V.request.collectResourceTiming)&&new L.c$(V.request),ce=new _e(V);this.loading[j]=ce;const Se=new AbortController;ce.abort=Se;try{const ye=yield this.loadVectorTile(V,Se);if(delete this.loading[j],!ye)return null;if(H){const bt=this._getOverzoomTile(V,ye.vectorTile);ye.rawData=bt.rawData,ye.vectorTile=bt.vectorTile}const fe=ye.rawData,Me={};ye.expires&&(Me.expires=ye.expires),ye.cacheControl&&(Me.cacheControl=ye.cacheControl);const Ze={};if(oe){const bt=oe.finish();bt&&(Ze.resourceTiming=JSON.parse(JSON.stringify(bt)))}ce.vectorTile=ye.vectorTile;const $e=ce.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[j]=ce,this.fetching[j]={rawTileData:fe,cacheControl:Me,resourceTiming:Ze};try{const bt=yield $e;return L.e({rawTileData:fe.slice(0),encoding:V.encoding},bt,Me,Ze)}finally{delete this.fetching[j]}}catch(ye){throw delete this.loading[j],ce.status="done",this.loaded[j]=ce,ye}}))}_getOverzoomTile(V,j){const{tileID:H,source:oe,overzoomParameters:ce}=V,{maxZoomTileID:Se}=ce,ye=`${Se.key}_${H.key}`,fe=this.overzoomedTileResultCache.get(ye);if(fe)return fe;const Me=new ct,Ze=this.layerIndex.familiesBySource[oe];for(const bt in Ze){const Pt=j.layers[bt];if(!Pt)continue;const Gt=rt(Pt,Se,H.canonical);Gt.length>0&&Me.addLayer(Gt)}const $e=At(Me);return this.overzoomedTileResultCache.set(ye,$e),$e}reloadTile(V){return L._(this,void 0,void 0,(function*(){const j=V.uid;if(!this.loaded||!this.loaded[j])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[j];if(H.showCollisionBoxes=V.showCollisionBoxes,H.status==="parsing"){const oe=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);let ce;if(this.fetching[j]){const{rawTileData:Se,cacheControl:ye,resourceTiming:fe}=this.fetching[j];delete this.fetching[j],ce=L.e({rawTileData:Se.slice(0),encoding:V.encoding},oe,ye,fe)}else ce=oe;return ce}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)}))}abortTile(V){return L._(this,void 0,void 0,(function*(){const j=this.loading,H=V.uid;j&&j[H]&&j[H].abort&&(j[H].abort.abort(),delete j[H])}))}removeTile(V){return L._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]}))}}class mt{constructor(){this.loaded={}}loadTile(V){return L._(this,void 0,void 0,(function*(){const{uid:j,encoding:H,rawImageData:oe,redFactor:ce,greenFactor:Se,blueFactor:ye,baseShift:fe}=V,Me=oe.width+2,Ze=oe.height+2,$e=L.b(oe)?new L.R({width:Me,height:Ze},yield L.d0(oe,-1,-1,Me,Ze)):oe,bt=new L.d1(j,$e,H,ce,Se,ye,fe);return this.loaded=this.loaded||{},this.loaded[j]=bt,bt}))}removeTile(V){const j=this.loaded,H=V.uid;j&&j[H]&&delete j[H]}}var Et,ut,vt=(function(){if(ut)return Et;function xe(j,H){if(j.length!==0){V(j[0],H);for(var oe=1;oe<j.length;oe++)V(j[oe],!H)}}function V(j,H){for(var oe=0,ce=0,Se=0,ye=j.length,fe=ye-1;Se<ye;fe=Se++){var Me=(j[Se][0]-j[fe][0])*(j[fe][1]+j[Se][1]),Ze=oe+Me;ce+=Math.abs(oe)>=Math.abs(Me)?oe-Ze+Me:Me-Ze+oe,oe=Ze}oe+ce>=0!=!!H&&j.reverse()}return ut=1,Et=function j(H,oe){var ce,Se=H&&H.type;if(Se==="FeatureCollection")for(ce=0;ce<H.features.length;ce++)j(H.features[ce],oe);else if(Se==="GeometryCollection")for(ce=0;ce<H.geometries.length;ce++)j(H.geometries[ce],oe);else if(Se==="Feature")j(H.geometry,oe);else if(Se==="Polygon")xe(H.coordinates,oe);else if(Se==="MultiPolygon")for(ce=0;ce<H.coordinates.length;ce++)xe(H.coordinates[ce],oe);return H}})(),Bt=L.d2(vt);const Tt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:xe=>xe},gt=Math.fround||(Vt=new Float32Array(1),xe=>(Vt[0]=+xe,Vt[0]));var Vt;class ti{constructor(V){this.options=Object.assign(Object.create(Tt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:j,minZoom:H,maxZoom:oe}=this.options;j&&console.time("total time");const ce=`prepare ${V.length} points`;j&&console.time(ce),this.points=V;const Se=[];for(let fe=0;fe<V.length;fe++){const Me=V[fe];if(!Me.geometry)continue;const[Ze,$e]=Me.geometry.coordinates,bt=gt(Jt(Ze)),Pt=gt(di($e));Se.push(bt,Pt,1/0,fe,-1,1),this.options.reduce&&Se.push(0)}let ye=this.trees[oe+1]=this._createTree(Se);j&&console.timeEnd(ce);for(let fe=oe;fe>=H;fe--){const Me=+Date.now();ye=this.trees[fe]=this._createTree(this._cluster(ye,fe)),j&&console.log("z%d: %d clusters in %dms",fe,ye.numItems,+Date.now()-Me)}return j&&console.timeEnd("total time"),this}getClusters(V,j){let H=((V[0]+180)%360+360)%360-180;const oe=Math.max(-90,Math.min(90,V[1]));let ce=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)H=-180,ce=180;else if(H>ce){const $e=this.getClusters([H,oe,180,Se],j),bt=this.getClusters([-180,oe,ce,Se],j);return $e.concat(bt)}const ye=this.trees[this._limitZoom(j)],fe=ye.range(Jt(H),di(Se),Jt(ce),di(oe)),Me=ye.data,Ze=[];for(const $e of fe){const bt=this.stride*$e;Ze.push(Me[bt+5]>1?hi(Me,bt,this.clusterProps):this.points[Me[bt+3]])}return Ze}getChildren(V){const j=this._getOriginId(V),H=this._getOriginZoom(V),oe="No cluster with the specified id.",ce=this.trees[H];if(!ce)throw new Error(oe);const Se=ce.data;if(j*this.stride>=Se.length)throw new Error(oe);const ye=this.options.radius/(this.options.extent*Math.pow(2,H-1)),fe=ce.within(Se[j*this.stride],Se[j*this.stride+1],ye),Me=[];for(const Ze of fe){const $e=Ze*this.stride;Se[$e+4]===V&&Me.push(Se[$e+5]>1?hi(Se,$e,this.clusterProps):this.points[Se[$e+3]])}if(Me.length===0)throw new Error(oe);return Me}getLeaves(V,j,H){const oe=[];return this._appendLeaves(oe,V,j=j||10,H=H||0,0),oe}getTile(V,j,H){const oe=this.trees[this._limitZoom(V)],ce=Math.pow(2,V),{extent:Se,radius:ye}=this.options,fe=ye/Se,Me=(H-fe)/ce,Ze=(H+1+fe)/ce,$e={features:[]};return this._addTileFeatures(oe.range((j-fe)/ce,Me,(j+1+fe)/ce,Ze),oe.data,j,H,ce,$e),j===0&&this._addTileFeatures(oe.range(1-fe/ce,Me,1,Ze),oe.data,ce,H,ce,$e),j===ce-1&&this._addTileFeatures(oe.range(0,Me,fe/ce,Ze),oe.data,-1,H,ce,$e),$e.features.length?$e:null}getClusterExpansionZoom(V){let j=this._getOriginZoom(V)-1;for(;j<=this.options.maxZoom;){const H=this.getChildren(V);if(j++,H.length!==1)break;V=H[0].properties.cluster_id}return j}_appendLeaves(V,j,H,oe,ce){const Se=this.getChildren(j);for(const ye of Se){const fe=ye.properties;if(fe&&fe.cluster?ce+fe.point_count<=oe?ce+=fe.point_count:ce=this._appendLeaves(V,fe.cluster_id,H,oe,ce):ce<oe?ce++:V.push(ye),V.length===H)break}return ce}_createTree(V){const j=new L.aU(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<V.length;H+=this.stride)j.add(V[H],V[H+1]);return j.finish(),j.data=V,j}_addTileFeatures(V,j,H,oe,ce,Se){for(const ye of V){const fe=ye*this.stride,Me=j[fe+5]>1;let Ze,$e,bt;if(Me)Ze=si(j,fe,this.clusterProps),$e=j[fe],bt=j[fe+1];else{const Ti=this.points[j[fe+3]];Ze=Ti.properties;const[fi,be]=Ti.geometry.coordinates;$e=Jt(fi),bt=di(be)}const Pt={type:1,geometry:[[Math.round(this.options.extent*($e*ce-H)),Math.round(this.options.extent*(bt*ce-oe))]],tags:Ze};let Gt;Gt=Me||this.options.generateId?j[fe+3]:this.points[j[fe+3]].id,Gt!==void 0&&(Pt.id=Gt),Se.features.push(Pt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,j){const{radius:H,extent:oe,reduce:ce,minPoints:Se}=this.options,ye=H/(oe*Math.pow(2,j)),fe=V.data,Me=[],Ze=this.stride;for(let $e=0;$e<fe.length;$e+=Ze){if(fe[$e+2]<=j)continue;fe[$e+2]=j;const bt=fe[$e],Pt=fe[$e+1],Gt=V.within(fe[$e],fe[$e+1],ye),Ti=fe[$e+5];let fi=Ti;for(const be of Gt){const Ci=be*Ze;fe[Ci+2]>j&&(fi+=fe[Ci+5])}if(fi>Ti&&fi>=Se){let be,Ci=bt*Ti,zn=Pt*Ti,Ht=-1;const zi=($e/Ze<<5)+(j+1)+this.points.length;for(const Xn of Gt){const Di=Xn*Ze;if(fe[Di+2]<=j)continue;fe[Di+2]=j;const Tn=fe[Di+5];Ci+=fe[Di]*Tn,zn+=fe[Di+1]*Tn,fe[Di+4]=zi,ce&&(be||(be=this._map(fe,$e,!0),Ht=this.clusterProps.length,this.clusterProps.push(be)),ce(be,this._map(fe,Di)))}fe[$e+4]=zi,Me.push(Ci/fi,zn/fi,1/0,zi,-1,fi),ce&&Me.push(Ht)}else{for(let be=0;be<Ze;be++)Me.push(fe[$e+be]);if(fi>1)for(const be of Gt){const Ci=be*Ze;if(!(fe[Ci+2]<=j)){fe[Ci+2]=j;for(let zn=0;zn<Ze;zn++)Me.push(fe[Ci+zn])}}}}return Me}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,j,H){if(V[j+5]>1){const Se=this.clusterProps[V[j+6]];return H?Object.assign({},Se):Se}const oe=this.points[V[j+3]].properties,ce=this.options.map(oe);return H&&ce===oe?Object.assign({},ce):ce}}function hi(xe,V,j){return{type:"Feature",id:xe[V+3],properties:si(xe,V,j),geometry:{type:"Point",coordinates:[(H=xe[V],360*(H-.5)),an(xe[V+1])]}};var H}function si(xe,V,j){const H=xe[V+5],oe=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,ce=xe[V+6],Se=ce===-1?{}:Object.assign({},j[ce]);return Object.assign(Se,{cluster:!0,cluster_id:xe[V+3],point_count:H,point_count_abbreviated:oe})}function Jt(xe){return xe/360+.5}function di(xe){const V=Math.sin(xe*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function an(xe){const V=(180-360*xe)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function fn(xe,V,j,H){let oe=H;const ce=V+(j-V>>1);let Se,ye=j-V;const fe=xe[V],Me=xe[V+1],Ze=xe[j],$e=xe[j+1];for(let bt=V+3;bt<j;bt+=3){const Pt=qe(xe[bt],xe[bt+1],fe,Me,Ze,$e);if(Pt>oe)Se=bt,oe=Pt;else if(Pt===oe){const Gt=Math.abs(bt-ce);Gt<ye&&(Se=bt,ye=Gt)}}oe>H&&(Se-V>3&&fn(xe,V,Se,H),xe[Se+2]=oe,j-Se>3&&fn(xe,Se,j,H))}function qe(xe,V,j,H,oe,ce){let Se=oe-j,ye=ce-H;if(Se!==0||ye!==0){const fe=((xe-j)*Se+(V-H)*ye)/(Se*Se+ye*ye);fe>1?(j=oe,H=ce):fe>0&&(j+=Se*fe,H+=ye*fe)}return Se=xe-j,ye=V-H,Se*Se+ye*ye}function We(xe,V,j,H){const oe={id:xe??null,type:V,geometry:j,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")pt(oe,j);else if(V==="Polygon")pt(oe,j[0]);else if(V==="MultiLineString")for(const ce of j)pt(oe,ce);else if(V==="MultiPolygon")for(const ce of j)pt(oe,ce[0]);return oe}function pt(xe,V){for(let j=0;j<V.length;j+=3)xe.minX=Math.min(xe.minX,V[j]),xe.minY=Math.min(xe.minY,V[j+1]),xe.maxX=Math.max(xe.maxX,V[j]),xe.maxY=Math.max(xe.maxY,V[j+1])}function Ve(xe,V,j,H){if(!V.geometry)return;const oe=V.geometry.coordinates;if(oe&&oe.length===0)return;const ce=V.geometry.type,Se=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2);let ye=[],fe=V.id;if(j.promoteId?fe=V.properties[j.promoteId]:j.generateId&&(fe=H||0),ce==="Point")St(oe,ye);else if(ce==="MultiPoint")for(const Me of oe)St(Me,ye);else if(ce==="LineString")le(oe,ye,Se,!1);else if(ce==="MultiLineString"){if(j.lineMetrics){for(const Me of oe)ye=[],le(Me,ye,Se,!1),xe.push(We(fe,"LineString",ye,V.properties));return}ze(oe,ye,Se,!1)}else if(ce==="Polygon")ze(oe,ye,Se,!0);else{if(ce!=="MultiPolygon"){if(ce==="GeometryCollection"){for(const Me of V.geometry.geometries)Ve(xe,{id:fe,geometry:Me,properties:V.properties},j,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Me of oe){const Ze=[];ze(Me,Ze,Se,!0),ye.push(Ze)}}xe.push(We(fe,ce,ye,V.properties))}function St(xe,V){V.push(it(xe[0]),Ue(xe[1]),0)}function le(xe,V,j,H){let oe,ce,Se=0;for(let fe=0;fe<xe.length;fe++){const Me=it(xe[fe][0]),Ze=Ue(xe[fe][1]);V.push(Me,Ze,0),fe>0&&(Se+=H?(oe*Ze-Me*ce)/2:Math.sqrt(Math.pow(Me-oe,2)+Math.pow(Ze-ce,2))),oe=Me,ce=Ze}const ye=V.length-3;V[2]=1,fn(V,0,ye,j),V[ye+2]=1,V.size=Math.abs(Se),V.start=0,V.end=V.size}function ze(xe,V,j,H){for(let oe=0;oe<xe.length;oe++){const ce=[];le(xe[oe],ce,j,H),V.push(ce)}}function it(xe){return xe/360+.5}function Ue(xe){const V=Math.sin(xe*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function yt(xe,V,j,H,oe,ce,Se,ye){if(H/=V,ce>=(j/=V)&&Se<H)return xe;if(Se<j||ce>=H)return null;const fe=[];for(const Me of xe){const Ze=Me.geometry;let $e=Me.type;const bt=oe===0?Me.minX:Me.minY,Pt=oe===0?Me.maxX:Me.maxY;if(bt>=j&&Pt<H){fe.push(Me);continue}if(Pt<j||bt>=H)continue;let Gt=[];if($e==="Point"||$e==="MultiPoint")kt(Ze,Gt,j,H,oe);else if($e==="LineString")Nt(Ze,Gt,j,H,oe,!1,ye.lineMetrics);else if($e==="MultiLineString")Ai(Ze,Gt,j,H,oe,!1);else if($e==="Polygon")Ai(Ze,Gt,j,H,oe,!0);else if($e==="MultiPolygon")for(const Ti of Ze){const fi=[];Ai(Ti,fi,j,H,oe,!0),fi.length&&Gt.push(fi)}if(Gt.length){if(ye.lineMetrics&&$e==="LineString"){for(const Ti of Gt)fe.push(We(Me.id,$e,Ti,Me.tags));continue}$e!=="LineString"&&$e!=="MultiLineString"||(Gt.length===1?($e="LineString",Gt=Gt[0]):$e="MultiLineString"),$e!=="Point"&&$e!=="MultiPoint"||($e=Gt.length===3?"Point":"MultiPoint"),fe.push(We(Me.id,$e,Gt,Me.tags))}}return fe.length?fe:null}function kt(xe,V,j,H,oe){for(let ce=0;ce<xe.length;ce+=3){const Se=xe[ce+oe];Se>=j&&Se<=H&&Jn(V,xe[ce],xe[ce+1],xe[ce+2])}}function Nt(xe,V,j,H,oe,ce,Se){let ye=yi(xe);const fe=oe===0?gr:hr;let Me,Ze,$e=xe.start;for(let fi=0;fi<xe.length-3;fi+=3){const be=xe[fi],Ci=xe[fi+1],zn=xe[fi+2],Ht=xe[fi+3],zi=xe[fi+4],Xn=oe===0?be:Ci,Di=oe===0?Ht:zi;let Tn=!1;Se&&(Me=Math.sqrt(Math.pow(be-Ht,2)+Math.pow(Ci-zi,2))),Xn<j?Di>j&&(Ze=fe(ye,be,Ci,Ht,zi,j),Se&&(ye.start=$e+Me*Ze)):Xn>H?Di<H&&(Ze=fe(ye,be,Ci,Ht,zi,H),Se&&(ye.start=$e+Me*Ze)):Jn(ye,be,Ci,zn),Di<j&&Xn>=j&&(Ze=fe(ye,be,Ci,Ht,zi,j),Tn=!0),Di>H&&Xn<=H&&(Ze=fe(ye,be,Ci,Ht,zi,H),Tn=!0),!ce&&Tn&&(Se&&(ye.end=$e+Me*Ze),V.push(ye),ye=yi(xe)),Se&&($e+=Me)}let bt=xe.length-3;const Pt=xe[bt],Gt=xe[bt+1],Ti=oe===0?Pt:Gt;Ti>=j&&Ti<=H&&Jn(ye,Pt,Gt,xe[bt+2]),bt=ye.length-3,ce&&bt>=3&&(ye[bt]!==ye[0]||ye[bt+1]!==ye[1])&&Jn(ye,ye[0],ye[1],ye[2]),ye.length&&V.push(ye)}function yi(xe){const V=[];return V.size=xe.size,V.start=xe.start,V.end=xe.end,V}function Ai(xe,V,j,H,oe,ce){for(const Se of xe)Nt(Se,V,j,H,oe,ce,!1)}function Jn(xe,V,j,H){xe.push(V,j,H)}function gr(xe,V,j,H,oe,ce){const Se=(ce-V)/(H-V);return Jn(xe,ce,j+(oe-j)*Se,1),Se}function hr(xe,V,j,H,oe,ce){const Se=(ce-j)/(oe-j);return Jn(xe,V+(H-V)*Se,ce,1),Se}function Pa(xe,V){const j=[];for(let H=0;H<xe.length;H++){const oe=xe[H],ce=oe.type;let Se;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")Se=Zi(oe.geometry,V);else if(ce==="MultiLineString"||ce==="Polygon"){Se=[];for(const ye of oe.geometry)Se.push(Zi(ye,V))}else if(ce==="MultiPolygon"){Se=[];for(const ye of oe.geometry){const fe=[];for(const Me of ye)fe.push(Zi(Me,V));Se.push(fe)}}j.push(We(oe.id,ce,Se,oe.tags))}return j}function Zi(xe,V){const j=[];j.size=xe.size,xe.start!==void 0&&(j.start=xe.start,j.end=xe.end);for(let H=0;H<xe.length;H+=3)j.push(xe[H]+V,xe[H+1],xe[H+2]);return j}function dr(xe,V){if(xe.transformed)return xe;const j=1<<xe.z,H=xe.x,oe=xe.y;for(const ce of xe.features){const Se=ce.geometry,ye=ce.type;if(ce.geometry=[],ye===1)for(let fe=0;fe<Se.length;fe+=2)ce.geometry.push(_r(Se[fe],Se[fe+1],V,j,H,oe));else for(let fe=0;fe<Se.length;fe++){const Me=[];for(let Ze=0;Ze<Se[fe].length;Ze+=2)Me.push(_r(Se[fe][Ze],Se[fe][Ze+1],V,j,H,oe));ce.geometry.push(Me)}}return xe.transformed=!0,xe}function _r(xe,V,j,H,oe,ce){return[Math.round(j*(xe*H-oe)),Math.round(j*(V*H-ce))]}function pn(xe,V,j,H,oe){const ce=V===oe.maxZoom?0:oe.tolerance/((1<<V)*oe.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:xe.length,source:null,x:j,y:H,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ye of xe)xs(Se,ye,ce,oe);return Se}function xs(xe,V,j,H){const oe=V.geometry,ce=V.type,Se=[];if(xe.minX=Math.min(xe.minX,V.minX),xe.minY=Math.min(xe.minY,V.minY),xe.maxX=Math.max(xe.maxX,V.maxX),xe.maxY=Math.max(xe.maxY,V.maxY),ce==="Point"||ce==="MultiPoint")for(let ye=0;ye<oe.length;ye+=3)Se.push(oe[ye],oe[ye+1]),xe.numPoints++,xe.numSimplified++;else if(ce==="LineString")bs(Se,oe,xe,j,!1,!1);else if(ce==="MultiLineString"||ce==="Polygon")for(let ye=0;ye<oe.length;ye++)bs(Se,oe[ye],xe,j,ce==="Polygon",ye===0);else if(ce==="MultiPolygon")for(let ye=0;ye<oe.length;ye++){const fe=oe[ye];for(let Me=0;Me<fe.length;Me++)bs(Se,fe[Me],xe,j,!0,Me===0)}if(Se.length){let ye=V.tags||null;if(ce==="LineString"&&H.lineMetrics){ye={};for(const Me in V.tags)ye[Me]=V.tags[Me];ye.mapbox_clip_start=oe.start/oe.size,ye.mapbox_clip_end=oe.end/oe.size}const fe={geometry:Se,type:ce==="Polygon"||ce==="MultiPolygon"?3:ce==="LineString"||ce==="MultiLineString"?2:1,tags:ye};V.id!==null&&(fe.id=V.id),xe.features.push(fe)}}function bs(xe,V,j,H,oe,ce){const Se=H*H;if(H>0&&V.size<(oe?Se:H))return void(j.numPoints+=V.length/3);const ye=[];for(let fe=0;fe<V.length;fe+=3)(H===0||V[fe+2]>Se)&&(j.numSimplified++,ye.push(V[fe],V[fe+1])),j.numPoints++;oe&&(function(fe,Me){let Ze=0;for(let $e=0,bt=fe.length,Pt=bt-2;$e<bt;Pt=$e,$e+=2)Ze+=(fe[$e]-fe[Pt])*(fe[$e+1]+fe[Pt+1]);if(Ze>0===Me)for(let $e=0,bt=fe.length;$e<bt/2;$e+=2){const Pt=fe[$e],Gt=fe[$e+1];fe[$e]=fe[bt-2-$e],fe[$e+1]=fe[bt-1-$e],fe[bt-2-$e]=Pt,fe[bt-1-$e]=Gt}})(ye,ce),xe.push(ye)}const Xs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Wa{constructor(V,j){const H=(j=this.options=(function(ce,Se){for(const ye in Se)ce[ye]=Se[ye];return ce})(Object.create(Xs),j)).debug;if(H&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");let oe=(function(ce,Se){const ye=[];if(ce.type==="FeatureCollection")for(let fe=0;fe<ce.features.length;fe++)Ve(ye,ce.features[fe],Se,fe);else Ve(ye,ce.type==="Feature"?ce:{geometry:ce},Se);return ye})(V,j);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),oe=(function(ce,Se){const ye=Se.buffer/Se.extent;let fe=ce;const Me=yt(ce,1,-1-ye,ye,0,-1,2,Se),Ze=yt(ce,1,1-ye,2+ye,0,-1,2,Se);return(Me||Ze)&&(fe=yt(ce,1,-ye,1+ye,0,-1,2,Se)||[],Me&&(fe=Pa(Me,1).concat(fe)),Ze&&(fe=fe.concat(Pa(Ze,-1)))),fe})(oe,j),oe.length&&this.splitTile(oe,0,0,0),H&&(oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,j,H,oe,ce,Se,ye){const fe=[V,j,H,oe],Me=this.options,Ze=Me.debug;for(;fe.length;){oe=fe.pop(),H=fe.pop(),j=fe.pop(),V=fe.pop();const $e=1<<j,bt=Ia(j,H,oe);let Pt=this.tiles[bt];if(!Pt&&(Ze>1&&console.time("creation"),Pt=this.tiles[bt]=pn(V,j,H,oe,Me),this.tileCoords.push({z:j,x:H,y:oe}),Ze)){Ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,H,oe,Pt.numFeatures,Pt.numPoints,Pt.numSimplified),console.timeEnd("creation"));const Tn=`z${j}`;this.stats[Tn]=(this.stats[Tn]||0)+1,this.total++}if(Pt.source=V,ce==null){if(j===Me.indexMaxZoom||Pt.numPoints<=Me.indexMaxPoints)continue}else{if(j===Me.maxZoom||j===ce)continue;if(ce!=null){const Tn=ce-j;if(H!==Se>>Tn||oe!==ye>>Tn)continue}}if(Pt.source=null,V.length===0)continue;Ze>1&&console.time("clipping");const Gt=.5*Me.buffer/Me.extent,Ti=.5-Gt,fi=.5+Gt,be=1+Gt;let Ci=null,zn=null,Ht=null,zi=null,Xn=yt(V,$e,H-Gt,H+fi,0,Pt.minX,Pt.maxX,Me),Di=yt(V,$e,H+Ti,H+be,0,Pt.minX,Pt.maxX,Me);V=null,Xn&&(Ci=yt(Xn,$e,oe-Gt,oe+fi,1,Pt.minY,Pt.maxY,Me),zn=yt(Xn,$e,oe+Ti,oe+be,1,Pt.minY,Pt.maxY,Me),Xn=null),Di&&(Ht=yt(Di,$e,oe-Gt,oe+fi,1,Pt.minY,Pt.maxY,Me),zi=yt(Di,$e,oe+Ti,oe+be,1,Pt.minY,Pt.maxY,Me),Di=null),Ze>1&&console.timeEnd("clipping"),fe.push(Ci||[],j+1,2*H,2*oe),fe.push(zn||[],j+1,2*H,2*oe+1),fe.push(Ht||[],j+1,2*H+1,2*oe),fe.push(zi||[],j+1,2*H+1,2*oe+1)}}getTile(V,j,H){V=+V,j=+j,H=+H;const oe=this.options,{extent:ce,debug:Se}=oe;if(V<0||V>24)return null;const ye=1<<V,fe=Ia(V,j=j+ye&ye-1,H);if(this.tiles[fe])return dr(this.tiles[fe],ce);Se>1&&console.log("drilling down to z%d-%d-%d",V,j,H);let Me,Ze=V,$e=j,bt=H;for(;!Me&&Ze>0;)Ze--,$e>>=1,bt>>=1,Me=this.tiles[Ia(Ze,$e,bt)];return Me&&Me.source?(Se>1&&(console.log("found parent tile z%d-%d-%d",Ze,$e,bt),console.time("drilling down")),this.splitTile(Me.source,Ze,$e,bt,V,j,H),Se>1&&console.timeEnd("drilling down"),this.tiles[fe]?dr(this.tiles[fe],ce):null):null}}function Ia(xe,V,j){return 32*((1<<xe)*j+V)+xe}class gl extends pe{constructor(V,j,H,oe=er){super(V,j,H),this._dataUpdateable=new Map,this._createGeoJSONIndex=oe}loadVectorTile(V,j){return L._(this,void 0,void 0,(function*(){const H=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const oe=this._geoJSONIndex.getTile(H.z,H.x,H.y);return oe?At(new L.d3(oe.features,{version:2,extent:L.a5})):null}))}loadData(V){return L._(this,void 0,void 0,(function*(){var j;(j=this._pendingRequest)===null||j===void 0||j.abort();const H=this._startPerformance(V);this._pendingRequest=new AbortController;try{(!this._pendingData||V.request||V.data||V.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest));const oe=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(oe,V),this.loaded={};const ce={};return this._finishPerformance(H,V,ce),ce}catch(oe){if(delete this._pendingRequest,L.Z(oe))return{abandoned:!0};throw oe}}))}_startPerformance(V){var j;if(!((j=V?.request)===null||j===void 0)&&j.collectResourceTiming)return new L.c$(V.request)}_finishPerformance(V,j,H){if(!V)return;const oe=V.finish();oe&&(H.resourceTiming={},H.resourceTiming[j.source]=JSON.parse(JSON.stringify(oe)))}getData(){return L._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(V){const j=this.loaded;return j&&j[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,j){return L._(this,void 0,void 0,(function*(){let H;if(V.request?H=yield this.loadGeoJSONFromUrl(V.request,V.promoteId,j):V.data?H=this._loadGeoJSONFromObject(V.data,V.promoteId):V.dataDiff&&(H=this._loadGeoJSONFromDiff(V.dataDiff,V.promoteId,V.source)),delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);return Bt(H,!0),V.filter&&(H=this._filterGeoJSON(H,V.filter)),H}))}loadGeoJSONFromUrl(V,j,H){return L._(this,void 0,void 0,(function*(){const oe=yield L.j(V,H);return this._dataUpdateable=L.a7(oe.data,j)?L.a8(oe.data,j):void 0,oe.data}))}_loadGeoJSONFromObject(V,j){return this._dataUpdateable=L.a7(V,j)?L.a8(V,j):void 0,V}_loadGeoJSONFromDiff(V,j,H){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${H}`);L.a9(this._dataUpdateable,V,j);const oe=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(oe)}_filterGeoJSON(V,j){const H=L.d4(j,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(H.result==="error")throw new Error(H.value.map((ce=>`${ce.key}: ${ce.message}`)).join(", "));const oe=V.features.filter((ce=>H.value.evaluate({zoom:0},ce)));return this._toFeatureCollection(oe)}_toFeatureCollection(V){return{type:"FeatureCollection",features:V}}removeSource(V){return L._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}function er(xe,V){return V.cluster?new ti((function({superclusterOptions:j,clusterProperties:H}){if(!H||!j)return j;const oe={},ce={},Se={accumulated:null,zoom:0},ye={properties:null},fe=Object.keys(H);for(const Me of fe){const[Ze,$e]=H[Me],bt=L.d4($e),Pt=L.d4(typeof Ze=="string"?[Ze,["accumulated"],["get",Me]]:Ze);oe[Me]=bt.value,ce[Me]=Pt.value}return j.map=Me=>{ye.properties=Me;const Ze={};for(const $e of fe)Ze[$e]=oe[$e].evaluate(Se,ye);return Ze},j.reduce=(Me,Ze)=>{ye.properties=Ze;for(const $e of fe)Se.accumulated=Me[$e],Me[$e]=ce[$e].evaluate(Se,ye)},j})(V)).load(xe.features):(function(j,H){return new Wa(j,H)})(xe,V.geojsonVtOptions)}class Vr{constructor(V){this.self=V,this.actor=new L.L(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(j,H)=>{if(this.externalWorkerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.externalWorkerSourceTypes[j]=H},this.self.addProtocol=L.cK,this.self.removeProtocol=L.cL,this.self.registerRTLTextPlugin=j=>{L.d5.setMethods(j)},this.actor.registerMessageHandler("LDT",((j,H)=>this._getDEMWorkerSource(j,H.source).loadTile(H))),this.actor.registerMessageHandler("RDT",((j,H)=>L._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(j,H.source).removeTile(H)})))),this.actor.registerMessageHandler("GCEZ",((j,H)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,H.type,H.source).getClusterExpansionZoom(H)})))),this.actor.registerMessageHandler("GCC",((j,H)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,H.type,H.source).getClusterChildren(H)})))),this.actor.registerMessageHandler("GCL",((j,H)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,H.type,H.source).getClusterLeaves(H)})))),this.actor.registerMessageHandler("LD",((j,H)=>this._getWorkerSource(j,H.type,H.source).loadData(H))),this.actor.registerMessageHandler("GD",((j,H)=>this._getWorkerSource(j,H.type,H.source).getData())),this.actor.registerMessageHandler("LT",((j,H)=>this._getWorkerSource(j,H.type,H.source).loadTile(H))),this.actor.registerMessageHandler("RT",((j,H)=>this._getWorkerSource(j,H.type,H.source).reloadTile(H))),this.actor.registerMessageHandler("AT",((j,H)=>this._getWorkerSource(j,H.type,H.source).abortTile(H))),this.actor.registerMessageHandler("RMT",((j,H)=>this._getWorkerSource(j,H.type,H.source).removeTile(H))),this.actor.registerMessageHandler("RS",((j,H)=>L._(this,void 0,void 0,(function*(){if(!this.workerSources[j]||!this.workerSources[j][H.type]||!this.workerSources[j][H.type][H.source])return;const oe=this.workerSources[j][H.type][H.source];delete this.workerSources[j][H.type][H.source],oe.removeSource!==void 0&&oe.removeSource(H)})))),this.actor.registerMessageHandler("RM",(j=>L._(this,void 0,void 0,(function*(){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],this.globalStates.delete(j)})))),this.actor.registerMessageHandler("SR",((j,H)=>L._(this,void 0,void 0,(function*(){this.referrer=H})))),this.actor.registerMessageHandler("SRPS",((j,H)=>this._syncRTLPluginState(j,H))),this.actor.registerMessageHandler("IS",((j,H)=>L._(this,void 0,void 0,(function*(){this.self.importScripts(H)})))),this.actor.registerMessageHandler("SI",((j,H)=>this._setImages(j,H))),this.actor.registerMessageHandler("UL",((j,H)=>L._(this,void 0,void 0,(function*(){this._getLayerIndex(j).update(H.layers,H.removedIds,this._getGlobalState(j))})))),this.actor.registerMessageHandler("UGS",((j,H)=>L._(this,void 0,void 0,(function*(){const oe=this._getGlobalState(j);for(const ce in H)oe[ce]=H[ce]})))),this.actor.registerMessageHandler("SL",((j,H)=>L._(this,void 0,void 0,(function*(){this._getLayerIndex(j).replace(H,this._getGlobalState(j))}))))}_getGlobalState(V){let j=this.globalStates.get(V);return j||(j={},this.globalStates.set(V,j)),j}_setImages(V,j){return L._(this,void 0,void 0,(function*(){this.availableImages[V]=j;for(const H in this.workerSources[V]){const oe=this.workerSources[V][H];for(const ce in oe)oe[ce].availableImages=j}}))}_syncRTLPluginState(V,j){return L._(this,void 0,void 0,(function*(){return yield L.d5.syncState(j,this.self.importScripts)}))}_getAvailableImages(V){let j=this.availableImages[V];return j||(j=[]),j}_getLayerIndex(V){let j=this.layerIndexes[V];return j||(j=this.layerIndexes[V]=new d),j}_getWorkerSource(V,j,H){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][j]||(this.workerSources[V][j]={}),!this.workerSources[V][j][H]){const oe={sendAsync:(ce,Se)=>(ce.targetMapId=V,this.actor.sendAsync(ce,Se))};switch(j){case"vector":this.workerSources[V][j][H]=new pe(oe,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][j][H]=new gl(oe,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][j][H]=new this.externalWorkerSourceTypes[j](oe,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][j][H]}_getDEMWorkerSource(V,j){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][j]||(this.demWorkerSources[V][j]=new mt),this.demWorkerSources[V][j]}}return L.i(self)&&(self.worker=new Vr(self)),Vr})),at("index",["exports","./shared"],(function(L,d){var de="5.14.0";function _e(){var m=new d.A(4);return d.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let He,Re,Ee;const ct={frame(m,t,a){const l=requestAnimationFrame((_=>{h(),t(_)})),{unsubscribe:h}=d.s(m.signal,"abort",(()=>{h(),cancelAnimationFrame(l),a(new d.a(m.signal.reason))}),!1)},frameAsync(m){return new Promise(((t,a)=>{this.frame(m,t,a)}))},getImageData(m,t=0){return this.getImageCanvasContext(m).getImageData(-t,-t,m.width+2*t,m.height+2*t)},getImageCanvasContext(m){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=m.width,t.height=m.height,a.drawImage(m,0,0,m.width,m.height),a},resolveURL:m=>(He||(He=document.createElement("a")),He.href=m,He.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return Ee!==void 0?Ee:!!matchMedia&&(Re==null&&(Re=matchMedia("(prefers-reduced-motion: reduce)")),Re.matches)},set prefersReducedMotion(m){Ee=m}},At=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function rt(){return At.getCurrentTime()}class pe{static testProp(t){if(!pe.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in pe.docStyle)return t[a];return t[0]}static create(t,a,l){const h=window.document.createElement(t);return a!==void 0&&(h.className=a),l&&l.appendChild(h),h}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){pe.docStyle&&pe.selectProp&&(pe.userSelect=pe.docStyle[pe.selectProp],pe.docStyle[pe.selectProp]="none")}static enableDrag(){pe.docStyle&&pe.selectProp&&(pe.docStyle[pe.selectProp]=pe.userSelect)}static setTransform(t,a){t.style[pe.transformProp]=a}static addEventListener(t,a,l,h={}){t.addEventListener(a,l,"passive"in h?h:h.capture)}static removeEventListener(t,a,l,h={}){t.removeEventListener(a,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",pe.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",pe.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",pe.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,l){const h=a.boundingClientRect;return new d.P((l.clientX-h.left)/a.x-t.clientLeft,(l.clientY-h.top)/a.y-t.clientTop)}static mousePos(t,a){const l=pe.getScale(t);return pe.getPoint(t,l,a)}static touchPos(t,a){const l=[],h=pe.getScale(t);for(let _=0;_<a.length;_++)l.push(pe.getPoint(t,h,a[_]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),l=a.querySelectorAll("script");for(const h of l)h.remove();return pe.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const l=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!l.includes("javascript:")&&!l.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const l of a)pe.removeAttributes(l),pe.clean(l)}static removeAttributes(t){for(const{name:a,value:l}of t.attributes)pe.isPossiblyDangerous(a,l)&&t.removeAttribute(a)}}pe.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,pe.selectProp=pe.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),pe.transformProp=pe.testProp(["transform","WebkitTransform"]);const mt={supported:!1,testSupport:function(m){!vt&&ut&&(Bt?Tt(m):Et=m)}};let Et,ut,vt=!1,Bt=!1;function Tt(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,ut),m.isContextLost())return;mt.supported=!0}catch{}m.deleteTexture(t),vt=!0}var gt;typeof document<"u"&&(ut=document.createElement("img"),ut.onload=()=>{Et&&Tt(Et),Et=null,Bt=!0},ut.onerror=()=>{vt=!0,Et=null},ut.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let t,a,l,h;m.resetRequestQueue=()=>{t=[],a=0,l=0,h={}},m.addThrottleControl=S=>{const A=l++;return h[A]=S,A},m.removeThrottleControl=S=>{delete h[S],v()},m.getImage=(S,A,z=!0)=>new Promise(((R,I)=>{mt.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),d.e(S,{type:"image"}),t.push({abortController:A,requestParameters:S,supportImageRefresh:z,state:"queued",onError:F=>{I(F)},onSuccess:F=>{R(F)}}),v()}));const _=S=>d._(this,void 0,void 0,(function*(){S.state="running";const{requestParameters:A,supportImageRefresh:z,onError:R,onSuccess:I,abortController:F}=S,U=z===!1&&!d.i(self)&&!d.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce(((Y,Q)=>Y&&Q==="accept"),!0));a++;const X=U?w(A,F):d.m(A,F);try{const Y=yield X;delete S.abortController,S.state="completed",Y.data instanceof HTMLImageElement||d.b(Y.data)?I(Y):Y.data&&I({data:yield(W=Y.data,typeof createImageBitmap=="function"?d.f(W):d.h(W)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete S.abortController,R(Y)}finally{a--,v()}var W})),v=()=>{const S=(()=>{for(const A of Object.keys(h))if(h[A]())return!0;return!1})()?d.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=a;A<S&&t.length>0;A++){const z=t.shift();z.abortController.signal.aborted?A--:_(z)}},w=(S,A)=>new Promise(((z,R)=>{const I=new Image,F=S.url,U=S.credentials;U&&U==="include"?I.crossOrigin="use-credentials":(U&&U==="same-origin"||!d.d(F))&&(I.crossOrigin="anonymous"),A.signal.addEventListener("abort",(()=>{I.src="",R(new d.a(A.signal.reason))})),I.fetchPriority="high",I.onload=()=>{I.onerror=I.onload=null,z({data:I})},I.onerror=()=>{I.onerror=I.onload=null,A.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},I.src=F}))})(gt||(gt={})),gt.resetRequestQueue();class Vt{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function ti(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const a=[];for(const{id:l,url:h}of m){const _=`${l}${h}`;a.indexOf(_)===-1&&(a.push(_),t.push({id:l,url:h}))}}return t}function hi(m,t,a){try{const l=new URL(m);return l.pathname+=`${t}${a}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function si(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class Jt extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:l}of this.requestors)l(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const l=a.spriteData;a.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let l=!0;const h=a.data||a.spriteData;return this._validateStretch(a.stretchX,h&&h.width)||(this.fire(new d.k(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(a.stretchY,h&&h.height)||(this.fire(new d.k(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(a.content,a)||(this.fire(new d.k(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,a){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||a<h[1])return!1;l=h[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const l=a.spriteData,h=l&&l.width||a.data.width,_=l&&l.height||a.data.height;return!(t[0]<0||h<t[0]||t[1]<0||_<t[1]||t[2]<0||h<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==a.data.width||h.data.height!==a.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=h.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,l)=>{let h=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(h=!1);this.isLoaded()||h?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const l of t){let h=this.getImage(l);h||(this.fire(new d.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?a[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],l=this.getImage(t);if(!l)return null;if(a&&a.position.version===l.version)return a.position;if(a)a.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},_=new d.I(h,l);this.patterns[t]={bin:h,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:a,h:l}=d.p(t),h=this.atlasImage;h.resize({width:a||1,height:l||1});for(const _ in this.patterns){const{bin:v}=this.patterns[_],w=v.x+1,S=v.y+1,A=this.getImage(_).data,z=A.width,R=A.height;d.R.copy(A,h,{x:0,y:0},{x:w,y:S},{width:z,height:R}),d.R.copy(A,h,{x:0,y:R-1},{x:w,y:S-1},{width:z,height:1}),d.R.copy(A,h,{x:0,y:0},{x:w,y:S+R},{width:z,height:1}),d.R.copy(A,h,{x:z-1,y:0},{x:w-1,y:S},{width:1,height:R}),d.R.copy(A,h,{x:0,y:0},{x:w+z,y:S},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const l=this.getImage(a);l||d.w(`Image with ID: "${a}" was not found`),si(l)&&this.updateImage(a,l)}}cloneImages(){const t={};for(const a in this.images){const l=this.images[a];t[a]=Object.assign(Object.assign({},l),{data:l.data?l.data.clone():null})}return t}}const di=1e20;function an(m,t,a,l,h,_,v,w,S){for(let A=t;A<t+l;A++)fn(m,a*_+A,_,h,v,w,S);for(let A=a;A<a+h;A++)fn(m,A*_+t,1,l,v,w,S)}function fn(m,t,a,l,h,_,v){_[0]=0,v[0]=-di,v[1]=di,h[0]=m[t];for(let w=1,S=0,A=0;w<l;w++){h[w]=m[t+w*a];const z=w*w;do{const R=_[S];A=(h[w]-h[R]+z-R*R)/(w-R)/2}while(A<=v[S]&&--S>-1);S++,_[S]=w,v[S]=A,v[S+1]=di}for(let w=0,S=0;w<l;w++){for(;v[S+1]<w;)S++;const A=_[S],z=w-A;m[t+w*a]=h[A]+z*z}}const qe=d.v.layout_symbol["text-font"].default.join(",");class We{constructor(t,a,l){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=l}setURL(t){this.url=t}getGlyphs(t){return d._(this,void 0,void 0,(function*(){const a=[];for(const _ in t)for(const v of t[_])a.push(this._getAndCacheGlyphsPromise(_,v));const l=yield Promise.all(a),h={};for(const{stack:_,id:v,glyph:w}of l)h[_]||(h[_]={}),h[_][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return h}))}_getAndCacheGlyphsPromise(t,a){return d._(this,void 0,void 0,(function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[a];return h!==void 0?{stack:t,id:a,glyph:h}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(h=l.glyphs[a]=this._drawGlyph(l,t,a),{stack:t,id:a,glyph:h}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return d._(this,void 0,void 0,(function*(){const l=this.entries[t],h=Math.floor(a/256);if(l.ranges[h])return{stack:t,id:a,glyph:null};if(!l.requests[h]){const _=We.loadGlyphRange(t,h,this.url,this.requestManager);l.requests[h]=_}try{const _=yield l.requests[h];for(const v in _)l.glyphs[+v]=_[+v];return l.ranges[h]=!0,{stack:t,id:a,glyph:_[a]||null}}catch(_){const v=l.glyphs[a]=this._drawGlyph(l,t,a);return this._warnOnMissingGlyphRange(v,h,a,_),{stack:t,id:a,glyph:v}}}))}_warnOnMissingGlyphRange(t,a,l,h){const _=256*a,v=_+255,w=l.toString(16).padStart(4,"0").toUpperCase();d.w(`Unable to load glyph range ${a}, ${_}-${v}. Rendering codepoint U+${w} locally instead. ${h}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&d.q(t)}_drawGlyph(t,a,l){const h=a===qe&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(l),_=h?"ideographTinySDF":"tinySDF";t[_]||(t[_]=this._createTinySDF(h?this.localIdeographFontFamily:a));const v=t[_].draw(String.fromCodePoint(l));return{id:l,bitmap:new d.r({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const l=a.map((h=>/[-\w]+/.test(h)?h:`'${CSS.escape(h)}'`)).join(",");return new We.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let l;for(const[h,_]of Object.entries(a))new RegExp(`\\b${h}\\b`,"i").test(t)&&(l=`${_}`);return l}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}We.loadGlyphRange=function(m,t,a,l){return d._(this,void 0,void 0,(function*(){const h=256*t,_=h+255,v=l.transformRequest(a.replace("{fontstack}",m).replace("{range}",`${h}-${_}`),"Glyphs"),w=yield d.n(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${_}`);const S={};for(const A of d.o(w.data))S[A.id]=A;return S}))},We.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:a=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:_="normal",fontStyle:v="normal",lang:w=null}={}){this.buffer=t,this.cutoff=l,this.radius=a,this.lang=w;const S=this.size=m+4*t,A=this._createCanvas(S),z=this.ctx=A.getContext("2d",{willReadFrequently:!0});z.font=`${v} ${_} ${m}px ${h}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:_}=this.ctx.measureText(m),v=Math.ceil(a),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-h))),S=Math.min(this.size-this.buffer,v+Math.ceil(l)),A=w+2*this.buffer,z=S+2*this.buffer,R=Math.max(A*z,0),I=new Uint8ClampedArray(R),F={data:I,width:A,height:z,glyphWidth:w,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(w===0||S===0)return F;const{ctx:U,buffer:X,gridInner:W,gridOuter:Y}=this;this.lang&&(U.lang=this.lang),U.clearRect(X,X,w,S),U.fillText(m,X,X+v);const Q=U.getImageData(X,X,w,S);Y.fill(di,0,R),W.fill(0,0,R);for(let ne=0;ne<S;ne++)for(let K=0;K<w;K++){const se=Q.data[4*(ne*w+K)+3]/255;if(se===0)continue;const ue=(ne+X)*A+K+X;if(se===1)Y[ue]=0,W[ue]=di;else{const te=.5-se;Y[ue]=te>0?te*te:0,W[ue]=te<0?te*te:0}}an(Y,0,0,A,z,A,this.f,this.v,this.z),an(W,X,X,w,S,A,this.f,this.v,this.z);for(let ne=0;ne<R;ne++){const K=Math.sqrt(Y[ne])-Math.sqrt(W[ne]);I[ne]=Math.round(255-255*(K/this.radius+this.cutoff))}return F}};class pt{constructor(){this.specification=d.u.light.position}possiblyEvaluate(t,a){return d.F(t.expression.evaluate(a))}interpolate(t,a,l){return{x:d.G.number(t.x,a.x,l),y:d.G.number(t.y,a.y,l),z:d.G.number(t.z,a.z,l)}}}let Ve;class St extends d.E{constructor(t){super(),Ve=Ve||new d.t({anchor:new d.D(d.u.light.anchor),position:new pt,color:new d.D(d.u.light.color),intensity:new d.D(d.u.light.intensity)}),this._transitionable=new d.x(Ve,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(d.y,t,a))for(const l in t){const h=t[l];l.endsWith(d.z)?this._transitionable.setTransition(l.slice(0,-d.z.length),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,l){return(!l||l.validate!==!1)&&d.B(this,t.call(d.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.u}))}}const le=new d.t({"sky-color":new d.D(d.u.sky["sky-color"]),"horizon-color":new d.D(d.u.sky["horizon-color"]),"fog-color":new d.D(d.u.sky["fog-color"]),"fog-ground-blend":new d.D(d.u.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.u.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.u.sky["atmosphere-blend"])});class ze extends d.E{constructor(t){super(),this._transitionable=new d.x(le,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.H(0))}setSky(t,a={}){if(!this._validate(d.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in t){const h=t[l];l.endsWith(d.z)?this._transitionable.setTransition(l.slice(0,-d.z.length),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,l={}){return l?.validate!==!1&&d.B(this,t.call(d.C,d.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class it{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const l=t.join(",")+String(a);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,a)),this.dashEntry[l]}getDashRanges(t,a,l){const h=[];let _=t.length%2==1?-t[t.length-1]*l:0,v=t[0]*l,w=!0;h.push({left:_,right:v,isDash:w,zeroLength:t[0]===0});let S=t[0];for(let A=1;A<t.length;A++){w=!w;const z=t[A];_=S*l,S+=z,v=S*l,h.push({left:_,right:v,isDash:w,zeroLength:z===0})}return h}addRoundDash(t,a,l){const h=a/2;for(let _=-l;_<=l;_++){const v=this.width*(this.nextRow+l+_);let w=0,S=t[w];for(let A=0;A<this.width;A++){A/S.right>1&&(S=t[++w]);const z=Math.abs(A-S.left),R=Math.abs(A-S.right),I=Math.min(z,R);let F;const U=_/l*(h+1);if(S.isDash){const X=h-Math.abs(U);F=Math.sqrt(I*I+X*X)}else F=h-Math.sqrt(I*I+U*U);this.data[v+A]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const S=t[w],A=t[w+1];S.zeroLength?t.splice(w,1):A&&A.isDash===S.isDash&&(A.left=S.left,t.splice(w,1))}const a=t[0],l=t[t.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const h=this.width*this.nextRow;let _=0,v=t[_];for(let w=0;w<this.width;w++){w/v.right>1&&(v=t[++_]);const S=Math.abs(w-v.left),A=Math.abs(w-v.right),z=Math.min(S,A);this.data[h+w]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(t,a){const l=a?7:0,h=2*l+1;if(this.nextRow+h>this.height)return d.w("LineAtlas out of space"),null;let _=0;for(let w=0;w<t.length;w++)_+=t[w];if(_!==0){const w=this.width/_,S=this.getDashRanges(t,this.width,w);a?this.addRoundDash(S,w,l):this.addRegularDash(S)}const v={y:this.nextRow+l,height:2*l,width:_};return this.nextRow+=h,this.dirty=!0,v}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Ue="maplibre_preloaded_worker_pool";class yt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<yt.workerCount;)this.workers.push(new Worker(d.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ue]}numActive(){return Object.keys(this.active).length}}const kt=Math.floor(ct.hardwareConcurrency/2);let Nt,yi;function Ai(){return Nt||(Nt=new yt),Nt}yt.workerCount=d.K(globalThis)?Math.max(Math.min(kt,3),1):1;class Jn{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const l=this.workerPool.acquire(a);for(let h=0;h<l.length;h++){const _=new d.L(l[h],a);_.name=`Worker ${h}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:t,data:a}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const l of this.actors)l.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function gr(){return yi||(yi=new Jn(Ai(),d.M),yi.registerMessageHandler("GR",((m,t,a)=>d.m(t,a)))),yi}function hr(m,t){const a=d.N();return d.O(a,a,[1,1,0]),d.Q(a,a,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?d.S(a,a,m.calculatePosMatrix(t.toUnwrapped())):a}function Pa(m,t,a,l,h,_,v){var w;const S=(function(I,F,U){if(I)for(const X of I){const W=F[X];if(W&&W.source===U&&W.type==="fill-extrusion")return!0}else for(const X in F){const W=F[X];if(W.source===U&&W.type==="fill-extrusion")return!0}return!1})((w=h?.layers)!==null&&w!==void 0?w:null,t,m.id),A=_.maxPitchScaleFactor(),z=m.tilesIn(l,A,S);z.sort(Zi);const R=[];for(const I of z)R.push({wrappedTileID:I.tileID.wrapped().key,queryResults:I.tile.queryRenderedFeatures(t,a,m.getState(),I.queryGeometry,I.cameraQueryGeometry,I.scale,h,_,A,hr(_,I.tileID),v?(F,U)=>v(I.tileID,F,U):void 0)});return(function(I,F){for(const U in I)for(const X of I[U])dr(X,F);return I})((function(I){const F={},U={};for(const X of I){const W=X.queryResults,Y=X.wrappedTileID,Q=U[Y]=U[Y]||{};for(const ne in W){const K=W[ne],se=Q[ne]=Q[ne]||{},ue=F[ne]=F[ne]||[];for(const te of K)se[te.featureIndex]||(se[te.featureIndex]=!0,ue.push(te))}}return F})(R),m)}function Zi(m,t){const a=m.tileID,l=t.tileID;return a.overscaledZ-l.overscaledZ||a.canonical.y-l.canonical.y||a.wrap-l.wrap||a.canonical.x-l.canonical.x}function dr(m,t){const a=m.feature,l=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=l}function _r(m,t,a){return d._(this,void 0,void 0,(function*(){let l=m;if(m.url?l=(yield d.j(t.transformRequest(m.url,"Source"),a)).data:yield ct.frameAsync(a),!l)return null;const h=d.U(d.e(l,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map((_=>_.id))),h}))}class pn{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof d.V?new d.V(t.lng,t.lat):d.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof d.V?new d.V(t.lng,t.lat):d.V.convert(t),this}extend(t){const a=this._sw,l=this._ne;let h,_;if(t instanceof d.V)h=t,_=t;else{if(!(t instanceof pn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(pn.convert(t)):this.extend(d.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(d.V.convert(t)):this;if(h=t._sw,_=t._ne,!h||!_)return this}return a||l?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),l.lng=Math.max(_.lng,l.lng),l.lat=Math.max(_.lat,l.lat)):(this._sw=new d.V(h.lng,h.lat),this._ne=new d.V(_.lng,_.lat)),this}getCenter(){return new d.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.V(this.getWest(),this.getNorth())}getSouthEast(){return new d.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:l}=d.V.convert(t);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}intersects(t){if(!((t=pn.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=d.W(this.getWest(),-180,180),l=d.W(this.getEast(),-180,180),h=d.W(t.getWest(),-180,180),_=d.W(t.getEast(),-180,180),v=a>=l,w=h>=_;return!(!v||!w)||(v?_>=a||h<=l:w?l>=h||a<=_:h<=l&&_>=a)}static convert(t){return t instanceof pn?t:t&&new pn(t)}static fromLngLat(t,a=0){const l=360*a/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new pn(new d.V(t.lng-h,t.lat-l),new d.V(t.lng+h,t.lat+l))}adjustAntiMeridian(){const t=new d.V(this._sw.lng,this._sw.lat),a=new d.V(this._ne.lng,this._ne.lat);return new pn(t,t.lng>a.lng?new d.V(a.lng+360,a.lat):a)}}class xs{constructor(t,a,l){this.bounds=pn.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),l=Math.floor(d.Y(this.bounds.getWest())*a),h=Math.floor(d.X(this.bounds.getNorth())*a),_=Math.ceil(d.Y(this.bounds.getEast())*a),v=Math.ceil(d.X(this.bounds.getSouth())*a);return t.x>=l&&t.x<_&&t.y>=h&&t.y<v}}class bs extends d.E{constructor(t,a,l,h){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=d.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield _r(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(d.e(this,t),t.bounds&&(this.tileBounds=new xs(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,d.Z(t)||this.fire(new d.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(t){return d._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((_,v)=>{t.reloadPromise={resolve:_,reject:v}}))}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{const _=yield t.actor.sendAsync({type:h,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,_)}catch(_){if(delete t.abortController,t.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,l=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(l,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return d._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Xs extends d.E{constructor(t,a,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},a),d.e(this,d.U(a,["url","scheme","tileSize"]))}load(){return d._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield _r(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(d.e(this,a),a.bounds&&(this.tileBounds=new xs(a.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,d.Z(a)||this.fire(new d.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return d.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return d._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield gt.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,_=h.gl,v=l.data;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new d.T(h,v,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}}))}abortTile(t){return d._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Wa extends Xs{constructor(t,a,l,h){super(t,a,l,h),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return d._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield gt.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const _=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const v=d.b(_)&&d.$()?_:yield this.readImageNow(_),w={type:this.type,uid:t.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const S=yield t.actor.sendAsync({type:"LDT",data:w});t.dem=S,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}}))}readImageNow(t){return d._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&d.a0()){const a=t.width+2,l=t.height+2;try{return new d.R({width:a,height:l},yield d.a1(t,-1,-1,a,l))}catch{}}return ct.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,l=Math.pow(2,a.z),h=(a.x-1+l)%l,_=a.x===0?t.wrap-1:t.wrap,v=(a.x+1+l)%l,w=a.x+1===l?t.wrap+1:t.wrap,S={};return S[new d.a2(t.overscaledZ,_,a.z,h,a.y).key]={backfilled:!1},S[new d.a2(t.overscaledZ,w,a.z,v,a.y).key]={backfilled:!1},a.y>0&&(S[new d.a2(t.overscaledZ,_,a.z,h,a.y-1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,w,a.z,v,a.y-1).key]={backfilled:!1}),a.y+1<l&&(S[new d.a2(t.overscaledZ,_,a.z,h,a.y+1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,w,a.z,v,a.y+1).key]={backfilled:!1}),S}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Ia(m){return m.type==="GeometryCollection"?m.geometries.map((t=>t.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function gl(m){const t=new pn;let a;switch(m.type){case"FeatureCollection":a=m.features.map((l=>Ia(l.geometry))).flat(1/0);break;case"Feature":a=Ia(m.geometry);break;default:a=Ia(m)}if(a.length==0)return t;for(let l=0;l<a.length-1;l+=2)t.extend([a[l],a[l+1]]);return t}class er extends d.E{constructor(t,a,l,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=l.getActor(),this.setEventedParent(h),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=d.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:d.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:d.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(d.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||d.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return d._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const l=this._updateWorkerData();return a?l:this}updateData(t,a){this._pendingWorkerUpdate.diff=d.a6(this._pendingWorkerUpdate.diff,t);const l=this._updateWorkerData();return a?l:this}getData(){return d._(this,void 0,void 0,(function*(){const t=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return d._(this,void 0,void 0,(function*(){return gl(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:l}})}_updateWorkerData(){return d._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void d.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,l=d.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(l.request=this.map._requestManager.transformRequest(ct.resolveURL(t),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=t,this._pendingWorkerUpdate.data=void 0):a&&(l.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new d.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new d.l("dataabort",{dataType:"source"}));a&&this._applyDiff(a);let _=null;h.resourceTiming&&h.resourceTiming[this.id]&&(_=h.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&d.e(v,{resourceTiming:_}),this.fire(new d.l("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new d.l("data",Object.assign(Object.assign({},v),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(a)})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new d.l("dataabort",{dataType:"source"}));this.fire(new d.k(h))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiff(t){const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){if(!d.a7(this._data.geojson,a))throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:d.a8(this._data.geojson,a)}}this._data.updateable&&d.a9(this._data.updateable,t,a)}_getShouldReloadTileOptions(t){if(this._options.cluster||!t||t.removeAll)return;const{add:a=[],update:l=[],remove:h=[]}=t||{},_=new Set([...l.map((v=>v.id)),...h]);for(const v of _.values())if(typeof v!="number"&&this.promoteId==null)return void d.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs. Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...l.map((v=>v.newGeometry)),...a.map((v=>v.geometry))].filter(Boolean).map((v=>gl(v))),prevIds:_}}shouldReloadTile(t,{nextBounds:a,prevIds:l}){if(!t.latestFeatureIndex)return t.state!=="unloaded";const h=t.latestFeatureIndex.loadVTLayers();for(let S=0;S<t.latestFeatureIndex.featureIndexArray.length;S++){const A=t.latestFeatureIndex.featureIndexArray.get(S),z=h[d.aa].feature(A.featureIndex),R=t.latestFeatureIndex.getId(z,d.aa);if(l.has(R))return!0}const{buffer:_,extent:v}=this.workerOptions.geojsonVtOptions,w=(function({x:S,y:A,z},R=0){const I=d.a3((S-R)/Math.pow(2,z)),F=d.a4((A+1+R)/Math.pow(2,z)),U=d.a3((S+1+R)/Math.pow(2,z)),X=d.a4((A-R)/Math.pow(2,z));return new pn([I,F],[U,X])})(t.tileID.canonical,_/v);for(const S of a)if(w.intersects(S))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return d._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:a,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,a==="RT")}))}abortTile(t){return d._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Vr extends d.E{constructor(t,a,l,h){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=l,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=a}load(t){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield gt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,d.Z(a)||this.fire(new d.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(d.ab.fromLngLat);var l;return this.tileID=(function(h){const _=d.ac.fromPoints(h),v=_.width(),w=_.height(),S=Math.max(v,w),A=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),z=Math.pow(2,A);return new d.ae(A,Math.floor((_.minX+_.maxX)/2*z),Math.floor((_.minY+_.maxY)/2*z))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((h=>this.tileID.getTilePoint(h)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new d.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return d._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:l,maxX:h,maxY:_}=d.ac.fromPoints(t),v={};for(let w=0;w<=d.ad;w++){const S=Math.pow(2,w),A=Math.floor(a*S),z=Math.floor(l*S),R=Math.floor(h*S),I=Math.floor(_*S);v[w]={minTileX:A,minTileY:z,maxTileX:R,maxTileY:I}}return v}}class xe extends Vr{constructor(t,a,l,h){super(t,a,l,h),this.roundZoom=!0,this.type="video",this.options=a}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield d.af(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new d.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new d.k(new d.ag(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class V extends Vr{constructor(t,a,l,h){super(t,a,l,h),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((_=>!Array.isArray(_)||_.length!==2||_.some((v=>typeof v!="number"))))||this.fire(new d.k(new d.ag(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.k(new d.ag(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new d.k(new d.ag(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new d.k(new d.ag(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.k(new d.ag(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,l=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new d.T(a,this.canvas,l.RGBA,{premultiply:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let h=!1;for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,h=!0)}h&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const j={},H=m=>{switch(m){case"geojson":return er;case"image":return Vr;case"raster":return Xs;case"raster-dem":return Wa;case"vector":return bs;case"video":return xe;case"canvas":return V}return j[m]},oe="RTLPluginLoaded";class ce extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=gr()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return d._(this,arguments,void 0,(function*(a,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ct.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return d._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.l(oe))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Se=null;function ye(){return Se||(Se=new ce),Se}var fe,Me;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(fe||(fe={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})(Me||(Me={}));class Ze{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=d.ah(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:l,fadeEndTime:h}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=l,this.fadeEndTime=h}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=rt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(h,_){const v={};if(!_)return v;for(const w of h){const S=w.layerIds.map((A=>_.getLayer(A))).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map((A=>S.filter((z=>z.id===A))[0])));for(const A of S)v[A.id]=w}}return v})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof d.aj){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof d.aj&&_.hasRTLText){this.hasRTLText=!0,ye().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const _=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(h).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new d.ai}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new d.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new d.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,l,h,_,v,w,S,A,z,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:_,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:S,params:w,queryPadding:this.queryPadding*A,getElevation:R},t,a,l):{}}querySourceFeatures(t,a){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),_=a&&a.sourceLayer?a.sourceLayer:"",v=h[d.aa]||h[_];if(!v)return;const w=d.ak(a?.filter,a?.globalState),{z:S,x:A,y:z}=this.tileID.canonical,R={z:S,x:A,y:z};for(let I=0;I<v.length;I++){const F=v.feature(I);if(w.needGeometry){const W=d.al(F,!0);if(!w.filter(new d.H(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!w.filter(new d.H(this.tileID.overscaledZ),F))continue;const U=l.getId(F,_),X=new d.am(F,S,A,z,U);X.tile=R,t.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const l=d.an(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(a)if(this.expirationTime<a)h=!0;else{const _=this.expirationTime-a;_?this.expirationTime=l+Math.max(_,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!a.style.hasLayer(h))continue;const _=this.buckets[h],v=_.layers[0].sourceLayer||d.aa,w=l[v],S=t[v];if(!w||!S||Object.keys(S).length===0)continue;_.update(S,w,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const A=a&&a.style&&a.style.getLayer(h);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(_)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<rt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=rt()+t}setDependencies(t,a){const l={};for(const h of a)l[h]=!0;this.dependencies[t]=l}hasDependency(t,a){for(const l of t){const h=this.dependencies[l];if(h){for(const _ of a)if(h[_])return!0}}return!1}}class $e{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,l){const h=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},d.e(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==h&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const _ in this.state[t][h])l[_]||(this.deletedStates[t][h][_]=null)}else for(const _ in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][_]===null&&delete this.deletedStates[t][h][_]}removeFeatureState(t,a,l){if(this.deletedStates[t]===null)return;const h=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&a!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,a){const l=String(a),h=d.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][a];if(_===null)return{};for(const v in _)delete h[v]}return h}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const _={};for(const v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),d.e(this.state[h][v],this.stateChanges[h][v]),_[v]=this.state[h][v];l[h]=_}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const _={};if(this.deletedStates[h]===null)for(const v in this.state[h])_[v]={},this.state[h][v]={};else for(const v in this.deletedStates[h]){if(this.deletedStates[h][v]===null)this.state[h][v]={};else for(const w of Object.keys(this.deletedStates[h][v]))delete this.state[h][v][w];_[v]=this.state[h][v]}l[h]=l[h]||{},d.e(l[h],_)}this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0&&t.setFeatureState(l,a)}}const bt=89.25;function Pt(m,t){const a=d.ao(t.lat,-d.ap,d.ap);return new d.P(d.Y(t.lng)*m,d.X(a)*m)}function Gt(m,t){return new d.ab(t.x/m,t.y/m).toLngLat()}function Ti(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(d.aq(90-m.pitch)),Math.tan(d.aq(bt-m.pitch)))}function fi(m,t){const a=m.canonical,l=t/d.ar(a.z),h=a.x+Math.pow(2,a.z)*m.wrap,_=d.as(new Float64Array(16));return d.O(_,_,[h*l,a.y*l,0]),d.Q(_,_,[l/d.a5,l/d.a5,1]),_}function be(m,t,a,l,h){const _=d.ab.fromLngLat(m,t),v=h*d.at(1,m.lat),{x:w,y:S,z:A}=Ci(a,l);return new d.ab(_.x+v*-w,_.y+v*-S,_.z+v*-A)}function Ci(m,t){const a=d.aq(m),l=d.aq(t),h=Math.cos(-a),_=Math.sin(a);return{x:_*Math.sin(l),y:-_*Math.cos(l),z:h}}function zn(m,t,a){const l=t.intersectsFrustum(m);if(!a||l===0)return l;const h=t.intersectsPlane(a);return h===0?0:l===2&&h===2?2:1}function Ht(m,t,a){let l=0;const h=(a-t)/10;for(let _=0;_<10;_++)l+=h*Math.pow(Math.cos(t+(_+.5)/10*(a-t)),m);return l}function zi(m,t){return function(a,l,h,_,v){const w=2*((m-1)/d.au(Math.cos(d.aq(bt-v))/Math.cos(d.aq(bt)))-1),S=Math.acos(h/_),A=2*Ht(w-1,0,d.aq(v/2)),z=Math.min(d.aq(bt),S+d.aq(v/2)),R=Ht(w-1,Math.min(z,S-d.aq(v/2)),z),I=Math.atan(l/h),F=Math.hypot(l,h);let U=a;return U+=d.au(_/F/Math.max(.5,Math.cos(d.aq(v/2)))),U+=w*d.au(Math.cos(I))/2,U-=d.au(Math.max(1,R/A/t))/2,U}}const Xn=zi(9.314,3);function Di(m,t){const a=(t.roundZoom?Math.round:Math.floor)(m.zoom+d.au(m.tileSize/t.tileSize));return Math.max(0,a)}function Tn(m,t){const a=m.getCameraFrustum(),l=m.getClippingPlane(),h=m.screenPointToMercatorCoordinate(m.getCameraPoint()),_=d.ab.fromLngLat(m.center,m.elevation);h.z=_.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const v=m.getCoveringTilesDetailsProvider(),w=v.allowVariableZoom(m,t),S=Di(m,t),A=t.minzoom||0,z=t.maxzoom!==void 0?t.maxzoom:m.maxZoom,R=Math.min(Math.max(0,S),z),I=Math.pow(2,R),F=[I*h.x,I*h.y,0],U=[I*_.x,I*_.y,0],X=Math.hypot(_.x-h.x,_.y-h.y),W=Math.abs(_.z-h.z),Y=Math.hypot(X,W),Q=se=>({zoom:0,x:0,y:0,wrap:se,fullyVisible:!1}),ne=[],K=[];if(m.renderWorldCopies&&v.allowWorldCopies())for(let se=1;se<=3;se++)ne.push(Q(-se)),ne.push(Q(se));for(ne.push(Q(0));ne.length>0;){const se=ne.pop(),ue=se.x,te=se.y;let me=se.fullyVisible;const Ae={x:ue,y:te,z:se.zoom},we=v.getTileBoundingVolume(Ae,se.wrap,m.elevation,t);if(!me){const lt=zn(a,we,l);if(lt===0)continue;me=lt===2}const Ce=v.distanceToTile2d(h.x,h.y,Ae,we);let De=S;w&&(De=(t.calculateTileZoom||Xn)(m.zoom+d.au(m.tileSize/t.tileSize),Ce,W,Y,m.fov)),De=(t.roundZoom?Math.round:Math.floor)(De),De=Math.max(0,De);const Ke=Math.min(De,z);if(se.wrap=v.getWrap(_,Ae,se.wrap),se.zoom>=Ke){if(se.zoom<A)continue;const lt=R-se.zoom,Ye=F[0]-.5-(ue<<lt),Ct=F[1]-.5-(te<<lt),Zt=t.reparseOverscaled?Math.max(se.zoom,De):se.zoom;K.push({tileID:new d.a2(se.zoom===z?Zt:se.zoom,se.wrap,se.zoom,ue,te),distanceSq:d.av([U[0]-.5-ue,U[1]-.5-te]),tileDistanceToCamera:Math.sqrt(Ye*Ye+Ct*Ct)})}else for(let lt=0;lt<4;lt++)ne.push({zoom:se.zoom+1,x:(ue<<1)+lt%2,y:(te<<1)+(lt>>1),wrap:se.wrap,fullyVisible:me})}return K.sort(((se,ue)=>se.distanceSq-ue.distanceSq)).map((se=>se.tileID))}const Fi=d.ac.fromPoints([new d.P(0,0),new d.P(d.a5,d.a5)]);function Dn(m){return m==="raster"||m==="image"||m==="video"}function _l(m,t,a,l,h,_,v){if(!t.hasData())return!1;const{tileID:w,fadingRole:S,fadingDirection:A,fadingParentID:z}=t;if(S===fe.Base&&A===Me.Incoming&&z)return a[z.key]=z,!0;const R=Math.max(w.overscaledZ-h,_);for(let I=w.overscaledZ-1;I>=R;I--){const F=w.scaledTo(I),U=m.getLoadedTile(F);if(U)return t.setCrossFadeLogic({fadingRole:fe.Base,fadingDirection:Me.Incoming,fadingParentID:U.tileID,fadeEndTime:l+v}),U.setCrossFadeLogic({fadingRole:fe.Parent,fadingDirection:Me.Departing,fadeEndTime:l+v}),a[F.key]=F,!0}return!1}function Ao(m,t,a,l,h,_){if(!t.hasData())return!1;const v=t.tileID.children(h);let w=ot(m,t,v,a,l,h,_);if(w)return!0;for(const S of v)ot(m,t,S.children(h),a,l,h,_)&&(w=!0);return w}function ot(m,t,a,l,h,_,v){if(a[0].overscaledZ>=_)return!1;let w=!1;for(const S of a){const A=m.getLoadedTile(S);if(!A)continue;const{fadingRole:z,fadingDirection:R,fadingParentID:I}=A;z===fe.Base&&R===Me.Departing&&I||(A.setCrossFadeLogic({fadingRole:fe.Base,fadingDirection:Me.Departing,fadingParentID:t.tileID,fadeEndTime:h+v}),t.setCrossFadeLogic({fadingRole:fe.Parent,fadingDirection:Me.Incoming,fadeEndTime:h+v})),l[S.key]=S,w=!0}return w}function yr(m,t,a,l){const h=m.tileID;return!!m.selfFading||!m.hasData()&&!!t.has(h)&&(m.setSelfFadeLogic(a+l),!0)}function vr(m,t){var a;m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let l=t.tileID.canonical.x-m.tileID.canonical.x;const h=t.tileID.canonical.y-m.tileID.canonical.y,_=Math.pow(2,m.tileID.canonical.z),v=t.tileID.key;l===0&&h===0||Math.abs(h)>1||(Math.abs(l)>1&&(Math.abs(l+_)===1?l+=_:Math.abs(l-_)===1&&(l-=_)),t.dem&&m.dem&&(m.dem.backfillBorder(t.dem,l,h),!((a=m.neighboringTiles)===null||a===void 0)&&a[v]&&(m.neighboringTiles[v].backfilled=!0)))}class Ra{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+t),a[h.tileID.key]=h}this._tiles=a}setFeatureState(t,a){for(const l in this._tiles)this._tiles[l].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(d.ax).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var l;return(l=this.getTileById(t))===null||l===void 0?void 0:l.isRenderable(a)}getRenderableIds(t=0,a){const l=[];for(const h of this.getAllIds())this.isIdRenderable(h,a)&&l.push(this.getTileById(h));return a?l.sort(((h,_)=>{const v=h.tileID,w=_.tileID,S=new d.P(v.canonical.x,v.canonical.y)._rotate(-t),A=new d.P(w.canonical.x,w.canonical.y)._rotate(-t);return v.overscaledZ-w.overscaledZ||A.y-S.y||A.x-S.x})).map((h=>h.tileID.key)):l.map((h=>h.tileID)).sort(d.ax).map((h=>h.key))}}class Hi extends d.E{constructor(t,a,l){super(),this.id=t,this.dispatcher=l,this.on("data",(h=>this._dataHandler(h))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((h,_,v,w)=>{const S=new(H(_.type))(h,_,v,w);if(S.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${S.id}`);return S})(t,a,l,this),this._inViewTiles=new Ra,this._outOfViewCache=new d.ay(0,(h=>this._unloadTile(h))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new $e,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Ra}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,l){return d._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,l)}catch(h){t.state="errored",h.status!==404?this._source.fire(new d.k(h,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new d.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const l=this.getLoadedTile(t.scaledTo(a));if(l)return this._inViewTiles.isIdRenderable(l.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const l of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(l);a&&!this._source.shouldReloadTile(h,a)||(t?this._reloadTile(l,"expired"):h.state!=="errored"&&this._reloadTile(l,"reloading"))}}}_reloadTile(t,a){return d._(this,void 0,void 0,(function*(){const l=this._inViewTiles.getTileById(t);l&&(l.state!=="loading"&&(l.state=a),yield this._loadTile(l,t,a))}))}_tileLoaded(t,a,l){t.timeAdded=rt(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(h,_){var v,w;const S=_.getRenderableIds();for(const A of S){if(!h.neighboringTiles||!h.neighboringTiles[A])continue;const z=_.getTileById(A);h.neighboringTiles[A].backfilled||vr(h,z),!((w=(v=z.neighboringTiles)===null||v===void 0?void 0:v[h.tileID.key])===null||w===void 0)&&w.backfilled||vr(z,h)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new d.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const l=this._getLoadedDescendents(a),h=new Set;for(const _ of a){const v=l[_.key];if(!v?.length){h.add(_);continue}const w=_.overscaledZ+Hi.maxOverzooming,S=v.filter((R=>R.tileID.overscaledZ<=w));if(!S.length){h.add(_);continue}const A=Math.min(...S.map((R=>R.tileID.overscaledZ))),z=S.filter((R=>R.tileID.overscaledZ===A)).map((R=>R.tileID));for(const R of z)t[R.key]=R;this._areDescendentsComplete(z,A,_.overscaledZ)||h.add(_)}return h}_getLoadedDescendents(t){var a;const l={};for(const h of this._inViewTiles.getAllTiles().filter((_=>_.hasData())))for(const _ of t)h.tileID.isChildOf(_)&&(l[a=_.key]||(l[a]=[])).push(h);return l}_areDescendentsComplete(t,a,l){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-l)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(a*l*(this._maxTileCacheZoomLevels===null?d.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._outOfViewCache.setMaxSize(_)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((S=>new d.a2(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y))):(l=Tn(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((S=>this._source.hasTile(S))))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const h=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,h&&this.fire(new d.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=Di(t,this._source),v=this._updateRetainedTiles(l,_),w=Dn(this._source.type);w&&this._rasterFadeDuration>0&&!a&&(function(S,A,z,R,I,F,U){const X=rt(),W=d.aw(A);for(const Y of A){const Q=S.getTileById(Y.key);Q.fadingDirection!==Me.Departing&&Q.fadeOpacity!==0||Q.resetFadeLogic(),_l(S,Q,z,X,R,I,U)||Ao(S,Q,z,X,F,U)||yr(Q,W,X,U)||Q.resetFadeLogic()}})(this._inViewTiles,l,v,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),w?this._cleanUpRasterTiles(v):this._cleanUpVectorTiles(v)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(a);t[a]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(a):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const l of t)if(l.canonical.z>this._source.minzoom){const h=l.scaledTo(l.canonical.z-1);a.push(h);const _=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));a.push(_)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var l;const h=new Set;for(const A of t)this._addTile(A).hasData()||h.add(A);const _=t.reduce(((A,z)=>(A[z.key]=z,A)),{}),v=this._retainLoadedChildren(_,h),w={},S=Math.max(a-Hi.maxUnderzooming,this._source.minzoom);for(const A of v){let z=this._inViewTiles.getTileById(A.key),R=z?.wasRequested();for(let I=A.overscaledZ-1;I>=S;--I){const F=A.scaledTo(I);if(w[F.key])break;if(w[F.key]=!0,z=this.getTile(F),!z&&R&&(z=this._addTile(F)),z){const U=z.hasData();if((U||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||R)&&(_[F.key]=F),R=z.wasRequested(),U)break}}}return _}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const l=a;return a||(a=new Ze(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),l||this._source.fire(new d.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const l=a.getExpiryTimeout();l&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),l))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||l.state=="errored")&&t.some((h=>h.equals(l.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,l){const h=[],_=this.transform;if(!_)return h;const v=_.getCoveringTilesDetailsProvider().allowWorldCopies(),w=l?_.getCameraQueryGeometry(t):t,S=F=>_.screenPointToMercatorCoordinate(F,this.terrain),A=this.transformBbox(t,S,!v),z=this.transformBbox(w,S,!v),R=this.getIds(),I=d.ac.fromPoints(z);for(let F=0;F<R.length;F++){const U=this._inViewTiles.getTileById(R[F]);if(U.holdingForSymbolFade())continue;const X=v?[U.tileID]:[U.tileID.unwrapTo(-1),U.tileID.unwrapTo(0)],W=Math.pow(2,_.zoom-U.tileID.overscaledZ),Y=a*U.queryPadding*d.a5/U.tileSize/W;for(const Q of X){const ne=I.map((K=>Q.getTilePoint(new d.ab(K.x,K.y))));if(ne.expandBy(Y),ne.intersects(Fi)){const K=A.map((ue=>Q.getTilePoint(ue))),se=z.map((ue=>Q.getTilePoint(ue)));h.push({tile:U,tileID:v?Q:Q.unwrapTo(0),queryGeometry:K,cameraQueryGeometry:se,scale:W})}}}return h}transformBbox(t,a,l){let h=t.map(a);if(l){const _=d.ac.fromPoints(t);_.shrinkBy(.001*Math.min(_.width(),_.height()));const v=_.map(a);d.ac.fromPoints(h).covers(v)||(h=h.map((w=>w.x>.5?new d.ab(w.x-1,w.y,w.z):w)))}return h}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((l=>this._inViewTiles.getTileById(l).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!Dn(this._source.type)||!(function(t,a){if(a<=0)return!1;const l=rt();for(const h of t.getAllTiles())if(h.fadeEndTime>=l)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,l){this._state.updateState(t=t||d.aa,a,l)}removeFeatureState(t,a,l){this._state.removeFeatureState(t=t||d.aa,a,l)}getFeatureState(t,a){return this._state.getState(t=t||d.aa,a)}setDependencies(t,a,l){const h=this._inViewTiles.getTileById(t);h&&h.setDependencies(a,l)}reloadTilesForDependencies(t,a){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).hasDependency(t,a)&&this._reloadTile(l,"reloading");this._outOfViewCache.filter((l=>!l.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Hi.maxUnderzooming=10,Hi.maxOverzooming=3;class ht{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=d.ao(t,0,1);let a=1,l=this._distances[a];const h=t*this.paddedLength+this.padding;for(;l<h&&a<this._distances.length;)l=this._distances[++a];const _=a-1,v=this._distances[_],w=l-v,S=w>0?(h-v)/w:0;return this.points[_].mult(1-S).add(this.points[a].mult(S))}}function Xt(m,t){let a=!0;return m==="always"||m!=="never"&&t!=="never"||(a=!1),a}class Qt{constructor(t,a,l){const h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(a/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,l,h,_){this._forEachCell(a,l,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(_)}insertCircle(t,a,l,h){this._forEachCell(a-h,l-h,a+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,a,l,h,_,v){this.boxCells[_].push(v)}_insertCircleCell(t,a,l,h,_,v){this.circleCells[_].push(v)}_query(t,a,l,h,_,v,w){if(l<0||t>this.width||h<0||a>this.height)return[];const S=[];if(t<=0&&a<=0&&this.width<=l&&this.height<=h){if(_)return[{key:null,x1:t,y1:a,x2:l,y2:h}];for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const z=this.circles[3*A],R=this.circles[3*A+1],I=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:z-I,y1:R-I,x2:z+I,y2:R+I})}}else this._forEachCell(t,a,l,h,this._queryCell,S,{hitTest:_,overlapMode:v,seenUids:{box:{},circle:{}}},w);return S}query(t,a,l,h){return this._query(t,a,l,h,!1,null)}hitTest(t,a,l,h,_,v){return this._query(t,a,l,h,!0,_,v).length>0}hitTestCircle(t,a,l,h,_){const v=t-l,w=t+l,S=a-l,A=a+l;if(w<0||v>this.width||A<0||S>this.height)return!1;const z=[];return this._forEachCell(v,S,w,A,this._queryCellCircle,z,{hitTest:!0,overlapMode:h,circle:{x:t,y:a,radius:l},seenUids:{box:{},circle:{}}},_),z.length>0}_queryCell(t,a,l,h,_,v,w,S){const{seenUids:A,hitTest:z,overlapMode:R}=w,I=this.boxCells[_];if(I!==null){const U=this.bboxes;for(const X of I)if(!A.box[X]){A.box[X]=!0;const W=4*X,Y=this.boxKeys[X];if(t<=U[W+2]&&a<=U[W+3]&&l>=U[W+0]&&h>=U[W+1]&&(!S||S(Y))&&(!z||!Xt(R,Y.overlapMode))&&(v.push({key:Y,x1:U[W],y1:U[W+1],x2:U[W+2],y2:U[W+3]}),z))return!0}}const F=this.circleCells[_];if(F!==null){const U=this.circles;for(const X of F)if(!A.circle[X]){A.circle[X]=!0;const W=3*X,Y=this.circleKeys[X];if(this._circleAndRectCollide(U[W],U[W+1],U[W+2],t,a,l,h)&&(!S||S(Y))&&(!z||!Xt(R,Y.overlapMode))){const Q=U[W],ne=U[W+1],K=U[W+2];if(v.push({key:Y,x1:Q-K,y1:ne-K,x2:Q+K,y2:ne+K}),z)return!0}}}return!1}_queryCellCircle(t,a,l,h,_,v,w,S){const{circle:A,seenUids:z,overlapMode:R}=w,I=this.boxCells[_];if(I!==null){const U=this.bboxes;for(const X of I)if(!z.box[X]){z.box[X]=!0;const W=4*X,Y=this.boxKeys[X];if(this._circleAndRectCollide(A.x,A.y,A.radius,U[W+0],U[W+1],U[W+2],U[W+3])&&(!S||S(Y))&&!Xt(R,Y.overlapMode))return v.push(!0),!0}}const F=this.circleCells[_];if(F!==null){const U=this.circles;for(const X of F)if(!z.circle[X]){z.circle[X]=!0;const W=3*X,Y=this.circleKeys[X];if(this._circlesCollide(U[W],U[W+1],U[W+2],A.x,A.y,A.radius)&&(!S||S(Y))&&!Xt(R,Y.overlapMode))return v.push(!0),!0}}}_forEachCell(t,a,l,h,_,v,w,S){const A=this._convertToXCellCoord(t),z=this._convertToYCellCoord(a),R=this._convertToXCellCoord(l),I=this._convertToYCellCoord(h);for(let F=A;F<=R;F++)for(let U=z;U<=I;U++)if(_.call(this,t,a,l,h,this.xCellCount*U+F,v,w,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,l,h,_,v){const w=h-t,S=_-a,A=l+v;return A*A>w*w+S*S}_circleAndRectCollide(t,a,l,h,_,v,w){const S=(v-h)/2,A=Math.abs(t-(h+S));if(A>S+l)return!1;const z=(w-_)/2,R=Math.abs(a-(_+z));if(R>z+l)return!1;if(A<=S||R<=z)return!0;const I=A-S,F=R-z;return I*I+F*F<=l*l}}function ea(m,t,a){const l=d.N();if(!m){const{vecSouth:R,vecEast:I}=Qa(t),F=_e();F[0]=I[0],F[1]=I[1],F[2]=R[0],F[3]=R[1],h=F,(z=(v=(_=F)[0])*(A=_[3])-(S=_[2])*(w=_[1]))&&(h[0]=A*(z=1/z),h[1]=-w*z,h[2]=-S*z,h[3]=v*z),l[0]=F[0],l[1]=F[1],l[4]=F[2],l[5]=F[3]}var h,_,v,w,S,A,z;return d.Q(l,l,[1/a,1/a,1]),l}function oc(m,t,a,l){if(m){const h=d.N();if(!t){const{vecSouth:_,vecEast:v}=Qa(a);h[0]=v[0],h[1]=v[1],h[4]=_[0],h[5]=_[1]}return d.Q(h,h,[l,l,1]),h}return a.pixelsToClipSpaceMatrix}function Qa(m){const t=Math.cos(m.rollInRadians),a=Math.sin(m.rollInRadians),l=Math.cos(m.pitchInRadians),h=Math.cos(m.bearingInRadians),_=Math.sin(m.bearingInRadians),v=d.aD();v[0]=-h*l*a-_*t,v[1]=-_*l*a+h*t;const w=d.aE(v);w<1e-9?d.aF(v):d.aG(v,v,1/w);const S=d.aD();S[0]=h*l*t-_*a,S[1]=_*l*t+h*a;const A=d.aE(S);return A<1e-9?d.aF(S):d.aG(S,S,1/A),{vecEast:S,vecSouth:v}}function $t(m,t,a,l){let h;l?(h=[m,t,l(m,t),1],d.aI(h,h,a)):(h=[m,t,0,1],_a(h,h,a));const _=h[3];return{point:new d.P(h[0]/_,h[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function Co(m,t){return .5+m/t*.5}function Ka(m,t){return m.x>=-t[0]&&m.x<=t[0]&&m.y>=-t[1]&&m.y<=t[1]}function ws(m,t,a,l,h,_,v,w,S,A,z,R,I){const F=a?m.textSizeData:m.iconSizeData,U=d.az(F,t.transform.zoom),X=[256/t.width*2+1,256/t.height*2+1],W=a?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;W.clear();const Y=m.lineVertexArray,Q=a?m.text.placedSymbolArray:m.icon.placedSymbolArray,ne=t.transform.width/t.transform.height;let K=!1;for(let se=0;se<Q.length;se++){const ue=Q.get(se);if(ue.hidden||ue.writingMode===d.aA.vertical&&!K){ts(ue.numGlyphs,W);continue}K=!1;const te=new d.P(ue.anchorX,ue.anchorY),me={getElevation:I,pitchedLabelPlaneMatrix:l,lineVertexArray:Y,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:te,unwrappedTileID:S,width:A,height:z,translation:R},Ae=vl(ue.anchorX,ue.anchorY,me);if(!Ka(Ae.point,X)){ts(ue.numGlyphs,W);continue}const we=Co(t.transform.cameraToCenterDistance,Ae.signedDistanceFromCamera),Ce=d.aB(F,U,ue),De=_?Ce*t.transform.getPitchedTextCorrection(ue.anchorX,ue.anchorY,S)/we:Ce*we,Ke=mn({projectionContext:me,pitchedLabelPlaneMatrixInverse:h,symbol:ue,fontSize:De,flip:!1,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:ne,rotateToLine:w});K=Ke.useVertical,(Ke.notEnoughRoom||K||Ke.needsFlipping&&mn({projectionContext:me,pitchedLabelPlaneMatrixInverse:h,symbol:ue,fontSize:De,flip:!0,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:ne,rotateToLine:w}).notEnoughRoom)&&ts(ue.numGlyphs,W)}a?m.text.dynamicLayoutVertexBuffer.updateData(W):m.icon.dynamicLayoutVertexBuffer.updateData(W)}function Ja(m,t,a,l,h,_,v,w){const S=_.glyphStartIndex+_.numGlyphs,A=_.lineStartIndex,z=_.lineStartIndex+_.lineLength,R=t.getoffsetX(_.glyphStartIndex),I=t.getoffsetX(S-1),F=La(m*R,a,l,h,_.segment,A,z,w,v);if(!F)return null;const U=La(m*I,a,l,h,_.segment,A,z,w,v);return U?w.projectionCache.anyProjectionOccluded?null:{first:F,last:U}:null}function es(m,t,a,l){return m===d.aA.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*l?{useVertical:!0}:(m===d.aA.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function mn(m){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:l,fontSize:h,flip:_,keepUpright:v,glyphOffsetArray:w,dynamicLayoutVertexArray:S,aspectRatio:A,rotateToLine:z}=m,R=h/24,I=l.lineOffsetX*R,F=l.lineOffsetY*R;let U;if(l.numGlyphs>1){const X=l.glyphStartIndex+l.numGlyphs,W=l.lineStartIndex,Y=l.lineStartIndex+l.lineLength,Q=Ja(R,w,I,F,_,l,z,t);if(!Q)return{notEnoughRoom:!0};const ne=Ts(Q.first.point.x,Q.first.point.y,t,a),K=Ts(Q.last.point.x,Q.last.point.y,t,a);if(v&&!_){const se=es(l.writingMode,ne,K,A);if(se)return se}U=[Q.first];for(let se=l.glyphStartIndex+1;se<X-1;se++){const ue=La(R*w.getoffsetX(se),I,F,_,l.segment,W,Y,t,z);if(!ue)return{notEnoughRoom:!0};U.push(ue)}U.push(Q.last)}else{if(v&&!_){const W=pi(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,Y=l.lineStartIndex+l.segment+1,Q=new d.P(t.lineVertexArray.getx(Y),t.lineVertexArray.gety(Y)),ne=pi(Q.x,Q.y,t),K=ne.signedDistanceFromCamera>0?ne.point:yl(t.tileAnchorPoint,Q,W,1,t),se=Ts(W.x,W.y,t,a),ue=Ts(K.x,K.y,t,a),te=es(l.writingMode,se,ue,A);if(te)return te}const X=La(R*w.getoffsetX(l.glyphStartIndex),I,F,_,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,t,z);if(!X||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[X]}for(const X of U)d.aH(S,X.point,X.angle);return{}}function yl(m,t,a,l,h){const _=m.add(m.sub(t)._unit()),v=pi(_.x,_.y,h).point,w=a.sub(v);return a.add(w._mult(l/w.mag()))}function xr(m,t,a){const l=t.projectionCache;if(l.projections[m])return l.projections[m];const h=new d.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),_=pi(h.x,h.y,t);if(_.signedDistanceFromCamera>0)return l.projections[m]=_.point,l.anyProjectionOccluded=l.anyProjectionOccluded||_.isOccluded,_.point;const v=m-a.direction;return yl(a.distanceFromAnchor===0?t.tileAnchorPoint:new d.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),h,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function pi(m,t,a){const l=m+a.translation[0],h=t+a.translation[1];let _;return a.pitchWithMap?(_=$t(l,h,a.pitchedLabelPlaneMatrix,a.getElevation),_.isOccluded=!1):(_=a.transform.projectTileCoordinates(l,h,a.unwrappedTileID,a.getElevation),_.point.x=(.5*_.point.x+.5)*a.width,_.point.y=(.5*-_.point.y+.5)*a.height),_}function Ts(m,t,a,l){if(a.pitchWithMap){const h=[m,t,0,1];return d.aI(h,h,l),a.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],a.unwrappedTileID,a.getElevation).point}return{x:m/a.width*2-1,y:1-t/a.height*2}}function vl(m,t,a){return a.transform.projectTileCoordinates(m,t,a.unwrappedTileID,a.getElevation)}function xl(m,t,a){return m._unit()._perp()._mult(t*a)}function Ys(m,t,a,l,h,_,v,w,S){if(w.projectionCache.offsets[m])return w.projectionCache.offsets[m];const A=a.add(t);if(m+S.direction<l||m+S.direction>=h)return w.projectionCache.offsets[m]=A,A;const z=xr(m+S.direction,w,S),R=xl(z.sub(a),v,S.direction),I=a.add(R),F=z.add(R);return w.projectionCache.offsets[m]=d.aJ(_,A,I,F)||A,w.projectionCache.offsets[m]}function La(m,t,a,l,h,_,v,w,S){const A=l?m-t:m+t;let z=A>0?1:-1,R=0;l&&(z*=-1,R=Math.PI),z<0&&(R+=Math.PI);let I,F=z>0?_+h:_+h+1;w.projectionCache.cachedAnchorPoint?I=w.projectionCache.cachedAnchorPoint:(I=pi(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=I);let U,X,W=I,Y=I,Q=0,ne=0;const K=Math.abs(A),se=[];let ue;for(;Q+ne<=K;){if(F+=z,F<_||F>=v)return null;Q+=ne,Y=W,X=U;const Ae={absOffsetX:K,direction:z,distanceFromAnchor:Q,previousVertex:Y};if(W=xr(F,w,Ae),a===0)se.push(Y),ue=W.sub(Y);else{let we;const Ce=W.sub(Y);we=Ce.mag()===0?xl(xr(F+z,w,Ae).sub(W),a,z):xl(Ce,a,z),X||(X=Y.add(we)),U=Ys(F,we,W,_,v,X,a,w,Ae),se.push(X),ue=U.sub(X)}ne=ue.mag()}const te=ue._mult((K-Q)/ne)._add(X||Y),me=R+Math.atan2(W.y-Y.y,W.x-Y.x);return se.push(te),{point:te,angle:S?me:0,path:se}}const ou=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ts(m,t){for(let a=0;a<m;a++){const l=t.length;t.resize(l+4),t.float32.set(ou,3*l)}}function _a(m,t,a){const l=t[0],h=t[1];return m[0]=a[0]*l+a[4]*h+a[12],m[1]=a[1]*l+a[5]*h+a[13],m[3]=a[3]*l+a[7]*h+a[15],m}const vi=100;class dh{constructor(t,a=new Qt(t.width+200,t.height+200,25),l=new Qt(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+vi,this.screenBottomBoundary=t.height+vi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,l,h,_,v,w,S,A,z,R,I){const F=this.projectAndGetPerspectiveRatio(t.anchorPointX+S[0],t.anchorPointY+S[1],_,z,I),U=l*F.perspectiveRatio;let X;if(v||w)X=this._projectCollisionBox(t,U,h,_,v,w,S,F,z,R,I);else{const ue=F.x+(R?R.x*U:0),te=F.y+(R?R.y*U:0);X={allPointsOccluded:!1,box:[ue+t.x1*U,te+t.y1*U,ue+t.x2*U,te+t.y2*U]}}const[W,Y,Q,ne]=X.box,K=v?X.allPointsOccluded:F.isOccluded;let se=K;return se||(se=F.perspectiveRatio<this.perspectiveRatioCutoff),se||(se=!this.isInsideGrid(W,Y,Q,ne)),se||a!=="always"&&this.grid.hitTest(W,Y,Q,ne,a,A)?{box:[W,Y,Q,ne],placeable:!1,offscreen:!1,occluded:K}:{box:[W,Y,Q,ne],placeable:!0,offscreen:this.isOffscreen(W,Y,Q,ne),occluded:K}}placeCollisionCircles(t,a,l,h,_,v,w,S,A,z,R,I,F,U){const X=[],W=new d.P(a.anchorX,a.anchorY),Y=this.getPerspectiveRatio(W.x,W.y,v,U),Q=(A?_*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,v)/Y:_*Y)/d.aN,ne={getElevation:U,pitchedLabelPlaneMatrix:w,lineVertexArray:l,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:W,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:F},K=Ja(Q,h,a.lineOffsetX*Q,a.lineOffsetY*Q,!1,a,!1,ne);let se=!1,ue=!1,te=!0;if(K){const me=.5*R*Y+I,Ae=new d.P(-100,-100),we=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ce=new ht,De=K.first,Ke=K.last;let lt=[];for(let Zt=De.path.length-1;Zt>=1;Zt--)lt.push(De.path[Zt]);for(let Zt=1;Zt<Ke.path.length;Zt++)lt.push(Ke.path[Zt]);const Ye=2.5*me;if(A){const Zt=this.projectPathToScreenSpace(lt,ne);lt=Zt.some((wi=>wi.signedDistanceFromCamera<=0))?[]:Zt.map((wi=>wi.point))}let Ct=[];if(lt.length>0){const Zt=lt[0].clone(),wi=lt[0].clone();for(let Ui=1;Ui<lt.length;Ui++)Zt.x=Math.min(Zt.x,lt[Ui].x),Zt.y=Math.min(Zt.y,lt[Ui].y),wi.x=Math.max(wi.x,lt[Ui].x),wi.y=Math.max(wi.y,lt[Ui].y);Ct=Zt.x>=Ae.x&&wi.x<=we.x&&Zt.y>=Ae.y&&wi.y<=we.y?[lt]:wi.x<Ae.x||Zt.x>we.x||wi.y<Ae.y||Zt.y>we.y?[]:d.aK([lt],Ae.x,Ae.y,we.x,we.y)}for(const Zt of Ct){Ce.reset(Zt,.25*me);let wi=0;wi=Ce.length<=.5*me?1:Math.ceil(Ce.paddedLength/Ye)+1;for(let Ui=0;Ui<wi;Ui++){const Mi=Ui/Math.max(wi-1,1),Yi=Ce.lerp(Mi),Ii=Yi.x+vi,On=Yi.y+vi;X.push(Ii,On,me,0);const $i=Ii-me,Fn=On-me,cn=Ii+me,yn=On+me;if(te=te&&this.isOffscreen($i,Fn,cn,yn),ue=ue||this.isInsideGrid($i,Fn,cn,yn),t!=="always"&&this.grid.hitTestCircle(Ii,On,me,t,z)&&(se=!0,!S))return{circles:[],offscreen:!1,collisionDetected:se}}}}return{circles:!S&&se||!ue||Y<this.perspectiveRatioCutoff?[]:X,offscreen:te,collisionDetected:se}}projectPathToScreenSpace(t,a){const l=(function(h,_){const v=d.N();return d.aC(v,_.pitchedLabelPlaneMatrix),h.map((w=>{const S=$t(w.x,w.y,v,_.getElevation),A=_.transform.projectTileCoordinates(S.point.x,S.point.y,_.unwrappedTileID,_.getElevation);return A.point.x=(.5*A.point.x+.5)*_.width,A.point.y=(.5*-A.point.y+.5)*_.height,A}))})(t,a);return(function(h){let _=0,v=0,w=0,S=0;for(let A=0;A<h.length;A++)h[A].isOccluded?(w=A+1,S=0):(S++,S>v&&(v=S,_=w));return h.slice(_,_+v)})(l)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],l=new d.ac;for(const R of t){const I=new d.P(R.x+vi,R.y+vi);l.extend(I),a.push(I)}const{minX:h,minY:_,maxX:v,maxY:w}=l,S=this.grid.query(h,_,v,w).concat(this.ignoredGrid.query(h,_,v,w)),A={},z={};for(const R of S){const I=R.key;if(A[I.bucketInstanceId]===void 0&&(A[I.bucketInstanceId]={}),A[I.bucketInstanceId][I.featureIndex])continue;const F=[new d.P(R.x1,R.y1),new d.P(R.x2,R.y1),new d.P(R.x2,R.y2),new d.P(R.x1,R.y2)];d.aL(a,F)&&(A[I.bucketInstanceId][I.featureIndex]=!0,z[I.bucketInstanceId]===void 0&&(z[I.bucketInstanceId]=[]),z[I.bucketInstanceId].push(I.featureIndex))}return z}insertCollisionBox(t,a,l,h,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:_,collisionGroupID:v,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,l,h,_,v){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:h,featureIndex:_,collisionGroupID:v,overlapMode:a};for(let A=0;A<t.length;A+=4)w.insertCircle(S,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,a,l,h,_){if(_){let v;h?(v=[t,a,h(t,a),1],d.aI(v,v,_)):(v=[t,a,0,1],_a(v,v,_));const w=v[3];return{x:(v[0]/w+1)/2*this.transform.width+vi,y:(-v[1]/w+1)/2*this.transform.height+vi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{const v=this.transform.projectTileCoordinates(t,a,l,h);return{x:(v.point.x+1)/2*this.transform.width+vi,y:(1-v.point.y)/2*this.transform.height+vi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,l,h){const _=this.transform.projectTileCoordinates(t,a,l,h);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,a,l,h){return l<vi||t>=this.screenRightBoundary||h<vi||a>this.screenBottomBoundary}isInsideGrid(t,a,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=d.as([]);return d.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,l,h,_,v,w,S,A,z,R){let I=1,F=0,U=0,X=1;const W=t.anchorPointX+w[0],Y=t.anchorPointY+w[1];if(v&&!_){const lt=this.projectAndGetPerspectiveRatio(W+1,Y,h,A,R),Ye=lt.x-S.x,Ct=Math.atan((lt.y-S.y)/Ye)+(Ye<0?Math.PI:0),Zt=Math.sin(Ct),wi=Math.cos(Ct);I=wi,F=Zt,U=-Zt,X=wi}else if(!v&&_){const lt=Qa(this.transform);I=lt.vecEast[0],F=lt.vecEast[1],U=lt.vecSouth[0],X=lt.vecSouth[1]}let Q=S.x,ne=S.y,K=a;_&&(Q=W,ne=Y,K=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),K*=this.transform.getPitchedTextCorrection(W,Y,h),z||(K*=d.ao(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(Q+=I*z.x*K+U*z.y*K,ne+=F*z.x*K+X*z.y*K);const se=t.x1*K,ue=t.x2*K,te=(se+ue)/2,me=t.y1*K,Ae=t.y2*K,we=(me+Ae)/2,Ce=[{offsetX:se,offsetY:me},{offsetX:te,offsetY:me},{offsetX:ue,offsetY:me},{offsetX:ue,offsetY:we},{offsetX:ue,offsetY:Ae},{offsetX:te,offsetY:Ae},{offsetX:se,offsetY:Ae},{offsetX:se,offsetY:we}];let De=[];for(const{offsetX:lt,offsetY:Ye}of Ce)De.push(new d.P(Q+I*lt+U*Ye,ne+F*lt+X*Ye));let Ke=!1;if(_){const lt=De.map((Ye=>this.projectAndGetPerspectiveRatio(Ye.x,Ye.y,h,A,R)));Ke=lt.some((Ye=>!Ye.isOccluded)),De=lt.map((Ye=>new d.P(Ye.x,Ye.y)))}else Ke=!0;return{box:d.aM(De),allPointsOccluded:!Ke}}}class xd{constructor(t,a,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class zo{constructor(t,a,l,h,_){this.text=new xd(t?t.text:null,a,l,_),this.icon=new xd(t?t.icon:null,a,h,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fh{constructor(t,a,l){this.text=t,this.icon=a,this.skipFade=l}}class lu{constructor(t,a,l,h,_){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=_}}class bd{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:l=>l.collisionGroupID===a}}return this.collisionGroups[t]}}function Ar(m,t,a,l,h){const{horizontalAlign:_,verticalAlign:v}=d.aT(m);return new d.P(-(_-.5)*t+l[0]*h,-(v-.5)*a+l[1]*h)}class uu{constructor(t,a,l,h,_){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new dh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new bd(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(l,h)=>a.getElevation(t,l,h):null}getBucketParts(t,a,l,h){const _=l.getBucket(a),v=l.latestFeatureIndex;if(!_||!v||a.id!==_.layerIds[0])return;const w=l.collisionBoxArray,S=_.layers[0].layout,A=_.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),R=l.tileSize/d.a5,I=l.tileID.toUnwrapped(),F=S.get("text-rotation-alignment")==="map",U=d.aO(l,1,this.transform.zoom),X=d.aP(this.collisionIndex.transform,l,A.get("text-translate"),A.get("text-translate-anchor")),W=d.aP(this.collisionIndex.transform,l,A.get("icon-translate"),A.get("icon-translate-anchor")),Y=ea(F,this.transform,U);this.retainedQueryData[_.bucketInstanceId]=new lu(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,l.tileID);const Q={bucket:_,layout:S,translationText:X,translationIcon:W,unwrappedTileID:I,pitchedLabelPlaneMatrix:Y,scale:z,textPixelRatio:R,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:d.az(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(const ne of _.sortKeyRanges){const{sortKey:K,symbolInstanceStart:se,symbolInstanceEnd:ue}=ne;t.push({sortKey:K,symbolInstanceStart:se,symbolInstanceEnd:ue,parameters:Q})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(t,a,l,h,_,v,w,S,A,z,R,I,F,U,X,W,Y,Q,ne,K){const se=d.aQ[t.textAnchor],ue=[t.textOffset0,t.textOffset1],te=Ar(se,l,h,ue,_),me=this.collisionIndex.placeCollisionBox(a,I,S,A,z,w,v,W,R.predicate,ne,te,K);if((!Q||this.collisionIndex.placeCollisionBox(Q,I,S,A,z,w,v,Y,R.predicate,ne,te,K).placeable)&&me.placeable){let Ae;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(Ae=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:ue,width:l,height:h,anchor:se,textBoxScale:_,prevAnchor:Ae},this.markUsedJustification(U,se,F,X),U.allowVerticalPlacement&&(this.markUsedOrientation(U,X,F),this.placedOrientations[F.crossTileID]=X),{shift:te,placedGlyphBoxes:me}}}placeLayerBucketPart(t,a,l){const{bucket:h,layout:_,translationText:v,translationIcon:w,unwrappedTileID:S,pitchedLabelPlaneMatrix:A,textPixelRatio:z,holdingForFade:R,collisionBoxArray:I,partiallyEvaluatedTextSize:F,collisionGroup:U}=t.parameters,X=_.get("text-optional"),W=_.get("icon-optional"),Y=d.aR(_,"text-overlap","text-allow-overlap"),Q=Y==="always",ne=d.aR(_,"icon-overlap","icon-allow-overlap"),K=ne==="always",se=_.get("text-rotation-alignment")==="map",ue=_.get("text-pitch-alignment")==="map",te=_.get("icon-text-fit")!=="none",me=_.get("symbol-z-order")==="viewport-y",Ae=Q&&(K||!h.hasIconData()||W),we=K&&(Q||!h.hasTextData()||X);!h.collisionArrays&&I&&h.deserializeCollisionBoxes(I);const Ce=this.retainedQueryData[h.bucketInstanceId].tileID,De=this._getTerrainElevationFunc(Ce),Ke=this.transform.getFastPathSimpleProjectionMatrix(Ce),lt=(Ye,Ct,Zt)=>{var wi,Ui;if(a[Ye.crossTileID])return;if(R)return void(this.placements[Ye.crossTileID]=new fh(!1,!1,!1));let Mi=!1,Yi=!1,Ii=!0,On=null,$i={box:null,placeable:!1,offscreen:null,occluded:!1},Fn={placeable:!1},cn=null,yn=null,ar=null,pr=0,Va=0,js=0;Ct.textFeatureIndex?pr=Ct.textFeatureIndex:Ye.useRuntimeCollisionCircles&&(pr=Ye.featureIndex),Ct.verticalTextFeatureIndex&&(Va=Ct.verticalTextFeatureIndex);const Qo=Ct.textBox;if(Qo){const Nn=hn=>{let jn=d.aA.horizontal;if(h.allowVerticalPlacement&&!hn&&this.prevPlacement){const Fr=this.prevPlacement.placedOrientations[Ye.crossTileID];Fr&&(this.placedOrientations[Ye.crossTileID]=Fr,jn=Fr,this.markUsedOrientation(h,jn,Ye))}return jn},Qn=(hn,jn)=>{if(h.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&Ct.verticalTextBox){for(const Fr of h.writingModes)if(Fr===d.aA.vertical?($i=jn(),Fn=$i):$i=hn(),$i&&$i.placeable)break}else $i=hn()},sr=Ye.textAnchorOffsetStartIndex,ha=Ye.textAnchorOffsetEndIndex;if(ha===sr){const hn=(jn,Fr)=>{const en=this.collisionIndex.placeCollisionBox(jn,Y,z,Ce,S,ue,se,v,U.predicate,De,void 0,Ke);return en&&en.placeable&&(this.markUsedOrientation(h,Fr,Ye),this.placedOrientations[Ye.crossTileID]=Fr),en};Qn((()=>hn(Qo,d.aA.horizontal)),(()=>{const jn=Ct.verticalTextBox;return h.allowVerticalPlacement&&Ye.numVerticalGlyphVertices>0&&jn?hn(jn,d.aA.vertical):{box:null,offscreen:null}})),Nn($i&&$i.placeable)}else{let hn=d.aQ[(Ui=(wi=this.prevPlacement)===null||wi===void 0?void 0:wi.variableOffsets[Ye.crossTileID])===null||Ui===void 0?void 0:Ui.anchor];const jn=(en,Rh,Bc)=>{const kc=en.x2-en.x1,Lh=en.y2-en.y1,da=Ye.textBoxScale,bo=te&&ne==="never"?Rh:null;let Vs=null,Bh=Y==="never"?1:2,Jo="never";hn&&Bh++;for(let Oc=0;Oc<Bh;Oc++){for(let wo=sr;wo<ha;wo++){const Fc=h.textAnchorOffsets.get(wo);if(hn&&Fc.textAnchor!==hn)continue;const Nc=this.attemptAnchorPlacement(Fc,en,kc,Lh,da,se,ue,z,Ce,S,U,Jo,Ye,h,Bc,v,w,bo,De);if(Nc&&(Vs=Nc.placedGlyphBoxes,Vs&&Vs.placeable))return Mi=!0,On=Nc.shift,Vs}hn?hn=null:Jo=Y}return l&&!Vs&&(Vs={box:this.collisionIndex.placeCollisionBox(Qo,"always",z,Ce,S,ue,se,v,U.predicate,De,void 0,Ke).box,offscreen:!1,placeable:!1,occluded:!1}),Vs};Qn((()=>jn(Qo,Ct.iconBox,d.aA.horizontal)),(()=>{const en=Ct.verticalTextBox;return h.allowVerticalPlacement&&(!$i||!$i.placeable)&&Ye.numVerticalGlyphVertices>0&&en?jn(en,Ct.verticalIconBox,d.aA.vertical):{box:null,occluded:!0,offscreen:null}})),$i&&(Mi=$i.placeable,Ii=$i.offscreen);const Fr=Nn($i&&$i.placeable);if(!Mi&&this.prevPlacement){const en=this.prevPlacement.variableOffsets[Ye.crossTileID];en&&(this.variableOffsets[Ye.crossTileID]=en,this.markUsedJustification(h,en.anchor,Ye,Fr))}}}if(cn=$i,Mi=cn&&cn.placeable,Ii=cn&&cn.offscreen,Ye.useRuntimeCollisionCircles&&Ye.centerJustifiedTextSymbolIndex>=0){const Nn=h.text.placedSymbolArray.get(Ye.centerJustifiedTextSymbolIndex),Qn=d.aB(h.textSizeData,F,Nn),sr=_.get("text-padding");yn=this.collisionIndex.placeCollisionCircles(Y,Nn,h.lineVertexArray,h.glyphOffsetArray,Qn,S,A,l,ue,U.predicate,Ye.collisionCircleDiameter,sr,v,De),yn.circles.length&&yn.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),Mi=Q||yn.circles.length>0&&!yn.collisionDetected,Ii=Ii&&yn.offscreen}if(Ct.iconFeatureIndex&&(js=Ct.iconFeatureIndex),Ct.iconBox){const Nn=Qn=>this.collisionIndex.placeCollisionBox(Qn,ne,z,Ce,S,ue,se,w,U.predicate,De,te&&On?On:void 0,Ke);Fn&&Fn.placeable&&Ct.verticalIconBox?(ar=Nn(Ct.verticalIconBox),Yi=ar.placeable):(ar=Nn(Ct.iconBox),Yi=ar.placeable),Ii=Ii&&ar.offscreen}const Lc=X||Ye.numHorizontalGlyphVertices===0&&Ye.numVerticalGlyphVertices===0,Ko=W||Ye.numIconVertices===0;Lc||Ko?Ko?Lc||(Yi=Yi&&Mi):Mi=Yi&&Mi:Yi=Mi=Yi&&Mi;const $r=Yi&&ar.placeable;if(Mi&&cn.placeable&&this.collisionIndex.insertCollisionBox(cn.box,Y,_.get("text-ignore-placement"),h.bucketInstanceId,Fn&&Fn.placeable&&Va?Va:pr,U.ID),$r&&this.collisionIndex.insertCollisionBox(ar.box,ne,_.get("icon-ignore-placement"),h.bucketInstanceId,js,U.ID),yn&&Mi&&this.collisionIndex.insertCollisionCircles(yn.circles,Y,_.get("text-ignore-placement"),h.bucketInstanceId,pr,U.ID),l&&this.storeCollisionData(h.bucketInstanceId,Zt,Ct,cn,ar,yn),Ye.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ye.crossTileID]=new fh((Mi||Ae)&&!cn?.occluded,(Yi||we)&&!ar?.occluded,Ii||h.justReloaded),a[Ye.crossTileID]=!0};if(me){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ye=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ct=Ye.length-1;Ct>=0;--Ct){const Zt=Ye[Ct];lt(h.symbolInstances.get(Zt),h.collisionArrays[Zt],Zt)}}else for(let Ye=t.symbolInstanceStart;Ye<t.symbolInstanceEnd;Ye++)lt(h.symbolInstances.get(Ye),h.collisionArrays[Ye],Ye);h.justReloaded=!1}storeCollisionData(t,a,l,h,_,v){if(l.textBox||l.iconBox){let w,S;this.collisionBoxArrays.has(t)?w=this.collisionBoxArrays.get(t):(w=new Map,this.collisionBoxArrays.set(t,w)),w.has(a)?S=w.get(a):(S={text:null,icon:null},w.set(a,S)),l.textBox&&(S.text=h.box),l.iconBox&&(S.icon=_.box)}if(v){let w=this.collisionCircleArrays[t];w===void 0&&(w=this.collisionCircleArrays[t]=[]);for(let S=0;S<v.circles.length;S+=4)w.push(v.circles[S+0]-vi),w.push(v.circles[S+1]-vi),w.push(v.circles[S+2]),w.push(v.collisionDetected?1:0)}}markUsedJustification(t,a,l,h){let _;_=h===d.aA.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.aS(a)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=_>=0&&w!==_?0:l.crossTileID)}markUsedOrientation(t,a,l){const h=a===d.aA.horizontal||a===d.aA.horizontalOnly?a:0,_=a===d.aA.vertical?a:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)t.text.placedSymbolArray.get(w).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let l=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const h=a?a.symbolFadeChange(t):1,_=a?a.opacities:{},v=a?a.variableOffsets:{},w=a?a.placedOrientations:{};for(const S in this.placements){const A=this.placements[S],z=_[S];z?(this.opacities[S]=new zo(z,h,A.text,A.icon),l=l||A.text!==z.text.placed||A.icon!==z.icon.placed):(this.opacities[S]=new zo(null,h,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const S in _){const A=_[S];if(!this.opacities[S]){const z=new zo(A,h,!1,!1);z.isHidden()||(this.opacities[S]=z,l=l||A.text.placed||A.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const l={};for(const h of a){const _=h.getBucket(t);_&&h.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(t,a,l,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],v=_.layout,w=new zo(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),A=v.get("icon-allow-overlap"),z=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=v.get("text-rotation-alignment")==="map",I=v.get("text-pitch-alignment")==="map",F=v.get("icon-text-fit")!=="none",U=new zo(null,0,S&&(A||!t.hasIconData()||v.get("icon-optional")),A&&(S||!t.hasTextData()||v.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const X=(Y,Q,ne)=>{for(let K=0;K<Q/4;K++)Y.opacityVertexArray.emplaceBack(ne);Y.hasVisibleVertices=Y.hasVisibleVertices||ne!==Po},W=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Y=0;Y<t.symbolInstances.length;Y++){const Q=t.symbolInstances.get(Y),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:K,crossTileID:se}=Q;let ue=this.opacities[se];l[se]?ue=w:ue||(ue=U,this.opacities[se]=ue),l[se]=!0;const te=Q.numIconVertices>0,me=this.placedOrientations[Q.crossTileID],Ae=me===d.aA.vertical,we=me===d.aA.horizontal||me===d.aA.horizontalOnly;if(ne>0||K>0){const De=uc(ue.text);X(t.text,ne,Ae?Po:De),X(t.text,K,we?Po:De);const Ke=ue.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach((Ct=>{Ct>=0&&(t.text.placedSymbolArray.get(Ct).hidden=Ke||Ae?1:0)})),Q.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=Ke||we?1:0);const lt=this.variableOffsets[Q.crossTileID];lt&&this.markUsedJustification(t,lt.anchor,Q,me);const Ye=this.placedOrientations[Q.crossTileID];Ye&&(this.markUsedJustification(t,"left",Q,Ye),this.markUsedOrientation(t,Ye,Q))}if(te){const De=uc(ue.icon),Ke=!(F&&Q.verticalPlacedIconSymbolIndex&&Ae);Q.placedIconSymbolIndex>=0&&(X(t.icon,Q.numIconVertices,Ke?De:Po),t.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=ue.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(X(t.icon,Q.numVerticalIconVertices,Ke?Po:De),t.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=ue.icon.isHidden())}const Ce=W&&W.has(Y)?W.get(Y):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const De=t.collisionArrays[Y];if(De){let Ke=new d.P(0,0);if(De.textBox||De.verticalTextBox){let lt=!0;if(z){const Ye=this.variableOffsets[se];Ye?(Ke=Ar(Ye.anchor,Ye.width,Ye.height,Ye.textOffset,Ye.textBoxScale),R&&Ke._rotate(I?-this.transform.bearingInRadians:this.transform.bearingInRadians)):lt=!1}if(De.textBox||De.verticalTextBox){let Ye;De.textBox&&(Ye=Ae),De.verticalTextBox&&(Ye=we),lc(t.textCollisionBox.collisionVertexArray,ue.text.placed,!lt||Ye,Ce.text,Ke.x,Ke.y)}}if(De.iconBox||De.verticalIconBox){const lt=!!(!we&&De.verticalIconBox);let Ye;De.iconBox&&(Ye=lt),De.verticalIconBox&&(Ye=!lt),lc(t.iconCollisionBox.collisionVertexArray,ue.icon.placed,Ye,Ce.icon,F?Ke.x:0,F?Ke.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const l=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function lc(m,t,a,l,h,_){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-vi,w=l[1]-vi,S=l[2]-vi,A=l[3]-vi;m.emplaceBack(t?1:0,a?1:0,h||0,_||0,v,w),m.emplaceBack(t?1:0,a?1:0,h||0,_||0,S,w),m.emplaceBack(t?1:0,a?1:0,h||0,_||0,S,A),m.emplaceBack(t?1:0,a?1:0,h||0,_||0,v,A)}const cu=Math.pow(2,25),Ws=Math.pow(2,24),wd=Math.pow(2,17),bl=Math.pow(2,16),Ss=Math.pow(2,9),Td=Math.pow(2,8),Do=Math.pow(2,1);function uc(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,a=Math.floor(127*m.opacity);return a*cu+t*Ws+a*wd+t*bl+a*Ss+t*Td+a*Do+t}const Po=0;class Qs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,l,h,_){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(v,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((w,S)=>w.sortKey-S.sortKey)));this._currentPartIndex<v.length;)if(a.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,_())return!0;return!1}}class wl{constructor(t,a,l,h,_,v,w,S){this.placement=new uu(t,a,v,w,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,a,l){const h=rt(),_=()=>!this._forceFullPlacement&&rt()-h>2;for(;this._currentPlacementIndex>=0;){const v=a[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Qs(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Wt=512/d.a5/2;class Ba{constructor(t,a,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let _=0;_<a.length;_++){const v=a.get(_),w=v.key,S=h.get(w);S?S.push(v):h.set(w,[v])}for(const[_,v]of h){const w={positions:v.map((S=>({x:Math.floor(S.anchorX*Wt),y:Math.floor(S.anchorY*Wt)}))),crossTileIDs:v.map((S=>S.crossTileID))};if(w.positions.length>128){const S=new d.aU(w.positions.length,16,Uint16Array);for(const{x:A,y:z}of w.positions)S.add(A,z);S.finish(),delete w.positions,w.index=S}this._symbolsByKey[_]=w}}getScaledCoordinates(t,a){const{x:l,y:h,z:_}=this.tileID.canonical,{x:v,y:w,z:S}=a.canonical,A=Wt/Math.pow(2,S-_),z=(w*d.a5+t.anchorY)*A,R=h*d.a5*Wt;return{x:Math.floor((v*d.a5+t.anchorX)*A-l*d.a5*Wt),y:Math.floor(z-R)}}findMatches(t,a,l){const h=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let _=0;_<t.length;_++){const v=t.get(_);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const S=this.getScaledCoordinates(v,a);if(w.index){const A=w.index.range(S.x-h,S.y-h,S.x+h,S.y+h).sort();for(const z of A){const R=w.crossTileIDs[z];if(!l[R]){l[R]=!0,v.crossTileID=R;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const z=w.positions[A],R=w.crossTileIDs[A];if(Math.abs(z.x-S.x)<=h&&Math.abs(z.y-S.y)<=h&&!l[R]){l[R]=!0,v.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class ph{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class hu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const l in this.indexes){const h=this.indexes[l],_={};for(const v in h){const w=h[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+a),_[w.tileID.key]=w}this.indexes[l]=_}this.lng=t}addBucket(t,a,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<a.symbolInstances.length;_++)a.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>t.overscaledZ)for(const w in v){const S=v[w];S.tileID.isChildOf(t)&&S.findMatches(a.symbolInstances,t,h)}else{const w=v[t.scaledTo(Number(_)).key];w&&w.findMatches(a.symbolInstances,t,h)}}for(let _=0;_<a.symbolInstances.length;_++){const v=a.symbolInstances.get(_);v.crossTileID||(v.crossTileID=l.generate(),h[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ba(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const l of a.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let a=!1;for(const l in this.indexes){const h=this.indexes[l];for(const _ in h)t[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[_]),delete h[_],a=!0)}return a}}class Yn{constructor(){this.layerIndexes={},this.crossTileIDs=new ph,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new hu);let _=!1;const v={};h.handleWrapJump(l);for(const w of a){const S=w.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(w.tileID,S,this.crossTileIDs)&&(_=!0),v[S.bucketInstanceId]=!0)}return h.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(t){const a={};t.forEach((l=>{a[l]=!0}));for(const l in this.layerIndexes)a[l]||delete this.layerIndexes[l]}}var Pn="void main() {fragColor=vec4(1.0);}";const Wi={prelude:jt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:jt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:jt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:jt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:jt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:jt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:jt(Pn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:jt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:jt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:jt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:jt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:jt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:jt(Pn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:jt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:jt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:jt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:jt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:jt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:jt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:jt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:jt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:jt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:jt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:jt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:jt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:jt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:jt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:jt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:jt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:jt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:jt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:jt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function jt(m,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/in ([\w]+) ([\w]+)/g),h=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=_?_.concat(h):h,w={};return{fragmentSource:m=m.replace(a,((S,A,z,R,I)=>(w[I]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${I}
in ${z} ${R} ${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:`
#ifdef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = u_${I};
#endif
`))),vertexSource:t=t.replace(a,((S,A,z,R,I)=>{const F=R==="float"?"vec2":"vec4",U=I.match(/color/)?"color":F;return w[I]?A==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${z} ${F} a_${I};
out ${z} ${R} ${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = unpack_mix_${U}(a_${I}, u_${I}_t);
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
in ${z} ${F} a_${I};
#else
uniform ${z} ${R} u_${I};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = a_${I};
#else
    ${z} ${R} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    ${z} ${R} ${I} = unpack_mix_${U}(a_${I}, u_${I}_t);
#else
    ${z} ${R} ${I} = u_${I};
#endif
`})),staticAttributes:l,staticUniforms:v}}class Ni{constructor(t,a,l){this.vertexBuffer=t,this.indexBuffer=a,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ya=d.aV([{name:"a_pos",type:"Int16",components:2}]);const gn="#define PROJECTION_MERCATOR",Cr="mercator";class Wn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Cr}get shaderDefine(){return gn}get shaderPreludeCode(){return Wi.projectionMercator}get vertexShaderPreludeCode(){return Wi.projectionMercator.vertexSource}get subdivisionGranularity(){return d.aW.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,l,h,_){if(this._cachedMesh)return this._cachedMesh;const v=new d.aX;v.emplaceBack(0,0),v.emplaceBack(d.a5,0),v.emplaceBack(0,d.a5),v.emplaceBack(d.a5,d.a5);const w=t.createVertexBuffer(v,ya.members),S=d.aY.simpleSegment(0,0,4,2),A=new d.aZ;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3);const z=t.createIndexBuffer(A);return this._cachedMesh=new Ni(w,z,S),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class ta{constructor(t=0,a=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=l,this.right=h}interpolate(t,a,l){return a.top!=null&&t.top!=null&&(this.top=d.G.number(t.top,a.top,l)),a.bottom!=null&&t.bottom!=null&&(this.bottom=d.G.number(t.bottom,a.bottom,l)),a.left!=null&&t.left!=null&&(this.left=d.G.number(t.left,a.left,l)),a.right!=null&&t.right!=null&&(this.right=d.G.number(t.right,a.right,l)),this}getCenter(t,a){const l=d.ao((this.left+t-this.right)/2,0,t),h=d.ao((this.top+a-this.bottom)/2,0,a);return new d.P(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ta(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function is(m,t){if(!m.renderWorldCopies||m.lngRange)return;const a=t.lng-m.center.lng;t.lng+=a>180?-360:a<-180?360:0}function Qi(m){return Math.max(0,Math.floor(m))}class Ks{constructor(t,a){var l;this.applyConstrain=(h,_)=>this._constrainOverride!==null?this._constrainOverride(h,_):this._callbacks.defaultConstrain(h,_),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(l=a?.constrainOverride)!==null&&l!==void 0?l:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new d.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Qi(this._zoom),this._scale=d.ar(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new ta,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,l){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Qi(this._zoom),this._scale=d.ar(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new ta(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!l&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=d.W(t,-180,180)*Math.PI/180;var l,h,_,v,w,S,A,z,R;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=_e(),l=this._rotationMatrix,_=-this._bearingInRadians,v=(h=this._rotationMatrix)[0],w=h[1],S=h[2],A=h[3],z=Math.sin(_),R=Math.cos(_),l[0]=v*R+S*z,l[1]=w*R+A*z,l[2]=v*-z+S*R,l[3]=w*-z+A*R)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=d.ao(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return d.a_(this._fovInRadians)}setFov(t){t=d.ao(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=d.aq(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=d.ar(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,l){this._unmodified=!1,this._edgeInsets.interpolate(t,a,l),this.constrainInternal(),this._calcMatrices()}resize(t,a,l=!0){this._width=t,this._height=a,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new pn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-d.ap,d.ap])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:l,minY:h,maxX:_,maxY:v}=d.ac.fromPoints(a).extend(t);return[new d.P(l,h),new d.P(_,h),new d.P(_,v),new d.P(l,v),new d.P(l,h)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:l}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(l),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=d.as(new Float64Array(16));d.Q(t,t,[this._width/2,-this._height/2,1]),d.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=d.as(new Float64Array(16)),d.Q(t,t,[1,-1,1]),d.O(t,t,[-1,-1,0]),d.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,l,h){const _=l!==void 0?l:this.bearing,v=h=h!==void 0?h:this.pitch,{distanceToCenter:w,clampedElevation:S}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,v),{x:A,y:z}=Ci(v,_),R=d.ab.fromLngLat(t,a);let I,F,U=d.a$(1,R.y),X=0;do{if(X+=1,X>10)break;F=w/U,I=new d.ab(R.x+A*F,R.y+z*F),U=1/I.meterInMercatorCoordinateUnits()}while(Math.abs(w-F*U)>1e-12);return{center:I.toLngLat(),elevation:S,zoom:d.au(this.height/2/Math.tan(this.fovInRadians/2)/F/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,l=d.at(1,this.center.lat)*this.worldSize,h=d.ab.fromLngLat(this.center,this.elevation),_=h.x/a,v=h.y/a,w=h.z/a,S=this.pitch,A=this.bearing,{x:z,y:R,z:I}=Ci(S,A),F=this.cameraToCenterDistance,U=_+F*-z,X=v+F*-R,W=w+F*I,{distanceToCenter:Y,clampedElevation:Q}=this._distanceToCenterFromAltElevationPitch(W/l,t,S),ne=Y*l,K=new d.ab((U+z*ne)*a,(X+R*ne)*a,0).toLngLat(),se=d.at(1,K.lat),ue=d.au(this.height/2/Math.tan(this.fovInRadians/2)/Y/se/this.tileSize);this._elevation=Q,this._center=K,this.setZoom(ue)}_distanceToCenterFromAltElevationPitch(t,a,l){const h=-Math.cos(d.aq(l)),_=t-a;let v,w=a;return h*_>=0||Math.abs(h)<.1?(v=1e4,w=t+v*h):v=-_/h,{distanceToCenter:v,clampedElevation:w}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=d.at(1,this.center.lat)*this.worldSize;return be(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/d.a5,1/a/d.a5]}}class ia{constructor(t,a){this.min=t,this.max=a,this.center=d.b0([],d.b1([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],l=d.b2(this.min),h=d.b2(this.max);for(let _=0;_<a.length;_++)l[_]=a[_]?this.min[_]:this.center[_],h[_]=a[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new ia(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let l=0;l<t.planes.length;l++){const h=this.intersectsPlane(t.planes[l]);if(h===0)return 0;h===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],l=t[3];for(let h=0;h<3;h++)t[h]>0?(a+=t[h]*this.min[h],l+=t[h]*this.max[h]):(l+=t[h]*this.min[h],a+=t[h]*this.max[h]);return a>=0?2:l<0?0:1}}class Io{distanceToTile2d(t,a,l,h){const _=h.distanceX([t,a]),v=h.distanceY([t,a]);return Math.hypot(_,v)}getWrap(t,a,l){return l}getTileBoundingVolume(t,a,l,h){var _,v;let w=0,S=0;if(h?.terrain){const z=new d.a2(t.z,a,t.z,t.x,t.y),R=h.terrain.getMinMaxElevation(z);w=(_=R.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=R.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}const A=1<<t.z;return new ia([a+t.x/A,t.y/A,w],[a+(t.x+1)/A,(t.y+1)/A,S])}allowVariableZoom(t,a){const l=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,h=d.ao(78.5-l/2,0,60);return!!a.terrain||t.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class zr{constructor(t,a,l){this.points=t,this.planes=a,this.aabb=l}static fromInvProjectionMatrix(t,a=1,l=0,h,_){const v=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,l),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((I=>(function(F,U,X,W){const Y=d.aI([],F,U),Q=1/Y[3]/X*W;return d.b7(Y,Y,[Q,Q,1/Y[3],Q])})(I,t,a,w)));h&&(function(I,F,U,X){const W=X?4:0,Y=X?0:4;let Q=0;const ne=[],K=[];for(let te=0;te<4;te++){const me=d.b3([],I[te+Y],I[te+W]),Ae=d.b8(me);d.b0(me,me,1/Ae),ne.push(Ae),K.push(me)}for(let te=0;te<4;te++){const me=d.b9(I[te+W],K[te],U);Q=me!==null&&me>=0?Math.max(Q,me):Math.max(Q,ne[te])}const se=(function(te,me){const Ae=d.b3([],te[me[0]],te[me[1]]),we=d.b3([],te[me[2]],te[me[1]]),Ce=[0,0,0,0];return d.b4(Ce,d.b5([],Ae,we)),Ce[3]=-d.b6(Ce,te[me[0]]),Ce})(I,F),ue=(function(te,me){const Ae=d.ba(te),we=d.bb([],te,1/Ae),Ce=d.b3([],me,d.b0([],we,d.b6(me,we))),De=d.ba(Ce);if(De>0){const Ke=Math.sqrt(1-we[3]*we[3]),lt=d.b0([],we,-we[3]),Ye=d.b1([],lt,d.b0([],Ce,Ke/De));return d.bc(me,Ye)}return null})(U,se);if(ue!==null){const te=ue/d.b6(K[0],se);Q=Math.min(Q,te)}for(let te=0;te<4;te++){const me=Math.min(Q,ne[te]);I[te+Y]=[I[te+W][0]+K[te][0]*me,I[te+W][1]+K[te][1]*me,I[te+W][2]+K[te][2]*me,1]}})(S,v[0],h,_);const A=v.map((I=>{const F=d.b3([],S[I[0]],S[I[1]]),U=d.b3([],S[I[2]],S[I[1]]),X=d.b4([],d.b5([],F,U)),W=-d.b6(X,S[I[1]]);return X.concat(W)})),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],R=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const I of S)for(let F=0;F<3;F++)z[F]=Math.min(z[F],I[F]),R[F]=Math.max(R[F],I[F]);return new zr(S,A,new ia(z,R))}}class kn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,l=!0){this._helper.resize(t,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,l)=>{l=d.ao(+l,this.minZoom,this.maxZoom);const h={center:new d.V(a.lng,a.lat),zoom:l};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const K=179.9999999999;_=[-K,K]}const v=this.tileSize*d.ar(h.zoom);let w=0,S=v,A=0,z=v,R=0,I=0;const{x:F,y:U}=this.size;if(this._helper._latRange){const K=this._helper._latRange;w=d.X(K[1])*v,S=d.X(K[0])*v,S-w<U&&(R=U/(S-w))}_&&(A=d.W(d.Y(_[0])*v,0,v),z=d.W(d.Y(_[1])*v,0,v),z<A&&(z+=v),z-A<F&&(I=F/(z-A)));const{x:X,y:W}=Pt(v,a);let Y,Q;const ne=Math.max(I||0,R||0);if(ne){const K=new d.P(I?(z+A)/2:X,R?(S+w)/2:W);return h.center=Gt(v,K).wrap(),h.zoom+=d.au(ne),h}if(this._helper._latRange){const K=U/2;W-K<w&&(Q=w+K),W+K>S&&(Q=S-K)}if(_){const K=(A+z)/2;let se=X;this._helper._renderWorldCopies&&(se=d.W(X,K-v/2,K+v/2));const ue=F/2;se-ue<A&&(Y=A+ue),se+ue>z&&(Y=z-ue)}if(Y!==void 0||Q!==void 0){const K=new d.P(Y??X,Q??W);h.center=Gt(v,K).wrap()}return h},this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new Ks({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._coveringTilesDetailsProvider=new Io}clone(){const t=new kn;return t.apply(this),t}apply(t,a,l){this._helper.apply(t,a,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new d.bd(0,t)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new d.P(0,0)),h=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new d.P(0,this._helper._height)),w=Math.floor(Math.min(l.x,h.x,_.x,v.x)),S=Math.floor(Math.max(l.x,h.x,_.x,v.x)),A=1;for(let z=w-A;z<=S+A;z++)z!==0&&a.push(new d.bd(z,t))}return a}getCameraFrustum(){return zr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),l=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(t,a){const l=d.at(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(a,l),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),v=d.ab.fromLngLat(t),w=new d.ab(v.x-(h.x-_.x),v.y-(h.y-_.y));this.setCenter(w?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(d.ab.fromLngLat(t),a.getElevationForLngLat(t),this._pixelMatrix3D):this.coordinatePoint(d.ab.fromLngLat(t))}screenPointToLocation(t,a){var l;return(l=this.screenPointToMercatorCoordinate(t,a))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const l=a.pointCoordinate(t);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const l=a||0,h=[t.x,t.y,0,1],_=[t.x,t.y,1,1];d.aI(h,h,this._pixelMatrixInverse),d.aI(_,_,this._pixelMatrixInverse);const v=h[3],w=_[3],S=h[1]/v,A=_[1]/w,z=h[2]/v,R=_[2]/w,I=z===R?0:(l-z)/(R-z);return new d.ab(d.G.number(h[0]/v,_[0]/w,I)/this.worldSize,d.G.number(S,A,I)/this.worldSize,l)}coordinatePoint(t,a=0,l=this._pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,a,1];return d.aI(h,h,l),new d.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this._helper._height/2-Ti(this));return new pn().extend(this.screenPointToLocation(new d.P(0,t))).extend(this.screenPointToLocation(new d.P(this._helper._width,t))).extend(this.screenPointToLocation(new d.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new d.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-Ti(this)}calculatePosMatrix(t,a=!1,l){var h;const _=(h=t.key)!==null&&h!==void 0?h:d.be(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),v=a?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(_)){const A=v.get(_);return l?A.f32:A.f64}const w=fi(t,this.worldSize);d.S(w,a?this._alignedProjMatrix:this._viewProjMatrix,w);const S={f64:w,f32:new Float32Array(w)};return v.set(_,S),l?S.f32:S.f64}calculateFogMatrix(t){const a=t.key,l=this._fogMatrixCacheF32;if(l.has(a))return l.get(a);const h=fi(t,this.worldSize);return d.S(h,this._fogMatrix,h),l.set(a,new Float32Array(h)),l.get(a)}calculateCenterFromCameraLngLatAlt(t,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,h)}_calculateNearFarZIfNeeded(t,a,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=t-h*this._helper._pixelPerMeter/Math.cos(a),v=h<0?_:t,w=Math.PI/2+this.pitchInRadians,S=d.aq(this.fov)*(Math.abs(Math.cos(d.aq(this.roll)))*this.height+Math.abs(Math.sin(d.aq(this.roll)))*this.width)/this.height*(.5+l.y/this.height),A=Math.sin(S)*v/Math.sin(d.ao(Math.PI-w-S,.01,Math.PI-.01)),z=Ti(this),R=Math.atan(z/this._helper.cameraToCenterDistance),I=d.aq(.75),F=R>I?2*R*(.5+l.y/(2*z)):I,U=Math.sin(F)*v/Math.sin(d.ao(Math.PI-w-F,.01,Math.PI-.01)),X=Math.min(A,U);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*X+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=Pt(this.worldSize,this.center),l=a.x,h=a.y;this._helper._pixelPerMeter=d.at(1,this.center.lat)*this.worldSize;const _=d.aq(Math.min(this.pitch,bt)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let w;this._calculateNearFarZIfNeeded(v,_,t),w=new Float64Array(16),d.bf(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),d.aC(this._invProjMatrix,w),w[8]=2*-t.x/this._helper._width,w[9]=2*t.y/this._helper._height,this._projectionMatrix=d.bg(w),d.Q(w,w,[1,-1,1]),d.O(w,w,[0,0,-this._helper.cameraToCenterDistance]),d.bh(w,w,-this.rollInRadians),d.bi(w,w,this.pitchInRadians),d.bh(w,w,-this.bearingInRadians),d.O(w,w,[-l,-h,0]),this._mercatorMatrix=d.Q([],w,[this.worldSize,this.worldSize,this.worldSize]),d.Q(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=d.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),d.O(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=d.aC([],w);const S=[0,0,-1,1];d.aI(S,S,this._invViewProjMatrix),this._cameraPosition=[S[0]/S[3],S[1]/S[3],S[2]/S[3]],this._fogMatrix=new Float64Array(16),d.bf(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,d.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),d.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),d.bh(this._fogMatrix,this._fogMatrix,-this.rollInRadians),d.bi(this._fogMatrix,this._fogMatrix,this.pitchInRadians),d.bh(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),d.O(this._fogMatrix,this._fogMatrix,[-l,-h,0]),d.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),d.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=d.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);const A=this._helper._width%2/2,z=this._helper._height%2/2,R=Math.cos(this.bearingInRadians),I=Math.sin(-this.bearingInRadians),F=l-Math.round(l)+R*A+I*z,U=h-Math.round(h)+R*z+I*A,X=new Float64Array(w);if(d.O(X,X,[F>.5?F-1:F,U>.5?U-1:U,0]),this._alignedProjMatrix=X,w=d.aC(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new d.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return d.aI(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=d.at(1,this.center.lat)*this.worldSize;return be(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const l=d.ab.fromLngLat(t),h=[l.x*this.worldSize,l.y*this.worldSize,a,1];return d.aI(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(t){const{overscaledTileID:a,aligned:l,applyTerrainMatrix:h}=t,_=this._helper.getMercatorTileCoordinates(a),v=a?this.calculatePosMatrix(a,l,!0):null;let w;return w=a&&a.terrainRttPosMatrix32f&&h?a.terrainRttPosMatrix32f:v||d.bj(),{mainMatrix:w,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,l){return 1}transformLightDirection(t){return d.b2(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,l,h){const _=this.calculatePosMatrix(l);let v;h?(v=[t,a,h(t,a),1],d.aI(v,v,_)):(v=[t,a,0,1],_a(v,v,_));const w=v[3];return{point:new d.P(v[0]/w,v[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const l=d.ab.fromLngLat(t,a),h=l.meterInMercatorCoordinateUnits(),_=d.bk();return d.O(_,_,[l.x,l.y,l.z]),d.bh(_,_,Math.PI),d.bi(_,_,Math.PI/2),d.Q(_,_,[-h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const a=new d.a2(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),h=fi(a,this.worldSize);d.S(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const _=[d.a5,d.a5,this.worldSize/this._helper.pixelsPerMeter],v=d.bl();return d.Q(v,h,_),l.fallbackMatrix=v,l.mainMatrix=v,l}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Dr(){d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function du(m){if(m.useSlerp)if(m.k<1){const t=d.bm(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),a=d.bm(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),l=new Float64Array(4);d.bn(l,t,a,m.k);const h=d.bo(l);m.tr.setRoll(h.roll),m.tr.setPitch(h.pitch),m.tr.setBearing(h.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(d.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(d.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(d.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function Ro(m,t,a,l,h){const _=h.padding,v=Pt(h.worldSize,a.getNorthWest()),w=Pt(h.worldSize,a.getNorthEast()),S=Pt(h.worldSize,a.getSouthEast()),A=Pt(h.worldSize,a.getSouthWest()),z=d.aq(-l),R=v.rotate(z),I=w.rotate(z),F=S.rotate(z),U=A.rotate(z),X=new d.P(Math.max(R.x,I.x,U.x,F.x),Math.max(R.y,I.y,U.y,F.y)),W=new d.P(Math.min(R.x,I.x,U.x,F.x),Math.min(R.y,I.y,U.y,F.y)),Y=X.sub(W),Q=(h.width-(_.left+_.right+t.left+t.right))/Y.x,ne=(h.height-(_.top+_.bottom+t.top+t.bottom))/Y.y;if(ne<0||Q<0)return void Dr();const K=Math.min(d.au(h.scale*Math.min(Q,ne)),m.maxZoom),se=d.P.convert(m.offset),ue=new d.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(d.aq(l)),te=se.add(ue).mult(h.scale/d.ar(K));return{center:Gt(h.worldSize,v.add(S).div(2).sub(te)),zoom:K,bearing:l}}class Lo{get useGlobeControls(){return!1}handlePanInertia(t,a){const l=t.mag(),h=Math.abs(Ti(a));return{easingOffset:t.mult(Math.min(.75*h/l,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,l){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(l,t.around)}cameraForBoxAndBearing(t,a,l,h,_){return Ro(t,a,l,h,_)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(d.V.convert(a.center))}handleEaseTo(t,a){const l=t.zoom,h=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},v={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},w=a.zoom!==void 0,S=!t.isPaddingEqual(a.padding);let A=!1;const z=w?+a.zoom:t.zoom;let R=t.centerPoint.add(a.offsetAsPoint);const I=t.screenPointToLocation(R),{center:F,zoom:U}=t.applyConstrain(d.V.convert(a.center||I),z??l);is(t,F);const X=Pt(t.worldSize,I),W=Pt(t.worldSize,F).sub(X),Y=d.ar(U-l);return A=U!==l,{easeFunc:Q=>{if(A&&t.setZoom(d.G.number(l,U,Q)),d.bp(_,v)||du({startEulerAngles:_,endEulerAngles:v,tr:t,k:Q,useSlerp:_.roll!=v.roll}),S&&(t.interpolatePadding(h,a.padding,Q),R=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const ne=d.ar(t.zoom-l),K=U>l?Math.min(2,Y):Math.max(.5,Y),se=Math.pow(K,1-Q),ue=Gt(t.worldSize,X.add(W.mult(Q*se)).mult(ne));t.setLocationAtPoint(t.renderWorldCopies?ue.wrap():ue,R)}},isZooming:A,elevationCenter:F}}handleFlyTo(t,a){const l=a.zoom!==void 0,h=t.zoom,_=t.applyConstrain(d.V.convert(a.center||a.locationAtOffset),l?+a.zoom:h),v=_.center,w=_.zoom;is(t,v);const S=Pt(t.worldSize,a.locationAtOffset),A=Pt(t.worldSize,v).sub(S),z=A.mag(),R=d.ar(w-h);let I;if(a.minZoom!==void 0){const F=Math.min(+a.minZoom,h,w),U=t.applyConstrain(v,F).zoom;I=d.ar(U-h)}return{easeFunc:(F,U,X,W)=>{t.setZoom(F===1?w:h+d.au(U));const Y=F===1?v:Gt(t.worldSize,S.add(A.mult(X)).mult(U));t.setLocationAtPoint(t.renderWorldCopies?Y.wrap():Y,W)},scaleOfZoom:R,targetCenter:v,scaleOfMinZoom:I,pixelPathLength:z}}}class Pi{constructor(t,a,l){this.blendFunction=t,this.blendColor=a,this.mask=l}}Pi.Replace=[1,0],Pi.disabled=new Pi(Pi.Replace,d.bq.transparent,[!1,!1,!1,!1]),Pi.unblended=new Pi(Pi.Replace,d.bq.transparent,[!0,!0,!0,!0]),Pi.alphaBlended=new Pi([1,771],d.bq.transparent,[!0,!0,!0,!0]);const Js=2305;class ei{constructor(t,a,l){this.enable=t,this.mode=a,this.frontFace=l}}ei.disabled=new ei(!1,1029,Js),ei.backCCW=new ei(!0,1029,Js),ei.frontCCW=new ei(!0,1028,Js);class Yt{constructor(t,a,l){this.func=t,this.mask=a,this.range=l}}Yt.ReadOnly=!1,Yt.ReadWrite=!0,Yt.disabled=new Yt(519,Yt.ReadOnly,[0,1]);const Bo=7680;class mi{constructor(t,a,l,h,_,v){this.test=t,this.ref=a,this.mask=l,this.fail=h,this.depthFail=_,this.pass=v}}mi.disabled=new mi({func:519,mask:0},0,0,Bo,Bo,Bo);const fu=new WeakMap;function va(m){var t;if(fu.has(m))return fu.get(m);{const a=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return fu.set(m,a),a}}class eo{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,l=a.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new d.aX;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const _=new d.aZ;_.emplaceBack(0,1,2),this._fullscreenTriangle=new Ni(a.createVertexBuffer(h,ya.members),a.createIndexBuffer(_),d.aY.simpleSegment(0,0,h.length,_.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(l.TEXTURE1);const v=l.createTexture();l.bindTexture(l.TEXTURE_2D,v),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),va(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:d.bq.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,Yt.disabled,mi.disabled,Pi.unblended,ei.disabled,((_,v)=>({u_input:_,u_output_expected:v}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&va(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const _=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&va(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return d.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=eo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const to=d.a5/128;function Sd(m,t){const a=m.granularity!==void 0?Math.max(m.granularity,1):1,l=a+(m.generateBorders?2:0),h=a+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),_=l+1,v=h+1,w=m.generateBorders?-1:0,S=m.generateBorders||m.extendToNorthPole?-1:0,A=a+(m.generateBorders?1:0),z=a+(m.generateBorders||m.extendToSouthPole?1:0),R=_*v,I=l*h*6,F=_*v>65536;if(F&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const U=F||t==="32bit",X=new Int16Array(2*R);let W=0;for(let ne=S;ne<=z;ne++)for(let K=w;K<=A;K++){let se=K/a*d.a5;K===-1&&(se=-to),K===a+1&&(se=d.a5+to);let ue=ne/a*d.a5;ne===-1&&(ue=m.extendToNorthPole?d.bs:-to),ne===a+1&&(ue=m.extendToSouthPole?d.bt:d.a5+to),X[W++]=se,X[W++]=ue}const Y=U?new Uint32Array(I):new Uint16Array(I);let Q=0;for(let ne=0;ne<h;ne++)for(let K=0;K<l;K++){const se=K+1+ne*_,ue=K+(ne+1)*_,te=K+1+(ne+1)*_;Y[Q++]=K+ne*_,Y[Q++]=ue,Y[Q++]=se,Y[Q++]=se,Y[Q++]=ue,Y[Q++]=te}return{vertices:X.buffer.slice(0),indices:Y.buffer.slice(0),uses32bitIndices:U}}const pu=new d.aW({fill:new d.bu(128,2),line:new d.bu(512,0),tile:new d.bu(128,32),stencil:new d.bu(128,1),circle:3});class mh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Wi.projectionGlobe}get vertexShaderPreludeCode(){return Wi.projectionMercator.vertexSource}get subdivisionGranularity(){return pu}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new eo(t));const a=d.X(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(a,l),_=rt();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=_);const v=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=d.bv(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,d.bw(v))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,l,h,_){const v=(_==="stencil"?pu.stencil:pu.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:v,generateBorders:l,extendToNorthPole:a.y===0&&h,extendToSouthPole:a.y===(1<<a.z)-1&&h})}_getMesh(t,a){const l=this._getMeshKey(a);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=(function(_,v){const w=Sd(v,"16bit"),S=d.aX.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),A=d.aZ.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new Ni(_.createVertexBuffer(S,ya.members),_.createIndexBuffer(A),d.aY.simpleSegment(0,0,S.length,A.length))})(t,a);return this._tileMeshCache[l]=h,h}recalculate(t){}hasTransition(){const t=rt();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const If=new d.t({type:new d.D(d.u.projection.type)});class gh extends d.E{constructor(t){super(),this._transitionable=new d.x(If,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.H(0)),this._mercatorProjection=new Wn,this._verticalPerspectiveProjection=new mh}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof d.bx){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,l,h,_){return this.currentProjection.getMeshFromTileID(t,a,l,h,_)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Pr(m){const t=ko(m.worldSize,m.center.lat);return 2*Math.PI*t}function ns(m,t,a,l,h){const _=1/(1<<h),v=t/d.a5*_+l*_,w=d.bz((m/d.a5*_+a*_)*Math.PI*2+Math.PI,2*Math.PI),S=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,A=Math.cos(S),z=new Float64Array(3);return z[0]=Math.sin(w)*A,z[1]=Math.sin(S),z[2]=Math.cos(w)*A,z}function Ki(m){return(function(t,a){const l=Math.cos(a),h=new Float64Array(3);return h[0]=Math.sin(t)*l,h[1]=Math.sin(a),h[2]=Math.cos(t)*l,h})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function ko(m,t){return m/(2*Math.PI)/Math.cos(t*Math.PI/180)}function mu(m){const t=Math.asin(m[1])/Math.PI*180,a=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(a>1e-6){const l=m[0]/a,h=Math.acos(m[2]/a),_=(l>0?h:-h)/Math.PI*180;return new d.V(d.W(_,-180,180),t)}return new d.V(0,t)}function gu(m){return Math.cos(m*Math.PI/180)}function _n(m,t){const a=gu(m),l=gu(t);return d.au(l/a)}function Md(m,t){const a=m.rotate(t.bearingInRadians),l=t.zoom+_n(t.center.lat,0),h=d.bv(1/gu(t.center.lat),1/gu(Math.min(Math.abs(t.center.lat),60)),d.by(l,7,3,0,1)),_=360/Pr({worldSize:t.worldSize,center:{lat:t.center.lat}});return new d.V(t.center.lng-a.x*_*h,d.ao(t.center.lat+a.y*_,-d.ap,d.ap))}function cc(m){const t=.5*m,a=Math.sin(t),l=Math.cos(t);return Math.log(a+l)-Math.log(l-a)}function Ed(m,t,a,l){const h=m.lat+a*l;if(Math.abs(a)>1){const _=(Math.sign(m.lat+a)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,v=Math.abs(m.lat+a)*Math.PI/180,w=cc(_+l*(v-_)),S=cc(_),A=cc(v);return new d.V(m.lng+t*((w-S)/(A-S)),h)}return new d.V(m.lng+t*l,h)}class Rf{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,l,h){const _=`${t.z}_${t.x}_${t.y}_${h?.terrain?"t":""}`,v=this._cache.get(_);if(v)return v;const w=this._cachePrevious.get(_);if(w)return this._cache.set(_,w),w;const S=this._boundingVolumeFactory(t,a,l,h);return this._cache.set(_,S),this._hadAnyChanges=!0,S}}class Tl{constructor(t,a,l,h){this.min=l,this.max=h,this.points=t,this.planes=a}static fromAabb(t,a){const l=[];for(let h=0;h<8;h++)l.push([1&~h?t[0]:a[0],(h>>1&1)==1?a[1]:t[1],(h>>2&1)==1?a[2]:t[2]]);return new Tl(l,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,l){const h=d.bC([],l[0],l[1],l[2]),_=d.bD([],[a[0],0,0],h),v=d.bD([],[0,a[1],0],h),w=d.bD([],[0,0,a[2]],h),S=[...t],A=[...t];for(let R=0;R<8;R++)for(let I=0;I<3;I++){const F=t[I]+_[I]*(1&~R?-1:1)+v[I]*((R>>1&1)==1?1:-1)+w[I]*((R>>2&1)==1?1:-1);S[I]=Math.min(S[I],F),A[I]=Math.max(A[I],F)}const z=[];for(let R=0;R<8;R++){const I=[...t];d.b1(I,I,d.b0([],_,1&~R?-1:1)),d.b1(I,I,d.b0([],v,(R>>1&1)==1?1:-1)),d.b1(I,I,d.b0([],w,(R>>2&1)==1?1:-1)),z.push(I)}return new Tl(z,[[..._,-d.b6(_,z[0])],[...v,-d.b6(v,z[0])],[...w,-d.b6(w,z[0])],[-_[0],-_[1],-_[2],-d.b6(_,z[7])],[-v[0],-v[1],-v[2],-d.b6(v,z[7])],[-w[0],-w[1],-w[2],-d.b6(w,z[7])]],S,A)}intersectsFrustum(t){let a=!0;const l=this.points.length,h=this.planes.length,_=t.planes.length,v=t.points.length;for(let w=0;w<_;w++){const S=t.planes[w];let A=0;for(let z=0;z<l;z++){const R=this.points[z];S[0]*R[0]+S[1]*R[1]+S[2]*R[2]+S[3]>=0&&A++}if(A===0)return 0;A<l&&(a=!1)}if(a)return 2;for(let w=0;w<h;w++){const S=this.planes[w];let A=0;for(let z=0;z<v;z++){const R=t.points[z];S[0]*R[0]+S[1]*R[1]+S[2]*R[2]+S[3]>=0&&A++}if(A===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let l=0;for(let h=0;h<a;h++){const _=this.points[h];t[0]*_[0]+t[1]*_[1]+t[2]*_[2]+t[3]>=0&&l++}return l===a?2:l===0?0:1}}function hc(m,t,a){const l=m-t;return l<0?-l:Math.max(0,l-a)}function Sl(m,t,a,l,h){const _=m-a;let v;return v=_<0?Math.min(-_,1+_-h):_>1?Math.min(Math.max(_-h,0),1-_):0,Math.max(v,hc(t,l,h))}class _h{constructor(){this._boundingVolumeCache=new Rf(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,l,h){const _=1<<l.z,v=1/_,w=l.x/_,S=l.y/_;let A=2;return A=Math.min(A,Sl(t,a,w,S,v)),A=Math.min(A,Sl(t,a,w+.5,-S-v,v)),A=Math.min(A,Sl(t,a,w+.5,2-S-v,v)),A}getWrap(t,a,l){const h=1<<a.z,_=1/h,v=a.x/h,w=hc(t.x,v,_),S=hc(t.x,v-1,_),A=hc(t.x,v+1,_),z=Math.min(w,S,A);return z===A?1:z===S?-1:0}allowVariableZoom(t,a){return Di(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,l,h){return this._boundingVolumeCache.getTileBoundingVolume(t,a,l,h)}_computeTileBoundingVolume(t,a,l,h){var _,v;let w=0,S=0;if(h?.terrain){const A=new d.a2(t.z,a,t.z,t.x,t.y),z=h.terrain.getMinMaxElevation(A);w=(_=z.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=z.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}if(w/=d.bF,S/=d.bF,w+=1,S+=1,t.z<=0)return Tl.fromAabb([-S,-S,-S],[S,S,S]);if(t.z===1)return Tl.fromAabb([t.x===0?-S:0,t.y===0?0:-S,-S],[t.x===0?0:S,t.y===0?S:0,S]);{const A=[ns(0,0,t.x,t.y,t.z),ns(d.a5,0,t.x,t.y,t.z),ns(d.a5,d.a5,t.x,t.y,t.z),ns(0,d.a5,t.x,t.y,t.z)],z=[];for(const Ce of A)z.push(d.b0([],Ce,S));if(S!==w)for(const Ce of A)z.push(d.b0([],Ce,w));t.y===0&&z.push([0,1,0]),t.y===(1<<t.z)-1&&z.push([0,-1,0]);const R=[1,1,1],I=[-1,-1,-1];for(const Ce of z)for(let De=0;De<3;De++)R[De]=Math.min(R[De],Ce[De]),I[De]=Math.max(I[De],Ce[De]);const F=ns(d.a5/2,d.a5/2,t.x,t.y,t.z),U=d.b5([],[0,1,0],F);d.b4(U,U);const X=d.b5([],F,U);d.b4(X,X);const W=d.b5([],A[2],A[1]);d.b4(W,W);const Y=d.b5([],A[0],A[3]);d.b4(Y,Y),z.push(d.b0([],F,S)),t.y>=(1<<t.z)/2&&z.push(d.b0([],ns(d.a5/2,0,t.x,t.y,t.z),S)),t.y<(1<<t.z)/2&&z.push(d.b0([],ns(d.a5/2,d.a5,t.x,t.y,t.z),S));const Q=_u(F,z),ne=_u(X,z),K=[-F[0],-F[1],-F[2],Q.max],se=[F[0],F[1],F[2],-Q.min],ue=[-X[0],-X[1],-X[2],ne.max],te=[X[0],X[1],X[2],-ne.min],me=[...W,0],Ae=[...Y,0],we=[];return t.y===0?we.push(d.bE(Ae,me,K),d.bE(Ae,me,se)):we.push(d.bE(ue,me,K),d.bE(ue,me,se),d.bE(ue,Ae,K),d.bE(ue,Ae,se)),t.y===(1<<t.z)-1?we.push(d.bE(Ae,me,K),d.bE(Ae,me,se)):we.push(d.bE(te,me,K),d.bE(te,me,se),d.bE(te,Ae,K),d.bE(te,Ae,se)),new Tl(we,[K,se,ue,te,me,Ae],R,I)}}}function _u(m,t){let a=1/0,l=-1/0;for(const h of t){const _=d.b6(m,h);a=Math.min(a,_),l=Math.max(l,_)}return{min:a,max:l}}class Ml{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=d.bG(),this._projectionMatrix=d.bk(),this._globeViewProjMatrix32f=d.bj(),this._globeViewProjMatrixNoCorrection=d.bk(),this._globeViewProjMatrixNoCorrectionInverted=d.bk(),this._globeProjMatrixInverted=d.bk(),this._cameraPosition=d.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,l)=>{const h=d.ao(a.lat,-d.ap,d.ap),_=d.ao(+l,this.minZoom+_n(0,h),this.maxZoom);return{center:new d.V(a.lng,h),zoom:_}},this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new Ks({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._coveringTilesDetailsProvider=new _h}clone(){const t=new Ml;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=d.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:l}=t,h=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,l=this.cameraToCenterDistance/t,h=Math.sin(a)*l,_=Math.cos(a)*l+1,v=1/Math.sqrt(h*h+_*_)*1;let w=-h,S=_;const A=Math.sqrt(w*w+S*S);w/=A,S/=A;const z=[0,w,S];d.bH(z,z,[0,0,0],-this.bearingInRadians),d.bI(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),d.bJ(z,z,[0,0,0],this.center.lng*Math.PI/180);const R=1/d.b8(z);return d.b0(z,z,R),[...z,-v*R]}isLocationOccluded(t){return!this.isSurfacePointVisible(Ki(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),_=[Math.sin(a)*h,Math.sin(l),Math.cos(a)*h],v=[_[2],0,-_[0]],w=[0,0,0];d.b5(w,v,_),d.b4(v,v),d.b4(w,w);const S=[0,0,0];return d.b4(S,[v[0]*t[0]+w[0]*t[1]+_[0]*t[2],v[1]*t[0]+w[1]*t[1]+_[1]*t[2],v[2]*t[0]+w[2]*t[1]+_[2]*t[2]]),S}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,l){const h=(function(w,S,A){const z=1/(1<<A.z);return new d.ab(w/d.a5*z+A.x*z,S/d.a5*z+A.y*z)})(t,a,l.canonical),_=(v=h.y,[d.bz(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(t,a,l,h){const _=l.canonical,v=ns(t,a,_.x,_.y,_.z),w=1+(h?h(t,a):0)/d.bF,S=[v[0]*w,v[1]*w,v[2]*w,1];d.aI(S,S,this._globeViewProjMatrixNoCorrection);const A=this._cachedClippingPlane,z=A[0]*v[0]+A[1]*v[1]+A[2]*v[2]+A[3]<0;return{point:new d.P(S[0]/S[3],S[1]/S[3]),signedDistanceFromCamera:S[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=ko(this.worldSize,this.center.lat),a=d.bl(),l=d.bl();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),d.bf(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;a[8]=2*-h.x/this._helper._width,a[9]=2*h.y/this._helper._height,this._projectionMatrix=d.bg(a),this._globeProjMatrixInverted=d.bl(),d.aC(this._globeProjMatrixInverted,a),d.O(a,a,[0,0,-this.cameraToCenterDistance]),d.bh(a,a,this.rollInRadians),d.bi(a,a,-this.pitchInRadians),d.bh(a,a,this.bearingInRadians),d.O(a,a,[0,0,-t]);const _=d.bA();_[0]=t,_[1]=t,_[2]=t,d.bi(l,a,this.center.lat*Math.PI/180),d.bK(l,l,-this.center.lng*Math.PI/180),d.Q(l,l,_),this._globeViewProjMatrixNoCorrection=l,d.bi(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),d.bK(a,a,-this.center.lng*Math.PI/180),d.Q(a,a,_),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=d.bl(),d.aC(this._globeViewProjMatrixNoCorrectionInverted,l);const v=d.bA();this._cameraPosition=d.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,d.bH(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),d.bI(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),d.bH(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),d.b1(this._cameraPosition,this._cameraPosition,[0,0,1]),d.bI(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),d.bJ(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const w=d.bg(this._globeViewProjMatrixNoCorrectionInverted);d.Q(w,w,[1,1,-1]),this._cachedFrustum=zr.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){d.w("calculateFogMatrix is not supported on globe projection.");const a=d.bl();return d.as(a),a}getVisibleUnwrappedCoordinates(t){return[new d.bd(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&d.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Ki(t);d.b0(l,l,1+a/d.bF);const h=d.bG();return d.aI(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,l=[new d.P(0,0),new d.P(t,0),new d.P(this.width,0),new d.P(this.width,a),new d.P(this.width,this.height),new d.P(t,this.height),new d.P(0,this.height),new d.P(0,a)],h=[];for(const R of l)h.push(this.unprojectScreenPoint(R));let _=0,v=0,w=0,S=0;const A=this.center;for(const R of h){const I=d.bL(A.lng,R.lng),F=d.bL(A.lat,R.lat);I<v&&(v=I),I>_&&(_=I),F<S&&(S=F),F>w&&(w=F)}const z=[A.lng+v,A.lat+S,A.lng+_,A.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new pn(z)}calculateCenterFromCameraLngLatAlt(t,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,h)}setLocationAtPoint(t,a){const l=Ki(this.unprojectScreenPoint(a)),h=Ki(t),_=d.bA();d.bM(_);const v=d.bA();d.bJ(v,l,_,-this.center.lng*Math.PI/180),d.bI(v,v,_,this.center.lat*Math.PI/180);const w=h[0]*h[0]+h[2]*h[2],S=v[0]*v[0];if(w<S)return;const A=Math.sqrt(w-S),z=-A,R=d.bN(h[0],h[2],v[0],A),I=d.bN(h[0],h[2],v[0],z),F=d.bA();d.bJ(F,h,_,-R);const U=d.bN(F[1],F[2],v[1],v[2]),X=d.bA();d.bJ(X,h,_,-I);const W=d.bN(X[1],X[2],v[1],v[2]),Y=.5*Math.PI,Q=U>=-Y&&U<=Y,ne=W>=-Y&&W<=Y;let K,se;if(Q&&ne){const Ae=this.center.lng*Math.PI/180,we=this.center.lat*Math.PI/180;d.bO(R,Ae)+d.bO(U,we)<d.bO(I,Ae)+d.bO(W,we)?(K=R,se=U):(K=I,se=W)}else if(Q)K=R,se=U;else{if(!ne)return;K=I,se=W}const ue=K/Math.PI*180,te=se/Math.PI*180,me=this.center.lat;this.setCenter(new d.V(ue,d.ao(te,-90,90))),this.setZoom(this.zoom+_n(me,this.center.lat))}locationToScreenPoint(t,a){const l=Ki(t);if(a){const h=a.getElevationForLngLatZoom(t,this._helper._tileZoom);d.b0(l,l,1+h/d.bF)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(t){const a=d.bG();return d.aI(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new d.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const l=a.pointCoordinate(t);if(l)return l}return d.ab.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var l;return(l=this.screenPointToMercatorCoordinate(t,a))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(t,a){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(t){const a=d.bG();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,d.aI(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const l=d.bA();l[0]=a[0]-this._cameraPosition[0],l[1]=a[1]-this._cameraPosition[1],l[2]=a[2]-this._cameraPosition[2];const h=d.bA();return d.b4(h,l),h}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=d.bG();return d.aI(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const l=d.b6(t,a),h=d.bA(),_=d.bA();d.b0(_,a,l),d.b3(h,t,_);const v=1-d.b6(h,h);if(v<0)return null;const w=d.b6(t,t)-1,S=-l+(l<0?1:-1)*Math.sqrt(v),A=w/S,z=S;return{tMin:Math.min(A,z),tMax:Math.max(A,z)}}unprojectScreenPoint(t){const a=this._cameraPosition,l=this.getRayDirectionFromPixel(t),h=this.rayPlanetIntersection(a,l);if(h){const z=d.bA();d.b1(z,a,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const R=d.bA();return d.b4(R,z),mu(R)}const _=this._cachedClippingPlane,v=_[0]*l[0]+_[1]*l[1]+_[2]*l[2],w=-d.bc(_,a)/v,S=d.bA();if(w>0)d.b1(S,a,[l[0]*w,l[1]*w,l[2]*w]);else{const z=d.bA();d.b1(z,a,[2*l[0],2*l[1],2*l[2]]);const R=d.bc(this._cachedClippingPlane,z);d.b3(S,z,[this._cachedClippingPlane[0]*R,this._cachedClippingPlane[1]*R,this._cachedClippingPlane[2]*R])}const A=(function(z){const R=d.bA();return R[0]=z[0]*-z[3],R[1]=z[1]*-z[3],R[2]=z[2]*-z[3],{center:R,radius:Math.sqrt(1-z[3]*z[3])}})(_);return mu((function(z,R,I){const F=d.bA();d.b3(F,I,z);const U=d.bA();return d.bB(U,z,F,R/d.ba(F)),U})(A.center,A.radius,S))}getMatrixForModel(t,a){const l=d.V.convert(t),h=1/d.bF,_=d.bk();return d.bK(_,_,l.lng/180*Math.PI),d.bi(_,_,-l.lat/180*Math.PI),d.O(_,_,[0,0,1+a/d.bF]),d.bi(_,_,.5*Math.PI),d.Q(_,_,[h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new d.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class El{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,l=!0){this._helper.resize(t,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,l)=>this.currentTransform.defaultConstrain(a,l),this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new Ks({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._globeness=1,this._mercatorTransform=new kn,this._verticalPerspectiveTransform=new Ml}clone(){const t=new El;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),l=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:a.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return d.bv(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return d.bv(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,l){const h=this._mercatorTransform.getPitchedTextCorrection(t,a,l),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,l);return d.bv(h,_,this._globeness)}projectTileCoordinates(t,a,l,h){return this.currentTransform.projectTileCoordinates(t,a,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,h)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return l.fallbackMatrix=a.mainMatrix,l}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Sn{get useGlobeControls(){return!0}handlePanInertia(t,a){const l=Md(t,a);return Math.abs(l.lng-a.center.lng)>180&&(l.lng=a.center.lng+179.5*Math.sign(l.lng-a.center.lng)),{easingCenter:l,easingOffset:new d.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const l=t.around,h=a.screenPointToLocation(l);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const _=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const v=a.zoom-_;if(v===0)return;const w=d.bL(a.center.lng,h.lng),S=w/(Math.abs(w/180)+1),A=d.bL(a.center.lat,h.lat),z=a.getRayDirectionFromPixel(l),R=a.cameraPosition,I=-1*d.b6(R,z),F=d.bA();d.b1(F,R,[z[0]*I,z[1]*I,z[2]*I]);const U=d.b8(F)-1,X=Math.exp(.5*-Math.max(U-.3,0)),W=ko(a.worldSize,a.center.lat)/Math.min(a.width,a.height),Y=d.by(W,.9,.5,1,.25),Q=(1-d.ar(-v))*Math.min(X,Y),ne=a.center.lat,K=a.zoom,se=new d.V(a.center.lng+S*Q,d.ao(a.center.lat+A*Q,-d.ap,d.ap));a.setLocationAtPoint(h,l);const ue=a.center,te=d.by(Math.abs(w),45,85,0,1),me=d.by(W,.75,.35,0,1),Ae=Math.pow(Math.max(te,me),.25),we=d.bL(ue.lng,se.lng),Ce=d.bL(ue.lat,se.lat);a.setCenter(new d.V(ue.lng+we*Ae,ue.lat+Ce*Ae).wrap()),a.setZoom(K+_n(ne,a.center.lat))}handleMapControlsPan(t,a,l){if(!t.panDelta)return;const h=a.center.lat,_=a.zoom;a.setCenter(Md(t.panDelta,a).wrap()),a.setZoom(_+_n(h,a.center.lat))}cameraForBoxAndBearing(t,a,l,h,_){const v=Ro(t,a,l,h,_),w=a.left/_.width*2-1,S=(_.width-a.right)/_.width*2-1,A=a.top/_.height*-2+1,z=(_.height-a.bottom)/_.height*-2+1,R=d.bL(l.getWest(),l.getEast())<0,I=R?l.getEast():l.getWest(),F=R?l.getWest():l.getEast(),U=Math.max(l.getNorth(),l.getSouth()),X=Math.min(l.getNorth(),l.getSouth()),W=I+.5*d.bL(I,F),Y=U+.5*d.bL(U,X),Q=_.clone();Q.setCenter(v.center),Q.setBearing(v.bearing),Q.setPitch(0),Q.setRoll(0),Q.setZoom(v.zoom);const ne=Q.modelViewProjectionMatrix,K=[Ki(l.getNorthWest()),Ki(l.getNorthEast()),Ki(l.getSouthWest()),Ki(l.getSouthEast()),Ki(new d.V(F,Y)),Ki(new d.V(I,Y)),Ki(new d.V(W,U)),Ki(new d.V(W,X))],se=Ki(v.center);let ue=Number.POSITIVE_INFINITY;for(const te of K)w<0&&(ue=Sn.getLesserNonNegativeNonNull(ue,Sn.solveVectorScale(te,se,ne,"x",w))),S>0&&(ue=Sn.getLesserNonNegativeNonNull(ue,Sn.solveVectorScale(te,se,ne,"x",S))),A>0&&(ue=Sn.getLesserNonNegativeNonNull(ue,Sn.solveVectorScale(te,se,ne,"y",A))),z<0&&(ue=Sn.getLesserNonNegativeNonNull(ue,Sn.solveVectorScale(te,se,ne,"y",z)));if(Number.isFinite(ue)&&ue!==0)return v.zoom=Q.zoom+d.au(ue),v;Dr()}handleJumpToCenterZoom(t,a){const l=t.center.lat,h=t.applyConstrain(a.center?d.V.convert(a.center):t.center,t.zoom).center;t.setCenter(h.wrap());const _=a.zoom!==void 0?+a.zoom:t.zoom+_n(l,h.lat);t.zoom!==_&&t.setZoom(_)}handleEaseTo(t,a){const l=t.zoom,h=t.center,_=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},w={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},S=a.zoom!==void 0,A=!t.isPaddingEqual(a.padding);let z=!1;const R=a.center?d.V.convert(a.center):h,I=t.applyConstrain(R,l).center;is(t,I);const F=t.clone();F.setCenter(I),F.setZoom(S?+a.zoom:l+_n(h.lat,R.lat)),F.setBearing(a.bearing);const U=new d.P(d.ao(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),d.ao(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));F.setLocationAtPoint(I,U);const X=(a.offset&&a.offsetAsPoint.mag())>0?F.center:I,W=S?+a.zoom:l+_n(h.lat,X.lat),Y=l+_n(h.lat,0),Q=W+_n(X.lat,0),ne=d.bL(h.lng,X.lng),K=d.bL(h.lat,X.lat),se=d.ar(Q-Y);return z=W!==l,{easeFunc:ue=>{if(d.bp(v,w)||du({startEulerAngles:v,endEulerAngles:w,tr:t,k:ue,useSlerp:v.roll!=w.roll}),A&&t.interpolatePadding(_,a.padding,ue),a.around)d.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const te=Q>Y?Math.min(2,se):Math.max(.5,se),me=Math.pow(te,1-ue),Ae=Ed(h,ne,K,ue*me);t.setCenter(Ae.wrap())}if(z){const te=d.G.number(Y,Q,ue)+_n(0,t.center.lat);t.setZoom(te)}},isZooming:z,elevationCenter:X}}handleFlyTo(t,a){const l=a.zoom!==void 0,h=t.center,_=t.zoom,v=t.padding,w=!t.isPaddingEqual(a.padding),S=t.applyConstrain(d.V.convert(a.center||a.locationAtOffset),_).center,A=l?+a.zoom:t.zoom+_n(t.center.lat,S.lat),z=t.clone();z.setCenter(S),z.setZoom(A),z.setBearing(a.bearing);const R=new d.P(d.ao(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),d.ao(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));z.setLocationAtPoint(S,R);const I=z.center;is(t,I);const F=(function(K,se,ue){const te=Ki(se),me=Ki(ue),Ae=d.b6(te,me),we=Math.acos(Ae),Ce=Pr(K);return we/(2*Math.PI)*Ce})(t,h,I),U=_+_n(h.lat,0),X=A+_n(I.lat,0),W=d.ar(X-U);let Y;if(typeof a.minZoom=="number"){const K=+a.minZoom+_n(I.lat,0),se=Math.min(K,U,X)+_n(0,I.lat),ue=t.applyConstrain(I,se).zoom+_n(I.lat,0);Y=d.ar(ue-U)}const Q=d.bL(h.lng,I.lng),ne=d.bL(h.lat,I.lat);return{easeFunc:(K,se,ue,te)=>{const me=Ed(h,Q,ne,ue);w&&t.interpolatePadding(v,a.padding,K);const Ae=K===1?I:me;t.setCenter(Ae.wrap());const we=U+d.au(se);t.setZoom(K===1?A:we+_n(0,Ae.lat))},scaleOfZoom:W,targetCenter:I,scaleOfMinZoom:Y,pixelPathLength:F}}static solveVectorScale(t,a,l,h,_){const v=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],w=[l[3],l[7],l[11],l[15]],S=t[0]*v[0]+t[1]*v[1]+t[2]*v[2],A=t[0]*w[0]+t[1]*w[1]+t[2]*w[2],z=a[0]*v[0]+a[1]*v[1]+a[2]*v[2],R=a[0]*w[0]+a[1]*w[1]+a[2]*w[2];return z+_*A===S+_*R||w[3]*(S-z)+v[3]*(R-A)+S*R==z*A?null:(z+v[3]-_*R-_*w[3])/(z-S-_*R+_*A)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class Al{constructor(t){this._globe=t,this._mercatorCameraHelper=new Lo,this._verticalPerspectiveCameraHelper=new Sn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,l){this.currentHelper.handleMapControlsPan(t,a,l)}cameraForBoxAndBearing(t,a,l,h,_){return this.currentHelper.cameraForBoxAndBearing(t,a,l,h,_)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const Cl=(m,t)=>d.B(m,t&&t.filter((a=>a.identifier!=="source.canvas"))),zl=d.bP();class io extends d.E{constructor(t,a={}){var l,h;super(),this._rtlPluginLoaded=()=>{for(const v in this.tileManagers){const w=this.tileManagers[v].getSource().type;w!=="vector"&&w!=="geojson"||this.tileManagers[v].reload()}},this.map=t,this.dispatcher=new Jn(Ai(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((v,w)=>this.getGlyphs(v,w))),this.dispatcher.registerMessageHandler("GI",((v,w)=>this.getImages(v,w))),this.dispatcher.registerMessageHandler("GDA",((v,w)=>this.getDashes(v,w))),this.imageManager=new Jt,this.imageManager.setEventedParent(this);const _=((l=t._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new We(t._requestManager,a.localIdeographFontFamily,_),this.lineAtlas=new it(256,512),this.crossTileSymbolIndex=new Yn,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",d.bQ()),ye().on(oe,this._rtlPluginLoaded),this.on("data",(v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const w=this.tileManagers[v.sourceId];if(!w)return;const S=w.getSource();if(S&&S.vectorLayerIds)for(const A in this._layers){const z=this._layers[A];z.source===S.id&&this._validateLayer(z)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new d.bR,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var l,h,_;this._checkLoaded();const v=a===null?(_=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[t])===null||h===void 0?void 0:h.default)!==null&&_!==void 0?_:null:a;if(d.bS(v,this._globalState[t]))return this;this._globalState[t]=v,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const l in t)!d.bS(this._globalState[l],t[l].default)&&(a.push(l),this._globalState[l]=t[l].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,l={};for(const h of t){l[h]=this._globalState[h];for(const _ in this._layers){const v=this._layers[_],w=v.getLayoutAffectingGlobalStateRefs(),S=v.getPaintAffectingGlobalStateRefs();if(w.has(h)&&a.add(v.source),S.has(h))for(const{name:A,value:z}of S.get(h))this._updatePaintProperty(v,A,z)}}this.dispatcher.broadcast("UGS",l);for(const h in this.tileManagers)a.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(t,a={},l){this.fire(new d.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;d.j(h,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,a,l)})).catch((v=>{this._loadStyleRequest=null,v&&!_.signal.aborted&&this.fire(new d.k(v))}))}loadJSON(t,a={},l){this.fire(new d.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ct.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,l)})).catch((()=>{}))}loadEmpty(){this.fire(new d.l("dataloading",{dataType:"style"})),this._load(zl,{validate:!1})}_load(t,a,l){var h,_;let v=a.transformStyle?a.transformStyle(l,t):t;if(!a.validate||!Cl(this,d.C(v))){v=Object.assign({},v),this._loaded=!0,this.stylesheet=v;for(const w in v.sources)this.addSource(w,v.sources[w],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new St(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new ze(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new d.l("data",{dataType:"style"})),this.fire(new d.l("style.load"))}}_createLayers(){var t,a,l;const h=d.bT(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",h),this._order=h.map((_=>_.id)),this._layers={},this._serializedLayers=null;for(const _ of h){const v=d.bU(_,this._globalState);if(v.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=v,d.bV(v)&&this.tileManagers[v.source]){const w=(l=(a=_.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&l!==void 0?l:v.paint.get("raster-fade-duration");this.tileManagers[v.source].setRasterFadeDuration(w)}}}_loadSprite(t,a=!1,l=void 0){this.imageManager.setLoaded(!1);const h=new AbortController;let _;this._spriteRequest=h,(function(v,w,S,A){return d._(this,void 0,void 0,(function*(){const z=ti(v),R=S>1?"@2x":"",I={},F={};for(const{id:U,url:X}of z){const W=w.transformRequest(hi(X,R,".json"),"SpriteJSON");I[U]=d.j(W,A);const Y=w.transformRequest(hi(X,R,".png"),"SpriteImage");F[U]=gt.getImage(Y,A)}return yield Promise.all([...Object.values(I),...Object.values(F)]),(function(U,X){return d._(this,void 0,void 0,(function*(){const W={};for(const Y in U){W[Y]={};const Q=ct.getImageCanvasContext((yield X[Y]).data),ne=(yield U[Y]).data;for(const K in ne){const{width:se,height:ue,x:te,y:me,sdf:Ae,pixelRatio:we,stretchX:Ce,stretchY:De,content:Ke,textFitWidth:lt,textFitHeight:Ye}=ne[K];W[Y][K]={data:null,pixelRatio:we,sdf:Ae,stretchX:Ce,stretchY:De,content:Ke,textFitWidth:lt,textFitHeight:Ye,spriteData:{width:se,height:ue,x:te,y:me,context:Q}}}}return W}))})(I,F)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((v=>{if(this._spriteRequest=null,v)for(const w in v){this._spritesImagesIds[w]=[];const S=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter((A=>!(A in v))):[];for(const A of S)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in v[w]){const z=w==="default"?A:`${w}:${A}`;this._spritesImagesIds[w].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,v[w][A],!1):this.imageManager.addImage(z,v[w][A]),a&&(this._changedImages[z]=!0)}}})).catch((v=>{this._spriteRequest=null,_=v,h.signal.aborted||this.fire(new d.k(_))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"})),l&&l(_)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const l=t.sourceLayer;if(!l)return;const h=a.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const l=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?d.bW(l):l);const h=[];for(const _ of t)if(l[_]){const v=a?d.bW(l[_]):l[_];h.push(v)}return h}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const l of a){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){var t,a,l;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.tileManagers)if(this.tileManagers[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const h=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(h.length||_.length)&&this._updateWorkerLayers(h,_);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.tileManagers){const _=this.tileManagers[h];l[h]=_.used,_.used=!1}for(const h of this._order){const _=this._layers[h];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.tileManagers[_.source].used=!0)}for(const h in l){const _=this.tileManagers[h];!!l[h]!=!!_.used&&_.fire(new d.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new d.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var l;this._checkLoaded();const h=this.serialize();if(t=a.transformStyle?a.transformStyle(h,t):t,((l=a.validate)===null||l===void 0||l)&&Cl(this,d.C(t)))return!1;(t=d.bW(t)).layers=d.bT(t.layers);const _=d.bX(h,t),v=this._getOperationsToPerform(_);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],l=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,h.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,h.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,h.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,h.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,h.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,h.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,h.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,h.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,h.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,h.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,h.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,h.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,h.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,h.args)));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,h.args)));break;case"setTransition":a.push((()=>{}));break;default:l.push(h.command)}return{operations:a,unimplemented:l}}addImage(t,a){if(this.getImage(t))return this.fire(new d.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new d.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,l={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(d.C.source,`sources.${t}`,a,null,l))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const h=this.tileManagers[t]=new Hi(t,a,this.dispatcher);h.style=this,h.setEventedParent(this,(()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t}))),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new d.k(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new d.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.tileManagers[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new d.k(new Error(`Layer "${h}" already exists on this map.`)));let _;if(t.type==="custom"){if(Cl(this,d.bY(t)))return;_=d.bU(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=d.bW(t),t=d.e(t,{source:h})),this._validate(d.C.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;_=d.bU(t,this._globalState),this._validateLayer(_),_.setEventedParent(this,{layer:{id:h}})}const v=a?this._order.indexOf(a):this._order.length;if(a&&v===-1)this.fire(new d.k(new Error(`Cannot add layer "${h}" before non-existing layer "${a}".`)));else{if(this._order.splice(v,0,h),this._layerOrderChanged=!0,this._layers[h]=_,this._removedLayers[h]&&_.source&&_.type!=="custom"){const w=this._removedLayers[h];delete this._removedLayers[h],w.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.tileManagers[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new d.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=a?this._order.indexOf(a):this._order.length;a&&h===-1?this.fire(new d.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new d.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===a&&h.maxzoom===l||(a!=null&&(h.minzoom=a),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new d.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!d.bS(h.filter,a))return a==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(d.C.filter,`layers.${h.id}.filter`,a,null,l)||(h.setFilter(d.bW(a)),this._updateLayer(h)))}else this.fire(new d.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return d.bW(this.getLayer(t).filter)}setLayoutProperty(t,a,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?d.bS(_.getLayoutProperty(a),l)||(_.setLayoutProperty(a,l,h),this._updateLayer(_)):this.fire(new d.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const l=this.getLayer(t);if(l)return l.getLayoutProperty(a);this.fire(new d.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?d.bS(_.getPaintProperty(a),l)||this._updatePaintProperty(_,a,l,h):this.fire(new d.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,l,h={}){t.setPaintProperty(a,l,h)&&this._updateLayer(t),d.bV(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const l=t.source,h=t.sourceLayer,_=this.tileManagers[l];if(_===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const v=_.getSource().type;v==="geojson"&&h?this.fire(new d.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||h?(t.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(h,t.id,a)):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const l=t.source,h=this.tileManagers[l];if(h===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const _=h.getSource().type,v=_==="vector"?t.sourceLayer:void 0;_!=="vector"||v?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new d.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(v,t.id,a):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,l=t.sourceLayer,h=this.tileManagers[a];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=d.bZ(this.tileManagers,(_=>_.serialize())),a=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return d.b_({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:t,layers:a,terrain:l},(_=>_!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=v=>this._layers[v].type==="fill-extrusion",l={},h=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(a(w)){l[w]=v;for(const S of t){const A=S[w];if(A)for(const z of A)h.push(z)}}}h.sort(((v,w)=>w.intersectionZ-v.intersectionZ));const _=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(a(w))for(let S=h.length-1;S>=0;S--){const A=h[S].feature;if(l[A.layer.id]<v)break;_.push(A),h.pop()}else for(const S of t){const A=S[w];if(A)for(const z of A)_.push(z.feature)}}return _}queryRenderedFeatures(t,a,l){a&&a.filter&&this._validate(d.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const h={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new d.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const A of a.layers){const z=this._layers[A];if(!z)return this.fire(new d.k(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];h[z.source]=!0}}const _=[];a.availableImages=this._availableImages;const v=this._serializedAllLayers(),w=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,S=Object.assign(Object.assign({},a),{layers:w,globalState:this._globalState});for(const A in this.tileManagers)a.layers&&!h[A]||_.push(Pa(this.tileManagers[A],this._layers,v,t,S,l,this.map.terrain?(z,R,I)=>this.map.terrain.getElevation(z,R,I):void 0));return this.placement&&_.push((function(A,z,R,I,F,U,X){const W={},Y=U.queryRenderedSymbols(I),Q=[];for(const ne of Object.keys(Y).map(Number))Q.push(X[ne]);Q.sort(Zi);for(const ne of Q){const K=ne.featureIndex.lookupSymbolFeatures(Y[ne.bucketInstanceId],z,ne.bucketIndex,ne.sourceLayerIndex,{filterSpec:F.filter,globalState:F.globalState},F.layers,F.availableImages,A);for(const se in K){const ue=W[se]=W[se]||[],te=K[se];te.sort(((me,Ae)=>{const we=ne.featureSortOrder;if(we){const Ce=we.indexOf(me.featureIndex);return we.indexOf(Ae.featureIndex)-Ce}return Ae.featureIndex-me.featureIndex}));for(const me of te)ue.push(me)}}return(function(ne,K,se){for(const ue in ne)for(const te of ne[ue])dr(te,se[K[ue].source]);return ne})(W,A,R)})(this._layers,v,this.tileManagers,t,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,a){a?.filter&&this._validate(d.C.filter,"querySourceFeatures.filter",a.filter,null,a);const l=this.tileManagers[t];return l?(function(h,_){const v=h.getRenderableIds().map((A=>h.getTileByID(A))),w=[],S={};for(let A=0;A<v.length;A++){const z=v[A],R=z.tileID.canonical.key;S[R]||(S[R]=!0,z.querySourceFeatures(w,_))}return w})(l,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const v in t)if(!d.bS(t[v],l[v])){h=!0;break}if(!h)return;const _={now:rt(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(_)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!t&&!l)return;if(t&&!l)h=!0;else if(!t&&l)h=!0;else for(const v in t)if(!d.bS(t[v],l[v])){h=!0;break}if(!h)return;const _={now:rt(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(_)}_setProjectionInternal(t){const a=(function(l,h){const _={constrainOverride:h};if(Array.isArray(l)){const v=new gh({type:l});return{projection:v,transform:new El(_),cameraHelper:new Al(v)}}switch(l){case"mercator":return{projection:new Wn,transform:new kn(_),cameraHelper:new Lo};case"globe":{const v=new gh({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new El(_),cameraHelper:new Al(v)}}case"vertical-perspective":return{projection:new mh,transform:new Ml(_),cameraHelper:new Sn};default:return d.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Wn,transform:new kn(_),cameraHelper:new Lo}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const l in this.tileManagers)this.tileManagers[l].reload()}_validate(t,a,l,h,_={}){return(!_||_.validate!==!1)&&Cl(this,t.call(d.C,d.e({key:a,style:this.serialize(),value:l,styleSpec:d.u},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ye().off(oe,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const l=this.tileManagers[a];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,l,h,_=!1){let v=!1,w=!1;const S={};for(const A of this._order){const z=this._layers[A];if(z.type!=="symbol")continue;if(!S[z.source]){const I=this.tileManagers[z.source];S[z.source]=I.getRenderableIds(!0).map((F=>I.getTileByID(F))).sort(((F,U)=>U.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(U.tileID)?-1:1)))}const R=this.crossTileSymbolIndex.addLayer(z,S[z.source],t.center.lng);v=v||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(rt(),t.zoom))&&(this.pauseablePlacement=new wl(t,this.map.terrain,this._order,_,a,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(rt()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const A of this._order){const z=this._layers[A];z.type==="symbol"&&this.placement.updateLayerOpacities(z,S[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(rt())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return d._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const h=this.tileManagers[a.source];return h&&h.setDependencies(a.tileID.key,a.type,a.icons),l}))}getGlyphs(t,a){return d._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(a.stacks),h=this.tileManagers[a.source];return h&&h.setDependencies(a.tileID.key,a.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(d.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return d._(this,void 0,void 0,(function*(){const l={};for(const[h,_]of Object.entries(a.dashes))l[h]=this.lineAtlas.getDash(_.dasharray,_.round);return l}))}addSprite(t,a,l={},h){this._checkLoaded();const _=[{id:t,url:a}],v=[...ti(this.stylesheet.sprite),..._];this._validate(d.C.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(_,!0,h))}removeSprite(t){this._checkLoaded();const a=ti(this.stylesheet.sprite);if(a.find((l=>l.id===t))){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;a.splice(a.findIndex((l=>l.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}else this.fire(new d.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return ti(this.stylesheet.sprite)}setSprite(t,a={},l){this._checkLoaded(),t&&this._validate(d.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Ad=d.aV([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class yu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,l,h,_,v,w,S,A){this.context=t;let z=this.boundPaintVertexBuffers.length!==h.length;for(let R=0;!z&&R<h.length;R++)this.boundPaintVertexBuffers[R]!==h[R]&&(z=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==_||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==A?this.freshBind(a,l,h,_,v,w,S,A):(t.bindVertexArray.set(this.vao),w&&w.bind(),_&&_.dynamicDraw&&_.bind(),S&&S.bind(),A&&A.bind())}freshBind(t,a,l,h,_,v,w,S){const A=t.numAttributes,z=this.context,R=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=S,a.enableAttributes(R,t);for(const I of l)I.enableAttributes(R,t);v&&v.enableAttributes(R,t),w&&w.enableAttributes(R,t),S&&S.enableAttributes(R,t),a.bind(),a.setVertexAttribPointers(R,t,_);for(const I of l)I.bind(),I.setVertexAttribPointers(R,t,_);v&&(v.bind(),v.setVertexAttribPointers(R,t,_)),h&&h.bind(),w&&(w.bind(),w.setVertexAttribPointers(R,t,_)),S&&(S.bind(),S.setVertexAttribPointers(R,t,_)),z.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Cd=(m,t,a,l,h)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):d.bq.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:a?a.calculateFogBlendOpacity(l):0,u_horizon_color:a?a.properties.get("horizon-color"):d.bq.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),ka={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function dc(m){const t=[];for(let a=0;a<m.length;a++){if(m[a]===null)continue;const l=m[a].split(" ");t.push(l.pop())}return t}class zd{constructor(t,a,l,h,_,v,w,S,A=[]){const z=t.gl;this.program=z.createProgram();const R=dc(a.staticAttributes),I=l?l.getBinderAttributes():[],F=R.concat(I),U=Wi.prelude.staticUniforms?dc(Wi.prelude.staticUniforms):[],X=w.staticUniforms?dc(w.staticUniforms):[],W=a.staticUniforms?dc(a.staticUniforms):[],Y=l?l.getBinderUniforms():[],Q=U.concat(X).concat(W).concat(Y),ne=[];for(const we of Q)ne.indexOf(we)<0&&ne.push(we);const K=l?l.defines():[];va(z)&&K.unshift("#version 300 es"),_&&K.push("#define OVERDRAW_INSPECTOR;"),v&&K.push("#define TERRAIN3D;"),S&&K.push(S),A&&K.push(...A);let se=K.concat(Wi.prelude.fragmentSource,w.fragmentSource,a.fragmentSource).join(`
`),ue=K.concat(Wi.prelude.vertexSource,w.vertexSource,a.vertexSource).join(`
`);va(z)||(se=(function(we){return we.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(se),ue=(function(we){return we.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ue));const te=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(te,se),z.compileShader(te),!z.getShaderParameter(te,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(te)}`);z.attachShader(this.program,te);const me=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(me,ue),z.compileShader(me),!z.getShaderParameter(me,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(me)}`);z.attachShader(this.program,me),this.attributes={};const Ae={};this.numAttributes=F.length;for(let we=0;we<this.numAttributes;we++)F[we]&&(z.bindAttribLocation(this.program,we,F[we]),this.attributes[F[we]]=we);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(me),z.deleteShader(te);for(let we=0;we<ne.length;we++){const Ce=ne[we];if(Ce&&!Ae[Ce]){const De=z.getUniformLocation(this.program,Ce);De&&(Ae[Ce]=De)}}this.fixedUniforms=h(t,Ae),this.terrainUniforms=((we,Ce)=>({u_depth:new d.b$(we,Ce.u_depth),u_terrain:new d.b$(we,Ce.u_terrain),u_terrain_dim:new d.br(we,Ce.u_terrain_dim),u_terrain_matrix:new d.c1(we,Ce.u_terrain_matrix),u_terrain_unpack:new d.c2(we,Ce.u_terrain_unpack),u_terrain_exaggeration:new d.br(we,Ce.u_terrain_exaggeration)}))(t,Ae),this.projectionUniforms=((we,Ce)=>({u_projection_matrix:new d.c1(we,Ce.u_projection_matrix),u_projection_tile_mercator_coords:new d.c2(we,Ce.u_projection_tile_mercator_coords),u_projection_clipping_plane:new d.c2(we,Ce.u_projection_clipping_plane),u_projection_transition:new d.br(we,Ce.u_projection_transition),u_projection_fallback_matrix:new d.c1(we,Ce.u_projection_fallback_matrix)}))(t,Ae),this.binderUniforms=l?l.getUniforms(t,Ae):[]}draw(t,a,l,h,_,v,w,S,A,z,R,I,F,U,X,W,Y,Q,ne){const K=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(_),t.setCullFace(v),S){t.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,S.depthTexture),t.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,S.texture);for(const ue in this.terrainUniforms)this.terrainUniforms[ue].set(S[ue])}if(A)for(const ue in A)this.projectionUniforms[ka[ue]].set(A[ue]);if(w)for(const ue in this.fixedUniforms)this.fixedUniforms[ue].set(w[ue]);W&&W.setUniforms(t,this.binderUniforms,U,{zoom:X});let se=0;switch(a){case K.LINES:se=2;break;case K.TRIANGLES:se=3;break;case K.LINE_STRIP:se=1}for(const ue of F.get()){const te=ue.vaos||(ue.vaos={});(te[z]||(te[z]=new yu)).bind(t,this,R,W?W.getPaintVertexBuffers():[],I,ue.vertexOffset,Y,Q,ne),K.drawElements(a,ue.primitiveLength*se,K.UNSIGNED_SHORT,ue.primitiveOffset*se*2)}}}function Dd(m,t,a){const l=1/d.aO(a,1,t.transform.tileZoom),h=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,t.transform.tileZoom)/h,v=_*(a.tileID.canonical.x+a.tileID.wrap*h),w=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const fc=(m,t,a,l)=>{const h=m.style.light,_=h.properties.get("position"),v=[_.x,_.y,_.z],w=d.c5();h.properties.get("anchor")==="viewport"&&d.c6(w,m.transform.bearingInRadians),d.c7(v,v,w);const S=m.transform.transformLightDirection(v),A=h.properties.get("color");return{u_lightpos:v,u_lightpos_globe:S,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:l}},pc=(m,t,a,l,h,_,v)=>d.e(fc(m,t,a,l),Dd(_,m,v),{u_height_factor:-Math.pow(2,h.overscaledZ)/v.tileSize/8}),Oo=(m,t,a,l)=>d.e(Dd(t,m,a),{u_fill_translate:l}),Dl=(m,t)=>({u_world:m,u_fill_translate:t}),Pd=(m,t,a,l,h)=>d.e(Oo(m,t,a,h),{u_world:l}),vu=(m,t,a,l,h)=>{const _=m.transform;let v,w,S=0;if(a.paint.get("circle-pitch-alignment")==="map"){const A=d.aO(t,1,_.zoom);v=!0,w=[A,A],S=A/(d.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*h}else v=!1,w=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:S,u_translate:l}},no=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),yh=m=>({u_viewport_size:[m.width,m.height]}),xu=(m,t=1)=>({u_color:m,u_overlay:0,u_overlay_scale:t}),ro=(m,t,a,l)=>{const h=d.aO(m,1,t)/(d.a5*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:d.aO(m,1,t),u_intensity:a,u_globe_extrude_scale:h}},vh=(m,t,a,l)=>{const h=d.N();d.c8(h,0,m.width,m.height,0,0,1);const _=m.context.gl;return{u_matrix:h,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:a,u_color_ramp:l,u_opacity:t.paint.get("heatmap-opacity")}},bu=(m,t,a)=>{const l=a.paint.get("hillshade-accent-color");let h;switch(a.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const _=a.getIlluminationProperties();for(let v=0;v<_.directionRadians.length;v++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[v]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Lf(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:l,u_method:h,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},Id=(m,t)=>{const a=t.stride,l=d.N();return d.c8(l,0,d.a5,-d.a5,0,0,1),d.O(l,l,[0,-d.a5,0]),{u_matrix:l,u_image:1,u_dimension:[a,a],u_zoom:m.overscaledZ,u_unpack:t.getUnpackVector()}};function Lf(m,t){const a=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new d.ab(0,l/a).toLngLat().lat,new d.ab(0,(l+1)/a).toLngLat().lat]}const Rd=(m,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:m.paint.get("color-relief-opacity")}),wu=(m,t,a,l)=>{const h=m.transform;return{u_translation:Tu(m,t,a),u_ratio:l/d.aO(t,1,h.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ld=(m,t,a,l,h)=>d.e(wu(m,t,a,l),{u_image:0,u_image_height:h}),xh=(m,t,a,l,h)=>{const _=m.transform,v=xa(t,_);return{u_translation:Tu(m,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:l/d.aO(t,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Ur=(m,t,a,l,h)=>{const _=xa(t,m.transform);return d.e(wu(m,t,a,l),{u_tileratio:_,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image:0,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},ao=(m,t,a,l,h,_)=>{const v=xa(t,m.transform);return d.e(wu(m,t,a,l),{u_image:0,u_image_height:_,u_tileratio:v,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image_dash:1,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function xa(m,t){return 1/d.aO(m,1,t.tileZoom)}function Tu(m,t,a){return d.aP(m.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const mc=(m,t,a,l,h)=>{return{u_tl_parent:m,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(v=l.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(_=l.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:gc(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var _,v};function gc(m){m*=Math.PI/180;const t=Math.sin(m),a=Math.cos(m);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Su=(m,t,a,l,h,_,v,w,S,A,z,R,I)=>{const F=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:F.width/F.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:_,u_texsize:R,u_texture:0,u_translation:A,u_pitched_scale:I}},_c=(m,t,a,l,h,_,v,w,S,A,z,R,I,F)=>{const U=v.transform;return d.e(Su(m,t,a,l,h,_,v,w,S,A,z,R,F),{u_gamma_scale:l?Math.cos(U.pitch*Math.PI/180)*U.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},ba=(m,t,a,l,h,_,v,w,S,A,z,R,I)=>d.e(_c(m,t,a,l,h,_,v,w,S,A,!0,z,0,I),{u_texsize_icon:R,u_texture_icon:1}),Mu=(m,t)=>({u_opacity:m,u_color:t}),Eu=(m,t,a,l,h)=>d.e((function(_,v,w,S){const A=w.imageManager.getPattern(_.from.toString()),z=w.imageManager.getPattern(_.to.toString()),{width:R,height:I}=w.imageManager.getPixelSize(),F=Math.pow(2,S.tileID.overscaledZ),U=S.tileSize*Math.pow(2,w.transform.tileZoom)/F,X=U*(S.tileID.canonical.x+S.tileID.wrap*F),W=U*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[R,I],u_mix:v.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/d.aO(S,1,w.transform.tileZoom),u_pixel_coord_upper:[X>>16,W>>16],u_pixel_coord_lower:[65535&X,65535&W]}})(a,h,t,l),{u_opacity:m}),yc=(m,t)=>{},Bd={fillExtrusion:(m,t)=>({u_lightpos:new d.c3(m,t.u_lightpos),u_lightpos_globe:new d.c3(m,t.u_lightpos_globe),u_lightintensity:new d.br(m,t.u_lightintensity),u_lightcolor:new d.c3(m,t.u_lightcolor),u_vertical_gradient:new d.br(m,t.u_vertical_gradient),u_opacity:new d.br(m,t.u_opacity),u_fill_translate:new d.c4(m,t.u_fill_translate)}),fillExtrusionPattern:(m,t)=>({u_lightpos:new d.c3(m,t.u_lightpos),u_lightpos_globe:new d.c3(m,t.u_lightpos_globe),u_lightintensity:new d.br(m,t.u_lightintensity),u_lightcolor:new d.c3(m,t.u_lightcolor),u_vertical_gradient:new d.br(m,t.u_vertical_gradient),u_height_factor:new d.br(m,t.u_height_factor),u_opacity:new d.br(m,t.u_opacity),u_fill_translate:new d.c4(m,t.u_fill_translate),u_image:new d.b$(m,t.u_image),u_texsize:new d.c4(m,t.u_texsize),u_pixel_coord_upper:new d.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c4(m,t.u_pixel_coord_lower),u_scale:new d.c3(m,t.u_scale),u_fade:new d.br(m,t.u_fade)}),fill:(m,t)=>({u_fill_translate:new d.c4(m,t.u_fill_translate)}),fillPattern:(m,t)=>({u_image:new d.b$(m,t.u_image),u_texsize:new d.c4(m,t.u_texsize),u_pixel_coord_upper:new d.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c4(m,t.u_pixel_coord_lower),u_scale:new d.c3(m,t.u_scale),u_fade:new d.br(m,t.u_fade),u_fill_translate:new d.c4(m,t.u_fill_translate)}),fillOutline:(m,t)=>({u_world:new d.c4(m,t.u_world),u_fill_translate:new d.c4(m,t.u_fill_translate)}),fillOutlinePattern:(m,t)=>({u_world:new d.c4(m,t.u_world),u_image:new d.b$(m,t.u_image),u_texsize:new d.c4(m,t.u_texsize),u_pixel_coord_upper:new d.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c4(m,t.u_pixel_coord_lower),u_scale:new d.c3(m,t.u_scale),u_fade:new d.br(m,t.u_fade),u_fill_translate:new d.c4(m,t.u_fill_translate)}),circle:(m,t)=>({u_camera_to_center_distance:new d.br(m,t.u_camera_to_center_distance),u_scale_with_map:new d.b$(m,t.u_scale_with_map),u_pitch_with_map:new d.b$(m,t.u_pitch_with_map),u_extrude_scale:new d.c4(m,t.u_extrude_scale),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_globe_extrude_scale:new d.br(m,t.u_globe_extrude_scale),u_translate:new d.c4(m,t.u_translate)}),collisionBox:(m,t)=>({u_pixel_extrude_scale:new d.c4(m,t.u_pixel_extrude_scale)}),collisionCircle:(m,t)=>({u_viewport_size:new d.c4(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new d.c0(m,t.u_color),u_overlay:new d.b$(m,t.u_overlay),u_overlay_scale:new d.br(m,t.u_overlay_scale)}),depth:yc,clippingMask:yc,heatmap:(m,t)=>({u_extrude_scale:new d.br(m,t.u_extrude_scale),u_intensity:new d.br(m,t.u_intensity),u_globe_extrude_scale:new d.br(m,t.u_globe_extrude_scale)}),heatmapTexture:(m,t)=>({u_matrix:new d.c1(m,t.u_matrix),u_world:new d.c4(m,t.u_world),u_image:new d.b$(m,t.u_image),u_color_ramp:new d.b$(m,t.u_color_ramp),u_opacity:new d.br(m,t.u_opacity)}),hillshade:(m,t)=>({u_image:new d.b$(m,t.u_image),u_latrange:new d.c4(m,t.u_latrange),u_exaggeration:new d.br(m,t.u_exaggeration),u_altitudes:new d.ca(m,t.u_altitudes),u_azimuths:new d.ca(m,t.u_azimuths),u_accent:new d.c0(m,t.u_accent),u_method:new d.b$(m,t.u_method),u_shadows:new d.c9(m,t.u_shadows),u_highlights:new d.c9(m,t.u_highlights)}),hillshadePrepare:(m,t)=>({u_matrix:new d.c1(m,t.u_matrix),u_image:new d.b$(m,t.u_image),u_dimension:new d.c4(m,t.u_dimension),u_zoom:new d.br(m,t.u_zoom),u_unpack:new d.c2(m,t.u_unpack)}),colorRelief:(m,t)=>({u_image:new d.b$(m,t.u_image),u_unpack:new d.c2(m,t.u_unpack),u_dimension:new d.c4(m,t.u_dimension),u_elevation_stops:new d.b$(m,t.u_elevation_stops),u_color_stops:new d.b$(m,t.u_color_stops),u_color_ramp_size:new d.b$(m,t.u_color_ramp_size),u_opacity:new d.br(m,t.u_opacity)}),line:(m,t)=>({u_translation:new d.c4(m,t.u_translation),u_ratio:new d.br(m,t.u_ratio),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c4(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_translation:new d.c4(m,t.u_translation),u_ratio:new d.br(m,t.u_ratio),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c4(m,t.u_units_to_pixels),u_image:new d.b$(m,t.u_image),u_image_height:new d.br(m,t.u_image_height)}),linePattern:(m,t)=>({u_translation:new d.c4(m,t.u_translation),u_texsize:new d.c4(m,t.u_texsize),u_ratio:new d.br(m,t.u_ratio),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_image:new d.b$(m,t.u_image),u_units_to_pixels:new d.c4(m,t.u_units_to_pixels),u_scale:new d.c3(m,t.u_scale),u_fade:new d.br(m,t.u_fade)}),lineSDF:(m,t)=>({u_translation:new d.c4(m,t.u_translation),u_ratio:new d.br(m,t.u_ratio),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c4(m,t.u_units_to_pixels),u_image:new d.b$(m,t.u_image),u_mix:new d.br(m,t.u_mix),u_tileratio:new d.br(m,t.u_tileratio),u_crossfade_from:new d.br(m,t.u_crossfade_from),u_crossfade_to:new d.br(m,t.u_crossfade_to),u_lineatlas_width:new d.br(m,t.u_lineatlas_width),u_lineatlas_height:new d.br(m,t.u_lineatlas_height)}),lineGradientSDF:(m,t)=>({u_translation:new d.c4(m,t.u_translation),u_ratio:new d.br(m,t.u_ratio),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c4(m,t.u_units_to_pixels),u_image:new d.b$(m,t.u_image),u_image_height:new d.br(m,t.u_image_height),u_tileratio:new d.br(m,t.u_tileratio),u_crossfade_from:new d.br(m,t.u_crossfade_from),u_crossfade_to:new d.br(m,t.u_crossfade_to),u_image_dash:new d.b$(m,t.u_image_dash),u_mix:new d.br(m,t.u_mix),u_lineatlas_width:new d.br(m,t.u_lineatlas_width),u_lineatlas_height:new d.br(m,t.u_lineatlas_height)}),raster:(m,t)=>({u_tl_parent:new d.c4(m,t.u_tl_parent),u_scale_parent:new d.br(m,t.u_scale_parent),u_buffer_scale:new d.br(m,t.u_buffer_scale),u_fade_t:new d.br(m,t.u_fade_t),u_opacity:new d.br(m,t.u_opacity),u_image0:new d.b$(m,t.u_image0),u_image1:new d.b$(m,t.u_image1),u_brightness_low:new d.br(m,t.u_brightness_low),u_brightness_high:new d.br(m,t.u_brightness_high),u_saturation_factor:new d.br(m,t.u_saturation_factor),u_contrast_factor:new d.br(m,t.u_contrast_factor),u_spin_weights:new d.c3(m,t.u_spin_weights),u_coords_top:new d.c2(m,t.u_coords_top),u_coords_bottom:new d.c2(m,t.u_coords_bottom)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new d.b$(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.b$(m,t.u_is_size_feature_constant),u_size_t:new d.br(m,t.u_size_t),u_size:new d.br(m,t.u_size),u_camera_to_center_distance:new d.br(m,t.u_camera_to_center_distance),u_pitch:new d.br(m,t.u_pitch),u_rotate_symbol:new d.b$(m,t.u_rotate_symbol),u_aspect_ratio:new d.br(m,t.u_aspect_ratio),u_fade_change:new d.br(m,t.u_fade_change),u_label_plane_matrix:new d.c1(m,t.u_label_plane_matrix),u_coord_matrix:new d.c1(m,t.u_coord_matrix),u_is_text:new d.b$(m,t.u_is_text),u_pitch_with_map:new d.b$(m,t.u_pitch_with_map),u_is_along_line:new d.b$(m,t.u_is_along_line),u_is_variable_anchor:new d.b$(m,t.u_is_variable_anchor),u_texsize:new d.c4(m,t.u_texsize),u_texture:new d.b$(m,t.u_texture),u_translation:new d.c4(m,t.u_translation),u_pitched_scale:new d.br(m,t.u_pitched_scale)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new d.b$(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.b$(m,t.u_is_size_feature_constant),u_size_t:new d.br(m,t.u_size_t),u_size:new d.br(m,t.u_size),u_camera_to_center_distance:new d.br(m,t.u_camera_to_center_distance),u_pitch:new d.br(m,t.u_pitch),u_rotate_symbol:new d.b$(m,t.u_rotate_symbol),u_aspect_ratio:new d.br(m,t.u_aspect_ratio),u_fade_change:new d.br(m,t.u_fade_change),u_label_plane_matrix:new d.c1(m,t.u_label_plane_matrix),u_coord_matrix:new d.c1(m,t.u_coord_matrix),u_is_text:new d.b$(m,t.u_is_text),u_pitch_with_map:new d.b$(m,t.u_pitch_with_map),u_is_along_line:new d.b$(m,t.u_is_along_line),u_is_variable_anchor:new d.b$(m,t.u_is_variable_anchor),u_texsize:new d.c4(m,t.u_texsize),u_texture:new d.b$(m,t.u_texture),u_gamma_scale:new d.br(m,t.u_gamma_scale),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_is_halo:new d.b$(m,t.u_is_halo),u_translation:new d.c4(m,t.u_translation),u_pitched_scale:new d.br(m,t.u_pitched_scale)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new d.b$(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.b$(m,t.u_is_size_feature_constant),u_size_t:new d.br(m,t.u_size_t),u_size:new d.br(m,t.u_size),u_camera_to_center_distance:new d.br(m,t.u_camera_to_center_distance),u_pitch:new d.br(m,t.u_pitch),u_rotate_symbol:new d.b$(m,t.u_rotate_symbol),u_aspect_ratio:new d.br(m,t.u_aspect_ratio),u_fade_change:new d.br(m,t.u_fade_change),u_label_plane_matrix:new d.c1(m,t.u_label_plane_matrix),u_coord_matrix:new d.c1(m,t.u_coord_matrix),u_is_text:new d.b$(m,t.u_is_text),u_pitch_with_map:new d.b$(m,t.u_pitch_with_map),u_is_along_line:new d.b$(m,t.u_is_along_line),u_is_variable_anchor:new d.b$(m,t.u_is_variable_anchor),u_texsize:new d.c4(m,t.u_texsize),u_texsize_icon:new d.c4(m,t.u_texsize_icon),u_texture:new d.b$(m,t.u_texture),u_texture_icon:new d.b$(m,t.u_texture_icon),u_gamma_scale:new d.br(m,t.u_gamma_scale),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_is_halo:new d.b$(m,t.u_is_halo),u_translation:new d.c4(m,t.u_translation),u_pitched_scale:new d.br(m,t.u_pitched_scale)}),background:(m,t)=>({u_opacity:new d.br(m,t.u_opacity),u_color:new d.c0(m,t.u_color)}),backgroundPattern:(m,t)=>({u_opacity:new d.br(m,t.u_opacity),u_image:new d.b$(m,t.u_image),u_pattern_tl_a:new d.c4(m,t.u_pattern_tl_a),u_pattern_br_a:new d.c4(m,t.u_pattern_br_a),u_pattern_tl_b:new d.c4(m,t.u_pattern_tl_b),u_pattern_br_b:new d.c4(m,t.u_pattern_br_b),u_texsize:new d.c4(m,t.u_texsize),u_mix:new d.br(m,t.u_mix),u_pattern_size_a:new d.c4(m,t.u_pattern_size_a),u_pattern_size_b:new d.c4(m,t.u_pattern_size_b),u_scale_a:new d.br(m,t.u_scale_a),u_scale_b:new d.br(m,t.u_scale_b),u_pixel_coord_upper:new d.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c4(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new d.br(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_texture:new d.b$(m,t.u_texture),u_ele_delta:new d.br(m,t.u_ele_delta),u_fog_matrix:new d.c1(m,t.u_fog_matrix),u_fog_color:new d.c0(m,t.u_fog_color),u_fog_ground_blend:new d.br(m,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.br(m,t.u_fog_ground_blend_opacity),u_horizon_color:new d.c0(m,t.u_horizon_color),u_horizon_fog_blend:new d.br(m,t.u_horizon_fog_blend),u_is_globe_mode:new d.br(m,t.u_is_globe_mode)}),terrainDepth:(m,t)=>({u_ele_delta:new d.br(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_texture:new d.b$(m,t.u_texture),u_terrain_coords_id:new d.br(m,t.u_terrain_coords_id),u_ele_delta:new d.br(m,t.u_ele_delta)}),projectionErrorMeasurement:(m,t)=>({u_input:new d.br(m,t.u_input),u_output_expected:new d.br(m,t.u_output_expected)}),atmosphere:(m,t)=>({u_sun_pos:new d.c3(m,t.u_sun_pos),u_atmosphere_blend:new d.br(m,t.u_atmosphere_blend),u_globe_position:new d.c3(m,t.u_globe_position),u_globe_radius:new d.br(m,t.u_globe_radius),u_inv_proj_matrix:new d.c1(m,t.u_inv_proj_matrix)}),sky:(m,t)=>({u_sky_color:new d.c0(m,t.u_sky_color),u_horizon_color:new d.c0(m,t.u_horizon_color),u_horizon:new d.c4(m,t.u_horizon),u_horizon_normal:new d.c4(m,t.u_horizon_normal),u_sky_horizon_blend:new d.br(m,t.u_sky_horizon_blend),u_sky_blend:new d.br(m,t.u_sky_blend)})};class Fo{constructor(t,a,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const No={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class bh{constructor(t,a,l,h){this.length=a.length,this.attributes=l,this.itemSize=a.bytesPerElement,this.dynamicDraw=h,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let l=0;l<this.attributes.length;l++){const h=a.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,a,l){for(let h=0;h<this.attributes.length;h++){const _=this.attributes[h],v=a.attributes[_.name];v!==void 0&&t.vertexAttribPointer(v,_.components,t[No[_.type]],!1,this.itemSize,_.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class xi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class rs extends xi{getDefault(){return d.bq.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Au extends xi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Cu extends xi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class vc extends xi{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class jo extends xi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class zu extends xi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Pl extends xi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class na extends xi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class wh extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class xc extends xi{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ra extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class as extends xi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ir extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Ms extends xi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Vo extends xi{getDefault(){return d.bq.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Uo extends xi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Du extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class so extends xi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class wa extends xi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Th extends xi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Il extends xi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Kt extends xi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class bc extends xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class aa extends xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class wc extends xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class sa extends xi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class kd extends xi{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Tc extends xi{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const l=this.gl;va(l)?l.bindVertexArray(t):(a=l.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class oo extends xi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Sh extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Sc extends xi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class lo extends xi{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Pu extends lo{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Rr extends lo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class uo extends lo{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const co="Framebuffer is not complete";class Go{constructor(t,a,l,h,_){this.context=t,this.width=a,this.height=l;const v=t.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new Pu(t,w),h)this.depthAttachment=_?new uo(t,w):new Rr(t,w);else if(_)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(co)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class ho{constructor(t){var a,l;if(this.gl=t,this.clearColor=new rs(this),this.clearDepth=new Au(this),this.clearStencil=new Cu(this),this.colorMask=new vc(this),this.depthMask=new jo(this),this.stencilMask=new zu(this),this.stencilFunc=new Pl(this),this.stencilOp=new na(this),this.stencilTest=new wh(this),this.depthRange=new xc(this),this.depthTest=new ra(this),this.depthFunc=new as(this),this.blend=new Ir(this),this.blendFunc=new Ms(this),this.blendColor=new Vo(this),this.blendEquation=new Uo(this),this.cullFace=new Du(this),this.cullFaceSide=new so(this),this.frontFace=new wa(this),this.program=new Th(this),this.activeTexture=new Il(this),this.viewport=new Kt(this),this.bindFramebuffer=new bc(this),this.bindRenderbuffer=new aa(this),this.bindTexture=new wc(this),this.bindVertexBuffer=new sa(this),this.bindElementBuffer=new kd(this),this.bindVertexArray=new Tc(this),this.pixelStoreUnpack=new oo(this),this.pixelStoreUnpackPremultiplyAlpha=new Sh(this),this.pixelStoreUnpackFlipY=new Sc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),va(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:h?.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new Fo(this,t,a)}createVertexBuffer(t,a,l){return new bh(this,t,a,l)}createRenderbuffer(t,a,l){const h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,t,a,l),this.bindRenderbuffer.set(null),_}createFramebuffer(t,a,l,h){return new Go(this,t,a,l,h)}clear({color:t,depth:a,stencil:l}){const h=this.gl;let _=0;t&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),l!==void 0&&(_|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){d.bS(t.blendFunction,Pi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return va(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return va(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let tr;function ir(m,t,a,l,h){const _=m.context,v=m.transform,w=_.gl,S=m.useProgram("collisionBox"),A=[];let z=0,R=0;for(let Y=0;Y<l.length;Y++){const Q=l[Y],ne=t.getTile(Q).getBucket(a);if(!ne)continue;const K=h?ne.textCollisionBox:ne.iconCollisionBox,se=ne.collisionCircleArray;se.length>0&&(A.push({circleArray:se,circleOffset:R,coord:Q}),z+=se.length/4,R=z),K&&S.draw(_,w.LINES,Yt.disabled,mi.disabled,m.colorModeForRenderPass(),ei.disabled,no(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q),v.getProjectionData({overscaledTileID:Q,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,null,m.transform.zoom,null,null,K.collisionVertexBuffer)}if(!h||!A.length)return;const I=m.useProgram("collisionCircle"),F=new d.cb;F.resize(4*z),F._trim();let U=0;for(const Y of A)for(let Q=0;Q<Y.circleArray.length/4;Q++){const ne=4*Q,K=Y.circleArray[ne+0],se=Y.circleArray[ne+1],ue=Y.circleArray[ne+2],te=Y.circleArray[ne+3];F.emplace(U++,K,se,ue,te,0),F.emplace(U++,K,se,ue,te,1),F.emplace(U++,K,se,ue,te,2),F.emplace(U++,K,se,ue,te,3)}(!tr||tr.length<2*z)&&(tr=(function(Y){const Q=2*Y,ne=new d.cd;ne.resize(Q),ne._trim();for(let K=0;K<Q;K++){const se=6*K;ne.uint16[se+0]=4*K+0,ne.uint16[se+1]=4*K+1,ne.uint16[se+2]=4*K+2,ne.uint16[se+3]=4*K+2,ne.uint16[se+4]=4*K+3,ne.uint16[se+5]=4*K+0}return ne})(z));const X=_.createIndexBuffer(tr,!0),W=_.createVertexBuffer(F,d.cc.members,!0);for(const Y of A){const Q=yh(m.transform);I.draw(_,w.TRIANGLES,Yt.disabled,mi.disabled,m.colorModeForRenderPass(),ei.disabled,Q,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y.coord),null,a.id,W,X,d.aY.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,m.transform.zoom,null,null,null)}W.destroy(),X.destroy()}const ss=d.as(new Float32Array(16));function os(m,t,a,l,h,_){const{horizontalAlign:v,verticalAlign:w}=d.aT(m);return new d.P((-(v-.5)*t/h+l[0])*_,(-(w-.5)*a/h+l[1])*_)}function Gr(m,t,a,l,h,_){const v=t.tileAnchorPoint.add(new d.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let w=l.mult(_);a||(w=w.rotate(-h));const S=v.add(w);return $t(S.x,S.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const w=pi(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(m),S=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return m.add(l.rotate(S))}return m.add(l)}function Es(m,t,a,l,h,_,v,w,S,A,z,R){const I=m.text.placedSymbolArray,F=m.text.dynamicLayoutVertexArray,U=m.icon.dynamicLayoutVertexArray,X={};F.clear();for(let W=0;W<I.length;W++){const Y=I.get(W),Q=Y.hidden||!Y.crossTileID||m.allowVerticalPlacement&&!Y.placedOrientation?null:l[Y.crossTileID];if(Q){const ne=new d.P(Y.anchorX,Y.anchorY),K={getElevation:R,width:h.width,height:h.height,pitchedLabelPlaneMatrix:_,pitchWithMap:a,transform:h,tileAnchorPoint:ne,translation:A,unwrappedTileID:z},se=a?vl(ne.x,ne.y,K):pi(ne.x,ne.y,K),ue=Co(h.cameraToCenterDistance,se.signedDistanceFromCamera);let te=d.aB(m.textSizeData,w,Y)*ue/d.aN;a&&(te*=m.tilePixelRatio/v);const{width:me,height:Ae,anchor:we,textOffset:Ce,textBoxScale:De}=Q,Ke=os(we,me,Ae,Ce,De,te),lt=h.getPitchedTextCorrection(ne.x+A[0],ne.y+A[1],z),Ye=Gr(se.point,K,t,Ke,-h.bearingInRadians,lt),Ct=m.allowVerticalPlacement&&Y.placedOrientation===d.aA.vertical?Math.PI/2:0;for(let Zt=0;Zt<Y.numGlyphs;Zt++)d.aH(F,Ye,Ct);S&&Y.associatedIconIndex>=0&&(X[Y.associatedIconIndex]={shiftedAnchor:Ye,angle:Ct})}else ts(Y.numGlyphs,F)}if(S){U.clear();const W=m.icon.placedSymbolArray;for(let Y=0;Y<W.length;Y++){const Q=W.get(Y);if(Q.hidden)ts(Q.numGlyphs,U);else{const ne=X[Y];if(ne)for(let K=0;K<Q.numGlyphs;K++)d.aH(U,ne.shiftedAnchor,ne.angle);else ts(Q.numGlyphs,U)}}m.icon.dynamicLayoutVertexBuffer.updateData(U)}m.text.dynamicLayoutVertexBuffer.updateData(F)}function Mh(m,t,a){return a.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function qo(m,t,a,l,h,_,v,w,S,A,z,R,I){const F=m.context,U=F.gl,X=m.transform,W=w==="map",Y=S==="map",Q=w!=="viewport"&&a.layout.get("symbol-placement")!=="point",ne=W&&!Y&&!Q,K=!a.layout.get("symbol-sort-key").isConstant();let se=!1;const ue=m.getDepthModeForSublayer(0,Yt.ReadOnly),te=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),me=[],Ae=X.getCircleRadiusCorrection();for(const we of l){const Ce=t.getTile(we),De=Ce.getBucket(a);if(!De)continue;const Ke=h?De.text:De.icon;if(!Ke||!Ke.segments.get().length||!Ke.hasVisibleVertices)continue;const lt=Ke.programConfigurations.get(a.id),Ye=h||De.sdfIcons,Ct=h?De.textSizeData:De.iconSizeData,Zt=Y||X.pitch!==0,wi=m.useProgram(Mh(Ye,h,De),lt),Ui=d.az(Ct,X.zoom),Mi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(we);let Yi,Ii,On,$i,Fn=[0,0],cn=null;if(h)Ii=Ce.glyphAtlasTexture,On=U.LINEAR,Yi=Ce.glyphAtlasTexture.size,De.iconsInText&&(Fn=Ce.imageAtlasTexture.size,cn=Ce.imageAtlasTexture,$i=Zt||m.options.rotating||m.options.zooming||Ct.kind==="composite"||Ct.kind==="camera"?U.LINEAR:U.NEAREST);else{const hn=a.layout.get("icon-size").constantOr(0)!==1||De.iconsNeedLinear;Ii=Ce.imageAtlasTexture,On=Ye||m.options.rotating||m.options.zooming||hn||Zt?U.LINEAR:U.NEAREST,Yi=Ce.imageAtlasTexture.size}const yn=d.aO(Ce,1,m.transform.zoom),ar=ea(W,m.transform,yn),pr=d.N();d.aC(pr,ar);const Va=oc(Y,W,m.transform,yn),js=d.aP(X,Ce,_,v),Qo=X.getProjectionData({overscaledTileID:we,applyGlobeMatrix:!I,applyTerrainMatrix:!0}),Lc=te&&De.hasTextData(),Ko=a.layout.get("icon-text-fit")!=="none"&&Lc&&De.hasIconData();if(Q){const hn=m.style.map.terrain?(Fr,en)=>m.style.map.terrain.getElevation(we,Fr,en):null,jn=a.layout.get("text-rotation-alignment")==="map";ws(De,m,h,ar,pr,Y,A,jn,we.toUnwrapped(),X.width,X.height,js,hn)}const $r=h&&te||Ko,Nn=Q||$r?ss:Y?ar:m.transform.clipSpaceToPixelsMatrix,Qn=Ye&&a.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let sr;sr=Ye?De.iconsInText?ba(Ct.kind,Ui,ne,Y,Q,$r,m,Nn,Va,js,Yi,Fn,Ae):_c(Ct.kind,Ui,ne,Y,Q,$r,m,Nn,Va,js,h,Yi,0,Ae):Su(Ct.kind,Ui,ne,Y,Q,$r,m,Nn,Va,js,h,Yi,Ae);const ha={program:wi,buffers:Ke,uniformValues:sr,projectionData:Qo,atlasTexture:Ii,atlasTextureIcon:cn,atlasInterpolation:On,atlasInterpolationIcon:$i,isSDF:Ye,hasHalo:Qn};if(K&&De.canOverlap){se=!0;const hn=Ke.segments.get();for(const jn of hn)me.push({segments:new d.aY([jn]),sortKey:jn.sortKey,state:ha,terrainData:Mi})}else me.push({segments:Ke.segments,sortKey:0,state:ha,terrainData:Mi})}se&&me.sort(((we,Ce)=>we.sortKey-Ce.sortKey));for(const we of me){const Ce=we.state;if(F.activeTexture.set(U.TEXTURE0),Ce.atlasTexture.bind(Ce.atlasInterpolation,U.CLAMP_TO_EDGE),Ce.atlasTextureIcon&&(F.activeTexture.set(U.TEXTURE1),Ce.atlasTextureIcon&&Ce.atlasTextureIcon.bind(Ce.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Ce.isSDF){const De=Ce.uniformValues;Ce.hasHalo&&(De.u_is_halo=1,Rl(Ce.buffers,we.segments,a,m,Ce.program,ue,z,R,De,Ce.projectionData,we.terrainData)),De.u_is_halo=0}Rl(Ce.buffers,we.segments,a,m,Ce.program,ue,z,R,Ce.uniformValues,Ce.projectionData,we.terrainData)}}function Rl(m,t,a,l,h,_,v,w,S,A,z){const R=l.context;h.draw(R,R.gl.TRIANGLES,_,v,w,ei.backCCW,S,z,A,a.id,m.layoutVertexBuffer,m.indexBuffer,t,a.paint,l.transform.zoom,m.programConfigurations.get(a.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Eh(m,t,a,l,h){const _=m.context,v=_.gl,w=mi.disabled,S=new Pi([v.ONE,v.ONE],d.bq.transparent,[!0,!0,!0,!0]),A=t.getBucket(a);if(!A)return;const z=l.key;let R=a.heatmapFbos.get(z);R||(R=ji(_,t.tileSize,t.tileSize),a.heatmapFbos.set(z,R)),_.bindFramebuffer.set(R.framebuffer),_.viewport.set([0,0,t.tileSize,t.tileSize]),_.clear({color:d.bq.transparent});const I=A.programConfigurations.get(a.id),F=m.useProgram("heatmap",I,!h),U=m.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),X=m.style.map.terrain.getTerrainData(l);F.draw(_,v.TRIANGLES,Yt.disabled,w,S,ei.disabled,ro(t,m.transform.zoom,a.paint.get("heatmap-intensity"),1),X,U,a.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,a.paint,m.transform.zoom,I)}function nr(m,t,a,l,h){const _=m.context,v=_.gl,w=m.transform;_.setColorMode(m.colorModeForRenderPass());const S=oi(_,t),A=a.key,z=t.heatmapFbos.get(A);if(!z)return;_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,z.colorAttachment.get()),_.activeTexture.set(v.TEXTURE1),S.bind(v.LINEAR,v.CLAMP_TO_EDGE);const R=w.getProjectionData({overscaledTileID:a,applyTerrainMatrix:h,applyGlobeMatrix:!l});m.useProgram("heatmapTexture").draw(_,v.TRIANGLES,Yt.disabled,mi.disabled,m.colorModeForRenderPass(),ei.disabled,vh(m,t,0,1),null,R,t.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,t.paint,w.zoom),z.destroy(),t.heatmapFbos.delete(A)}function ji(m,t,a){var l,h;const _=m.gl,v=_.createTexture();_.bindTexture(_.TEXTURE_2D,v),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const w=(l=m.HALF_FLOAT)!==null&&l!==void 0?l:_.UNSIGNED_BYTE,S=(h=m.RGBA16F)!==null&&h!==void 0?h:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,S,t,a,0,_.RGBA,w,null);const A=m.createFramebuffer(t,a,!1,!1);return A.colorAttachment.set(v),A}function oi(m,t){return t.colorRampTexture||(t.colorRampTexture=new d.T(m,t.colorRamp,m.gl.RGBA)),t.colorRampTexture}function As(m,t,a,l,h,_,v,w){let S=256;if(h.stepInterpolant){const A=t.getSource().maxzoom,z=v.canonical.z===A?Math.ceil(1<<m.transform.maxZoom-v.canonical.z):1;S=d.ao(d.cf(_.maxLineLength/d.a5*1024*z),256,a.maxTextureSize)}return w.gradient=d.cg({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:S,image:w.gradient||void 0,clips:_.lineClipsArray}),w.texture?w.texture.update(w.gradient):w.texture=new d.T(a,w.gradient,l.RGBA),w.version=h.gradientVersion,w.texture}function oa(m,t,a,l,h){m.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),l.updatePaintBuffers(h)}function sn(m,t,a,l,h,_){(h||m.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),m.lineAtlas.bind(t)),l.updatePaintBuffers(_)}function qr(m,t,a,l,h,_,v){const w=_.gradients[h.id];let S=w.texture;h.gradientVersion!==w.version&&(S=As(m,t,a,l,h,_,v,w)),a.activeTexture.set(l.TEXTURE0),S.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function la(m,t,a,l,h,_,v,w,S){const A=_.gradients[h.id];let z=A.texture;h.gradientVersion!==A.version&&(z=As(m,t,a,l,h,_,v,A)),a.activeTexture.set(l.TEXTURE0),z.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE1),m.lineAtlas.bind(a),w.updatePaintBuffers(S)}function Iu(m,t,a,l,h){if(!a||!l||!l.imageAtlas)return;const _=l.imageAtlas.patternPositions;let v=_[a.to.toString()],w=_[a.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const S=h.getPaintProperty(t);v=_[S],w=_[S]}v&&w&&m.setConstantPatternPositions(v,w)}function ls(m,t,a,l,h,_,v,w){const S=m.context.gl,A="fill-pattern",z=a.paint.get(A),R=z&&z.constantOr(1),I=a.getCrossfadeParameters();let F,U,X,W,Y;const Q=m.transform,ne=a.paint.get("fill-translate"),K=a.paint.get("fill-translate-anchor");v?(U=R&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=S.LINES):(U=R?"fillPattern":"fill",F=S.TRIANGLES);const se=z.constantOr(null);for(const ue of l){const te=t.getTile(ue);if(R&&!te.patternsLoaded())continue;const me=te.getBucket(a);if(!me)continue;const Ae=me.programConfigurations.get(a.id),we=m.useProgram(U,Ae),Ce=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ue);R&&(m.context.activeTexture.set(S.TEXTURE0),te.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Ae.updatePaintBuffers(I)),Iu(Ae,A,se,te,a);const De=Q.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),Ke=d.aP(Q,te,ne,K);if(v){W=me.indexBuffer2,Y=me.segments2;const Ye=[S.drawingBufferWidth,S.drawingBufferHeight];X=U==="fillOutlinePattern"&&R?Pd(m,I,te,Ye,Ke):Dl(Ye,Ke)}else W=me.indexBuffer,Y=me.segments,X=R?Oo(m,I,te,Ke):{u_fill_translate:Ke};const lt=m.stencilModeForClipping(ue);we.draw(m.context,F,h,lt,_,ei.backCCW,X,Ce,De,a.id,me.layoutVertexBuffer,W,Y,a.paint,m.transform.zoom,Ae)}}function us(m,t,a,l,h,_,v,w){const S=m.context,A=S.gl,z="fill-extrusion-pattern",R=a.paint.get(z),I=R.constantOr(1),F=a.getCrossfadeParameters(),U=a.paint.get("fill-extrusion-opacity"),X=R.constantOr(null),W=m.transform;for(const Y of l){const Q=t.getTile(Y),ne=Q.getBucket(a);if(!ne)continue;const K=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y),se=ne.programConfigurations.get(a.id),ue=m.useProgram(I?"fillExtrusionPattern":"fillExtrusion",se);I&&(m.context.activeTexture.set(A.TEXTURE0),Q.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),se.updatePaintBuffers(F));const te=W.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!w,applyTerrainMatrix:!0});Iu(se,z,X,Q,a);const me=d.aP(W,Q,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ae=a.paint.get("fill-extrusion-vertical-gradient"),we=I?pc(m,Ae,U,me,Y,F,Q):fc(m,Ae,U,me);ue.draw(S,S.gl.TRIANGLES,h,_,v,ei.backCCW,we,K,te,a.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,a.paint,m.transform.zoom,se,m.style.map.terrain&&ne.centroidVertexBuffer)}}function cs(m,t,a,l,h,_,v,w,S){var A;const z=m.style.projection,R=m.context,I=m.transform,F=R.gl,U=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],X=m.useProgram("hillshade",null,!1,U),W=!m.options.moving;for(const Y of l){const Q=t.getTile(Y),ne=Q.fbo;if(!ne)continue;const K=z.getMeshFromTileID(R,Y.canonical,w,!0,"raster"),se=(A=m.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(Y);R.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,ne.colorAttachment.get());const ue=I.getProjectionData({overscaledTileID:Y,aligned:W,applyGlobeMatrix:!S,applyTerrainMatrix:!0});X.draw(R,F.TRIANGLES,_,h[Y.overscaledZ],v,ei.backCCW,bu(m,Q,a),se,ue,a.id,K.vertexBuffer,K.indexBuffer,K.segments)}}function Cs(m,t,a,l,h,_,v,w,S){var A;const z=m.style.projection,R=m.context,I=m.transform,F=R.gl,U=m.useProgram("colorRelief"),X=!m.options.moving;let W=!0,Y=0;for(const Q of l){const ne=t.getTile(Q),K=ne.dem;if(W){const we=F.getParameter(F.MAX_TEXTURE_SIZE),{elevationTexture:Ce,colorTexture:De}=a.getColorRampTextures(R,we,K.getUnpackVector());R.activeTexture.set(F.TEXTURE1),Ce.bind(F.NEAREST,F.CLAMP_TO_EDGE),R.activeTexture.set(F.TEXTURE4),De.bind(F.LINEAR,F.CLAMP_TO_EDGE),W=!1,Y=Ce.size[0]}if(!K||!K.data)continue;const se=K.stride,ue=K.getPixels();if(R.activeTexture.set(F.TEXTURE0),R.pixelStoreUnpackPremultiplyAlpha.set(!1),ne.demTexture=ne.demTexture||m.getTileTexture(se),ne.demTexture){const we=ne.demTexture;we.update(ue,{premultiply:!1}),we.bind(F.LINEAR,F.CLAMP_TO_EDGE)}else ne.demTexture=new d.T(R,ue,F.RGBA,{premultiply:!1}),ne.demTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const te=z.getMeshFromTileID(R,Q.canonical,w,!0,"raster"),me=(A=m.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(Q),Ae=I.getProjectionData({overscaledTileID:Q,aligned:X,applyGlobeMatrix:!S,applyTerrainMatrix:!0});U.draw(R,F.TRIANGLES,_,h[Q.overscaledZ],v,ei.backCCW,Rd(a,ne.dem,Y),me,Ae,a.id,te.vertexBuffer,te.indexBuffer,te.segments)}}const zs=[new d.P(0,0),new d.P(d.a5,0),new d.P(d.a5,d.a5),new d.P(0,d.a5)];function Ta(m,t,a,l,h,_,v,w,S=!1,A=!1){const z=l[l.length-1].overscaledZ,R=m.context,I=R.gl,F=m.useProgram("raster"),U=m.transform,X=m.style.projection,W=m.colorModeForRenderPass(),Y=!m.options.moving,Q=a.paint.get("raster-opacity"),ne=a.paint.get("raster-resampling"),K=a.paint.get("raster-fade-duration"),se=!!m.style.map.terrain;for(const ue of l){const te=m.getDepthModeForSublayer(ue.overscaledZ-z,Q===1?Yt.ReadWrite:Yt.ReadOnly,I.LESS),me=t.getTile(ue),Ae=ne==="nearest"?I.NEAREST:I.LINEAR;R.activeTexture.set(I.TEXTURE0),me.texture.bind(Ae,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(I.TEXTURE1);const{parentTile:we,parentScaleBy:Ce,parentTopLeft:De,fadeValues:Ke}=hs(me,t,K,se);me.fadeOpacity=Ke.tileOpacity,we?(we.fadeOpacity=Ke.parentTileOpacity,we.texture.bind(Ae,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST)):me.texture.bind(Ae,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),me.texture.useMipmap&&R.extTextureFilterAnisotropic&&m.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const lt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ue),Ye=U.getProjectionData({overscaledTileID:ue,aligned:Y,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),Ct=mc(De,Ce,Ke.fadeMix,a,w),Zt=X.getMeshFromTileID(R,ue.canonical,_,v,"raster");F.draw(R,I.TRIANGLES,te,h?h[ue.overscaledZ]:mi.disabled,W,S?ei.frontCCW:ei.backCCW,Ct,lt,Ye,a.id,Zt.vertexBuffer,Zt.indexBuffer,Zt.segments)}}function hs(m,t,a,l){const h={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||l)return h;if(m.fadingParentID){const _=t.getLoadedTile(m.fadingParentID);if(!_)return h;const v=Math.pow(2,_.tileID.overscaledZ-m.tileID.overscaledZ),w=[m.tileID.canonical.x*v%1,m.tileID.canonical.y*v%1],S=(function(A,z,R){const I=rt(),F=(I-z.timeAdded)/R,U=A.fadingDirection===Me.Incoming,X=d.ao((I-A.timeAdded)/R,0,1),W=d.ao(1-F,0,1),Y=U?X:W;return{tileOpacity:Y,parentTileOpacity:U?W:X,fadeMix:{opacity:1,mix:1-Y}}})(m,_,a);return{parentTile:_,parentScaleBy:v,parentTopLeft:w,fadeValues:S}}if(m.selfFading){const _=(function(v,w){const S=(rt()-v.timeAdded)/w,A=d.ao(S,0,1);return{tileOpacity:A,fadeMix:{opacity:A,mix:0}}})(m,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:_}}return h}const Ds=new d.bq(1,0,0,1),ds=new d.bq(0,1,0,1),Mc=new d.bq(0,0,1,1),Ec=new d.bq(1,0,1,1),Sa=new d.bq(0,1,1,1);function Ll(m,t,a,l){In(m,0,t+a/2,m.transform.width,a,l)}function Ps(m,t,a,l){In(m,t-a/2,0,a,m.transform.height,l)}function In(m,t,a,l,h,_){const v=m.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*m.pixelRatio,a*m.pixelRatio,l*m.pixelRatio,h*m.pixelRatio),v.clear({color:_}),w.disable(w.SCISSOR_TEST)}function Ru(m,t,a){const l=m.context,h=l.gl,_=m.useProgram("debug"),v=Yt.disabled,w=mi.disabled,S=m.colorModeForRenderPass(),A="$debug",z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(a);l.activeTexture.set(h.TEXTURE0);const R=t.getTileByID(a.key).latestRawTileData,I=Math.floor((R&&R.byteLength||0)/1024),F=t.getTile(a).tileSize,U=512/Math.min(F,512)*(a.overscaledZ/m.transform.zoom)*.5;let X=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(X+=` => ${a.overscaledZ}`),(function(Y,Q){Y.initDebugOverlayCanvas();const ne=Y.debugOverlayCanvas,K=Y.context.gl,se=Y.debugOverlayCanvas.getContext("2d");se.clearRect(0,0,ne.width,ne.height),se.shadowColor="white",se.shadowBlur=2,se.lineWidth=1.5,se.strokeStyle="white",se.textBaseline="top",se.font="bold 36px Open Sans, sans-serif",se.fillText(Q,5,5),se.strokeText(Q,5,5),Y.debugOverlayTexture.update(ne),Y.debugOverlayTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE)})(m,`${X} ${I}kB`);const W=m.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(l,h.TRIANGLES,v,w,Pi.alphaBlended,ei.disabled,xu(d.bq.transparent,U),null,W,A,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),_.draw(l,h.LINE_STRIP,v,w,S,ei.disabled,xu(d.bq.red),z,W,A,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Ac(m,t,a,l){const{isRenderingGlobe:h}=l,_=m.context,v=_.gl,w=m.transform,S=m.colorModeForRenderPass(),A=m.getDepthModeFor3D(),z=m.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,m.width,m.height]);for(const R of a){const I=t.getTerrainMesh(R.tileID),F=m.renderToTexture.getTexture(R),U=t.getTerrainData(R.tileID);_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,F.texture);const X=t.getMeshFrameDelta(w.zoom),W=w.calculateFogMatrix(R.tileID.toUnwrapped()),Y=Cd(X,W,m.style.sky,w.pitch,h),Q=w.getProjectionData({overscaledTileID:R.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(_,v.TRIANGLES,A,mi.disabled,S,ei.backCCW,Y,U,Q,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}function Ah(m,t){if(!t.mesh){const a=new d.aX;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const l=new d.aZ;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),t.mesh=new Ni(m.createVertexBuffer(a,ya.members),m.createIndexBuffer(l),d.aY.simpleSegment(0,0,a.length,l.length))}return t.mesh}class Od{constructor(t,a){this.context=new ho(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.as(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Hi.maxOverzooming+Hi.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Yn}resize(t,a,l){if(this.width=Math.floor(t*l),this.height=Math.floor(a*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,a=new d.aX;a.emplaceBack(0,0),a.emplaceBack(d.a5,0),a.emplaceBack(0,d.a5),a.emplaceBack(d.a5,d.a5),this.tileExtentBuffer=t.createVertexBuffer(a,ya.members),this.tileExtentSegments=d.aY.simpleSegment(0,0,4,2);const l=new d.aX;l.emplaceBack(0,0),l.emplaceBack(d.a5,0),l.emplaceBack(0,d.a5),l.emplaceBack(d.a5,d.a5),this.debugBuffer=t.createVertexBuffer(l,ya.members),this.debugSegments=d.aY.simpleSegment(0,0,4,5);const h=new d.ci;h.emplaceBack(0,0,0,0),h.emplaceBack(d.a5,0,d.a5,0),h.emplaceBack(0,d.a5,0,d.a5),h.emplaceBack(d.a5,d.a5,d.a5,d.a5),this.rasterBoundsBuffer=t.createVertexBuffer(h,Ad.members),this.rasterBoundsSegments=d.aY.simpleSegment(0,0,4,2);const _=new d.aX;_.emplaceBack(0,0),_.emplaceBack(d.a5,0),_.emplaceBack(0,d.a5),_.emplaceBack(d.a5,d.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(_,ya.members),this.rasterBoundsSegmentsPosOnly=d.aY.simpleSegment(0,0,4,5);const v=new d.aX;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,ya.members),this.viewportSegments=d.aY.simpleSegment(0,0,4,2);const w=new d.cj;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(w);const S=new d.aZ;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const A=this.context.gl;this.stencilClearMode=new mi({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.tileExtentMesh=new Ni(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.N();d.c8(l,0,this.width,this.height,0,0,1),d.Q(l,l,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,Yt.disabled,this.stencilClearMode,Pi.disabled,ei.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const h=this.context;h.setColorMode(Pi.disabled),h.setDepthMode(Yt.disabled);const _={};for(const v of a)_[v.key]=this.nextStencilID++;this._renderTileMasks(_,a,l,!0),this._renderTileMasks(_,a,l,!1),this._tileClippingMaskIDs=_}_renderTileMasks(t,a,l,h){const _=this.context,v=_.gl,w=this.style.projection,S=this.transform,A=this.useProgram("clippingMask");for(const z of a){const R=t[z.key],I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),F=w.getMeshFromTileID(this.context,z.canonical,h,!0,"stencil"),U=S.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!l,applyTerrainMatrix:!0});A.draw(_,v.TRIANGLES,Yt.disabled,new mi({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),Pi.disabled,l?ei.disabled:ei.backCCW,null,I,U,"$clipping",F.vertexBuffer,F.indexBuffer,F.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,l=this.style.projection,h=this.transform,_=this.useProgram("depth"),v=this.getDepthModeFor3D(),w=Tn(h,{tileSize:h.tileSize});for(const S of w){const A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S),z=l.getMeshFromTileID(this.context,S.canonical,!0,!0,"raster"),R=h.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(t,a.TRIANGLES,v,mi.disabled,Pi.disabled,ei.backCCW,null,A,R,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new mi({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new mi({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,l=t.sort(((v,w)=>w.overscaledZ-v.overscaledZ)),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let w=0;w<_;w++)v[w+h]=new mi({func:a.GEQUAL,mask:255},w+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=_,[v,l]}return[{[h]:mi.disabled},l]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,l=t.sort(((v,w)=>w.overscaledZ-v.overscaledZ)),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(this.clearStencil(),_>1){const v={},w={};for(let S=0;S<_;S++)v[S+h]=new mi({func:a.GREATER,mask:255},_+1+S,255,a.KEEP,a.KEEP,a.REPLACE),w[S+h]=new mi({func:a.GREATER,mask:255},1+S,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*_+1,[v,w,l]}return this.nextStencilID=3,[{[h]:new mi({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[h]:new mi({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Pi([t.CONSTANT_COLOR,t.ONE],new d.bq(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Pi.unblended:Pi.alphaBlended}getDepthModeForSublayer(t,a,l){if(!this.opaquePassEnabledForLayer())return Yt.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Yt(l||this.context.gl.LEQUAL,a,[h,h])}getDepthModeFor3D(){return new Yt(this.context.gl.LEQUAL,Yt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var l,h;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(rt()),this.imageManager.beginFrame();const _=this.style._order,v=this.style.tileManagers,w={},S={},A={},z={isRenderingToTexture:!1,isRenderingGlobe:((l=t.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const I in v){const F=v[I];F.used&&F.prepare(this.context),w[I]=F.getVisibleCoordinates(!1),S[I]=w[I].slice().reverse(),A[I]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<_.length;I++)if(this.style._layers[_[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of _){const F=this.style._layers[I];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const U=S[F.source];(F.type==="custom"||U.length)&&this.renderLayer(this,v[F.source],F,U,z)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:I=>this.useProgram(I)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?d.bq.black:d.bq.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(I,F){const U=I.context,X=U.gl,W=((ue,te,me)=>{const Ae=Math.cos(te.rollInRadians),we=Math.sin(te.rollInRadians),Ce=Ti(te),De=te.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ue.properties.get("sky-color"),u_horizon_color:ue.properties.get("horizon-color"),u_horizon:[(te.width/2-Ce*we)*me,(te.height/2+Ce*Ae)*me],u_horizon_normal:[-we,Ae],u_sky_horizon_blend:ue.properties.get("sky-horizon-blend")*te.height/2*me,u_sky_blend:De}})(F,I.style.map.transform,I.pixelRatio),Y=new Yt(X.LEQUAL,Yt.ReadWrite,[0,1]),Q=mi.disabled,ne=I.colorModeForRenderPass(),K=I.useProgram("sky"),se=Ah(U,F);K.draw(U,X.TRIANGLES,Y,Q,ne,ei.disabled,W,null,void 0,"sky",se.vertexBuffer,se.indexBuffer,se.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[_[this.currentLayer]],F=v[I.source],U=w[I.source];this._renderTileClippingMasks(I,U,!1),this.renderLayer(this,F,I,U,z)}this.renderPass="translucent";let R=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const I=this.style._layers[_[this.currentLayer]],F=v[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I,z))continue;this.opaquePassEnabledForLayer()||R||(R=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const U=(I.type==="symbol"?A:S)[I.source];this._renderTileClippingMasks(I,w[I.source],!!this.renderToTexture),this.renderLayer(this,F,I,U,z)}if(z.isRenderingGlobe&&(function(I,F,U){const X=I.context,W=X.gl,Y=I.useProgram("atmosphere"),Q=new Yt(W.LEQUAL,Yt.ReadOnly,[0,1]),ne=I.transform,K=(function(De,Ke){const lt=De.properties.get("position"),Ye=[-lt.x,-lt.y,-lt.z],Ct=d.as(new Float64Array(16));return De.properties.get("anchor")==="map"&&(d.bh(Ct,Ct,Ke.rollInRadians),d.bi(Ct,Ct,-Ke.pitchInRadians),d.bh(Ct,Ct,Ke.bearingInRadians),d.bi(Ct,Ct,Ke.center.lat*Math.PI/180),d.bK(Ct,Ct,-Ke.center.lng*Math.PI/180)),d.ch(Ye,Ye,Ct),Ye})(U,I.transform),se=ne.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ue=F.properties.get("atmosphere-blend")*se.projectionTransition;if(ue===0)return;const te=ko(ne.worldSize,ne.center.lat),me=ne.inverseProjectionMatrix,Ae=new Float64Array(4);Ae[3]=1,d.aI(Ae,Ae,ne.modelViewProjectionMatrix),Ae[0]/=Ae[3],Ae[1]/=Ae[3],Ae[2]/=Ae[3],Ae[3]=1,d.aI(Ae,Ae,me),Ae[0]/=Ae[3],Ae[1]/=Ae[3],Ae[2]/=Ae[3],Ae[3]=1;const we=((De,Ke,lt,Ye,Ct)=>({u_sun_pos:De,u_atmosphere_blend:Ke,u_globe_position:lt,u_globe_radius:Ye,u_inv_proj_matrix:Ct}))(K,ue,[Ae[0],Ae[1],Ae[2]],te,me),Ce=Ah(X,F);Y.draw(X,W.TRIANGLES,Q,mi.disabled,Pi.alphaBlended,ei.disabled,we,null,null,"atmosphere",Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const I=(function(F,U){let X=null;const W=Object.values(F._layers).flatMap((K=>K.source&&!K.isHidden(U)?[F.tileManagers[K.source]]:[])),Y=W.filter((K=>K.getSource().type==="vector")),Q=W.filter((K=>K.getSource().type!=="vector")),ne=K=>{(!X||X.getSource().maxzoom<K.getSource().maxzoom)&&(X=K)};return Y.forEach((K=>ne(K))),X||Q.forEach((K=>ne(K))),X})(this.style,this.transform.zoom);I&&(function(F,U,X){for(let W=0;W<X.length;W++)Ru(F,U,X[W])})(this,I,I.getVisibleCoordinates())}this.options.showPadding&&(function(I){const F=I.transform.padding;Ll(I,I.transform.height-(F.top||0),3,Ds),Ll(I,F.bottom||0,3,ds),Ps(I,F.left||0,3,Mc),Ps(I,I.transform.width-(F.right||0),3,Ec);const U=I.transform.centerPoint;(function(X,W,Y,Q){In(X,W-1,Y-10,2,20,Q),In(X,W-10,Y-1,20,2,Q)})(I,U.x,I.transform.height-U.y,Sa)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=t?!d.ck(a,l):!d.cl(a,l)),h||(h=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(d.cm(a,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(_,v){const w=_.context,S=w.gl,A=_.transform,z=Pi.unblended,R=new Yt(S.LEQUAL,Yt.ReadWrite,[0,1]),I=v.tileManager.getRenderableTiles(),F=_.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),w.clear({color:d.bq.transparent,depth:1});for(const U of I){const X=v.getTerrainMesh(U.tileID),W=v.getTerrainData(U.tileID),Y=A.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Q={u_ele_delta:v.getMeshFrameDelta(A.zoom)};F.draw(w,S.TRIANGLES,R,mi.disabled,z,ei.backCCW,Q,W,Y,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain),(function(_,v){const w=_.context,S=w.gl,A=_.transform,z=Pi.unblended,R=new Yt(S.LEQUAL,Yt.ReadWrite,[0,1]),I=v.getCoordsTexture(),F=v.tileManager.getRenderableTiles(),U=_.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),w.clear({color:d.bq.transparent,depth:1}),v.coordsIndex=[];for(const X of F){const W=v.getTerrainMesh(X.tileID),Y=v.getTerrainData(X.tileID);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.texture);const Q={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(A.zoom)},ne=A.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(w,S.TRIANGLES,R,mi.disabled,z,ei.backCCW,Q,Y,ne,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),v.coordsIndex.push(X.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain))}renderLayer(t,a,l,h,_){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,d.cn(l)?(function(v,w,S,A,z,R){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:I}=R,F=mi.disabled,U=v.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(X,W,Y,Q,ne,K,se,ue,te){const me=W.transform,Ae=W.style.map.terrain,we=ne==="map",Ce=K==="map";for(const De of X){const Ke=Q.getTile(De),lt=Ke.getBucket(Y);if(!lt||!lt.text||!lt.text.segments.get().length)continue;const Ye=d.az(lt.textSizeData,me.zoom),Ct=d.aO(Ke,1,W.transform.zoom),Zt=ea(we,W.transform,Ct),wi=Y.layout.get("icon-text-fit")!=="none"&&lt.hasIconData();if(Ye){const Ui=Math.pow(2,me.zoom-Ke.tileID.overscaledZ),Mi=Ae?(Yi,Ii)=>Ae.getElevation(De,Yi,Ii):null;Es(lt,we,Ce,te,me,Zt,Ui,Ye,wi,d.aP(me,Ke,se,ue),De.toUnwrapped(),Mi)}}})(A,v,S,w,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),z),S.paint.get("icon-opacity").constantOr(1)!==0&&qo(v,w,S,A,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),F,U,I),S.paint.get("text-opacity").constantOr(1)!==0&&qo(v,w,S,A,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),F,U,I),w.map.showCollisionBoxes&&(ir(v,w,S,A,!0),ir(v,w,S,A,!1))})(t,a,l,h,this.style.placement.variableOffsets,_):d.co(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=S.paint.get("circle-opacity"),F=S.paint.get("circle-stroke-width"),U=S.paint.get("circle-stroke-opacity"),X=!S.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(F.constantOr(1)===0||U.constantOr(1)===0))return;const W=v.context,Y=W.gl,Q=v.transform,ne=v.getDepthModeForSublayer(0,Yt.ReadOnly),K=mi.disabled,se=v.colorModeForRenderPass(),ue=[],te=Q.getCircleRadiusCorrection();for(let me=0;me<A.length;me++){const Ae=A[me],we=w.getTile(Ae),Ce=we.getBucket(S);if(!Ce)continue;const De=S.paint.get("circle-translate"),Ke=S.paint.get("circle-translate-anchor"),lt=d.aP(Q,we,De,Ke),Ye=Ce.programConfigurations.get(S.id),Ct=v.useProgram("circle",Ye),Zt=Ce.layoutVertexBuffer,wi=Ce.indexBuffer,Ui=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ae),Mi={programConfiguration:Ye,program:Ct,layoutVertexBuffer:Zt,indexBuffer:wi,uniformValues:vu(v,we,S,lt,te),terrainData:Ui,projectionData:Q.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!R,applyTerrainMatrix:!0})};if(X){const Yi=Ce.segments.get();for(const Ii of Yi)ue.push({segments:new d.aY([Ii]),sortKey:Ii.sortKey,state:Mi})}else ue.push({segments:Ce.segments,sortKey:0,state:Mi})}X&&ue.sort(((me,Ae)=>me.sortKey-Ae.sortKey));for(const me of ue){const{programConfiguration:Ae,program:we,layoutVertexBuffer:Ce,indexBuffer:De,uniformValues:Ke,terrainData:lt,projectionData:Ye}=me.state;we.draw(W,Y.TRIANGLES,ne,K,se,ei.backCCW,Ke,lt,Ye,S.id,Ce,De,me.segments,S.paint,v.transform.zoom,Ae)}})(t,a,l,h,_):d.cp(l)?(function(v,w,S,A,z){if(S.paint.get("heatmap-opacity")===0)return;const R=v.context,{isRenderingToTexture:I,isRenderingGlobe:F}=z;if(v.style.map.terrain){for(const U of A){const X=w.getTile(U);w.hasRenderableParent(U)||(v.renderPass==="offscreen"?Eh(v,X,S,U,F):v.renderPass==="translucent"&&nr(v,S,U,I,F))}R.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?(function(U,X,W,Y){const Q=U.context,ne=Q.gl,K=U.transform,se=mi.disabled,ue=new Pi([ne.ONE,ne.ONE],d.bq.transparent,[!0,!0,!0,!0]);(function(te,me,Ae){const we=te.gl;te.activeTexture.set(we.TEXTURE1),te.viewport.set([0,0,me.width/4,me.height/4]);let Ce=Ae.heatmapFbos.get(d.ce);Ce?(we.bindTexture(we.TEXTURE_2D,Ce.colorAttachment.get()),te.bindFramebuffer.set(Ce.framebuffer)):(Ce=ji(te,me.width/4,me.height/4),Ae.heatmapFbos.set(d.ce,Ce))})(Q,U,W),Q.clear({color:d.bq.transparent});for(let te=0;te<Y.length;te++){const me=Y[te];if(X.hasRenderableParent(me))continue;const Ae=X.getTile(me),we=Ae.getBucket(W);if(!we)continue;const Ce=we.programConfigurations.get(W.id),De=U.useProgram("heatmap",Ce),Ke=K.getProjectionData({overscaledTileID:me,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),lt=K.getCircleRadiusCorrection();De.draw(Q,ne.TRIANGLES,Yt.disabled,se,ue,ei.backCCW,ro(Ae,K.zoom,W.paint.get("heatmap-intensity"),lt),null,Ke,W.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,W.paint,K.zoom,Ce)}Q.viewport.set([0,0,U.width,U.height])})(v,w,S,A):v.renderPass==="translucent"&&(function(U,X){const W=U.context,Y=W.gl;W.setColorMode(U.colorModeForRenderPass());const Q=X.heatmapFbos.get(d.ce);Q&&(W.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,Q.colorAttachment.get()),W.activeTexture.set(Y.TEXTURE1),oi(W,X).bind(Y.LINEAR,Y.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw(W,Y.TRIANGLES,Yt.disabled,mi.disabled,U.colorModeForRenderPass(),ei.disabled,vh(U,X,0,1),null,null,X.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,X.paint,U.transform.zoom))})(v,S)})(t,a,l,h,_):d.cq(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=S.paint.get("line-opacity"),F=S.paint.get("line-width");if(I.constantOr(1)===0||F.constantOr(1)===0)return;const U=v.getDepthModeForSublayer(0,Yt.ReadOnly),X=v.colorModeForRenderPass(),W=S.paint.get("line-dasharray"),Y=W.constantOr(1),Q=S.paint.get("line-pattern"),ne=Q.constantOr(1),K=S.paint.get("line-gradient"),se=S.getCrossfadeParameters();let ue;ue=ne?"linePattern":Y&&K?"lineGradientSDF":Y?"lineSDF":K?"lineGradient":"line";const te=v.context,me=te.gl,Ae=v.transform;let we=!0;for(const Ce of A){const De=w.getTile(Ce);if(ne&&!De.patternsLoaded())continue;const Ke=De.getBucket(S);if(!Ke)continue;const lt=Ke.programConfigurations.get(S.id),Ye=v.context.program.get(),Ct=v.useProgram(ue,lt),Zt=we||Ct.program!==Ye,wi=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ce),Ui=Q.constantOr(null),Mi=W&&W.constantOr(null);if(Ui&&De.imageAtlas){const Fn=De.imageAtlas,cn=Fn.patternPositions[Ui.to.toString()],yn=Fn.patternPositions[Ui.from.toString()];cn&&yn&&lt.setConstantPatternPositions(cn,yn)}else if(Mi){const Fn=S.layout.get("line-cap")==="round",cn=v.lineAtlas.getDash(Mi.to,Fn),yn=v.lineAtlas.getDash(Mi.from,Fn);lt.setConstantDashPositions(cn,yn)}const Yi=Ae.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Ii=Ae.getPixelScale();let On;ne?(On=xh(v,De,S,Ii,se),oa(te,me,De,lt,se)):Y&&K?(On=ao(v,De,S,Ii,se,Ke.lineClipsArray.length),la(v,w,te,me,S,Ke,Ce,lt,se)):Y?(On=Ur(v,De,S,Ii,se),sn(v,te,me,lt,Zt,se)):K?(On=Ld(v,De,S,Ii,Ke.lineClipsArray.length),qr(v,w,te,me,S,Ke,Ce)):On=wu(v,De,S,Ii);const $i=v.stencilModeForClipping(Ce);Ct.draw(te,me.TRIANGLES,U,$i,X,ei.disabled,On,wi,Yi,S.id,Ke.layoutVertexBuffer,Ke.indexBuffer,Ke.segments,S.paint,v.transform.zoom,lt,Ke.layoutVertexBuffer2),we=!1}})(t,a,l,h,_):d.cr(l)?(function(v,w,S,A,z){const R=S.paint.get("fill-color"),I=S.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const{isRenderingToTexture:F}=z,U=v.colorModeForRenderPass(),X=S.paint.get("fill-pattern"),W=v.opaquePassEnabledForLayer()&&!X.constantOr(1)&&R.constantOr(d.bq.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===W){const Y=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?Yt.ReadWrite:Yt.ReadOnly);ls(v,w,S,A,Y,U,!1,F)}if(v.renderPass==="translucent"&&S.paint.get("fill-antialias")){const Y=v.getDepthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Yt.ReadOnly);ls(v,w,S,A,Y,U,!0,F)}})(t,a,l,h,_):d.cs(l)?(function(v,w,S,A,z){const R=S.paint.get("fill-extrusion-opacity");if(R===0)return;const{isRenderingToTexture:I}=z;if(v.renderPass==="translucent"){const F=new Yt(v.context.gl.LEQUAL,Yt.ReadWrite,v.depthRangeFor3D);if(R!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))us(v,w,S,A,F,mi.disabled,Pi.disabled,I),us(v,w,S,A,F,v.stencilModeFor3D(),v.colorModeForRenderPass(),I);else{const U=v.colorModeForRenderPass();us(v,w,S,A,F,mi.disabled,U,I)}}})(t,a,l,h,_):d.ct(l)?(function(v,w,S,A,z){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,I=v.context,F=v.style.projection.useSubdivision,U=v.getDepthModeForSublayer(0,Yt.ReadOnly),X=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(W,Y,Q,ne,K,se,ue){const te=W.context,me=te.gl;for(const Ae of Q){const we=Y.getTile(Ae),Ce=we.dem;if(!Ce||!Ce.data||!we.needsHillshadePrepare)continue;const De=Ce.dim,Ke=Ce.stride,lt=Ce.getPixels();if(te.activeTexture.set(me.TEXTURE1),te.pixelStoreUnpackPremultiplyAlpha.set(!1),we.demTexture=we.demTexture||W.getTileTexture(Ke),we.demTexture){const Ct=we.demTexture;Ct.update(lt,{premultiply:!1}),Ct.bind(me.NEAREST,me.CLAMP_TO_EDGE)}else we.demTexture=new d.T(te,lt,me.RGBA,{premultiply:!1}),we.demTexture.bind(me.NEAREST,me.CLAMP_TO_EDGE);te.activeTexture.set(me.TEXTURE0);let Ye=we.fbo;if(!Ye){const Ct=new d.T(te,{width:De,height:De,data:null},me.RGBA);Ct.bind(me.LINEAR,me.CLAMP_TO_EDGE),Ye=we.fbo=te.createFramebuffer(De,De,!0,!1),Ye.colorAttachment.set(Ct.texture)}te.bindFramebuffer.set(Ye.framebuffer),te.viewport.set([0,0,De,De]),W.useProgram("hillshadePrepare").draw(te,me.TRIANGLES,K,se,ue,ei.disabled,Id(we.tileID,Ce),null,null,ne.id,W.rasterBoundsBuffer,W.quadTriangleIndexBuffer,W.rasterBoundsSegments),we.needsHillshadePrepare=!1}})(v,w,A,S,U,mi.disabled,X),I.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(F){const[W,Y,Q]=v.stencilConfigForOverlapTwoPass(A);cs(v,w,S,Q,W,U,X,!1,R),cs(v,w,S,Q,Y,U,X,!0,R)}else{const[W,Y]=v.getStencilConfigForOverlapAndUpdateStencilID(A);cs(v,w,S,Y,W,U,X,!1,R)}})(t,a,l,h,_):d.cu(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent"||!A.length)return;const{isRenderingToTexture:R}=z,I=v.style.projection.useSubdivision,F=v.getDepthModeForSublayer(0,Yt.ReadOnly),U=v.colorModeForRenderPass();if(I){const[X,W,Y]=v.stencilConfigForOverlapTwoPass(A);Cs(v,w,S,Y,X,F,U,!1,R),Cs(v,w,S,Y,W,F,U,!0,R)}else{const[X,W]=v.getStencilConfigForOverlapAndUpdateStencilID(A);Cs(v,w,S,W,X,F,U,!1,R)}})(t,a,l,h,_):d.bV(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!A.length)return;const{isRenderingToTexture:R}=z,I=w.getSource(),F=v.style.projection.useSubdivision;if(I instanceof Vr)Ta(v,w,S,A,null,!1,!1,I.tileCoords,I.flippedWindingOrder,R);else if(F){const[U,X,W]=v.stencilConfigForOverlapTwoPass(A);Ta(v,w,S,W,U,!1,!0,zs,!1,R),Ta(v,w,S,W,X,!0,!0,zs,!1,R)}else{const[U,X]=v.getStencilConfigForOverlapAndUpdateStencilID(A);Ta(v,w,S,X,U,!1,!0,zs,!1,R)}})(t,a,l,h,_):d.cv(l)?(function(v,w,S,A,z){const R=S.paint.get("background-color"),I=S.paint.get("background-opacity");if(I===0)return;const{isRenderingToTexture:F}=z,U=v.context,X=U.gl,W=v.style.projection,Y=v.transform,Q=Y.tileSize,ne=S.paint.get("background-pattern");if(v.isPatternMissing(ne))return;const K=!ne&&R.a===1&&I===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==K)return;const se=mi.disabled,ue=v.getDepthModeForSublayer(0,K==="opaque"?Yt.ReadWrite:Yt.ReadOnly),te=v.colorModeForRenderPass(),me=v.useProgram(ne?"backgroundPattern":"background"),Ae=A||Tn(Y,{tileSize:Q,terrain:v.style.map.terrain});ne&&(U.activeTexture.set(X.TEXTURE0),v.imageManager.bind(v.context));const we=S.getCrossfadeParameters();for(const Ce of Ae){const De=Y.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),Ke=ne?Eu(I,v,ne,{tileID:Ce,tileSize:Q},we):Mu(I,R),lt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ce),Ye=W.getMeshFromTileID(U,Ce.canonical,!1,!0,"raster");me.draw(U,X.TRIANGLES,ue,se,te,ei.backCCW,Ke,lt,De,S.id,Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)}})(t,0,l,h,_):d.cw(l)&&(function(v,w,S,A){const{isRenderingGlobe:z}=A,R=v.context,I=S.implementation,F=v.style.projection,U=v.transform,X=U.getProjectionDataForCustomLayer(z),W={farZ:U.farZ,nearZ:U.nearZ,fov:U.fov*Math.PI/180,modelViewProjectionMatrix:U.modelViewProjectionMatrix,projectionMatrix:U.projectionMatrix,shaderData:{variantName:F.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${F.shaderPreludeCode.vertexSource}`,define:F.shaderDefine},defaultProjectionData:X},Y=I.renderingMode?I.renderingMode:"2d";if(v.renderPass==="offscreen"){const Q=I.prerender;Q&&(v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),Q.call(I,R.gl,W),R.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),R.setStencilMode(mi.disabled);const Q=Y==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,Yt.ReadOnly);R.setDepthMode(Q),I.render(R.gl,W),R.setDirty(),v.setBaseState(),R.bindFramebuffer.set(null)}})(t,0,l,_))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!a||!l}useProgram(t,a,l=!1,h=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,v=this.style.projection,w=l?Wi.projectionMercator:v.shaderPreludeCode,S=l?gn:v.shaderDefine,A=t+(a?a.cacheKey:"")+`/${l?Cr:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[A]||(this.cache[A]=new zd(this.context,Wi[t],a,Bd[t],this._showOverdrawInspector,_,w,S,h)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const l in this._tileTextures){const h=this._tileTextures[l];if(h)for(const _ of h)_.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const l in this.cache){const h=this.cache[l];h&&h.program&&this.context.gl.deleteProgram(h.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function Ch(m,t){let a,l=!1,h=null,_=null;const v=()=>{h=null,l&&(m.apply(_,a),h=setTimeout(v,t),l=!1)};return(...w)=>(l=!0,_=this,a=w,h||v(),h)}class on{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let l;return a.split("&").map((h=>h.split("="))).forEach((h=>{h[0]===this._hashName&&(l=h)})),(l&&l[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:l,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const l=a.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let _=window.location.hash.replace(h,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let v=window.location.href.replace(/(#.+)?$/,_);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Ch(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),v=Math.round(a.lng*_)/_,w=Math.round(a.lat*_)/_,S=this._map.getBearing(),A=this._map.getPitch();let z="";if(z+=t?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(S||A)&&(z+="/"+Math.round(10*S)/10),A&&(z+=`/${Math.round(A)}`),this._hashName){const R=this._hashName;let I=!1;const F=window.location.hash.slice(1).split("&").map((U=>{const X=U.split("=")[0];return X===R?(I=!0,`${X}=${z}`):U})).filter((U=>U));return I||F.push(`${R}=${z}`),`#${F.join("&")}`}return`#${z}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new d.V(+t[2],+t[1])}catch{return!1}const a=+t[0],l=+(t[3]||0),h=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const fo={linearity:.3,easing:d.cx(0,0,.3,1)},br=d.e({deceleration:2500,maxSpeed:1400},fo),Lr=d.e({deceleration:20,maxSpeed:1400},fo),Cc=d.e({deceleration:1e3,maxSpeed:360},fo),wr=d.e({deceleration:1e3,maxSpeed:90},fo),Bl=d.e({deceleration:1e3,maxSpeed:360},fo);class kl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:rt(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=rt();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)a.zoom+=_.zoomDelta||0,a.bearing+=_.bearingDelta||0,a.pitch+=_.pitchDelta||0,a.roll+=_.rollDelta||0,_.panDelta&&a.pan._add(_.panDelta),_.around&&(a.around=_.around),_.pinchAround&&(a.pinchAround=_.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(a.pan.mag()){const _=Lu(a.pan.mag(),l,d.e({},br,t||{})),v=a.pan.mult(_.amount/a.pan.mag()),w=this._map.cameraHelper.handlePanInertia(v,this._map.transform);h.center=w.easingCenter,h.offset=w.easingOffset,Ol(h,_)}if(a.zoom){const _=Lu(a.zoom,l,Lr);h.zoom=this._map.transform.zoom+_.amount,Ol(h,_)}if(a.bearing){const _=Lu(a.bearing,l,Cc);h.bearing=this._map.transform.bearing+d.ao(_.amount,-179,179),Ol(h,_)}if(a.pitch){const _=Lu(a.pitch,l,wr);h.pitch=this._map.transform.pitch+_.amount,Ol(h,_)}if(a.roll){const _=Lu(a.roll,l,Bl);h.roll=this._map.transform.roll+d.ao(_.amount,-179,179),Ol(h,_)}if(h.zoom||h.bearing){const _=a.pinchAround===void 0?a.around:a.pinchAround;h.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),d.e(h,{noMoveStart:!0})}}function Ol(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function Lu(m,t,a){const{maxSpeed:l,linearity:h,deceleration:_}=a,v=d.ao(m*h/(t/1e3),-l,l),w=Math.abs(v)/(_*h);return{easing:a.easing,duration:1e3*w,amount:v*(w/2)}}class Zr extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(t,l);const _=pe.mousePos(a.getCanvas(),l),v=a.unproject(_);super(t,d.e({point:_,lngLat:v,originalEvent:l},h)),this._defaultPrevented=!1,this.target=a}}class Oa extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l){const h=t==="touchend"?l.changedTouches:l.touches,_=pe.touchPos(a.getCanvasContainer(),h),v=_.map((S=>a.unproject(S))),w=_.reduce(((S,A,z,R)=>S.add(A.div(R.length))),new d.P(0,0));super(t,{points:_,point:w,lngLats:v,lngLat:a.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Bu extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class po{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Bu(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Zr(t.type,this._map,t))}mouseup(t){this._map.fire(new Zr(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Zr(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Zr(t.type,this._map,t))}mouseover(t){this._map.fire(new Zr(t.type,this._map,t))}mouseout(t){this._map.fire(new Zr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Oa(t.type,this._map,t))}touchmove(t){this._map.fire(new Oa(t.type,this._map,t))}touchend(t){this._map.fire(new Oa(t.type,this._map,t))}touchcancel(t){this._map.fire(new Oa(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fs{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Zr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Zr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Zr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ft{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(d.P.convert(t),this._map.terrain)}}class ku{constructor(t,a){this._map=t,this._tr=new ft(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(pe.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const l=a;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=pe.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(h.x,l.x),v=Math.max(h.x,l.x),w=Math.min(h.y,l.y),S=Math.max(h.y,l.y);pe.setTransform(this._box,`translate(${_}px,${w}px)`),this._box.style.width=v-_+"px",this._box.style.height=S-w+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const l=this._startPos,h=a;if(this.reset(),pe.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new d.l("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(pe.remove(this._box),this._box=null),pe.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new d.l(t,{originalEvent:a}))}}function mo(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const a={};for(let l=0;l<m.length;l++)a[m[l].identifier]=t[l];return a}class Ou{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=(function(h){const _=new d.P(0,0);for(const v of h)_._add(v);return _.div(h.length)})(a),this.touches=mo(l,a)))}touchmove(t,a,l){if(this.aborted||!this.centroid)return;const h=mo(l,a);for(const _ in this.touches){const v=h[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,a,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class go{constructor(t){this.singleTap=new Ou(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,l){this.singleTap.touchstart(t,a,l)}touchmove(t,a,l){this.singleTap.touchmove(t,a,l)}touchend(t,a,l){const h=this.singleTap.touchend(t,a,l);if(h){const _=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(h)<30;if(_&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class Fl{constructor(t){this._tr=new ft(t),this._zoomIn=new go({numTouches:1,numTaps:2}),this._zoomOut=new go({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,l){this._zoomIn.touchstart(t,a,l),this._zoomOut.touchstart(t,a,l)}touchmove(t,a,l){this._zoomIn.touchmove(t,a,l),this._zoomOut.touchmove(t,a,l)}touchend(t,a,l){const h=this._zoomIn.touchend(t,a,l),_=this._zoomOut.touchend(t,a,l),v=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(h)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ua{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=Array.isArray(a)?a[0]:a;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&pe.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Zo=0,zc=2,zh={[Zo]:1,[zc]:2};class Ma{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=pe.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,l){const h=zh[l];return a.buttons===void 0||(a.buttons&h)!==h})(t,this._eventButton)}isValidEndEvent(t){return pe.mouseButton(t)===this._eventButton}}class Fu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Nu{constructor(t=new Ma({checkCorrectEvent:()=>!0}),a=new Fu){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,l){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?l(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const _o=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=t=>{t.preventDefault()}};class Dc{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,l){return this._calculateTransform(t,a,l)}touchmove(t,a,l){if(this._active){if(!this._shouldBePrevented(l.length))return t.preventDefault(),this._calculateTransform(t,a,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,l){this._calculateTransform(t,a,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,l){l.length>0&&(this._active=!0);const h=mo(l,a),_=new d.P(0,0),v=new d.P(0,0);let w=0;for(const A in h){const z=h[A],R=this._touches[A];R&&(_._add(z),v._add(z.sub(R)),w++,h[A]=z)}if(this._touches=h,this._shouldBePrevented(w)||!v.mag())return;const S=v.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(w),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ju{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,_]=this._firstTwoTouches,v=ps(l,a,h),w=ps(l,a,_);if(!v||!w)return;const S=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],S,t)}touchend(t,a,l){if(!this._firstTwoTouches)return;const[h,_]=this._firstTwoTouches,v=ps(l,a,h),w=ps(l,a,_);v&&w||(this._active&&pe.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ps(m,t,a){for(let l=0;l<m.length;l++)if(m[l].identifier===a)return t[l]}function Pc(m,t){return Math.log(m/t)/Math.LN2}class Is extends ju{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Pc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Pc(this._distance,l),pinchAround:a}}}function Ic(m,t){return 180*m.angleWith(t)/Math.PI}class Fa extends ju{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,l){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ic(this._vector,h),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,l=Ic(t,this._startVector);return Math.abs(l)<a}}function ui(m){return Math.abs(m.y)>Math.abs(m.x)}class Rs extends ju{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,l){super.touchstart(t,a,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,ui(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,_,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,_=a.mag()>=2;if(!h&&!_)return;if(!h||!_)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==a.y>0;return ui(t)&&ui(a)&&v}}const yo={panStep:100,bearingStep:15,pitchStep:10};class Ho{constructor(t){this._tr=new ft(t);const a=yo;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,l=0,h=0,_=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:w=>{const S=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Vu,zoom:a?Math.round(S.zoom)+a*(t.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+h*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:S.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Vu(m){return m*(2-m)}const $o=4.000244140625,Nl=1/450;class Rc{constructor(t,a){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new ft(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Nl}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=rt(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,a!==0&&a%$o==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=pe.mousePos(this._map.getCanvas(),t),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(d.V.convert(l.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const w=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>$o?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&S!==0&&(S=1/S);const A=typeof this._targetZoom!="number"?t.scale:d.ar(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),d.au(A*S)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let _,v=!1;if(this._type==="wheel"&&l&&h){const w=rt()-this._lastWheelEventTime,S=Math.min((w+5)/200,1),A=h(S);_=d.G.number(l,a,A),S<1?this._frameId||(this._frameId=!0):v=!0}else _=a,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!v,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=d.cz;if(this._prevEase){const l=this._prevEase,h=(rt()-l.start)/l.duration,_=l.easing(h+.01)-l.easing(h),v=.27/Math.sqrt(_*_+1e-4)*.01,w=Math.sqrt(.0729-v*v);a=d.cx(v,w,.25,1)}return this._prevEase={start:rt(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Dh{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Br{constructor(t){this._tr=new ft(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xo{constructor(){this._tap=new go({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,l){if(!this._swipePoint)if(this._tapTime){const h=a[0],_=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(h)<30;_&&v?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,a,l)}touchmove(t,a,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=a[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,a,l)}touchend(t,a,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,a,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zt{constructor(t,a,l){this._el=t,this._mousePan=a,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ot{constructor(t,a,l,h){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class vo{constructor(t,a,l,h){this._el=t,this._touchZoom=a,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class kr{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=pe.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=a,this._container.appendChild(h);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=l,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(pe.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new d.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const rr=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class Mn extends d.l{}function Or(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class Ph{constructor(t,a){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,_)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=h.type==="renderFrame"?void 0:h,w={needsRenderFrame:!1},S={},A={};for(const{handlerName:I,handler:F,allowed:U}of this._handlers){if(!F.isEnabled())continue;let X;if(this._blockedByActive(A,U,I))F.reset();else if(F[_||h.type]){if(d.cA(h,_||h.type)){const W=pe.mousePos(this._map.getCanvas(),h);X=F[_||h.type](h,W)}else if(d.cB(h,_||h.type)){const W=this._getMapTouches(h.touches),Y=pe.touchPos(this._map.getCanvas(),W);X=F[_||h.type](h,Y,W)}else d.cC(_||h.type)||(X=F[_||h.type](h));this.mergeHandlerResult(w,S,X,I,v),X&&X.needsRenderFrame&&this._triggerRenderFrame()}(X||F.isActive())&&(A[I]=F)}const z={};for(const I in this._previousActiveHandlers)A[I]||(z[I]=v);this._previousActiveHandlers=A,(Object.keys(z).length||Or(w))&&(this._changes.push([w,S,z]),this._triggerRenderFrame()),(Object.keys(A).length||Or(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=w;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kl(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,_,v]of this._listeners)pe.addEventListener(h,_,h===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,a,l]of this._listeners)pe.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const a=this._map,l=a.getCanvasContainer();this._add("mapEvent",new po(a,t));const h=a.boxZoom=new ku(a,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const _=a.cooperativeGestures=new kr(a,t.cooperativeGestures);this._add("cooperativeGestures",_),t.cooperativeGestures&&_.enable();const v=new Fl(a),w=new Br(a);a.doubleClickZoom=new Dh(w,v),this._add("tapZoom",v),this._add("clickZoom",w),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const S=new Xo;this._add("tapDragZoom",S);const A=a.touchPitch=new Rs(a);this._add("touchPitch",A),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const z=()=>a.project(a.getCenter()),R=(function({enable:K,clickTolerance:se,aroundCenter:ue=!0,minPixelCenterThreshold:te=100,rotateDegreesPerPixelMoved:me=.8},Ae){const we=new Ma({checkCorrectEvent:Ce=>pe.mouseButton(Ce)===0&&Ce.ctrlKey||pe.mouseButton(Ce)===2&&!Ce.ctrlKey});return new ua({clickTolerance:se,move:(Ce,De)=>{const Ke=Ae();if(ue&&Math.abs(Ke.y-Ce.y)>te)return{bearingDelta:d.cy(new d.P(Ce.x,De.y),De,Ke)};let lt=(De.x-Ce.x)*me;return ue&&De.y<Ke.y&&(lt=-lt),{bearingDelta:lt}},moveStateManager:we,enable:K,assignEvents:_o})})(t,z),I=(function({enable:K,clickTolerance:se,pitchDegreesPerPixelMoved:ue=-.5}){const te=new Ma({checkCorrectEvent:me=>pe.mouseButton(me)===0&&me.ctrlKey||pe.mouseButton(me)===2});return new ua({clickTolerance:se,move:(me,Ae)=>({pitchDelta:(Ae.y-me.y)*ue}),moveStateManager:te,enable:K,assignEvents:_o})})(t),F=(function({enable:K,clickTolerance:se,rollDegreesPerPixelMoved:ue=.3},te){const me=new Ma({checkCorrectEvent:Ae=>pe.mouseButton(Ae)===2&&Ae.ctrlKey});return new ua({clickTolerance:se,move:(Ae,we)=>{const Ce=te();let De=(we.x-Ae.x)*ue;return we.y<Ce.y&&(De=-De),{rollDelta:De}},moveStateManager:me,enable:K,assignEvents:_o})})(t,z);a.dragRotate=new Ot(t,R,I,F),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",I,["mouseRotate","mouseRoll"]),this._add("mouseRoll",F,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const U=(function({enable:K,clickTolerance:se}){const ue=new Ma({checkCorrectEvent:te=>pe.mouseButton(te)===0&&!te.ctrlKey});return new ua({clickTolerance:se,move:(te,me)=>({around:me,panDelta:me.sub(te)}),activateOnStart:!0,moveStateManager:ue,enable:K,assignEvents:_o})})(t),X=new Dc(t,a);a.dragPan=new zt(l,U,X),this._add("mousePan",U),this._add("touchPan",X,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const W=new Fa,Y=new Is;a.touchZoomRotate=new vo(l,Y,W,S),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new fs(a));const Q=a.scrollZoom=new Rc(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Q,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const ne=a.keyboard=new Ho(a);this._add("keyboard",ne),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,l){this._handlers.push({handlerName:t,handler:a,allowed:l}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!rr(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,l){for(const h in t)if(h!==l&&(!a||a.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const l of t)this._el.contains(l.target)&&a.push(l);return a}mergeHandlerResult(t,a,l,h,_){if(!l)return;d.e(t,l);const v={handlerName:h,originalEvent:l.originalEvent||_};l.zoomDelta!==void 0&&(a.zoom=v),l.panDelta!==void 0&&(a.drag=v),l.rollDelta!==void 0&&(a.roll=v),l.pitchDelta!==void 0&&(a.pitch=v),l.bearingDelta!==void 0&&(a.rotate=v)}_applyChanges(){const t={},a={},l={};for(const[h,_,v]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new d.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(t.rollDelta=(t.rollDelta||0)+h.rollDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),d.e(a,_),d.e(l,v);this._updateMapTransform(t,a,l),this._changes=[]}_updateMapTransform(t,a,l){const h=this._map,_=h._getTransformForUpdate(),v=h.terrain;if(!(Or(t)||v&&this._terrainMovement))return this._fireEvents(a,l,!0);h._stop(!0);let{panDelta:w,zoomDelta:S,bearingDelta:A,pitchDelta:z,rollDelta:R,around:I,pinchAround:F}=t;F!==void 0&&(I=F),I=I||h.transform.centerPoint,v&&!_.isPointOnMapSurface(I)&&(I=_.centerPoint);const U={panDelta:w,zoomDelta:S,rollDelta:R,pitchDelta:z,bearingDelta:A,around:I};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(I)&&(I=_.centerPoint);const X=I.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(w?I.sub(w):I);this._handleMapControls({terrain:v,tr:_,deltasForHelper:U,preZoomAroundLoc:X,combinedEventsInProgress:a,panDelta:w}),h._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,l,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:l,preZoomAroundLoc:h,combinedEventsInProgress:_,panDelta:v}){const w=this._map.cameraHelper;if(w.handleMapControlsRollPitchBearingZoom(l,a),t)return w.useGlobeControls?(this._terrainMovement||!_.drag&&!_.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void w.handleMapControlsPan(l,a,h)):this._terrainMovement||!_.drag&&!_.zoom?void(_.drag&&this._terrainMovement&&v?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(v))):w.handleMapControlsPan(l,a,h)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void w.handleMapControlsPan(l,a,h));w.handleMapControlsPan(l,a,h)}_fireEvents(t,a,l){const h=rr(this._eventsInProgress),_=rr(t),v={};for(const R in t){const{originalEvent:I}=t[R];this._eventsInProgress[R]||(v[`${R}start`]=I),this._eventsInProgress[R]=t[R]}!h&&_&&this._fireEvent("movestart",_.originalEvent);for(const R in v)this._fireEvent(R,v[R]);_&&this._fireEvent("move",_.originalEvent);for(const R in t){const{originalEvent:I}=t[R];this._fireEvent(R,I)}const w={};let S;for(const R in this._eventsInProgress){const{handlerName:I,originalEvent:F}=this._eventsInProgress[R];this._handlersById[I].isActive()||(delete this._eventsInProgress[R],S=a[I]||F,w[`${R}end`]=S)}for(const R in w)this._fireEvent(R,w[R]);const A=rr(this._eventsInProgress),z=(h||_)&&!A;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&R.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(R)}if(l&&z){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),I=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!R||!R.essential&&ct.prefersReducedMotion?(this._map.fire(new d.l("moveend",{originalEvent:S})),I(this._map.getBearing())&&this._map.resetNorth()):(I(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new d.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Mn("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xo extends d.E{constructor(t,a,l){super(),this._renderFrameCallback=()=>{const h=Math.min((rt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new d.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,l){return t=d.P.convert(t).mult(-1),this.panTo(this.transform.center,d.e({offset:t},a),l)}panTo(t,a,l){return this.easeTo(d.e({center:t},a),l)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,l){return this.easeTo(d.e({zoom:t},a),l)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new d.l("movestart",a)).fire(new d.l("move",a)).fire(new d.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,l){return this.easeTo(d.e({bearing:t},a),l)}resetNorth(t,a){return this.rotateTo(0,d.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(d.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=pn.convert(t).adjustAntiMeridian();const l=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,a)}_cameraForBoxAndBearing(t,a,l,h){const _={top:0,bottom:0,right:0,left:0};if(typeof(h=d.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const A=h.padding;h.padding={top:A,bottom:A,right:A,left:A}}const v=d.e(_,h.padding);h.padding=v;const w=this.transform,S=new pn(t,a);return this.cameraHelper.cameraForBoxAndBearing(h,v,S,l,w)}fitBounds(t,a,l){return this._fitInternal(this.cameraForBounds(t,a),a,l)}fitScreenCoordinates(t,a,l,h,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(d.P.convert(t)),this.transform.screenPointToLocation(d.P.convert(a)),l,h),h,_)}_fitInternal(t,a,l){return t?(delete(a=d.e(t,a)).padding,a.linear?this.easeTo(a,l):this.flyTo(a,l)):this}jumpTo(t,a){this.stop();const l=this._getTransformForUpdate();let h=!1,_=!1,v=!1;const w=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,t);const S=l.zoom!==w;return"elevation"in t&&l.elevation!==+t.elevation&&l.setElevation(+t.elevation),"bearing"in t&&l.bearing!==+t.bearing&&(h=!0,l.setBearing(+t.bearing)),"pitch"in t&&l.pitch!==+t.pitch&&(_=!0,l.setPitch(+t.pitch)),"roll"in t&&l.roll!==+t.roll&&(v=!0,l.setRoll(+t.roll)),t.padding==null||l.isPaddingEqual(t.padding)||l.setPadding(t.padding),this._applyUpdatedTransform(l),this.fire(new d.l("movestart",a)).fire(new d.l("move",a)),S&&this.fire(new d.l("zoomstart",a)).fire(new d.l("zoom",a)).fire(new d.l("zoomend",a)),h&&this.fire(new d.l("rotatestart",a)).fire(new d.l("rotate",a)).fire(new d.l("rotateend",a)),_&&this.fire(new d.l("pitchstart",a)).fire(new d.l("pitch",a)).fire(new d.l("pitchend",a)),v&&this.fire(new d.l("rollstart",a)).fire(new d.l("roll",a)).fire(new d.l("rollend",a)),this.fire(new d.l("moveend",a))}calculateCameraOptionsFromTo(t,a,l,h=0){const _=d.ab.fromLngLat(t,a),v=d.ab.fromLngLat(l,h),w=v.x-_.x,S=v.y-_.y,A=v.z-_.z,z=Math.hypot(w,S,A);if(z===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(w,S),I=d.au(this.transform.cameraToCenterDistance/z/this.transform.tileSize),F=180*Math.atan2(w,-S)/Math.PI;let U=180*Math.acos(R/z)/Math.PI;return U=A<0?90-U:90+U,{center:v.toLngLat(),elevation:h,zoom:I,pitch:U,bearing:F}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,l,h,_){const v=this.transform.calculateCenterFromCameraLngLatAlt(t,a,l,h);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:l,pitch:h,roll:_}}easeTo(t,a){this._stop(!1,t.easeId),((t=d.e({offset:[0,0],duration:500,easing:d.cz},t)).animate===!1||!t.essential&&ct.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),_=l.pitch,v=l.roll,w="bearing"in t?this._normalizeBearing(t.bearing,h):h,S="pitch"in t?+t.pitch:_,A="roll"in t?this._normalizeBearing(t.roll,v):v,z="padding"in t?t.padding:l.padding,R=d.P.convert(t.offset);let I,F;t.around&&(I=d.V.convert(t.around),F=l.locationToScreenPoint(I));const U={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},X=this.cameraHelper.handleEaseTo(l,{bearing:w,pitch:S,roll:A,padding:z,around:I,aroundPoint:F,offsetAsPoint:R,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||h!==w,this._pitching=this._pitching||S!==_,this._rolling=this._rolling||A!==v,this._padding=!l.isPaddingEqual(z),this._zooming=this._zooming||X.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,U),this.terrain&&this._prepareElevation(X.elevationCenter),this._ease((W=>{X.easeFunc(W),this.terrain&&!t.freezeElevation&&this._updateElevation(W),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),(W=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,W)}),t),this}_prepareEase(t,a,l={}){this._moving=!0,a||l.moving||this.fire(new d.l("movestart",t)),this._zooming&&!l.zooming&&this.fire(new d.l("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new d.l("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new d.l("pitchstart",t)),this._rolling&&!l.rolling&&this.fire(new d.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(a-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(d.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),l=t.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(l<h){const _=this.calculateCameraOptionsFromTo(a,h,t.center,t.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((h=>this._elevateCameraIfInsideTerrain(h))),this.transformCameraUpdate&&a.push((h=>this.transformCameraUpdate(h))),!a.length)return;const l=t.clone();for(const h of a){const _=l.clone(),{center:v,zoom:w,roll:S,pitch:A,bearing:z,elevation:R}=h(_);v&&_.setCenter(v),R!==void 0&&_.setElevation(R),w!==void 0&&_.setZoom(w),S!==void 0&&_.setRoll(S),A!==void 0&&_.setPitch(A),z!==void 0&&_.setBearing(z),l.apply(_)}this.transform.apply(l)}_fireMoveEvents(t){this.fire(new d.l("move",t)),this._zooming&&this.fire(new d.l("zoom",t)),this._rotating&&this.fire(new d.l("rotate",t)),this._pitching&&this.fire(new d.l("pitch",t)),this._rolling&&this.fire(new d.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const l=this._zooming,h=this._rotating,_=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new d.l("zoomend",t)),h&&this.fire(new d.l("rotateend",t)),_&&this.fire(new d.l("pitchend",t)),v&&this.fire(new d.l("rollend",t)),this.fire(new d.l("moveend",t))}flyTo(t,a){if(!t.essential&&ct.prefersReducedMotion){const De=d.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(De,a)}this.stop(),t=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.cz},t);const l=this._getTransformForUpdate(),h=l.bearing,_=l.pitch,v=l.roll,w=l.padding,S="bearing"in t?this._normalizeBearing(t.bearing,h):h,A="pitch"in t?+t.pitch:_,z="roll"in t?this._normalizeBearing(t.roll,v):v,R="padding"in t?t.padding:l.padding,I=d.P.convert(t.offset);let F=l.centerPoint.add(I);const U=l.screenPointToLocation(F),X=this.cameraHelper.handleFlyTo(l,{bearing:S,pitch:A,roll:z,padding:R,locationAtOffset:U,offsetAsPoint:I,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let W=t.curve;const Y=Math.max(l.width,l.height),Q=Y/X.scaleOfZoom,ne=X.pixelPathLength;typeof X.scaleOfMinZoom=="number"&&(W=Math.sqrt(Y/X.scaleOfMinZoom/ne*2));const K=W*W;function se(De){const Ke=(Q*Q-Y*Y+(De?-1:1)*K*K*ne*ne)/(2*(De?Q:Y)*K*ne);return Math.log(Math.sqrt(Ke*Ke+1)-Ke)}function ue(De){return(Math.exp(De)-Math.exp(-De))/2}function te(De){return(Math.exp(De)+Math.exp(-De))/2}const me=se(!1);let Ae=function(De){return te(me)/te(me+W*De)},we=function(De){return Y*((te(me)*(ue(Ke=me+W*De)/te(Ke))-ue(me))/K)/ne;var Ke},Ce=(se(!0)-me)/W;if(Math.abs(ne)<2e-6||!isFinite(Ce)){if(Math.abs(Y-Q)<1e-6)return this.easeTo(t,a);const De=Q<Y?-1:1;Ce=Math.abs(Math.log(Q/Y))/W,we=()=>0,Ae=Ke=>Math.exp(De*W*Ke)}return t.duration="duration"in t?+t.duration:1e3*Ce/("screenSpeed"in t?+t.screenSpeed/W:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=h!==S,this._pitching=A!==_,this._rolling=z!==v,this._padding=!l.isPaddingEqual(R),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(X.targetCenter),this._ease((De=>{const Ke=De*Ce,lt=1/Ae(Ke),Ye=we(Ke);this._rotating&&l.setBearing(d.G.number(h,S,De)),this._pitching&&l.setPitch(d.G.number(_,A,De)),this._rolling&&l.setRoll(d.G.number(v,z,De)),this._padding&&(l.interpolatePadding(w,R,De),F=l.centerPoint.add(I)),X.easeFunc(De,lt,Ye,F),this.terrain&&!t.freezeElevation&&this._updateElevation(De),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,a)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,a,l){l.animate===!1||l.duration===0?(t(1),a()):(this._easeStart=rt(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=d.W(t,-180,180);const l=Math.abs(t-a);return Math.abs(t-360-a)<l&&(t-=360),Math.abs(t+360-a)<l&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(d.V.convert(t)):null}}const Hr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class En{constructor(t=Hr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=pe.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=pe.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=pe.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){pe.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const l=this._map._getUIString(`AttributionControl.${a}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((h=>typeof h!="string"?"":h))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const a=this._map.style.tileManagers;for(const h in a){const _=a[h];if(_.used||_.usedForTerrain){const v=_.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter((h=>String(h).trim())),t.sort(((h,_)=>h.length-_.length)),t=t.filter(((h,_)=>{for(let v=_+1;v<t.length;v++)if(t[v].indexOf(h)>=0)return!1;return!0}));const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=pe.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ls{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const l=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=pe.create("div","maplibregl-ctrl");const a=pe.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){pe.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Si{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,l=a?this._queue.concat(a):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const l of a)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Lt=d.aV([{name:"a_pos3d",type:"Int16",components:3}]);class Vi extends d.E{constructor(t){super(),this._lastTilesetChange=rt(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const l={};for(const h of Tn(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),d.c8(h.terrainRttPosMatrix32f,0,d.a5,d.a5,0,0,1),this._tiles[h.key]=new Ze(h,this.tileSize),this._lastTilesetChange=rt());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const a in this._tiles){const l=this._tiles[a];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,_=t.clone(),v=d.bl();if(h.canonical.equals(t.canonical))d.c8(v,0,d.a5,d.a5,0,0,1);else if(h.canonical.isChildOf(t.canonical)){const w=h.canonical.z-t.canonical.z,S=h.canonical.x-(h.canonical.x>>w<<w),A=h.canonical.y-(h.canonical.y>>w<<w),z=d.a5>>w;d.c8(v,0,z,z,0,0,1),d.O(v,v,[-S*z,-A*z,0])}else{if(!t.canonical.isChildOf(h.canonical))continue;{const w=t.canonical.z-h.canonical.z,S=t.canonical.x-(t.canonical.x>>w<<w),A=t.canonical.y-(t.canonical.y>>w<<w),z=d.a5>>w;d.c8(v,0,d.a5,d.a5,0,0,1),d.O(v,v,[S*z,A*z,0]),d.Q(v,v,[1/2**w,1/2**w,0])}}_.terrainRttPosMatrix32f=new Float32Array(v),a[l]=_}return a}_getTerrainCoordsForTileRanges(t,a){const l={};for(const h of this._renderableTilesKeys){const _=this._tiles[h].tileID;if(!this._isWithinTileRanges(_,a))continue;const v=t.clone(),w=d.bl();if(_.canonical.z===t.canonical.z){const S=t.canonical.x-_.canonical.x,A=t.canonical.y-_.canonical.y;d.c8(w,0,d.a5,d.a5,0,0,1),d.O(w,w,[S*d.a5,A*d.a5,0])}else if(_.canonical.z>t.canonical.z){const S=_.canonical.z-t.canonical.z,A=_.canonical.x-(_.canonical.x>>S<<S),z=_.canonical.y-(_.canonical.y>>S<<S),R=t.canonical.x-(_.canonical.x>>S),I=t.canonical.y-(_.canonical.y>>S),F=d.a5>>S;d.c8(w,0,F,F,0,0,1),d.O(w,w,[-A*F+R*d.a5,-z*F+I*d.a5,0])}else{const S=t.canonical.z-_.canonical.z,A=t.canonical.x-(t.canonical.x>>S<<S),z=t.canonical.y-(t.canonical.y>>S<<S),R=(t.canonical.x>>S)-_.canonical.x,I=(t.canonical.y>>S)-_.canonical.y,F=d.a5<<S;d.c8(w,0,F,F,0,0,1),d.O(w,w,[A*d.a5+R*F,z*d.a5+I*F,0])}v.terrainRttPosMatrix32f=new Float32Array(w),l[h]=v}return l}getSourceTile(t,a){const l=this.tileManager._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let _=this.findTileInCaches(this._sourceTileCache[t.key]);if(!_?.dem&&a)for(;h>=l.minzoom&&!_?.dem;)_=this.findTileInCaches(t.scaledTo(h--).key);return _}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class ln{constructor(t,a,l){this._meshCache={},this.painter=t,this.tileManager=new Vi(a),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,l,h=d.a5){var _;if(!(a>=0&&a<h&&l>=0&&l<h))return 0;const v=this.getTerrainData(t),w=(_=v.tile)===null||_===void 0?void 0:_.dem;if(!w)return 0;const S=d.cD([],[a/h*d.a5,l/h*d.a5],v.u_terrain_matrix),A=[S[0]*w.dim,S[1]*w.dim],z=Math.floor(A[0]),R=Math.floor(A[1]),I=A[0]-z,F=A[1]-R;return w.get(z,R)*(1-I)*(1-F)+w.get(z+1,R)*I*(1-F)+w.get(z,R+1)*(1-I)*F+w.get(z+1,R+1)*I*F}getElevationForLngLatZoom(t,a){if(!d.cE(a,t.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(l,h%d.a5,_%d.a5,d.a5)}getElevationForLngLat(t){return this.getElevationForLngLatZoom(t,this.tileManager.maxzoom)}getElevation(t,a,l,h=d.a5){return this.getDEMElevation(t,a,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,_=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new d.T(h,_,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new d.T(h,new d.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.as([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const h=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new d.T(h,a.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),a.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const l=a&&a+a.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.tileManager.getSource().maxzoom;let _=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?_=t.canonical.z-h:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>_<<_),w=t.canonical.y-(t.canonical.y>>_<<_),S=d.cF(new Float64Array(16),[1/(d.a5<<_),1/(d.a5<<_),0]);d.O(S,S,[v*d.a5,w*d.a5,0]),this._demMatrixCache[t.key]={matrix:S,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,l=a.width/devicePixelRatio,h=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new d.T(a.context,{width:l,height:h,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new d.T(a.context,{width:l,height:h,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,v=0;_<this._coordsTextureSize;_++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)a[v+0]=255&w,a[v+1]=255&_,a[v+2]=w>>8<<4|_>>8,a[v+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),h=new d.T(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),l=this.painter.context,h=l.gl,_=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(_,w-v-1,1,1,h.RGBA,h.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null);const S=a[0]+(a[2]>>4<<8),A=a[1]+((15&a[2])<<8),z=this.coordsIndex[255-a[3]],R=z&&this.tileManager.getTileByID(z);if(!R)return null;const I=this._coordsTextureSize,F=(1<<R.tileID.canonical.z)*I;return new d.ab((R.tileID.canonical.x*I+S)/F+R.tileID.wrap,(R.tileID.canonical.y*I+A)/F,this.getElevation(R.tileID,S,A,I))}depthAtPoint(t){const a=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const l=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,h=l&&t.canonical.y===0,_=l&&t.canonical.y===(1<<t.canonical.z)-1,v=`m_${h?"n":""}_${_?"s":""}`;if(this._meshCache[v])return this._meshCache[v];const w=this.painter.context,S=new d.cG,A=new d.aZ,z=this.meshSize,R=d.a5/z,I=z*z;for(let te=0;te<=z;te++)for(let me=0;me<=z;me++)S.emplaceBack(me*R,te*R,0);for(let te=0;te<I;te+=z+1)for(let me=0;me<z;me++)A.emplaceBack(me+te,z+me+te+1,z+me+te+2),A.emplaceBack(me+te,z+me+te+2,me+te+1);const F=S.length,U=F+(z+1),X=(z+1)*z,W=h?d.bs:0,Y=h?0:1,Q=_?d.bt:d.a5,ne=_?0:1;for(let te=0;te<=z;te++)S.emplaceBack(te*R,W,Y);for(let te=0;te<=z;te++)S.emplaceBack(te*R,Q,ne);for(let te=0;te<z;te++)A.emplaceBack(X+te,U+te,U+te+1),A.emplaceBack(X+te,U+te+1,X+te+1),A.emplaceBack(0+te,F+te+1,F+te),A.emplaceBack(0+te,0+te+1,F+te+1);const K=S.length,se=K+2*(z+1);for(const te of[0,1])for(let me=0;me<=z;me++)for(const Ae of[0,1])S.emplaceBack(te*d.a5,me*R,Ae);for(let te=0;te<2*z;te+=2)A.emplaceBack(K+te,K+te+1,K+te+3),A.emplaceBack(K+te,K+te+3,K+te+2),A.emplaceBack(se+te,se+te+3,se+te+1),A.emplaceBack(se+te,se+te+2,se+te+3);const ue=new Ni(w.createVertexBuffer(S,Lt.members),w.createIndexBuffer(A),d.aY.simpleSegment(0,0,S.length,A.length));return this._meshCache[v]=ue,ue}getMeshFrameDelta(t){return 2*Math.PI*d.bF/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var l;if(!d.cE(a,t.wrap()))return 0;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return a&&a.dem&&(l.minElevation=a.dem.min*this.exaggeration,l.maxElevation=a.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,a){const l=d.ab.fromLngLat(t.wrap()),h=(1<<a)*d.a5,_=l.x*h,v=l.y*h,w=Math.floor(_/d.a5),S=Math.floor(v/d.a5);return{tileID:new d.a2(a,0,a,w,S),mercatorX:_,mercatorY:v}}}class Yo{constructor(t,a,l){this._context=t,this._size=a,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new d.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(l.texture),{id:t,fbo:a,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const ca={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Bs{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new Yo(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((l=>!t._layers[l].isHidden(a))),this._coordsAscending={};for(const l in t.tileManagers){this._coordsAscending[l]={};const h=t.tileManagers[l].getVisibleCoordinates(),_=t.tileManagers[l].getSource(),v=_ instanceof Vr?_.terrainTileRanges:null;for(const w of h){const S=this.terrain.tileManager.getTerrainCoords(w,v);for(const A in S)this._coordsAscending[l][A]||(this._coordsAscending[l][A]=[]),this._coordsAscending[l][A].push(S[A])}}this._coordsAscendingStr={};for(const l of t._order){const h=t._layers[l],_=h.source;if(ca[h.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const v in this._coordsAscending[_])this._coordsAscendingStr[_][v]=this._coordsAscending[_][v].map((w=>w.key)).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const _=this._coordsAscendingStr[h][l.tileID.key];_&&_!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),h=t.type,_=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ca[h]&&(this._prevType&&ca[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!v))return!0;if(ca[this._prevType]||ca[h]&&v){this._prevType=h;const w=this._stacks.length-1,S=this._stacks[w]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(Ac(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[w]){const R=this.pool.getObjectForId(A.rtt[w].id);if(R.stamp===A.rtt[w].stamp){this.pool.useObject(R);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),A.rtt[w]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:d.bq.transparent,stencil:0}),_.currentStencilSource=void 0;for(let R=0;R<S.length;R++){const I=_.style._layers[S[R]],F=I.source?this._coordsAscending[I.source][A.tileID.key]:[A.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(I,F,!0),_.renderLayer(_,_.style.tileManagers[I.source],I,F,l),I.source&&(A.rttCoords[I.source]=this._coordsAscendingStr[I.source][A.tileID.key])}}return Ac(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),ca[h]}return!1}}const jl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ks=de,Os={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Hr,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Ih={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class un{constructor(t,a,l=!1){this.mousedown=_=>{this.startMove(_,pe.mousePos(this.element,_)),pe.addEventListener(window,"mousemove",this.mousemove),pe.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,pe.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHandler.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pe.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),pe.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),pe.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=pe.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const h=new Nu;this._rotatePitchHandler=new ua({clickTolerance:3,move:(_,v)=>{const w=a.getBoundingClientRect(),S=new d.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:d.cy(new d.P(_.x,v.y),v,S),pitchDelta:l?-.5*(v.y-_.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=t,pe.addEventListener(a,"mousedown",this.mousedown),pe.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),pe.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),pe.disableDrag()}move(t,a){const l=this.map,{bearingDelta:h,pitchDelta:_}=this._rotatePitchHandler.dragMove(t,a)||{};h&&l.setBearing(l.getBearing()+h),_&&l.setPitch(l.getPitch()+_)}off(){const t=this.element;pe.removeEventListener(t,"mousedown",this.mousedown),pe.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),pe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),pe.removeEventListener(window,"touchend",this.touchend),pe.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){pe.enableDrag(),pe.removeEventListener(window,"mousemove",this.mousemove),pe.removeEventListener(window,"mouseup",this.mouseup),pe.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),pe.removeEventListener(window,"touchend",this.touchend)}}let Na;function Vl(m,t,a,l=!1){if(l||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const h=new d.V(m.lng,m.lat);if(m=new d.V(m.lng,m.lat),t){const _=new d.V(m.lng-360,m.lat),v=new d.V(m.lng+360,m.lat),w=a.locationToScreenPoint(m).distSqr(t);a.locationToScreenPoint(_).distSqr(t)<w?m=_:a.locationToScreenPoint(v).distSqr(t)<w&&(m=v)}for(;Math.abs(m.lng-a.center.lng)>180;){const _=a.locationToScreenPoint(m);if(_.x>=0&&_.y>=0&&_.x<=a.width&&_.y<=a.height)break;m.lng>a.center.lng?m.lng-=360:m.lng+=360}return m.lng!==h.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(m))?m:h}const Ul={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Uu(m,t,a){const l=m.classList;for(const h in Ul)l.remove(`maplibregl-${a}-anchor-${h}`);l.add(`maplibregl-${a}-anchor-${t}`)}class Gu extends d.E{constructor(t){if(super(),this._onKeyPress=a=>{const l=a.code,h=a.charCode||a.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=a=>{const l=a.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=Vl(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),pe.setTransform(this._element,`${Ul[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${h}`),ct.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.l("dragstart"))),this.fire(new d.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=d.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=pe.create("div");const a=pe.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${l}px`),a.setAttributeNS(null,"width",`${h}px`),a.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const _=pe.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const v=pe.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=pe.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of S){const Q=pe.createNS("http://www.w3.org/2000/svg","ellipse");Q.setAttributeNS(null,"opacity","0.04"),Q.setAttributeNS(null,"cx","10.5"),Q.setAttributeNS(null,"cy","5.80029008"),Q.setAttributeNS(null,"rx",Y.rx),Q.setAttributeNS(null,"ry",Y.ry),w.appendChild(Q)}const A=pe.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const z=pe.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(z);const R=pe.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const I=pe.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(I);const F=pe.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");const U=pe.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const X=pe.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");const W=pe.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),U.appendChild(X),U.appendChild(W),v.appendChild(w),v.appendChild(A),v.appendChild(R),v.appendChild(F),v.appendChild(U),a.appendChild(v),a.setAttributeNS(null,"height",l*this._scale+"px"),a.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(a),this._offset=d.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),Uu(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),pe.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=d.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,l;const h=(a=this._map)===null||a===void 0?void 0:a.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!h||_){const F=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==F&&(this._element.style.opacity=F))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const v=this._map,w=v.terrain.depthAtPoint(this._pos),S=v.terrain.getElevationForLngLat(this._lngLat);if(v.transform.lngLatToCameraDepth(this._lngLat,S)-w<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/v.transform.pixelsPerMeter,z=Math.sin(v.getPitch()*Math.PI/180)*A,R=v.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),I=v.transform.lngLatToCameraDepth(this._lngLat,S+z)-R>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&I&&this._popup.remove(),this._element.style.opacity=I?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=d.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const qu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Fs=0,Ns=!1;const fr={maxWidth:100,unit:"metric"};function Ji(m,t,a){const l=a&&a.maxWidth||100,h=m._container.clientHeight/2,_=m._container.clientWidth/2,v=m.unproject([_-l/2,h]),w=m.unproject([_+l/2,h]),S=Math.round(m.project(w).x-m.project(v).x),A=Math.min(l,S,m._container.clientWidth),z=v.distanceTo(w);if(a&&a.unit==="imperial"){const R=3.2808*z;R>5280?ms(t,A,R/5280,m._getUIString("ScaleControl.Miles")):ms(t,A,R,m._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?ms(t,A,z/1852,m._getUIString("ScaleControl.NauticalMiles")):z>=1e3?ms(t,A,z/1e3,m._getUIString("ScaleControl.Kilometers")):ms(t,A,z,m._getUIString("ScaleControl.Meters"))}function ms(m,t,a,l){const h=(function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let w=_/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(S){const A=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*A)/A})(w),v*w})(a);m.style.width=t*(h/a)+"px",m.innerHTML=`${h}&nbsp;${l}`}const Wo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Gl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ql(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,m),"top-left":new d.P(t,t),"top-right":new d.P(-t,t),bottom:new d.P(0,-m),"bottom-left":new d.P(t,-t),"bottom-right":new d.P(-t,-t),left:new d.P(m,0),right:new d.P(-m,0)}}if(m instanceof d.P||Array.isArray(m)){const t=d.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:d.P.convert(m.center||[0,0]),top:d.P.convert(m.top||[0,0]),"top-left":d.P.convert(m["top-left"]||[0,0]),"top-right":d.P.convert(m["top-right"]||[0,0]),bottom:d.P.convert(m.bottom||[0,0]),"bottom-left":d.P.convert(m["bottom-left"]||[0,0]),"bottom-right":d.P.convert(m["bottom-right"]||[0,0]),left:d.P.convert(m.left||[0,0]),right:d.P.convert(m.right||[0,0])}}return ql(new d.P(0,0))}const ja=de;L.AJAXError=d.cJ,L.Event=d.l,L.Evented=d.E,L.LngLat=d.V,L.MercatorCoordinate=d.ab,L.Point=d.P,L.addProtocol=d.cK,L.config=d.c,L.removeProtocol=d.cL,L.AttributionControl=En,L.BoxZoomHandler=ku,L.CanvasSource=V,L.CooperativeGesturesHandler=kr,L.DoubleClickZoomHandler=Dh,L.DragPanHandler=zt,L.DragRotateHandler=Ot,L.EdgeInsets=ta,L.FullscreenControl=class extends d.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=pe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){pe.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=pe.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);pe.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},L.GeoJSONSource=er,L.GeolocateControl=class extends d.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new d.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new d.V(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),_=d.e({bearing:h},this.options.fitBoundsOptions),v=pn.fromLngLat(a,l);this._map.fitBounds(v,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new d.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Ns)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=pe.create("button","maplibregl-ctrl-geolocate",this._container),pe.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=pe.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Gu({element:this._dotElement}),this._circleElement=pe.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const l=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.l("trackuserlocationend")),this.fire(new d.l("userlocationlostfocus")))}))}},this.options=d.e({},qu,m)}onAdd(m){return this._map=m,this._container=pe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return d._(this,arguments,void 0,(function*(t=!1){if(Na!==void 0&&!t)return Na;if(window.navigator.permissions===void 0)return Na=!!window.navigator.geolocation,Na;try{Na=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Na=!!window.navigator.geolocation}return Na}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),pe.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Fs=0,Ns=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),a=m.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const t=this._map.project(m),a=this._map.unproject([t.x+100,t.y]),l=m.distanceTo(a)/100,h=2*this._accuracy/l;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fs--,Ns=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.l("trackuserlocationstart")),this.fire(new d.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Fs++,Fs>1?(m={maximumAge:6e5,timeout:0},Ns=!0):(m=this.options.positionOptions,Ns=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},L.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const t=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=pe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=pe.create("button","maplibregl-ctrl-globe",this._container),pe.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){pe.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},L.Hash=on,L.ImageSource=Vr,L.KeyboardHandler=Ho,L.LngLatBounds=pn,L.LogoControl=Ls,L.Map=class extends xo{constructor(m){var t,a;d.cH.mark(d.cI.create);const l=Object.assign(Object.assign(Object.assign({},Os),m),{canvasContextAttributes:Object.assign(Object.assign({},Os.canvasContextAttributes),m.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new kn,_=new Lo;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&h.setConstrainOverride(l.transformConstrain),super(h,_,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Si,this._controls=[],this._mapId=d.ah(),this._lostContextStyle={style:null,images:null},this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const S of Object.values(this.style._layers))if(S.type==="custom"&&console.warn(`Custom layer with id '${S.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),S._listeners)for(const[A]of Object.entries(S._listeners))console.warn(`Custom layer with id '${S.id}' had event listeners for event '${A}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new d.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new d.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},jl),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this._zoomLevelsToOverscale=l.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,l.reduceMotion!==void 0&&(ct.prefersReducedMotion=l.reduceMotion),this._imageQueueHandle=gt.addThrottleControl((()=>this.isMoving())),this._requestManager=new Vt(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1;const S=Ch((A=>{this._trackResize&&!this._removed&&(this.resize(A),this.redraw())}),50);this._resizeObserver=new ResizeObserver((A=>{w?S(A):w=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Ph(this,l),this._hash=l.hash&&new on(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,d.e({},l.fitBoundsOptions,{duration:0}))));const v=typeof l.style=="string"||((a=(t=l.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new En(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Ls,l.logoPosition),this.on("style.load",(()=>{if(v||this._resizeTransform(),this.transform.unmodified){const w=d.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}})),this.on("data",(w=>{this._update(w.dataType==="style"),this.fire(new d.l(`${w.dataType}data`,w))})),this.on("dataloading",(w=>{this.fire(new d.l(`${w.dataType}dataloading`,w))})),this.on("dataabort",(w=>{this.fire(new d.l("sourcedataabort",w))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,t){return this.style.setGlobalStateProperty(m,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(a,l.firstChild):l.appendChild(a),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return Tn(this.transform,m)}calculateCameraOptionsFromTo(m,t,a,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLat(a)),super.calculateCameraOptionsFromTo(m,t,a,l)}resize(m,t=!0){const[a,l]=this._containerDimensions(),h=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,h),this.painter.resize(a,l,h),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const w=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,w),this.painter.resize(a,l,w)}this._resizeTransform(t);const _=!this._moving;return _&&(this.stop(),this.fire(new d.l("movestart",m)).fire(new d.l("move",m))),this.fire(new d.l("resize",m)),_&&this.fire(new d.l("moveend",m)),this}_resizeTransform(m=!0){var t;const[a,l]=this._containerDimensions();this.transform.resize(a,l,m),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,l,m)}_getClampedPixelRatio(m,t){const{0:a,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),_=m*h,v=t*h;return Math.min(_>a?a/_:1,v>l?l/v:1)*h}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(pn.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(d.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(d.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,a){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layers:t,listener:a,delegates:{mousemove:_=>{const v=t.filter((S=>this.getLayer(S))),w=v.length!==0?this.queryRenderedFeatures(_.point,{layers:v}):[];w.length?l||(l=!0,a.call(this,new Zr(m,this,_.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layers:t,listener:a,delegates:{mousemove:v=>{const w=t.filter((S=>this.getLayer(S)));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?l=!0:l&&(l=!1,a.call(this,new Zr(m,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,a.call(this,new Zr(m,this,v.originalEvent)))}}}}{const l=h=>{const _=t.filter((w=>this.getLayer(w))),v=_.length!==0?this.queryRenderedFeatures(h.point,{layers:_}):[];v.length&&(h.features=v,a.call(this,h),delete h.features)};return{layers:t,listener:a,delegates:{[m]:l}}}}_saveDelegatedListener(m,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(t)}_removeDelegatedListener(m,t,a){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const l=this._delegatedListeners[m];for(let h=0;h<l.length;h++){const _=l[h];if(_.listener===a&&_.layers.length===t.length&&_.layers.every((v=>t.includes(v)))){for(const v in _.delegates)this.off(v,_.delegates[v]);return void l.splice(h,1)}}}on(m,t,a){if(a===void 0)return super.on(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,a);this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.on(_,h.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(m,l,a)}}}once(m,t,a){if(a===void 0)return super.once(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,a);for(const _ in h.delegates){const v=h.delegates[_];h.delegates[_]=(...w)=>{this._removeDelegatedListener(m,l,a),v(...w)}}this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.once(_,h.delegates[_]);return this}off(m,t,a){return a===void 0?super.off(m,t):(this._removeDelegatedListener(m,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let a;const l=m instanceof d.P||Array.isArray(m),h=l?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:m)||{},h instanceof d.P||typeof h[0]=="number")a=[d.P.convert(h)];else{const _=d.P.convert(h[0]),v=d.P.convert(h[1]);a=[_,new d.P(v.x,_.y),v,new d.P(_.x,v.y),_]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){var a,l;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,t)));const h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new io(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,h):this.style.loadJSON(m,t,h),this):((l=(a=this.style)===null||a===void 0?void 0:a.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new io(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const a=this._requestManager.transformRequest(m,"Style");d.j(a,new AbortController).then((l=>{this._updateDiff(l.data,t)})).catch((l=>{l&&this.fire(new d.k(l))}))}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(a){d.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.tileManagers[m];if(t!==void 0)return t.loaded();this.fire(new d.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.tileManagers[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const l=this.style._layers[a];l.type==="hillshade"&&l.source===m.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===m.source&&d.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ln(this.painter,t,m),this.painter.renderToTexture=new Bs(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var l;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=a.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new d.l("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const t of Object.values(m))if(!t.areTilesLoaded())return!1;return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,t,a){if(a){const l=this.getSource(a);if(!l)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);l.calculateTileZoom=zi(Math.max(1,m),Math.max(1,t))}else for(const l in this.style.tileManagers)this.style.tileManagers[l].getSource().calculateTileZoom=zi(Math.max(1,m),Math.max(1,t));return this._update(!0),this}refreshTiles(m,t){const a=this.style.tileManagers[m];if(!a)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((l=>new d.ae(l.z,l.x,l.y))))}addImage(m,t,a={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:_,stretchY:v,content:w,textFitWidth:S,textFitHeight:A}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||d.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:R,data:I}=t,F=t;return this.style.addImage(m,{data:new d.R({width:z,height:R},new Uint8Array(I)),pixelRatio:l,stretchX:_,stretchY:v,content:w,textFitWidth:S,textFitHeight:A,sdf:h,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m),this}}{const{width:z,height:R,data:I}=ct.getImageData(t);this.style.addImage(m,{data:new d.R({width:z,height:R},I),pixelRatio:l,stretchX:_,stretchY:v,content:w,textFitWidth:S,textFitHeight:A,sdf:h,version:0})}}updateImage(m,t){const a=this.style.getImage(m);if(!a)return this.fire(new d.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||d.b(t)?ct.getImageData(t):t,{width:h,height:_,data:v}=l;if(h===void 0||_===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==a.data.width||_!==a.data.height)return this.fire(new d.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||d.b(t));return a.data.replace(v,w),this.style.updateImage(m,a),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new d.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return gt.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,a){return this.style.setLayerZoomRange(m,t,a),this._update(!0)}setFilter(m,t,a={}){return this.style.setFilter(m,t,a),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,a,l={}){return this.style.setPaintProperty(m,t,a,l),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,a,l={}){return this.style.setLayoutProperty(m,t,a,l),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,a,(l=>{l||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,(a=>{a||this._update(!0)})),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=pe.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=pe.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),l=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],l);const h=this._controlContainer=pe.create("div","maplibregl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{_[v]=pe.create("div",`maplibregl-ctrl-${v} `,h)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t,a){this._canvas.width=Math.floor(a*m),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{t={requestedAttributes:m},l&&(t.statusMessage=l.statusMessage,t.type=l.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!a){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new Od(a,this.transform),mt.testSupport(a)}migrateProjection(m,t){super.migrateProjection(m,t),this.painter.transform=m,this.fire(new d.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var t,a,l,h,_;const v=this._idleTriggered?this._fadeDuration:0,w=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,I=rt();this.style.zoomHistory.update(R,I);const F=new d.H(R,{now:I,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=F.crossFadingFactor();U===1&&U===this._crossFadingFactor||(S=!0,this._crossFadingFactor=U),this.style.update(F)}const A=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==w;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||A)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,A),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new d.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.cH.mark(d.cI.load),this.fire(new d.l("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,d.cH.mark(d.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),gt.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),pe.remove(this._canvasContainer),pe.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),d.cH.clearMetrics(),this._removed=!0,this.fire(new d.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ct.frame(this._frameRequest,(m=>{d.cH.frame(m),this._frameRequest=null;try{this._render(m)}catch(t){if(!d.Z(t)&&!(function(a){return a.message===co})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return ks}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},L.MapMouseEvent=Zr,L.MapTouchEvent=Oa,L.MapWheelEvent=Bu,L.Marker=Gu,L.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const l=this._map._getUIString(`NavigationControl.${a}`);t.title=l,t.setAttribute("aria-label",l)},this.options=d.e({},Ih,m),this._container=pe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),pe.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),pe.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=pe.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new un(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){pe.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const a=pe.create("button",m,this._container);return a.type="button",a.addEventListener("click",t),a}},L.Popup=class extends d.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&pe.remove(this._content),this._container&&(pe.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=pe.create("div","maplibregl-popup",this._map.getContainer()),this._tip=pe.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Vl(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=ql(this.options.offset);if(!l){const v=this._container.offsetWidth,w=this._container.offsetHeight;let S;S=a.y+h.bottom.y<w?["top"]:a.y>this._map.transform.height-w?["bottom"]:[],a.x<v/2?S.push("left"):a.x>this._map.transform.width-v/2&&S.push("right"),l=S.length===0?"bottom":S.join("-")}let _=a.add(h[l]);this.options.subpixelPositioning||(_=_.round()),pe.setTransform(this._container,`${Ul[l]} translate(${_.x}px,${_.y}px)`),Uu(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(Wo),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=d.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),a=document.createElement("body");let l;for(a.innerHTML=m;l=a.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=pe.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=pe.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Gl);m&&m.focus()}},L.RasterDEMTileSource=Wa,L.RasterTileSource=Xs,L.ScaleControl=class{constructor(m){this._onMove=()=>{Ji(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ji(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},fr),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=pe.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){pe.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},L.ScrollZoomHandler=Rc,L.Style=io,L.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=pe.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=pe.create("button","maplibregl-ctrl-terrain",this._container),pe.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){pe.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},L.TwoFingersTouchPitchHandler=Rs,L.TwoFingersTouchRotateHandler=Fa,L.TwoFingersTouchZoomHandler=Is,L.TwoFingersTouchZoomRotateHandler=vo,L.VectorTileSource=bs,L.VideoSource=xe,L.addSourceType=(m,t)=>d._(void 0,void 0,void 0,(function*(){if(H(m))throw new Error(`A source type called "${m}" already exists.`);((a,l)=>{j[a]=l})(m,t)})),L.clearPrewarmedResources=function(){const m=Nt;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Ue),Nt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},L.createTileMesh=Sd,L.getMaxParallelImageRequests=function(){return d.c.MAX_PARALLEL_IMAGE_REQUESTS},L.getRTLTextPluginStatus=function(){return ye().getRTLTextPluginStatus()},L.getVersion=function(){return ja},L.getWorkerCount=function(){return yt.workerCount},L.getWorkerUrl=function(){return d.c.WORKER_URL},L.importScriptInWorkers=function(m){return gr().broadcast("IS",m)},L.isTimeFrozen=function(){return At.isFrozen()},L.now=rt,L.prewarm=function(){Ai().acquire(Ue)},L.restoreNow=function(){At.restoreNow()},L.setMaxParallelImageRequests=function(m){d.c.MAX_PARALLEL_IMAGE_REQUESTS=m},L.setNow=function(m){At.setNow(m)},L.setRTLTextPlugin=function(m,t){return ye().setRTLTextPlugin(m,t)},L.setWorkerCount=function(m){yt.workerCount=m},L.setWorkerUrl=function(m){d.c.WORKER_URL=m}}));var tt=Fe;return tt}))})(Vm)),Vm.exports}var j_=N_();const Mg=b_(j_);function V_(ae,et={}){const Fe=s_(ae),ee=(Fe[0]+Fe[2])/2,at=(Fe[1]+Fe[3])/2;return I_([ee,at],et.properties,et)}var Wg=V_;const sc=11102230246251565e-32,Da=134217729,U_=(3+8*sc)*sc;function Tg(ae,et,Fe,ee,at){let tt,L,d,de,_e=et[0],He=ee[0],Re=0,Ee=0;He>_e==He>-_e?(tt=_e,_e=et[++Re]):(tt=He,He=ee[++Ee]);let ct=0;if(Re<ae&&Ee<Fe)for(He>_e==He>-_e?(L=_e+tt,d=tt-(L-_e),_e=et[++Re]):(L=He+tt,d=tt-(L-He),He=ee[++Ee]),tt=L,d!==0&&(at[ct++]=d);Re<ae&&Ee<Fe;)He>_e==He>-_e?(L=tt+_e,de=L-tt,d=tt-(L-de)+(_e-de),_e=et[++Re]):(L=tt+He,de=L-tt,d=tt-(L-de)+(He-de),He=ee[++Ee]),tt=L,d!==0&&(at[ct++]=d);for(;Re<ae;)L=tt+_e,de=L-tt,d=tt-(L-de)+(_e-de),_e=et[++Re],tt=L,d!==0&&(at[ct++]=d);for(;Ee<Fe;)L=tt+He,de=L-tt,d=tt-(L-de)+(He-de),He=ee[++Ee],tt=L,d!==0&&(at[ct++]=d);return(tt!==0||ct===0)&&(at[ct++]=tt),ct}function G_(ae,et){let Fe=et[0];for(let ee=1;ee<ae;ee++)Fe+=et[ee];return Fe}function Up(ae){return new Float64Array(ae)}const q_=(3+16*sc)*sc,Z_=(2+12*sc)*sc,H_=(9+64*sc)*sc*sc,Pf=Up(4),Qg=Up(8),Kg=Up(12),Jg=Up(16),Ya=Up(4);function $_(ae,et,Fe,ee,at,tt,L){let d,de,_e,He,Re,Ee,ct,At,rt,pe,mt,Et,ut,vt,Bt,Tt,gt,Vt;const ti=ae-at,hi=Fe-at,si=et-tt,Jt=ee-tt;vt=ti*Jt,Ee=Da*ti,ct=Ee-(Ee-ti),At=ti-ct,Ee=Da*Jt,rt=Ee-(Ee-Jt),pe=Jt-rt,Bt=At*pe-(vt-ct*rt-At*rt-ct*pe),Tt=si*hi,Ee=Da*si,ct=Ee-(Ee-si),At=si-ct,Ee=Da*hi,rt=Ee-(Ee-hi),pe=hi-rt,gt=At*pe-(Tt-ct*rt-At*rt-ct*pe),mt=Bt-gt,Re=Bt-mt,Pf[0]=Bt-(mt+Re)+(Re-gt),Et=vt+mt,Re=Et-vt,ut=vt-(Et-Re)+(mt-Re),mt=ut-Tt,Re=ut-mt,Pf[1]=ut-(mt+Re)+(Re-Tt),Vt=Et+mt,Re=Vt-Et,Pf[2]=Et-(Vt-Re)+(mt-Re),Pf[3]=Vt;let di=G_(4,Pf),an=Z_*L;if(di>=an||-di>=an||(Re=ae-ti,d=ae-(ti+Re)+(Re-at),Re=Fe-hi,_e=Fe-(hi+Re)+(Re-at),Re=et-si,de=et-(si+Re)+(Re-tt),Re=ee-Jt,He=ee-(Jt+Re)+(Re-tt),d===0&&de===0&&_e===0&&He===0)||(an=H_*L+U_*Math.abs(di),di+=ti*He+Jt*d-(si*_e+hi*de),di>=an||-di>=an))return di;vt=d*Jt,Ee=Da*d,ct=Ee-(Ee-d),At=d-ct,Ee=Da*Jt,rt=Ee-(Ee-Jt),pe=Jt-rt,Bt=At*pe-(vt-ct*rt-At*rt-ct*pe),Tt=de*hi,Ee=Da*de,ct=Ee-(Ee-de),At=de-ct,Ee=Da*hi,rt=Ee-(Ee-hi),pe=hi-rt,gt=At*pe-(Tt-ct*rt-At*rt-ct*pe),mt=Bt-gt,Re=Bt-mt,Ya[0]=Bt-(mt+Re)+(Re-gt),Et=vt+mt,Re=Et-vt,ut=vt-(Et-Re)+(mt-Re),mt=ut-Tt,Re=ut-mt,Ya[1]=ut-(mt+Re)+(Re-Tt),Vt=Et+mt,Re=Vt-Et,Ya[2]=Et-(Vt-Re)+(mt-Re),Ya[3]=Vt;const fn=Tg(4,Pf,4,Ya,Qg);vt=ti*He,Ee=Da*ti,ct=Ee-(Ee-ti),At=ti-ct,Ee=Da*He,rt=Ee-(Ee-He),pe=He-rt,Bt=At*pe-(vt-ct*rt-At*rt-ct*pe),Tt=si*_e,Ee=Da*si,ct=Ee-(Ee-si),At=si-ct,Ee=Da*_e,rt=Ee-(Ee-_e),pe=_e-rt,gt=At*pe-(Tt-ct*rt-At*rt-ct*pe),mt=Bt-gt,Re=Bt-mt,Ya[0]=Bt-(mt+Re)+(Re-gt),Et=vt+mt,Re=Et-vt,ut=vt-(Et-Re)+(mt-Re),mt=ut-Tt,Re=ut-mt,Ya[1]=ut-(mt+Re)+(Re-Tt),Vt=Et+mt,Re=Vt-Et,Ya[2]=Et-(Vt-Re)+(mt-Re),Ya[3]=Vt;const qe=Tg(fn,Qg,4,Ya,Kg);vt=d*He,Ee=Da*d,ct=Ee-(Ee-d),At=d-ct,Ee=Da*He,rt=Ee-(Ee-He),pe=He-rt,Bt=At*pe-(vt-ct*rt-At*rt-ct*pe),Tt=de*_e,Ee=Da*de,ct=Ee-(Ee-de),At=de-ct,Ee=Da*_e,rt=Ee-(Ee-_e),pe=_e-rt,gt=At*pe-(Tt-ct*rt-At*rt-ct*pe),mt=Bt-gt,Re=Bt-mt,Ya[0]=Bt-(mt+Re)+(Re-gt),Et=vt+mt,Re=Et-vt,ut=vt-(Et-Re)+(mt-Re),mt=ut-Tt,Re=ut-mt,Ya[1]=ut-(mt+Re)+(Re-Tt),Vt=Et+mt,Re=Vt-Et,Ya[2]=Et-(Vt-Re)+(mt-Re),Ya[3]=Vt;const We=Tg(qe,Kg,4,Ya,Jg);return Jg[We-1]}function X_(ae,et,Fe,ee,at,tt){const L=(et-tt)*(Fe-at),d=(ae-at)*(ee-tt),de=L-d,_e=Math.abs(L+d);return Math.abs(de)>=q_*_e?de:-$_(ae,et,Fe,ee,at,tt,_e)}function Y_(ae,et){var Fe,ee,at=0,tt,L,d,de,_e,He,Re,Ee=ae[0],ct=ae[1],At=et.length;for(Fe=0;Fe<At;Fe++){ee=0;var rt=et[Fe],pe=rt.length-1;if(He=rt[0],He[0]!==rt[pe][0]&&He[1]!==rt[pe][1])throw new Error("First and last coordinates in a ring must be the same");for(L=He[0]-Ee,d=He[1]-ct,ee;ee<pe;ee++){if(Re=rt[ee+1],de=Re[0]-Ee,_e=Re[1]-ct,d===0&&_e===0){if(de<=0&&L>=0||L<=0&&de>=0)return 0}else if(_e>=0&&d<=0||_e<=0&&d>=0){if(tt=X_(L,de,d,_e,0,0),tt===0)return 0;(tt>0&&_e>0&&d<=0||tt<0&&_e<=0&&d>0)&&at++}He=Re,d=_e,L=de}}return at%2!==0}function W_(ae){if(!ae)throw new Error("coord is required");if(!Array.isArray(ae)){if(ae.type==="Feature"&&ae.geometry!==null&&ae.geometry.type==="Point")return[...ae.geometry.coordinates];if(ae.type==="Point")return[...ae.coordinates]}if(Array.isArray(ae)&&ae.length>=2&&!Array.isArray(ae[0])&&!Array.isArray(ae[1]))return[...ae];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Q_(ae){return ae.type==="Feature"?ae.geometry:ae}function K_(ae,et,Fe={}){if(!ae)throw new Error("point is required");if(!et)throw new Error("polygon is required");const ee=W_(ae),at=Q_(et),tt=at.type,L=et.bbox;let d=at.coordinates;if(L&&J_(ee,L)===!1)return!1;tt==="Polygon"&&(d=[d]);let de=!1;for(var _e=0;_e<d.length;++_e){const He=Y_(ee,d[_e]);if(He===0)return!Fe.ignoreBoundary;He&&(de=!0)}return de}function J_(ae,et){return et[0]<=ae[0]&&et[1]<=ae[1]&&et[2]>=ae[0]&&et[3]>=ae[1]}var e_=K_;const ey="pk.eyJ1Ijoib3BlbmFlcmlhbG1hcCIsImEiOiJjbWowaThzc2swOTVtM2NxMXA2Y2J3bDdzIn0.gmFG84efi2_zK6Yx5ot_5Q";function ty({features:ae,selectedFeature:et,onMapInit:Fe,searchBbox:ee,onSearchArea:at,onSelect:tt,layerMode:L,setLayerMode:d,previewedIds:de,hiddenIds:_e,basemap:He}){const Re=Ut.useRef(null),Ee=Ut.useRef(null),ct=Ut.useRef(null),At=Ut.useRef(null),rt=Ut.useRef(!1),pe=Ut.useRef(at),mt=Ut.useRef(tt),Et=Ut.useRef(et),[ut,vt]=Ut.useState(!1),[Bt,Tt]=Ut.useState(0),[gt,Vt]=Ut.useState("");Ut.useEffect(()=>{mt.current=tt},[tt]),Ut.useEffect(()=>{Et.current=et},[et]),Ut.useEffect(()=>{pe.current=at},[at]);const{largeFeatures:ti,smallFeatures:hi}=Ut.useMemo(()=>{const Ve=ae.filter(le=>le.properties.is_large),St=ae.filter(le=>!le.properties.is_large);return{largeFeatures:Ve,smallFeatures:St}},[ae]),si=(Ve,St)=>Math.floor((Ve+180)/360*Math.pow(2,St)),Jt=(Ve,St)=>Math.floor((1-Math.log(Math.tan(Ve*Math.PI/180)+1/Math.cos(Ve*Math.PI/180))/Math.PI)/2*Math.pow(2,St)),di=(Ve,St)=>Ve/Math.pow(2,St)*360-180,an=(Ve,St)=>{const le=Math.PI-2*Math.PI*Ve/Math.pow(2,St);return 180/Math.PI*Math.atan(.5*(Math.exp(le)-Math.exp(-le)))},fn=(Ve,St,le)=>{const ze=di(Ve,le),it=di(Ve+1,le),Ue=an(St,le),yt=an(St+1,le);return R_([[[ze,Ue],[it,Ue],[it,yt],[ze,yt],[ze,Ue]]],{x:Ve,y:St,z:le})},qe=()=>{const Ve=new URLSearchParams(window.location.search),St=parseFloat(Ve.get("lat")),le=parseFloat(Ve.get("lon")),ze=parseFloat(Ve.get("zoom"));return!isNaN(St)&&!isNaN(le)&&!isNaN(ze)?{center:[le,St],zoom:ze}:{center:[0,20],zoom:2}},We=()=>{if(!Ee.current)return;const Ve=Ee.current.getCenter(),St=Ee.current.getZoom(),le=new URLSearchParams(window.location.search);le.set("lat",Ve.lat.toFixed(4)),le.set("lon",Ve.lng.toFixed(4)),le.set("zoom",St.toFixed(1));const ze=`${window.location.pathname}?${le.toString()}`;window.history.replaceState({},"",ze)},pt=Ve=>{if(!(!Ee.current||!Ee.current.getSource("oam-grid"))){if(!Ve||Ve.length===0){Ee.current.getSource("oam-grid").setData({type:"FeatureCollection",features:[]});return}try{const St=Ve.map(gr=>Wg(gr)),le=Vp(Nm(St)),ze=Ee.current.getZoom();let it=Math.floor(ze)+4;it<2&&(it=2),it>14&&(it=14);let Ue=si(le[0],it),yt=si(le[2],it),kt=Jt(le[3],it),Nt=Jt(le[1],it);for(;(yt-Ue+1)*(Nt-kt+1)>2500&&it>0;)it--,Ue=si(le[0],it),yt=si(le[2],it),kt=Jt(le[3],it),Nt=Jt(le[1],it);const yi=[],Ai=ti.map(gr=>gr.geometry),Jn=ze>=8&&ze<10;for(let gr=Ue;gr<=yt;gr++)for(let hr=kt;hr<=Nt;hr++){const Pa=fn(gr,hr,it);let Zi=0,dr=!1;if(Jn){for(const _r of Ai)if(e_(Wg(Pa),_r)){dr=!0;break}}for(const _r of St)e_(_r,Pa)&&Zi++;Zi>0&&!(Jn&&dr)&&(Pa.properties={count:Number(Zi)},yi.push(Pa))}Ee.current.getSource("oam-grid").setData({type:"FeatureCollection",features:yi})}catch(St){console.error("Grid update error:",St)}}};return Ut.useEffect(()=>{if(Ee.current)return;const{center:Ve,zoom:St}=qe();Ee.current=new Mg.Map({container:Re.current,style:{version:8,sources:{"basemap-source":{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap &copy; CARTO"}},layers:[{id:"basemap-layer",type:"raster",source:"basemap-source"}]},center:Ve,zoom:St,attributionControl:!1}),Fe&&Fe(Ee.current),Ee.current.addControl(new Mg.AttributionControl,"bottom-right"),Ee.current.on("load",()=>{vt(!0),We(),Ee.current.addSource("oam-imagery",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),Ee.current.addSource("oam-large-imagery",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),Ee.current.addSource("oam-small-imagery",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),Ee.current.addSource("oam-grid",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),Ee.current.addLayer({id:"grid-fill",type:"fill",source:"oam-grid",maxzoom:10,paint:{"fill-color":["interpolate",["linear"],["get","count"],1,"#cceeff",5,"#66b3ff",20,"#0066cc",50,"#003366"],"fill-opacity":.65}}),Ee.current.addLayer({id:"grid-count",type:"symbol",source:"oam-grid",maxzoom:10,filter:[">",["get","count"],0],layout:{"text-field":"{count}","text-size":12,"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-allow-overlap":!1},paint:{"text-color":"#003366","text-halo-color":"#ffffff","text-halo-width":2}}),Ee.current.addLayer({id:"oam-large-fill",type:"fill",source:"oam-large-imagery",minzoom:8,maxzoom:22,paint:{"fill-color":"#00E5FF","fill-opacity":.1}}),Ee.current.addLayer({id:"oam-large-line",type:"line",source:"oam-large-imagery",minzoom:8,maxzoom:22,paint:{"line-color":"#00B0FF","line-width":2,"line-opacity":.8}}),Ee.current.addLayer({id:"oam-small-fill",type:"fill",source:"oam-small-imagery",minzoom:10,maxzoom:22,paint:{"fill-color":"#00E5FF","fill-opacity":.1}}),Ee.current.addLayer({id:"oam-small-line",type:"line",source:"oam-small-imagery",minzoom:10,maxzoom:22,paint:{"line-color":"#00B0FF","line-width":2,"line-opacity":.8}}),Ee.current.addLayer({id:"oam-highlight",type:"line",source:"oam-imagery",filter:["==","id",""],paint:{"line-color":"#FF0000","line-width":3}}),Ee.current.on("click",["oam-large-fill","oam-small-fill"],ze=>{if(ze.features&&ze.features.length>0){rt.current=!0;const it={type:"Feature",geometry:ze.features[0].geometry,properties:ze.features[0].properties};mt.current&&mt.current(it)}}),Ee.current.on("click","grid-fill",ze=>{if(ze.features[0].properties.count>0){const it=Vp(ze.features[0]);Ee.current.fitBounds(it,{padding:20})}}),Ee.current.on("click",ze=>{Ee.current.queryRenderedFeatures(ze.point,{layers:["oam-large-fill","oam-small-fill","grid-fill"]}).length===0&&mt.current&&mt.current(null)}),["oam-large-fill","oam-small-fill","grid-fill"].forEach(ze=>{Ee.current.on("mouseenter",ze,()=>{Ee.current.getCanvas().style.cursor="pointer"}),Ee.current.on("mouseleave",ze,()=>{Ee.current.getCanvas().style.cursor=""})}),Ee.current.on("movestart",()=>{ct.current&&clearTimeout(ct.current)}),Ee.current.on("moveend",()=>{We(),At.current&&clearTimeout(At.current),At.current=setTimeout(()=>{Tt(Ue=>Ue+1)},300);const ze=Ee.current.getZoom(),it=Et.current;if(it){const Ue=it.properties.is_large;(!Ue&&ze<10||Ue&&ze<8)&&mt.current&&mt.current(null)}if(rt.current){rt.current=!1;return}ct.current=setTimeout(()=>{if(!Ee.current)return;const Ue=Ee.current.getBounds(),yt=Ee.current.getCenter(),kt=[Ue.getWest(),Ue.getSouth(),Ue.getEast(),Ue.getNorth()];pe.current&&pe.current(kt,[yt.lng,yt.lat],[Ue.getWest(),Ue.getSouth(),Ue.getEast(),Ue.getNorth()])},1500)})})},[]),Ut.useEffect(()=>{!Ee.current||!ut||!Ee.current.getSource("oam-imagery")||(Ee.current.getSource("oam-imagery").setData(Nm(ae)),Ee.current.getSource("oam-large-imagery")&&Ee.current.getSource("oam-large-imagery").setData(Nm(ti)),Ee.current.getSource("oam-small-imagery")&&Ee.current.getSource("oam-small-imagery").setData(Nm(hi)),pt(ae))},[ae,ut,Bt,ti,hi]),Ut.useEffect(()=>{if(!(!Ee.current||!ut||!ee))try{rt.current=!0,Ee.current.fitBounds(ee,{padding:50,maxZoom:14})}catch{}},[ee,ut]),Ut.useEffect(()=>{if(!Ee.current||!ut)return;let Ve=[];He==="carto"?Ve=["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"]:He==="hot"?Ve=["https://a.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"]:He==="satellite"&&(Ve=[`https://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}@2x.png?access_token=${ey}`]);const St=Ee.current.getSource("basemap-source");St&&St.setTiles(Ve)},[He,ut]),Ut.useEffect(()=>{if(!Ee.current||!ut)return;const Ve=Ee.current;if(Ve.getLayer("selected-thumbnail")&&Ve.removeLayer("selected-thumbnail"),Ve.getSource("selected-thumbnail-source")&&Ve.removeSource("selected-thumbnail-source"),!et){Ve.setFilter("oam-highlight",["==","id",""]);return}const St=et.properties.id,le=et.properties.thumbnail;Ve.setFilter("oam-highlight",["==","id",St]);try{const ze=Vp(et);if(rt.current||Ve.fitBounds(ze,{padding:50,maxZoom:18,duration:1500}),le){const it=`https://corsproxy.io/?${encodeURIComponent(le)}`,Ue=[[ze[0],ze[3]],[ze[2],ze[3]],[ze[2],ze[1]],[ze[0],ze[1]]];Ve.addSource("selected-thumbnail-source",{type:"image",url:it,coordinates:Ue}),Ve.addLayer({id:"selected-thumbnail",type:"raster",source:"selected-thumbnail-source",paint:{"raster-opacity":.9,"raster-fade-duration":0}},"oam-highlight")}}catch{}},[et,ut]),Ut.useEffect(()=>{if(!Ee.current||!ut)return;const Ve=Ee.current,St=new Set,le=L==="previews",ze=Ve.getZoom();le?ze<8?Vt("Zoom in to see images"):(Vt(""),ae.forEach(Ue=>{_e.has(Ue.properties.id)||St.add(Ue.properties.id)})):Vt(""),de.forEach(Ue=>St.add(Ue));const it=Ve.getStyle();it&&it.layers&&it.layers.forEach(Ue=>{if(Ue.id.startsWith("preview-")){const yt=Ue.id.replace("preview-","");St.has(yt)||(Ve.removeLayer(Ue.id),Ve.getSource(Ue.id)&&Ve.removeSource(Ue.id))}}),St.forEach(Ue=>{const yt=`preview-${Ue}`;if(Ve.getLayer(yt))return;const kt=ae.find(Nt=>Nt.properties.id===Ue);if(kt&&kt.properties.thumbnail)try{const Nt=Vp(kt),yi=[[Nt[0],Nt[3]],[Nt[2],Nt[3]],[Nt[2],Nt[1]],[Nt[0],Nt[1]]],Ai=`https://corsproxy.io/?${encodeURIComponent(kt.properties.thumbnail)}`;Ve.addSource(yt,{type:"image",url:Ai,coordinates:yi}),Ve.addLayer({id:yt,type:"raster",source:yt,paint:{"raster-opacity":.9,"raster-fade-duration":0}},"oam-highlight")}catch(Nt){console.error("Error adding layer",Ue,Nt)}}),Ve.getLayer("oam-large-fill")&&(Ve.setPaintProperty("oam-large-fill","fill-opacity",.1),Ve.setPaintProperty("oam-small-fill","fill-opacity",.1),Ve.getLayer("grid-fill")&&(Ve.setLayoutProperty("grid-fill","visibility","visible"),Ve.setLayoutProperty("grid-count","visibility","visible")))},[L,ae,ut,de,_e]),ke.jsxs("div",{className:"relative w-full h-full",children:[ke.jsx("div",{ref:Re,className:"w-full h-full"}),ke.jsxs("div",{className:"absolute bottom-8 left-4 z-10 bg-white rounded-md shadow-md border border-gray-200 flex flex-col overflow-hidden",children:[ke.jsx("button",{onClick:()=>d("none"),className:`px-4 py-2 text-xs font-semibold text-left hover:bg-gray-50 border-b border-gray-100 ${L==="none"?"bg-gray-100 text-cyan-700":"text-gray-600"}`,children:"Footprints Only"}),ke.jsx("button",{onClick:()=>d("previews"),className:`px-4 py-2 text-xs font-semibold text-left hover:bg-gray-50 ${L==="previews"?"bg-cyan-50 text-cyan-700":"text-gray-600"}`,children:"Live Previews"})]}),L==="previews"&&gt&&ke.jsx("div",{className:"absolute bottom-8 left-36 z-30 bg-black/80 text-white text-xs px-4 py-2 rounded-full shadow-lg animate-fade-in pointer-events-none whitespace-nowrap",children:gt})]})}function iy({filters:ae,onChange:et}){const[Fe,ee]=Ut.useState(null),[at,tt]=Ut.useState(!1),L=Ut.useRef(null);Ut.useEffect(()=>{function vt(Bt){L.current&&!L.current.contains(Bt.target)&&ee(null)}return document.addEventListener("mousedown",vt),()=>document.removeEventListener("mousedown",vt)},[]);const d=(vt,Bt)=>{et({...ae,[vt]:Bt}),ee(null)},de=new Date().toISOString().split("T")[0],_e=vt=>{const Bt=new Date;Bt.setDate(Bt.getDate()-vt);const Tt=Bt.toISOString().split("T")[0];et({...ae,dateEnd:de,dateStart:Tt}),ee(null)},He=()=>{const vt=new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0];et({...ae,dateEnd:de,dateStart:vt}),ee(null)},Re=()=>{et({...ae,dateStart:"",dateEnd:""}),ee(null)},Ee=vt=>{if(!ae.dateStart||!ae.dateEnd)return!1;const Bt=new Date;return Bt.setDate(Bt.getDate()-vt),ae.dateStart===Bt.toISOString().split("T")[0]&&ae.dateEnd===de},ct=()=>{if(!ae.dateStart)return!1;const vt=new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0];return ae.dateStart===vt},At=!ae.dateStart&&!ae.dateEnd,rt=()=>({satellite:"Satellite",uav:"Drone",aircraft:"Other"})[ae.platform]||"All Platforms",pe=()=>At?"Any Date":Ee(7)?"Past Week":Ee(30)?"Past Month":ct()?"This Year":"Custom Date",mt=()=>ae.license?ae.license.includes("BY-SA")?"CC BY-SA 4.0":ae.license.includes("BY-NC")?"CC BY-NC 4.0":ae.license.includes("CC-BY")?"CC BY 4.0":"License":"Any License",Et="px-4 py-2 bg-white rounded-full shadow-md text-sm font-bold text-gray-600 border border-gray-200 hover:bg-gray-50 flex items-center gap-2 transition-all",ut="border-cyan-500 text-cyan-700 bg-cyan-50 ring-2 ring-cyan-100";return ke.jsxs("div",{ref:L,className:"flex flex-wrap gap-3 font-sans",children:[ke.jsxs("div",{className:"relative",children:[ke.jsxs("button",{onClick:()=>ee(Fe==="platform"?null:"platform"),className:`${Et} ${ae.platform?ut:""}`,children:[rt()," ",ke.jsx("span",{className:"text-[10px] text-gray-400",children:""})]}),Fe==="platform"&&ke.jsx("div",{className:"absolute top-full mt-2 left-0 w-48 bg-white rounded-lg shadow-xl border border-gray-100 py-1 overflow-hidden animate-fade-in z-50",children:[{label:"All Platforms",val:""},{label:"Satellite",val:"satellite"},{label:"Drone (UAV)",val:"uav"},{label:"Other / Aircraft",val:"aircraft"}].map(vt=>ke.jsx("button",{onClick:()=>d("platform",vt.val),className:`w-full text-left px-4 py-2.5 text-sm hover:bg-gray-50 ${ae.platform===vt.val?"text-cyan-600 font-bold bg-cyan-50":"text-gray-700"}`,children:vt.label},vt.label))})]}),ke.jsxs("div",{className:"relative",children:[ke.jsxs("button",{onClick:()=>ee(Fe==="date"?null:"date"),className:`${Et} ${At?"":ut}`,children:[pe()," ",ke.jsx("span",{className:"text-[10px] text-gray-400",children:""})]}),Fe==="date"&&ke.jsxs("div",{className:"absolute top-full mt-2 left-0 w-64 bg-white rounded-lg shadow-xl border border-gray-100 p-2 animate-fade-in z-50",children:[ke.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[ke.jsx("button",{onClick:Re,className:`px-3 py-2 rounded text-xs font-medium border ${At?"bg-cyan-100 border-cyan-500 text-cyan-800":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:"Any Date"}),ke.jsx("button",{onClick:()=>_e(7),className:`px-3 py-2 rounded text-xs font-medium border ${Ee(7)?"bg-cyan-100 border-cyan-500 text-cyan-800":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:"Past Week"}),ke.jsx("button",{onClick:()=>_e(30),className:`px-3 py-2 rounded text-xs font-medium border ${Ee(30)?"bg-cyan-100 border-cyan-500 text-cyan-800":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:"Past Month"}),ke.jsx("button",{onClick:He,className:`px-3 py-2 rounded text-xs font-medium border ${ct()?"bg-cyan-100 border-cyan-500 text-cyan-800":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:"This Year"})]}),ke.jsx("button",{onClick:()=>tt(!at),className:"w-full text-xs text-center text-gray-400 hover:text-cyan-600 underline py-1",children:at?"Hide Custom":"Custom Range..."}),at&&ke.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-100 flex gap-1 items-center",children:[ke.jsx("input",{type:"date",max:de,value:ae.dateStart,onChange:vt=>d("dateStart",vt.target.value),className:"w-full text-[10px] border rounded px-1 py-1"}),ke.jsx("span",{className:"text-gray-300",children:"-"}),ke.jsx("input",{type:"date",max:de,value:ae.dateEnd,onChange:vt=>d("dateEnd",vt.target.value),className:"w-full text-[10px] border rounded px-1 py-1"})]})]})]}),ke.jsxs("div",{className:"relative",children:[ke.jsxs("button",{onClick:()=>ee(Fe==="license"?null:"license"),className:`${Et} ${ae.license?ut:""}`,children:[mt()," ",ke.jsx("span",{className:"text-[10px] text-gray-400",children:""})]}),Fe==="license"&&ke.jsx("div",{className:"absolute top-full mt-2 left-0 w-48 bg-white rounded-lg shadow-xl border border-gray-100 py-1 overflow-hidden animate-fade-in z-50",children:[{label:"Any License",val:""},{label:"CC BY 4.0",val:"CC-BY 4.0"},{label:"CC BY-NC 4.0",val:"CC BY-NC 4.0"},{label:"CC BY-SA 4.0",val:"CC BY-SA 4.0"}].map(vt=>ke.jsx("button",{onClick:()=>d("license",vt.val),className:`w-full text-left px-4 py-2.5 text-sm hover:bg-gray-50 ${ae.license===vt.val?"text-cyan-600 font-bold bg-cyan-50":"text-gray-700"}`,children:vt.label},vt.label))})]}),(ae.platform||ae.dateStart||ae.license)&&ke.jsx("button",{onClick:()=>et({dateStart:"",dateEnd:"",platform:"",license:""}),className:"px-3 py-2 bg-white/90 rounded-full text-xs font-bold text-red-500 hover:bg-red-50 border border-transparent hover:border-red-100 shadow-sm transition-all",children:" Clear"})]})}const jm={Plus:()=>ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"}),Minus:()=>ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"}),Search:()=>ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"}),Layers:()=>ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0121 18.382V7.618a1 1 0 01-.447-.894L15 7m0 13V7"})};function ny({mapInstance:ae,onLocationSelect:et,basemap:Fe,setBasemap:ee,className:at}){const[tt,L]=Ut.useState(null),[d,de]=Ut.useState(""),[_e,He]=Ut.useState(!1),Re=()=>ae?.zoomIn(),Ee=()=>ae?.zoomOut(),ct=ut=>{L(tt===ut?null:ut)},At=async ut=>{if(ut.preventDefault(),!!d){He(!0);try{const Bt=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(d)}`)).json();if(Bt&&Bt.length>0){const Tt=Bt[0],gt=[parseFloat(Tt.boundingbox[2]),parseFloat(Tt.boundingbox[0]),parseFloat(Tt.boundingbox[3]),parseFloat(Tt.boundingbox[1])];et(gt,Tt.display_name),L(null),de("")}else alert("Location not found")}catch(vt){console.error(vt)}He(!1)}},rt="w-9 h-9 bg-white border border-gray-200 text-gray-600 hover:text-cyan-600 hover:bg-gray-50 flex items-center justify-center transition-colors shadow-sm relative z-20",pe="rounded-t-md",mt="rounded-b-md",Et="border-t-0";return ke.jsxs("div",{className:`flex flex-col font-sans shadow-lg rounded-md ${at}`,children:[ke.jsxs("div",{className:"relative group",children:[ke.jsx("button",{onClick:()=>ct("search"),className:`${rt} ${pe} ${tt==="search"?"text-cyan-600 bg-cyan-50":""}`,title:"Search Location",children:ke.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:ke.jsx(jm.Search,{})})}),tt==="search"&&ke.jsx("div",{className:"absolute left-10 top-0 bg-white p-2 rounded shadow-xl border border-gray-200 w-64 animate-fade-in-right flex gap-1 h-9 items-center z-50",children:ke.jsxs("form",{onSubmit:At,className:"flex gap-1 w-full",children:[ke.jsx("input",{autoFocus:!0,type:"text",value:d,onChange:ut=>de(ut.target.value),placeholder:"City, Country...",className:"flex-1 text-xs border border-gray-300 rounded px-2 py-1 outline-none focus:border-cyan-500"}),ke.jsx("button",{type:"submit",disabled:_e,className:"bg-cyan-500 text-white px-2 py-1 rounded text-xs font-bold hover:bg-cyan-600",children:_e?"..":"Go"})]})})]}),ke.jsxs("div",{className:"relative",children:[ke.jsx("button",{onClick:()=>ct("layers"),className:`${rt} ${Et} ${tt==="layers"?"text-cyan-600 bg-cyan-50":""}`,title:"Change Basemap",children:ke.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:ke.jsx(jm.Layers,{})})}),tt==="layers"&&ke.jsxs("div",{className:"absolute left-10 top-0 bg-white rounded shadow-xl border border-gray-200 overflow-hidden w-48 animate-fade-in-right z-50",children:[ke.jsx("div",{className:"text-[10px] uppercase font-bold text-gray-400 px-3 py-2 bg-gray-50 border-b border-gray-100",children:"Basemap"}),[{id:"carto",label:"Carto Light"},{id:"hot",label:"Humanitarian OSM"},{id:"satellite",label:"Mapbox Satellite"}].map(ut=>ke.jsx("button",{onClick:()=>{ee(ut.id),L(null)},className:`block w-full text-left px-4 py-2 text-xs font-medium hover:bg-gray-50 border-b border-gray-50 last:border-0 ${Fe===ut.id?"text-cyan-600 bg-cyan-50":"text-gray-700"}`,children:ut.label},ut.id))]})]}),ke.jsx("button",{onClick:Re,className:`${rt} ${Et}`,title:"Zoom In",children:ke.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:ke.jsx(jm.Plus,{})})}),ke.jsx("button",{onClick:Ee,className:`${rt} ${Et} ${mt}`,title:"Zoom Out",children:ke.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:ke.jsx(jm.Minus,{})})})]})}function ry({center:ae,zoom:et,bounds:Fe}){const ee=Ut.useRef(null),at=Ut.useRef(null);return Ut.useEffect(()=>{at.current||(at.current=new Mg.Map({container:ee.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:""},box:{type:"geojson",data:{type:"FeatureCollection",features:[]}}},layers:[{id:"osm",type:"raster",source:"osm",minzoom:0,maxzoom:22},{id:"box-line",type:"line",source:"box",paint:{"line-color":"#EF4444","line-width":2}},{id:"box-fill",type:"fill",source:"box",paint:{"fill-color":"#EF4444","fill-opacity":.1}}]},center:ae||[0,20],zoom:0,interactive:!1,attributionControl:!1}))},[]),Ut.useEffect(()=>{if(at.current&&(ae&&at.current.setCenter(ae),Fe)){const[tt,L,d,de]=Fe,_e={type:"Polygon",coordinates:[[[tt,de],[d,de],[d,L],[tt,L],[tt,de]]]},He=at.current.getSource("box");He&&He.setData({type:"Feature",properties:{},geometry:_e})}},[ae,Fe]),ke.jsxs("div",{className:"relative group",children:[ke.jsx("div",{ref:ee,className:"w-32 h-32 border-2 border-white rounded shadow-lg bg-gray-100 pointer-events-none"}),ke.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-20",children:[ke.jsx("div",{className:"w-full h-[1px] bg-black"}),ke.jsx("div",{className:"h-full w-[1px] bg-black absolute"})]})]})}function ay(){const[ae,et]=Ut.useState(!1),Fe=[{label:"Upload Imagery",href:"https://upload.openaerialmap.org/"},{label:"About OAM",href:"http://openaerialmap.org/about"},{label:"Documentation",href:"http://docs.openaerialmap.org"},{label:"System Status",href:"https://uptime.hotosm.org/"},{label:"Contact Support",href:"mailto:info@openaerialmap.org"}];return ke.jsxs("div",{className:"absolute top-4 right-4 z-50 font-sans",children:[ke.jsx("button",{onClick:()=>et(!ae),className:"w-10 h-10 bg-white rounded shadow-md border border-gray-200 flex items-center justify-center text-gray-600 hover:text-cyan-600 hover:bg-gray-50 transition-all",children:ae?ke.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):ke.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),ae&&ke.jsx("div",{className:"absolute top-12 right-0 w-48 bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden animate-fade-in origin-top-right",children:ke.jsx("div",{className:"py-1",children:Fe.map(ee=>ke.jsx("a",{href:ee.href,target:"_blank",rel:"noreferrer",className:"block px-4 py-2.5 text-sm text-gray-700 hover:bg-cyan-50 hover:text-cyan-700 transition-colors border-b border-gray-50 last:border-0",onClick:()=>et(!1),children:ee.label},ee.label))})})]})}function sy(ae){return B_(ae,(et,Fe)=>et+oy(Fe),0)}function oy(ae){let et=0,Fe;switch(ae.type){case"Polygon":return t_(ae.coordinates);case"MultiPolygon":for(Fe=0;Fe<ae.coordinates.length;Fe++)et+=t_(ae.coordinates[Fe]);return et;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function t_(ae){let et=0;if(ae&&ae.length>0){et+=Math.abs(i_(ae[0]));for(let Fe=1;Fe<ae.length;Fe++)et-=Math.abs(i_(ae[Fe]))}return et}var ly=$g*$g/2,Sg=Math.PI/180;function i_(ae){const et=ae.length-1;if(et<=2)return 0;let Fe=0,ee=0;for(;ee<et;){const at=ae[ee],tt=ae[ee+1===et?0:ee+1],L=ae[ee+2>=et?(ee+2)%et:ee+2],d=at[0]*Sg,de=tt[1]*Sg,_e=L[0]*Sg;Fe+=(_e-d)*Math.sin(de),ee++}return Fe*ly}var uy=sy;const n_=50,cy=25;function hy(){const[ae,et]=Ut.useState([]),[Fe,ee]=Ut.useState(null),[at,tt]=Ut.useState(null),[L,d]=Ut.useState(null),[de,_e]=Ut.useState([0,20]),[He,Re]=Ut.useState(null),[Ee,ct]=Ut.useState(!1),At=Ut.useRef(!1),[rt,pe]=Ut.useState("none"),[mt,Et]=Ut.useState(new Set),[ut,vt]=Ut.useState(new Set),[Bt,Tt]=Ut.useState("carto"),[gt,Vt]=Ut.useState({dateStart:"",dateEnd:"",platform:"",license:""}),ti=We=>{const pt=new URLSearchParams(window.location.search);We?pt.set("selected_id",We.properties.id):pt.delete("selected_id"),window.history.replaceState({},"",`${window.location.pathname}?${pt.toString()}`)},hi=We=>{ee(We),ti(We)},si=We=>{rt==="previews"?vt(pt=>{const Ve=new Set(pt);return Ve.has(We)?Ve.delete(We):Ve.add(We),Ve}):Et(pt=>{const Ve=new Set(pt);return Ve.has(We)?Ve.delete(We):Ve.add(We),Ve})},Jt=We=>{if(!We)return"Unknown";const pt=1073741824,Ve=1048576;return We>=pt?`${(We/pt).toFixed(2)} GB`:`${Math.round(We/Ve)} MB`},di=async(We=null,pt=gt)=>{ct(!0);try{let St=`https://corsproxy.io/?https://api.openaerialmap.org/meta?limit=${n_}&order_by=acquisition_end&sort=desc`;if(We&&(St+=`&bbox=${We.join(",")}`),pt.dateStart&&(St+=`&acquisition_from=${pt.dateStart}`),pt.dateEnd&&(St+=`&acquisition_to=${pt.dateEnd}`),pt.platform){const it=pt.platform==="other"?"aircraft":pt.platform;St+=`&platform=${it}`}const ze=await(await fetch(St)).json();if(ze.results){let it=ze.results.map(Ue=>{const yt=Ue.platform||Ue.properties?.platform||"unknown",kt=Ue.geojson?uy(Ue.geojson):0;return{type:"Feature",geometry:Ue.geojson,properties:{id:Ue._id,uuid:Ue.uuid,title:Ue.title||"Untitled Image",provider:Ue.provider,thumbnail:Ue.properties?.thumbnail||null,date:Ue.acquisition_end||"Unknown Date",is_large:kt/1e6>=cy,platform:yt.toLowerCase(),sensor:Ue.sensor||Ue.properties?.sensor||"Unknown Sensor",gsd:Ue.gsd?`${Ue.gsd.toFixed(2)} m`:"N/A",file_size:Jt(Ue.file_size),license:Ue.license||Ue.properties?.license||"Unknown License",tags:Ue.tags?Ue.tags.join(", "):"None"}}});if(pt.platform&&(it=it.filter(Ue=>{const yt=Ue.properties.platform;return pt.platform==="satellite"?yt==="satellite":pt.platform==="uav"?yt==="uav"||yt==="drone":pt.platform==="aircraft"?yt!=="satellite"&&yt!=="uav"&&yt!=="drone":!0})),pt.license){const Ue=pt.license.replace(/[\s-]/g,"").toLowerCase();it=it.filter(yt=>(yt.properties.license||"").replace(/[\s-]/g,"").toLowerCase().includes(Ue))}et(it)}else et([])}catch(Ve){console.error("Fetch error:",Ve)}ct(!1)};Ut.useEffect(()=>{di()},[]),Ut.useEffect(()=>{if(ae.length>0&&!At.current){const pt=new URLSearchParams(window.location.search).get("selected_id");if(pt){const Ve=ae.find(St=>St.properties.id===pt);Ve&&ee(Ve)}At.current=!0}},[ae]);const an=We=>{Vt(We),di(at,We)},fn=(We,pt)=>{tt(We),di(We)},qe=(We,pt,Ve)=>{tt(We),_e(pt),Re(Ve),di(We)};return ke.jsxs("div",{className:"flex w-full h-screen overflow-hidden bg-gray-100 font-sans",children:[ke.jsx("div",{className:"flex flex-col w-96 h-full bg-white border-r border-gray-200 shadow-xl z-20 relative",children:ke.jsx(O_,{features:ae,onSelect:hi,selectedFeature:Fe,isLoading:Ee,limit:n_,layerMode:rt,previewedIds:mt,hiddenIds:ut,onTogglePreview:si})}),ke.jsxs("div",{className:"flex-1 h-full relative",children:[ke.jsx("div",{className:"absolute top-4 left-4 z-30 w-full max-w-2xl",children:ke.jsx(iy,{filters:gt,onChange:an})}),ke.jsx(ay,{}),ke.jsx("div",{className:"absolute bottom-8 right-4 z-30",children:ke.jsx(ry,{center:de,bounds:He})}),ke.jsx(ny,{className:"absolute bottom-36 left-4 z-30",mapInstance:L,onLocationSelect:fn,basemap:Bt,setBasemap:Tt}),ke.jsx(ty,{onMapInit:d,features:ae,selectedFeature:Fe,onSelect:hi,searchBbox:at,onSearchArea:qe,layerMode:rt,setLayerMode:pe,previewedIds:mt,hiddenIds:ut,basemap:Bt})]})]})}P_.createRoot(document.getElementById("root")).render(ke.jsx(Ut.StrictMode,{children:ke.jsx(hy,{})}));
