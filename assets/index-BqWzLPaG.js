(function(){const ot=document.createElement("link").relList;if(ot&&ot.supports&&ot.supports("modulepreload"))return;for(const rt of document.querySelectorAll('link[rel="modulepreload"]'))oe(rt);new MutationObserver(rt=>{for(const yt of rt)if(yt.type==="childList")for(const k of yt.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&oe(k)}).observe(document,{childList:!0,subtree:!0});function Xe(rt){const yt={};return rt.integrity&&(yt.integrity=rt.integrity),rt.referrerPolicy&&(yt.referrerPolicy=rt.referrerPolicy),rt.crossOrigin==="use-credentials"?yt.credentials="include":rt.crossOrigin==="anonymous"?yt.credentials="omit":yt.credentials="same-origin",yt}function oe(rt){if(rt.ep)return;rt.ep=!0;const yt=Xe(rt);fetch(rt.href,yt)}})();function h_(fe){return fe&&fe.__esModule&&Object.prototype.hasOwnProperty.call(fe,"default")?fe.default:fe}var cg={exports:{}},Bp={};var Ig;function d_(){if(Ig)return Bp;Ig=1;var fe=Symbol.for("react.transitional.element"),ot=Symbol.for("react.fragment");function Xe(oe,rt,yt){var k=null;if(yt!==void 0&&(k=""+yt),rt.key!==void 0&&(k=""+rt.key),"key"in rt){yt={};for(var d in rt)d!=="key"&&(yt[d]=rt[d])}else yt=rt;return rt=yt.ref,{$$typeof:fe,type:oe,key:k,ref:rt!==void 0?rt:null,props:yt}}return Bp.Fragment=ot,Bp.jsx=Xe,Bp.jsxs=Xe,Bp}var Pg;function f_(){return Pg||(Pg=1,cg.exports=d_()),cg.exports}var Le=f_(),hg={exports:{}},ti={};var Rg;function p_(){if(Rg)return ti;Rg=1;var fe=Symbol.for("react.transitional.element"),ot=Symbol.for("react.portal"),Xe=Symbol.for("react.fragment"),oe=Symbol.for("react.strict_mode"),rt=Symbol.for("react.profiler"),yt=Symbol.for("react.consumer"),k=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),ge=Symbol.for("react.suspense"),Be=Symbol.for("react.memo"),ut=Symbol.for("react.lazy"),mt=Symbol.for("react.activity"),Ke=Symbol.iterator;function kt(ie){return ie===null||typeof ie!="object"?null:(ie=Ke&&ie[Ke]||ie["@@iterator"],typeof ie=="function"?ie:null)}var Ht={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},xt=Object.assign,me={};function $t(ie,Ae,it){this.props=ie,this.context=Ae,this.refs=me,this.updater=it||Ht}$t.prototype.isReactComponent={},$t.prototype.setState=function(ie,Ae){if(typeof ie!="object"&&typeof ie!="function"&&ie!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ie,Ae,"setState")},$t.prototype.forceUpdate=function(ie){this.updater.enqueueForceUpdate(this,ie,"forceUpdate")};function jt(){}jt.prototype=$t.prototype;function dt(ie,Ae,it){this.props=ie,this.context=Ae,this.refs=me,this.updater=it||Ht}var Dt=dt.prototype=new jt;Dt.constructor=dt,xt(Dt,$t.prototype),Dt.isPureReactComponent=!0;var Yt=Array.isArray;function It(){}var bt={H:null,A:null,T:null,S:null},li=Object.prototype.hasOwnProperty;function Vi(ie,Ae,it){var Qe=it.ref;return{$$typeof:fe,type:ie,key:Ae,ref:Qe!==void 0?Qe:null,props:it}}function cn(ie,Ae){return Vi(ie.type,Ae,ie.props)}function hn(ie){return typeof ie=="object"&&ie!==null&&ie.$$typeof===fe}function Mi(ie){var Ae={"=":"=0",":":"=2"};return"$"+ie.replace(/[=:]/g,function(it){return Ae[it]})}var dn=/\/+/g;function Kn(ie,Ae){return typeof ie=="object"&&ie!==null&&ie.key!=null?Mi(""+ie.key):Ae.toString(36)}function Hi(ie){switch(ie.status){case"fulfilled":return ie.value;case"rejected":throw ie.reason;default:switch(typeof ie.status=="string"?ie.then(It,It):(ie.status="pending",ie.then(function(Ae){ie.status==="pending"&&(ie.status="fulfilled",ie.value=Ae)},function(Ae){ie.status==="pending"&&(ie.status="rejected",ie.reason=Ae)})),ie.status){case"fulfilled":return ie.value;case"rejected":throw ie.reason}}throw ie}function Ve(ie,Ae,it,Qe,ht){var ft=typeof ie;(ft==="undefined"||ft==="boolean")&&(ie=null);var Et=!1;if(ie===null)Et=!0;else switch(ft){case"bigint":case"string":case"number":Et=!0;break;case"object":switch(ie.$$typeof){case fe:case ot:Et=!0;break;case ut:return Et=ie._init,Ve(Et(ie._payload),Ae,it,Qe,ht)}}if(Et)return ht=ht(ie),Et=Qe===""?"."+Kn(ie,0):Qe,Yt(ht)?(it="",Et!=null&&(it=Et.replace(dn,"$&/")+"/"),Ve(ht,Ae,it,"",function(Jn){return Jn})):ht!=null&&(hn(ht)&&(ht=cn(ht,it+(ht.key==null||ie&&ie.key===ht.key?"":(""+ht.key).replace(dn,"$&/")+"/")+Et)),Ae.push(ht)),1;Et=0;var ii=Qe===""?".":Qe+":";if(Yt(ie))for(var wi=0;wi<ie.length;wi++)Qe=ie[wi],ft=ii+Kn(Qe,wi),Et+=Ve(Qe,Ae,it,ft,ht);else if(wi=kt(ie),typeof wi=="function")for(ie=wi.call(ie),wi=0;!(Qe=ie.next()).done;)Qe=Qe.value,ft=ii+Kn(Qe,wi++),Et+=Ve(Qe,Ae,it,ft,ht);else if(ft==="object"){if(typeof ie.then=="function")return Ve(Hi(ie),Ae,it,Qe,ht);throw Ae=String(ie),Error("Objects are not valid as a React child (found: "+(Ae==="[object Object]"?"object with keys {"+Object.keys(ie).join(", ")+"}":Ae)+"). If you meant to render a collection of children, use an array instead.")}return Et}function st(ie,Ae,it){if(ie==null)return ie;var Qe=[],ht=0;return Ve(ie,Qe,"","",function(ft){return Ae.call(it,ft,ht++)}),Qe}function Lt(ie){if(ie._status===-1){var Ae=ie._result;Ae=Ae(),Ae.then(function(it){(ie._status===0||ie._status===-1)&&(ie._status=1,ie._result=it)},function(it){(ie._status===0||ie._status===-1)&&(ie._status=2,ie._result=it)}),ie._status===-1&&(ie._status=0,ie._result=Ae)}if(ie._status===1)return ie._result.default;throw ie._result}var Re=typeof reportError=="function"?reportError:function(ie){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Ae=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ie=="object"&&ie!==null&&typeof ie.message=="string"?String(ie.message):String(ie),error:ie});if(!window.dispatchEvent(Ae))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ie);return}console.error(ie)},tt={map:st,forEach:function(ie,Ae,it){st(ie,function(){Ae.apply(this,arguments)},it)},count:function(ie){var Ae=0;return st(ie,function(){Ae++}),Ae},toArray:function(ie){return st(ie,function(Ae){return Ae})||[]},only:function(ie){if(!hn(ie))throw Error("React.Children.only expected to receive a single React element child.");return ie}};return ti.Activity=mt,ti.Children=tt,ti.Component=$t,ti.Fragment=Xe,ti.Profiler=rt,ti.PureComponent=dt,ti.StrictMode=oe,ti.Suspense=ge,ti.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=bt,ti.__COMPILER_RUNTIME={__proto__:null,c:function(ie){return bt.H.useMemoCache(ie)}},ti.cache=function(ie){return function(){return ie.apply(null,arguments)}},ti.cacheSignal=function(){return null},ti.cloneElement=function(ie,Ae,it){if(ie==null)throw Error("The argument must be a React element, but you passed "+ie+".");var Qe=xt({},ie.props),ht=ie.key;if(Ae!=null)for(ft in Ae.key!==void 0&&(ht=""+Ae.key),Ae)!li.call(Ae,ft)||ft==="key"||ft==="__self"||ft==="__source"||ft==="ref"&&Ae.ref===void 0||(Qe[ft]=Ae[ft]);var ft=arguments.length-2;if(ft===1)Qe.children=it;else if(1<ft){for(var Et=Array(ft),ii=0;ii<ft;ii++)Et[ii]=arguments[ii+2];Qe.children=Et}return Vi(ie.type,ht,Qe)},ti.createContext=function(ie){return ie={$$typeof:k,_currentValue:ie,_currentValue2:ie,_threadCount:0,Provider:null,Consumer:null},ie.Provider=ie,ie.Consumer={$$typeof:yt,_context:ie},ie},ti.createElement=function(ie,Ae,it){var Qe,ht={},ft=null;if(Ae!=null)for(Qe in Ae.key!==void 0&&(ft=""+Ae.key),Ae)li.call(Ae,Qe)&&Qe!=="key"&&Qe!=="__self"&&Qe!=="__source"&&(ht[Qe]=Ae[Qe]);var Et=arguments.length-2;if(Et===1)ht.children=it;else if(1<Et){for(var ii=Array(Et),wi=0;wi<Et;wi++)ii[wi]=arguments[wi+2];ht.children=ii}if(ie&&ie.defaultProps)for(Qe in Et=ie.defaultProps,Et)ht[Qe]===void 0&&(ht[Qe]=Et[Qe]);return Vi(ie,ft,ht)},ti.createRef=function(){return{current:null}},ti.forwardRef=function(ie){return{$$typeof:d,render:ie}},ti.isValidElement=hn,ti.lazy=function(ie){return{$$typeof:ut,_payload:{_status:-1,_result:ie},_init:Lt}},ti.memo=function(ie,Ae){return{$$typeof:Be,type:ie,compare:Ae===void 0?null:Ae}},ti.startTransition=function(ie){var Ae=bt.T,it={};bt.T=it;try{var Qe=ie(),ht=bt.S;ht!==null&&ht(it,Qe),typeof Qe=="object"&&Qe!==null&&typeof Qe.then=="function"&&Qe.then(It,Re)}catch(ft){Re(ft)}finally{Ae!==null&&it.types!==null&&(Ae.types=it.types),bt.T=Ae}},ti.unstable_useCacheRefresh=function(){return bt.H.useCacheRefresh()},ti.use=function(ie){return bt.H.use(ie)},ti.useActionState=function(ie,Ae,it){return bt.H.useActionState(ie,Ae,it)},ti.useCallback=function(ie,Ae){return bt.H.useCallback(ie,Ae)},ti.useContext=function(ie){return bt.H.useContext(ie)},ti.useDebugValue=function(){},ti.useDeferredValue=function(ie,Ae){return bt.H.useDeferredValue(ie,Ae)},ti.useEffect=function(ie,Ae){return bt.H.useEffect(ie,Ae)},ti.useEffectEvent=function(ie){return bt.H.useEffectEvent(ie)},ti.useId=function(){return bt.H.useId()},ti.useImperativeHandle=function(ie,Ae,it){return bt.H.useImperativeHandle(ie,Ae,it)},ti.useInsertionEffect=function(ie,Ae){return bt.H.useInsertionEffect(ie,Ae)},ti.useLayoutEffect=function(ie,Ae){return bt.H.useLayoutEffect(ie,Ae)},ti.useMemo=function(ie,Ae){return bt.H.useMemo(ie,Ae)},ti.useOptimistic=function(ie,Ae){return bt.H.useOptimistic(ie,Ae)},ti.useReducer=function(ie,Ae,it){return bt.H.useReducer(ie,Ae,it)},ti.useRef=function(ie){return bt.H.useRef(ie)},ti.useState=function(ie){return bt.H.useState(ie)},ti.useSyncExternalStore=function(ie,Ae,it){return bt.H.useSyncExternalStore(ie,Ae,it)},ti.useTransition=function(){return bt.H.useTransition()},ti.version="19.2.1",ti}var Lg;function xg(){return Lg||(Lg=1,hg.exports=p_()),hg.exports}var Ot=xg(),dg={exports:{}},kp={},fg={exports:{}},pg={};var Bg;function m_(){return Bg||(Bg=1,(function(fe){function ot(Ve,st){var Lt=Ve.length;Ve.push(st);e:for(;0<Lt;){var Re=Lt-1>>>1,tt=Ve[Re];if(0<rt(tt,st))Ve[Re]=st,Ve[Lt]=tt,Lt=Re;else break e}}function Xe(Ve){return Ve.length===0?null:Ve[0]}function oe(Ve){if(Ve.length===0)return null;var st=Ve[0],Lt=Ve.pop();if(Lt!==st){Ve[0]=Lt;e:for(var Re=0,tt=Ve.length,ie=tt>>>1;Re<ie;){var Ae=2*(Re+1)-1,it=Ve[Ae],Qe=Ae+1,ht=Ve[Qe];if(0>rt(it,Lt))Qe<tt&&0>rt(ht,it)?(Ve[Re]=ht,Ve[Qe]=Lt,Re=Qe):(Ve[Re]=it,Ve[Ae]=Lt,Re=Ae);else if(Qe<tt&&0>rt(ht,Lt))Ve[Re]=ht,Ve[Qe]=Lt,Re=Qe;else break e}}return st}function rt(Ve,st){var Lt=Ve.sortIndex-st.sortIndex;return Lt!==0?Lt:Ve.id-st.id}if(fe.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var yt=performance;fe.unstable_now=function(){return yt.now()}}else{var k=Date,d=k.now();fe.unstable_now=function(){return k.now()-d}}var ge=[],Be=[],ut=1,mt=null,Ke=3,kt=!1,Ht=!1,xt=!1,me=!1,$t=typeof setTimeout=="function"?setTimeout:null,jt=typeof clearTimeout=="function"?clearTimeout:null,dt=typeof setImmediate<"u"?setImmediate:null;function Dt(Ve){for(var st=Xe(Be);st!==null;){if(st.callback===null)oe(Be);else if(st.startTime<=Ve)oe(Be),st.sortIndex=st.expirationTime,ot(ge,st);else break;st=Xe(Be)}}function Yt(Ve){if(xt=!1,Dt(Ve),!Ht)if(Xe(ge)!==null)Ht=!0,It||(It=!0,Mi());else{var st=Xe(Be);st!==null&&Hi(Yt,st.startTime-Ve)}}var It=!1,bt=-1,li=5,Vi=-1;function cn(){return me?!0:!(fe.unstable_now()-Vi<li)}function hn(){if(me=!1,It){var Ve=fe.unstable_now();Vi=Ve;var st=!0;try{e:{Ht=!1,xt&&(xt=!1,jt(bt),bt=-1),kt=!0;var Lt=Ke;try{t:{for(Dt(Ve),mt=Xe(ge);mt!==null&&!(mt.expirationTime>Ve&&cn());){var Re=mt.callback;if(typeof Re=="function"){mt.callback=null,Ke=mt.priorityLevel;var tt=Re(mt.expirationTime<=Ve);if(Ve=fe.unstable_now(),typeof tt=="function"){mt.callback=tt,Dt(Ve),st=!0;break t}mt===Xe(ge)&&oe(ge),Dt(Ve)}else oe(ge);mt=Xe(ge)}if(mt!==null)st=!0;else{var ie=Xe(Be);ie!==null&&Hi(Yt,ie.startTime-Ve),st=!1}}break e}finally{mt=null,Ke=Lt,kt=!1}st=void 0}}finally{st?Mi():It=!1}}}var Mi;if(typeof dt=="function")Mi=function(){dt(hn)};else if(typeof MessageChannel<"u"){var dn=new MessageChannel,Kn=dn.port2;dn.port1.onmessage=hn,Mi=function(){Kn.postMessage(null)}}else Mi=function(){$t(hn,0)};function Hi(Ve,st){bt=$t(function(){Ve(fe.unstable_now())},st)}fe.unstable_IdlePriority=5,fe.unstable_ImmediatePriority=1,fe.unstable_LowPriority=4,fe.unstable_NormalPriority=3,fe.unstable_Profiling=null,fe.unstable_UserBlockingPriority=2,fe.unstable_cancelCallback=function(Ve){Ve.callback=null},fe.unstable_forceFrameRate=function(Ve){0>Ve||125<Ve?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):li=0<Ve?Math.floor(1e3/Ve):5},fe.unstable_getCurrentPriorityLevel=function(){return Ke},fe.unstable_next=function(Ve){switch(Ke){case 1:case 2:case 3:var st=3;break;default:st=Ke}var Lt=Ke;Ke=st;try{return Ve()}finally{Ke=Lt}},fe.unstable_requestPaint=function(){me=!0},fe.unstable_runWithPriority=function(Ve,st){switch(Ve){case 1:case 2:case 3:case 4:case 5:break;default:Ve=3}var Lt=Ke;Ke=Ve;try{return st()}finally{Ke=Lt}},fe.unstable_scheduleCallback=function(Ve,st,Lt){var Re=fe.unstable_now();switch(typeof Lt=="object"&&Lt!==null?(Lt=Lt.delay,Lt=typeof Lt=="number"&&0<Lt?Re+Lt:Re):Lt=Re,Ve){case 1:var tt=-1;break;case 2:tt=250;break;case 5:tt=1073741823;break;case 4:tt=1e4;break;default:tt=5e3}return tt=Lt+tt,Ve={id:ut++,callback:st,priorityLevel:Ve,startTime:Lt,expirationTime:tt,sortIndex:-1},Lt>Re?(Ve.sortIndex=Lt,ot(Be,Ve),Xe(ge)===null&&Ve===Xe(Be)&&(xt?(jt(bt),bt=-1):xt=!0,Hi(Yt,Lt-Re))):(Ve.sortIndex=tt,ot(ge,Ve),Ht||kt||(Ht=!0,It||(It=!0,Mi()))),Ve},fe.unstable_shouldYield=cn,fe.unstable_wrapCallback=function(Ve){var st=Ke;return function(){var Lt=Ke;Ke=st;try{return Ve.apply(this,arguments)}finally{Ke=Lt}}}})(pg)),pg}var kg;function g_(){return kg||(kg=1,fg.exports=m_()),fg.exports}var mg={exports:{}},Ca={};var Og;function __(){if(Og)return Ca;Og=1;var fe=xg();function ot(ge){var Be="https://react.dev/errors/"+ge;if(1<arguments.length){Be+="?args[]="+encodeURIComponent(arguments[1]);for(var ut=2;ut<arguments.length;ut++)Be+="&args[]="+encodeURIComponent(arguments[ut])}return"Minified React error #"+ge+"; visit "+Be+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Xe(){}var oe={d:{f:Xe,r:function(){throw Error(ot(522))},D:Xe,C:Xe,L:Xe,m:Xe,X:Xe,S:Xe,M:Xe},p:0,findDOMNode:null},rt=Symbol.for("react.portal");function yt(ge,Be,ut){var mt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:rt,key:mt==null?null:""+mt,children:ge,containerInfo:Be,implementation:ut}}var k=fe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function d(ge,Be){if(ge==="font")return"";if(typeof Be=="string")return Be==="use-credentials"?Be:""}return Ca.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=oe,Ca.createPortal=function(ge,Be){var ut=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Be||Be.nodeType!==1&&Be.nodeType!==9&&Be.nodeType!==11)throw Error(ot(299));return yt(ge,Be,null,ut)},Ca.flushSync=function(ge){var Be=k.T,ut=oe.p;try{if(k.T=null,oe.p=2,ge)return ge()}finally{k.T=Be,oe.p=ut,oe.d.f()}},Ca.preconnect=function(ge,Be){typeof ge=="string"&&(Be?(Be=Be.crossOrigin,Be=typeof Be=="string"?Be==="use-credentials"?Be:"":void 0):Be=null,oe.d.C(ge,Be))},Ca.prefetchDNS=function(ge){typeof ge=="string"&&oe.d.D(ge)},Ca.preinit=function(ge,Be){if(typeof ge=="string"&&Be&&typeof Be.as=="string"){var ut=Be.as,mt=d(ut,Be.crossOrigin),Ke=typeof Be.integrity=="string"?Be.integrity:void 0,kt=typeof Be.fetchPriority=="string"?Be.fetchPriority:void 0;ut==="style"?oe.d.S(ge,typeof Be.precedence=="string"?Be.precedence:void 0,{crossOrigin:mt,integrity:Ke,fetchPriority:kt}):ut==="script"&&oe.d.X(ge,{crossOrigin:mt,integrity:Ke,fetchPriority:kt,nonce:typeof Be.nonce=="string"?Be.nonce:void 0})}},Ca.preinitModule=function(ge,Be){if(typeof ge=="string")if(typeof Be=="object"&&Be!==null){if(Be.as==null||Be.as==="script"){var ut=d(Be.as,Be.crossOrigin);oe.d.M(ge,{crossOrigin:ut,integrity:typeof Be.integrity=="string"?Be.integrity:void 0,nonce:typeof Be.nonce=="string"?Be.nonce:void 0})}}else Be==null&&oe.d.M(ge)},Ca.preload=function(ge,Be){if(typeof ge=="string"&&typeof Be=="object"&&Be!==null&&typeof Be.as=="string"){var ut=Be.as,mt=d(ut,Be.crossOrigin);oe.d.L(ge,ut,{crossOrigin:mt,integrity:typeof Be.integrity=="string"?Be.integrity:void 0,nonce:typeof Be.nonce=="string"?Be.nonce:void 0,type:typeof Be.type=="string"?Be.type:void 0,fetchPriority:typeof Be.fetchPriority=="string"?Be.fetchPriority:void 0,referrerPolicy:typeof Be.referrerPolicy=="string"?Be.referrerPolicy:void 0,imageSrcSet:typeof Be.imageSrcSet=="string"?Be.imageSrcSet:void 0,imageSizes:typeof Be.imageSizes=="string"?Be.imageSizes:void 0,media:typeof Be.media=="string"?Be.media:void 0})}},Ca.preloadModule=function(ge,Be){if(typeof ge=="string")if(Be){var ut=d(Be.as,Be.crossOrigin);oe.d.m(ge,{as:typeof Be.as=="string"&&Be.as!=="script"?Be.as:void 0,crossOrigin:ut,integrity:typeof Be.integrity=="string"?Be.integrity:void 0})}else oe.d.m(ge)},Ca.requestFormReset=function(ge){oe.d.r(ge)},Ca.unstable_batchedUpdates=function(ge,Be){return ge(Be)},Ca.useFormState=function(ge,Be,ut){return k.H.useFormState(ge,Be,ut)},Ca.useFormStatus=function(){return k.H.useHostTransitionStatus()},Ca.version="19.2.1",Ca}var Fg;function y_(){if(Fg)return mg.exports;Fg=1;function fe(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(fe)}catch(ot){console.error(ot)}}return fe(),mg.exports=__(),mg.exports}var Ng;function v_(){if(Ng)return kp;Ng=1;var fe=g_(),ot=xg(),Xe=y_();function oe(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function rt(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function yt(r){var s=r,c=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(c=s.return),r=s.return;while(r)}return s.tag===3?c:null}function k(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function d(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function ge(r){if(yt(r)!==r)throw Error(oe(188))}function Be(r){var s=r.alternate;if(!s){if(s=yt(r),s===null)throw Error(oe(188));return s!==r?null:r}for(var c=r,g=s;;){var b=c.return;if(b===null)break;var M=b.alternate;if(M===null){if(g=b.return,g!==null){c=g;continue}break}if(b.child===M.child){for(M=b.child;M;){if(M===c)return ge(b),r;if(M===g)return ge(b),s;M=M.sibling}throw Error(oe(188))}if(c.return!==g.return)c=b,g=M;else{for(var B=!1,Z=b.child;Z;){if(Z===c){B=!0,c=b,g=M;break}if(Z===g){B=!0,g=b,c=M;break}Z=Z.sibling}if(!B){for(Z=M.child;Z;){if(Z===c){B=!0,c=M,g=b;break}if(Z===g){B=!0,g=M,c=b;break}Z=Z.sibling}if(!B)throw Error(oe(189))}}if(c.alternate!==g)throw Error(oe(190))}if(c.tag!==3)throw Error(oe(188));return c.stateNode.current===c?r:s}function ut(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=ut(r),s!==null)return s;r=r.sibling}return null}var mt=Object.assign,Ke=Symbol.for("react.element"),kt=Symbol.for("react.transitional.element"),Ht=Symbol.for("react.portal"),xt=Symbol.for("react.fragment"),me=Symbol.for("react.strict_mode"),$t=Symbol.for("react.profiler"),jt=Symbol.for("react.consumer"),dt=Symbol.for("react.context"),Dt=Symbol.for("react.forward_ref"),Yt=Symbol.for("react.suspense"),It=Symbol.for("react.suspense_list"),bt=Symbol.for("react.memo"),li=Symbol.for("react.lazy"),Vi=Symbol.for("react.activity"),cn=Symbol.for("react.memo_cache_sentinel"),hn=Symbol.iterator;function Mi(r){return r===null||typeof r!="object"?null:(r=hn&&r[hn]||r["@@iterator"],typeof r=="function"?r:null)}var dn=Symbol.for("react.client.reference");function Kn(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===dn?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case xt:return"Fragment";case $t:return"Profiler";case me:return"StrictMode";case Yt:return"Suspense";case It:return"SuspenseList";case Vi:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case Ht:return"Portal";case dt:return r.displayName||"Context";case jt:return(r._context.displayName||"Context")+".Consumer";case Dt:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case bt:return s=r.displayName||null,s!==null?s:Kn(r.type)||"Memo";case li:s=r._payload,r=r._init;try{return Kn(r(s))}catch{}}return null}var Hi=Array.isArray,Ve=ot.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,st=Xe.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Lt={pending:!1,data:null,method:null,action:null},Re=[],tt=-1;function ie(r){return{current:r}}function Ae(r){0>tt||(r.current=Re[tt],Re[tt]=null,tt--)}function it(r,s){tt++,Re[tt]=r.current,r.current=s}var Qe=ie(null),ht=ie(null),ft=ie(null),Et=ie(null);function ii(r,s){switch(it(ft,s),it(ht,r),it(Qe,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?ad(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=ad(s),r=lf(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}Ae(Qe),it(Qe,r)}function wi(){Ae(Qe),Ae(ht),Ae(ft)}function Jn(r){r.memoizedState!==null&&it(Et,r);var s=Qe.current,c=lf(s,r.type);s!==c&&(it(ht,r),it(Qe,c))}function qs(r){ht.current===r&&(Ae(Qe),Ae(ht)),Et.current===r&&(Ae(Et),cd._currentValue=Lt)}var Qr,fl;function tn(r){if(Qr===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);Qr=s&&s[1]||"",fl=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Qr+r+fl}var Or=!1;function ma(r,s){if(!r||Or)return"";Or=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(s){var We=function(){throw Error()};if(Object.defineProperty(We.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(We,[])}catch(Oe){var Pe=Oe}Reflect.construct(r,[],We)}else{try{We.call()}catch(Oe){Pe=Oe}r.call(We.prototype)}}else{try{throw Error()}catch(Oe){Pe=Oe}(We=r())&&typeof We.catch=="function"&&We.catch(function(){})}}catch(Oe){if(Oe&&Pe&&typeof Oe.stack=="string")return[Oe.stack,Pe.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var M=g.DetermineComponentFrameRoot(),B=M[0],Z=M[1];if(B&&Z){var ce=B.split(`
`),Ie=Z.split(`
`);for(b=g=0;g<ce.length&&!ce[g].includes("DetermineComponentFrameRoot");)g++;for(;b<Ie.length&&!Ie[b].includes("DetermineComponentFrameRoot");)b++;if(g===ce.length||b===Ie.length)for(g=ce.length-1,b=Ie.length-1;1<=g&&0<=b&&ce[g]!==Ie[b];)b--;for(;1<=g&&0<=b;g--,b--)if(ce[g]!==Ie[b]){if(g!==1||b!==1)do if(g--,b--,0>b||ce[g]!==Ie[b]){var Ge=`
`+ce[g].replace(" at new "," at ");return r.displayName&&Ge.includes("<anonymous>")&&(Ge=Ge.replace("<anonymous>",r.displayName)),Ge}while(1<=g&&0<=b);break}}}finally{Or=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?tn(c):""}function fn(r,s){switch(r.tag){case 26:case 27:case 5:return tn(r.type);case 16:return tn("Lazy");case 13:return r.child!==s&&s!==null?tn("Suspense Fallback"):tn("Suspense");case 19:return tn("SuspenseList");case 0:case 15:return ma(r.type,!1);case 11:return ma(r.type.render,!1);case 1:return ma(r.type,!0);case 31:return tn("Activity");default:return""}}function gs(r){try{var s="",c=null;do s+=fn(r,c),c=r,r=r.return;while(r);return s}catch(g){return`
Error generating stack: `+g.message+`
`+g.stack}}var _s=Object.prototype.hasOwnProperty,Zs=fe.unstable_scheduleCallback,Ha=fe.unstable_cancelCallback,za=fe.unstable_shouldYield,pl=fe.unstable_requestPaint,er=fe.unstable_now,Fr=fe.unstable_getCurrentPriorityLevel,ve=fe.unstable_ImmediatePriority,V=fe.unstable_UserBlockingPriority,j=fe.unstable_NormalPriority,H=fe.unstable_LowPriority,se=fe.unstable_IdlePriority,ue=fe.log,Te=fe.unstable_setDisableYieldValue,_e=null,he=null;function Se(r){if(typeof ue=="function"&&Te(r),he&&typeof he.setStrictMode=="function")try{he.setStrictMode(_e,r)}catch{}}var je=Math.clz32?Math.clz32:Mt,Ue=Math.log,gt=Math.LN2;function Mt(r){return r>>>=0,r===0?32:31-(Ue(r)/gt|0)|0}var Ft=256,yi=262144,ui=4194304;function xe(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Ti(r,s,c){var g=r.pendingLanes;if(g===0)return 0;var b=0,M=r.suspendedLanes,B=r.pingedLanes;r=r.warmLanes;var Z=g&134217727;return Z!==0?(g=Z&~M,g!==0?b=xe(g):(B&=Z,B!==0?b=xe(B):c||(c=Z&~r,c!==0&&(b=xe(c))))):(Z=g&~M,Z!==0?b=xe(Z):B!==0?b=xe(B):c||(c=g&~r,c!==0&&(b=xe(c)))),b===0?0:s!==0&&s!==b&&(s&M)===0&&(M=b&-b,c=s&-s,M>=c||M===32&&(c&4194048)!==0)?s:b}function Cn(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function Ut(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Si(){var r=ui;return ui<<=1,(ui&62914560)===0&&(ui=4194304),r}function $n(r){for(var s=[],c=0;31>c;c++)s.push(r);return s}function Ei(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function wn(r,s,c,g,b,M){var B=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var Z=r.entanglements,ce=r.expirationTimes,Ie=r.hiddenUpdates;for(c=B&~c;0<c;){var Ge=31-je(c),We=1<<Ge;Z[Ge]=0,ce[Ge]=-1;var Pe=Ie[Ge];if(Pe!==null)for(Ie[Ge]=null,Ge=0;Ge<Pe.length;Ge++){var Oe=Pe[Ge];Oe!==null&&(Oe.lane&=-536870913)}c&=~We}g!==0&&Li(r,g,0),M!==0&&b===0&&r.tag!==0&&(r.suspendedLanes|=M&~(B&~s))}function Li(r,s,c){r.pendingLanes|=s,r.suspendedLanes&=~s;var g=31-je(s);r.entangledLanes|=s,r.entanglements[g]=r.entanglements[g]|1073741824|c&261930}function zn(r,s){var c=r.entangledLanes|=s;for(r=r.entanglements;c;){var g=31-je(c),b=1<<g;b&s|r[g]&s&&(r[g]|=s),c&=~b}}function ml(r,s){var c=s&-s;return c=(c&42)!==0?1:So(c),(c&(r.suspendedLanes|s))!==0?0:c}function So(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Je(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function pr(){var r=st.p;return r!==0?r:(r=window.event,r===void 0?32:Em(r.type))}function mr(r,s){var c=st.p;try{return st.p=r,s()}finally{st.p=c}}var Da=Math.random().toString(36).slice(2),Ui="__reactFiber$"+Da,nt="__reactProps$"+Da,qt="__reactContainer$"+Da,Wt="__reactEvents$"+Da,Kr="__reactListeners$"+Da,rc="__reactHandles$"+Da,$a="__reactResources$"+Da,Gt="__reactMarker$"+Da;function Mo(r){delete r[Ui],delete r[nt],delete r[Wt],delete r[Kr],delete r[rc]}function Xa(r){var s=r[Ui];if(s)return s;for(var c=r.parentNode;c;){if(s=c[qt]||c[Ui]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(r=Ku(r);r!==null;){if(c=r[Ui])return c;r=Ku(r)}return s}r=c,c=r.parentNode}return null}function ys(r){if(r=r[Ui]||r[qt]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function Ya(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(oe(33))}function Wa(r){var s=r[$a];return s||(s=r[$a]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function pn(r){r[Gt]=!0}var gl=new Set,gr={};function ci(r,s){vs(r,s),vs(r+"Capture",s)}function vs(r,s){for(gr[r]=s,r=0;r<s.length;r++)gl.add(s[r])}var _l=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),yl={},Hs={};function Ia(r){return _s.call(Hs,r)?!0:_s.call(yl,r)?!1:_l.test(r)?Hs[r]=!0:(yl[r]=!0,!1)}function au(r,s,c){if(Ia(s))if(c===null)r.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var g=s.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+c)}}function Qa(r,s,c){if(c===null)r.removeAttribute(s);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+c)}}function ga(r,s,c,g){if(g===null)r.removeAttribute(c);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(s,c,""+g)}}function pi(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function uh(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function _d(r,s,c){var g=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var b=g.get,M=g.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return b.call(this)},set:function(B){c=""+B,M.call(this,B)}}),Object.defineProperty(r,s,{enumerable:g.enumerable}),{getValue:function(){return c},setValue:function(B){c=""+B},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function Eo(r){if(!r._valueTracker){var s=uh(r)?"checked":"value";r._valueTracker=_d(r,s,""+r[s])}}function ch(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var c=s.getValue(),g="";return r&&(g=uh(r)?r.checked?"true":"false":r.value),r=g,r!==c?(s.setValue(r),!0):!1}function su(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var yd=/[\n"\\]/g;function Tr(r){return r.replace(yd,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function ou(r,s,c,g,b,M,B,Z){r.name="",B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"?r.type=B:r.removeAttribute("type"),s!=null?B==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+pi(s)):r.value!==""+pi(s)&&(r.value=""+pi(s)):B!=="submit"&&B!=="reset"||r.removeAttribute("value"),s!=null?lu(r,B,pi(s)):c!=null?lu(r,B,pi(c)):g!=null&&r.removeAttribute("value"),b==null&&M!=null&&(r.defaultChecked=!!M),b!=null&&(r.checked=b&&typeof b!="function"&&typeof b!="symbol"),Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?r.name=""+pi(Z):r.removeAttribute("name")}function ac(r,s,c,g,b,M,B,Z){if(M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"&&(r.type=M),s!=null||c!=null){if(!(M!=="submit"&&M!=="reset"||s!=null)){Eo(r);return}c=c!=null?""+pi(c):"",s=s!=null?""+pi(s):c,Z||s===r.value||(r.value=s),r.defaultValue=s}g=g??b,g=typeof g!="function"&&typeof g!="symbol"&&!!g,r.checked=Z?r.checked:!!g,r.defaultChecked=!!g,B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(r.name=B),Eo(r)}function lu(r,s,c){s==="number"&&su(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function $s(r,s,c,g){if(r=r.options,s){s={};for(var b=0;b<c.length;b++)s["$"+c[b]]=!0;for(c=0;c<r.length;c++)b=s.hasOwnProperty("$"+r[c].value),r[c].selected!==b&&(r[c].selected=b),b&&g&&(r[c].defaultSelected=!0)}else{for(c=""+pi(c),s=null,b=0;b<r.length;b++){if(r[b].value===c){r[b].selected=!0,g&&(r[b].defaultSelected=!0);return}s!==null||r[b].disabled||(s=r[b])}s!==null&&(s.selected=!0)}}function vd(r,s,c){if(s!=null&&(s=""+pi(s),s!==r.value&&(r.value=s),c==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=c!=null?""+pi(c):""}function vl(r,s,c,g){if(s==null){if(g!=null){if(c!=null)throw Error(oe(92));if(Hi(g)){if(1<g.length)throw Error(oe(93));g=g[0]}c=g}c==null&&(c=""),s=c}c=pi(s),r.defaultValue=c,g=r.textContent,g===c&&g!==""&&g!==null&&(r.value=g),Eo(r)}function xs(r,s){if(s){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=s;return}}r.textContent=s}var xd=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ao(r,s,c){var g=s.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?g?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":g?r.setProperty(s,c):typeof c!="number"||c===0||xd.has(s)?s==="float"?r.cssFloat=c:r[s]=(""+c).trim():r[s]=c+"px"}function sc(r,s,c){if(s!=null&&typeof s!="object")throw Error(oe(62));if(r=r.style,c!=null){for(var g in c)!c.hasOwnProperty(g)||s!=null&&s.hasOwnProperty(g)||(g.indexOf("--")===0?r.setProperty(g,""):g==="float"?r.cssFloat="":r[g]="");for(var b in s)g=s[b],s.hasOwnProperty(b)&&c[b]!==g&&Ao(r,b,g)}else for(var M in s)s.hasOwnProperty(M)&&Ao(r,M,s[M])}function Co(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xs=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),xl=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Xt(r){return xl.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Pa(){}var hh=null;function uu(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Xn=null,Dn=null;function $i(r){var s=ys(r);if(s&&(r=s.stateNode)){var c=r[nt]||null;e:switch(r=s.stateNode,s.type){case"input":if(ou(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),s=c.name,c.type==="radio"&&s!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+Tr(""+s)+'"][type="radio"]'),s=0;s<c.length;s++){var g=c[s];if(g!==r&&g.form===r.form){var b=g[nt]||null;if(!b)throw Error(oe(90));ou(g,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<c.length;s++)g=c[s],g.form===r.form&&ch(g)}break e;case"textarea":vd(r,c.value,c.defaultValue);break e;case"select":s=c.value,s!=null&&$s(r,!!c.multiple,s,!1)}}}var Bt=!1;function Bi(r,s,c){if(Bt)return r(s,c);Bt=!0;try{var g=r(s);return g}finally{if(Bt=!1,(Xn!==null||Dn!==null)&&(Xh(),Xn&&(s=Xn,r=Dn,Dn=Xn=null,$i(s),r)))for(s=0;s<r.length;s++)$i(r[s])}}function _a(r,s){var c=r.stateNode;if(c===null)return null;var g=c[nt]||null;if(g===null)return null;c=g[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(r=r.type,g=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!g;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(oe(231,s,typeof c));return c}var mn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Sr=!1;if(mn)try{var Yn={};Object.defineProperty(Yn,"passive",{get:function(){Sr=!0}}),window.addEventListener("test",Yn,Yn),window.removeEventListener("test",Yn,Yn)}catch{Sr=!1}var Jr=null,Ka=null,Xi=null;function Ys(){if(Xi)return Xi;var r,s=Ka,c=s.length,g,b="value"in Jr?Jr.value:Jr.textContent,M=b.length;for(r=0;r<c&&s[r]===b[r];r++);var B=c-r;for(g=1;g<=B&&s[c-g]===b[M-g];g++);return Xi=b.slice(r,1<g?1-g:void 0)}function ea(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function zo(){return!0}function Mr(){return!1}function Bn(r){function s(c,g,b,M,B){this._reactName=c,this._targetInst=b,this.type=g,this.nativeEvent=M,this.target=B,this.currentTarget=null;for(var Z in r)r.hasOwnProperty(Z)&&(c=r[Z],this[Z]=c?c(M):M[Z]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?zo:Mr,this.isPropagationStopped=Mr,this}return mt(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=zo)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=zo)},persist:function(){},isPersistent:zo}),s}var Er={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cu=Bn(Er),Do=mt({},Er,{view:0,detail:0}),Io=Bn(Do),Ai,Ws,Kt,Zt=mt({},Do,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fu,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Kt&&(Kt&&r.type==="mousemove"?(Ai=r.screenX-Kt.screenX,Ws=r.screenY-Kt.screenY):Ws=Ai=0,Kt=r),Ai)},movementY:function(r){return"movementY"in r?r.movementY:Ws}}),Po=Bn(Zt),hi=mt({},Zt,{dataTransfer:0}),hu=Bn(hi),ya=mt({},Do,{relatedTarget:0}),Qs=Bn(ya),Ks=mt({},Er,{animationName:0,elapsedTime:0,pseudoElement:0}),bd=Bn(Ks),du=mt({},Er,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),dh=Bn(du),Cf=mt({},Er,{data:0}),fh=Bn(Cf),Ar={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ja={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ro(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=Yi[r])?!!s[r]:!1}function fu(){return Ro}var pu=mt({},Do,{key:function(r){if(r.key){var s=Ar[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=ea(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Ja[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fu,charCode:function(r){return r.type==="keypress"?ea(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?ea(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),gn=Bn(pu),wd=mt({},Zt,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),oc=Bn(wd),Td=mt({},Do,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fu}),zf=Bn(Td),bl=mt({},Er,{propertyName:0,elapsedTime:0,pseudoElement:0}),lc=Bn(bl),wl=mt({},Zt,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),ph=Bn(wl),mu=mt({},Er,{newState:0,oldState:0}),Tl=Bn(mu),Sl=[9,13,27,32],Tn=mn&&"CompositionEvent"in window,Ml=null;mn&&"documentMode"in document&&(Ml=document.documentMode);var El=mn&&"TextEvent"in window&&!Ml,Al=mn&&(!Tn||Ml&&8<Ml&&11>=Ml),Js=" ",Sd=!1;function gu(r,s){switch(r){case"keyup":return Sl.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Md(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Ra=!1;function uc(r,s){switch(r){case"compositionend":return Md(s);case"keypress":return s.which!==32?null:(Sd=!0,Js);case"textInput":return r=s.data,r===Js&&Sd?null:r;default:return null}}function Ed(r,s){if(Ra)return r==="compositionend"||!Tn&&gu(r,s)?(r=Ys(),Xi=Ka=Jr=null,Ra=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Al&&s.locale!=="ko"?null:s.data;default:return null}}var Ad={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cc(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Ad[r.type]:s==="textarea"}function hc(r,s,c,g){Xn?Dn?Dn.push(g):Dn=[g]:Xn=g,s=td(s,"onChange"),0<s.length&&(c=new cu("onChange","change",null,c,g),r.push({event:c,listeners:s}))}var Lo=null,Cl=null;function Cd(r){lm(r,0)}function _u(r){var s=Ya(r);if(ch(s))return r}function eo(r,s){if(r==="change")return s}var mh=!1;if(mn){var yu;if(mn){var to="oninput"in document;if(!to){var gh=document.createElement("div");gh.setAttribute("oninput","return;"),to=typeof gh.oninput=="function"}yu=to}else yu=!1;mh=yu&&(!document.documentMode||9<document.documentMode)}function vu(){Lo&&(Lo.detachEvent("onpropertychange",zd),Cl=Lo=null)}function zd(r){if(r.propertyName==="value"&&_u(Cl)){var s=[];hc(s,Cl,r,uu(r)),Bi(Cd,s)}}function Df(r,s,c){r==="focusin"?(vu(),Lo=s,Cl=c,Lo.attachEvent("onpropertychange",zd)):r==="focusout"&&vu()}function Dd(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return _u(Cl)}function xu(r,s){if(r==="click")return _u(s)}function Id(r,s){if(r==="input"||r==="change")return _u(s)}function _h(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Nr=typeof Object.is=="function"?Object.is:_h;function io(r,s){if(Nr(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var c=Object.keys(r),g=Object.keys(s);if(c.length!==g.length)return!1;for(g=0;g<c.length;g++){var b=c[g];if(!_s.call(s,b)||!Nr(r[b],s[b]))return!1}return!0}function va(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function bu(r,s){var c=va(r);r=0;for(var g;c;){if(c.nodeType===3){if(g=r+c.textContent.length,r<=s&&g>=s)return{node:c,offset:s-r};r=g}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=va(c)}}function dc(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?dc(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function fc(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=su(r.document);s instanceof r.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)r=s.contentWindow;else break;s=su(r.document)}return s}function wu(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var pc=mn&&"documentMode"in document&&11>=document.documentMode,xa=null,Tu=null,Su=null,mc=!1;function Pd(r,s,c){var g=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;mc||xa==null||xa!==su(g)||(g=xa,"selectionStart"in g&&wu(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Su&&io(Su,g)||(Su=g,g=td(Tu,"onSelect"),0<g.length&&(s=new cu("onSelect","select",null,s,c),r.push({event:s,listeners:g}),s.target=xa)))}function Bo(r,s){var c={};return c[r.toLowerCase()]=s.toLowerCase(),c["Webkit"+r]="webkit"+s,c["Moz"+r]="moz"+s,c}var ko={animationend:Bo("Animation","AnimationEnd"),animationiteration:Bo("Animation","AnimationIteration"),animationstart:Bo("Animation","AnimationStart"),transitionrun:Bo("Transition","TransitionRun"),transitionstart:Bo("Transition","TransitionStart"),transitioncancel:Bo("Transition","TransitionCancel"),transitionend:Bo("Transition","TransitionEnd")},yh={},mi={};mn&&(mi=document.createElement("div").style,"AnimationEvent"in window||(delete ko.animationend.animation,delete ko.animationiteration.animation,delete ko.animationstart.animation),"TransitionEvent"in window||delete ko.transitionend.transition);function es(r){if(yh[r])return yh[r];if(!ko[r])return r;var s=ko[r],c;for(c in s)if(s.hasOwnProperty(c)&&c in mi)return yh[r]=s[c];return r}var Mu=es("animationend"),Eu=es("animationiteration"),gc=es("animationstart"),Oo=es("transitionrun"),Au=es("transitionstart"),zl=es("transitioncancel"),ta=es("transitionend"),vh=new Map,_c="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");_c.push("scrollEnd");function ia(r,s){vh.set(r,s),ci(s,[r])}var ts=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Cr=[],bs=0,Fo=0;function No(){for(var r=bs,s=Fo=bs=0;s<r;){var c=Cr[s];Cr[s++]=null;var g=Cr[s];Cr[s++]=null;var b=Cr[s];Cr[s++]=null;var M=Cr[s];if(Cr[s++]=null,g!==null&&b!==null){var B=g.pending;B===null?b.next=b:(b.next=B.next,B.next=b),g.pending=b}M!==0&&xh(c,b,M)}}function Cu(r,s,c,g){Cr[bs++]=r,Cr[bs++]=s,Cr[bs++]=c,Cr[bs++]=g,Fo|=g,r.lanes|=g,r=r.alternate,r!==null&&(r.lanes|=g)}function no(r,s,c,g){return Cu(r,s,c,g),Dl(r)}function ba(r,s){return Cu(r,null,null,s),Dl(r)}function xh(r,s,c){r.lanes|=c;var g=r.alternate;g!==null&&(g.lanes|=c);for(var b=!1,M=r.return;M!==null;)M.childLanes|=c,g=M.alternate,g!==null&&(g.childLanes|=c),M.tag===22&&(r=M.stateNode,r===null||r._visibility&1||(b=!0)),r=M,M=M.return;return r.tag===3?(M=r.stateNode,b&&s!==null&&(b=31-je(c),r=M.hiddenUpdates,g=r[b],g===null?r[b]=[s]:g.push(s),s.lane=c|536870912),M):null}function Dl(r){if(50<$h)throw $h=0,ip=null,Error(oe(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var Qt={};function yc(r,s,c,g){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function na(r,s,c,g){return new yc(r,s,c,g)}function vc(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ra(r,s){var c=r.alternate;return c===null?(c=na(r.tag,s,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=s,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,s=r.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function Rd(r,s){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,s=c.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function xc(r,s,c,g,b,M){var B=0;if(g=r,typeof r=="function")vc(r)&&(B=1);else if(typeof r=="string")B=bp(r,c,Qe.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case Vi:return r=na(31,c,s,b),r.elementType=Vi,r.lanes=M,r;case xt:return ro(c.children,b,M,s);case me:B=8,b|=24;break;case $t:return r=na(12,c,s,b|2),r.elementType=$t,r.lanes=M,r;case Yt:return r=na(13,c,s,b),r.elementType=Yt,r.lanes=M,r;case It:return r=na(19,c,s,b),r.elementType=It,r.lanes=M,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case dt:B=10;break e;case jt:B=9;break e;case Dt:B=11;break e;case bt:B=14;break e;case li:B=16,g=null;break e}B=29,c=Error(oe(130,r===null?"null":typeof r,"")),g=null}return s=na(B,c,s,b),s.elementType=r,s.type=g,s.lanes=M,s}function ro(r,s,c,g){return r=na(7,r,g,s),r.lanes=c,r}function bh(r,s,c){return r=na(6,r,null,s),r.lanes=c,r}function bc(r){var s=na(18,null,null,0);return s.stateNode=r,s}function ao(r,s,c){return s=na(4,r.children!==null?r.children:[],r.key,s),s.lanes=c,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var zu=new WeakMap;function zr(r,s){if(typeof r=="object"&&r!==null){var c=zu.get(r);return c!==void 0?c:(s={value:r,source:s,stack:gs(s)},zu.set(r,s),s)}return{value:r,source:s,stack:gs(s)}}var so=[],oo=0,jo=null,lo=0,tr=[],ir=0,is=null,ns=1,jr="";function ws(r,s){so[oo++]=lo,so[oo++]=jo,jo=r,lo=s}function wh(r,s,c){tr[ir++]=ns,tr[ir++]=jr,tr[ir++]=is,is=r;var g=ns;r=jr;var b=32-je(g)-1;g&=~(1<<b),c+=1;var M=32-je(s)+b;if(30<M){var B=b-b%5;M=(g&(1<<B)-1).toString(32),g>>=B,b-=B,ns=1<<32-je(s)+b|c<<b|g,jr=M+r}else ns=1<<M|c<<b|g,jr=r}function Vo(r){r.return!==null&&(ws(r,1),wh(r,1,0))}function Il(r){for(;r===jo;)jo=so[--oo],so[oo]=null,lo=so[--oo],so[oo]=null;for(;r===is;)is=tr[--ir],tr[ir]=null,jr=tr[--ir],tr[ir]=null,ns=tr[--ir],tr[ir]=null}function Th(r,s){tr[ir++]=ns,tr[ir++]=jr,tr[ir++]=is,ns=s.id,jr=s.overflow,is=r}var nr=null,ki=null,ri=!1,Ts=null,aa=!1,nn=Error(oe(519));function Vr(r){var s=Error(oe(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ss(zr(s,r)),nn}function sa(r){var s=r.stateNode,c=r.type,g=r.memoizedProps;switch(s[Ui]=r,s[nt]=g,c){case"dialog":fi("cancel",s),fi("close",s);break;case"iframe":case"object":case"embed":fi("load",s);break;case"video":case"audio":for(c=0;c<Jh.length;c++)fi(Jh[c],s);break;case"source":fi("error",s);break;case"img":case"image":case"link":fi("error",s),fi("load",s);break;case"details":fi("toggle",s);break;case"input":fi("invalid",s),ac(s,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0);break;case"select":fi("invalid",s);break;case"textarea":fi("invalid",s),vl(s,g.value,g.defaultValue,g.children)}c=g.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||s.textContent===""+c||g.suppressHydrationWarning===!0||af(s.textContent,c)?(g.popover!=null&&(fi("beforetoggle",s),fi("toggle",s)),g.onScroll!=null&&fi("scroll",s),g.onScrollEnd!=null&&fi("scrollend",s),g.onClick!=null&&(s.onclick=Pa),s=!0):s=!1,s||Vr(r,!0)}function Du(r){for(nr=r.return;nr;)switch(nr.tag){case 5:case 31:case 13:aa=!1;return;case 27:case 3:aa=!0;return;default:nr=nr.return}}function rs(r){if(r!==nr)return!1;if(!ri)return Du(r),ri=!0,!1;var s=r.tag,c;if((c=s!==3&&s!==27)&&((c=s===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||sd(r.type,r.memoizedProps)),c=!c),c&&ki&&Vr(r),Du(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(oe(317));ki=Kl(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(oe(317));ki=Kl(r)}else s===27?(s=ki,vn(r.type)?(r=df,df=null,ki=r):ki=s):ki=nr?ms(r.stateNode.nextSibling):null;return!0}function as(){ki=nr=null,ri=!1}function ss(){var r=Ts;return r!==null&&(Ea===null?Ea=r:Ea.push.apply(Ea,r),Ts=null),r}function Ss(r){Ts===null?Ts=[r]:Ts.push(r)}var Ms=ie(null),wa=null,os=null;function Es(r,s,c){it(Ms,s._currentValue),s._currentValue=c}function ls(r){r._currentValue=Ms.current,Ae(Ms)}function wc(r,s,c){for(;r!==null;){var g=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,g!==null&&(g.childLanes|=s)):g!==null&&(g.childLanes&s)!==s&&(g.childLanes|=s),r===c)break;r=r.return}}function Tc(r,s,c,g){var b=r.child;for(b!==null&&(b.return=r);b!==null;){var M=b.dependencies;if(M!==null){var B=b.child;M=M.firstContext;e:for(;M!==null;){var Z=M;M=b;for(var ce=0;ce<s.length;ce++)if(Z.context===s[ce]){M.lanes|=c,Z=M.alternate,Z!==null&&(Z.lanes|=c),wc(M.return,c,r),g||(B=null);break e}M=Z.next}}else if(b.tag===18){if(B=b.return,B===null)throw Error(oe(341));B.lanes|=c,M=B.alternate,M!==null&&(M.lanes|=c),wc(B,c,r),B=null}else B=b.child;if(B!==null)B.return=b;else for(B=b;B!==null;){if(B===r){B=null;break}if(b=B.sibling,b!==null){b.return=B.return,B=b;break}B=B.return}b=B}}function Ta(r,s,c,g){r=null;for(var b=s,M=!1;b!==null;){if(!M){if((b.flags&524288)!==0)M=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var B=b.alternate;if(B===null)throw Error(oe(387));if(B=B.memoizedProps,B!==null){var Z=b.type;Nr(b.pendingProps.value,B.value)||(r!==null?r.push(Z):r=[Z])}}else if(b===Et.current){if(B=b.alternate,B===null)throw Error(oe(387));B.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(r!==null?r.push(cd):r=[cd])}b=b.return}r!==null&&Tc(s,r,c,g),s.flags|=262144}function Pl(r){for(r=r.firstContext;r!==null;){if(!Nr(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function As(r){wa=r,os=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function In(r){return Sc(wa,r)}function Iu(r,s){return wa===null&&As(r),Sc(r,s)}function Sc(r,s){var c=s._currentValue;if(s={context:s,memoizedValue:c,next:null},os===null){if(r===null)throw Error(oe(308));os=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else os=os.next=s;return c}var Sh=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(c,g){r.push(g)}};this.abort=function(){s.aborted=!0,r.forEach(function(c){return c()})}},Ld=fe.unstable_scheduleCallback,Mh=fe.unstable_NormalPriority,rn={$$typeof:dt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function uo(){return{controller:new Sh,data:new Map,refCount:0}}function _r(r){r.refCount--,r.refCount===0&&Ld(Mh,function(){r.controller.abort()})}var Dr=null,Mc=0,yr=0,Rl=null;function Ll(r,s){if(Dr===null){var c=Dr=[];Mc=0,yr=Wl(),Rl={status:"pending",value:void 0,then:function(g){c.push(g)}}}return Mc++,s.then(Bl,Bl),s}function Bl(){if(--Mc===0&&Dr!==null){Rl!==null&&(Rl.status="fulfilled");var r=Dr;Dr=null,yr=0,Rl=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function Pu(r,s){var c=[],g={status:"pending",value:null,reason:null,then:function(b){c.push(b)}};return r.then(function(){g.status="fulfilled",g.value=s;for(var b=0;b<c.length;b++)(0,c[b])(s)},function(b){for(g.status="rejected",g.reason=b,b=0;b<c.length;b++)(0,c[b])(void 0)}),g}var Ur=Ve.S;Ve.S=function(r,s){Kf=er(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&Ll(r,s),Ur!==null&&Ur(r,s)};var La=ie(null);function Ru(){var r=La.current;return r!==null?r:Ji.pooledCache}function co(r,s){s===null?it(La,La.current):it(La,s.pool)}function us(){var r=Ru();return r===null?null:{parent:rn._currentValue,pool:r}}var lt=Error(oe(460)),Lu=Error(oe(474)),ho=Error(oe(542)),Bu={then:function(){}};function fo(r){return r=r.status,r==="fulfilled"||r==="rejected"}function kl(r,s,c){switch(c=r[c],c===void 0?r.push(s):c!==s&&(s.then(Pa,Pa),s=c),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,Eh(r),r;default:if(typeof s.status=="string")s.then(Pa,Pa);else{if(r=Ji,r!==null&&100<r.shellSuspendCounter)throw Error(oe(482));r=s,r.status="pending",r.then(function(g){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=g}},function(g){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=g}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,Eh(r),r}throw Uo=s,lt}}function oa(r){try{var s=r._init;return s(r._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(Uo=c,lt):c}}var Uo=null;function Ec(){if(Uo===null)throw Error(oe(459));var r=Uo;return Uo=null,r}function Eh(r){if(r===lt||r===ho)throw Error(oe(483))}var Sa=null,ku=0;function Ou(r){var s=ku;return ku+=1,Sa===null&&(Sa=[]),kl(Sa,r,s)}function po(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function Ac(r,s){throw s.$$typeof===Ke?Error(oe(525)):(r=Object.prototype.toString.call(s),Error(oe(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function Fu(r){function s(ye,pe){if(r){var De=ye.deletions;De===null?(ye.deletions=[pe],ye.flags|=16):De.push(pe)}}function c(ye,pe){if(!r)return null;for(;pe!==null;)s(ye,pe),pe=pe.sibling;return null}function g(ye){for(var pe=new Map;ye!==null;)ye.key!==null?pe.set(ye.key,ye):pe.set(ye.index,ye),ye=ye.sibling;return pe}function b(ye,pe){return ye=ra(ye,pe),ye.index=0,ye.sibling=null,ye}function M(ye,pe,De){return ye.index=De,r?(De=ye.alternate,De!==null?(De=De.index,De<pe?(ye.flags|=67108866,pe):De):(ye.flags|=67108866,pe)):(ye.flags|=1048576,pe)}function B(ye){return r&&ye.alternate===null&&(ye.flags|=67108866),ye}function Z(ye,pe,De,Ze){return pe===null||pe.tag!==6?(pe=bh(De,ye.mode,Ze),pe.return=ye,pe):(pe=b(pe,De),pe.return=ye,pe)}function ce(ye,pe,De,Ze){var St=De.type;return St===xt?Ge(ye,pe,De.props.children,Ze,De.key):pe!==null&&(pe.elementType===St||typeof St=="object"&&St!==null&&St.$$typeof===li&&oa(St)===pe.type)?(pe=b(pe,De.props),po(pe,De),pe.return=ye,pe):(pe=xc(De.type,De.key,De.props,null,ye.mode,Ze),po(pe,De),pe.return=ye,pe)}function Ie(ye,pe,De,Ze){return pe===null||pe.tag!==4||pe.stateNode.containerInfo!==De.containerInfo||pe.stateNode.implementation!==De.implementation?(pe=ao(De,ye.mode,Ze),pe.return=ye,pe):(pe=b(pe,De.children||[]),pe.return=ye,pe)}function Ge(ye,pe,De,Ze,St){return pe===null||pe.tag!==7?(pe=ro(De,ye.mode,Ze,St),pe.return=ye,pe):(pe=b(pe,De),pe.return=ye,pe)}function We(ye,pe,De){if(typeof pe=="string"&&pe!==""||typeof pe=="number"||typeof pe=="bigint")return pe=bh(""+pe,ye.mode,De),pe.return=ye,pe;if(typeof pe=="object"&&pe!==null){switch(pe.$$typeof){case kt:return De=xc(pe.type,pe.key,pe.props,null,ye.mode,De),po(De,pe),De.return=ye,De;case Ht:return pe=ao(pe,ye.mode,De),pe.return=ye,pe;case li:return pe=oa(pe),We(ye,pe,De)}if(Hi(pe)||Mi(pe))return pe=ro(pe,ye.mode,De,null),pe.return=ye,pe;if(typeof pe.then=="function")return We(ye,Ou(pe),De);if(pe.$$typeof===dt)return We(ye,Iu(ye,pe),De);Ac(ye,pe)}return null}function Pe(ye,pe,De,Ze){var St=pe!==null?pe.key:null;if(typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint")return St!==null?null:Z(ye,pe,""+De,Ze);if(typeof De=="object"&&De!==null){switch(De.$$typeof){case kt:return De.key===St?ce(ye,pe,De,Ze):null;case Ht:return De.key===St?Ie(ye,pe,De,Ze):null;case li:return De=oa(De),Pe(ye,pe,De,Ze)}if(Hi(De)||Mi(De))return St!==null?null:Ge(ye,pe,De,Ze,null);if(typeof De.then=="function")return Pe(ye,pe,Ou(De),Ze);if(De.$$typeof===dt)return Pe(ye,pe,Iu(ye,De),Ze);Ac(ye,De)}return null}function Oe(ye,pe,De,Ze,St){if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number"||typeof Ze=="bigint")return ye=ye.get(De)||null,Z(pe,ye,""+Ze,St);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case kt:return ye=ye.get(Ze.key===null?De:Ze.key)||null,ce(pe,ye,Ze,St);case Ht:return ye=ye.get(Ze.key===null?De:Ze.key)||null,Ie(pe,ye,Ze,St);case li:return Ze=oa(Ze),Oe(ye,pe,De,Ze,St)}if(Hi(Ze)||Mi(Ze))return ye=ye.get(De)||null,Ge(pe,ye,Ze,St,null);if(typeof Ze.then=="function")return Oe(ye,pe,De,Ou(Ze),St);if(Ze.$$typeof===dt)return Oe(ye,pe,De,Iu(pe,Ze),St);Ac(pe,Ze)}return null}function At(ye,pe,De,Ze){for(var St=null,bi=null,Rt=pe,ei=pe=0,di=null;Rt!==null&&ei<De.length;ei++){Rt.index>ei?(di=Rt,Rt=null):di=Rt.sibling;var Pi=Pe(ye,Rt,De[ei],Ze);if(Pi===null){Rt===null&&(Rt=di);break}r&&Rt&&Pi.alternate===null&&s(ye,Rt),pe=M(Pi,pe,ei),bi===null?St=Pi:bi.sibling=Pi,bi=Pi,Rt=di}if(ei===De.length)return c(ye,Rt),ri&&ws(ye,ei),St;if(Rt===null){for(;ei<De.length;ei++)Rt=We(ye,De[ei],Ze),Rt!==null&&(pe=M(Rt,pe,ei),bi===null?St=Rt:bi.sibling=Rt,bi=Rt);return ri&&ws(ye,ei),St}for(Rt=g(Rt);ei<De.length;ei++)di=Oe(Rt,ye,ei,De[ei],Ze),di!==null&&(r&&di.alternate!==null&&Rt.delete(di.key===null?ei:di.key),pe=M(di,pe,ei),bi===null?St=di:bi.sibling=di,bi=di);return r&&Rt.forEach(function(ul){return s(ye,ul)}),ri&&ws(ye,ei),St}function Nt(ye,pe,De,Ze){if(De==null)throw Error(oe(151));for(var St=null,bi=null,Rt=pe,ei=pe=0,di=null,Pi=De.next();Rt!==null&&!Pi.done;ei++,Pi=De.next()){Rt.index>ei?(di=Rt,Rt=null):di=Rt.sibling;var ul=Pe(ye,Rt,Pi.value,Ze);if(ul===null){Rt===null&&(Rt=di);break}r&&Rt&&ul.alternate===null&&s(ye,Rt),pe=M(ul,pe,ei),bi===null?St=ul:bi.sibling=ul,bi=ul,Rt=di}if(Pi.done)return c(ye,Rt),ri&&ws(ye,ei),St;if(Rt===null){for(;!Pi.done;ei++,Pi=De.next())Pi=We(ye,Pi.value,Ze),Pi!==null&&(pe=M(Pi,pe,ei),bi===null?St=Pi:bi.sibling=Pi,bi=Pi);return ri&&ws(ye,ei),St}for(Rt=g(Rt);!Pi.done;ei++,Pi=De.next())Pi=Oe(Rt,ye,ei,Pi.value,Ze),Pi!==null&&(r&&Pi.alternate!==null&&Rt.delete(Pi.key===null?ei:Pi.key),pe=M(Pi,pe,ei),bi===null?St=Pi:bi.sibling=Pi,bi=Pi);return r&&Rt.forEach(function(Dm){return s(ye,Dm)}),ri&&ws(ye,ei),St}function ji(ye,pe,De,Ze){if(typeof De=="object"&&De!==null&&De.type===xt&&De.key===null&&(De=De.props.children),typeof De=="object"&&De!==null){switch(De.$$typeof){case kt:e:{for(var St=De.key;pe!==null;){if(pe.key===St){if(St=De.type,St===xt){if(pe.tag===7){c(ye,pe.sibling),Ze=b(pe,De.props.children),Ze.return=ye,ye=Ze;break e}}else if(pe.elementType===St||typeof St=="object"&&St!==null&&St.$$typeof===li&&oa(St)===pe.type){c(ye,pe.sibling),Ze=b(pe,De.props),po(Ze,De),Ze.return=ye,ye=Ze;break e}c(ye,pe);break}else s(ye,pe);pe=pe.sibling}De.type===xt?(Ze=ro(De.props.children,ye.mode,Ze,De.key),Ze.return=ye,ye=Ze):(Ze=xc(De.type,De.key,De.props,null,ye.mode,Ze),po(Ze,De),Ze.return=ye,ye=Ze)}return B(ye);case Ht:e:{for(St=De.key;pe!==null;){if(pe.key===St)if(pe.tag===4&&pe.stateNode.containerInfo===De.containerInfo&&pe.stateNode.implementation===De.implementation){c(ye,pe.sibling),Ze=b(pe,De.children||[]),Ze.return=ye,ye=Ze;break e}else{c(ye,pe);break}else s(ye,pe);pe=pe.sibling}Ze=ao(De,ye.mode,Ze),Ze.return=ye,ye=Ze}return B(ye);case li:return De=oa(De),ji(ye,pe,De,Ze)}if(Hi(De))return At(ye,pe,De,Ze);if(Mi(De)){if(St=Mi(De),typeof St!="function")throw Error(oe(150));return De=St.call(De),Nt(ye,pe,De,Ze)}if(typeof De.then=="function")return ji(ye,pe,Ou(De),Ze);if(De.$$typeof===dt)return ji(ye,pe,Iu(ye,De),Ze);Ac(ye,De)}return typeof De=="string"&&De!==""||typeof De=="number"||typeof De=="bigint"?(De=""+De,pe!==null&&pe.tag===6?(c(ye,pe.sibling),Ze=b(pe,De),Ze.return=ye,ye=Ze):(c(ye,pe),Ze=bh(De,ye.mode,Ze),Ze.return=ye,ye=Ze),B(ye)):c(ye,pe)}return function(ye,pe,De,Ze){try{ku=0;var St=ji(ye,pe,De,Ze);return Sa=null,St}catch(Rt){if(Rt===lt||Rt===ho)throw Rt;var bi=na(29,Rt,null,ye.mode);return bi.lanes=Ze,bi.return=ye,bi}finally{}}}var cs=Fu(!0),Cc=Fu(!1),Cs=!1;function zc(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ba(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function si(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function zs(r,s,c){var g=r.updateQueue;if(g===null)return null;if(g=g.shared,(zi&2)!==0){var b=g.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),g.pending=s,s=Dl(r),xh(r,null,c),s}return Cu(r,g,s,c),Dl(r)}function mo(r,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194048)!==0)){var g=s.lanes;g&=r.pendingLanes,c|=g,s.lanes=c,zn(r,c)}}function Go(r,s){var c=r.updateQueue,g=r.alternate;if(g!==null&&(g=g.updateQueue,c===g)){var b=null,M=null;if(c=c.firstBaseUpdate,c!==null){do{var B={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};M===null?b=M=B:M=M.next=B,c=c.next}while(c!==null);M===null?b=M=s:M=M.next=s}else b=M=s;c={baseState:g.baseState,firstBaseUpdate:b,lastBaseUpdate:M,shared:g.shared,callbacks:g.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=s:r.next=s,c.lastBaseUpdate=s}var Nu=!1;function qo(){if(Nu){var r=Rl;if(r!==null)throw r}}function Ol(r,s,c,g){Nu=!1;var b=r.updateQueue;Cs=!1;var M=b.firstBaseUpdate,B=b.lastBaseUpdate,Z=b.shared.pending;if(Z!==null){b.shared.pending=null;var ce=Z,Ie=ce.next;ce.next=null,B===null?M=Ie:B.next=Ie,B=ce;var Ge=r.alternate;Ge!==null&&(Ge=Ge.updateQueue,Z=Ge.lastBaseUpdate,Z!==B&&(Z===null?Ge.firstBaseUpdate=Ie:Z.next=Ie,Ge.lastBaseUpdate=ce))}if(M!==null){var We=b.baseState;B=0,Ge=Ie=ce=null,Z=M;do{var Pe=Z.lane&-536870913,Oe=Pe!==Z.lane;if(Oe?(ai&Pe)===Pe:(g&Pe)===Pe){Pe!==0&&Pe===yr&&(Nu=!0),Ge!==null&&(Ge=Ge.next={lane:0,tag:Z.tag,payload:Z.payload,callback:null,next:null});e:{var At=r,Nt=Z;Pe=s;var ji=c;switch(Nt.tag){case 1:if(At=Nt.payload,typeof At=="function"){We=At.call(ji,We,Pe);break e}We=At;break e;case 3:At.flags=At.flags&-65537|128;case 0:if(At=Nt.payload,Pe=typeof At=="function"?At.call(ji,We,Pe):At,Pe==null)break e;We=mt({},We,Pe);break e;case 2:Cs=!0}}Pe=Z.callback,Pe!==null&&(r.flags|=64,Oe&&(r.flags|=8192),Oe=b.callbacks,Oe===null?b.callbacks=[Pe]:Oe.push(Pe))}else Oe={lane:Pe,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},Ge===null?(Ie=Ge=Oe,ce=We):Ge=Ge.next=Oe,B|=Pe;if(Z=Z.next,Z===null){if(Z=b.shared.pending,Z===null)break;Oe=Z,Z=Oe.next,Oe.next=null,b.lastBaseUpdate=Oe,b.shared.pending=null}}while(!0);Ge===null&&(ce=We),b.baseState=ce,b.firstBaseUpdate=Ie,b.lastBaseUpdate=Ge,M===null&&(b.shared.lanes=0),fs|=B,r.lanes=B,r.memoizedState=We}}function Dc(r,s){if(typeof r!="function")throw Error(oe(191,r));r.call(s)}function Ah(r,s){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)Dc(c[r],s)}var Ir=ie(null),Zo=ie(0);function Tt(r,s){r=el,it(Zo,r),it(Ir,s),el=r|s.baseLanes}function Pt(){it(Zo,el),it(Ir,Ir.current)}function go(){el=Zo.current,Ae(Ir),Ae(Zo)}var Pr=ie(null),rr=null;function Sn(r){var s=r.alternate;it(Mn,Mn.current&1),it(Pr,r),rr===null&&(s===null||Ir.current!==null||s.memoizedState!==null)&&(rr=r)}function Rr(r){it(Mn,Mn.current),it(Pr,r),rr===null&&(rr=r)}function Ch(r){r.tag===22?(it(Mn,Mn.current),it(Pr,r),rr===null&&(rr=r)):_o()}function _o(){it(Mn,Mn.current),it(Pr,Pr.current)}function Gr(r){Ae(Pr),rr===r&&(rr=null),Ae(Mn)}var Mn=ie(0);function Ds(r){for(var s=r;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||fa(c)||Qn(c)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var vi=0,zt=null,Oi=null,an=null,Ho=!1,la=!1,Is=!1,Fl=0,Ps=0,Rs=null,zh=0;function sn(){throw Error(oe(321))}function ka(r,s){if(s===null)return!1;for(var c=0;c<s.length&&c<r.length;c++)if(!Nr(r[c],s[c]))return!1;return!0}function Nl(r,s,c,g,b,M){return vi=M,zt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Ve.H=r===null||r.memoizedState===null?Nn:Lr,Is=!1,M=c(g,b),Is=!1,la&&(M=ju(s,c,g,b)),jl(r),M}function jl(r){Ve.H=ln;var s=Oi!==null&&Oi.next!==null;if(vi=0,an=Oi=zt=null,Ho=!1,Ps=0,Rs=null,s)throw Error(oe(300));r===null||jn||(r=r.dependencies,r!==null&&Pl(r)&&(jn=!0))}function ju(r,s,c,g){zt=r;var b=0;do{if(la&&(Rs=null),Ps=0,la=!1,25<=b)throw Error(oe(301));if(b+=1,an=Oi=null,r.updateQueue!=null){var M=r.updateQueue;M.lastEffect=null,M.events=null,M.stores=null,M.memoCache!=null&&(M.memoCache.index=0)}Ve.H=Qi,M=s(c,g)}while(la);return M}function Vu(){var r=Ve.H,s=r.useState()[0];return s=typeof s.then=="function"?$o(s):s,r=r.useState()[0],(Oi!==null?Oi.memoizedState:null)!==r&&(zt.flags|=1024),s}function Uu(){var r=Fl!==0;return Fl=0,r}function Ls(r,s,c){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~c}function Bs(r){if(Ho){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Ho=!1}vi=0,an=Oi=zt=null,la=!1,Ps=Fl=0,Rs=null}function hr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return an===null?zt.memoizedState=an=r:an=an.next=r,an}function Wi(){if(Oi===null){var r=zt.alternate;r=r!==null?r.memoizedState:null}else r=Oi.next;var s=an===null?zt.memoizedState:an.next;if(s!==null)an=s,Oi=r;else{if(r===null)throw zt.alternate===null?Error(oe(467)):Error(oe(310));Oi=r,r={memoizedState:Oi.memoizedState,baseState:Oi.baseState,baseQueue:Oi.baseQueue,queue:Oi.queue,next:null},an===null?zt.memoizedState=an=r:an=an.next=r}return an}function hs(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function $o(r){var s=Ps;return Ps+=1,Rs===null&&(Rs=[]),r=kl(Rs,r,s),s=zt,(an===null?s.memoizedState:an.next)===null&&(s=s.alternate,Ve.H=s===null||s.memoizedState===null?Nn:Lr),r}function Vl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return $o(r);if(r.$$typeof===dt)return In(r)}throw Error(oe(438,String(r)))}function Ul(r){var s=null,c=zt.updateQueue;if(c!==null&&(s=c.memoCache),s==null){var g=zt.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(s={data:g.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),c===null&&(c=hs(),zt.updateQueue=c),c.memoCache=s,c=s.data[s.index],c===void 0)for(c=s.data[s.index]=Array(r),g=0;g<r;g++)c[g]=cn;return s.index++,c}function Oa(r,s){return typeof s=="function"?s(r):s}function m(r){var s=Wi();return t(s,Oi,r)}function t(r,s,c){var g=r.queue;if(g===null)throw Error(oe(311));g.lastRenderedReducer=c;var b=r.baseQueue,M=g.pending;if(M!==null){if(b!==null){var B=b.next;b.next=M.next,M.next=B}s.baseQueue=b=M,g.pending=null}if(M=r.baseState,b===null)r.memoizedState=M;else{s=b.next;var Z=B=null,ce=null,Ie=s,Ge=!1;do{var We=Ie.lane&-536870913;if(We!==Ie.lane?(ai&We)===We:(vi&We)===We){var Pe=Ie.revertLane;if(Pe===0)ce!==null&&(ce=ce.next={lane:0,revertLane:0,gesture:null,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null}),We===yr&&(Ge=!0);else if((vi&Pe)===Pe){Ie=Ie.next,Pe===yr&&(Ge=!0);continue}else We={lane:0,revertLane:Ie.revertLane,gesture:null,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null},ce===null?(Z=ce=We,B=M):ce=ce.next=We,zt.lanes|=Pe,fs|=Pe;We=Ie.action,Is&&c(M,We),M=Ie.hasEagerState?Ie.eagerState:c(M,We)}else Pe={lane:We,revertLane:Ie.revertLane,gesture:Ie.gesture,action:Ie.action,hasEagerState:Ie.hasEagerState,eagerState:Ie.eagerState,next:null},ce===null?(Z=ce=Pe,B=M):ce=ce.next=Pe,zt.lanes|=We,fs|=We;Ie=Ie.next}while(Ie!==null&&Ie!==s);if(ce===null?B=M:ce.next=Z,!Nr(M,r.memoizedState)&&(jn=!0,Ge&&(c=Rl,c!==null)))throw c;r.memoizedState=M,r.baseState=B,r.baseQueue=ce,g.lastRenderedState=M}return b===null&&(g.lanes=0),[r.memoizedState,g.dispatch]}function a(r){var s=Wi(),c=s.queue;if(c===null)throw Error(oe(311));c.lastRenderedReducer=r;var g=c.dispatch,b=c.pending,M=s.memoizedState;if(b!==null){c.pending=null;var B=b=b.next;do M=r(M,B.action),B=B.next;while(B!==b);Nr(M,s.memoizedState)||(jn=!0),s.memoizedState=M,s.baseQueue===null&&(s.baseState=M),c.lastRenderedState=M}return[M,g]}function l(r,s,c){var g=zt,b=Wi(),M=ri;if(M){if(c===void 0)throw Error(oe(407));c=c()}else c=s();var B=!Nr((Oi||b).memoizedState,c);if(B&&(b.memoizedState=c,jn=!0),b=b.queue,Ce(v.bind(null,g,b,r),[r]),b.getSnapshot!==s||B||an!==null&&an.memoizedState.tag&1){if(g.flags|=2048,ee(9,{destroy:void 0},_.bind(null,g,b,c,s),null),Ji===null)throw Error(oe(349));M||(vi&127)!==0||h(g,s,c)}return c}function h(r,s,c){r.flags|=16384,r={getSnapshot:s,value:c},s=zt.updateQueue,s===null?(s=hs(),zt.updateQueue=s,s.stores=[r]):(c=s.stores,c===null?s.stores=[r]:c.push(r))}function _(r,s,c,g){s.value=c,s.getSnapshot=g,w(s)&&S(r)}function v(r,s,c){return c(function(){w(s)&&S(r)})}function w(r){var s=r.getSnapshot;r=r.value;try{var c=s();return!Nr(r,c)}catch{return!0}}function S(r){var s=ba(r,2);s!==null&&Aa(s,r,2)}function A(r){var s=hr();if(typeof r=="function"){var c=r;if(r=c(),Is){Se(!0);try{c()}finally{Se(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oa,lastRenderedState:r},s}function z(r,s,c,g){return r.baseState=c,t(r,Oi,typeof g=="function"?g:Oa)}function R(r,s,c,g,b){if(Wn(r))throw Error(oe(485));if(r=s.action,r!==null){var M={payload:b,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(B){M.listeners.push(B)}};Ve.T!==null?c(!0):M.isTransition=!1,g(M),c=s.pending,c===null?(M.next=s.pending=M,P(s,M)):(M.next=c.next,s.pending=c.next=M)}}function P(r,s){var c=s.action,g=s.payload,b=r.state;if(s.isTransition){var M=Ve.T,B={};Ve.T=B;try{var Z=c(b,g),ce=Ve.S;ce!==null&&ce(B,Z),F(r,s,Z)}catch(Ie){X(r,s,Ie)}finally{M!==null&&B.types!==null&&(M.types=B.types),Ve.T=M}}else try{M=c(b,g),F(r,s,M)}catch(Ie){X(r,s,Ie)}}function F(r,s,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(g){U(r,s,g)},function(g){return X(r,s,g)}):U(r,s,c)}function U(r,s,c){s.status="fulfilled",s.value=c,W(s),r.state=c,s=r.pending,s!==null&&(c=s.next,c===s?r.pending=null:(c=c.next,s.next=c,P(r,c)))}function X(r,s,c){var g=r.pending;if(r.pending=null,g!==null){g=g.next;do s.status="rejected",s.reason=c,W(s),s=s.next;while(s!==g)}r.action=null}function W(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function Y(r,s){return s}function Q(r,s){if(ri){var c=Ji.formState;if(c!==null){e:{var g=zt;if(ri){if(ki){t:{for(var b=ki,M=aa;b.nodeType!==8;){if(!M){b=null;break t}if(b=ms(b.nextSibling),b===null){b=null;break t}}M=b.data,b=M==="F!"||M==="F"?b:null}if(b){ki=ms(b.nextSibling),g=b.data==="F!";break e}}Vr(g)}g=!1}g&&(s=c[0])}}return c=hr(),c.memoizedState=c.baseState=s,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Y,lastRenderedState:s},c.queue=g,c=Yo.bind(null,zt,g),g.dispatch=c,g=A(!1),M=Fn.bind(null,zt,!1,g.queue),g=hr(),b={state:s,dispatch:null,action:r,pending:null},g.queue=b,c=R.bind(null,zt,b,M,c),b.dispatch=c,g.memoizedState=r,[s,c,!1]}function ne(r){var s=Wi();return K(s,Oi,r)}function K(r,s,c){if(s=t(r,s,Y)[0],r=m(Oa)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var g=$o(s)}catch(B){throw B===lt?ho:B}else g=s;s=Wi();var b=s.queue,M=b.dispatch;return c!==s.memoizedState&&(zt.flags|=2048,ee(9,{destroy:void 0},ae.bind(null,b,c),null)),[g,M,r]}function ae(r,s){r.action=s}function le(r){var s=Wi(),c=Oi;if(c!==null)return K(s,c,r);Wi(),s=s.memoizedState,c=Wi();var g=c.queue.dispatch;return c.memoizedState=r,[s,g,!1]}function ee(r,s,c,g){return r={tag:r,create:c,deps:g,inst:s,next:null},s=zt.updateQueue,s===null&&(s=hs(),zt.updateQueue=s),c=s.lastEffect,c===null?s.lastEffect=r.next=r:(g=c.next,c.next=r,r.next=g,s.lastEffect=r),r}function de(){return Wi().memoizedState}function Me(r,s,c,g){var b=hr();zt.flags|=r,b.memoizedState=ee(1|s,{destroy:void 0},c,g===void 0?null:g)}function be(r,s,c,g){var b=Wi();g=g===void 0?null:g;var M=b.memoizedState.inst;Oi!==null&&g!==null&&ka(g,Oi.memoizedState.deps)?b.memoizedState=ee(s,M,c,g):(zt.flags|=r,b.memoizedState=ee(1|s,M,c,g))}function Ee(r,s){Me(8390656,8,r,s)}function Ce(r,s){be(2048,8,r,s)}function He(r){zt.flags|=4;var s=zt.updateQueue;if(s===null)s=hs(),zt.updateQueue=s,s.events=[r];else{var c=s.events;c===null?s.events=[r]:c.push(r)}}function et(r){var s=Wi().memoizedState;return He({ref:s,nextImpl:r}),function(){if((zi&2)!==0)throw Error(oe(440));return s.impl.apply(void 0,arguments)}}function qe(r,s){return be(4,2,r,s)}function wt(r,s){return be(4,4,r,s)}function Vt(r,s){if(typeof s=="function"){r=r();var c=s(r);return function(){typeof c=="function"?c():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function _i(r,s,c){c=c!=null?c.concat([r]):null,be(4,4,Vt.bind(null,s,r),c)}function Fi(){}function xi(r,s){var c=Wi();s=s===void 0?null:s;var g=c.memoizedState;return s!==null&&ka(s,g[1])?g[0]:(c.memoizedState=[r,s],r)}function Zi(r,s){var c=Wi();s=s===void 0?null:s;var g=c.memoizedState;if(s!==null&&ka(s,g[1]))return g[0];if(g=r(),Is){Se(!0);try{r()}finally{Se(!1)}}return c.memoizedState=[g,s],g}function Ci(r,s,c){return c===void 0||(vi&1073741824)!==0&&(ai&261930)===0?r.memoizedState=s:(r.memoizedState=c,r=Zc(),zt.lanes|=r,fs|=r,c)}function kn(r,s,c,g){return Nr(c,s)?c:Ir.current!==null?(r=Ci(r,c,g),Nr(r,s)||(jn=!0),r):(vi&42)===0||(vi&1073741824)!==0&&(ai&261930)===0?(jn=!0,r.memoizedState=c):(r=Zc(),zt.lanes|=r,fs|=r,s)}function Gi(r,s,c,g,b){var M=st.p;st.p=M!==0&&8>M?M:8;var B=Ve.T,Z={};Ve.T=Z,Fn(r,!1,s,c);try{var ce=b(),Ie=Ve.S;if(Ie!==null&&Ie(Z,ce),ce!==null&&typeof ce=="object"&&typeof ce.then=="function"){var Ge=Pu(ce,g);qr(r,s,Ge,Di(r))}else qr(r,s,g,Di(r))}catch(We){qr(r,s,{then:function(){},status:"rejected",reason:We},Di())}finally{st.p=M,B!==null&&Z.types!==null&&(B.types=Z.types),Ve.T=B}}function On(){}function on(r,s,c,g){if(r.tag!==5)throw Error(oe(476));var b=_n(r).queue;Gi(r,b,s,Lt,c===null?On:function(){return ar(r),c(g)})}function _n(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:Lt,baseState:Lt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oa,lastRenderedState:Lt},next:null};var c={};return s.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oa,lastRenderedState:c},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function ar(r){var s=_n(r);s.next===null&&(s=r.alternate.memoizedState),qr(r,s.next.queue,{},Di())}function dr(){return In(cd)}function Fa(){return Wi().memoizedState}function ks(){return Wi().memoizedState}function Xo(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var c=Di();r=si(c);var g=zs(s,r,c);g!==null&&(Aa(g,s,c),mo(g,s,c)),s={cache:uo()},r.payload=s;return}s=s.return}}function Ic(r,s,c){var g=Di();c={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Wn(r)?sr(s,c):(c=no(r,s,c,g),c!==null&&(Aa(c,r,g),ua(c,s,g)))}function Yo(r,s,c){var g=Di();qr(r,s,c,g)}function qr(r,s,c,g){var b={lane:g,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Wn(r))sr(s,b);else{var M=r.alternate;if(r.lanes===0&&(M===null||M.lanes===0)&&(M=s.lastRenderedReducer,M!==null))try{var B=s.lastRenderedState,Z=M(B,c);if(b.hasEagerState=!0,b.eagerState=Z,Nr(Z,B))return Cu(r,s,b,0),Ji===null&&No(),!1}catch{}finally{}if(c=no(r,s,b,g),c!==null)return Aa(c,r,g),ua(c,s,g),!0}return!1}function Fn(r,s,c,g){if(g={lane:2,revertLane:Wl(),gesture:null,action:g,hasEagerState:!1,eagerState:null,next:null},Wn(r)){if(s)throw Error(oe(479))}else s=no(r,c,g,2),s!==null&&Aa(s,r,2)}function Wn(r){var s=r.alternate;return r===zt||s!==null&&s===zt}function sr(r,s){la=Ho=!0;var c=r.pending;c===null?s.next=s:(s.next=c.next,c.next=s),r.pending=s}function ua(r,s,c){if((c&4194048)!==0){var g=s.lanes;g&=r.pendingLanes,c|=g,s.lanes=c,zn(r,c)}}var ln={readContext:In,use:Vl,useCallback:sn,useContext:sn,useEffect:sn,useImperativeHandle:sn,useLayoutEffect:sn,useInsertionEffect:sn,useMemo:sn,useReducer:sn,useRef:sn,useState:sn,useDebugValue:sn,useDeferredValue:sn,useTransition:sn,useSyncExternalStore:sn,useId:sn,useHostTransitionStatus:sn,useFormState:sn,useActionState:sn,useOptimistic:sn,useMemoCache:sn,useCacheRefresh:sn};ln.useEffectEvent=sn;var Nn={readContext:In,use:Vl,useCallback:function(r,s){return hr().memoizedState=[r,s===void 0?null:s],r},useContext:In,useEffect:Ee,useImperativeHandle:function(r,s,c){c=c!=null?c.concat([r]):null,Me(4194308,4,Vt.bind(null,s,r),c)},useLayoutEffect:function(r,s){return Me(4194308,4,r,s)},useInsertionEffect:function(r,s){Me(4,2,r,s)},useMemo:function(r,s){var c=hr();s=s===void 0?null:s;var g=r();if(Is){Se(!0);try{r()}finally{Se(!1)}}return c.memoizedState=[g,s],g},useReducer:function(r,s,c){var g=hr();if(c!==void 0){var b=c(s);if(Is){Se(!0);try{c(s)}finally{Se(!1)}}}else b=s;return g.memoizedState=g.baseState=b,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:b},g.queue=r,r=r.dispatch=Ic.bind(null,zt,r),[g.memoizedState,r]},useRef:function(r){var s=hr();return r={current:r},s.memoizedState=r},useState:function(r){r=A(r);var s=r.queue,c=Yo.bind(null,zt,s);return s.dispatch=c,[r.memoizedState,c]},useDebugValue:Fi,useDeferredValue:function(r,s){var c=hr();return Ci(c,r,s)},useTransition:function(){var r=A(!1);return r=Gi.bind(null,zt,r.queue,!0,!1),hr().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,c){var g=zt,b=hr();if(ri){if(c===void 0)throw Error(oe(407));c=c()}else{if(c=s(),Ji===null)throw Error(oe(349));(ai&127)!==0||h(g,s,c)}b.memoizedState=c;var M={value:c,getSnapshot:s};return b.queue=M,Ee(v.bind(null,g,M,r),[r]),g.flags|=2048,ee(9,{destroy:void 0},_.bind(null,g,M,c,s),null),c},useId:function(){var r=hr(),s=Ji.identifierPrefix;if(ri){var c=jr,g=ns;c=(g&~(1<<32-je(g)-1)).toString(32)+c,s="_"+s+"R_"+c,c=Fl++,0<c&&(s+="H"+c.toString(32)),s+="_"}else c=zh++,s="_"+s+"r_"+c.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:dr,useFormState:Q,useActionState:Q,useOptimistic:function(r){var s=hr();s.memoizedState=s.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=c,s=Fn.bind(null,zt,!0,c),c.dispatch=s,[r,s]},useMemoCache:Ul,useCacheRefresh:function(){return hr().memoizedState=Xo.bind(null,zt)},useEffectEvent:function(r){var s=hr(),c={impl:r};return s.memoizedState=c,function(){if((zi&2)!==0)throw Error(oe(440));return c.impl.apply(void 0,arguments)}}},Lr={readContext:In,use:Vl,useCallback:xi,useContext:In,useEffect:Ce,useImperativeHandle:_i,useInsertionEffect:qe,useLayoutEffect:wt,useMemo:Zi,useReducer:m,useRef:de,useState:function(){return m(Oa)},useDebugValue:Fi,useDeferredValue:function(r,s){var c=Wi();return kn(c,Oi.memoizedState,r,s)},useTransition:function(){var r=m(Oa)[0],s=Wi().memoizedState;return[typeof r=="boolean"?r:$o(r),s]},useSyncExternalStore:l,useId:Fa,useHostTransitionStatus:dr,useFormState:ne,useActionState:ne,useOptimistic:function(r,s){var c=Wi();return z(c,Oi,r,s)},useMemoCache:Ul,useCacheRefresh:ks};Lr.useEffectEvent=et;var Qi={readContext:In,use:Vl,useCallback:xi,useContext:In,useEffect:Ce,useImperativeHandle:_i,useInsertionEffect:qe,useLayoutEffect:wt,useMemo:Zi,useReducer:a,useRef:de,useState:function(){return a(Oa)},useDebugValue:Fi,useDeferredValue:function(r,s){var c=Wi();return Oi===null?Ci(c,r,s):kn(c,Oi.memoizedState,r,s)},useTransition:function(){var r=a(Oa)[0],s=Wi().memoizedState;return[typeof r=="boolean"?r:$o(r),s]},useSyncExternalStore:l,useId:Fa,useHostTransitionStatus:dr,useFormState:le,useActionState:le,useOptimistic:function(r,s){var c=Wi();return Oi!==null?z(c,Oi,r,s):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:Ul,useCacheRefresh:ks};Qi.useEffectEvent=et;function Dh(r,s,c,g){s=r.memoizedState,c=c(g,s),c=c==null?s:mt({},s,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var Pc={enqueueSetState:function(r,s,c){r=r._reactInternals;var g=Di(),b=si(g);b.payload=s,c!=null&&(b.callback=c),s=zs(r,b,g),s!==null&&(Aa(s,r,g),mo(s,r,g))},enqueueReplaceState:function(r,s,c){r=r._reactInternals;var g=Di(),b=si(g);b.tag=1,b.payload=s,c!=null&&(b.callback=c),s=zs(r,b,g),s!==null&&(Aa(s,r,g),mo(s,r,g))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var c=Di(),g=si(c);g.tag=2,s!=null&&(g.callback=s),s=zs(r,g,c),s!==null&&(Aa(s,r,c),mo(s,r,c))}};function Rc(r,s,c,g,b,M,B){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(g,M,B):s.prototype&&s.prototype.isPureReactComponent?!io(c,g)||!io(b,M):!0}function Ih(r,s,c,g){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,g),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,g),s.state!==r&&Pc.enqueueReplaceState(s,s.state,null)}function ca(r,s){var c=s;if("ref"in s){c={};for(var g in s)g!=="ref"&&(c[g]=s[g])}if(r=r.defaultProps){c===s&&(c=mt({},c));for(var b in r)c[b]===void 0&&(c[b]=r[b])}return c}function yo(r){ts(r)}function Os(r){console.error(r)}function Ph(r){ts(r)}function Wo(r,s){try{var c=r.onUncaughtError;c(s.value,{componentStack:s.stack})}catch(g){setTimeout(function(){throw g})}}function Lc(r,s,c){try{var g=r.onCaughtError;g(c.value,{componentStack:c.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function vo(r,s,c){return c=si(c),c.tag=3,c.payload={element:null},c.callback=function(){Wo(r,s)},c}function Bc(r){return r=si(r),r.tag=3,r}function kc(r,s,c,g){var b=c.type.getDerivedStateFromError;if(typeof b=="function"){var M=g.value;r.payload=function(){return b(M)},r.callback=function(){Lc(s,c,g)}}var B=c.stateNode;B!==null&&typeof B.componentDidCatch=="function"&&(r.callback=function(){Lc(s,c,g),typeof b!="function"&&($l===null?$l=new Set([this]):$l.add(this));var Z=g.stack;this.componentDidCatch(g.value,{componentStack:Z!==null?Z:""})})}function If(r,s,c,g,b){if(c.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(s=c.alternate,s!==null&&Ta(s,c,b,!0),c=Pr.current,c!==null){switch(c.tag){case 31:case 13:return rr===null?il():c.alternate===null&&Gn===0&&(Gn=3),c.flags&=-257,c.flags|=65536,c.lanes=b,g===Bu?c.flags|=16384:(s=c.updateQueue,s===null?c.updateQueue=new Set([g]):s.add(g),Wh(r,g,b)),!1;case 22:return c.flags|=65536,g===Bu?c.flags|=16384:(s=c.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([g])},c.updateQueue=s):(c=s.retryQueue,c===null?s.retryQueue=new Set([g]):c.add(g)),Wh(r,g,b)),!1}throw Error(oe(435,c.tag))}return Wh(r,g,b),il(),!1}if(ri)return s=Pr.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,g!==nn&&(r=Error(oe(422),{cause:g}),Ss(zr(r,c)))):(g!==nn&&(s=Error(oe(423),{cause:g}),Ss(zr(s,c))),r=r.current.alternate,r.flags|=65536,b&=-b,r.lanes|=b,g=zr(g,c),b=vo(r.stateNode,g,b),Go(r,b),Gn!==4&&(Gn=2)),!1;var M=Error(oe(520),{cause:g});if(M=zr(M,c),qh===null?qh=[M]:qh.push(M),Gn!==4&&(Gn=2),s===null)return!0;g=zr(g,c),c=s;do{switch(c.tag){case 3:return c.flags|=65536,r=b&-b,c.lanes|=r,r=vo(c.stateNode,g,r),Go(c,r),!1;case 1:if(s=c.type,M=c.stateNode,(c.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&($l===null||!$l.has(M))))return c.flags|=65536,b&=-b,c.lanes|=b,b=Bc(b),kc(b,r,c,g),Go(c,b),!1}c=c.return}while(c!==null);return!1}var Pf=Error(oe(461)),jn=!1;function vr(r,s,c,g){s.child=r===null?Cc(s,null,c,g):cs(s,r.child,c,g)}function Rf(r,s,c,g,b){c=c.render;var M=s.ref;if("ref"in g){var B={};for(var Z in g)Z!=="ref"&&(B[Z]=g[Z])}else B=g;return As(s),g=Nl(r,s,c,B,M,b),Z=Uu(),r!==null&&!jn?(Ls(r,s,b),Pn(r,s,b)):(ri&&Z&&Vo(s),s.flags|=1,vr(r,s,g,b),s.child)}function Gu(r,s,c,g,b){if(r===null){var M=c.type;return typeof M=="function"&&!vc(M)&&M.defaultProps===void 0&&c.compare===null?(s.tag=15,s.type=M,Op(r,s,M,g,b)):(r=xc(c.type,null,g,s,s.mode,b),r.ref=s.ref,r.return=s,s.child=r)}if(M=r.child,!Vd(r,b)){var B=M.memoizedProps;if(c=c.compare,c=c!==null?c:io,c(B,g)&&r.ref===s.ref)return Pn(r,s,b)}return s.flags|=1,r=ra(M,g),r.ref=s.ref,r.return=s,s.child=r}function Op(r,s,c,g,b){if(r!==null){var M=r.memoizedProps;if(io(M,g)&&r.ref===s.ref)if(jn=!1,s.pendingProps=g=M,Vd(r,b))(r.flags&131072)!==0&&(jn=!0);else return s.lanes=r.lanes,Pn(r,s,b)}return Lf(r,s,c,g,b)}function qu(r,s,c,g){var b=g.children,M=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.mode==="hidden"){if((s.flags&128)!==0){if(M=M!==null?M.baseLanes|c:c,r!==null){for(g=s.child=r.child,b=0;g!==null;)b=b|g.lanes|g.childLanes,g=g.sibling;g=b&~M}else g=0,s.child=null;return Rh(r,s,M,c,g)}if((c&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&co(s,M!==null?M.cachePool:null),M!==null?Tt(s,M):Pt(),Ch(s);else return g=s.lanes=536870912,Rh(r,s,M!==null?M.baseLanes|c:c,c,g)}else M!==null?(co(s,M.cachePool),Tt(s,M),_o(),s.memoizedState=null):(r!==null&&co(s,null),Pt(),_o());return vr(r,s,b,c),s.child}function Gl(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Rh(r,s,c,g,b){var M=Ru();return M=M===null?null:{parent:rn._currentValue,pool:M},s.memoizedState={baseLanes:c,cachePool:M},r!==null&&co(s,null),Pt(),Ch(s),r!==null&&Ta(r,s,g,!0),s.childLanes=b,null}function Bd(r,s){return s=jd({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function Fp(r,s,c){return cs(s,r.child,null,c),r=Bd(s,s.pendingProps),r.flags|=2,Gr(s),s.memoizedState=null,r}function km(r,s,c){var g=s.pendingProps,b=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(ri){if(g.mode==="hidden")return r=Bd(s,g),s.lanes=536870912,Gl(null,r);if(Rr(s),(r=ki)?(r=gp(r,aa),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:is!==null?{id:ns,overflow:jr}:null,retryLane:536870912,hydrationErrors:null},c=bc(r),c.return=s,s.child=c,nr=s,ki=null)):r=null,r===null)throw Vr(s);return s.lanes=536870912,null}return Bd(s,g)}var M=r.memoizedState;if(M!==null){var B=M.dehydrated;if(Rr(s),b)if(s.flags&256)s.flags&=-257,s=Fp(r,s,c);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(oe(558));else if(jn||Ta(r,s,c,!1),b=(c&r.childLanes)!==0,jn||b){if(g=Ji,g!==null&&(B=ml(g,c),B!==0&&B!==M.retryLane))throw M.retryLane=B,ba(r,B),Aa(g,r,B),Pf;il(),s=Fp(r,s,c)}else r=M.treeContext,ki=ms(B.nextSibling),nr=s,ri=!0,Ts=null,aa=!1,r!==null&&Th(s,r),s=Bd(s,g),s.flags|=4096;return s}return r=ra(r.child,{mode:g.mode,children:g.children}),r.ref=s.ref,s.child=r,r.return=s,r}function kd(r,s){var c=s.ref;if(c===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(oe(284));(r===null||r.ref!==c)&&(s.flags|=4194816)}}function Lf(r,s,c,g,b){return As(s),c=Nl(r,s,c,g,void 0,b),g=Uu(),r!==null&&!jn?(Ls(r,s,b),Pn(r,s,b)):(ri&&g&&Vo(s),s.flags|=1,vr(r,s,c,b),s.child)}function Bf(r,s,c,g,b,M){return As(s),s.updateQueue=null,c=ju(s,g,c,b),jl(r),g=Uu(),r!==null&&!jn?(Ls(r,s,M),Pn(r,s,M)):(ri&&g&&Vo(s),s.flags|=1,vr(r,s,c,M),s.child)}function Od(r,s,c,g,b){if(As(s),s.stateNode===null){var M=Qt,B=c.contextType;typeof B=="object"&&B!==null&&(M=In(B)),M=new c(g,M),s.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,M.updater=Pc,s.stateNode=M,M._reactInternals=s,M=s.stateNode,M.props=g,M.state=s.memoizedState,M.refs={},zc(s),B=c.contextType,M.context=typeof B=="object"&&B!==null?In(B):Qt,M.state=s.memoizedState,B=c.getDerivedStateFromProps,typeof B=="function"&&(Dh(s,c,B,g),M.state=s.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(B=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),B!==M.state&&Pc.enqueueReplaceState(M,M.state,null),Ol(s,g,M,b),qo(),M.state=s.memoizedState),typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!0}else if(r===null){M=s.stateNode;var Z=s.memoizedProps,ce=ca(c,Z);M.props=ce;var Ie=M.context,Ge=c.contextType;B=Qt,typeof Ge=="object"&&Ge!==null&&(B=In(Ge));var We=c.getDerivedStateFromProps;Ge=typeof We=="function"||typeof M.getSnapshotBeforeUpdate=="function",Z=s.pendingProps!==Z,Ge||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(Z||Ie!==B)&&Ih(s,M,g,B),Cs=!1;var Pe=s.memoizedState;M.state=Pe,Ol(s,g,M,b),qo(),Ie=s.memoizedState,Z||Pe!==Ie||Cs?(typeof We=="function"&&(Dh(s,c,We,g),Ie=s.memoizedState),(ce=Cs||Rc(s,c,ce,g,Pe,Ie,B))?(Ge||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(s.flags|=4194308)):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=g,s.memoizedState=Ie),M.props=g,M.state=Ie,M.context=B,g=ce):(typeof M.componentDidMount=="function"&&(s.flags|=4194308),g=!1)}else{M=s.stateNode,Ba(r,s),B=s.memoizedProps,Ge=ca(c,B),M.props=Ge,We=s.pendingProps,Pe=M.context,Ie=c.contextType,ce=Qt,typeof Ie=="object"&&Ie!==null&&(ce=In(Ie)),Z=c.getDerivedStateFromProps,(Ie=typeof Z=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(B!==We||Pe!==ce)&&Ih(s,M,g,ce),Cs=!1,Pe=s.memoizedState,M.state=Pe,Ol(s,g,M,b),qo();var Oe=s.memoizedState;B!==We||Pe!==Oe||Cs||r!==null&&r.dependencies!==null&&Pl(r.dependencies)?(typeof Z=="function"&&(Dh(s,c,Z,g),Oe=s.memoizedState),(Ge=Cs||Rc(s,c,Ge,g,Pe,Oe,ce)||r!==null&&r.dependencies!==null&&Pl(r.dependencies))?(Ie||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(g,Oe,ce),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(g,Oe,ce)),typeof M.componentDidUpdate=="function"&&(s.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof M.componentDidUpdate!="function"||B===r.memoizedProps&&Pe===r.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||B===r.memoizedProps&&Pe===r.memoizedState||(s.flags|=1024),s.memoizedProps=g,s.memoizedState=Oe),M.props=g,M.state=Oe,M.context=ce,g=Ge):(typeof M.componentDidUpdate!="function"||B===r.memoizedProps&&Pe===r.memoizedState||(s.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||B===r.memoizedProps&&Pe===r.memoizedState||(s.flags|=1024),g=!1)}return M=g,kd(r,s),g=(s.flags&128)!==0,M||g?(M=s.stateNode,c=g&&typeof c.getDerivedStateFromError!="function"?null:M.render(),s.flags|=1,r!==null&&g?(s.child=cs(s,r.child,null,b),s.child=cs(s,null,c,b)):vr(r,s,c,b),s.memoizedState=M.state,r=s.child):r=Pn(r,s,b),r}function kf(r,s,c,g){return as(),s.flags|=256,vr(r,s,c,g),s.child}var Fd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Of(r){return{baseLanes:r,cachePool:us()}}function Ff(r,s,c){return r=r!==null?r.childLanes&~c:0,s&&(r|=Ua),r}function Nf(r,s,c){var g=s.pendingProps,b=!1,M=(s.flags&128)!==0,B;if((B=M)||(B=r!==null&&r.memoizedState===null?!1:(Mn.current&2)!==0),B&&(b=!0,s.flags&=-129),B=(s.flags&32)!==0,s.flags&=-33,r===null){if(ri){if(b?Sn(s):_o(),(r=ki)?(r=gp(r,aa),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:is!==null?{id:ns,overflow:jr}:null,retryLane:536870912,hydrationErrors:null},c=bc(r),c.return=s,s.child=c,nr=s,ki=null)):r=null,r===null)throw Vr(s);return Qn(r)?s.lanes=32:s.lanes=536870912,null}var Z=g.children;return g=g.fallback,b?(_o(),b=s.mode,Z=jd({mode:"hidden",children:Z},b),g=ro(g,b,c,null),Z.return=s,g.return=s,Z.sibling=g,s.child=Z,g=s.child,g.memoizedState=Of(c),g.childLanes=Ff(r,B,c),s.memoizedState=Fd,Gl(null,g)):(Sn(s),Nd(s,Z))}var ce=r.memoizedState;if(ce!==null&&(Z=ce.dehydrated,Z!==null)){if(M)s.flags&256?(Sn(s),s.flags&=-257,s=Lh(r,s,c)):s.memoizedState!==null?(_o(),s.child=r.child,s.flags|=128,s=null):(_o(),Z=g.fallback,b=s.mode,g=jd({mode:"visible",children:g.children},b),Z=ro(Z,b,c,null),Z.flags|=2,g.return=s,Z.return=s,g.sibling=Z,s.child=g,cs(s,r.child,null,c),g=s.child,g.memoizedState=Of(c),g.childLanes=Ff(r,B,c),s.memoizedState=Fd,s=Gl(null,g));else if(Sn(s),Qn(Z)){if(B=Z.nextSibling&&Z.nextSibling.dataset,B)var Ie=B.dgst;B=Ie,g=Error(oe(419)),g.stack="",g.digest=B,Ss({value:g,source:null,stack:null}),s=Lh(r,s,c)}else if(jn||Ta(r,s,c,!1),B=(c&r.childLanes)!==0,jn||B){if(B=Ji,B!==null&&(g=ml(B,c),g!==0&&g!==ce.retryLane))throw ce.retryLane=g,ba(r,g),Aa(B,r,g),Pf;fa(Z)||il(),s=Lh(r,s,c)}else fa(Z)?(s.flags|=192,s.child=r.child,s=null):(r=ce.treeContext,ki=ms(Z.nextSibling),nr=s,ri=!0,Ts=null,aa=!1,r!==null&&Th(s,r),s=Nd(s,g.children),s.flags|=4096);return s}return b?(_o(),Z=g.fallback,b=s.mode,ce=r.child,Ie=ce.sibling,g=ra(ce,{mode:"hidden",children:g.children}),g.subtreeFlags=ce.subtreeFlags&65011712,Ie!==null?Z=ra(Ie,Z):(Z=ro(Z,b,c,null),Z.flags|=2),Z.return=s,g.return=s,g.sibling=Z,s.child=g,Gl(null,g),g=s.child,Z=r.child.memoizedState,Z===null?Z=Of(c):(b=Z.cachePool,b!==null?(ce=rn._currentValue,b=b.parent!==ce?{parent:ce,pool:ce}:b):b=us(),Z={baseLanes:Z.baseLanes|c,cachePool:b}),g.memoizedState=Z,g.childLanes=Ff(r,B,c),s.memoizedState=Fd,Gl(r.child,g)):(Sn(s),c=r.child,r=c.sibling,c=ra(c,{mode:"visible",children:g.children}),c.return=s,c.sibling=null,r!==null&&(B=s.deletions,B===null?(s.deletions=[r],s.flags|=16):B.push(r)),s.child=c,s.memoizedState=null,c)}function Nd(r,s){return s=jd({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function jd(r,s){return r=na(22,r,null,s),r.lanes=0,r}function Lh(r,s,c){return cs(s,r.child,null,c),r=Nd(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function jf(r,s,c){r.lanes|=s;var g=r.alternate;g!==null&&(g.lanes|=s),wc(r.return,s,c)}function Bh(r,s,c,g,b,M){var B=r.memoizedState;B===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:g,tail:c,tailMode:b,treeForkCount:M}:(B.isBackwards=s,B.rendering=null,B.renderingStartTime=0,B.last=g,B.tail=c,B.tailMode=b,B.treeForkCount=M)}function Oc(r,s,c){var g=s.pendingProps,b=g.revealOrder,M=g.tail;g=g.children;var B=Mn.current,Z=(B&2)!==0;if(Z?(B=B&1|2,s.flags|=128):B&=1,it(Mn,B),vr(r,s,g,c),g=ri?lo:0,!Z&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&jf(r,c,s);else if(r.tag===19)jf(r,c,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(b){case"forwards":for(c=s.child,b=null;c!==null;)r=c.alternate,r!==null&&Ds(r)===null&&(b=c),c=c.sibling;c=b,c===null?(b=s.child,s.child=null):(b=c.sibling,c.sibling=null),Bh(s,!1,b,c,M,g);break;case"backwards":case"unstable_legacy-backwards":for(c=null,b=s.child,s.child=null;b!==null;){if(r=b.alternate,r!==null&&Ds(r)===null){s.child=b;break}r=b.sibling,b.sibling=c,c=b,b=r}Bh(s,!0,c,null,M,g);break;case"together":Bh(s,!1,null,null,void 0,g);break;default:s.memoizedState=null}return s.child}function Pn(r,s,c){if(r!==null&&(s.dependencies=r.dependencies),fs|=s.lanes,(c&s.childLanes)===0)if(r!==null){if(Ta(r,s,c,!1),(c&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(oe(153));if(s.child!==null){for(r=s.child,c=ra(r,r.pendingProps),s.child=c,c.return=s;r.sibling!==null;)r=r.sibling,c=c.sibling=ra(r,r.pendingProps),c.return=s;c.sibling=null}return s.child}function Vd(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&Pl(r)))}function Vf(r,s,c){switch(s.tag){case 3:ii(s,s.stateNode.containerInfo),Es(s,rn,r.memoizedState.cache),as();break;case 27:case 5:Jn(s);break;case 4:ii(s,s.stateNode.containerInfo);break;case 10:Es(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Rr(s),null;break;case 13:var g=s.memoizedState;if(g!==null)return g.dehydrated!==null?(Sn(s),s.flags|=128,null):(c&s.child.childLanes)!==0?Nf(r,s,c):(Sn(s),r=Pn(r,s,c),r!==null?r.sibling:null);Sn(s);break;case 19:var b=(r.flags&128)!==0;if(g=(c&s.childLanes)!==0,g||(Ta(r,s,c,!1),g=(c&s.childLanes)!==0),b){if(g)return Oc(r,s,c);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),it(Mn,Mn.current),g)break;return null;case 22:return s.lanes=0,qu(r,s,c,s.pendingProps);case 24:Es(s,rn,r.memoizedState.cache)}return Pn(r,s,c)}function Np(r,s,c){if(r!==null)if(r.memoizedProps!==s.pendingProps)jn=!0;else{if(!Vd(r,c)&&(s.flags&128)===0)return jn=!1,Vf(r,s,c);jn=(r.flags&131072)!==0}else jn=!1,ri&&(s.flags&1048576)!==0&&wh(s,lo,s.index);switch(s.lanes=0,s.tag){case 16:e:{var g=s.pendingProps;if(r=oa(s.elementType),s.type=r,typeof r=="function")vc(r)?(g=ca(r,g),s.tag=1,s=Od(null,s,r,g,c)):(s.tag=0,s=Lf(null,s,r,g,c));else{if(r!=null){var b=r.$$typeof;if(b===Dt){s.tag=11,s=Rf(null,s,r,g,c);break e}else if(b===bt){s.tag=14,s=Gu(null,s,r,g,c);break e}}throw s=Kn(r)||r,Error(oe(306,s,""))}}return s;case 0:return Lf(r,s,s.type,s.pendingProps,c);case 1:return g=s.type,b=ca(g,s.pendingProps),Od(r,s,g,b,c);case 3:e:{if(ii(s,s.stateNode.containerInfo),r===null)throw Error(oe(387));g=s.pendingProps;var M=s.memoizedState;b=M.element,Ba(r,s),Ol(s,g,null,c);var B=s.memoizedState;if(g=B.cache,Es(s,rn,g),g!==M.cache&&Tc(s,[rn],c,!0),qo(),g=B.element,M.isDehydrated)if(M={element:g,isDehydrated:!1,cache:B.cache},s.updateQueue.baseState=M,s.memoizedState=M,s.flags&256){s=kf(r,s,g,c);break e}else if(g!==b){b=zr(Error(oe(424)),s),Ss(b),s=kf(r,s,g,c);break e}else{switch(r=s.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(ki=ms(r.firstChild),nr=s,ri=!0,Ts=null,aa=!0,c=Cc(s,null,g,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(as(),g===b){s=Pn(r,s,c);break e}vr(r,s,g,c)}s=s.child}return s;case 26:return kd(r,s),r===null?(c=pf(s.type,null,s.pendingProps,null))?s.memoizedState=c:ri||(c=s.type,r=s.pendingProps,g=rl(ft.current).createElement(c),g[Ui]=s,g[nt]=r,Zn(g,c,r),pn(g),s.stateNode=g):s.memoizedState=pf(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return Jn(s),r===null&&ri&&(g=s.stateNode=pm(s.type,s.pendingProps,ft.current),nr=s,aa=!0,b=ki,vn(s.type)?(df=b,ki=ms(g.firstChild)):ki=b),vr(r,s,s.pendingProps.children,c),kd(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&ri&&((b=g=ki)&&(g=or(g,s.type,s.pendingProps,aa),g!==null?(s.stateNode=g,nr=s,ki=ms(g.firstChild),aa=!1,b=!0):b=!1),b||Vr(s)),Jn(s),b=s.type,M=s.pendingProps,B=r!==null?r.memoizedProps:null,g=M.children,sd(b,M)?g=null:B!==null&&sd(b,B)&&(s.flags|=32),s.memoizedState!==null&&(b=Nl(r,s,Vu,null,null,c),cd._currentValue=b),kd(r,s),vr(r,s,g,c),s.child;case 6:return r===null&&ri&&((r=c=ki)&&(c=lr(c,s.pendingProps,aa),c!==null?(s.stateNode=c,nr=s,ki=null,r=!0):r=!1),r||Vr(s)),null;case 13:return Nf(r,s,c);case 4:return ii(s,s.stateNode.containerInfo),g=s.pendingProps,r===null?s.child=cs(s,null,g,c):vr(r,s,g,c),s.child;case 11:return Rf(r,s,s.type,s.pendingProps,c);case 7:return vr(r,s,s.pendingProps,c),s.child;case 8:return vr(r,s,s.pendingProps.children,c),s.child;case 12:return vr(r,s,s.pendingProps.children,c),s.child;case 10:return g=s.pendingProps,Es(s,s.type,g.value),vr(r,s,g.children,c),s.child;case 9:return b=s.type._context,g=s.pendingProps.children,As(s),b=In(b),g=g(b),s.flags|=1,vr(r,s,g,c),s.child;case 14:return Gu(r,s,s.type,s.pendingProps,c);case 15:return Op(r,s,s.type,s.pendingProps,c);case 19:return Oc(r,s,c);case 31:return km(r,s,c);case 22:return qu(r,s,c,s.pendingProps);case 24:return As(s),g=In(rn),r===null?(b=Ru(),b===null&&(b=Ji,M=uo(),b.pooledCache=M,M.refCount++,M!==null&&(b.pooledCacheLanes|=c),b=M),s.memoizedState={parent:g,cache:b},zc(s),Es(s,rn,b)):((r.lanes&c)!==0&&(Ba(r,s),Ol(s,null,null,c),qo()),b=r.memoizedState,M=s.memoizedState,b.parent!==g?(b={parent:g,cache:g},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),Es(s,rn,g)):(g=M.cache,Es(s,rn,g),g!==b.cache&&Tc(s,[rn],c,!0))),vr(r,s,s.pendingProps.children,c),s.child;case 29:throw s.pendingProps}throw Error(oe(156,s.tag))}function xo(r){r.flags|=4}function Uf(r,s,c,g,b){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(b&335544128)===b)if(r.stateNode.complete)r.flags|=8192;else if(rp())r.flags|=8192;else throw Uo=Bu,Lu}else r.flags&=-16777217}function jp(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!wp(s))if(rp())r.flags|=8192;else throw Uo=Bu,Lu}function kh(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?Si():536870912,r.lanes|=s,Gc|=s)}function Oh(r,s){if(!ri)switch(r.tailMode){case"hidden":s=r.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var g=null;c!==null;)c.alternate!==null&&(g=c),c=c.sibling;g===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:g.sibling=null}}function Ki(r){var s=r.alternate!==null&&r.alternate.child===r.child,c=0,g=0;if(s)for(var b=r.child;b!==null;)c|=b.lanes|b.childLanes,g|=b.subtreeFlags&65011712,g|=b.flags&65011712,b.return=r,b=b.sibling;else for(b=r.child;b!==null;)c|=b.lanes|b.childLanes,g|=b.subtreeFlags,g|=b.flags,b.return=r,b=b.sibling;return r.subtreeFlags|=g,r.childLanes=c,s}function Vp(r,s,c){var g=s.pendingProps;switch(Il(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ki(s),null;case 1:return Ki(s),null;case 3:return c=s.stateNode,g=null,r!==null&&(g=r.memoizedState.cache),s.memoizedState.cache!==g&&(s.flags|=2048),ls(rn),wi(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(rs(s)?xo(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,ss())),Ki(s),null;case 26:var b=s.type,M=s.memoizedState;return r===null?(xo(s),M!==null?(Ki(s),jp(s,M)):(Ki(s),Uf(s,b,null,g,c))):M?M!==r.memoizedState?(xo(s),Ki(s),jp(s,M)):(Ki(s),s.flags&=-16777217):(r=r.memoizedProps,r!==g&&xo(s),Ki(s),Uf(s,b,r,g,c)),null;case 27:if(qs(s),c=ft.current,b=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==g&&xo(s);else{if(!g){if(s.stateNode===null)throw Error(oe(166));return Ki(s),null}r=Qe.current,rs(s)?sa(s):(r=pm(b,g,c),s.stateNode=r,xo(s))}return Ki(s),null;case 5:if(qs(s),b=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==g&&xo(s);else{if(!g){if(s.stateNode===null)throw Error(oe(166));return Ki(s),null}if(M=Qe.current,rs(s))sa(s);else{var B=rl(ft.current);switch(M){case 1:M=B.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:M=B.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":M=B.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":M=B.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":M=B.createElement("div"),M.innerHTML="<script><\/script>",M=M.removeChild(M.firstChild);break;case"select":M=typeof g.is=="string"?B.createElement("select",{is:g.is}):B.createElement("select"),g.multiple?M.multiple=!0:g.size&&(M.size=g.size);break;default:M=typeof g.is=="string"?B.createElement(b,{is:g.is}):B.createElement(b)}}M[Ui]=s,M[nt]=g;e:for(B=s.child;B!==null;){if(B.tag===5||B.tag===6)M.appendChild(B.stateNode);else if(B.tag!==4&&B.tag!==27&&B.child!==null){B.child.return=B,B=B.child;continue}if(B===s)break e;for(;B.sibling===null;){if(B.return===null||B.return===s)break e;B=B.return}B.sibling.return=B.return,B=B.sibling}s.stateNode=M;e:switch(Zn(M,b,g),b){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}g&&xo(s)}}return Ki(s),Uf(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,c),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==g&&xo(s);else{if(typeof g!="string"&&s.stateNode===null)throw Error(oe(166));if(r=ft.current,rs(s)){if(r=s.stateNode,c=s.memoizedProps,g=null,b=nr,b!==null)switch(b.tag){case 27:case 5:g=b.memoizedProps}r[Ui]=s,r=!!(r.nodeValue===c||g!==null&&g.suppressHydrationWarning===!0||af(r.nodeValue,c)),r||Vr(s,!0)}else r=rl(r).createTextNode(g),r[Ui]=s,s.stateNode=r}return Ki(s),null;case 31:if(c=s.memoizedState,r===null||r.memoizedState!==null){if(g=rs(s),c!==null){if(r===null){if(!g)throw Error(oe(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(oe(557));r[Ui]=s}else as(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Ki(s),r=!1}else c=ss(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=c),r=!0;if(!r)return s.flags&256?(Gr(s),s):(Gr(s),null);if((s.flags&128)!==0)throw Error(oe(558))}return Ki(s),null;case 13:if(g=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(b=rs(s),g!==null&&g.dehydrated!==null){if(r===null){if(!b)throw Error(oe(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(oe(317));b[Ui]=s}else as(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Ki(s),b=!1}else b=ss(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?(Gr(s),s):(Gr(s),null)}return Gr(s),(s.flags&128)!==0?(s.lanes=c,s):(c=g!==null,r=r!==null&&r.memoizedState!==null,c&&(g=s.child,b=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(b=g.alternate.memoizedState.cachePool.pool),M=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(M=g.memoizedState.cachePool.pool),M!==b&&(g.flags|=2048)),c!==r&&c&&(s.child.flags|=8192),kh(s,s.updateQueue),Ki(s),null);case 4:return wi(),r===null&&nf(s.stateNode.containerInfo),Ki(s),null;case 10:return ls(s.type),Ki(s),null;case 19:if(Ae(Mn),g=s.memoizedState,g===null)return Ki(s),null;if(b=(s.flags&128)!==0,M=g.rendering,M===null)if(b)Oh(g,!1);else{if(Gn!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(M=Ds(r),M!==null){for(s.flags|=128,Oh(g,!1),r=M.updateQueue,s.updateQueue=r,kh(s,r),s.subtreeFlags=0,r=c,c=s.child;c!==null;)Rd(c,r),c=c.sibling;return it(Mn,Mn.current&1|2),ri&&ws(s,g.treeForkCount),s.child}r=r.sibling}g.tail!==null&&er()>Zh&&(s.flags|=128,b=!0,Oh(g,!1),s.lanes=4194304)}else{if(!b)if(r=Ds(M),r!==null){if(s.flags|=128,b=!0,r=r.updateQueue,s.updateQueue=r,kh(s,r),Oh(g,!0),g.tail===null&&g.tailMode==="hidden"&&!M.alternate&&!ri)return Ki(s),null}else 2*er()-g.renderingStartTime>Zh&&c!==536870912&&(s.flags|=128,b=!0,Oh(g,!1),s.lanes=4194304);g.isBackwards?(M.sibling=s.child,s.child=M):(r=g.last,r!==null?r.sibling=M:s.child=M,g.last=M)}return g.tail!==null?(r=g.tail,g.rendering=r,g.tail=r.sibling,g.renderingStartTime=er(),r.sibling=null,c=Mn.current,it(Mn,b?c&1|2:c&1),ri&&ws(s,g.treeForkCount),r):(Ki(s),null);case 22:case 23:return Gr(s),go(),g=s.memoizedState!==null,r!==null?r.memoizedState!==null!==g&&(s.flags|=8192):g&&(s.flags|=8192),g?(c&536870912)!==0&&(s.flags&128)===0&&(Ki(s),s.subtreeFlags&6&&(s.flags|=8192)):Ki(s),c=s.updateQueue,c!==null&&kh(s,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),g=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),g!==c&&(s.flags|=2048),r!==null&&Ae(La),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),s.memoizedState.cache!==c&&(s.flags|=2048),ls(rn),Ki(s),null;case 25:return null;case 30:return null}throw Error(oe(156,s.tag))}function Up(r,s){switch(Il(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return ls(rn),wi(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return qs(s),null;case 31:if(s.memoizedState!==null){if(Gr(s),s.alternate===null)throw Error(oe(340));as()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(Gr(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(oe(340));as()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return Ae(Mn),null;case 4:return wi(),null;case 10:return ls(s.type),null;case 22:case 23:return Gr(s),go(),r!==null&&Ae(La),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return ls(rn),null;case 25:return null;default:return null}}function Gp(r,s){switch(Il(s),s.tag){case 3:ls(rn),wi();break;case 26:case 27:case 5:qs(s);break;case 4:wi();break;case 31:s.memoizedState!==null&&Gr(s);break;case 13:Gr(s);break;case 19:Ae(Mn);break;case 10:ls(s.type);break;case 22:case 23:Gr(s),go(),r!==null&&Ae(La);break;case 24:ls(rn)}}function Fh(r,s){try{var c=s.updateQueue,g=c!==null?c.lastEffect:null;if(g!==null){var b=g.next;c=b;do{if((c.tag&r)===r){g=void 0;var M=c.create,B=c.inst;g=M(),B.destroy=g}c=c.next}while(c!==b)}}catch(Z){Ii(s,s.return,Z)}}function ql(r,s,c){try{var g=s.updateQueue,b=g!==null?g.lastEffect:null;if(b!==null){var M=b.next;g=M;do{if((g.tag&r)===r){var B=g.inst,Z=B.destroy;if(Z!==void 0){B.destroy=void 0,b=s;var ce=c,Ie=Z;try{Ie()}catch(Ge){Ii(b,ce,Ge)}}}g=g.next}while(g!==M)}}catch(Ge){Ii(s,s.return,Ge)}}function Nh(r){var s=r.updateQueue;if(s!==null){var c=r.stateNode;try{Ah(s,c)}catch(g){Ii(r,r.return,g)}}}function Ud(r,s,c){c.props=ca(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(g){Ii(r,s,g)}}function Fc(r,s){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var g=r.stateNode;break;case 30:g=r.stateNode;break;default:g=r.stateNode}typeof c=="function"?r.refCleanup=c(g):c.current=g}}catch(b){Ii(r,s,b)}}function Zr(r,s){var c=r.ref,g=r.refCleanup;if(c!==null)if(typeof g=="function")try{g()}catch(b){Ii(r,s,b)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(b){Ii(r,s,b)}else c.current=null}function Nc(r){var s=r.type,c=r.memoizedProps,g=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":c.autoFocus&&g.focus();break e;case"img":c.src?g.src=c.src:c.srcSet&&(g.srcset=c.srcSet)}}catch(b){Ii(r,r.return,b)}}function Gf(r,s,c){try{var g=r.stateNode;rd(g,r.type,c,s),g[nt]=s}catch(b){Ii(r,r.return,b)}}function qp(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&vn(r.type)||r.tag===4}function qf(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||qp(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&vn(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Zf(r,s,c){var g=r.tag;if(g===5||g===6)r=r.stateNode,s?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,s):(s=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,s.appendChild(r),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=Pa));else if(g!==4&&(g===27&&vn(r.type)&&(c=r.stateNode,s=null),r=r.child,r!==null))for(Zf(r,s,c),r=r.sibling;r!==null;)Zf(r,s,c),r=r.sibling}function Gd(r,s,c){var g=r.tag;if(g===5||g===6)r=r.stateNode,s?c.insertBefore(r,s):c.appendChild(r);else if(g!==4&&(g===27&&vn(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(Gd(r,s,c),r=r.sibling;r!==null;)Gd(r,s,c),r=r.sibling}function Zp(r){var s=r.stateNode,c=r.memoizedProps;try{for(var g=r.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);Zn(s,g,c),s[Ui]=r,s[nt]=c}catch(M){Ii(r,r.return,M)}}var Qo=!1,Vn=!1,Hf=!1,$f=typeof WeakSet=="function"?WeakSet:Set,Un=null;function Om(r,s){if(r=r.containerInfo,sf=rh,r=fc(r),wu(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var g=c.getSelection&&c.getSelection();if(g&&g.rangeCount!==0){c=g.anchorNode;var b=g.anchorOffset,M=g.focusNode;g=g.focusOffset;try{c.nodeType,M.nodeType}catch{c=null;break e}var B=0,Z=-1,ce=-1,Ie=0,Ge=0,We=r,Pe=null;t:for(;;){for(var Oe;We!==c||b!==0&&We.nodeType!==3||(Z=B+b),We!==M||g!==0&&We.nodeType!==3||(ce=B+g),We.nodeType===3&&(B+=We.nodeValue.length),(Oe=We.firstChild)!==null;)Pe=We,We=Oe;for(;;){if(We===r)break t;if(Pe===c&&++Ie===b&&(Z=B),Pe===M&&++Ge===g&&(ce=B),(Oe=We.nextSibling)!==null)break;We=Pe,Pe=We.parentNode}We=Oe}c=Z===-1||ce===-1?null:{start:Z,end:ce}}else c=null}c=c||{start:0,end:0}}else c=null;for(of={focusedElem:r,selectionRange:c},rh=!1,Un=s;Un!==null;)if(s=Un,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,Un=r;else for(;Un!==null;){switch(s=Un,M=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(c=0;c<r.length;c++)b=r[c],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&M!==null){r=void 0,c=s,b=M.memoizedProps,M=M.memoizedState,g=c.stateNode;try{var At=ca(c.type,b);r=g.getSnapshotBeforeUpdate(At,M),g.__reactInternalSnapshotBeforeUpdate=r}catch(Nt){Ii(c,c.return,Nt)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,c=r.nodeType,c===9)Hr(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Hr(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(oe(163))}if(r=s.sibling,r!==null){r.return=s.return,Un=r;break}Un=s.return}}function En(r,s,c){var g=c.flags;switch(c.tag){case 0:case 11:case 15:bo(r,c),g&4&&Fh(5,c);break;case 1:if(bo(r,c),g&4)if(r=c.stateNode,s===null)try{r.componentDidMount()}catch(B){Ii(c,c.return,B)}else{var b=ca(c.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(b,s,r.__reactInternalSnapshotBeforeUpdate)}catch(B){Ii(c,c.return,B)}}g&64&&Nh(c),g&512&&Fc(c,c.return);break;case 3:if(bo(r,c),g&64&&(r=c.updateQueue,r!==null)){if(s=null,c.child!==null)switch(c.child.tag){case 27:case 5:s=c.child.stateNode;break;case 1:s=c.child.stateNode}try{Ah(r,s)}catch(B){Ii(c,c.return,B)}}break;case 27:s===null&&g&4&&Zp(c);case 26:case 5:bo(r,c),s===null&&g&4&&Nc(c),g&512&&Fc(c,c.return);break;case 12:bo(r,c);break;case 31:bo(r,c),g&4&&Xf(r,c);break;case 13:bo(r,c),g&4&&Yf(r,c),g&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=qm.bind(null,c),hf(r,c))));break;case 22:if(g=c.memoizedState!==null||Qo,!g){s=s!==null&&s.memoizedState!==null||Vn,b=Qo;var M=Vn;Qo=g,(Vn=s)&&!M?Ko(r,c,(c.subtreeFlags&8772)!==0):bo(r,c),Qo=b,Vn=M}break;case 30:break;default:bo(r,c)}}function Zu(r){var s=r.alternate;s!==null&&(r.alternate=null,Zu(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&Mo(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var yn=null,Br=!1;function ds(r,s,c){for(c=c.child;c!==null;)jc(r,s,c),c=c.sibling}function jc(r,s,c){if(he&&typeof he.onCommitFiberUnmount=="function")try{he.onCommitFiberUnmount(_e,c)}catch{}switch(c.tag){case 26:Vn||Zr(c,s),ds(r,s,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:Vn||Zr(c,s);var g=yn,b=Br;vn(c.type)&&(yn=c.stateNode,Br=!1),ds(r,s,c),Qc(c.stateNode),yn=g,Br=b;break;case 5:Vn||Zr(c,s);case 6:if(g=yn,b=Br,yn=null,ds(r,s,c),yn=g,Br=b,yn!==null)if(Br)try{(yn.nodeType===9?yn.body:yn.nodeName==="HTML"?yn.ownerDocument.body:yn).removeChild(c.stateNode)}catch(M){Ii(c,s,M)}else try{yn.removeChild(c.stateNode)}catch(M){Ii(c,s,M)}break;case 18:yn!==null&&(Br?(r=yn,ps(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),oh(r)):ps(yn,c.stateNode));break;case 4:g=yn,b=Br,yn=c.stateNode.containerInfo,Br=!0,ds(r,s,c),yn=g,Br=b;break;case 0:case 11:case 14:case 15:ql(2,c,s),Vn||ql(4,c,s),ds(r,s,c);break;case 1:Vn||(Zr(c,s),g=c.stateNode,typeof g.componentWillUnmount=="function"&&Ud(c,s,g)),ds(r,s,c);break;case 21:ds(r,s,c);break;case 22:Vn=(g=Vn)||c.memoizedState!==null,ds(r,s,c),Vn=g;break;default:ds(r,s,c)}}function Xf(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{oh(r)}catch(c){Ii(s,s.return,c)}}}function Yf(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{oh(r)}catch(c){Ii(s,s.return,c)}}function jh(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new $f),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new $f),s;default:throw Error(oe(435,r.tag))}}function Vc(r,s){var c=jh(r);s.forEach(function(g){if(!c.has(g)){c.add(g);var b=Zm.bind(null,r,g);g.then(b,b)}})}function fr(r,s){var c=s.deletions;if(c!==null)for(var g=0;g<c.length;g++){var b=c[g],M=r,B=s,Z=B;e:for(;Z!==null;){switch(Z.tag){case 27:if(vn(Z.type)){yn=Z.stateNode,Br=!1;break e}break;case 5:yn=Z.stateNode,Br=!1;break e;case 3:case 4:yn=Z.stateNode.containerInfo,Br=!0;break e}Z=Z.return}if(yn===null)throw Error(oe(160));jc(M,B,b),yn=null,Br=!1,M=b.alternate,M!==null&&(M.return=null),b.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Hu(s,r),s=s.sibling}var Ma=null;function Hu(r,s){var c=r.alternate,g=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:fr(s,r),xr(r),g&4&&(ql(3,r,r.return),Fh(3,r),ql(5,r,r.return));break;case 1:fr(s,r),xr(r),g&512&&(Vn||c===null||Zr(c,c.return)),g&64&&Qo&&(r=r.updateQueue,r!==null&&(g=r.callbacks,g!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?g:c.concat(g))));break;case 26:var b=Ma;if(fr(s,r),xr(r),g&512&&(Vn||c===null||Zr(c,c.return)),g&4){var M=c!==null?c.memoizedState:null;if(g=r.memoizedState,c===null)if(g===null)if(r.stateNode===null){e:{g=r.type,c=r.memoizedProps,b=b.ownerDocument||b;t:switch(g){case"title":M=b.getElementsByTagName("title")[0],(!M||M[Gt]||M[Ui]||M.namespaceURI==="http://www.w3.org/2000/svg"||M.hasAttribute("itemprop"))&&(M=b.createElement(g),b.head.insertBefore(M,b.querySelector("head > title"))),Zn(M,g,c),M[Ui]=r,pn(M),g=M;break e;case"link":var B=mf("link","href",b).get(g+(c.href||""));if(B){for(var Z=0;Z<B.length;Z++)if(M=B[Z],M.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&M.getAttribute("rel")===(c.rel==null?null:c.rel)&&M.getAttribute("title")===(c.title==null?null:c.title)&&M.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){B.splice(Z,1);break t}}M=b.createElement(g),Zn(M,g,c),b.head.appendChild(M);break;case"meta":if(B=mf("meta","content",b).get(g+(c.content||""))){for(Z=0;Z<B.length;Z++)if(M=B[Z],M.getAttribute("content")===(c.content==null?null:""+c.content)&&M.getAttribute("name")===(c.name==null?null:c.name)&&M.getAttribute("property")===(c.property==null?null:c.property)&&M.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&M.getAttribute("charset")===(c.charSet==null?null:c.charSet)){B.splice(Z,1);break t}}M=b.createElement(g),Zn(M,g,c),b.head.appendChild(M);break;default:throw Error(oe(468,g))}M[Ui]=r,pn(M),g=M}r.stateNode=g}else gf(b,r.type,r.stateNode);else r.stateNode=vm(b,g,r.memoizedProps);else M!==g?(M===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):M.count--,g===null?gf(b,r.type,r.stateNode):vm(b,g,r.memoizedProps)):g===null&&r.stateNode!==null&&Gf(r,r.memoizedProps,c.memoizedProps)}break;case 27:fr(s,r),xr(r),g&512&&(Vn||c===null||Zr(c,c.return)),c!==null&&g&4&&Gf(r,r.memoizedProps,c.memoizedProps);break;case 5:if(fr(s,r),xr(r),g&512&&(Vn||c===null||Zr(c,c.return)),r.flags&32){b=r.stateNode;try{xs(b,"")}catch(At){Ii(r,r.return,At)}}g&4&&r.stateNode!=null&&(b=r.memoizedProps,Gf(r,b,c!==null?c.memoizedProps:b)),g&1024&&(Hf=!0);break;case 6:if(fr(s,r),xr(r),g&4){if(r.stateNode===null)throw Error(oe(162));g=r.memoizedProps,c=r.stateNode;try{c.nodeValue=g}catch(At){Ii(r,r.return,At)}}break;case 3:if(Ju=null,b=Ma,Ma=Kc(s.containerInfo),fr(s,r),Ma=b,xr(r),g&4&&c!==null&&c.memoizedState.isDehydrated)try{oh(s.containerInfo)}catch(At){Ii(r,r.return,At)}Hf&&(Hf=!1,Hp(r));break;case 4:g=Ma,Ma=Kc(r.stateNode.containerInfo),fr(s,r),xr(r),Ma=g;break;case 12:fr(s,r),xr(r);break;case 31:fr(s,r),xr(r),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,Vc(r,g)));break;case 13:fr(s,r),xr(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(qc=er()),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,Vc(r,g)));break;case 22:b=r.memoizedState!==null;var ce=c!==null&&c.memoizedState!==null,Ie=Qo,Ge=Vn;if(Qo=Ie||b,Vn=Ge||ce,fr(s,r),Vn=Ge,Qo=Ie,xr(r),g&8192)e:for(s=r.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(c===null||ce||Qo||Vn||Na(r)),c=null,s=r;;){if(s.tag===5||s.tag===26){if(c===null){ce=c=s;try{if(M=ce.stateNode,b)B=M.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none";else{Z=ce.stateNode;var We=ce.memoizedProps.style,Pe=We!=null&&We.hasOwnProperty("display")?We.display:null;Z.style.display=Pe==null||typeof Pe=="boolean"?"":(""+Pe).trim()}}catch(At){Ii(ce,ce.return,At)}}}else if(s.tag===6){if(c===null){ce=s;try{ce.stateNode.nodeValue=b?"":ce.memoizedProps}catch(At){Ii(ce,ce.return,At)}}}else if(s.tag===18){if(c===null){ce=s;try{var Oe=ce.stateNode;b?Ql(Oe,!0):Ql(ce.stateNode,!1)}catch(At){Ii(ce,ce.return,At)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;c===s&&(c=null),s=s.return}c===s&&(c=null),s.sibling.return=s.return,s=s.sibling}g&4&&(g=r.updateQueue,g!==null&&(c=g.retryQueue,c!==null&&(g.retryQueue=null,Vc(r,c))));break;case 19:fr(s,r),xr(r),g&4&&(g=r.updateQueue,g!==null&&(r.updateQueue=null,Vc(r,g)));break;case 30:break;case 21:break;default:fr(s,r),xr(r)}}function xr(r){var s=r.flags;if(s&2){try{for(var c,g=r.return;g!==null;){if(qp(g)){c=g;break}g=g.return}if(c==null)throw Error(oe(160));switch(c.tag){case 27:var b=c.stateNode,M=qf(r);Gd(r,M,b);break;case 5:var B=c.stateNode;c.flags&32&&(xs(B,""),c.flags&=-33);var Z=qf(r);Gd(r,Z,B);break;case 3:case 4:var ce=c.stateNode.containerInfo,Ie=qf(r);Zf(r,Ie,ce);break;default:throw Error(oe(161))}}catch(Ge){Ii(r,r.return,Ge)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function Hp(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;Hp(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function bo(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)En(r,s.alternate,s),s=s.sibling}function Na(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:ql(4,s,s.return),Na(s);break;case 1:Zr(s,s.return);var c=s.stateNode;typeof c.componentWillUnmount=="function"&&Ud(s,s.return,c),Na(s);break;case 27:Qc(s.stateNode);case 26:case 5:Zr(s,s.return),Na(s);break;case 22:s.memoizedState===null&&Na(s);break;case 30:Na(s);break;default:Na(s)}r=r.sibling}}function Ko(r,s,c){for(c=c&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var g=s.alternate,b=r,M=s,B=M.flags;switch(M.tag){case 0:case 11:case 15:Ko(b,M,c),Fh(4,M);break;case 1:if(Ko(b,M,c),g=M,b=g.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Ie){Ii(g,g.return,Ie)}if(g=M,b=g.updateQueue,b!==null){var Z=g.stateNode;try{var ce=b.shared.hiddenCallbacks;if(ce!==null)for(b.shared.hiddenCallbacks=null,b=0;b<ce.length;b++)Dc(ce[b],Z)}catch(Ie){Ii(g,g.return,Ie)}}c&&B&64&&Nh(M),Fc(M,M.return);break;case 27:Zp(M);case 26:case 5:Ko(b,M,c),c&&g===null&&B&4&&Nc(M),Fc(M,M.return);break;case 12:Ko(b,M,c);break;case 31:Ko(b,M,c),c&&B&4&&Xf(b,M);break;case 13:Ko(b,M,c),c&&B&4&&Yf(b,M);break;case 22:M.memoizedState===null&&Ko(b,M,c),Fc(M,M.return);break;case 30:break;default:Ko(b,M,c)}s=s.sibling}}function qd(r,s){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&_r(c))}function $u(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&_r(r))}function ja(r,s,c,g){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Wf(r,s,c,g),s=s.sibling}function Wf(r,s,c,g){var b=s.flags;switch(s.tag){case 0:case 11:case 15:ja(r,s,c,g),b&2048&&Fh(9,s);break;case 1:ja(r,s,c,g);break;case 3:ja(r,s,c,g),b&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&_r(r)));break;case 12:if(b&2048){ja(r,s,c,g),r=s.stateNode;try{var M=s.memoizedProps,B=M.id,Z=M.onPostCommit;typeof Z=="function"&&Z(B,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(ce){Ii(s,s.return,ce)}}else ja(r,s,c,g);break;case 31:ja(r,s,c,g);break;case 13:ja(r,s,c,g);break;case 23:break;case 22:M=s.stateNode,B=s.alternate,s.memoizedState!==null?M._visibility&2?ja(r,s,c,g):Vh(r,s):M._visibility&2?ja(r,s,c,g):(M._visibility|=2,Xu(r,s,c,g,(s.subtreeFlags&10256)!==0||!1)),b&2048&&qd(B,s);break;case 24:ja(r,s,c,g),b&2048&&$u(s.alternate,s);break;default:ja(r,s,c,g)}}function Xu(r,s,c,g,b){for(b=b&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var M=r,B=s,Z=c,ce=g,Ie=B.flags;switch(B.tag){case 0:case 11:case 15:Xu(M,B,Z,ce,b),Fh(8,B);break;case 23:break;case 22:var Ge=B.stateNode;B.memoizedState!==null?Ge._visibility&2?Xu(M,B,Z,ce,b):Vh(M,B):(Ge._visibility|=2,Xu(M,B,Z,ce,b)),b&&Ie&2048&&qd(B.alternate,B);break;case 24:Xu(M,B,Z,ce,b),b&&Ie&2048&&$u(B.alternate,B);break;default:Xu(M,B,Z,ce,b)}s=s.sibling}}function Vh(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var c=r,g=s,b=g.flags;switch(g.tag){case 22:Vh(c,g),b&2048&&qd(g.alternate,g);break;case 24:Vh(c,g),b&2048&&$u(g.alternate,g);break;default:Vh(c,g)}s=s.sibling}}var Uh=8192;function Uc(r,s,c){if(r.subtreeFlags&Uh)for(r=r.child;r!==null;)$p(r,s,c),r=r.sibling}function $p(r,s,c){switch(r.tag){case 26:Uc(r,s,c),r.flags&Uh&&r.memoizedState!==null&&xm(c,Ma,r.memoizedState,r.memoizedProps);break;case 5:Uc(r,s,c);break;case 3:case 4:var g=Ma;Ma=Kc(r.stateNode.containerInfo),Uc(r,s,c),Ma=g;break;case 22:r.memoizedState===null&&(g=r.alternate,g!==null&&g.memoizedState!==null?(g=Uh,Uh=16777216,Uc(r,s,c),Uh=g):Uc(r,s,c));break;default:Uc(r,s,c)}}function Xp(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function Jo(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];Un=g,Wp(g,r)}Xp(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Yp(r),r=r.sibling}function Yp(r){switch(r.tag){case 0:case 11:case 15:Jo(r),r.flags&2048&&ql(9,r,r.return);break;case 3:Jo(r);break;case 12:Jo(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,Gh(r)):Jo(r);break;default:Jo(r)}}function Gh(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var c=0;c<s.length;c++){var g=s[c];Un=g,Wp(g,r)}Xp(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:ql(8,s,s.return),Gh(s);break;case 22:c=s.stateNode,c._visibility&2&&(c._visibility&=-3,Gh(s));break;default:Gh(s)}r=r.sibling}}function Wp(r,s){for(;Un!==null;){var c=Un;switch(c.tag){case 0:case 11:case 15:ql(8,c,s);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var g=c.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:_r(c.memoizedState.cache)}if(g=c.child,g!==null)g.return=c,Un=g;else e:for(c=r;Un!==null;){g=Un;var b=g.sibling,M=g.return;if(Zu(g),g===c){Un=null;break e}if(b!==null){b.return=M,Un=b;break e}Un=M}}}var Fm={getCacheForType:function(r){var s=In(rn),c=s.data.get(r);return c===void 0&&(c=r(),s.data.set(r,c)),c},cacheSignal:function(){return In(rn).controller.signal}},Nm=typeof WeakMap=="function"?WeakMap:Map,zi=0,Ji=null,oi=null,ai=0,Ni=0,Va=null,Zl=!1,Yu=!1,Zd=!1,el=0,Gn=0,fs=0,Hl=0,Qf=0,Ua=0,Gc=0,qh=null,Ea=null,Hd=!1,qc=0,Kf=0,Zh=1/0,Hh=null,$l=null,qn=0,Xl=null,Wu=null,tl=0,Jf=0,ep=null,tp=null,$h=0,ip=null;function Di(){return(zi&2)!==0&&ai!==0?ai&-ai:Ve.T!==null?Wl():pr()}function Zc(){if(Ua===0)if((ai&536870912)===0||ri){var r=yi;yi<<=1,(yi&3932160)===0&&(yi=262144),Ua=r}else Ua=536870912;return r=Pr.current,r!==null&&(r.flags|=32),Ua}function Aa(r,s,c){(r===Ji&&(Ni===2||Ni===9)||r.cancelPendingCommit!==null)&&(Fs(r,0),Yl(r,ai,Ua,!1)),Ei(r,c),((zi&2)===0||r!==Ji)&&(r===Ji&&((zi&2)===0&&(Hl|=c),Gn===4&&Yl(r,ai,Ua,!1)),js(r))}function Qp(r,s,c){if((zi&6)!==0)throw Error(oe(327));var g=!c&&(s&127)===0&&(s&r.expiredLanes)===0||Cn(r,s),b=g?Vm(r,s):Yd(r,s,!0),M=g;do{if(b===0){Yu&&!g&&Yl(r,s,0,!1);break}else{if(c=r.current.alternate,M&&!Kp(c)){b=Yd(r,s,!1),M=!1;continue}if(b===2){if(M=s,r.errorRecoveryDisabledLanes&M)var B=0;else B=r.pendingLanes&-536870913,B=B!==0?B:B&536870912?536870912:0;if(B!==0){s=B;e:{var Z=r;b=qh;var ce=Z.current.memoizedState.isDehydrated;if(ce&&(Fs(Z,B).flags|=256),B=Yd(Z,B,!1),B!==2){if(Zd&&!ce){Z.errorRecoveryDisabledLanes|=M,Hl|=M,b=4;break e}M=Ea,Ea=b,M!==null&&(Ea===null?Ea=M:Ea.push.apply(Ea,M))}b=B}if(M=!1,b!==2)continue}}if(b===1){Fs(r,0),Yl(r,s,0,!0);break}e:{switch(g=r,M=b,M){case 0:case 1:throw Error(oe(345));case 4:if((s&4194048)!==s)break;case 6:Yl(g,s,Ua,!Zl);break e;case 2:Ea=null;break;case 3:case 5:break;default:throw Error(oe(329))}if((s&62914560)===s&&(b=qc+300-er(),10<b)){if(Yl(g,s,Ua,!Zl),Ti(g,0,!0)!==0)break e;tl=s,g.timeoutHandle=cf(np.bind(null,g,c,Ea,Hh,Hd,s,Ua,Hl,Gc,Zl,M,"Throttled",-0,0),b);break e}np(g,c,Ea,Hh,Hd,s,Ua,Hl,Gc,Zl,M,null,-0,0)}}break}while(!0);js(r)}function np(r,s,c,g,b,M,B,Z,ce,Ie,Ge,We,Pe,Oe){if(r.timeoutHandle=-1,We=s.subtreeFlags,We&8192||(We&16785408)===16785408){We={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Pa},$p(s,M,We);var At=(M&62914560)===M?qc-er():(M&4194048)===M?Kf-er():0;if(At=bm(We,At),At!==null){tl=M,r.cancelPendingCommit=At(im.bind(null,r,s,M,c,g,b,B,Z,ce,Ge,We,null,Pe,Oe)),Yl(r,M,B,!Ie);return}}im(r,s,M,c,g,b,B,Z,ce)}function Kp(r){for(var s=r;;){var c=s.tag;if((c===0||c===11||c===15)&&s.flags&16384&&(c=s.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var g=0;g<c.length;g++){var b=c[g],M=b.getSnapshot;b=b.value;try{if(!Nr(M(),b))return!1}catch{return!1}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Yl(r,s,c,g){s&=~Qf,s&=~Hl,r.suspendedLanes|=s,r.pingedLanes&=~s,g&&(r.warmLanes|=s),g=r.expirationTimes;for(var b=s;0<b;){var M=31-je(b),B=1<<M;g[M]=-1,b&=~B}c!==0&&Li(r,c,s)}function Xh(){return(zi&6)===0?(Qu(0),!1):!0}function $d(){if(oi!==null){if(Ni===0)var r=oi.return;else r=oi,os=wa=null,Bs(r),Sa=null,ku=0,r=oi;for(;r!==null;)Gp(r.alternate,r),r=r.return;oi=null}}function Fs(r,s){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,Wm(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),tl=0,$d(),Ji=r,oi=c=ra(r.current,null),ai=s,Ni=0,Va=null,Zl=!1,Yu=Cn(r,s),Zd=!1,Gc=Ua=Qf=Hl=fs=Gn=0,Ea=qh=null,Hd=!1,(s&8)!==0&&(s|=s&32);var g=r.entangledLanes;if(g!==0)for(r=r.entanglements,g&=s;0<g;){var b=31-je(g),M=1<<b;s|=r[b],g&=~M}return el=s,No(),c}function Xd(r,s){zt=null,Ve.H=ln,s===lt||s===ho?(s=Ec(),Ni=3):s===Lu?(s=Ec(),Ni=4):Ni=s===Pf?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Va=s,oi===null&&(Gn=1,Wo(r,zr(s,r.current)))}function rp(){var r=Pr.current;return r===null?!0:(ai&4194048)===ai?rr===null:(ai&62914560)===ai||(ai&536870912)!==0?r===rr:!1}function ap(){var r=Ve.H;return Ve.H=ln,r===null?ln:r}function Yh(){var r=Ve.A;return Ve.A=Fm,r}function il(){Gn=4,Zl||(ai&4194048)!==ai&&Pr.current!==null||(Yu=!0),(fs&134217727)===0&&(Hl&134217727)===0||Ji===null||Yl(Ji,ai,Ua,!1)}function Yd(r,s,c){var g=zi;zi|=2;var b=ap(),M=Yh();(Ji!==r||ai!==s)&&(Hh=null,Fs(r,s)),s=!1;var B=Gn;e:do try{if(Ni!==0&&oi!==null){var Z=oi,ce=Va;switch(Ni){case 8:$d(),B=6;break e;case 3:case 2:case 9:case 6:Pr.current===null&&(s=!0);var Ie=Ni;if(Ni=0,Va=null,Hc(r,Z,ce,Ie),c&&Yu){B=0;break e}break;default:Ie=Ni,Ni=0,Va=null,Hc(r,Z,ce,Ie)}}jm(),B=Gn;break}catch(Ge){Xd(r,Ge)}while(!0);return s&&r.shellSuspendCounter++,os=wa=null,zi=g,Ve.H=b,Ve.A=M,oi===null&&(Ji=null,ai=0,No()),B}function jm(){for(;oi!==null;)Jp(oi)}function Vm(r,s){var c=zi;zi|=2;var g=ap(),b=Yh();Ji!==r||ai!==s?(Hh=null,Zh=er()+500,Fs(r,s)):Yu=Cn(r,s);e:do try{if(Ni!==0&&oi!==null){s=oi;var M=Va;t:switch(Ni){case 1:Ni=0,Va=null,Hc(r,s,M,1);break;case 2:case 9:if(fo(M)){Ni=0,Va=null,em(s);break}s=function(){Ni!==2&&Ni!==9||Ji!==r||(Ni=7),js(r)},M.then(s,s);break e;case 3:Ni=7;break e;case 4:Ni=5;break e;case 7:fo(M)?(Ni=0,Va=null,em(s)):(Ni=0,Va=null,Hc(r,s,M,7));break;case 5:var B=null;switch(oi.tag){case 26:B=oi.memoizedState;case 5:case 27:var Z=oi;if(B?wp(B):Z.stateNode.complete){Ni=0,Va=null;var ce=Z.sibling;if(ce!==null)oi=ce;else{var Ie=Z.return;Ie!==null?(oi=Ie,Wd(Ie)):oi=null}break t}}Ni=0,Va=null,Hc(r,s,M,5);break;case 6:Ni=0,Va=null,Hc(r,s,M,6);break;case 8:$d(),Gn=6;break e;default:throw Error(oe(462))}}Um();break}catch(Ge){Xd(r,Ge)}while(!0);return os=wa=null,Ve.H=g,Ve.A=b,zi=c,oi!==null?0:(Ji=null,ai=0,No(),Gn)}function Um(){for(;oi!==null&&!za();)Jp(oi)}function Jp(r){var s=Np(r.alternate,r,el);r.memoizedProps=r.pendingProps,s===null?Wd(r):oi=s}function em(r){var s=r,c=s.alternate;switch(s.tag){case 15:case 0:s=Bf(c,s,s.pendingProps,s.type,void 0,ai);break;case 11:s=Bf(c,s,s.pendingProps,s.type.render,s.ref,ai);break;case 5:Bs(s);default:Gp(c,s),s=oi=Rd(s,el),s=Np(c,s,el)}r.memoizedProps=r.pendingProps,s===null?Wd(r):oi=s}function Hc(r,s,c,g){os=wa=null,Bs(s),Sa=null,ku=0;var b=s.return;try{if(If(r,b,s,c,ai)){Gn=1,Wo(r,zr(c,r.current)),oi=null;return}}catch(M){if(b!==null)throw oi=b,M;Gn=1,Wo(r,zr(c,r.current)),oi=null;return}s.flags&32768?(ri||g===1?r=!0:Yu||(ai&536870912)!==0?r=!1:(Zl=r=!0,(g===2||g===9||g===3||g===6)&&(g=Pr.current,g!==null&&g.tag===13&&(g.flags|=16384))),tm(s,r)):Wd(s)}function Wd(r){var s=r;do{if((s.flags&32768)!==0){tm(s,Zl);return}r=s.return;var c=Vp(s.alternate,s,el);if(c!==null){oi=c;return}if(s=s.sibling,s!==null){oi=s;return}oi=s=r}while(s!==null);Gn===0&&(Gn=5)}function tm(r,s){do{var c=Up(r.alternate,r);if(c!==null){c.flags&=32767,oi=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!s&&(r=r.sibling,r!==null)){oi=r;return}oi=r=c}while(r!==null);Gn=6,oi=null}function im(r,s,c,g,b,M,B,Z,ce){r.cancelPendingCommit=null;do $c();while(qn!==0);if((zi&6)!==0)throw Error(oe(327));if(s!==null){if(s===r.current)throw Error(oe(177));if(M=s.lanes|s.childLanes,M|=Fo,wn(r,c,M,B,Z,ce),r===Ji&&(oi=Ji=null,ai=0),Wu=s,Xl=r,tl=c,Jf=M,ep=b,tp=g,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,Hm(j,function(){return op(),null})):(r.callbackNode=null,r.callbackPriority=0),g=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||g){g=Ve.T,Ve.T=null,b=st.p,st.p=2,B=zi,zi|=4;try{Om(r,s,c)}finally{zi=B,st.p=b,Ve.T=g}}qn=1,nm(),rm(),am()}}function nm(){if(qn===1){qn=0;var r=Xl,s=Wu,c=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||c){c=Ve.T,Ve.T=null;var g=st.p;st.p=2;var b=zi;zi|=4;try{Hu(s,r);var M=of,B=fc(r.containerInfo),Z=M.focusedElem,ce=M.selectionRange;if(B!==Z&&Z&&Z.ownerDocument&&dc(Z.ownerDocument.documentElement,Z)){if(ce!==null&&wu(Z)){var Ie=ce.start,Ge=ce.end;if(Ge===void 0&&(Ge=Ie),"selectionStart"in Z)Z.selectionStart=Ie,Z.selectionEnd=Math.min(Ge,Z.value.length);else{var We=Z.ownerDocument||document,Pe=We&&We.defaultView||window;if(Pe.getSelection){var Oe=Pe.getSelection(),At=Z.textContent.length,Nt=Math.min(ce.start,At),ji=ce.end===void 0?Nt:Math.min(ce.end,At);!Oe.extend&&Nt>ji&&(B=ji,ji=Nt,Nt=B);var ye=bu(Z,Nt),pe=bu(Z,ji);if(ye&&pe&&(Oe.rangeCount!==1||Oe.anchorNode!==ye.node||Oe.anchorOffset!==ye.offset||Oe.focusNode!==pe.node||Oe.focusOffset!==pe.offset)){var De=We.createRange();De.setStart(ye.node,ye.offset),Oe.removeAllRanges(),Nt>ji?(Oe.addRange(De),Oe.extend(pe.node,pe.offset)):(De.setEnd(pe.node,pe.offset),Oe.addRange(De))}}}}for(We=[],Oe=Z;Oe=Oe.parentNode;)Oe.nodeType===1&&We.push({element:Oe,left:Oe.scrollLeft,top:Oe.scrollTop});for(typeof Z.focus=="function"&&Z.focus(),Z=0;Z<We.length;Z++){var Ze=We[Z];Ze.element.scrollLeft=Ze.left,Ze.element.scrollTop=Ze.top}}rh=!!sf,of=sf=null}finally{zi=b,st.p=g,Ve.T=c}}r.current=s,qn=2}}function rm(){if(qn===2){qn=0;var r=Xl,s=Wu,c=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||c){c=Ve.T,Ve.T=null;var g=st.p;st.p=2;var b=zi;zi|=4;try{En(r,s.alternate,s)}finally{zi=b,st.p=g,Ve.T=c}}qn=3}}function am(){if(qn===4||qn===3){qn=0,pl();var r=Xl,s=Wu,c=tl,g=tp;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?qn=5:(qn=0,Wu=Xl=null,sp(r,r.pendingLanes));var b=r.pendingLanes;if(b===0&&($l=null),Je(c),s=s.stateNode,he&&typeof he.onCommitFiberRoot=="function")try{he.onCommitFiberRoot(_e,s,void 0,(s.current.flags&128)===128)}catch{}if(g!==null){s=Ve.T,b=st.p,st.p=2,Ve.T=null;try{for(var M=r.onRecoverableError,B=0;B<g.length;B++){var Z=g[B];M(Z.value,{componentStack:Z.stack})}}finally{Ve.T=s,st.p=b}}(tl&3)!==0&&$c(),js(r),b=r.pendingLanes,(c&261930)!==0&&(b&42)!==0?r===ip?$h++:($h=0,ip=r):$h=0,Qu(0)}}function sp(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,_r(s)))}function $c(){return nm(),rm(),am(),op()}function op(){if(qn!==5)return!1;var r=Xl,s=Jf;Jf=0;var c=Je(tl),g=Ve.T,b=st.p;try{st.p=32>c?32:c,Ve.T=null,c=ep,ep=null;var M=Xl,B=tl;if(qn=0,Wu=Xl=null,tl=0,(zi&6)!==0)throw Error(oe(331));var Z=zi;if(zi|=4,Yp(M.current),Wf(M,M.current,B,c),zi=Z,Qu(0,!1),he&&typeof he.onPostCommitFiberRoot=="function")try{he.onPostCommitFiberRoot(_e,M)}catch{}return!0}finally{st.p=b,Ve.T=g,sp(r,s)}}function nl(r,s,c){s=zr(c,s),s=vo(r.stateNode,s,2),r=zs(r,s,2),r!==null&&(Ei(r,2),js(r))}function Ii(r,s,c){if(r.tag===3)nl(r,r,c);else for(;s!==null;){if(s.tag===3){nl(s,r,c);break}else if(s.tag===1){var g=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&($l===null||!$l.has(g))){r=zr(c,r),c=Bc(2),g=zs(s,c,2),g!==null&&(kc(c,g,s,r),Ei(g,2),js(g));break}}s=s.return}}function Wh(r,s,c){var g=r.pingCache;if(g===null){g=r.pingCache=new Nm;var b=new Set;g.set(s,b)}else b=g.get(s),b===void 0&&(b=new Set,g.set(s,b));b.has(c)||(Zd=!0,b.add(c),r=Gm.bind(null,r,s,c),s.then(r,r))}function Gm(r,s,c){var g=r.pingCache;g!==null&&g.delete(s),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,Ji===r&&(ai&c)===c&&(Gn===4||Gn===3&&(ai&62914560)===ai&&300>er()-qc?(zi&2)===0&&Fs(r,0):Qf|=c,Gc===ai&&(Gc=0)),js(r)}function lp(r,s){s===0&&(s=Si()),r=ba(r,s),r!==null&&(Ei(r,s),js(r))}function qm(r){var s=r.memoizedState,c=0;s!==null&&(c=s.retryLane),lp(r,c)}function Zm(r,s){var c=0;switch(r.tag){case 31:case 13:var g=r.stateNode,b=r.memoizedState;b!==null&&(c=b.retryLane);break;case 19:g=r.stateNode;break;case 22:g=r.stateNode._retryCache;break;default:throw Error(oe(314))}g!==null&&g.delete(s),lp(r,c)}function Hm(r,s){return Zs(r,s)}var Qd=null,Xc=null,Kd=!1,Qh=!1,Ns=!1,ha=0;function js(r){r!==Xc&&r.next===null&&(Xc===null?Qd=Xc=r:Xc=Xc.next=r),Qh=!0,Kd||(Kd=!0,up())}function Qu(r,s){if(!Ns&&Qh){Ns=!0;do for(var c=!1,g=Qd;g!==null;){if(r!==0){var b=g.pendingLanes;if(b===0)var M=0;else{var B=g.suspendedLanes,Z=g.pingedLanes;M=(1<<31-je(42|r)+1)-1,M&=b&~(B&~Z),M=M&201326741?M&201326741|1:M?M|2:0}M!==0&&(c=!0,ef(g,M))}else M=ai,M=Ti(g,g===Ji?M:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(M&3)===0||Cn(g,M)||(c=!0,ef(g,M));g=g.next}while(c);Ns=!1}}function $m(){Kh()}function Kh(){Qh=Kd=!1;var r=0;ha!==0&&mp()&&(r=ha);for(var s=er(),c=null,g=Qd;g!==null;){var b=g.next,M=Jd(g,s);M===0?(g.next=null,c===null?Qd=b:c.next=b,b===null&&(Xc=c)):(c=g,(r!==0||(M&3)!==0)&&(Qh=!0)),g=b}qn!==0&&qn!==5||Qu(r),ha!==0&&(ha=0)}function Jd(r,s){for(var c=r.suspendedLanes,g=r.pingedLanes,b=r.expirationTimes,M=r.pendingLanes&-62914561;0<M;){var B=31-je(M),Z=1<<B,ce=b[B];ce===-1?((Z&c)===0||(Z&g)!==0)&&(b[B]=Ut(Z,s)):ce<=s&&(r.expiredLanes|=Z),M&=~Z}if(s=Ji,c=ai,c=Ti(r,r===s?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),g=r.callbackNode,c===0||r===s&&(Ni===2||Ni===9)||r.cancelPendingCommit!==null)return g!==null&&g!==null&&Ha(g),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||Cn(r,c)){if(s=c&-c,s===r.callbackPriority)return s;switch(g!==null&&Ha(g),Je(c)){case 2:case 8:c=V;break;case 32:c=j;break;case 268435456:c=se;break;default:c=j}return g=sm.bind(null,r),c=Zs(c,g),r.callbackPriority=s,r.callbackNode=c,s}return g!==null&&g!==null&&Ha(g),r.callbackPriority=2,r.callbackNode=null,2}function sm(r,s){if(qn!==0&&qn!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if($c()&&r.callbackNode!==c)return null;var g=ai;return g=Ti(r,r===Ji?g:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),g===0?null:(Qp(r,g,s),Jd(r,er()),r.callbackNode!=null&&r.callbackNode===c?sm.bind(null,r):null)}function ef(r,s){if($c())return null;Qp(r,s,!0)}function up(){Jt(function(){(zi&6)!==0?Zs(ve,$m):Kh()})}function Wl(){if(ha===0){var r=yr;r===0&&(r=Ft,Ft<<=1,(Ft&261888)===0&&(Ft=256)),ha=r}return ha}function cp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Xt(""+r)}function hp(r,s){var c=s.ownerDocument.createElement("input");return c.name=s.name,c.value=s.value,r.id&&c.setAttribute("form",r.id),s.parentNode.insertBefore(c,s),r=new FormData(r),c.parentNode.removeChild(c),r}function dp(r,s,c,g,b){if(s==="submit"&&c&&c.stateNode===b){var M=cp((b[nt]||null).action),B=g.submitter;B&&(s=(s=B[nt]||null)?cp(s.formAction):B.getAttribute("formAction"),s!==null&&(M=s,B=null));var Z=new cu("action","action",null,g,b);r.push({event:Z,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(ha!==0){var ce=B?hp(b,B):new FormData(b);on(c,{pending:!0,data:ce,method:b.method,action:M},null,ce)}}else typeof M=="function"&&(Z.preventDefault(),ce=B?hp(b,B):new FormData(b),on(c,{pending:!0,data:ce,method:b.method,action:M},M,ce))},currentTarget:b}]})}}for(var tf=0;tf<_c.length;tf++){var Yc=_c[tf],om=Yc.toLowerCase(),Xm=Yc[0].toUpperCase()+Yc.slice(1);ia(om,"on"+Xm)}ia(Mu,"onAnimationEnd"),ia(Eu,"onAnimationIteration"),ia(gc,"onAnimationStart"),ia("dblclick","onDoubleClick"),ia("focusin","onFocus"),ia("focusout","onBlur"),ia(Oo,"onTransitionRun"),ia(Au,"onTransitionStart"),ia(zl,"onTransitionCancel"),ia(ta,"onTransitionEnd"),vs("onMouseEnter",["mouseout","mouseover"]),vs("onMouseLeave",["mouseout","mouseover"]),vs("onPointerEnter",["pointerout","pointerover"]),vs("onPointerLeave",["pointerout","pointerover"]),ci("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ci("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ci("onBeforeInput",["compositionend","keypress","textInput","paste"]),ci("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ci("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ci("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ym=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Jh));function lm(r,s){s=(s&4)!==0;for(var c=0;c<r.length;c++){var g=r[c],b=g.event;g=g.listeners;e:{var M=void 0;if(s)for(var B=g.length-1;0<=B;B--){var Z=g[B],ce=Z.instance,Ie=Z.currentTarget;if(Z=Z.listener,ce!==M&&b.isPropagationStopped())break e;M=Z,b.currentTarget=Ie;try{M(b)}catch(Ge){ts(Ge)}b.currentTarget=null,M=ce}else for(B=0;B<g.length;B++){if(Z=g[B],ce=Z.instance,Ie=Z.currentTarget,Z=Z.listener,ce!==M&&b.isPropagationStopped())break e;M=Z,b.currentTarget=Ie;try{M(b)}catch(Ge){ts(Ge)}b.currentTarget=null,M=ce}}}}function fi(r,s){var c=s[Wt];c===void 0&&(c=s[Wt]=new Set);var g=r+"__bubble";c.has(g)||(fp(s,r,2,!1),c.add(g))}function ed(r,s,c){var g=0;s&&(g|=4),fp(c,r,g,s)}var Vs="_reactListening"+Math.random().toString(36).slice(2);function nf(r){if(!r[Vs]){r[Vs]=!0,gl.forEach(function(c){c!=="selectionchange"&&(Ym.has(c)||ed(c,!1,r),ed(c,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Vs]||(s[Vs]=!0,ed("selectionchange",!1,s))}}function fp(r,s,c,g){switch(Em(s)){case 2:var b=Ap;break;case 8:b=Mm;break;default:b=tu}c=b.bind(null,s,c,r),b=void 0,!Sr||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),g?b!==void 0?r.addEventListener(s,c,{capture:!0,passive:b}):r.addEventListener(s,c,!0):b!==void 0?r.addEventListener(s,c,{passive:b}):r.addEventListener(s,c,!1)}function rf(r,s,c,g,b){var M=g;if((s&1)===0&&(s&2)===0&&g!==null)e:for(;;){if(g===null)return;var B=g.tag;if(B===3||B===4){var Z=g.stateNode.containerInfo;if(Z===b)break;if(B===4)for(B=g.return;B!==null;){var ce=B.tag;if((ce===3||ce===4)&&B.stateNode.containerInfo===b)return;B=B.return}for(;Z!==null;){if(B=Xa(Z),B===null)return;if(ce=B.tag,ce===5||ce===6||ce===26||ce===27){g=M=B;continue e}Z=Z.parentNode}}g=g.return}Bi(function(){var Ie=M,Ge=uu(c),We=[];e:{var Pe=vh.get(r);if(Pe!==void 0){var Oe=cu,At=r;switch(r){case"keypress":if(ea(c)===0)break e;case"keydown":case"keyup":Oe=gn;break;case"focusin":At="focus",Oe=Qs;break;case"focusout":At="blur",Oe=Qs;break;case"beforeblur":case"afterblur":Oe=Qs;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Oe=Po;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Oe=hu;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Oe=zf;break;case Mu:case Eu:case gc:Oe=bd;break;case ta:Oe=lc;break;case"scroll":case"scrollend":Oe=Io;break;case"wheel":Oe=ph;break;case"copy":case"cut":case"paste":Oe=dh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Oe=oc;break;case"toggle":case"beforetoggle":Oe=Tl}var Nt=(s&4)!==0,ji=!Nt&&(r==="scroll"||r==="scrollend"),ye=Nt?Pe!==null?Pe+"Capture":null:Pe;Nt=[];for(var pe=Ie,De;pe!==null;){var Ze=pe;if(De=Ze.stateNode,Ze=Ze.tag,Ze!==5&&Ze!==26&&Ze!==27||De===null||ye===null||(Ze=_a(pe,ye),Ze!=null&&Nt.push(Wc(pe,Ze,De))),ji)break;pe=pe.return}0<Nt.length&&(Pe=new Oe(Pe,At,null,c,Ge),We.push({event:Pe,listeners:Nt}))}}if((s&7)===0){e:{if(Pe=r==="mouseover"||r==="pointerover",Oe=r==="mouseout"||r==="pointerout",Pe&&c!==hh&&(At=c.relatedTarget||c.fromElement)&&(Xa(At)||At[qt]))break e;if((Oe||Pe)&&(Pe=Ge.window===Ge?Ge:(Pe=Ge.ownerDocument)?Pe.defaultView||Pe.parentWindow:window,Oe?(At=c.relatedTarget||c.toElement,Oe=Ie,At=At?Xa(At):null,At!==null&&(ji=yt(At),Nt=At.tag,At!==ji||Nt!==5&&Nt!==27&&Nt!==6)&&(At=null)):(Oe=null,At=Ie),Oe!==At)){if(Nt=Po,Ze="onMouseLeave",ye="onMouseEnter",pe="mouse",(r==="pointerout"||r==="pointerover")&&(Nt=oc,Ze="onPointerLeave",ye="onPointerEnter",pe="pointer"),ji=Oe==null?Pe:Ya(Oe),De=At==null?Pe:Ya(At),Pe=new Nt(Ze,pe+"leave",Oe,c,Ge),Pe.target=ji,Pe.relatedTarget=De,Ze=null,Xa(Ge)===Ie&&(Nt=new Nt(ye,pe+"enter",At,c,Ge),Nt.target=De,Nt.relatedTarget=ji,Ze=Nt),ji=Ze,Oe&&At)t:{for(Nt=um,ye=Oe,pe=At,De=0,Ze=ye;Ze;Ze=Nt(Ze))De++;Ze=0;for(var St=pe;St;St=Nt(St))Ze++;for(;0<De-Ze;)ye=Nt(ye),De--;for(;0<Ze-De;)pe=Nt(pe),Ze--;for(;De--;){if(ye===pe||pe!==null&&ye===pe.alternate){Nt=ye;break t}ye=Nt(ye),pe=Nt(pe)}Nt=null}else Nt=null;Oe!==null&&id(We,Pe,Oe,Nt,!1),At!==null&&ji!==null&&id(We,ji,At,Nt,!0)}}e:{if(Pe=Ie?Ya(Ie):window,Oe=Pe.nodeName&&Pe.nodeName.toLowerCase(),Oe==="select"||Oe==="input"&&Pe.type==="file")var bi=eo;else if(cc(Pe))if(mh)bi=Id;else{bi=Dd;var Rt=Df}else Oe=Pe.nodeName,!Oe||Oe.toLowerCase()!=="input"||Pe.type!=="checkbox"&&Pe.type!=="radio"?Ie&&Co(Ie.elementType)&&(bi=eo):bi=xu;if(bi&&(bi=bi(r,Ie))){hc(We,bi,c,Ge);break e}Rt&&Rt(r,Pe,Ie),r==="focusout"&&Ie&&Pe.type==="number"&&Ie.memoizedProps.value!=null&&lu(Pe,"number",Pe.value)}switch(Rt=Ie?Ya(Ie):window,r){case"focusin":(cc(Rt)||Rt.contentEditable==="true")&&(xa=Rt,Tu=Ie,Su=null);break;case"focusout":Su=Tu=xa=null;break;case"mousedown":mc=!0;break;case"contextmenu":case"mouseup":case"dragend":mc=!1,Pd(We,c,Ge);break;case"selectionchange":if(pc)break;case"keydown":case"keyup":Pd(We,c,Ge)}var ei;if(Tn)e:{switch(r){case"compositionstart":var di="onCompositionStart";break e;case"compositionend":di="onCompositionEnd";break e;case"compositionupdate":di="onCompositionUpdate";break e}di=void 0}else Ra?gu(r,c)&&(di="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(di="onCompositionStart");di&&(Al&&c.locale!=="ko"&&(Ra||di!=="onCompositionStart"?di==="onCompositionEnd"&&Ra&&(ei=Ys()):(Jr=Ge,Ka="value"in Jr?Jr.value:Jr.textContent,Ra=!0)),Rt=td(Ie,di),0<Rt.length&&(di=new fh(di,r,null,c,Ge),We.push({event:di,listeners:Rt}),ei?di.data=ei:(ei=Md(c),ei!==null&&(di.data=ei)))),(ei=El?uc(r,c):Ed(r,c))&&(di=td(Ie,"onBeforeInput"),0<di.length&&(Rt=new fh("onBeforeInput","beforeinput",null,c,Ge),We.push({event:Rt,listeners:di}),Rt.data=ei)),dp(We,r,Ie,c,Ge)}lm(We,s)})}function Wc(r,s,c){return{instance:r,listener:s,currentTarget:c}}function td(r,s){for(var c=s+"Capture",g=[];r!==null;){var b=r,M=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||M===null||(b=_a(r,c),b!=null&&g.unshift(Wc(r,b,M)),b=_a(r,s),b!=null&&g.push(Wc(r,b,M))),r.tag===3)return g;r=r.return}return[]}function um(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function id(r,s,c,g,b){for(var M=s._reactName,B=[];c!==null&&c!==g;){var Z=c,ce=Z.alternate,Ie=Z.stateNode;if(Z=Z.tag,ce!==null&&ce===g)break;Z!==5&&Z!==26&&Z!==27||Ie===null||(ce=Ie,b?(Ie=_a(c,M),Ie!=null&&B.unshift(Wc(c,Ie,ce))):b||(Ie=_a(c,M),Ie!=null&&B.push(Wc(c,Ie,ce)))),c=c.return}B.length!==0&&r.push({event:s,listeners:B})}var cm=/\r\n?/g,nd=/\u0000|\uFFFD/g;function pp(r){return(typeof r=="string"?r:""+r).replace(cm,`
`).replace(nd,"")}function af(r,s){return s=pp(s),pp(r)===s}function qi(r,s,c,g,b,M){switch(c){case"children":typeof g=="string"?s==="body"||s==="textarea"&&g===""||xs(r,g):(typeof g=="number"||typeof g=="bigint")&&s!=="body"&&xs(r,""+g);break;case"className":Qa(r,"class",g);break;case"tabIndex":Qa(r,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":Qa(r,c,g);break;case"style":sc(r,g,M);break;case"data":if(s!=="object"){Qa(r,"data",g);break}case"src":case"href":if(g===""&&(s!=="a"||c!=="href")){r.removeAttribute(c);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){r.removeAttribute(c);break}g=Xt(""+g),r.setAttribute(c,g);break;case"action":case"formAction":if(typeof g=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof M=="function"&&(c==="formAction"?(s!=="input"&&qi(r,s,"name",b.name,b,null),qi(r,s,"formEncType",b.formEncType,b,null),qi(r,s,"formMethod",b.formMethod,b,null),qi(r,s,"formTarget",b.formTarget,b,null)):(qi(r,s,"encType",b.encType,b,null),qi(r,s,"method",b.method,b,null),qi(r,s,"target",b.target,b,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){r.removeAttribute(c);break}g=Xt(""+g),r.setAttribute(c,g);break;case"onClick":g!=null&&(r.onclick=Pa);break;case"onScroll":g!=null&&fi("scroll",r);break;case"onScrollEnd":g!=null&&fi("scrollend",r);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(oe(61));if(c=g.__html,c!=null){if(b.children!=null)throw Error(oe(60));r.innerHTML=c}}break;case"multiple":r.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":r.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){r.removeAttribute("xlink:href");break}c=Xt(""+g),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,""+g):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":g===!0?r.setAttribute(c,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?r.setAttribute(c,g):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?r.setAttribute(c,g):r.removeAttribute(c);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?r.removeAttribute(c):r.setAttribute(c,g);break;case"popover":fi("beforetoggle",r),fi("toggle",r),au(r,"popover",g);break;case"xlinkActuate":ga(r,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":ga(r,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":ga(r,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":ga(r,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":ga(r,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":ga(r,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":ga(r,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":ga(r,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":ga(r,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":au(r,"is",g);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Xs.get(c)||c,au(r,c,g))}}function da(r,s,c,g,b,M){switch(c){case"style":sc(r,g,M);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(oe(61));if(c=g.__html,c!=null){if(b.children!=null)throw Error(oe(60));r.innerHTML=c}}break;case"children":typeof g=="string"?xs(r,g):(typeof g=="number"||typeof g=="bigint")&&xs(r,""+g);break;case"onScroll":g!=null&&fi("scroll",r);break;case"onScrollEnd":g!=null&&fi("scrollend",r);break;case"onClick":g!=null&&(r.onclick=Pa);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!gr.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(b=c.endsWith("Capture"),s=c.slice(2,b?c.length-7:void 0),M=r[nt]||null,M=M!=null?M[c]:null,typeof M=="function"&&r.removeEventListener(s,M,b),typeof g=="function")){typeof M!="function"&&M!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(s,g,b);break e}c in r?r[c]=g:g===!0?r.setAttribute(c,""):au(r,c,g)}}}function Zn(r,s,c){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":fi("error",r),fi("load",r);var g=!1,b=!1,M;for(M in c)if(c.hasOwnProperty(M)){var B=c[M];if(B!=null)switch(M){case"src":g=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(oe(137,s));default:qi(r,s,M,B,c,null)}}b&&qi(r,s,"srcSet",c.srcSet,c,null),g&&qi(r,s,"src",c.src,c,null);return;case"input":fi("invalid",r);var Z=M=B=b=null,ce=null,Ie=null;for(g in c)if(c.hasOwnProperty(g)){var Ge=c[g];if(Ge!=null)switch(g){case"name":b=Ge;break;case"type":B=Ge;break;case"checked":ce=Ge;break;case"defaultChecked":Ie=Ge;break;case"value":M=Ge;break;case"defaultValue":Z=Ge;break;case"children":case"dangerouslySetInnerHTML":if(Ge!=null)throw Error(oe(137,s));break;default:qi(r,s,g,Ge,c,null)}}ac(r,M,Z,ce,Ie,B,b,!1);return;case"select":fi("invalid",r),g=B=M=null;for(b in c)if(c.hasOwnProperty(b)&&(Z=c[b],Z!=null))switch(b){case"value":M=Z;break;case"defaultValue":B=Z;break;case"multiple":g=Z;default:qi(r,s,b,Z,c,null)}s=M,c=B,r.multiple=!!g,s!=null?$s(r,!!g,s,!1):c!=null&&$s(r,!!g,c,!0);return;case"textarea":fi("invalid",r),M=b=g=null;for(B in c)if(c.hasOwnProperty(B)&&(Z=c[B],Z!=null))switch(B){case"value":g=Z;break;case"defaultValue":b=Z;break;case"children":M=Z;break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(oe(91));break;default:qi(r,s,B,Z,c,null)}vl(r,g,b,M);return;case"option":for(ce in c)if(c.hasOwnProperty(ce)&&(g=c[ce],g!=null))switch(ce){case"selected":r.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:qi(r,s,ce,g,c,null)}return;case"dialog":fi("beforetoggle",r),fi("toggle",r),fi("cancel",r),fi("close",r);break;case"iframe":case"object":fi("load",r);break;case"video":case"audio":for(g=0;g<Jh.length;g++)fi(Jh[g],r);break;case"image":fi("error",r),fi("load",r);break;case"details":fi("toggle",r);break;case"embed":case"source":case"link":fi("error",r),fi("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ie in c)if(c.hasOwnProperty(Ie)&&(g=c[Ie],g!=null))switch(Ie){case"children":case"dangerouslySetInnerHTML":throw Error(oe(137,s));default:qi(r,s,Ie,g,c,null)}return;default:if(Co(s)){for(Ge in c)c.hasOwnProperty(Ge)&&(g=c[Ge],g!==void 0&&da(r,s,Ge,g,c,void 0));return}}for(Z in c)c.hasOwnProperty(Z)&&(g=c[Z],g!=null&&qi(r,s,Z,g,c,null))}function rd(r,s,c,g){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,M=null,B=null,Z=null,ce=null,Ie=null,Ge=null;for(Oe in c){var We=c[Oe];if(c.hasOwnProperty(Oe)&&We!=null)switch(Oe){case"checked":break;case"value":break;case"defaultValue":ce=We;default:g.hasOwnProperty(Oe)||qi(r,s,Oe,null,g,We)}}for(var Pe in g){var Oe=g[Pe];if(We=c[Pe],g.hasOwnProperty(Pe)&&(Oe!=null||We!=null))switch(Pe){case"type":M=Oe;break;case"name":b=Oe;break;case"checked":Ie=Oe;break;case"defaultChecked":Ge=Oe;break;case"value":B=Oe;break;case"defaultValue":Z=Oe;break;case"children":case"dangerouslySetInnerHTML":if(Oe!=null)throw Error(oe(137,s));break;default:Oe!==We&&qi(r,s,Pe,Oe,g,We)}}ou(r,B,Z,ce,Ie,Ge,M,b);return;case"select":Oe=B=Z=Pe=null;for(M in c)if(ce=c[M],c.hasOwnProperty(M)&&ce!=null)switch(M){case"value":break;case"multiple":Oe=ce;default:g.hasOwnProperty(M)||qi(r,s,M,null,g,ce)}for(b in g)if(M=g[b],ce=c[b],g.hasOwnProperty(b)&&(M!=null||ce!=null))switch(b){case"value":Pe=M;break;case"defaultValue":Z=M;break;case"multiple":B=M;default:M!==ce&&qi(r,s,b,M,g,ce)}s=Z,c=B,g=Oe,Pe!=null?$s(r,!!c,Pe,!1):!!g!=!!c&&(s!=null?$s(r,!!c,s,!0):$s(r,!!c,c?[]:"",!1));return;case"textarea":Oe=Pe=null;for(Z in c)if(b=c[Z],c.hasOwnProperty(Z)&&b!=null&&!g.hasOwnProperty(Z))switch(Z){case"value":break;case"children":break;default:qi(r,s,Z,null,g,b)}for(B in g)if(b=g[B],M=c[B],g.hasOwnProperty(B)&&(b!=null||M!=null))switch(B){case"value":Pe=b;break;case"defaultValue":Oe=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(oe(91));break;default:b!==M&&qi(r,s,B,b,g,M)}vd(r,Pe,Oe);return;case"option":for(var At in c)if(Pe=c[At],c.hasOwnProperty(At)&&Pe!=null&&!g.hasOwnProperty(At))switch(At){case"selected":r.selected=!1;break;default:qi(r,s,At,null,g,Pe)}for(ce in g)if(Pe=g[ce],Oe=c[ce],g.hasOwnProperty(ce)&&Pe!==Oe&&(Pe!=null||Oe!=null))switch(ce){case"selected":r.selected=Pe&&typeof Pe!="function"&&typeof Pe!="symbol";break;default:qi(r,s,ce,Pe,g,Oe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Nt in c)Pe=c[Nt],c.hasOwnProperty(Nt)&&Pe!=null&&!g.hasOwnProperty(Nt)&&qi(r,s,Nt,null,g,Pe);for(Ie in g)if(Pe=g[Ie],Oe=c[Ie],g.hasOwnProperty(Ie)&&Pe!==Oe&&(Pe!=null||Oe!=null))switch(Ie){case"children":case"dangerouslySetInnerHTML":if(Pe!=null)throw Error(oe(137,s));break;default:qi(r,s,Ie,Pe,g,Oe)}return;default:if(Co(s)){for(var ji in c)Pe=c[ji],c.hasOwnProperty(ji)&&Pe!==void 0&&!g.hasOwnProperty(ji)&&da(r,s,ji,void 0,g,Pe);for(Ge in g)Pe=g[Ge],Oe=c[Ge],!g.hasOwnProperty(Ge)||Pe===Oe||Pe===void 0&&Oe===void 0||da(r,s,Ge,Pe,g,Oe);return}}for(var ye in c)Pe=c[ye],c.hasOwnProperty(ye)&&Pe!=null&&!g.hasOwnProperty(ye)&&qi(r,s,ye,null,g,Pe);for(We in g)Pe=g[We],Oe=c[We],!g.hasOwnProperty(We)||Pe===Oe||Pe==null&&Oe==null||qi(r,s,We,Pe,g,Oe)}function hm(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function dm(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,c=performance.getEntriesByType("resource"),g=0;g<c.length;g++){var b=c[g],M=b.transferSize,B=b.initiatorType,Z=b.duration;if(M&&Z&&hm(B)){for(B=0,Z=b.responseEnd,g+=1;g<c.length;g++){var ce=c[g],Ie=ce.startTime;if(Ie>Z)break;var Ge=ce.transferSize,We=ce.initiatorType;Ge&&hm(We)&&(ce=ce.responseEnd,B+=Ge*(ce<Z?1:(Z-Ie)/(ce-Ie)))}if(--g,s+=8*(M+B)/(b.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var sf=null,of=null;function rl(r){return r.nodeType===9?r:r.ownerDocument}function ad(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function lf(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function sd(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var uf=null;function mp(){var r=window.event;return r&&r.type==="popstate"?r===uf?!1:(uf=r,!0):(uf=null,!1)}var cf=typeof setTimeout=="function"?setTimeout:void 0,Wm=typeof clearTimeout=="function"?clearTimeout:void 0,fm=typeof Promise=="function"?Promise:void 0,Jt=typeof queueMicrotask=="function"?queueMicrotask:typeof fm<"u"?function(r){return fm.resolve(null).then(r).catch(al)}:cf;function al(r){setTimeout(function(){throw r})}function vn(r){return r==="head"}function ps(r,s){var c=s,g=0;do{var b=c.nextSibling;if(r.removeChild(c),b&&b.nodeType===8)if(c=b.data,c==="/$"||c==="/&"){if(g===0){r.removeChild(b),oh(s);return}g--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")g++;else if(c==="html")Qc(r.ownerDocument.documentElement);else if(c==="head"){c=r.ownerDocument.head,Qc(c);for(var M=c.firstChild;M;){var B=M.nextSibling,Z=M.nodeName;M[Gt]||Z==="SCRIPT"||Z==="STYLE"||Z==="LINK"&&M.rel.toLowerCase()==="stylesheet"||c.removeChild(M),M=B}}else c==="body"&&Qc(r.ownerDocument.body);c=b}while(c);oh(s)}function Ql(r,s){var c=r;r=0;do{var g=c.nextSibling;if(c.nodeType===1?s?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(s?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(r===0)break;r--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||r++;c=g}while(c)}function Hr(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var c=s;switch(s=s.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Hr(c),Mo(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function or(r,s,c,g){for(;r.nodeType===1;){var b=c;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!g&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(g){if(!r[Gt])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(M=r.getAttribute("rel"),M==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(M!==b.rel||r.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||r.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||r.getAttribute("title")!==(b.title==null?null:b.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(M=r.getAttribute("src"),(M!==(b.src==null?null:b.src)||r.getAttribute("type")!==(b.type==null?null:b.type)||r.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&M&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var M=b.name==null?null:""+b.name;if(b.type==="hidden"&&r.getAttribute("name")===M)return r}else return r;if(r=ms(r.nextSibling),r===null)break}return null}function lr(r,s,c){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=ms(r.nextSibling),r===null))return null;return r}function gp(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=ms(r.nextSibling),r===null))return null;return r}function fa(r){return r.data==="$?"||r.data==="$~"}function Qn(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function hf(r,s){var c=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||c.readyState!=="loading")s();else{var g=function(){s(),c.removeEventListener("DOMContentLoaded",g)};c.addEventListener("DOMContentLoaded",g),r._reactRetry=g}}function ms(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var df=null;function Kl(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var c=r.data;if(c==="/$"||c==="/&"){if(s===0)return ms(r.nextSibling);s--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||s++}r=r.nextSibling}return null}function Ku(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(s===0)return r;s--}else c!=="/$"&&c!=="/&"||s++}r=r.previousSibling}return null}function pm(r,s,c){switch(s=rl(c),r){case"html":if(r=s.documentElement,!r)throw Error(oe(452));return r;case"head":if(r=s.head,!r)throw Error(oe(453));return r;case"body":if(r=s.body,!r)throw Error(oe(454));return r;default:throw Error(oe(451))}}function Qc(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);Mo(r)}var Ga=new Map,_p=new Set;function Kc(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var wo=st.d;st.d={f:yp,r:$r,D:Jl,C:ff,L:vp,m:mm,X:_m,S:gm,M:ym};function yp(){var r=wo.f(),s=Xh();return r||s}function $r(r){var s=ys(r);s!==null&&s.tag===5&&s.type==="form"?ar(s):wo.r(r)}var Xr=typeof document>"u"?null:document;function kr(r,s,c){var g=Xr;if(g&&typeof s=="string"&&s){var b=Tr(s);b='link[rel="'+r+'"][href="'+b+'"]',typeof c=="string"&&(b+='[crossorigin="'+c+'"]'),_p.has(b)||(_p.add(b),r={rel:r,crossOrigin:c,href:s},g.querySelector(b)===null&&(s=g.createElement("link"),Zn(s,"link",r),pn(s),g.head.appendChild(s)))}}function Jl(r){wo.D(r),kr("dns-prefetch",r,null)}function ff(r,s){wo.C(r,s),kr("preconnect",r,s)}function vp(r,s,c){wo.L(r,s,c);var g=Xr;if(g&&r&&s){var b='link[rel="preload"][as="'+Tr(s)+'"]';s==="image"&&c&&c.imageSrcSet?(b+='[imagesrcset="'+Tr(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(b+='[imagesizes="'+Tr(c.imageSizes)+'"]')):b+='[href="'+Tr(r)+'"]';var M=b;switch(s){case"style":M=sl(r);break;case"script":M=eu(r)}Ga.has(M)||(r=mt({rel:"preload",href:s==="image"&&c&&c.imageSrcSet?void 0:r,as:s},c),Ga.set(M,r),g.querySelector(b)!==null||s==="style"&&g.querySelector(Jc(M))||s==="script"&&g.querySelector(th(M))||(s=g.createElement("link"),Zn(s,"link",r),pn(s),g.head.appendChild(s)))}}function mm(r,s){wo.m(r,s);var c=Xr;if(c&&r){var g=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+Tr(g)+'"][href="'+Tr(r)+'"]',M=b;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":M=eu(r)}if(!Ga.has(M)&&(r=mt({rel:"modulepreload",href:r},s),Ga.set(M,r),c.querySelector(b)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(th(M)))return}g=c.createElement("link"),Zn(g,"link",r),pn(g),c.head.appendChild(g)}}}function gm(r,s,c){wo.S(r,s,c);var g=Xr;if(g&&r){var b=Wa(g).hoistableStyles,M=sl(r);s=s||"default";var B=b.get(M);if(!B){var Z={loading:0,preload:null};if(B=g.querySelector(Jc(M)))Z.loading=5;else{r=mt({rel:"stylesheet",href:r,"data-precedence":s},c),(c=Ga.get(M))&&ih(r,c);var ce=B=g.createElement("link");pn(ce),Zn(ce,"link",r),ce._p=new Promise(function(Ie,Ge){ce.onload=Ie,ce.onerror=Ge}),ce.addEventListener("load",function(){Z.loading|=1}),ce.addEventListener("error",function(){Z.loading|=2}),Z.loading|=4,od(B,s,g)}B={type:"stylesheet",instance:B,count:1,state:Z},b.set(M,B)}}}function _m(r,s){wo.X(r,s);var c=Xr;if(c&&r){var g=Wa(c).hoistableScripts,b=eu(r),M=g.get(b);M||(M=c.querySelector(th(b)),M||(r=mt({src:r,async:!0},s),(s=Ga.get(b))&&nh(r,s),M=c.createElement("script"),pn(M),Zn(M,"link",r),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(b,M))}}function ym(r,s){wo.M(r,s);var c=Xr;if(c&&r){var g=Wa(c).hoistableScripts,b=eu(r),M=g.get(b);M||(M=c.querySelector(th(b)),M||(r=mt({src:r,async:!0,type:"module"},s),(s=Ga.get(b))&&nh(r,s),M=c.createElement("script"),pn(M),Zn(M,"link",r),c.head.appendChild(M)),M={type:"script",instance:M,count:1,state:null},g.set(b,M))}}function pf(r,s,c,g){var b=(b=ft.current)?Kc(b):null;if(!b)throw Error(oe(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(s=sl(c.href),c=Wa(b).hoistableStyles,g=c.get(s),g||(g={type:"style",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=sl(c.href);var M=Wa(b).hoistableStyles,B=M.get(r);if(B||(b=b.ownerDocument||b,B={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},M.set(r,B),(M=b.querySelector(Jc(r)))&&!M._p&&(B.instance=M,B.state.loading=5),Ga.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},Ga.set(r,c),M||eh(b,r,c,B.state))),s&&g===null)throw Error(oe(528,""));return B}if(s&&g!==null)throw Error(oe(529,""));return null;case"script":return s=c.async,c=c.src,typeof c=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=eu(c),c=Wa(b).hoistableScripts,g=c.get(s),g||(g={type:"script",instance:null,count:0,state:null},c.set(s,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(oe(444,r))}}function sl(r){return'href="'+Tr(r)+'"'}function Jc(r){return'link[rel="stylesheet"]['+r+"]"}function xp(r){return mt({},r,{"data-precedence":r.precedence,precedence:null})}function eh(r,s,c,g){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?g.loading=1:(s=r.createElement("link"),g.preload=s,s.addEventListener("load",function(){return g.loading|=1}),s.addEventListener("error",function(){return g.loading|=2}),Zn(s,"link",c),pn(s),r.head.appendChild(s))}function eu(r){return'[src="'+Tr(r)+'"]'}function th(r){return"script[async]"+r}function vm(r,s,c){if(s.count++,s.instance===null)switch(s.type){case"style":var g=r.querySelector('style[data-href~="'+Tr(c.href)+'"]');if(g)return s.instance=g,pn(g),g;var b=mt({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return g=(r.ownerDocument||r).createElement("style"),pn(g),Zn(g,"style",b),od(g,c.precedence,r),s.instance=g;case"stylesheet":b=sl(c.href);var M=r.querySelector(Jc(b));if(M)return s.state.loading|=4,s.instance=M,pn(M),M;g=xp(c),(b=Ga.get(b))&&ih(g,b),M=(r.ownerDocument||r).createElement("link"),pn(M);var B=M;return B._p=new Promise(function(Z,ce){B.onload=Z,B.onerror=ce}),Zn(M,"link",g),s.state.loading|=4,od(M,c.precedence,r),s.instance=M;case"script":return M=eu(c.src),(b=r.querySelector(th(M)))?(s.instance=b,pn(b),b):(g=c,(b=Ga.get(M))&&(g=mt({},c),nh(g,b)),r=r.ownerDocument||r,b=r.createElement("script"),pn(b),Zn(b,"link",g),r.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(oe(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(g=s.instance,s.state.loading|=4,od(g,c.precedence,r));return s.instance}function od(r,s,c){for(var g=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=g.length?g[g.length-1]:null,M=b,B=0;B<g.length;B++){var Z=g[B];if(Z.dataset.precedence===s)M=Z;else if(M!==b)break}M?M.parentNode.insertBefore(r,M.nextSibling):(s=c.nodeType===9?c.head:c,s.insertBefore(r,s.firstChild))}function ih(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function nh(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var Ju=null;function mf(r,s,c){if(Ju===null){var g=new Map,b=Ju=new Map;b.set(c,g)}else b=Ju,g=b.get(c),g||(g=new Map,b.set(c,g));if(g.has(r))return g;for(g.set(r,null),c=c.getElementsByTagName(r),b=0;b<c.length;b++){var M=c[b];if(!(M[Gt]||M[Ui]||r==="link"&&M.getAttribute("rel")==="stylesheet")&&M.namespaceURI!=="http://www.w3.org/2000/svg"){var B=M.getAttribute(s)||"";B=r+B;var Z=g.get(B);Z?Z.push(M):g.set(B,[M])}}return g}function gf(r,s,c){r=r.ownerDocument||r,r.head.insertBefore(c,s==="title"?r.querySelector("head > title"):null)}function bp(r,s,c){if(c===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return r=s.disabled,typeof s.precedence=="string"&&r==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function wp(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function xm(r,s,c,g){if(c.type==="stylesheet"&&(typeof g.media!="string"||matchMedia(g.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var b=sl(g.href),M=s.querySelector(Jc(b));if(M){s=M._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=ld.bind(r),s.then(r,r)),c.state.loading|=4,c.instance=M,pn(M);return}M=s.ownerDocument||s,g=xp(g),(b=Ga.get(b))&&ih(g,b),M=M.createElement("link"),pn(M);var B=M;B._p=new Promise(function(Z,ce){B.onload=Z,B.onerror=ce}),Zn(M,"link",g),c.instance=M}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(r.count++,c=ld.bind(r),s.addEventListener("load",c),s.addEventListener("error",c))}}var _f=0;function bm(r,s){return r.stylesheets&&r.count===0&&ud(r,r.stylesheets),0<r.count||0<r.imgCount?function(c){var g=setTimeout(function(){if(r.stylesheets&&ud(r,r.stylesheets),r.unsuspend){var M=r.unsuspend;r.unsuspend=null,M()}},6e4+s);0<r.imgBytes&&_f===0&&(_f=62500*dm());var b=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&ud(r,r.stylesheets),r.unsuspend)){var M=r.unsuspend;r.unsuspend=null,M()}},(r.imgBytes>_f?50:800)+s);return r.unsuspend=c,function(){r.unsuspend=null,clearTimeout(g),clearTimeout(b)}}:null}function ld(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ud(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var yf=null;function ud(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,yf=new Map,s.forEach(Qm,r),yf=null,ld.call(r))}function Qm(r,s){if(!(s.state.loading&4)){var c=yf.get(r);if(c)var g=c.get(null);else{c=new Map,yf.set(r,c);for(var b=r.querySelectorAll("link[data-precedence],style[data-precedence]"),M=0;M<b.length;M++){var B=b[M];(B.nodeName==="LINK"||B.getAttribute("media")!=="not all")&&(c.set(B.dataset.precedence,B),g=B)}g&&c.set(null,g)}b=s.instance,B=b.getAttribute("data-precedence"),M=c.get(B)||g,M===g&&c.set(null,b),c.set(B,b),this.count++,g=ld.bind(this),b.addEventListener("load",g),b.addEventListener("error",g),M?M.parentNode.insertBefore(b,M.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(b,r.firstChild)),s.state.loading|=4}}var cd={$$typeof:dt,Provider:null,Consumer:null,_currentValue:Lt,_currentValue2:Lt,_threadCount:0};function Tp(r,s,c,g,b,M,B,Z,ce){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=$n(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$n(0),this.hiddenUpdates=$n(null),this.identifierPrefix=g,this.onUncaughtError=b,this.onCaughtError=M,this.onRecoverableError=B,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ce,this.incompleteTransitions=new Map}function Sp(r,s,c,g,b,M,B,Z,ce,Ie,Ge,We){return r=new Tp(r,s,c,B,ce,Ie,Ge,We,Z),s=1,M===!0&&(s|=24),M=na(3,null,null,s),r.current=M,M.stateNode=r,s=uo(),s.refCount++,r.pooledCache=s,s.refCount++,M.memoizedState={element:g,isDehydrated:c,cache:s},zc(M),r}function wm(r){return r?(r=Qt,r):Qt}function Tm(r,s,c,g,b,M){b=wm(b),g.context===null?g.context=b:g.pendingContext=b,g=si(s),g.payload={element:c},M=M===void 0?null:M,M!==null&&(g.callback=M),c=zs(r,g,s),c!==null&&(Aa(c,r,s),mo(c,r,s))}function Mp(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<s?c:s}}function ec(r,s){Mp(r,s),(r=r.alternate)&&Mp(r,s)}function Ep(r){if(r.tag===13||r.tag===31){var s=ba(r,67108864);s!==null&&Aa(s,r,67108864),ec(r,67108864)}}function Sm(r){if(r.tag===13||r.tag===31){var s=Di();s=So(s);var c=ba(r,s);c!==null&&Aa(c,r,s),ec(r,s)}}var rh=!0;function Ap(r,s,c,g){var b=Ve.T;Ve.T=null;var M=st.p;try{st.p=2,tu(r,s,c,g)}finally{st.p=M,Ve.T=b}}function Mm(r,s,c,g){var b=Ve.T;Ve.T=null;var M=st.p;try{st.p=8,tu(r,s,c,g)}finally{st.p=M,Ve.T=b}}function tu(r,s,c,g){if(rh){var b=vf(g);if(b===null)rf(r,s,g,xf,c),zp(r,g);else if(Jm(b,r,s,c,g))g.stopPropagation();else if(zp(r,g),s&4&&-1<Km.indexOf(r)){for(;b!==null;){var M=ys(b);if(M!==null)switch(M.tag){case 3:if(M=M.stateNode,M.current.memoizedState.isDehydrated){var B=xe(M.pendingLanes);if(B!==0){var Z=M;for(Z.pendingLanes|=2,Z.entangledLanes|=2;B;){var ce=1<<31-je(B);Z.entanglements[1]|=ce,B&=~ce}js(M),(zi&6)===0&&(Zh=er()+500,Qu(0))}}break;case 31:case 13:Z=ba(M,2),Z!==null&&Aa(Z,M,2),Xh(),ec(M,2)}if(M=vf(g),M===null&&rf(r,s,g,xf,c),M===b)break;b=M}b!==null&&g.stopPropagation()}else rf(r,s,g,null,c)}}function vf(r){return r=uu(r),tc(r)}var xf=null;function tc(r){if(xf=null,r=Xa(r),r!==null){var s=yt(r);if(s===null)r=null;else{var c=s.tag;if(c===13){if(r=k(s),r!==null)return r;r=null}else if(c===31){if(r=d(s),r!==null)return r;r=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return xf=r,null}function Em(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Fr()){case ve:return 2;case V:return 8;case j:case H:return 32;case se:return 268435456;default:return 32}default:return 32}}var Cp=!1,ol=null,ll=null,iu=null,hd=new Map,dd=new Map,nu=[],Km="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function zp(r,s){switch(r){case"focusin":case"focusout":ol=null;break;case"dragenter":case"dragleave":ll=null;break;case"mouseover":case"mouseout":iu=null;break;case"pointerover":case"pointerout":hd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":dd.delete(s.pointerId)}}function Us(r,s,c,g,b,M){return r===null||r.nativeEvent!==M?(r={blockedOn:s,domEventName:c,eventSystemFlags:g,nativeEvent:M,targetContainers:[b]},s!==null&&(s=ys(s),s!==null&&Ep(s)),r):(r.eventSystemFlags|=g,s=r.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),r)}function Jm(r,s,c,g,b){switch(s){case"focusin":return ol=Us(ol,r,s,c,g,b),!0;case"dragenter":return ll=Us(ll,r,s,c,g,b),!0;case"mouseover":return iu=Us(iu,r,s,c,g,b),!0;case"pointerover":var M=b.pointerId;return hd.set(M,Us(hd.get(M)||null,r,s,c,g,b)),!0;case"gotpointercapture":return M=b.pointerId,dd.set(M,Us(dd.get(M)||null,r,s,c,g,b)),!0}return!1}function ah(r){var s=Xa(r.target);if(s!==null){var c=yt(s);if(c!==null){if(s=c.tag,s===13){if(s=k(c),s!==null){r.blockedOn=s,mr(r.priority,function(){Sm(c)});return}}else if(s===31){if(s=d(c),s!==null){r.blockedOn=s,mr(r.priority,function(){Sm(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function bf(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var c=vf(r.nativeEvent);if(c===null){c=r.nativeEvent;var g=new c.constructor(c.type,c);hh=g,c.target.dispatchEvent(g),hh=null}else return s=ys(c),s!==null&&Ep(s),r.blockedOn=c,!1;s.shift()}return!0}function Am(r,s,c){bf(r)&&c.delete(s)}function eg(){Cp=!1,ol!==null&&bf(ol)&&(ol=null),ll!==null&&bf(ll)&&(ll=null),iu!==null&&bf(iu)&&(iu=null),hd.forEach(Am),dd.forEach(Am)}function sh(r,s){r.blockedOn===s&&(r.blockedOn=null,Cp||(Cp=!0,fe.unstable_scheduleCallback(fe.unstable_NormalPriority,eg)))}var fd=null;function Cm(r){fd!==r&&(fd=r,fe.unstable_scheduleCallback(fe.unstable_NormalPriority,function(){fd===r&&(fd=null);for(var s=0;s<r.length;s+=3){var c=r[s],g=r[s+1],b=r[s+2];if(typeof g!="function"){if(tc(g||c)===null)continue;break}var M=ys(c);M!==null&&(r.splice(s,3),s-=3,on(M,{pending:!0,data:b,method:c.method,action:g},g,b))}}))}function oh(r){function s(ce){return sh(ce,r)}ol!==null&&sh(ol,r),ll!==null&&sh(ll,r),iu!==null&&sh(iu,r),hd.forEach(s),dd.forEach(s);for(var c=0;c<nu.length;c++){var g=nu[c];g.blockedOn===r&&(g.blockedOn=null)}for(;0<nu.length&&(c=nu[0],c.blockedOn===null);)ah(c),c.blockedOn===null&&nu.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(g=0;g<c.length;g+=3){var b=c[g],M=c[g+1],B=b[nt]||null;if(typeof M=="function")B||Cm(c);else if(B){var Z=null;if(M&&M.hasAttribute("formAction")){if(b=M,B=M[nt]||null)Z=B.formAction;else if(tc(b)!==null)continue}else Z=B.action;typeof Z=="function"?c[g+1]=Z:(c.splice(g,3),g-=3),Cm(c)}}}function Dp(){function r(M){M.canIntercept&&M.info==="react-transition"&&M.intercept({handler:function(){return new Promise(function(B){return b=B})},focusReset:"manual",scroll:"manual"})}function s(){b!==null&&(b(),b=null),g||setTimeout(c,20)}function c(){if(!g&&!navigation.transition){var M=navigation.currentEntry;M&&M.url!=null&&navigation.navigate(M.url,{state:M.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var g=!1,b=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(c,100),function(){g=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),b!==null&&(b(),b=null)}}}function wf(r){this._internalRoot=r}Tf.prototype.render=wf.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(oe(409));var c=s.current,g=Di();Tm(c,g,r,s,null,null)},Tf.prototype.unmount=wf.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;Tm(r.current,2,null,r,null,null),Xh(),s[qt]=null}};function Tf(r){this._internalRoot=r}Tf.prototype.unstable_scheduleHydration=function(r){if(r){var s=pr();r={blockedOn:null,target:r,priority:s};for(var c=0;c<nu.length&&s!==0&&s<nu[c].priority;c++);nu.splice(c,0,r),c===0&&ah(r)}};var Ip=ot.version;if(Ip!=="19.2.1")throw Error(oe(527,Ip,"19.2.1"));st.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(oe(188)):(r=Object.keys(r).join(","),Error(oe(268,r)));return r=Be(s),r=r!==null?ut(r):null,r=r===null?null:r.stateNode,r};var zm={bundleType:0,version:"19.2.1",rendererPackageName:"react-dom",currentDispatcherRef:Ve,reconcilerVersion:"19.2.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sf.isDisabled&&Sf.supportsFiber)try{_e=Sf.inject(zm),he=Sf}catch{}}return kp.createRoot=function(r,s){if(!rt(r))throw Error(oe(299));var c=!1,g="",b=yo,M=Os,B=Ph;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(g=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(M=s.onCaughtError),s.onRecoverableError!==void 0&&(B=s.onRecoverableError)),s=Sp(r,1,!1,null,null,c,g,null,b,M,B,Dp),r[qt]=s.current,nf(r),new wf(s)},kp.hydrateRoot=function(r,s,c){if(!rt(r))throw Error(oe(299));var g=!1,b="",M=yo,B=Os,Z=Ph,ce=null;return c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(b=c.identifierPrefix),c.onUncaughtError!==void 0&&(M=c.onUncaughtError),c.onCaughtError!==void 0&&(B=c.onCaughtError),c.onRecoverableError!==void 0&&(Z=c.onRecoverableError),c.formState!==void 0&&(ce=c.formState)),s=Sp(r,1,!0,s,c??null,g,b,ce,M,B,Z,Dp),s.context=wm(null),c=s.current,g=Di(),g=So(g),b=si(g),b.callback=null,zs(c,b,g),c=g,s.current.lanes=c,Ei(s,c),js(s),r[qt]=s.current,nf(r),new Tf(s)},kp.version="19.2.1",kp}var jg;function x_(){if(jg)return dg.exports;jg=1;function fe(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(fe)}catch(ot){console.error(ot)}}return fe(),dg.exports=v_(),dg.exports}var b_=x_(),Vg=63710088e-1;function $g(fe,ot,Xe={}){const oe={type:"Feature"};return(Xe.id===0||Xe.id)&&(oe.id=Xe.id),Xe.bbox&&(oe.bbox=Xe.bbox),oe.properties=ot||{},oe.geometry=fe,oe}function w_(fe,ot,Xe={}){if(!fe)throw new Error("coordinates is required");if(!Array.isArray(fe))throw new Error("coordinates must be an Array");if(fe.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ug(fe[0])||!Ug(fe[1]))throw new Error("coordinates must contain numbers");return $g({type:"Point",coordinates:fe},ot,Xe)}function T_(fe,ot,Xe={}){for(const rt of fe){if(rt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(rt[rt.length-1].length!==rt[0].length)throw new Error("First and last Position are not equivalent.");for(let yt=0;yt<rt[rt.length-1].length;yt++)if(rt[rt.length-1][yt]!==rt[0][yt])throw new Error("First and last Position are not equivalent.")}return $g({type:"Polygon",coordinates:fe},ot,Xe)}function gg(fe,ot={}){const Xe={type:"FeatureCollection"};return ot.id&&(Xe.id=ot.id),ot.bbox&&(Xe.bbox=ot.bbox),Xe.features=fe,Xe}function Ug(fe){return!isNaN(fe)&&fe!==null&&!Array.isArray(fe)}function Xg(fe,ot,Xe){if(fe!==null)for(var oe,rt,yt,k,d,ge,Be,ut=0,mt=0,Ke,kt=fe.type,Ht=kt==="FeatureCollection",xt=kt==="Feature",me=Ht?fe.features.length:1,$t=0;$t<me;$t++){Be=Ht?fe.features[$t].geometry:xt?fe.geometry:fe,Ke=Be?Be.type==="GeometryCollection":!1,d=Ke?Be.geometries.length:1;for(var jt=0;jt<d;jt++){var dt=0,Dt=0;if(k=Ke?Be.geometries[jt]:Be,k!==null){ge=k.coordinates;var Yt=k.type;switch(ut=0,Yt){case null:break;case"Point":if(ot(ge,mt,$t,dt,Dt)===!1)return!1;mt++,dt++;break;case"LineString":case"MultiPoint":for(oe=0;oe<ge.length;oe++){if(ot(ge[oe],mt,$t,dt,Dt)===!1)return!1;mt++,Yt==="MultiPoint"&&dt++}Yt==="LineString"&&dt++;break;case"Polygon":case"MultiLineString":for(oe=0;oe<ge.length;oe++){for(rt=0;rt<ge[oe].length-ut;rt++){if(ot(ge[oe][rt],mt,$t,dt,Dt)===!1)return!1;mt++}Yt==="MultiLineString"&&dt++,Yt==="Polygon"&&Dt++}Yt==="Polygon"&&dt++;break;case"MultiPolygon":for(oe=0;oe<ge.length;oe++){for(Dt=0,rt=0;rt<ge[oe].length;rt++){for(yt=0;yt<ge[oe][rt].length-ut;yt++){if(ot(ge[oe][rt][yt],mt,$t,dt,Dt)===!1)return!1;mt++}Dt++}dt++}break;case"GeometryCollection":for(oe=0;oe<k.geometries.length;oe++)if(Xg(k.geometries[oe],ot)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function S_(fe,ot){var Xe,oe,rt,yt,k,d,ge,Be,ut,mt,Ke=0,kt=fe.type==="FeatureCollection",Ht=fe.type==="Feature",xt=kt?fe.features.length:1;for(Xe=0;Xe<xt;Xe++){for(d=kt?fe.features[Xe].geometry:Ht?fe.geometry:fe,Be=kt?fe.features[Xe].properties:Ht?fe.properties:{},ut=kt?fe.features[Xe].bbox:Ht?fe.bbox:void 0,mt=kt?fe.features[Xe].id:Ht?fe.id:void 0,ge=d?d.type==="GeometryCollection":!1,k=ge?d.geometries.length:1,rt=0;rt<k;rt++){if(yt=ge?d.geometries[rt]:d,yt===null){if(ot(null,Ke,Be,ut,mt)===!1)return!1;continue}switch(yt.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(ot(yt,Ke,Be,ut,mt)===!1)return!1;break}case"GeometryCollection":{for(oe=0;oe<yt.geometries.length;oe++)if(ot(yt.geometries[oe],Ke,Be,ut,mt)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Ke++}}function M_(fe,ot,Xe){var oe=Xe;return S_(fe,function(rt,yt,k,d,ge){yt===0&&Xe===void 0?oe=rt:oe=ot(oe,rt,yt,k,d,ge)}),oe}function Yg(fe,ot={}){if(fe.bbox!=null&&ot.recompute!==!0)return fe.bbox;const Xe=[1/0,1/0,-1/0,-1/0];return Xg(fe,oe=>{Xe[0]>oe[0]&&(Xe[0]=oe[0]),Xe[1]>oe[1]&&(Xe[1]=oe[1]),Xe[2]<oe[0]&&(Xe[2]=oe[0]),Xe[3]<oe[1]&&(Xe[3]=oe[1])}),Xe}var Lm=Yg;function E_({feature:fe,onSelect:ot,isSelected:Xe,isPreviewOn:oe,onTogglePreview:rt}){const[yt,k]=Ot.useState(!1),[d,ge]=Ot.useState(null),Be=Ot.useRef(null);Ot.useEffect(()=>{Xe?(k(!0),setTimeout(()=>{Be.current&&Be.current.scrollIntoView({behavior:"smooth",block:"center"})},100)):k(!1)},[Xe]);const ut=fe.properties,mt=It=>!It||It==="Unknown Date"?"Unknown Date":new Date(It).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}),Ke=It=>It?It.charAt(0).toUpperCase()+It.slice(1).toLowerCase():"",kt=It=>{if(!It)return"Unknown";const bt=It.toLowerCase();return bt==="uav"||bt==="drone"?"Drone":Ke(It)},Ht=()=>{const bt=ut.uuid.split("/"),li=bt[bt.length-1].replace(".tif","").replace(".tiff","");return{uploadId:bt[bt.length-3],filename:li}},xt=()=>{const{uploadId:It,filename:bt}=Ht();return`https://tiles.openaerialmap.org/${It}/0/${bt}/{z}/{x}/{y}`},me=It=>{It.stopPropagation(),k(!yt)},$t=It=>{It.stopPropagation(),ot(null)},jt=(It,bt,li)=>{It.stopPropagation(),navigator.clipboard.writeText(bt),ge(li),setTimeout(()=>ge(null),2e3)},dt=It=>{It.stopPropagation(),rt()},Dt=async It=>{It.stopPropagation();const bt=xt(),li=`OAM - ${ut.title||ut.id}`,Vi=`tms[22]:${bt}`,cn=`http://127.0.0.1:8111/imagery?title=${encodeURIComponent(li)}&type=tms&url=${encodeURIComponent(Vi)}`;try{await fetch(cn)}catch{alert("Could not connect to JOSM. Make sure JOSM is running and 'Remote Control' is enabled.")}},Yt=It=>{It.stopPropagation();const bt=xt(),li=Lm(fe),Vi=(li[0]+li[2])/2,cn=(li[1]+li[3])/2,hn=16,Mi=`custom:${bt}`,dn=`https://www.openstreetmap.org/edit?editor=id#map=${hn}/${cn}/${Vi}&background=${encodeURIComponent(Mi)}`;window.open(dn,"_blank")};return Le.jsxs("div",{ref:Be,onClick:()=>ot(fe),className:`group border-b transition-all duration-200 relative ${Xe?"bg-white border-l-4 border-l-cyan-500 shadow-md my-2 rounded-r-md":"border-gray-100 bg-white hover:bg-gray-50 border-l-4 border-l-transparent"}`,children:[Xe&&Le.jsx("button",{onClick:$t,className:"absolute top-2 right-2 text-gray-400 hover:text-cyan-600 p-1 hover:bg-gray-100 rounded-full z-10",title:"Deselect",children:Le.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:Le.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),Le.jsxs("div",{className:"p-4",children:[Le.jsxs("div",{className:"aspect-video bg-gray-100 rounded-md mb-3 overflow-hidden relative border border-gray-200 shadow-inner",children:[ut.thumbnail?Le.jsx("img",{src:ut.thumbnail,alt:"Preview",className:"w-full h-full object-cover",loading:"lazy"}):Le.jsx("div",{className:"flex items-center justify-center h-full text-gray-400 text-xs",children:"No Preview"}),Le.jsx("button",{onClick:dt,className:`absolute top-2 left-2 p-1.5 rounded shadow-sm border transition-all z-10 ${oe?"bg-cyan-500 text-white border-cyan-600 hover:bg-cyan-600":"bg-white/90 text-gray-500 border-gray-200 hover:text-cyan-600 hover:bg-white"}`,title:oe?"Hide on map":"Show on map",children:oe?Le.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:[Le.jsx("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),Le.jsx("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}):Le.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[Le.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),Le.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),Le.jsx("div",{className:"flex justify-between items-start gap-2 pr-6",children:Le.jsx("h3",{className:`font-bold text-sm leading-tight ${Xe?"text-cyan-700":"text-gray-800"}`,children:ut.title})}),Le.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-2",children:[Le.jsx("span",{className:"font-medium text-gray-700",children:mt(ut.date)}),Le.jsx("span",{className:"text-gray-300",children:""}),Le.jsx("span",{className:"truncate max-w-[150px]",title:ut.provider,children:ut.provider})]}),Le.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-gray-100",children:[Le.jsxs("button",{onClick:me,className:"flex-1 text-xs font-semibold text-gray-500 hover:text-cyan-600 flex items-center justify-center gap-1 py-1.5 transition-colors",children:[yt?"Hide Details":"Show Details",Le.jsx("span",{className:"text-[9px] transform transition-transform duration-200",style:{transform:yt?"rotate(180deg)":"rotate(0deg)"},children:""})]}),Le.jsx("a",{href:ut.uuid,target:"_blank",rel:"noreferrer",download:!0,onClick:It=>It.stopPropagation(),className:"flex-1 text-xs font-semibold text-cyan-600 bg-cyan-50 hover:bg-cyan-100 py-1.5 rounded text-center transition-colors",children:"Download GeoTIFF"})]})]}),yt&&Le.jsxs("div",{className:"bg-gray-50 px-4 py-4 text-xs border-t border-gray-100 text-gray-600 animate-fade-in",children:[Le.jsx("div",{className:"mb-4 pb-3 border-b border-gray-200",children:Le.jsxs("div",{className:"flex gap-2",children:[Le.jsx("button",{onClick:It=>jt(It,xt(),"tms"),className:"flex-1 bg-white border border-gray-300 text-gray-600 py-1.5 rounded hover:bg-gray-100 hover:border-gray-400 transition-all shadow-sm",children:d==="tms"?Le.jsx("span",{className:"text-green-600 font-bold",children:"Copied!"}):"Copy TMS"}),Le.jsx("button",{onClick:Yt,className:"flex-1 bg-white border border-gray-300 text-gray-600 py-1.5 rounded hover:bg-gray-100 hover:border-gray-400 transition-all shadow-sm",children:"Open iD"}),Le.jsx("button",{onClick:Dt,className:"flex-1 bg-white border border-gray-300 text-gray-600 py-1.5 rounded hover:bg-gray-100 hover:border-gray-400 transition-all shadow-sm",children:"Open JOSM"})]})}),Le.jsxs("div",{className:"grid grid-cols-2 gap-y-3 gap-x-4",children:[Le.jsxs("div",{children:[Le.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"Platform Type"}),kt(ut.platform)]}),Le.jsxs("div",{children:[Le.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"Sensor"}),Ke(ut.sensor)]}),Le.jsxs("div",{children:[Le.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"GSD (Resolution)"}),ut.gsd]}),Le.jsxs("div",{children:[Le.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"File Size"}),ut.file_size||"Unknown"]}),Le.jsxs("div",{children:[Le.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"License"}),Le.jsx("a",{href:"https://creativecommons.org/licenses/",target:"_blank",rel:"noreferrer",className:"hover:underline hover:text-cyan-600 truncate block",title:ut.license,children:ut.license})]}),Le.jsxs("div",{className:"min-w-0",children:[Le.jsx("span",{className:"block text-[10px] uppercase text-gray-400 font-bold",children:"ID"}),Le.jsx("span",{className:"font-mono text-[10px] text-gray-500 block truncate select-all cursor-text bg-gray-100 px-1 rounded",title:ut.id,children:ut.id})]})]})]})]})}const _g=10;function A_({features:fe,onSelect:ot,selectedFeature:Xe,isLoading:oe,limit:rt,layerMode:yt,previewedIds:k,hiddenIds:d,onTogglePreview:ge}){const[Be,ut]=Ot.useState(_g),mt=Ot.useRef(null);Ot.useEffect(()=>{ut(_g),mt.current&&(mt.current.scrollTop=0)},[fe]),Ot.useEffect(()=>{if(Xe){const me=fe.findIndex($t=>$t.properties.id===Xe.properties.id);me>=Be&&ut(me+5)}},[Xe,fe,Be]);const Ke=()=>{ut(me=>Math.min(me+_g,fe.length))},kt=()=>oe?"Loading...":fe.length===0?"No images found in view":fe.length>=rt?`Showing most recent ${rt} images`:`${fe.length} image${fe.length!==1?"s":""} in view`,Ht=fe.slice(0,Be),xt=me=>yt==="previews"?!d.has(me):k.has(me);return Le.jsxs("div",{ref:mt,className:"flex-1 overflow-y-auto bg-gray-50 relative scroll-smooth font-sans",children:[Le.jsxs("div",{className:"p-5 border-b border-gray-200 bg-white sticky top-0 z-20 shadow-sm",children:[Le.jsx("div",{className:"flex items-center gap-3 mb-2",children:Le.jsx("img",{src:"https://map.openaerialmap.org/static/media/oam-logo-h-pos.a507b97d.svg",alt:"OpenAerialMap",className:"h-8"})}),Le.jsxs("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider flex items-center gap-2",children:[Le.jsx("span",{className:`w-2 h-2 rounded-full ${oe?"bg-gray-300 animate-pulse":"bg-cyan-500"}`}),kt()]})]}),Le.jsx("div",{className:"p-4 space-y-4",children:oe&&fe.length===0?Le.jsx("div",{className:"flex justify-center py-8",children:Le.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-700"})}):fe.length>0?Le.jsxs(Le.Fragment,{children:[Ht.map(me=>Le.jsx(E_,{feature:me,onSelect:ot,isSelected:Xe&&Xe.properties.id===me.properties.id,isPreviewOn:xt(me.properties.id),onTogglePreview:()=>ge(me.properties.id)},me.properties.id)),Be<fe.length&&Le.jsxs("button",{onClick:Ke,className:"w-full py-3 bg-white border border-gray-300 text-gray-600 font-semibold rounded hover:bg-gray-50 hover:text-cyan-600 transition-colors shadow-sm",children:["Load More (",fe.length-Be," remaining)"]})]}):!oe&&Le.jsx("p",{className:"text-center text-gray-500 py-8",children:"Try moving the map or changing filters."})}),oe&&fe.length>0&&Le.jsx("div",{className:"absolute inset-0 bg-white/50 z-30 pointer-events-none flex items-start justify-center pt-20",children:Le.jsx("div",{className:"bg-white p-2 rounded-full shadow-md",children:Le.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-cyan-700"})})})]})}var Bm={exports:{}};var C_=Bm.exports,Gg;function z_(){return Gg||(Gg=1,(function(fe,ot){(function(Xe,oe){fe.exports=oe()})(C_,(function(){var Xe={},oe={};function rt(k,d,ge){if(oe[k]=ge,k==="index"){var Be="var sharedModule = {}; ("+oe.shared+")(sharedModule); ("+oe.worker+")(sharedModule);",ut={};return oe.shared(ut),oe.index(Xe,ut),typeof window<"u"&&Xe.setWorkerUrl(window.URL.createObjectURL(new Blob([Be],{type:"text/javascript"}))),Xe}}rt("shared",["exports"],(function(k){function d(n,e,i,o){return new(i||(i=Promise))((function(u,f){function p(T){try{x(o.next(T))}catch(E){f(E)}}function y(T){try{x(o.throw(T))}catch(E){f(E)}}function x(T){var E;T.done?u(T.value):(E=T.value,E instanceof i?E:new i((function(C){C(E)}))).then(p,y)}x((o=o.apply(n,e||[])).next())}))}function ge(n,e){this.x=n,this.y=e}function Be(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ut,mt;typeof SuppressedError=="function"&&SuppressedError,ge.prototype={clone(){return new ge(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround(n,e){const i=Math.cos(n),o=Math.sin(n),u=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ge},ge.convert=function(n){if(n instanceof ge)return n;if(Array.isArray(n))return new ge(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new ge(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};var Ke=(function(){if(mt)return ut;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return mt=1,ut=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=f/p}var y=0,x=1;for(o=e,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));u++)e>f?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},ut})(),kt=Be(Ke);let Ht,xt;function me(){return Ht==null&&(Ht=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ht}function $t(){if(xt==null&&(xt=!1,me())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let o=0;o<25;o++){const u=4*o;e.fillStyle=`rgb(${u},${u+1},${u+2})`,e.fillRect(o%5,Math.floor(o/5),1,1)}const i=e.getImageData(0,0,5,5).data;for(let o=0;o<100;o++)if(o%4!=3&&i[o]!==o){xt=!0;break}}}return xt||!1}var jt=1e-6,dt=typeof Float32Array<"u"?Float32Array:Array;function Dt(){var n=new dt(9);return dt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Yt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function It(){var n=new dt(3);return dt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function bt(n){var e=n[0],i=n[1],o=n[2];return Math.sqrt(e*e+i*i+o*o)}function li(n,e,i){var o=new dt(3);return o[0]=n,o[1]=e,o[2]=i,o}function Vi(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function cn(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function hn(n,e,i){var o=e[0],u=e[1],f=e[2],p=i[0],y=i[1],x=i[2];return n[0]=u*x-f*y,n[1]=f*p-o*x,n[2]=o*y-u*p,n}var Mi,dn=bt;function Kn(n,e,i){var o=e[0],u=e[1],f=e[2],p=e[3];return n[0]=i[0]*o+i[4]*u+i[8]*f+i[12]*p,n[1]=i[1]*o+i[5]*u+i[9]*f+i[13]*p,n[2]=i[2]*o+i[6]*u+i[10]*f+i[14]*p,n[3]=i[3]*o+i[7]*u+i[11]*f+i[15]*p,n}function Hi(){var n=new dt(4);return dt!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Ve(n,e,i,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",f=Math.PI/360;e*=f,o*=f,i*=f;var p=Math.sin(e),y=Math.cos(e),x=Math.sin(i),T=Math.cos(i),E=Math.sin(o),C=Math.cos(o);switch(u){case"xyz":n[0]=p*T*C+y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C-p*x*E;break;case"xzy":n[0]=p*T*C-y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C+p*x*E;break;case"yxz":n[0]=p*T*C+y*x*E,n[1]=y*x*C-p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C+p*x*E;break;case"yzx":n[0]=p*T*C+y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C-p*x*E;break;case"zxy":n[0]=p*T*C-y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E+p*x*C,n[3]=y*T*C-p*x*E;break;case"zyx":n[0]=p*T*C-y*x*E,n[1]=y*x*C+p*T*E,n[2]=y*T*E-p*x*C,n[3]=y*T*C+p*x*E;break;default:throw new Error("Unknown angle order "+u)}return n}function st(){var n=new dt(2);return dt!=Float32Array&&(n[0]=0,n[1]=0),n}function Lt(n,e){var i=new dt(2);return i[0]=n,i[1]=e,i}It(),Mi=new dt(4),dt!=Float32Array&&(Mi[0]=0,Mi[1]=0,Mi[2]=0,Mi[3]=0),It(),li(1,0,0),li(0,1,0),Hi(),Hi(),Dt(),st();const Re=8192;function tt(n,e,i){return e*(Re/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}function ie(n,e){return(n%e+e)%e}function Ae(n,e,i){return n*(1-i)+e*i}function it(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function Qe(n,e,i,o){const u=new kt(n,e,i,o);return f=>u.solve(f)}const ht=Qe(.25,.1,.25,1);function ft(n,e,i){return Math.min(i,Math.max(e,n))}function Et(n,e,i){const o=i-e,u=((n-e)%o+o)%o+e;return u===e?i:u}function ii(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}let wi=1;function Jn(n,e,i){const o={};for(const u in n)o[u]=e.call(this,n[u],u,n);return o}function qs(n,e,i){const o={};for(const u in n)e.call(this,n[u],u,n)&&(o[u]=n[u]);return o}function Qr(n){return Array.isArray(n)?n.map(Qr):typeof n=="object"&&n?Jn(n,Qr):n}const fl={};function tn(n){fl[n]||(typeof console<"u"&&console.warn(n),fl[n]=!0)}function Or(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function ma(n){return typeof WorkerGlobalScope<"u"&&n!==void 0&&n instanceof WorkerGlobalScope}let fn=null;function gs(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const _s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Zs(n,e,i,o,u){return d(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(n,{timestamp:0});try{const p=f?.format;if(!p||!p.startsWith("BGR")&&!p.startsWith("RGB"))throw new Error(`Unrecognized format ${p}`);const y=p.startsWith("BGR"),x=new Uint8ClampedArray(o*u*4);if(yield f.copyTo(x,(function(T,E,C,D,I){const L=4*Math.max(-E,0),O=(Math.max(0,C)-C)*D*4+L,N=4*D,G=Math.max(0,E),J=Math.max(0,C);return{rect:{x:G,y:J,width:Math.min(T.width,E+D)-G,height:Math.min(T.height,C+I)-J},layout:[{offset:O,stride:N}]}})(n,e,i,o,u)),y)for(let T=0;T<x.length;T+=4){const E=x[T];x[T]=x[T+2],x[T+2]=E}return x}finally{f.close()}}))}let Ha,za;function pl(n,e,i,o){return n.addEventListener(e,i,o),{unsubscribe:()=>{n.removeEventListener(e,i,o)}}}function er(n){return n*Math.PI/180}function Fr(n){return n/Math.PI*180}const ve={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},V={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},j="AbortError";class H extends Error{constructor(e=j){super(e instanceof Error?e.message:e),this.name=j,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function se(n){return n.name===j}const ue={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Te(n){return ue.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))]}const _e="global-dispatcher";class he extends Error{constructor(e,i,o,u){super(`AJAXError: ${i} (${e}): ${o}`),this.status=e,this.statusText=i,this.url=o,this.body=u}}const Se=()=>ma(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,je=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){const o=Te(n.url);if(o)return o(n,e);if(ma(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,targetMapId:_e},e)}if(!(/^file:/.test(i=n.url)||/^file:/.test(Se())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(o,u){return d(this,void 0,void 0,(function*(){const f=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Se(),signal:u.signal});let p,y;o.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");try{p=yield fetch(f)}catch(T){throw se(T)?T:new he(0,T.message,o.url,new Blob)}if(!p.ok){const T=yield p.blob();throw new he(p.status,p.statusText,o.url,T)}y=o.type==="arrayBuffer"||o.type==="image"?p.arrayBuffer():o.type==="json"?p.json():p.text();const x=yield y;return u.signal.throwIfAborted(),{data:x,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}}))})(n,e);if(ma(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:n,mustQueue:!0,targetMapId:_e},e)}var i;return(function(o,u){return new Promise(((f,p)=>{var y;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const T in o.headers)x.setRequestHeader(T,o.headers[T]);o.type==="json"&&(x.responseType="text",!((y=o.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{p(new Error(x.statusText))},x.onload=()=>{if(!u.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(o.type==="json")try{T=JSON.parse(x.response)}catch(E){return void p(E)}f({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});p(new he(x.status,x.statusText,o.url,T))}},u.signal.addEventListener("abort",(()=>{x.abort(),p(new H(u.signal.reason))})),x.send(o.body)}))})(n,e)};function Ue(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),i=window.location;return e.protocol===i.protocol&&e.host===i.host}function gt(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Mt(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class Ft{constructor(e,i={}){ii(this,i),this.type=e}}class yi extends Ft{constructor(e,i={}){super("error",ii({error:e},i))}}class ui{on(e,i){return this._listeners=this._listeners||{},gt(e,i,this._listeners),{unsubscribe:()=>{this.off(e,i)}}}off(e,i){return Mt(e,i,this._listeners),Mt(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},gt(e,i,this._oneTimeListeners),this):new Promise((o=>this.once(e,o)))}fire(e,i){typeof e=="string"&&(e=new Ft(e,i||{}));const o=e.type;if(this.listens(o)){e.target=this;const u=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const y of u)y.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const y of f)Mt(o,y,this._oneTimeListeners),y.call(this,e);const p=this._eventedParent;p&&(ii(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof yi&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ti=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Cn(n,e){const i={};for(const o in n)o!=="ref"&&(i[o]=n[o]);return Ti.forEach((o=>{o in e&&(i[o]=e[o])})),i}function Ut(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Ut(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!Ut(n[i],e[i]))return!1;return!0}return n===e}function Si(n,e){n.push(e)}function $n(n,e,i){Si(i,{command:"addSource",args:[n,e[n]]})}function Ei(n,e,i){Si(e,{command:"removeSource",args:[n]}),i[n]=!0}function wn(n,e,i,o){Ei(n,i,o),$n(n,e,i)}function Li(n,e,i){let o;for(o in n[i])if(Object.prototype.hasOwnProperty.call(n[i],o)&&o!=="data"&&!Ut(n[i][o],e[i][o]))return!1;for(o in e[i])if(Object.prototype.hasOwnProperty.call(e[i],o)&&o!=="data"&&!Ut(n[i][o],e[i][o]))return!1;return!0}function zn(n,e,i,o,u,f){n=n||{},e=e||{};for(const p in n)Object.prototype.hasOwnProperty.call(n,p)&&(Ut(n[p],e[p])||i.push({command:f,args:[o,p,e[p],u]}));for(const p in e)Object.prototype.hasOwnProperty.call(e,p)&&!Object.prototype.hasOwnProperty.call(n,p)&&(Ut(n[p],e[p])||i.push({command:f,args:[o,p,e[p],u]}))}function ml(n){return n.id}function So(n,e){return n[e.id]=e,n}class Je{constructor(e,i,o,u){this.message=(e?`${e}: `:"")+o,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function pr(n,...e){for(const i of e)for(const o in i)n[o]=i[o];return n}class mr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Da{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,u]of i)this.bindings[o]=u}concat(e){return new Da(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ui={kind:"null"},nt={kind:"number"},qt={kind:"string"},Wt={kind:"boolean"},Kr={kind:"color"},rc={kind:"projectionDefinition"},$a={kind:"object"},Gt={kind:"value"},Mo={kind:"collator"},Xa={kind:"formatted"},ys={kind:"padding"},Ya={kind:"colorArray"},Wa={kind:"numberArray"},pn={kind:"resolvedImage"},gl={kind:"variableAnchorOffsetCollection"};function gr(n,e){return{kind:"array",itemType:n,N:e}}function ci(n){if(n.kind==="array"){const e=ci(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const vs=[Ui,nt,qt,Wt,Kr,rc,Xa,$a,gr(Gt),ys,Wa,Ya,pn,gl];function _l(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!_l(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of vs)if(!_l(i,e))return null}}return`Expected ${ci(n)} but found ${ci(e)} instead.`}function yl(n,e){return e.some((i=>i.kind===n.kind))}function Hs(n,e){return e.some((i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n))}function Ia(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const au=.96422,Qa=.82521,ga=4/29,pi=6/29,uh=3*pi*pi,_d=pi*pi*pi,Eo=Math.PI/180,ch=180/Math.PI;function su(n){return(n%=360)<0&&(n+=360),n}function yd([n,e,i,o]){let u,f;const p=ou((.2225045*(n=Tr(n))+.7168786*(e=Tr(e))+.0606169*(i=Tr(i)))/1);n===e&&e===i?u=f=p:(u=ou((.4360747*n+.3850649*e+.1430804*i)/au),f=ou((.0139322*n+.0971045*e+.7141733*i)/Qa));const y=116*p-16;return[y<0?0:y,500*(u-p),200*(p-f),o]}function Tr(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function ou(n){return n>_d?Math.pow(n,1/3):n/uh+ga}function ac([n,e,i,o]){let u=(n+16)/116,f=isNaN(e)?u:u+e/500,p=isNaN(i)?u:u-i/200;return u=1*$s(u),f=au*$s(f),p=Qa*$s(p),[lu(3.1338561*f-1.6168667*u-.4906146*p),lu(-.9787684*f+1.9161415*u+.033454*p),lu(.0719453*f-.2289914*u+1.4052427*p),o]}function lu(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function $s(n){return n>pi?n*n*n:uh*(n-ga)}const vd=Object.hasOwn||function(n,e){return Object.prototype.hasOwnProperty.call(n,e)};function vl(n,e){return vd(n,e)?n[e]:void 0}function xs(n){return parseInt(n.padEnd(2,n),16)/255}function xd(n,e){return Ao(e?n/100:n,0,1)}function Ao(n,e,i){return Math.min(Math.max(e,n),i)}function sc(n){return!n.some(Number.isNaN)}const Co={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Xs(n,e,i){return n+i*(e-n)}function xl(n,e,i){return n.map(((o,u)=>Xs(o,e[u],i)))}class Xt{constructor(e,i,o,u=1,f=!0){this.r=e,this.g=i,this.b=o,this.a=u,f||(this.r*=u,this.g*=u,this.b*=u,u||this.overwriteGetter("rgb",[e,i,o,u]))}static parse(e){if(e instanceof Xt)return e;if(typeof e!="string")return;const i=(function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const u=vl(Co,o);if(u){const[p,y,x]=u;return[p/255,y/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const p=o.length<6?1:2;let y=1;return[xs(o.slice(y,y+=p)),xs(o.slice(y,y+=p)),xs(o.slice(y,y+=p)),xs(o.slice(y,y+p)||"ff")]}if(o.startsWith("rgb")){const p=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[y,x,T,E,C,D,I,L,O,N,G,J]=p,q=[E||" ",I||" ",N].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const $=[T,D,O].join(""),te=$==="%%%"?100:$===""?255:0;if(te){const re=[Ao(+x/te,0,1),Ao(+C/te,0,1),Ao(+L/te,0,1),G?xd(+G,J):1];if(sc(re))return re}}return}}const f=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[p,y,x,T,E,C,D,I,L]=f,O=[x||" ",E||" ",D].join("");if(O==="  "||O==="  /"||O===",,"||O===",,,"){const N=[+y,Ao(+T,0,100),Ao(+C,0,100),I?xd(+I,L):1];if(sc(N))return(function([G,J,q,$]){function te(re){const we=(re+G/30)%12,Ne=J*Math.min(q,1-q);return q-Ne*Math.max(-1,Math.min(we-3,9-we,1))}return G=su(G),J/=100,q/=100,[te(0),te(8),te(4),$]})(N)}}})(e);return i?new Xt(...i,!1):void 0}get rgb(){const{r:e,g:i,b:o,a:u}=this,f=u||1/0;return this.overwriteGetter("rgb",[e/f,i/f,o/f,u])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[i,o,u,f]=yd(e),p=Math.sqrt(o*o+u*u);return[Math.round(1e4*p)?su(Math.atan2(u,o)*ch):NaN,p,i,f]})(this.rgb))}get lab(){return this.overwriteGetter("lab",yd(this.rgb))}overwriteGetter(e,i){return Object.defineProperty(this,e,{value:i}),i}toString(){const[e,i,o,u]=this.rgb;return`rgba(${[e,i,o].map((f=>Math.round(255*f))).join(",")},${u})`}static interpolate(e,i,o,u="rgb"){switch(u){case"rgb":{const[f,p,y,x]=xl(e.rgb,i.rgb,o);return new Xt(f,p,y,x,!1)}case"hcl":{const[f,p,y,x]=e.hcl,[T,E,C,D]=i.hcl;let I,L;if(isNaN(f)||isNaN(T))isNaN(f)?isNaN(T)?I=NaN:(I=T,y!==1&&y!==0||(L=E)):(I=f,C!==1&&C!==0||(L=p));else{let q=T-f;T>f&&q>180?q-=360:T<f&&f-T>180&&(q+=360),I=f+o*q}const[O,N,G,J]=(function([q,$,te,re]){return q=isNaN(q)?0:q*Eo,ac([te,Math.cos(q)*$,Math.sin(q)*$,re])})([I,L??Xs(p,E,o),Xs(y,C,o),Xs(x,D,o)]);return new Xt(O,N,G,J,!1)}case"lab":{const[f,p,y,x]=ac(xl(e.lab,i.lab,o));return new Xt(f,p,y,x,!1)}}}}Xt.black=new Xt(0,0,0,1),Xt.white=new Xt(1,1,1,1),Xt.transparent=new Xt(0,0,0,0),Xt.red=new Xt(1,0,0,1);class Pa{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const hh=["bottom","center","top"];class uu{constructor(e,i,o,u,f,p){this.text=e,this.image=i,this.scale=o,this.fontStack=u,this.textColor=f,this.verticalAlign=p}}class Xn{constructor(e){this.sections=e}static fromString(e){return new Xn([new uu(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof Xn?e:Xn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class Dn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Dn)return e;if(typeof e=="number")return new Dn([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Dn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new Dn(xl(e.values,i.values,o))}}class $i{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof $i)return e;if(typeof e=="number")return new $i([e]);if(Array.isArray(e)){for(const i of e)if(typeof i!="number")return;return new $i(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){return new $i(xl(e.values,i.values,o))}}class Bt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Bt)return e;if(typeof e=="string"){const o=Xt.parse(e);return o?new Bt([o]):void 0}if(!Array.isArray(e))return;const i=[];for(const o of e){if(typeof o!="string")return;const u=Xt.parse(o);if(!u)return;i.push(u)}return new Bt(i)}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o,u="rgb"){const f=[];if(e.values.length!=i.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${i.values.length}), cannot interpolate.`);for(let p=0;p<e.values.length;p++)f.push(Xt.interpolate(e.values[p],i.values[p],o,u));return new Bt(f)}}class Bi extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const _a=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class mn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof mn)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let i=0;i<e.length;i+=2){const o=e[i],u=e[i+1];if(typeof o!="string"||!_a.has(o)||!Array.isArray(u)||u.length!==2||typeof u[0]!="number"||typeof u[1]!="number")return}return new mn(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,i,o){const u=e.values,f=i.values;if(u.length!==f.length)throw new Bi(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${i.toString()}`);const p=[];for(let y=0;y<u.length;y+=2){if(u[y]!==f[y])throw new Bi(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${u[y]}, to[${y}]: ${f[y]}`);p.push(u[y]);const[x,T]=u[y+1],[E,C]=f[y+1];p.push([Xs(x,E,o),Xs(T,C,o)])}return new mn(p)}}class Sr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Sr({name:e,available:!1}):null}}class Yn{constructor(e,i,o){this.from=e,this.to=i,this.transition=o}static interpolate(e,i,o){return new Yn(e,i,o)}static parse(e){return e instanceof Yn?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new Yn(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new Yn(e.from,e.to,e.transition):typeof e=="string"?new Yn(e,e,1):void 0}}function Jr(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ka(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Yn||n instanceof Xt||n instanceof Pa||n instanceof Xn||n instanceof Dn||n instanceof $i||n instanceof Bt||n instanceof mn||n instanceof Sr)return!0;if(Array.isArray(n)){for(const e of n)if(!Ka(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Ka(n[e]))return!1;return!0}return!1}function Xi(n){if(n===null)return Ui;if(typeof n=="string")return qt;if(typeof n=="boolean")return Wt;if(typeof n=="number")return nt;if(n instanceof Xt)return Kr;if(n instanceof Yn)return rc;if(n instanceof Pa)return Mo;if(n instanceof Xn)return Xa;if(n instanceof Dn)return ys;if(n instanceof $i)return Wa;if(n instanceof Bt)return Ya;if(n instanceof mn)return gl;if(n instanceof Sr)return pn;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const u=Xi(o);if(i){if(i===u)continue;i=Gt;break}i=u}return gr(i||Gt,e)}return $a}function Ys(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Xt||n instanceof Yn||n instanceof Xn||n instanceof Dn||n instanceof $i||n instanceof Bt||n instanceof mn||n instanceof Sr?n.toString():JSON.stringify(n)}class ea{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ka(e[1]))return i.error("invalid value");const o=e[1];let u=Xi(o);const f=i.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new ea(u,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const zo={string:qt,number:nt,boolean:Wt,object:$a};class Mr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,u=1;const f=e[0];if(f==="array"){let y,x;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in zo)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=zo[T],u++}else y=Gt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],u++}o=gr(y,x)}else{if(!zo[f])throw new Error(`Types doesn't contain name = ${f}`);o=zo[f]}const p=[];for(;u<e.length;u++){const y=i.parse(e[u],u,Gt);if(!y)return null;p.push(y)}return new Mr(o,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!_l(this.type,Xi(o)))return o;if(i===this.args.length-1)throw new Bi(`Expected value to be of type ${ci(this.type)}, but found ${ci(Xi(o))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Bn={"to-boolean":Wt,"to-color":Kr,"to-number":nt,"to-string":qt};class Er{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0];if(!Bn[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");const u=Bn[o],f=[];for(let p=1;p<e.length;p++){const y=i.parse(e[p],p,Gt);if(!y)return null;f.push(y)}return new Er(u,f)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let i,o;for(const u of this.args){if(i=u.evaluate(e),o=null,i instanceof Xt)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rgba value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Jr(i[0],i[1],i[2],i[3]),!o))return new Xt(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Bi(o||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"padding":{let i;for(const o of this.args){i=o.evaluate(e);const u=Dn.parse(i);if(u)return u}throw new Bi(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"numberArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=$i.parse(i);if(u)return u}throw new Bi(`Could not parse numberArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"colorArray":{let i;for(const o of this.args){i=o.evaluate(e);const u=Bt.parse(i);if(u)return u}throw new Bi(`Could not parse colorArray from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"variableAnchorOffsetCollection":{let i;for(const o of this.args){i=o.evaluate(e);const u=mn.parse(i);if(u)return u}throw new Bi(`Could not parse variableAnchorOffsetCollection from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}case"number":{let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Bi(`Could not convert ${JSON.stringify(i)} to number.`)}case"formatted":return Xn.fromString(Ys(this.args[0].evaluate(e)));case"resolvedImage":return Sr.fromString(Ys(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Ys(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const cu=["Unknown","Point","LineString","Polygon"];class Do{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?cu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache.get(e);return i||(i=Xt.parse(e),this._parseColorCache.set(e,i)),i}}class Io{constructor(e,i,o=[],u,f=new Da,p=[]){this.registry=e,this.path=o,this.key=o.map((y=>`[${y}]`)).join(""),this.scope=f,this.errors=p,this.expectedType=u,this._isConstant=i}parse(e,i,o,u,f={}){return i?this.concat(i,o,u)._parse(e,f):this._parse(e,f)}_parse(e,i){function o(u,f,p){return p==="assert"?new Mr(f,[u]):p==="coerce"?new Er(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let p=f.parse(e,this);if(!p)return null;if(this.expectedType){const y=this.expectedType,x=p.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(x.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(x.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(x.kind)||y.kind==="colorArray"&&["value","string","array"].includes(x.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(x.kind))p=o(p,y,i.typeAnnotation||"coerce");else if(this.checkSubtype(y,x))return null}else p=o(p,y,i.typeAnnotation||"assert")}if(!(p instanceof ea)&&p.type.kind!=="resolvedImage"&&this._isConstant(p)){const y=new Do;try{p=new ea(p.type,p.evaluate(y))}catch(x){return this.error(x.message),null}}return p}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){const u=typeof e=="number"?this.path.concat(e):this.path,f=o?this.scope.concat(o):this.scope;return new Io(this.registry,this._isConstant,u,i||null,f,this.errors)}error(e,...i){const o=`${this.key}${i.map((u=>`[${u}]`)).join("")}`;this.errors.push(new mr(o,e))}checkSubtype(e,i){const o=_l(e,i);return o&&this.error(o),o}}class Ai{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let f=1;f<e.length-1;f+=2){const p=e[f];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,f);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=i.parse(e[f+1],f+1);if(!y)return null;o.push([p,y])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return u?new Ai(o,u):null}outputDefined(){return this.result.outputDefined()}}class Ws{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Ws(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Kt{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,nt),u=i.parse(e[2],2,gr(i.expectedType||Gt));return o&&u?new Kt(u.type.itemType,o,u):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Bi(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Bi(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Bi(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Zt{constructor(e,i){this.type=Wt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Gt),u=i.parse(e[2],2,Gt);return o&&u?yl(o.type,[Wt,qt,nt,Ui,Gt])?new Zt(o,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!Hs(i,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${ci(Xi(i))} instead.`);if(!Hs(o,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${ci(Xi(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Po{constructor(e,i,o){this.type=nt,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Gt),u=i.parse(e[2],2,Gt);if(!o||!u)return null;if(!yl(o.type,[Wt,qt,nt,Ui,Gt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ci(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,nt);return f?new Po(o,u,f):null}return new Po(o,u)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Hs(i,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${ci(Xi(i))} instead.`);let u;if(this.fromIndex&&(u=this.fromIndex.evaluate(e)),Hs(o,["string"])){const f=o.indexOf(i,u);return f===-1?-1:[...o.slice(0,f)].length}if(Hs(o,["array"]))return o.indexOf(i,u);throw new Bi(`Expected second argument to be of type array or string, but found ${ci(Xi(o))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class hi{constructor(e,i,o,u,f,p){this.inputType=e,this.type=i,this.input=o,this.cases=u,this.outputs=f,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const f={},p=[];for(let T=2;T<e.length-1;T+=2){let E=e[T];const C=e[T+1];Array.isArray(E)||(E=[E]);const D=i.concat(T);if(E.length===0)return D.error("Expected at least one branch label.");for(const L of E){if(typeof L!="number"&&typeof L!="string")return D.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return D.error("Numeric branch labels must be integer values.");if(o){if(D.checkSubtype(o,Xi(L)))return null}else o=Xi(L);if(f[String(L)]!==void 0)return D.error("Branch labels must be unique.");f[String(L)]=p.length}const I=i.parse(C,T,u);if(!I)return null;u=u||I.type,p.push(I)}const y=i.parse(e[1],1,Gt);if(!y)return null;const x=i.parse(e[e.length-1],e.length-1,u);return x?y.type.kind!=="value"&&i.concat(1).checkSubtype(o,y.type)?null:new hi(o,u,y,f,p,x):null}evaluate(e){const i=this.input.evaluate(e);return(Xi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class hu{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const u=[];for(let p=1;p<e.length-1;p+=2){const y=i.parse(e[p],p,Wt);if(!y)return null;const x=i.parse(e[p+1],p+1,o);if(!x)return null;u.push([y,x]),o=o||x.type}const f=i.parse(e[e.length-1],e.length-1,o);if(!f)return null;if(!o)throw new Error("Can't infer output type");return new hu(o,u,f)}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}}class ya{constructor(e,i,o,u){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Gt),u=i.parse(e[2],2,nt);if(!o||!u)return null;if(!yl(o.type,[gr(Gt),qt,Gt]))return i.error(`Expected first argument to be of type array or string, but found ${ci(o.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,nt);return f?new ya(o.type,o,u,f):null}return new ya(o.type,o,u)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);let u;if(this.endIndex&&(u=this.endIndex.evaluate(e)),Hs(i,["string"]))return[...i].slice(o,u).join("");if(Hs(i,["array"]))return i.slice(o,u);throw new Bi(`Expected first argument to be of type array or string, but found ${ci(Xi(i))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Qs(n,e){const i=n.length-1;let o,u,f=0,p=i,y=0;for(;f<=p;)if(y=Math.floor((f+p)/2),o=n[y],u=n[y+1],o<=e){if(y===i||e<u)return y;f=y+1}else{if(!(o>e))throw new Bi("Input is not a number.");p=y-1}return 0}class Ks{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of o)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,nt);if(!o)return null;const u=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let p=1;p<e.length;p+=2){const y=p===1?-1/0:e[p],x=e[p+1],T=p,E=p+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=i.parse(x,E,f);if(!C)return null;f=f||C.type,u.push([y,C])}return new Ks(f,o,u)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const f=i.length;return u>=i[f-1]?o[f-1].evaluate(e):o[Qs(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function bd(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var du,dh,Cf=(function(){if(dh)return du;function n(e,i,o,u){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=u}return dh=1,du=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,u=0;u<8;u++){var f=this.sampleCurveX(o)-e;if(Math.abs(f)<i)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=f/p}var y=0,x=1;for(o=e,u=0;u<20&&(f=this.sampleCurveX(o),!(Math.abs(f-e)<i));u++)e>f?y=o:x=o,o=.5*(x-y)+y;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},du})(),fh=bd(Cf);class Ar{constructor(e,i,o,u,f){this.type=e,this.operator=i,this.interpolation=o,this.input=u,this.labels=[],this.outputs=[];for(const[p,y]of f)this.labels.push(p),this.outputs.push(y)}static interpolationFactor(e,i,o,u){let f=0;if(e.name==="exponential")f=Ja(i,e.base,o,u);else if(e.name==="linear")f=Ja(i,1,o,u);else if(e.name==="cubic-bezier"){const p=e.controlPoints;f=new fh(p[0],p[1],p[2],p[3]).solve(Ja(i,1,o,u))}return f}static parse(e,i){let[o,u,f,...p]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some((E=>typeof E!="number"||E<0||E>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,nt),!f)return null;const y=[];let x=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||i.expectedType==Ya?i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType):x=Kr;for(let T=0;T<p.length;T+=2){const E=p[T],C=p[T+1],D=T+3,I=T+4;if(typeof E!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=E)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const L=i.parse(C,I,x);if(!L)return null;x=x||L.type,y.push([E,L])}return Ia(x,nt)||Ia(x,rc)||Ia(x,Kr)||Ia(x,ys)||Ia(x,Wa)||Ia(x,Ya)||Ia(x,gl)||Ia(x,gr(nt))?new Ar(x,o,u,f,y):i.error(`Type ${ci(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return o[0].evaluate(e);const f=i.length;if(u>=i[f-1])return o[f-1].evaluate(e);const p=Qs(i,u),y=Ar.interpolationFactor(this.interpolation,u,i[p],i[p+1]),x=o[p].evaluate(e),T=o[p+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Xs(x,T,y);case"color":return Xt.interpolate(x,T,y);case"padding":return Dn.interpolate(x,T,y);case"colorArray":return Bt.interpolate(x,T,y);case"numberArray":return $i.interpolate(x,T,y);case"variableAnchorOffsetCollection":return mn.interpolate(x,T,y);case"array":return xl(x,T,y);case"projectionDefinition":return Yn.interpolate(x,T,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return Xt.interpolate(x,T,y,"hcl");case"colorArray":return Bt.interpolate(x,T,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Xt.interpolate(x,T,y,"lab");case"colorArray":return Bt.interpolate(x,T,y,"lab")}}}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Ja(n,e,i,o){const u=o-i,f=n-i;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}const Yi={color:Xt.interpolate,number:Xs,padding:Dn.interpolate,numberArray:$i.interpolate,colorArray:Bt.interpolate,variableAnchorOffsetCollection:mn.interpolate,array:xl};class Ro{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=null;const u=i.expectedType;u&&u.kind!=="value"&&(o=u);const f=[];for(const y of e.slice(1)){const x=i.parse(y,1+f.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,f.push(x)}if(!o)throw new Error("No output type");const p=u&&f.some((y=>_l(u,y.type)));return new Ro(p?Gt:o,f)}evaluate(e){let i,o=null,u=0;for(const f of this.args)if(u++,o=f.evaluate(e),o&&o instanceof Sr&&!o.available&&(i||(i=o.name),o=null,u===this.args.length&&(o=i)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function fu(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function pu(n,e,i,o){return o.compare(e,i)===0}function gn(n,e,i){const o=n!=="=="&&n!=="!=";return class Wg{constructor(f,p,y){this.type=Wt,this.lhs=f,this.rhs=p,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||p.type.kind==="value"}static parse(f,p){if(f.length!==3&&f.length!==4)return p.error("Expected two or three arguments.");const y=f[0];let x=p.parse(f[1],1,Gt);if(!x)return null;if(!fu(y,x.type))return p.concat(1).error(`"${y}" comparisons are not supported for type '${ci(x.type)}'.`);let T=p.parse(f[2],2,Gt);if(!T)return null;if(!fu(y,T.type))return p.concat(2).error(`"${y}" comparisons are not supported for type '${ci(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${ci(x.type)}' and '${ci(T.type)}'.`);o&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new Mr(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new Mr(x.type,[T])));let E=null;if(f.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(f[3],3,Mo),!E)return null}return new Wg(x,T,E)}evaluate(f){const p=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(o&&this.hasUntypedArgument){const x=Xi(p),T=Xi(y);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new Bi(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=Xi(p),T=Xi(y);if(x.kind!=="string"||T.kind!=="string")return e(f,p,y)}return this.collator?i(f,p,y,this.collator.evaluate(f)):e(f,p,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const wd=gn("==",(function(n,e,i){return e===i}),pu),oc=gn("!=",(function(n,e,i){return e!==i}),(function(n,e,i,o){return!pu(0,e,i,o)})),Td=gn("<",(function(n,e,i){return e<i}),(function(n,e,i,o){return o.compare(e,i)<0})),zf=gn(">",(function(n,e,i){return e>i}),(function(n,e,i,o){return o.compare(e,i)>0})),bl=gn("<=",(function(n,e,i){return e<=i}),(function(n,e,i,o){return o.compare(e,i)<=0})),lc=gn(">=",(function(n,e,i){return e>=i}),(function(n,e,i,o){return o.compare(e,i)>=0}));class wl{constructor(e,i,o){this.type=Mo,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const u=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Wt);if(!u)return null;const f=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Wt);if(!f)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,qt),!p)?null:new wl(u,f,p)}evaluate(e){return new Pa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class ph{constructor(e,i,o,u,f){this.type=qt,this.number=e,this.locale=i,this.currency=o,this.minFractionDigits=u,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,nt);if(!o)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parse(u.locale,1,qt),!f))return null;let p=null;if(u.currency&&(p=i.parse(u.currency,1,qt),!p))return null;let y=null;if(u["min-fraction-digits"]&&(y=i.parse(u["min-fraction-digits"],1,nt),!y))return null;let x=null;return u["max-fraction-digits"]&&(x=i.parse(u["max-fraction-digits"],1,nt),!x)?null:new ph(o,f,p,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class mu{constructor(e){this.type=Xa,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let p=1;p<=e.length-1;++p){const y=e[p];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=i.parse(y["font-scale"],1,nt),!x))return null;let T=null;if(y["text-font"]&&(T=i.parse(y["text-font"],1,gr(qt)),!T))return null;let E=null;if(y["text-color"]&&(E=i.parse(y["text-color"],1,Kr),!E))return null;let C=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!hh.includes(y["vertical-align"]))return i.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(C=i.parse(y["vertical-align"],1,qt),!C)return null}const D=u[u.length-1];D.scale=x,D.font=T,D.textColor=E,D.verticalAlign=C}else{const x=i.parse(e[p],1,Gt);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:x,scale:null,font:null,textColor:null,verticalAlign:null})}}return new mu(u)}evaluate(e){return new Xn(this.sections.map((i=>{const o=i.content.evaluate(e);return Xi(o)===pn?new uu("",o,null,null,null,i.verticalAlign?i.verticalAlign.evaluate(e):null):new uu(Ys(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null,i.verticalAlign?i.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor),i.verticalAlign&&e(i.verticalAlign)}outputDefined(){return!1}}class Tl{constructor(e){this.type=pn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const o=i.parse(e[1],1,qt);return o?new Tl(o):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),o=Sr.fromString(i);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(i)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}}class Sl{constructor(e){this.type=nt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ci(o.type)} instead.`):new Sl(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string")return[...i].length;if(Array.isArray(i))return i.length;throw new Bi(`Expected value to be of type string or array, but found ${ci(Xi(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Tn=8192;function Ml(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Tn),Math.round(o*u*Tn)]}function El(n,e){const i=Math.pow(2,e.z);return[(u=(n[0]/Tn+e.x)/i,360*u-180),(o=(n[1]/Tn+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,u}function Al(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Js(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Sd(n,e,i){const o=n[0]-e[0],u=n[1]-e[1],f=n[0]-i[0],p=n[1]-i[1];return o*p-f*u==0&&o*f<=0&&u*p<=0}function gu(n,e,i,o){return(u=[o[0]-i[0],o[1]-i[1]])[0]*(f=[e[0]-n[0],e[1]-n[1]])[1]-u[1]*f[0]!=0&&!(!cc(n,e,i,o)||!cc(i,o,n,e));var u,f}function Md(n,e,i){for(const o of i)for(let u=0;u<o.length-1;++u)if(gu(n,e,o[u],o[u+1]))return!0;return!1}function Ra(n,e,i=!1){let o=!1;for(const y of e)for(let x=0;x<y.length-1;x++){if(Sd(n,y[x],y[x+1]))return i;(f=y[x])[1]>(u=n)[1]!=(p=y[x+1])[1]>u[1]&&u[0]<(p[0]-f[0])*(u[1]-f[1])/(p[1]-f[1])+f[0]&&(o=!o)}var u,f,p;return o}function uc(n,e){for(const i of e)if(Ra(n,i))return!0;return!1}function Ed(n,e){for(const i of n)if(!Ra(i,e))return!1;for(let i=0;i<n.length-1;++i)if(Md(n[i],n[i+1],e))return!1;return!0}function Ad(n,e){for(const i of e)if(Ed(n,i))return!0;return!1}function cc(n,e,i,o){const u=o[0]-i[0],f=o[1]-i[1],p=(n[0]-i[0])*f-u*(n[1]-i[1]),y=(e[0]-i[0])*f-u*(e[1]-i[1]);return p>0&&y<0||p<0&&y>0}function hc(n,e,i){const o=[];for(let u=0;u<n.length;u++){const f=[];for(let p=0;p<n[u].length;p++){const y=Ml(n[u][p],i);Al(e,y),f.push(y)}o.push(f)}return o}function Lo(n,e,i){const o=[];for(let u=0;u<n.length;u++){const f=hc(n[u],e,i);o.push(f)}return o}function Cl(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const u=.5*o;let f=n[0]-i[0]>u?-o:i[0]-n[0]>u?o:0;f===0&&(f=n[0]-i[2]>u?-o:i[2]-n[0]>u?o:0),n[0]+=f}Al(e,n)}function Cd(n,e,i,o){const u=Math.pow(2,o.z)*Tn,f=[o.x*Tn,o.y*Tn],p=[];for(const y of n)for(const x of y){const T=[x.x+f[0],x.y+f[1]];Cl(T,e,i,u),p.push(T)}return p}function _u(n,e,i,o){const u=Math.pow(2,o.z)*Tn,f=[o.x*Tn,o.y*Tn],p=[];for(const x of n){const T=[];for(const E of x){const C=[E.x+f[0],E.y+f[1]];Al(e,C),T.push(C)}p.push(T)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of p)for(const T of x)Cl(T,e,i,u)}var y;return p}class eo{constructor(e,i){this.type=Wt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ka(e[1])){const o=e[1];if(o.type==="FeatureCollection"){const u=[];for(const f of o.features){const{type:p,coordinates:y}=f.geometry;p==="Polygon"&&u.push(y),p==="MultiPolygon"&&u.push(...y)}if(u.length)return new eo(o,{type:"MultiPolygon",coordinates:u})}else if(o.type==="Feature"){const u=o.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new eo(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new eo(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=hc(o.coordinates,f,p),x=Cd(i.geometry(),u,f,p);if(!Js(u,f))return!1;for(const T of x)if(!Ra(T,y))return!1}if(o.type==="MultiPolygon"){const y=Lo(o.coordinates,f,p),x=Cd(i.geometry(),u,f,p);if(!Js(u,f))return!1;for(const T of x)if(!uc(T,y))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(o.type==="Polygon"){const y=hc(o.coordinates,f,p),x=_u(i.geometry(),u,f,p);if(!Js(u,f))return!1;for(const T of x)if(!Ed(T,y))return!1}if(o.type==="MultiPolygon"){const y=Lo(o.coordinates,f,p),x=_u(i.geometry(),u,f,p);if(!Js(u,f))return!1;for(const T of x)if(!Ad(T,y))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let mh=class{constructor(n=[],e=(i,o)=>i<o?-1:i>o?1:0){if(this.data=n,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:e,compare:i}=this,o=e[n];for(;n>0;){const u=n-1>>1,f=e[u];if(i(o,f)>=0)break;e[n]=f,n=u}e[n]=o}_down(n){const{data:e,compare:i}=this,o=this.length>>1,u=e[n];for(;n<o;){let f=1+(n<<1);const p=f+1;if(p<this.length&&i(e[p],e[f])<0&&(f=p),i(e[f],u)>=0)break;e[n]=e[f],n=f}e[n]=u}};function yu(n,e,i=0,o=n.length-1,u=gh){for(;o>i;){if(o-i>600){const x=o-i+1,T=e-i+1,E=Math.log(x),C=.5*Math.exp(2*E/3),D=.5*Math.sqrt(E*C*(x-C)/x)*(T-x/2<0?-1:1);yu(n,e,Math.max(i,Math.floor(e-T*C/x+D)),Math.min(o,Math.floor(e+(x-T)*C/x+D)),u)}const f=n[e];let p=i,y=o;for(to(n,i,e),u(n[o],f)>0&&to(n,i,o);p<y;){for(to(n,p,y),p++,y--;u(n[p],f)<0;)p++;for(;u(n[y],f)>0;)y--}u(n[i],f)===0?to(n,i,y):(y++,to(n,y,o)),y<=e&&(i=y+1),e<=y&&(o=y-1)}}function to(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function gh(n,e){return n<e?-1:n>e?1:0}function vu(n,e){if(n.length<=1)return[n];const i=[];let o,u;for(const f of n){const p=Df(f);p!==0&&(f.area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[f]):o.push(f))}if(o&&i.push(o),e>1)for(let f=0;f<i.length;f++)i[f].length<=e||(yu(i[f],e,1,i[f].length-1,zd),i[f]=i[f].slice(0,e));return i}function zd(n,e){return e.area-n.area}function Df(n){let e=0;for(let i,o,u=0,f=n.length,p=f-1;u<f;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}const Dd=1/298.257223563,xu=Dd*(2-Dd),Id=Math.PI/180;class _h{constructor(e){const i=6378.137*Id*1e3,o=Math.cos(e*Id),u=1/(1-xu*(1-o*o)),f=Math.sqrt(u);this.kx=i*f*o,this.ky=i*f*u*(1-xu)}distance(e,i){const o=this.wrap(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+u*u)}pointOnLine(e,i){let o,u,f,p,y=1/0;for(let x=0;x<e.length-1;x++){let T=e[x][0],E=e[x][1],C=this.wrap(e[x+1][0]-T)*this.kx,D=(e[x+1][1]-E)*this.ky,I=0;C===0&&D===0||(I=(this.wrap(i[0]-T)*this.kx*C+(i[1]-E)*this.ky*D)/(C*C+D*D),I>1?(T=e[x+1][0],E=e[x+1][1]):I>0&&(T+=C/this.kx*I,E+=D/this.ky*I)),C=this.wrap(i[0]-T)*this.kx,D=(i[1]-E)*this.ky;const L=C*C+D*D;L<y&&(y=L,o=T,u=E,f=x,p=I)}return{point:[o,u],index:f,t:Math.max(0,Math.min(1,p))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Nr(n,e){return e[0]-n[0]}function io(n){return n[1]-n[0]+1}function va(n,e){return n[1]>=n[0]&&n[1]<e}function bu(n,e){if(n[0]>n[1])return[null,null];const i=io(n);if(e){if(i===2)return[n,null];const u=Math.floor(i/2);return[[n[0],n[0]+u],[n[0]+u,n[1]]]}if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}function dc(n,e){if(!va(e,n.length))return[1/0,1/0,-1/0,-1/0];const i=[1/0,1/0,-1/0,-1/0];for(let o=e[0];o<=e[1];++o)Al(i,n[o]);return i}function fc(n){const e=[1/0,1/0,-1/0,-1/0];for(const i of n)for(const o of i)Al(e,o);return e}function wu(n){return n[0]!==-1/0&&n[1]!==-1/0&&n[2]!==1/0&&n[3]!==1/0}function pc(n,e,i){if(!wu(n)||!wu(e))return NaN;let o=0,u=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(u=n[1]-e[3]),n[3]<e[1]&&(u=e[1]-n[3]),i.distance([0,0],[o,u])}function xa(n,e,i){const o=i.pointOnLine(e,n);return i.distance(n,o.point)}function Tu(n,e,i,o,u){const f=Math.min(xa(n,[i,o],u),xa(e,[i,o],u)),p=Math.min(xa(i,[n,e],u),xa(o,[n,e],u));return Math.min(f,p)}function Su(n,e,i,o,u){if(!va(e,n.length)||!va(o,i.length))return 1/0;let f=1/0;for(let p=e[0];p<e[1];++p){const y=n[p],x=n[p+1];for(let T=o[0];T<o[1];++T){const E=i[T],C=i[T+1];if(gu(y,x,E,C))return 0;f=Math.min(f,Tu(y,x,E,C,u))}}return f}function mc(n,e,i,o,u){if(!va(e,n.length)||!va(o,i.length))return NaN;let f=1/0;for(let p=e[0];p<=e[1];++p)for(let y=o[0];y<=o[1];++y)if(f=Math.min(f,u.distance(n[p],i[y])),f===0)return f;return f}function Pd(n,e,i){if(Ra(n,e,!0))return 0;let o=1/0;for(const u of e){const f=u[0],p=u[u.length-1];if(f!==p&&(o=Math.min(o,xa(n,[p,f],i)),o===0))return o;const y=i.pointOnLine(u,n);if(o=Math.min(o,i.distance(n,y.point)),o===0)return o}return o}function Bo(n,e,i,o){if(!va(e,n.length))return NaN;for(let f=e[0];f<=e[1];++f)if(Ra(n[f],i,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f){const p=n[f],y=n[f+1];for(const x of i)for(let T=0,E=x.length,C=E-1;T<E;C=T++){const D=x[C],I=x[T];if(gu(p,y,D,I))return 0;u=Math.min(u,Tu(p,y,D,I,o))}}return u}function ko(n,e){for(const i of n)for(const o of i)if(Ra(o,e,!0))return!0;return!1}function yh(n,e,i,o=1/0){const u=fc(n),f=fc(e);if(o!==1/0&&pc(u,f,i)>=o)return o;if(Js(u,f)){if(ko(n,e))return 0}else if(ko(e,n))return 0;let p=1/0;for(const y of n)for(let x=0,T=y.length,E=T-1;x<T;E=x++){const C=y[E],D=y[x];for(const I of e)for(let L=0,O=I.length,N=O-1;L<O;N=L++){const G=I[N],J=I[L];if(gu(C,D,G,J))return 0;p=Math.min(p,Tu(C,D,G,J,i))}}return p}function mi(n,e,i,o,u,f){if(!f)return;const p=pc(dc(o,f),u,i);p<e&&n.push([p,f,[0,0]])}function es(n,e,i,o,u,f,p){if(!f||!p)return;const y=pc(dc(o,f),dc(u,p),i);y<e&&n.push([y,f,p])}function Mu(n,e,i,o,u=1/0){let f=Math.min(o.distance(n[0],i[0][0]),u);if(f===0)return f;const p=new mh([[0,[0,n.length-1],[0,0]]],Nr),y=fc(i);for(;p.length>0;){const x=p.pop();if(x[0]>=f)continue;const T=x[1],E=e?50:100;if(io(T)<=E){if(!va(T,n.length))return NaN;if(e){const C=Bo(n,T,i,o);if(isNaN(C)||C===0)return C;f=Math.min(f,C)}else for(let C=T[0];C<=T[1];++C){const D=Pd(n[C],i,o);if(f=Math.min(f,D),f===0)return 0}}else{const C=bu(T,e);mi(p,f,o,n,y,C[0]),mi(p,f,o,n,y,C[1])}}return f}function Eu(n,e,i,o,u,f=1/0){let p=Math.min(f,u.distance(n[0],i[0]));if(p===0)return p;const y=new mh([[0,[0,n.length-1],[0,i.length-1]]],Nr);for(;y.length>0;){const x=y.pop();if(x[0]>=p)continue;const T=x[1],E=x[2],C=e?50:100,D=o?50:100;if(io(T)<=C&&io(E)<=D){if(!va(T,n.length)&&va(E,i.length))return NaN;let I;if(e&&o)I=Su(n,T,i,E,u),p=Math.min(p,I);else if(e&&!o){const L=n.slice(T[0],T[1]+1);for(let O=E[0];O<=E[1];++O)if(I=xa(i[O],L,u),p=Math.min(p,I),p===0)return p}else if(!e&&o){const L=i.slice(E[0],E[1]+1);for(let O=T[0];O<=T[1];++O)if(I=xa(n[O],L,u),p=Math.min(p,I),p===0)return p}else I=mc(n,T,i,E,u),p=Math.min(p,I)}else{const I=bu(T,e),L=bu(E,o);es(y,p,u,n,i,I[0],L[0]),es(y,p,u,n,i,I[0],L[1]),es(y,p,u,n,i,I[1],L[0]),es(y,p,u,n,i,I[1],L[1])}}return p}function gc(n){return n.type==="MultiPolygon"?n.coordinates.map((e=>({type:"Polygon",coordinates:e}))):n.type==="MultiLineString"?n.coordinates.map((e=>({type:"LineString",coordinates:e}))):n.type==="MultiPoint"?n.coordinates.map((e=>({type:"Point",coordinates:e}))):[n]}class Oo{constructor(e,i){this.type=nt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ka(e[1])){const o=e[1];if(o.type==="FeatureCollection")return new Oo(o,o.features.map((u=>gc(u.geometry))).flat());if(o.type==="Feature")return new Oo(o,gc(o.geometry));if("type"in o&&"coordinates"in o)return new Oo(o,gc(o))}return i.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,o){const u=i.geometry(),f=u.flat().map((x=>El([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new _h(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Eu(f,!1,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Eu(f,!1,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Mu(f,!1,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,o){const u=i.geometry(),f=u.flat().map((x=>El([x.x,x.y],i.canonical)));if(u.length===0)return NaN;const p=new _h(f[0][1]);let y=1/0;for(const x of o){switch(x.type){case"Point":y=Math.min(y,Eu(f,!0,[x.coordinates],!1,p,y));break;case"LineString":y=Math.min(y,Eu(f,!0,x.coordinates,!0,p,y));break;case"Polygon":y=Math.min(y,Mu(f,!0,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(i,o){const u=i.geometry();if(u.length===0||u[0].length===0)return NaN;const f=vu(u,0).map((x=>x.map((T=>T.map((E=>El([E.x,E.y],i.canonical))))))),p=new _h(f[0][0][0][1]);let y=1/0;for(const x of o)for(const T of f){switch(x.type){case"Point":y=Math.min(y,Mu([x.coordinates],!1,T,p,y));break;case"LineString":y=Math.min(y,Mu(x.coordinates,!0,T,p,y));break;case"Polygon":y=Math.min(y,yh(T,x.coordinates,p,y))}if(y===0)return y}return y})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Au{constructor(e){this.type=Gt,this.key=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=e[1];return o==null?i.error("Global state property must be defined."):typeof o!="string"?i.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new Au(o)}evaluate(e){var i;const o=(i=e.globals)===null||i===void 0?void 0:i.globalState;return o&&Object.keys(o).length!==0?vl(o,this.key):null}eachChild(){}outputDefined(){return!1}}const zl={"==":wd,"!=":oc,">":zf,"<":Td,">=":lc,"<=":bl,array:Mr,at:Kt,boolean:Mr,case:hu,coalesce:Ro,collator:wl,format:mu,image:Tl,in:Zt,"index-of":Po,interpolate:Ar,"interpolate-hcl":Ar,"interpolate-lab":Ar,length:Sl,let:Ai,literal:ea,match:hi,number:Mr,"number-format":ph,object:Mr,slice:ya,step:Ks,string:Mr,"to-boolean":Er,"to-color":Er,"to-number":Er,"to-string":Er,var:Ws,within:eo,distance:Oo,"global-state":Au};class ta{constructor(e,i,o,u){this.name=e,this.type=i,this._evaluate=o,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const o=e[0],u=ta.definitions[o];if(!u)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,p=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=p.filter((([T])=>!Array.isArray(T)||T.length===e.length-1));let x=null;for(const[T,E]of y){x=new Io(i.registry,Cr,i.path,null,i.scope);const C=[];let D=!1;for(let I=1;I<e.length;I++){const L=e[I],O=Array.isArray(T)?T[I-1]:T.type,N=x.parse(L,1+C.length,O);if(!N){D=!0;break}C.push(N)}if(!D)if(Array.isArray(T)&&T.length!==C.length)x.error(`Expected ${T.length} arguments, but found ${C.length} instead.`);else{for(let I=0;I<C.length;I++){const L=Array.isArray(T)?T[I]:T.type,O=C[I];x.concat(I+1).checkSubtype(L,O.type)}if(x.errors.length===0)return new ta(o,f,E,C)}}if(y.length===1)i.errors.push(...x.errors);else{const T=(y.length?y:p).map((([C])=>{return D=C,Array.isArray(D)?`(${D.map(ci).join(", ")})`:`(${ci(D.type)}...)`;var D})).join(" | "),E=[];for(let C=1;C<e.length;C++){const D=i.parse(e[C],1+E.length);if(!D)return null;E.push(ci(D.type))}i.error(`Expected arguments of type ${T}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){ta.definitions=i;for(const o in i)e[o]=ta}}function vh(n,[e,i,o,u]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const f=u?u.evaluate(n):1,p=Jr(e,i,o,f);if(p)throw new Bi(p);return new Xt(e/255,i/255,o/255,f,!1)}function _c(n,e){return n in e}function ia(n,e){const i=e[n];return i===void 0?null:i}function ts(n){return{type:n}}function Cr(n){if(n instanceof Ws)return Cr(n.boundExpression);if(n instanceof ta&&n.name==="error"||n instanceof wl||n instanceof eo||n instanceof Oo||n instanceof Au)return!1;const e=n instanceof Er||n instanceof Mr;let i=!0;return n.eachChild((o=>{i=e?i&&Cr(o):i&&o instanceof ea})),!!i&&bs(n)&&No(n,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function bs(n){if(n instanceof ta&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof eo||n instanceof Oo)return!1;let e=!0;return n.eachChild((i=>{e&&!bs(i)&&(e=!1)})),e}function Fo(n){if(n instanceof ta&&n.name==="feature-state")return!1;let e=!0;return n.eachChild((i=>{e&&!Fo(i)&&(e=!1)})),e}function No(n,e){if(n instanceof ta&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild((o=>{i&&!No(o,e)&&(i=!1)})),i}function Cu(n){return{result:"success",value:n}}function no(n){return{result:"error",value:n}}function ba(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function xh(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Dl(n){return!!n.expression&&n.expression.interpolated}function Qt(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function yc(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Xi(n)===$a}function na(n){return n}function vc(n,e){const i=n.stops&&typeof n.stops[0][0]=="object",o=i||!(i||n.property!==void 0),u=n.type||(Dl(e)?"exponential":"interval"),f=(function(E){switch(E.type){case"color":return Xt.parse;case"padding":return Dn.parse;case"numberArray":return $i.parse;case"colorArray":return Bt.parse;default:return null}})(e);if(f&&((n=pr({},n)).stops&&(n.stops=n.stops.map((E=>[E[0],f(E[1])]))),n.default=f(n.default?n.default:e.default)),n.colorSpace&&(p=n.colorSpace)!=="rgb"&&p!=="hcl"&&p!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var p;const y=(function(E){switch(E){case"exponential":return ro;case"interval":return xc;case"categorical":return Rd;case"identity":return bh;default:throw new Error(`Unknown function type "${E}"`)}})(u);let x,T;if(u==="categorical"){x=Object.create(null);for(const E of n.stops)x[E[0]]=E[1];T=typeof n.stops[0][0]}if(i){const E={},C=[];for(let L=0;L<n.stops.length;L++){const O=n.stops[L],N=O[0].zoom;E[N]===void 0&&(E[N]={zoom:N,type:n.type,property:n.property,default:n.default,stops:[]},C.push(N)),E[N].stops.push([O[0].value,O[1]])}const D=[];for(const L of C)D.push([E[L].zoom,vc(E[L],e)]);const I={name:"linear"};return{kind:"composite",interpolationType:I,interpolationFactor:Ar.interpolationFactor.bind(void 0,I),zoomStops:D.map((L=>L[0])),evaluate:({zoom:L},O)=>ro({stops:D,base:n.base},e,L).evaluate(L,O)}}if(o){const E=u==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Ar.interpolationFactor.bind(void 0,E),zoomStops:n.stops.map((C=>C[0])),evaluate:({zoom:C})=>y(n,e,C,x,T)}}return{kind:"source",evaluate(E,C){const D=C&&C.properties?C.properties[n.property]:void 0;return D===void 0?ra(n.default,e.default):y(n,e,D,x,T)}}}function ra(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function Rd(n,e,i,o,u){return ra(typeof i===u?o[i]:void 0,n.default,e.default)}function xc(n,e,i){if(Qt(i)!=="number")return ra(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const u=Qs(n.stops.map((f=>f[0])),i);return n.stops[u][1]}function ro(n,e,i){const o=n.base!==void 0?n.base:1;if(Qt(i)!=="number")return ra(n.default,e.default);const u=n.stops.length;if(u===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[u-1][0])return n.stops[u-1][1];const f=Qs(n.stops.map((E=>E[0])),i),p=(function(E,C,D,I){const L=I-D,O=E-D;return L===0?0:C===1?O/L:(Math.pow(C,O)-1)/(Math.pow(C,L)-1)})(i,o,n.stops[f][0],n.stops[f+1][0]),y=n.stops[f][1],x=n.stops[f+1][1],T=Yi[e.type]||na;return typeof y.evaluate=="function"?{evaluate(...E){const C=y.evaluate.apply(void 0,E),D=x.evaluate.apply(void 0,E);if(C!==void 0&&D!==void 0)return T(C,D,p,n.colorSpace)}}:T(y,x,p,n.colorSpace)}function bh(n,e,i){switch(e.type){case"color":i=Xt.parse(i);break;case"formatted":i=Xn.fromString(i.toString());break;case"resolvedImage":i=Sr.fromString(i.toString());break;case"padding":i=Dn.parse(i);break;case"colorArray":i=Bt.parse(i);break;case"numberArray":i=$i.parse(i);break;default:Qt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return ra(i,n.default,e.default)}ta.register(zl,{error:[{kind:"error"},[qt],(n,[e])=>{throw new Bi(e.evaluate(n))}],typeof:[qt,[Gt],(n,[e])=>ci(Xi(e.evaluate(n)))],"to-rgba":[gr(nt,4),[Kr],(n,[e])=>{const[i,o,u,f]=e.evaluate(n).rgb;return[255*i,255*o,255*u,f]}],rgb:[Kr,[nt,nt,nt],vh],rgba:[Kr,[nt,nt,nt,nt],vh],has:{type:Wt,overloads:[[[qt],(n,[e])=>_c(e.evaluate(n),n.properties())],[[qt,$a],(n,[e,i])=>_c(e.evaluate(n),i.evaluate(n))]]},get:{type:Gt,overloads:[[[qt],(n,[e])=>ia(e.evaluate(n),n.properties())],[[qt,$a],(n,[e,i])=>ia(e.evaluate(n),i.evaluate(n))]]},"feature-state":[Gt,[qt],(n,[e])=>ia(e.evaluate(n),n.featureState||{})],properties:[$a,[],n=>n.properties()],"geometry-type":[qt,[],n=>n.geometryType()],id:[Gt,[],n=>n.id()],zoom:[nt,[],n=>n.globals.zoom],"heatmap-density":[nt,[],n=>n.globals.heatmapDensity||0],elevation:[nt,[],n=>n.globals.elevation||0],"line-progress":[nt,[],n=>n.globals.lineProgress||0],accumulated:[Gt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[nt,ts(nt),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[nt,ts(nt),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:nt,overloads:[[[nt,nt],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[nt],(n,[e])=>-e.evaluate(n)]]},"/":[nt,[nt,nt],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[nt,[nt,nt],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[nt,[],()=>Math.LN2],pi:[nt,[],()=>Math.PI],e:[nt,[],()=>Math.E],"^":[nt,[nt,nt],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[nt,[nt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[nt,[nt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[nt,[nt],(n,[e])=>Math.log(e.evaluate(n))],log2:[nt,[nt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[nt,[nt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[nt,[nt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[nt,[nt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[nt,[nt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[nt,[nt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[nt,[nt],(n,[e])=>Math.atan(e.evaluate(n))],min:[nt,ts(nt),(n,e)=>Math.min(...e.map((i=>i.evaluate(n))))],max:[nt,ts(nt),(n,e)=>Math.max(...e.map((i=>i.evaluate(n))))],abs:[nt,[nt],(n,[e])=>Math.abs(e.evaluate(n))],round:[nt,[nt],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[nt,[nt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[nt,[nt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Wt,[qt,Gt],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Wt,[Gt],(n,[e])=>n.id()===e.value],"filter-type-==":[Wt,[qt],(n,[e])=>n.geometryType()===e.value],"filter-<":[Wt,[qt,Gt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<u}],"filter-id-<":[Wt,[Gt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[Wt,[qt,Gt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>u}],"filter-id->":[Wt,[Gt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[Wt,[qt,Gt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o<=u}],"filter-id-<=":[Wt,[Gt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[Wt,[qt,Gt],(n,[e,i])=>{const o=n.properties()[e.value],u=i.value;return typeof o==typeof u&&o>=u}],"filter-id->=":[Wt,[Gt],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[Wt,[Gt],(n,[e])=>e.value in n.properties()],"filter-has-id":[Wt,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Wt,[gr(qt)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Wt,[gr(Gt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Wt,[qt,gr(Gt)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Wt,[qt,gr(Gt)],(n,[e,i])=>(function(o,u,f,p){for(;f<=p;){const y=f+p>>1;if(u[y]===o)return!0;u[y]>o?p=y-1:f=y+1}return!1})(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Wt,overloads:[[[Wt,Wt],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[ts(Wt),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Wt,overloads:[[[Wt,Wt],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[ts(Wt),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Wt,[Wt],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Wt,[qt],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[qt,[qt],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[qt,[qt],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[qt,ts(Gt),(n,e)=>e.map((i=>Ys(i.evaluate(n)))).join("")],"resolved-locale":[qt,[Mo],(n,[e])=>e.evaluate(n).resolvedLocale()]});class bc{constructor(e,i,o){this.expression=e,this._warningHistory={},this._evaluator=new Do,this._defaultValue=i?(function(u){if(u.type==="color"&&yc(u.default))return new Xt(0,0,0,0);switch(u.type){case"color":return Xt.parse(u.default)||null;case"padding":return Dn.parse(u.default)||null;case"numberArray":return $i.parse(u.default)||null;case"colorArray":return Bt.parse(u.default)||null;case"variableAnchorOffsetCollection":return mn.parse(u.default)||null;case"projectionDefinition":return Yn.parse(u.default)||null;default:return u.default===void 0?null:u.default}})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=ir(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,u,f,p){this._globalState&&(e=ir(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=u,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Bi(`Expected value to be one of ${Object.keys(this._enumValues).map((x=>JSON.stringify(x))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function ao(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in zl}function zu(n,e,i){const o=new Io(zl,Cr,[],e?(function(f){const p={color:Kr,string:qt,number:nt,enum:qt,boolean:Wt,formatted:Xa,padding:ys,numberArray:Wa,colorArray:Ya,projectionDefinition:rc,resolvedImage:pn,variableAnchorOffsetCollection:gl};return f.type==="array"?gr(p[f.value]||Gt,f.length):p[f.type]})(e):void 0),u=o.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Cu(new bc(u,e,i)):no(o.errors)}class zr{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Fo(i.expression),this.globalStateRefs=tr(i.expression),this._globalState=o}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=ir(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,f,p)}evaluate(e,i,o,u,f,p){return this._globalState&&(e=ir(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,f,p)}}class so{constructor(e,i,o,u,f){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Fo(i.expression),this.globalStateRefs=tr(i.expression),this.interpolationType=u,this._globalState=f}evaluateWithoutErrorHandling(e,i,o,u,f,p){return this._globalState&&(e=ir(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,i,o,u,f,p)}evaluate(e,i,o,u,f,p){return this._globalState&&(e=ir(e,this._globalState)),this._styleExpression.evaluate(e,i,o,u,f,p)}interpolationFactor(e,i,o){return this.interpolationType?Ar.interpolationFactor(this.interpolationType,e,i,o):0}}function oo(n,e,i){const o=zu(n,e,i);if(o.result==="error")return o;const u=o.value.expression,f=bs(u);if(!f&&!ba(e))return no([new mr("","data expressions not supported")]);const p=No(u,["zoom"]);if(!p&&!xh(e))return no([new mr("","zoom expressions not supported")]);const y=lo(u);return y||p?y instanceof mr?no([y]):y instanceof Ar&&!Dl(e)?no([new mr("",'"interpolate" expressions cannot be used with this property')]):Cu(y?new so(f?"camera":"composite",o.value,y.labels,y instanceof Ar?y.interpolation:void 0,i):new zr(f?"constant":"source",o.value,i)):no([new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class jo{constructor(e,i){this._parameters=e,this._specification=i,pr(this,vc(this._parameters,this._specification))}static deserialize(e){return new jo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function lo(n){let e=null;if(n instanceof Ai)e=lo(n.result);else if(n instanceof Ro){for(const i of n.args)if(e=lo(i),e)break}else(n instanceof Ks||n instanceof Ar)&&n.input instanceof ta&&n.input.name==="zoom"&&(e=n);return e instanceof mr||n.eachChild((i=>{const o=lo(i);o instanceof mr?e=o:!e&&o?e=new mr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new mr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function tr(n,e=new Set){return n instanceof Au&&e.add(n.key),n.eachChild((i=>{tr(i,e)})),e}function ir(n,e){const{zoom:i,heatmapDensity:o,elevation:u,lineProgress:f,isSupportedScript:p,accumulated:y}=n??{};return{zoom:i,heatmapDensity:o,elevation:u,lineProgress:f,isSupportedScript:p,accumulated:y,globalState:e}}function is(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!is(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const ns={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function jr(n,e){if(n==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};is(n)||(n=Vo(n));const i=zu(n,ns,e);if(i.result==="error")throw new Error(i.value.map((o=>`${o.key}: ${o.message}`)).join(", "));return{filter:(o,u,f)=>i.value.evaluate(o,u,{},f),needGeometry:wh(n),getGlobalStateRefs:()=>tr(i.value.expression)}}function ws(n,e){return n<e?-1:n>e?1:0}function wh(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(wh(n[e]))return!0;return!1}function Vo(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Il(n[1],n[2],"=="):e==="!="?ki(Il(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Il(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Vo))):e==="all"?["all"].concat(n.slice(1).map(Vo)):e==="none"?["all"].concat(n.slice(1).map(Vo).map(ki)):e==="in"?Th(n[1],n.slice(2)):e==="!in"?ki(Th(n[1],n.slice(2))):e==="has"?nr(n[1]):e!=="!has"||ki(nr(n[1]));var i}function Il(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function Th(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",n,["literal",e.sort(ws)]]:["filter-in-small",n,["literal",e]]}}function nr(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ki(n){return["!",n]}function ri(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let u="[";for(const f of n)u+=`${ri(f)},`;return`${u}]`}const i=Object.keys(n).sort();let o="{";for(let u=0;u<i.length;u++)o+=`${JSON.stringify(i[u])}:${ri(n[i[u]])},`;return`${o}}`}function Ts(n){let e="";for(const i of Ti)e+=`/${ri(n[i])}`;return e}function aa(n){const e=n.value;return e?[new Je(n.key,e,"constants have been deprecated as of v8")]:[]}function nn(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Vr(n){if(Array.isArray(n))return n.map(Vr);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Vr(n[i]);return e}return nn(n)}function sa(n){const e=n.key,i=n.value,o=n.valueSpec||{},u=n.objectElementValidators||{},f=n.style,p=n.styleSpec,y=n.validateSpec;let x=[];const T=Qt(i);if(T!=="object")return[new Je(e,i,`object expected, ${T} found`)];for(const E in i){const C=E.split(".")[0],D=vl(o,C)||o["*"];let I;if(vl(u,C))I=u[C];else if(vl(o,C))I=y;else if(u["*"])I=u["*"];else{if(!o["*"]){x.push(new Je(e,i[E],`unknown property "${E}"`));continue}I=y}x=x.concat(I({key:(e&&`${e}.`)+E,value:i[E],valueSpec:D,style:f,styleSpec:p,object:i,objectKey:E,validateSpec:y},i))}for(const E in o)u[E]||o[E].required&&o[E].default===void 0&&i[E]===void 0&&x.push(new Je(e,i,`missing required property "${E}"`));return x}function Du(n){const e=n.value,i=n.valueSpec,o=n.style,u=n.styleSpec,f=n.key,p=n.arrayElementValidator||n.validateSpec;if(Qt(e)!=="array")return[new Je(f,e,`array expected, ${Qt(e)} found`)];if(i.length&&e.length!==i.length)return[new Je(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Je(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let y={type:i.value,values:i.values};u.$version<7&&(y.function=i.function),Qt(i.value)==="object"&&(y=i.value);let x=[];for(let T=0;T<e.length;T++)x=x.concat(p({array:e,arrayIndex:T,value:e[T],valueSpec:y,validateSpec:n.validateSpec,style:o,styleSpec:u,key:`${f}[${T}]`}));return x}function rs(n){const e=n.key,i=n.value,o=n.valueSpec;let u=Qt(i);return u==="number"&&i!=i&&(u="NaN"),u!=="number"?[new Je(e,i,`number expected, ${u} found`)]:"minimum"in o&&i<o.minimum?[new Je(e,i,`${i} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&i>o.maximum?[new Je(e,i,`${i} is greater than the maximum value ${o.maximum}`)]:[]}function as(n){const e=n.valueSpec,i=nn(n.value.type);let o,u,f,p={};const y=i!=="categorical"&&n.value.property===void 0,x=!y,T=Qt(n.value.stops)==="array"&&Qt(n.value.stops[0])==="array"&&Qt(n.value.stops[0][0])==="object",E=sa({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(I){if(i==="identity")return[new Je(I.key,I.value,'identity function may not have a "stops" property')];let L=[];const O=I.value;return L=L.concat(Du({key:I.key,value:O,valueSpec:I.valueSpec,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec,arrayElementValidator:C})),Qt(O)==="array"&&O.length===0&&L.push(new Je(I.key,O,"array must have at least one stop")),L},default:function(I){return I.validateSpec({key:I.key,value:I.value,valueSpec:e,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec})}}});return i==="identity"&&y&&E.push(new Je(n.key,n.value,'missing required property "property"')),i==="identity"||n.value.stops||E.push(new Je(n.key,n.value,'missing required property "stops"')),i==="exponential"&&n.valueSpec.expression&&!Dl(n.valueSpec)&&E.push(new Je(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(x&&!ba(n.valueSpec)?E.push(new Je(n.key,n.value,"property functions not supported")):y&&!xh(n.valueSpec)&&E.push(new Je(n.key,n.value,"zoom functions not supported"))),i!=="categorical"&&!T||n.value.property!==void 0||E.push(new Je(n.key,n.value,'"property" property is required')),E;function C(I){let L=[];const O=I.value,N=I.key;if(Qt(O)!=="array")return[new Je(N,O,`array expected, ${Qt(O)} found`)];if(O.length!==2)return[new Je(N,O,`array length 2 expected, length ${O.length} found`)];if(T){if(Qt(O[0])!=="object")return[new Je(N,O,`object expected, ${Qt(O[0])} found`)];if(O[0].zoom===void 0)return[new Je(N,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new Je(N,O,"object stop key must have value")];if(f&&f>nn(O[0].zoom))return[new Je(N,O[0].zoom,"stop zoom values must appear in ascending order")];nn(O[0].zoom)!==f&&(f=nn(O[0].zoom),u=void 0,p={}),L=L.concat(sa({key:`${N}[0]`,value:O[0],valueSpec:{zoom:{}},validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec,objectElementValidators:{zoom:rs,value:D}}))}else L=L.concat(D({key:`${N}[0]`,value:O[0],validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec},O));return ao(Vr(O[1]))?L.concat([new Je(`${N}[1]`,O[1],"expressions are not allowed in function stops.")]):L.concat(I.validateSpec({key:`${N}[1]`,value:O[1],valueSpec:e,validateSpec:I.validateSpec,style:I.style,styleSpec:I.styleSpec}))}function D(I,L){const O=Qt(I.value),N=nn(I.value),G=I.value!==null?I.value:L;if(o){if(O!==o)return[new Je(I.key,G,`${O} stop domain type must match previous stop domain type ${o}`)]}else o=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new Je(I.key,G,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&i!=="categorical"){let J=`number expected, ${O} found`;return ba(e)&&i===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Je(I.key,G,J)]}return i!=="categorical"||O!=="number"||isFinite(N)&&Math.floor(N)===N?i!=="categorical"&&O==="number"&&u!==void 0&&N<u?[new Je(I.key,G,"stop domain values must appear in ascending order")]:(u=N,i==="categorical"&&N in p?[new Je(I.key,G,"stop domain values must be unique")]:(p[N]=!0,[])):[new Je(I.key,G,`integer expected, found ${N}`)]}}function ss(n){const e=(n.expressionContext==="property"?oo:zu)(Vr(n.value),n.valueSpec);if(e.result==="error")return e.value.map((o=>new Je(`${n.key}${o.key}`,n.value,o.message)));const i=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!i.outputDefined())return[new Je(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Fo(i))return[new Je(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Fo(i))return[new Je(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!No(i,["zoom","feature-state"]))return[new Je(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!bs(i))return[new Je(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ss(n){const e=n.key,i=n.value,o=Qt(i);return o!=="string"?[new Je(e,i,`color expected, ${o} found`)]:Xt.parse(String(i))?[]:[new Je(e,i,`color expected, "${i}" found`)]}function Ms(n){const e=n.key,i=n.value,o=n.valueSpec,u=[];return Array.isArray(o.values)?o.values.indexOf(nn(i))===-1&&u.push(new Je(e,i,`expected one of [${o.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(o.values).indexOf(nn(i))===-1&&u.push(new Je(e,i,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function wa(n){return is(Vr(n.value))?ss(pr({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):os(n)}function os(n){const e=n.value,i=n.key;if(Qt(e)!=="array")return[new Je(i,e,`array expected, ${Qt(e)} found`)];const o=n.styleSpec;let u,f=[];if(e.length<1)return[new Je(i,e,"filter array must have at least 1 element")];switch(f=f.concat(Ms({key:`${i}[0]`,value:e[0],valueSpec:o.filter_operator,style:n.style,styleSpec:n.styleSpec})),nn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&nn(e[1])==="$type"&&f.push(new Je(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new Je(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=Qt(e[1]),u!=="string"&&f.push(new Je(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let p=2;p<e.length;p++)u=Qt(e[p]),nn(e[1])==="$type"?f=f.concat(Ms({key:`${i}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:n.style,styleSpec:n.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new Je(`${i}[${p}]`,e[p],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)f=f.concat(os({key:`${i}[${p}]`,value:e[p],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":u=Qt(e[1]),e.length!==2?f.push(new Je(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new Je(`${i}[1]`,e[1],`string expected, ${u} found`))}return f}function Es(n,e){const i=n.key,o=n.validateSpec,u=n.style,f=n.styleSpec,p=n.value,y=n.objectKey,x=f[`${e}_${n.layerType}`];if(!x)return[];const T=y.match(/^(.*)-transition$/);if(e==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return o({key:i,value:p,valueSpec:f.transition,style:u,styleSpec:f});const E=n.valueSpec||x[y];if(!E)return[new Je(i,p,`unknown property "${y}"`)];let C;if(Qt(p)==="string"&&ba(E)&&!E.tokens&&(C=/^{([^}]+)}$/.exec(p)))return[new Je(i,p,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const D=[];return n.layerType==="symbol"&&y==="text-font"&&yc(Vr(p))&&nn(p.type)==="identity"&&D.push(new Je(i,p,'"text-font" does not support identity functions')),D.concat(o({key:n.key,value:p,valueSpec:E,style:u,styleSpec:f,expressionContext:"property",propertyType:e,propertyKey:y}))}function ls(n){return Es(n,"paint")}function wc(n){return Es(n,"layout")}function Tc(n){let e=[];const i=n.value,o=n.key,u=n.style,f=n.styleSpec;if(Qt(i)!=="object")return[new Je(o,i,`object expected, ${Qt(i)} found`)];i.type||i.ref||e.push(new Je(o,i,'either "type" or "ref" is required'));let p=nn(i.type);const y=nn(i.ref);if(i.id){const x=nn(i.id);for(let T=0;T<n.arrayIndex;T++){const E=u.layers[T];nn(E.id)===x&&e.push(new Je(o,i.id,`duplicate layer id "${i.id}", previously used at line ${E.id.__line__}`))}}if("ref"in i){let x;["type","source","source-layer","filter","layout"].forEach((T=>{T in i&&e.push(new Je(o,i[T],`"${T}" is prohibited for ref layers`))})),u.layers.forEach((T=>{nn(T.id)===y&&(x=T)})),x?x.ref?e.push(new Je(o,i.ref,"ref cannot reference another ref layer")):p=nn(x.type):e.push(new Je(o,i.ref,`ref layer "${y}" not found`))}else if(p!=="background")if(i.source){const x=u.sources&&u.sources[i.source],T=x&&nn(x.type);x?T==="vector"&&p==="raster"?e.push(new Je(o,i.source,`layer "${i.id}" requires a raster source`)):T!=="raster-dem"&&p==="hillshade"||T!=="raster-dem"&&p==="color-relief"?e.push(new Je(o,i.source,`layer "${i.id}" requires a raster-dem source`)):T==="raster"&&p!=="raster"?e.push(new Je(o,i.source,`layer "${i.id}" requires a vector source`)):T!=="vector"||i["source-layer"]?T==="raster-dem"&&p!=="hillshade"&&p!=="color-relief"?e.push(new Je(o,i.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):p!=="line"||!i.paint||!i.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||e.push(new Je(o,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Je(o,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Je(o,i.source,`source "${i.source}" not found`))}else e.push(new Je(o,i,'missing required property "source"'));return e=e.concat(sa({key:o,value:i,valueSpec:f.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${o}.type`,value:i.type,valueSpec:f.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:i,objectKey:"type"}),filter:wa,layout:x=>sa({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>wc(pr({layerType:p},T))}}),paint:x=>sa({layer:i,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>ls(pr({layerType:p},T))}})}})),e}function Ta(n){const e=n.value,i=n.key,o=Qt(e);return o!=="string"?[new Je(i,e,`string expected, ${o} found`)]:[]}const Pl={promoteId:function({key:n,value:e}){if(Qt(e)==="string")return Ta({key:n,value:e});{const i=[];for(const o in e)i.push(...Ta({key:`${n}.${o}`,value:e[o]}));return i}}};function As(n){const e=n.value,i=n.key,o=n.styleSpec,u=n.style,f=n.validateSpec;if(!e.type)return[new Je(i,e,'"type" is required')];const p=nn(e.type);let y;switch(p){case"vector":case"raster":return y=sa({key:i,value:e,valueSpec:o[`source_${p.replace("-","_")}`],style:n.style,styleSpec:o,objectElementValidators:Pl,validateSpec:f}),y;case"raster-dem":return y=(function(x){var T;const E=(T=x.sourceName)!==null&&T!==void 0?T:"",C=x.value,D=x.styleSpec,I=D.source_raster_dem,L=x.style;let O=[];const N=Qt(C);if(C===void 0)return O;if(N!=="object")return O.push(new Je("source_raster_dem",C,`object expected, ${N} found`)),O;const G=nn(C.encoding)==="custom",J=["redFactor","greenFactor","blueFactor","baseShift"],q=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const $ in C)!G&&J.includes($)?O.push(new Je($,C[$],`In "${E}": "${$}" is only valid when "encoding" is set to "custom". ${q} encoding found`)):I[$]?O=O.concat(x.validateSpec({key:$,value:C[$],valueSpec:I[$],validateSpec:x.validateSpec,style:L,styleSpec:D})):O.push(new Je($,C[$],`unknown property "${$}"`));return O})({sourceName:i,value:e,style:n.style,styleSpec:o,validateSpec:f}),y;case"geojson":if(y=sa({key:i,value:e,valueSpec:o.source_geojson,style:u,styleSpec:o,validateSpec:f,objectElementValidators:Pl}),e.cluster)for(const x in e.clusterProperties){const[T,E]=e.clusterProperties[x],C=typeof T=="string"?[T,["accumulated"],["get",x]]:T;y.push(...ss({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),y.push(...ss({key:`${i}.${x}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return y;case"video":return sa({key:i,value:e,valueSpec:o.source_video,style:u,validateSpec:f,styleSpec:o});case"image":return sa({key:i,value:e,valueSpec:o.source_image,style:u,validateSpec:f,styleSpec:o});case"canvas":return[new Je(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ms({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function In(n){const e=n.value,i=n.styleSpec,o=i.light,u=n.style;let f=[];const p=Qt(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new Je("light",e,`object expected, ${p} found`)]),f;for(const y in e){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&o[x[1]]&&o[x[1]].transition?n.validateSpec({key:y,value:e[y],valueSpec:i.transition,validateSpec:n.validateSpec,style:u,styleSpec:i}):o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new Je(y,e[y],`unknown property "${y}"`)])}return f}function Iu(n){const e=n.value,i=n.styleSpec,o=i.sky,u=n.style,f=Qt(e);if(e===void 0)return[];if(f!=="object")return[new Je("sky",e,`object expected, ${f} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new Je(y,e[y],`unknown property "${y}"`)]);return p}function Sc(n){const e=n.value,i=n.styleSpec,o=i.terrain,u=n.style;let f=[];const p=Qt(e);if(e===void 0)return f;if(p!=="object")return f=f.concat([new Je("terrain",e,`object expected, ${p} found`)]),f;for(const y in e)f=f.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],validateSpec:n.validateSpec,style:u,styleSpec:i}):[new Je(y,e[y],`unknown property "${y}"`)]);return f}function Sh(n){let e=[];const i=n.value,o=n.key;if(Array.isArray(i)){const u=[],f=[];for(const p in i)i[p].id&&u.includes(i[p].id)&&e.push(new Je(o,i,`all the sprites' ids must be unique, but ${i[p].id} is duplicated`)),u.push(i[p].id),i[p].url&&f.includes(i[p].url)&&e.push(new Je(o,i,`all the sprites' URLs must be unique, but ${i[p].url} is duplicated`)),f.push(i[p].url),e=e.concat(sa({key:`${o}[${p}]`,value:i[p],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return Ta({key:o,value:i})}function Ld(n){return e=n.value,e&&e.constructor===Object?[]:[new Je(n.key,n.value,`object expected, ${Qt(n.value)} found`)];var e}const Mh={"*":()=>[],array:Du,boolean:function(n){const e=n.value,i=n.key,o=Qt(e);return o!=="boolean"?[new Je(i,e,`boolean expected, ${o} found`)]:[]},number:rs,color:Ss,constants:aa,enum:Ms,filter:wa,function:as,layer:Tc,object:sa,source:As,light:In,sky:Iu,terrain:Sc,projection:function(n){const e=n.value,i=n.styleSpec,o=i.projection,u=n.style,f=Qt(e);if(e===void 0)return[];if(f!=="object")return[new Je("projection",e,`object expected, ${f} found`)];let p=[];for(const y in e)p=p.concat(o[y]?n.validateSpec({key:y,value:e[y],valueSpec:o[y],style:u,styleSpec:i}):[new Je(y,e[y],`unknown property "${y}"`)]);return p},projectionDefinition:function(n){const e=n.key;let i=n.value;i=i instanceof String?i.valueOf():i;const o=Qt(i);return o!=="array"||(function(u){return Array.isArray(u)&&u.length===3&&typeof u[0]=="string"&&typeof u[1]=="string"&&typeof u[2]=="number"})(i)||(function(u){return!!["interpolate","step","literal"].includes(u[0])})(i)?["array","string"].includes(o)?[]:[new Je(e,i,`projection expected, invalid type "${o}" found`)]:[new Je(e,i,`projection expected, invalid array ${JSON.stringify(i)} found`)]},string:Ta,formatted:function(n){return Ta(n).length===0?[]:ss(n)},resolvedImage:function(n){return Ta(n).length===0?[]:ss(n)},padding:function(n){const e=n.key,i=n.value;if(Qt(i)==="array"){if(i.length<1||i.length>4)return[new Je(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const o={type:"number"};let u=[];for(let f=0;f<i.length;f++)u=u.concat(n.validateSpec({key:`${e}[${f}]`,value:i[f],validateSpec:n.validateSpec,valueSpec:o}));return u}return rs({key:e,value:i,valueSpec:{}})},numberArray:function(n){const e=n.key,i=n.value;if(Qt(i)==="array"){const o={type:"number"};if(i.length<1)return[new Je(e,i,"array length at least 1 expected, length 0 found")];let u=[];for(let f=0;f<i.length;f++)u=u.concat(n.validateSpec({key:`${e}[${f}]`,value:i[f],validateSpec:n.validateSpec,valueSpec:o}));return u}return rs({key:e,value:i,valueSpec:{}})},colorArray:function(n){const e=n.key,i=n.value;if(Qt(i)==="array"){if(i.length<1)return[new Je(e,i,"array length at least 1 expected, length 0 found")];let o=[];for(let u=0;u<i.length;u++)o=o.concat(Ss({key:`${e}[${u}]`,value:i[u]}));return o}return Ss({key:e,value:i})},variableAnchorOffsetCollection:function(n){const e=n.key,i=n.value,o=Qt(i),u=n.styleSpec;if(o!=="array"||i.length<1||i.length%2!=0)return[new Je(e,i,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let p=0;p<i.length;p+=2)f=f.concat(Ms({key:`${e}[${p}]`,value:i[p],valueSpec:u.layout_symbol["text-anchor"]})),f=f.concat(Du({key:`${e}[${p+1}]`,value:i[p+1],valueSpec:{length:2,value:"number"},validateSpec:n.validateSpec,style:n.style,styleSpec:u}));return f},sprite:Sh,state:Ld};function rn(n){const e=n.value,i=n.valueSpec,o=n.styleSpec;return n.validateSpec=rn,i.expression&&yc(nn(e))?as(n):i.expression&&ao(Vr(e))?ss(n):i.type&&Mh[i.type]?Mh[i.type](n):sa(pr({},n,{valueSpec:i.type?o[i.type]:i}))}function uo(n){const e=n.value,i=n.key,o=Ta(n);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new Je(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new Je(i,e,'"glyphs" url must include a "{range}" token'))),o}function _r(n,e=xe){let i=[];return i=i.concat(rn({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:rn,objectElementValidators:{glyphs:uo,"*":()=>[]}})),n.constants&&(i=i.concat(aa({key:"constants",value:n.constants}))),Mc(i)}function Dr(n){return function(e){return n(Object.assign({},e,{validateSpec:rn}))}}function Mc(n){return[].concat(n).sort(((e,i)=>e.line-i.line))}function yr(n){return function(...e){return Mc(n.apply(this,e))}}_r.source=yr(Dr(As)),_r.sprite=yr(Dr(Sh)),_r.glyphs=yr(Dr(uo)),_r.light=yr(Dr(In)),_r.sky=yr(Dr(Iu)),_r.terrain=yr(Dr(Sc)),_r.state=yr(Dr(Ld)),_r.layer=yr(Dr(Tc)),_r.filter=yr(Dr(wa)),_r.paintProperty=yr(Dr(ls)),_r.layoutProperty=yr(Dr(wc));const Rl=xe,Ll=_r,Bl=Ll.light,Pu=Ll.sky,Ur=Ll.paintProperty,La=Ll.layoutProperty;function Ru(n,e){let i=!1;if(e&&e.length)for(const o of e)n.fire(new yi(new Error(o.message))),i=!0;return i}class co{constructor(e,i,o){const u=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const p=new Int32Array(this.arrayBuffer);e=p[0],this.d=(i=p[1])+2*(o=p[2]);for(let x=0;x<this.d*this.d;x++){const T=p[3+x],E=p[3+x+1];u.push(T===E?null:p.subarray(T,E))}const y=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],y),this.bboxes=p.subarray(y),this.insert=this._insertReadonly}else{this.d=i+2*o;for(let p=0;p<this.d*this.d;p++)u.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=o,this.scale=i/e,this.uid=0;const f=o/i*e;this.min=-f,this.max=e+f}insert(e,i,o,u,f){this._forEachCell(i,o,u,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,o,u,f,p){this.cells[f].push(p)}query(e,i,o,u,f){const p=this.min,y=this.max;if(e<=p&&i<=p&&y<=o&&y<=u&&!f)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(e,i,o,u,this._queryCell,x,{},f),x}}_queryCell(e,i,o,u,f,p,y,x){const T=this.cells[f];if(T!==null){const E=this.keys,C=this.bboxes;for(let D=0;D<T.length;D++){const I=T[D];if(y[I]===void 0){const L=4*I;(x?x(C[L+0],C[L+1],C[L+2],C[L+3]):e<=C[L+2]&&i<=C[L+3]&&o>=C[L+0]&&u>=C[L+1])?(y[I]=!0,p.push(E[I])):y[I]=!1}}}}_forEachCell(e,i,o,u,f,p,y,x){const T=this._convertToCellCoord(e),E=this._convertToCellCoord(i),C=this._convertToCellCoord(o),D=this._convertToCellCoord(u);for(let I=T;I<=C;I++)for(let L=E;L<=D;L++){const O=this.d*L+I;if((!x||x(this._convertFromCellCoord(I),this._convertFromCellCoord(L),this._convertFromCellCoord(I+1),this._convertFromCellCoord(L+1)))&&f.call(this,e,i,o,u,O,p,y,x))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let o=0;for(let p=0;p<this.cells.length;p++)o+=this.cells[p].length;const u=new Int32Array(i+o+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;let f=i;for(let p=0;p<e.length;p++){const y=e[p];u[3+p]=f,u.set(y,f),f+=y.length}return u[3+e.length]=f,u.set(this.keys,f),f+=this.keys.length,u[3+e.length+1]=f,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer}static serialize(e,i){const o=e.toArrayBuffer();return i&&i.push(o),{buffer:o}}static deserialize(e){return new co(e.buffer)}}const us={};function lt(n,e,i={}){if(us[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),us[n]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}lt("Object",Object),lt("Set",Set),lt("TransferableGridIndex",co),lt("Color",Xt),lt("Error",Error),lt("AJAXError",he),lt("ResolvedImage",Sr),lt("StylePropertyFunction",jo),lt("StyleExpression",bc,{omit:["_evaluator"]}),lt("ZoomDependentExpression",so),lt("ZoomConstantExpression",zr),lt("CompoundExpression",ta,{omit:["_evaluate"]});for(const n in zl)zl[n]._classRegistryKey||lt(`Expression_${n}`,zl[n]);function Lu(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function ho(n){return n.$name||n.constructor._classRegistryKey}function Bu(n){return!(function(e){if(e===null||typeof e!="object")return!1;const i=ho(e);return!(!i||i==="Object")})(n)&&(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||n instanceof Error||Lu(n)||gs(n)||ArrayBuffer.isView(n)||n instanceof ImageData)}function fo(n,e){if(Bu(n))return(Lu(n)||gs(n))&&e&&e.push(n),ArrayBuffer.isView(n)&&e&&e.push(n.buffer),n instanceof ImageData&&e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const f=[];for(const p of n)f.push(fo(p,e));return f}if(typeof n!="object")throw new Error("can't serialize object of type "+typeof n);const i=ho(n);if(!i)throw new Error(`can't serialize object of unregistered class ${n.constructor.name}`);if(!us[i])throw new Error(`${i} is not registered.`);const{klass:o}=us[i],u=o.serialize?o.serialize(n,e):{};if(o.serialize){if(e&&u===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in n){if(!n.hasOwnProperty(f)||us[i].omit.indexOf(f)>=0)continue;const p=n[f];u[f]=us[i].shallow.indexOf(f)>=0?p:fo(p,e)}n instanceof Error&&(u.message=n.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(u.$name=i),u}function kl(n){if(Bu(n))return n;if(Array.isArray(n))return n.map(kl);if(typeof n!="object")throw new Error("can't deserialize object of type "+typeof n);const e=ho(n)||"Object";if(!us[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=us[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const u of Object.keys(n)){if(u==="$name")continue;const f=n[u];o[u]=us[e].shallow.indexOf(u)>=0?f:kl(f)}return o}class oa{constructor(){this.first=!0}update(e,i){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}function Uo(n){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Ec(n){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))}function Eh(n){return/\s/u.test(String.fromCodePoint(n))}function Sa(n){for(const e of n)if(Ec(e.codePointAt(0)))return!0;return!1}function ku(n){for(const e of n)if(!Ac(e.codePointAt(0)))return!1;return!0}function Ou(n){const e=n.map((i=>{try{return new RegExp(`\\p{sc=${i}}`,"u").source}catch{return null}})).filter((i=>i));return new RegExp(e.join("|"),"u")}const po=Ou(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ac(n){return!po.test(String.fromCodePoint(n))}function Fu(n){return!(Ec(n)||(e=n,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const cs=Ou(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Cc(n){return cs.test(String.fromCodePoint(n))}function Cs(n,e){return!(!e&&Cc(n)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(n)))}function zc(n){for(const e of n)if(Cc(e.codePointAt(0)))return!0;return!1}const Ba=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(n){this.pluginStatus=n.pluginStatus,this.pluginURL=n.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(n){if(Ba.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=n.applyArabicShaping,this.processBidirectionalText=n.processBidirectionalText,this.processStyledBidirectionalText=n.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(n,e){return d(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(n.pluginStatus!=="loading")return this.setState(n),n;const i=n.pluginURL,o=new Promise((f=>{this.loadScriptResolve=f}));e(i);const u=new Promise((f=>setTimeout((()=>f()),this.TIMEOUT)));if(yield Promise.race([o,u]),this.isParsed()){const f={pluginStatus:"loaded",pluginURL:i};return this.setState(f),f}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${i}`)}))}};class si{constructor(e,i){this.isSupportedScript=zs,this.zoom=e,i?(this.now=i.now||0,this.fadeDuration=i.fadeDuration||0,this.zoomHistory=i.zoomHistory||new oa,this.transition=i.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new oa,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*i}}}function zs(n){return(function(e,i){for(const o of e)if(!Cs(o.codePointAt(0),i))return!1;return!0})(n,Ba.getRTLTextPluginStatus()==="loaded")}const mo="-transition";class Go{constructor(e,i,o){this.property=e,this.value=i,this.expression=(function(u,f,p){if(yc(u))return new jo(u,f);if(ao(u)){const y=oo(u,f,p);if(y.result==="error")throw new Error(y.value.map((x=>`${x.key}: ${x.message}`)).join(", "));return y.value}{let y=u;return f.type==="color"&&typeof u=="string"?y=Xt.parse(u):f.type!=="padding"||typeof u!="number"&&!Array.isArray(u)?f.type!=="numberArray"||typeof u!="number"&&!Array.isArray(u)?f.type!=="colorArray"||typeof u!="string"&&!Array.isArray(u)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(u)?y=mn.parse(u):f.type==="projectionDefinition"&&typeof u=="string"&&(y=Yn.parse(u)):y=Bt.parse(u):y=$i.parse(u):y=Dn.parse(u),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>y}}})(i===void 0?e.specification.default:i,e.specification,o)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class Nu{constructor(e,i){this.property=e,this.value=new Go(e,void 0,i)}transitioned(e,i){return new Ol(this.property,this.value,i,ii({},e.transition,this.transition),e.now)}untransitioned(){return new Ol(this.property,this.value,null,{},0)}}class qo{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=i}getValue(e){return Qr(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Nu(this._values[e].property,this._globalState)),this._values[e].value=new Go(this._values[e].property,i===null?void 0:Qr(i),this._globalState)}getTransition(e){return Qr(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Nu(this._values[e].property,this._globalState)),this._values[e].transition=Qr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const u=this.getTransition(i);u!==void 0&&(e[`${i}${mo}`]=u)}return e}transitioned(e,i){const o=new Dc(this._properties);for(const u of Object.keys(this._values))o._values[u]=this._values[u].transitioned(e,i._values[u]);return o}untransitioned(){const e=new Dc(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Ol{constructor(e,i,o,u,f){this.property=e,this.value=i,this.begin=f+u.delay||0,this.end=this.begin+u.duration||0,e.specification.transition&&(u.delay||u.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,o),p=this.prior;if(p){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return p.possiblyEvaluate(e,i,o);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,o),f,it(y))}}return f}}class Dc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const u=new Zo(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,o);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ah{constructor(e,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=i}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Qr(this._values[e].value)}setValue(e,i){this._values[e]=new Go(this._values[e].property,i===null?void 0:Qr(i),this._globalState)}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){const u=new Zo(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,o);return u}}class Ir{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,u){return this.property.evaluate(this.value,this.parameters,e,i,o,u)}}class Zo{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Tt{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,o){const u=Yi[this.specification.type];return u?u(e,i,o):e}}class Pt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,u){return new Ir(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,u)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ir(this,{kind:"constant",value:void 0},e.parameters);const u=Yi[this.specification.type];if(u){const f=u(e.value.value,i.value.value,o);return new Ir(this,{kind:"constant",value:f},e.parameters)}return e}evaluate(e,i,o,u,f,p){return e.kind==="constant"?e.value:e.evaluate(i,o,u,f,p)}}class go extends Pt{possiblyEvaluate(e,i,o,u){if(e.value===void 0)return new Ir(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},o,u),p=e.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(p,p,p,i);return new Ir(this,{kind:"constant",value:y},i)}if(e.expression.kind==="camera"){const f=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new Ir(this,{kind:"constant",value:f},i)}return new Ir(this,e.expression,i)}evaluate(e,i,o,u,f,p){if(e.kind==="source"){const y=e.evaluate(i,o,u,f,p);return this._calculate(y,y,y,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},o,u),e.evaluate({zoom:Math.floor(i.zoom)},o,u),e.evaluate({zoom:Math.floor(i.zoom)+1},o,u),i):e.value}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class Pr{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){if(e.value!==void 0){if(e.expression.kind==="constant"){const f=e.expression.evaluate(i,null,{},o,u);return this._calculate(f,f,f,i)}return this._calculate(e.expression.evaluate(new si(Math.floor(i.zoom-1),i)),e.expression.evaluate(new si(Math.floor(i.zoom),i)),e.expression.evaluate(new si(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,o,u){return u.zoom>u.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:o,to:i}}interpolate(e){return e}}class rr{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,u){return!!e.expression.evaluate(i,null,{},o,u)}interpolate(){return!1}}class Sn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const o=e[i];o.specification.overridable&&this.overridableProperties.push(i);const u=this.defaultPropertyValues[i]=new Go(o,void 0,void 0),f=this.defaultTransitionablePropertyValues[i]=new Nu(o,void 0);this.defaultTransitioningPropertyValues[i]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate({})}}}lt("DataDrivenProperty",Pt),lt("DataConstantProperty",Tt),lt("CrossFadedDataDrivenProperty",go),lt("CrossFadedProperty",Pr),lt("ColorRampProperty",rr);class Rr extends ui{constructor(e,i,o){if(super(),this.id=e.id,this.type=e.type,this._globalState=o,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=jr(e.filter,o)),i.layout&&(this._unevaluatedLayout=new Ah(i.layout,o)),i.paint)){this._transitionablePaint=new qo(i.paint,o);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zo(i.paint)}}setFilter(e){this.filter=e,this._featureFilter=jr(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const i in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[i];for(const u of o.getGlobalStateRefs())e.add(u)}for(const i of this._featureFilter.getGlobalStateRefs())e.add(i);return e}getPaintAffectingGlobalStateRefs(){var e;const i=new globalThis.Map;if(this._transitionablePaint)for(const o in this._transitionablePaint._values){const u=this._transitionablePaint._values[o].value;for(const f of u.getGlobalStateRefs()){const p=(e=i.get(f))!==null&&e!==void 0?e:[];p.push({name:o,value:u.value}),i.set(f,p)}}return i}setLayoutProperty(e,i,o={}){i!=null&&this._validate(La,`layers.${this.id}.layout.${e}`,e,i,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return e.endsWith(mo)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,o={}){if(i!=null&&this._validate(Ur,`layers.${this.id}.paint.${e}`,e,i,o))return!1;if(e.endsWith(mo))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.property.specification["property-type"]==="cross-faded-data-driven",p=u.value.isDataDriven(),y=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value;return x.isDataDriven()||p||f||this._handleOverridablePaintPropertyUpdate(e,y,x)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e,i=!1){return!!(this.minzoom&&e<(i?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),qs(e,((i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length)))}_validate(e,i,o,u,f={}){return(!f||f.validate!==!1)&&Ru(this,e.call(Ll,{key:i,layerType:this.type,objectKey:o,value:u,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ir&&ba(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}let Ch;var _o={get paint(){return Ch=Ch||new Sn({"raster-opacity":new Tt(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Tt(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(xe.paint_raster["raster-saturation"]),"raster-contrast":new Tt(xe.paint_raster["raster-contrast"]),"raster-resampling":new Tt(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(xe.paint_raster["raster-fade-duration"])})}};class Gr extends Rr{constructor(e,i){super(e,_o,i)}}const Mn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ds{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class vi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function zt(n,e=1){let i=0,o=0;return{members:n.map((u=>{const f=Mn[u.type].BYTES_PER_ELEMENT,p=i=Oi(i,Math.max(e,f)),y=u.components||1;return o=Math.max(o,f),i+=f*y,{name:u.name,type:u.type,components:y,offset:p}})),size:Oi(i,Math.max(o,e)),alignment:e}}function Oi(n,e){return Math.ceil(n/e)*e}class an extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=o,e}}an.prototype.bytesPerElement=4,lt("StructArrayLayout2i4",an);class Ho extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=o,this.int16[f+2]=u,e}}Ho.prototype.bytesPerElement=6,lt("StructArrayLayout3i6",Ho);class la extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=u,this.int16[p+3]=f,e}}la.prototype.bytesPerElement=8,lt("StructArrayLayout4i8",la);class Is extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=p,this.int16[x+5]=y,e}}Is.prototype.bytesPerElement=12,lt("StructArrayLayout2i4i12",Is);class Fl extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=4*e,T=8*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.uint8[T+4]=u,this.uint8[T+5]=f,this.uint8[T+6]=p,this.uint8[T+7]=y,e}}Fl.prototype.bytesPerElement=8,lt("StructArrayLayout2i4ub8",Fl);class Ps extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=o,e}}Ps.prototype.bytesPerElement=8,lt("StructArrayLayout2f8",Ps);class Rs extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,o,u,f,p,y,x,T,E)}emplace(e,i,o,u,f,p,y,x,T,E,C){const D=10*e;return this.uint16[D+0]=i,this.uint16[D+1]=o,this.uint16[D+2]=u,this.uint16[D+3]=f,this.uint16[D+4]=p,this.uint16[D+5]=y,this.uint16[D+6]=x,this.uint16[D+7]=T,this.uint16[D+8]=E,this.uint16[D+9]=C,e}}Rs.prototype.bytesPerElement=20,lt("StructArrayLayout10ui20",Rs);class zh extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,o,u,f,p,y,x)}emplace(e,i,o,u,f,p,y,x,T){const E=8*e;return this.uint16[E+0]=i,this.uint16[E+1]=o,this.uint16[E+2]=u,this.uint16[E+3]=f,this.uint16[E+4]=p,this.uint16[E+5]=y,this.uint16[E+6]=x,this.uint16[E+7]=T,e}}zh.prototype.bytesPerElement=16,lt("StructArrayLayout8ui16",zh);class sn extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,C,D){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,o,u,f,p,y,x,T,E,C,D)}emplace(e,i,o,u,f,p,y,x,T,E,C,D,I){const L=12*e;return this.int16[L+0]=i,this.int16[L+1]=o,this.int16[L+2]=u,this.int16[L+3]=f,this.uint16[L+4]=p,this.uint16[L+5]=y,this.uint16[L+6]=x,this.uint16[L+7]=T,this.int16[L+8]=E,this.int16[L+9]=C,this.int16[L+10]=D,this.int16[L+11]=I,e}}sn.prototype.bytesPerElement=24,lt("StructArrayLayout4i4ui4i24",sn);class ka extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=o,this.float32[f+2]=u,e}}ka.prototype.bytesPerElement=12,lt("StructArrayLayout3f12",ka);class Nl extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Nl.prototype.bytesPerElement=4,lt("StructArrayLayout1ul4",Nl);class jl extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,o,u,f,p,y,x,T)}emplace(e,i,o,u,f,p,y,x,T,E){const C=10*e,D=5*e;return this.int16[C+0]=i,this.int16[C+1]=o,this.int16[C+2]=u,this.int16[C+3]=f,this.int16[C+4]=p,this.int16[C+5]=y,this.uint32[D+3]=x,this.uint16[C+8]=T,this.uint16[C+9]=E,e}}jl.prototype.bytesPerElement=20,lt("StructArrayLayout6i1ul2ui20",jl);class ju extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=u,this.int16[x+3]=f,this.int16[x+4]=p,this.int16[x+5]=y,e}}ju.prototype.bytesPerElement=12,lt("StructArrayLayout2i2i2i12",ju);class Vu extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,u,f)}emplace(e,i,o,u,f,p){const y=4*e,x=8*e;return this.float32[y+0]=i,this.float32[y+1]=o,this.float32[y+2]=u,this.int16[x+6]=f,this.int16[x+7]=p,e}}Vu.prototype.bytesPerElement=16,lt("StructArrayLayout2f1f2i16",Vu);class Uu extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,u,f,p)}emplace(e,i,o,u,f,p,y){const x=16*e,T=4*e,E=8*e;return this.uint8[x+0]=i,this.uint8[x+1]=o,this.float32[T+1]=u,this.float32[T+2]=f,this.int16[E+6]=p,this.int16[E+7]=y,e}}Uu.prototype.bytesPerElement=16,lt("StructArrayLayout2ub2f2i16",Uu);class Ls extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=o,this.uint16[f+2]=u,e}}Ls.prototype.bytesPerElement=6,lt("StructArrayLayout3ui6",Ls);class Bs extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,C,D,I,L,O,N,G){const J=this.length;return this.resize(J+1),this.emplace(J,e,i,o,u,f,p,y,x,T,E,C,D,I,L,O,N,G)}emplace(e,i,o,u,f,p,y,x,T,E,C,D,I,L,O,N,G,J){const q=24*e,$=12*e,te=48*e;return this.int16[q+0]=i,this.int16[q+1]=o,this.uint16[q+2]=u,this.uint16[q+3]=f,this.uint32[$+2]=p,this.uint32[$+3]=y,this.uint32[$+4]=x,this.uint16[q+10]=T,this.uint16[q+11]=E,this.uint16[q+12]=C,this.float32[$+7]=D,this.float32[$+8]=I,this.uint8[te+36]=L,this.uint8[te+37]=O,this.uint8[te+38]=N,this.uint32[$+10]=G,this.int16[q+22]=J,e}}Bs.prototype.bytesPerElement=48,lt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Bs);class hr extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u,f,p,y,x,T,E,C,D,I,L,O,N,G,J,q,$,te,re,we,Ne,ke,$e,at,Ye){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,i,o,u,f,p,y,x,T,E,C,D,I,L,O,N,G,J,q,$,te,re,we,Ne,ke,$e,at,Ye)}emplace(e,i,o,u,f,p,y,x,T,E,C,D,I,L,O,N,G,J,q,$,te,re,we,Ne,ke,$e,at,Ye,Fe){const ze=32*e,_t=16*e;return this.int16[ze+0]=i,this.int16[ze+1]=o,this.int16[ze+2]=u,this.int16[ze+3]=f,this.int16[ze+4]=p,this.int16[ze+5]=y,this.int16[ze+6]=x,this.int16[ze+7]=T,this.uint16[ze+8]=E,this.uint16[ze+9]=C,this.uint16[ze+10]=D,this.uint16[ze+11]=I,this.uint16[ze+12]=L,this.uint16[ze+13]=O,this.uint16[ze+14]=N,this.uint16[ze+15]=G,this.uint16[ze+16]=J,this.uint16[ze+17]=q,this.uint16[ze+18]=$,this.uint16[ze+19]=te,this.uint16[ze+20]=re,this.uint16[ze+21]=we,this.uint16[ze+22]=Ne,this.uint32[_t+12]=ke,this.float32[_t+13]=$e,this.float32[_t+14]=at,this.uint16[ze+30]=Ye,this.uint16[ze+31]=Fe,e}}hr.prototype.bytesPerElement=64,lt("StructArrayLayout8i15ui1ul2f2ui64",hr);class Wi extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Wi.prototype.bytesPerElement=4,lt("StructArrayLayout1f4",Wi);class hs extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=3*e;return this.uint16[6*e+0]=i,this.float32[f+1]=o,this.float32[f+2]=u,e}}hs.prototype.bytesPerElement=12,lt("StructArrayLayout1ui2f12",hs);class $o extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,o)}emplace(e,i,o,u){const f=4*e;return this.uint32[2*e+0]=i,this.uint16[f+2]=o,this.uint16[f+3]=u,e}}$o.prototype.bytesPerElement=8,lt("StructArrayLayout1ul2ui8",$o);class Vl extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=o,e}}Vl.prototype.bytesPerElement=4,lt("StructArrayLayout2ui4",Vl);class Ul extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Ul.prototype.bytesPerElement=2,lt("StructArrayLayout1ui2",Ul);class Oa extends vi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,o,u)}emplace(e,i,o,u,f){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=u,this.float32[p+3]=f,e}}Oa.prototype.bytesPerElement=16,lt("StructArrayLayout4f16",Oa);class m extends Ds{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ge(this.anchorPointX,this.anchorPointY)}}m.prototype.size=20;class t extends jl{get(e){return new m(this,e)}}lt("CollisionBoxArray",t);class a extends Ds{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}a.prototype.size=48;class l extends Bs{get(e){return new a(this,e)}}lt("PlacedSymbolArray",l);class h extends Ds{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}h.prototype.size=64;class _ extends hr{get(e){return new h(this,e)}}lt("SymbolInstanceArray",_);class v extends Wi{getoffsetX(e){return this.float32[1*e+0]}}lt("GlyphOffsetArray",v);class w extends Ho{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}lt("SymbolLineVertexArray",w);class S extends Ds{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}S.prototype.size=12;class A extends hs{get(e){return new S(this,e)}}lt("TextAnchorOffsetArray",A);class z extends Ds{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}z.prototype.size=8;class R extends $o{get(e){return new z(this,e)}}lt("FeatureIndexArray",R);class P extends an{}class F extends an{}class U extends an{}class X extends Is{}class W extends Fl{}class Y extends Ps{}class Q extends Rs{}class ne extends zh{}class K extends sn{}class ae extends ka{}class le extends Nl{}class ee extends ju{}class de extends Uu{}class Me extends Ls{}class be extends Vl{}const Ee=zt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ce}=Ee;class He{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,i,o,u){const f=this.segments[this.segments.length-1];return e>He.MAX_VERTEX_ARRAY_LENGTH&&tn(`Max vertices per segment is ${He.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${He.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!f||f.vertexLength+e>He.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u?this.createNewSegment(i,o,u):f}createNewSegment(e,i,o){const u={vertexOffset:e.length,primitiveOffset:i.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(u.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(u),u}getOrCreateLatestSegment(e,i,o){return this.prepareSegment(0,e,i,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,u){return new He([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:u,vaos:{},sortKey:0}])}}function et(n,e){return 256*(n=ft(Math.floor(n),0,255))+ft(Math.floor(e),0,255)}He.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,lt("SegmentVector",He);const qe=zt([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),wt=zt([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Vt,_i,Fi,xi={exports:{}},Zi={exports:{}},Ci={exports:{}},kn=(function(){if(Fi)return xi.exports;Fi=1;var n=(Vt||(Vt=1,Zi.exports=function(i,o){var u,f,p,y,x,T,E,C;for(f=i.length-(u=3&i.length),p=o,x=3432918353,T=461845907,C=0;C<f;)E=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,p=27492+(65535&(y=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(E=0,u){case 3:E^=(255&i.charCodeAt(C+2))<<16;case 2:E^=(255&i.charCodeAt(C+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&i.charCodeAt(C)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*T+(((E>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),Zi.exports),e=(_i||(_i=1,Ci.exports=function(i,o){for(var u,f=i.length,p=o^f,y=0;f>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Ci.exports);return xi.exports=n,xi.exports.murmur3=n,xi.exports.murmur2=e,xi.exports})(),Gi=Be(kn);class On{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,o,u){this.ids.push(on(e)),this.positions.push(i,o,u)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=on(e);let o=0,u=this.ids.length-1;for(;o<u;){const p=o+u>>1;this.ids[p]>=i?u=p:o=p+1}const f=[];for(;this.ids[o]===i;)f.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return f}static serialize(e,i){const o=new Float64Array(e.ids),u=new Uint32Array(e.positions);return _n(o,u,0,o.length-1),i&&i.push(o.buffer,u.buffer),{ids:o,positions:u}}static deserialize(e){const i=new On;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function on(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Gi(String(n))}function _n(n,e,i,o){for(;i<o;){const u=n[i+o>>1];let f=i-1,p=o+1;for(;;){do f++;while(n[f]<u);do p--;while(n[p]>u);if(f>=p)break;ar(n,f,p),ar(e,3*f,3*p),ar(e,3*f+1,3*p+1),ar(e,3*f+2,3*p+2)}p-i<o-p?(_n(n,e,i,p),i=p+1):(_n(n,e,p+1,o),o=p)}}function ar(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}lt("FeaturePositionMap",On);class dr{constructor(e,i){this.gl=e.gl,this.location=i}}class Fa extends dr{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class ks extends dr{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Xo extends dr{constructor(e,i){super(e,i),this.current=Xt.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Ic=new Float32Array(16);function Yo(n){return[et(255*n.r,255*n.g),et(255*n.b,255*n.a)]}class qr{constructor(e,i,o){this.value=e,this.uniformNames=i.map((u=>`u_${u}`)),this.type=o}setUniform(e,i,o){e.set(o.constantOr(this.value))}getBinding(e,i,o){return this.type==="color"?new Xo(e,i):new Fa(e,i)}}class Fn{constructor(e,i){this.uniformNames=i.map((o=>`u_${o}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,i){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,i.y,i.height,i.width]}setUniform(e,i,o,u){let f=null;u==="u_pattern_to"?f=this.patternTo:u==="u_pattern_from"?f=this.patternFrom:u==="u_dasharray_to"?f=this.dashTo:u==="u_dasharray_from"?f=this.dashFrom:u==="u_pixel_ratio_to"?f=this.pixelRatioTo:u==="u_pixel_ratio_from"&&(f=this.pixelRatioFrom),f!==null&&e.set(f)}getBinding(e,i,o){return o.substr(0,9)==="u_pattern"||o.substr(0,12)==="u_dasharray_"?new ks(e,i):new Fa(e,i)}}class Wn{constructor(e,i,o,u){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map((f=>({name:`a_${f}`,type:"Float32",components:o==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,i,o){const u=this.paintVertexArray.length,f=this.expression.evaluate(new si(0,o),i,{},o.canonical,[],o.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(u,e,f)}updatePaintArray(e,i,o,u,f){const p=this.expression.evaluate(new si(0,f),o,u);this._setPaintValue(e,i,p)}_setPaintValue(e,i,o){if(this.type==="color"){const u=Yo(o);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class sr{constructor(e,i,o,u,f,p){this.expression=e,this.uniformNames=i.map((y=>`u_${y}_t`)),this.type=o,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map((y=>({name:`a_${y}`,type:"Float32",components:o==="color"?4:2,offset:0}))),this.paintVertexArray=new p}populatePaintArray(e,i,o){const u=this.expression.evaluate(new si(this.zoom,o),i,{},o.canonical,[],o.formattedSection),f=this.expression.evaluate(new si(this.zoom+1,o),i,{},o.canonical,[],o.formattedSection),p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(p,e,u,f)}updatePaintArray(e,i,o,u,f){const p=this.expression.evaluate(new si(this.zoom,f),o,u),y=this.expression.evaluate(new si(this.zoom+1,f),o,u);this._setPaintValue(e,i,p,y)}_setPaintValue(e,i,o,u){if(this.type==="color"){const f=Yo(o),p=Yo(u);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,f[0],f[1],p[0],p[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,o,u);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const o=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=ft(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(u)}getBinding(e,i,o){return new Fa(e,i)}}class ua{constructor(e,i,o,u,f,p){this.expression=e,this.type=i,this.useIntegerZoom=o,this.zoom=u,this.layerId=p,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(e,i,o){const u=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(u,e,this.getPositionIds(i),o)}updatePaintArray(e,i,o,u,f){this._setPaintValues(e,i,this.getPositionIds(o),f)}_setPaintValues(e,i,o,u){const f=this.getPositions(u);if(!f||!o)return;const p=f[o.min],y=f[o.mid],x=f[o.max];if(p&&y&&x)for(let T=e;T<i;T++)this.emplace(this.zoomInPaintVertexArray,T,y,p),this.emplace(this.zoomOutPaintVertexArray,T,y,x)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const i=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,i,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,i,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ln extends ua{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return qe.members}emplace(e,i,o,u){e.emplace(i,o.tlbr[0],o.tlbr[1],o.tlbr[2],o.tlbr[3],u.tlbr[0],u.tlbr[1],u.tlbr[2],u.tlbr[3],o.pixelRatio,u.pixelRatio)}}class Nn extends ua{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return wt.members}emplace(e,i,o,u){e.emplace(i,0,o.y,o.height,o.width,0,u.y,u.height,u.width)}}class Lr{constructor(e,i,o){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!o(f))continue;const p=e.paint.get(f);if(!(p instanceof Ir&&ba(p.property.specification)))continue;const y=Dh(f,e.type),x=p.value,T=p.property.specification.type,E=p.property.useIntegerZoom,C=p.property.specification["property-type"],D=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[f]=D?new Fn(x.value,y):new qr(x.value,y,T),u.push(`/u_${f}`);else if(x.kind==="source"||D){const I=Pc(f,T,"source");this.binders[f]=D?f==="line-dasharray"?new Nn(x,T,E,i,I,e.id):new ln(x,T,E,i,I,e.id):new Wn(x,y,T,I),u.push(`/a_${f}`)}else{const I=Pc(f,T,"composite");this.binders[f]=new sr(x,y,T,E,i,I),u.push(`/z_${f}`)}}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Wn||i instanceof sr?i.maxValue:0}populatePaintArrays(e,i,o){for(const u in this.binders){const f=this.binders[u];(f instanceof Wn||f instanceof sr||f instanceof ua)&&f.populatePaintArray(e,i,o)}}setConstantPatternPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof Fn&&u.setConstantPatternPositions(e,i)}}setConstantDashPositions(e,i){for(const o in this.binders){const u=this.binders[o];u instanceof Fn&&u.setConstantDashPositions(e,i)}}updatePaintArrays(e,i,o,u,f){let p=!1;for(const y in e){const x=i.getPositions(y);for(const T of x){const E=o.feature(T.index);for(const C in this.binders){const D=this.binders[C];if((D instanceof Wn||D instanceof sr||D instanceof ua)&&D.expression.isStateDependent===!0){const I=u.paint.get(C);D.expression=I.value,D.updatePaintArray(T.start,T.end,E,e[y],f),p=!0}}}}return p}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof qr||o instanceof Fn)&&e.push(...o.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof Wn||o instanceof sr)for(let u=0;u<o.paintVertexAttributes.length;u++)e.push(o.paintVertexAttributes[u].name);else if(o instanceof ua){const u=o.getVertexAttributes();for(const f of u)e.push(f.name)}}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const o=this.binders[i];if(o instanceof qr||o instanceof Fn||o instanceof sr)for(const u of o.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const o=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof qr||f instanceof Fn||f instanceof sr){for(const p of f.uniformNames)if(i[p]){const y=f.getBinding(e,i[p],p);o.push({name:p,property:u,binding:y})}}}return o}setUniforms(e,i,o,u){for(const{name:f,property:p,binding:y}of i)this.binders[p].setUniform(y,u,o.get(p),f)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const o=this.binders[i];if(e&&o instanceof ua){const u=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;u&&this._buffers.push(u)}else(o instanceof Wn||o instanceof sr)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Wn||o instanceof sr||o instanceof ua)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Wn||i instanceof sr||i instanceof ua)&&i.destroy()}}}class Qi{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Lr(u,i,o);this.needsUpload=!1,this._featureMap=new On,this._bufferOffset=0}populatePaintArrays(e,i,o,u){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,i,u);i.id!==void 0&&this._featureMap.add(i.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,u){for(const f of o)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(e,this._featureMap,i,f,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Dh(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function Pc(n,e,i){const o={color:{source:Ps,composite:Oa},number:{source:Wi,composite:Ps}},u=(function(f){return{"line-pattern":{source:Q,composite:Q},"fill-pattern":{source:Q,composite:Q},"fill-extrusion-pattern":{source:Q,composite:Q},"line-dasharray":{source:ne,composite:ne}}[f]})(n);return u&&u[i]||o[e][i]}lt("ConstantBinder",qr),lt("CrossFadedConstantBinder",Fn),lt("SourceExpressionBinder",Wn),lt("CrossFadedPatternBinder",ln),lt("CrossFadedDasharrayBinder",Nn),lt("CompositeExpressionBinder",sr),lt("ProgramConfiguration",Lr,{omit:["_buffers"]}),lt("ProgramConfigurationSet",Qi);const Rc=Math.pow(2,14)-1,Ih=-Rc-1;function ca(n){const e=Re/n.extent,i=n.loadGeometry();for(let o=0;o<i.length;o++){const u=i[o];for(let f=0;f<u.length;f++){const p=u[f],y=Math.round(p.x*e),x=Math.round(p.y*e);p.x=ft(y,Ih,Rc),p.y=ft(x,Ih,Rc),(y<p.x||y>p.x+1||x<p.y||x>p.y+1)&&tn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function yo(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?ca(n):[]}}const Os=-32768;function Ph(n,e,i,o,u){n.emplaceBack(Os+8*e+o,Os+8*i+u)}class Wo{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new F,this.indexArray=new Me,this.segments=new He,this.programConfigurations=new Qi(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){const u=this.layers[0],f=[];let p=null,y=!1,x=u.type==="heatmap";if(u.type==="circle"){const E=u;p=E.layout.get("circle-sort-key"),y=!p.isConstant(),x=x||E.paint.get("circle-pitch-alignment")==="map"}const T=x?i.subdivisionGranularity.circle:1;for(const{feature:E,id:C,index:D,sourceLayerIndex:I}of e){const L=this.layers[0]._featureFilter.needGeometry,O=yo(E,L);if(!this.layers[0]._featureFilter.filter(new si(this.zoom),O,o))continue;const N=y?p.evaluate(O,{},o):void 0,G={id:C,properties:E.properties,type:E.type,sourceLayerIndex:I,index:D,geometry:L?O.geometry:ca(E),patterns:{},sortKey:N};f.push(G)}y&&f.sort(((E,C)=>E.sortKey-C.sortKey));for(const E of f){const{geometry:C,index:D,sourceLayerIndex:I}=E,L=e[D].feature;this.addFeature(E,C,D,o,T),i.featureIndex.insert(L,C,D,I,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ce),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,u,f=1){let p;switch(f){case 1:p=[0,7];break;case 3:p=[0,2,5,7];break;case 5:p=[0,1,3,4,6,7];break;case 7:p=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${f}; valid values are 1, 3, 5, 7.`)}const y=p.length;for(const x of i)for(const T of x){const E=T.x,C=T.y;if(E<0||E>=Re||C<0||C>=Re)continue;const D=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,e.sortKey),I=D.vertexLength;for(let L=0;L<y;L++)for(let O=0;O<y;O++)Ph(this.layoutVertexArray,E,C,p[O],p[L]);for(let L=0;L<y-1;L++)for(let O=0;O<y-1;O++){const N=I+L*y+O,G=I+(L+1)*y+O;this.indexArray.emplaceBack(N,G+1,N+1),this.indexArray.emplaceBack(N,G,G+1)}D.vertexLength+=y*y,D.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:{},canonical:u})}}function Lc(n,e){for(let i=0;i<n.length;i++)if(Gu(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Gu(n,e[i]))return!0;return!!If(n,e)}function vo(n,e,i){return!!Gu(n,e)||!!jn(e,n,i)}function Bc(n,e){if(n.length===1)return Rf(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let u=0;u<o.length;u++)if(Gu(n,o[u]))return!0}for(let i=0;i<n.length;i++)if(Rf(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(If(n,e[i]))return!0;return!1}function kc(n,e,i){if(n.length>1){if(If(n,e))return!0;for(let o=0;o<e.length;o++)if(jn(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(jn(n[o],e,i))return!0;return!1}function If(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],u=n[i+1];for(let f=0;f<e.length-1;f++)if(Pf(o,u,e[f],e[f+1]))return!0}return!1}function Pf(n,e,i,o){return Or(n,i,o)!==Or(e,i,o)&&Or(n,e,i)!==Or(n,e,o)}function jn(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let u=1;u<e.length;u++)if(vr(n,e[u-1],e[u])<o)return!0;return!1}function vr(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const u=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function Rf(n,e){let i,o,u,f=!1;for(let p=0;p<n.length;p++){i=n[p];for(let y=0,x=i.length-1;y<i.length;x=y++)o=i[y],u=i[x],o.y>e.y!=u.y>e.y&&e.x<(u.x-o.x)*(e.y-o.y)/(u.y-o.y)+o.x&&(f=!f)}return f}function Gu(n,e){let i=!1;for(let o=0,u=n.length-1;o<n.length;u=o++){const f=n[o],p=n[u];f.y>e.y!=p.y>e.y&&e.x<(p.x-f.x)*(e.y-f.y)/(p.y-f.y)+f.x&&(i=!i)}return i}function Op(n,e,i){const o=i[0],u=i[2];if(n.x<o.x&&e.x<o.x||n.x>u.x&&e.x>u.x||n.y<o.y&&e.y<o.y||n.y>u.y&&e.y>u.y)return!1;const f=Or(n,e,i[0]);return f!==Or(n,e,i[1])||f!==Or(n,e,i[2])||f!==Or(n,e,i[3])}function qu(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function Gl(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function Rh(n,e,i,o,u){if(!e[0]&&!e[1])return n;const f=ge.convert(e)._mult(u);i==="viewport"&&f._rotate(-o);const p=[];for(let y=0;y<n.length;y++)p.push(n[y].sub(f));return p}function Bd(n){const e=[];for(let i=0;i<n.length;i++){const o=n[i],u=e.at(-1);(i===0||u&&!o.equals(u))&&e.push(o)}return e}function Fp({queryGeometry:n,size:e},i){return vo(n,i,e)}function km({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){return vo(n,f,e*(i.projectTileCoordinates(f.x,f.y,o,u).signedDistanceFromCamera/i.cameraToCenterDistance))}function kd({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){const p=i.projectTileCoordinates(f.x,f.y,o,u).signedDistanceFromCamera,y=e*(i.cameraToCenterDistance/p);return vo(n,Od(f,i,o,u),y)}function Lf({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u},f){return vo(n,Od(f,i,o,u),e)}function Bf({queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u,pitchAlignment:f="map",pitchScale:p="map"},y){const x=f==="map"?p==="map"?Fp:km:p==="map"?kd:Lf,T={queryGeometry:n,size:e,transform:i,unwrappedTileID:o,getElevation:u};for(const E of y)for(const C of E)if(x(T,C))return!0;return!1}function Od(n,e,i,o){const u=e.projectTileCoordinates(n.x,n.y,i,o).point;return new ge((.5*u.x+.5)*e.width,(.5*-u.y+.5)*e.height)}let kf,Fd;lt("CircleBucket",Wo,{omit:["layers"]});var Of={get paint(){return Fd=Fd||new Sn({"circle-radius":new Pt(xe.paint_circle["circle-radius"]),"circle-color":new Pt(xe.paint_circle["circle-color"]),"circle-blur":new Pt(xe.paint_circle["circle-blur"]),"circle-opacity":new Pt(xe.paint_circle["circle-opacity"]),"circle-translate":new Tt(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pt(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pt(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pt(xe.paint_circle["circle-stroke-opacity"])})},get layout(){return kf=kf||new Sn({"circle-sort-key":new Pt(xe.layout_circle["circle-sort-key"])})}};class Ff extends Rr{constructor(e,i){super(e,Of,i)}createBucket(e){return new Wo(e)}queryRadius(e){const i=e;return qu("circle-radius",this,i)+qu("circle-stroke-width",this,i)+Gl(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){const T=Rh(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-f.bearingInRadians,p),E=this.paint.get("circle-radius").evaluate(i,o)+this.paint.get("circle-stroke-width").evaluate(i,o),C=this.paint.get("circle-pitch-scale"),D=this.paint.get("circle-pitch-alignment");let I,L;return D==="map"?(I=T,L=E*p):(I=(function(O,N,G,J){return O.map((q=>Od(q,N,G,J)))})(T,f,y,x),L=E),Bf({queryGeometry:I,size:L,transform:f,unwrappedTileID:y,getElevation:x,pitchAlignment:D,pitchScale:C},u)}}class Nf extends Wo{}let Nd;lt("HeatmapBucket",Nf,{omit:["layers"]});var jd={get paint(){return Nd=Nd||new Sn({"heatmap-radius":new Pt(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pt(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new rr(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(xe.paint_heatmap["heatmap-opacity"])})}};function Lh(n,{width:e,height:i},o,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*o)throw new RangeError(`mismatched image size. expected: ${u.length} but got: ${e*i*o}`)}else u=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=u,n}function jf(n,{width:e,height:i},o){if(e===n.width&&i===n.height)return;const u=Lh({},{width:e,height:i},o);Bh(n,u,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,i)},o),n.width=e,n.height=i,n.data=u.data}function Bh(n,e,i,o,u,f){if(u.width===0||u.height===0)return e;if(u.width>n.width||u.height>n.height||i.x>n.width-u.width||i.y>n.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||o.x>e.width-u.width||o.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const p=n.data,y=e.data;if(p===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<u.height;x++){const T=((i.y+x)*n.width+i.x)*f,E=((o.y+x)*e.width+o.x)*f;for(let C=0;C<u.width*f;C++)y[E+C]=p[T+C]}return e}class Oc{constructor(e,i){Lh(this,e,1,i)}resize(e){jf(this,e,1)}clone(){return new Oc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,f){Bh(e,i,o,u,f,1)}}class Pn{constructor(e,i){Lh(this,e,4,i)}resize(e){jf(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Pn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,u,f){Bh(e,i,o,u,f,4)}setPixel(e,i,o){const u=4*(e*this.width+i);this.data[u+0]=Math.round(255*o.r/o.a),this.data[u+1]=Math.round(255*o.g/o.a),this.data[u+2]=Math.round(255*o.b/o.a),this.data[u+3]=Math.round(255*o.a)}}function Vd(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,u=n.image||new Pn({width:i,height:o});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const f=(p,y,x)=>{e[n.evaluationKey]=x;const T=n.expression.evaluate(e);u.setPixel(p/4/i,y/4,T)};if(n.clips)for(let p=0,y=0;p<o;++p,y+=4*i)for(let x=0,T=0;x<i;x++,T+=4){const E=x/(i-1),{start:C,end:D}=n.clips[p];f(y,T,C*(1-E)+D*E)}else for(let p=0,y=0;p<i;p++,y+=4)f(0,y,p/(i-1));return u}lt("AlphaImage",Oc),lt("RGBAImage",Pn);const Vf="big-fb";class Np extends Rr{createBucket(e){return new Nf(e)}constructor(e,i){super(e,jd,i),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Vd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Vf)&&this.heatmapFbos.delete(Vf)}queryRadius(e){return qu("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,unwrappedTileID:y,getElevation:x}){return Bf({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(i,o)*p,transform:f,unwrappedTileID:y,getElevation:x},u)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let xo;var Uf={get paint(){return xo=xo||new Sn({"hillshade-illumination-direction":new Tt(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Tt(xe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Tt(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(xe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Tt(xe.paint_hillshade["hillshade-method"])})}};class jp extends Rr{constructor(e,i){super(e,Uf,i),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,i=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,u=this.paint.get("hillshade-shadow-color").values;const f=Math.max(e.length,i.length,o.length,u.length);e=e.concat(Array(f-e.length).fill(e.at(-1))),i=i.concat(Array(f-i.length).fill(i.at(-1))),o=o.concat(Array(f-o.length).fill(o.at(-1))),u=u.concat(Array(f-u.length).fill(u.at(-1)));const p=i.map(er);return{directionRadians:e.map(er),altitudeRadians:p,shadowColor:u,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let kh;var Oh={get paint(){return kh=kh||new Sn({"color-relief-opacity":new Tt(xe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new rr(xe["paint_color-relief"]["color-relief-color"])})}};class Ki{constructor(e,i,o,u){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,o){const{width:u,height:f}=e,p=!(this.size&&this.size[0]===u&&this.size[1]===f||o),{context:y}=this,{gl:x}=y;if(this.useMipmap=!!(i&&i.useMipmap),x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),p)this.size=[u,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||gs(e)?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,f,0,this.format,x.UNSIGNED_BYTE,e.data);else{const{x:T,y:E}=o||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||gs(e)?x.texSubImage2D(x.TEXTURE_2D,0,T,E,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,T,E,u,f,x.RGBA,x.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&x.generateMipmap(x.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,i,o){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),o!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,o||e),this.filter=e),i!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Vp{constructor(e,i,o,u=1,f=1,p=1,y=0){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void tn(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=i.height;const x=this.dim=i.height-2;switch(this.data=new Uint32Array(i.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=u,this.greenFactor=f,this.blueFactor=p,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let E=0;E<x;E++){const C=this.get(T,E);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(e,i){const o=new Uint8Array(this.data.buffer),u=4*this._idx(e,i);return this.unpack(o[u],o[u+1],o[u+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}unpack(e,i,o){return e*this.redFactor+i*this.greenFactor+o*this.blueFactor-this.baseShift}pack(e){return Up(e,this.getUnpackVector())}getPixels(){return new Pn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,p=o*this.dim,y=o*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(o){case-1:p=y-1;break;case 1:y=p+1}const x=-i*this.dim,T=-o*this.dim;for(let E=p;E<y;E++)for(let C=u;C<f;C++)this.data[this._idx(C,E)]=e.data[this._idx(C+x,E+T)]}}function Up(n,e){const i=e[0],o=e[1],u=e[2],f=e[3],p=Math.min(i,o,u),y=Math.round((n+f)/p);return{r:Math.floor(y*p/i)%256,g:Math.floor(y*p/o)%256,b:Math.floor(y*p/u)%256}}lt("DEMData",Vp);class Gp extends Rr{constructor(e,i){super(e,Oh,i)}_createColorRamp(e){const i={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof zr&&o._styleExpression.expression instanceof Ar){this.colorRampExpression=o;const p=o._styleExpression.expression;i.elevationStops=p.labels,i.colorStops=[];for(const y of i.elevationStops)i.colorStops.push(p.evaluate({globals:{elevation:y}}))}if(i.elevationStops.length<1&&(i.elevationStops=[0],i.colorStops=[Xt.transparent]),i.elevationStops.length<2&&(i.elevationStops.push(i.elevationStops[0]+1),i.colorStops.push(i.colorStops[0])),i.elevationStops.length<=e)return i;const u={elevationStops:[],colorStops:[]},f=(i.elevationStops.length-1)/(e-1);for(let p=0;p<i.elevationStops.length-.5;p+=f)u.elevationStops.push(i.elevationStops[Math.round(p)]),u.colorStops.push(i.colorStops[Math.round(p)]);return tn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${i.elevationStops.length}`),u}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,i,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const u=this._createColorRamp(i),f=new Pn({width:u.colorStops.length,height:1}),p=new Pn({width:u.colorStops.length,height:1});for(let y=0;y<u.elevationStops.length;y++){const x=Up(u.elevationStops[y],o);p.setPixel(0,y,new Xt(x.r/255,x.g/255,x.b/255,1)),f.setPixel(0,y,u.colorStops[y])}return this.colorRampTextures={elevationTexture:new Ki(e,p,e.gl.RGBA),colorTexture:new Ki(e,f,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Fh=zt([{name:"a_pos",components:2,type:"Int16"}],4),{members:ql}=Fh;function Nh(n,e,i){const o=i.patternDependencies;let u=!1;for(const f of e){const p=f.paint.get(`${n}-pattern`);p.isConstant()||(u=!0);const y=p.constantOr(null);y&&(u=!0,o[y.to]=!0,o[y.from]=!0)}return u}function Ud(n,e,i,o,u){const{zoom:f}=o,p=u.patternDependencies;for(const y of e){const x=y.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let T=x.evaluate({zoom:f-1},i,{},u.availableImages),E=x.evaluate({zoom:f},i,{},u.availableImages),C=x.evaluate({zoom:f+1},i,{},u.availableImages);T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,C=C&&C.name?C.name:C,p[T]=!0,p[E]=!0,p[C]=!0,i.patterns[y.id]={min:T,mid:E,max:C}}}return i}function Fc(n,e,i,o,u){let f;if(u===(function(p,y,x,T){let E=0;for(let C=y,D=x-T;C<x;C+=T)E+=(p[D]-p[C])*(p[C+1]+p[D+1]),D=C;return E})(n,e,i,o)>0)for(let p=e;p<i;p+=o)f=Yf(p/o|0,n[p],n[p+1],f);else for(let p=i-o;p>=e;p-=o)f=Yf(p/o|0,n[p],n[p+1],f);return f&&Zu(f,f.next)&&(jh(f),f=f.next),f}function Zr(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!Zu(o,o.next)&&En(o.prev,o,o.next)!==0)o=o.next;else{if(jh(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Nc(n,e,i,o,u,f,p){if(!n)return;!p&&f&&(function(x,T,E,C){let D=x;do D.z===0&&(D.z=Vn(D.x,D.y,T,E,C)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,(function(I){let L,O=1;do{let N,G=I;I=null;let J=null;for(L=0;G;){L++;let q=G,$=0;for(let re=0;re<O&&($++,q=q.nextZ,q);re++);let te=O;for(;$>0||te>0&&q;)$!==0&&(te===0||!q||G.z<=q.z)?(N=G,G=G.nextZ,$--):(N=q,q=q.nextZ,te--),J?J.nextZ=N:I=N,N.prevZ=J,J=N;G=q}J.nextZ=null,O*=2}while(L>1)})(D)})(n,o,u,f);let y=n;for(;n.prev!==n.next;){const x=n.prev,T=n.next;if(f?qp(n,o,u,f):Gf(n))e.push(x.i,n.i,T.i),jh(n),n=T.next,y=T.next;else if((n=T)===y){p?p===1?Nc(n=qf(Zr(n),e),e,i,o,u,f,2):p===2&&Zf(n,e,i,o,u,f):Nc(Zr(n),e,i,o,u,f,1);break}}}function Gf(n){const e=n.prev,i=n,o=n.next;if(En(e,i,o)>=0)return!1;const u=e.x,f=i.x,p=o.x,y=e.y,x=i.y,T=o.y,E=Math.min(u,f,p),C=Math.min(y,x,T),D=Math.max(u,f,p),I=Math.max(y,x,T);let L=o.next;for(;L!==e;){if(L.x>=E&&L.x<=D&&L.y>=C&&L.y<=I&&Un(u,y,f,x,p,T,L.x,L.y)&&En(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function qp(n,e,i,o){const u=n.prev,f=n,p=n.next;if(En(u,f,p)>=0)return!1;const y=u.x,x=f.x,T=p.x,E=u.y,C=f.y,D=p.y,I=Math.min(y,x,T),L=Math.min(E,C,D),O=Math.max(y,x,T),N=Math.max(E,C,D),G=Vn(I,L,e,i,o),J=Vn(O,N,e,i,o);let q=n.prevZ,$=n.nextZ;for(;q&&q.z>=G&&$&&$.z<=J;){if(q.x>=I&&q.x<=O&&q.y>=L&&q.y<=N&&q!==u&&q!==p&&Un(y,E,x,C,T,D,q.x,q.y)&&En(q.prev,q,q.next)>=0||(q=q.prevZ,$.x>=I&&$.x<=O&&$.y>=L&&$.y<=N&&$!==u&&$!==p&&Un(y,E,x,C,T,D,$.x,$.y)&&En($.prev,$,$.next)>=0))return!1;$=$.nextZ}for(;q&&q.z>=G;){if(q.x>=I&&q.x<=O&&q.y>=L&&q.y<=N&&q!==u&&q!==p&&Un(y,E,x,C,T,D,q.x,q.y)&&En(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;$&&$.z<=J;){if($.x>=I&&$.x<=O&&$.y>=L&&$.y<=N&&$!==u&&$!==p&&Un(y,E,x,C,T,D,$.x,$.y)&&En($.prev,$,$.next)>=0)return!1;$=$.nextZ}return!0}function qf(n,e){let i=n;do{const o=i.prev,u=i.next.next;!Zu(o,u)&&yn(o,i,i.next,u)&&jc(o,u)&&jc(u,o)&&(e.push(o.i,i.i,u.i),jh(i),jh(i.next),i=n=u),i=i.next}while(i!==n);return Zr(i)}function Zf(n,e,i,o,u,f){let p=n;do{let y=p.next.next;for(;y!==p.prev;){if(p.i!==y.i&&Om(p,y)){let x=Xf(p,y);return p=Zr(p,p.next),x=Zr(x,x.next),Nc(p,e,i,o,u,f,0),void Nc(x,e,i,o,u,f,0)}y=y.next}p=p.next}while(p!==n)}function Gd(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function Zp(n,e){const i=(function(u,f){let p=f;const y=u.x,x=u.y;let T,E=-1/0;if(Zu(u,p))return p;do{if(Zu(u,p.next))return p.next;if(x<=p.y&&x>=p.next.y&&p.next.y!==p.y){const O=p.x+(x-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(O<=y&&O>E&&(E=O,T=p.x<p.next.x?p:p.next,O===y))return T}p=p.next}while(p!==f);if(!T)return null;const C=T,D=T.x,I=T.y;let L=1/0;p=T;do{if(y>=p.x&&p.x>=D&&y!==p.x&&$f(x<I?y:E,x,D,I,x<I?E:y,x,p.x,p.y)){const O=Math.abs(x-p.y)/(y-p.x);jc(p,u)&&(O<L||O===L&&(p.x>T.x||p.x===T.x&&Qo(T,p)))&&(T=p,L=O)}p=p.next}while(p!==C);return T})(n,e);if(!i)return e;const o=Xf(i,n);return Zr(o,o.next),Zr(i,i.next)}function Qo(n,e){return En(n.prev,n,e.prev)<0&&En(e.next,n,n.next)<0}function Vn(n,e,i,o,u){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*u|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Hf(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function $f(n,e,i,o,u,f,p,y){return(u-p)*(e-y)>=(n-p)*(f-y)&&(n-p)*(o-y)>=(i-p)*(e-y)&&(i-p)*(f-y)>=(u-p)*(o-y)}function Un(n,e,i,o,u,f,p,y){return!(n===p&&e===y)&&$f(n,e,i,o,u,f,p,y)}function Om(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!(function(i,o){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==o.i&&u.next.i!==o.i&&yn(u,u.next,i,o))return!0;u=u.next}while(u!==i);return!1})(n,e)&&(jc(n,e)&&jc(e,n)&&(function(i,o){let u=i,f=!1;const p=(i.x+o.x)/2,y=(i.y+o.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&p<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==i);return f})(n,e)&&(En(n.prev,n,e.prev)||En(n,e.prev,e))||Zu(n,e)&&En(n.prev,n,n.next)>0&&En(e.prev,e,e.next)>0)}function En(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Zu(n,e){return n.x===e.x&&n.y===e.y}function yn(n,e,i,o){const u=ds(En(n,e,i)),f=ds(En(n,e,o)),p=ds(En(i,o,n)),y=ds(En(i,o,e));return u!==f&&p!==y||!(u!==0||!Br(n,i,e))||!(f!==0||!Br(n,o,e))||!(p!==0||!Br(i,n,o))||!(y!==0||!Br(i,e,o))}function Br(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function ds(n){return n>0?1:n<0?-1:0}function jc(n,e){return En(n.prev,n,n.next)<0?En(n,e,n.next)>=0&&En(n,n.prev,e)>=0:En(n,e,n.prev)<0||En(n,n.next,e)<0}function Xf(n,e){const i=Vc(n.i,n.x,n.y),o=Vc(e.i,e.x,e.y),u=n.next,f=e.prev;return n.next=e,e.prev=n,i.next=u,u.prev=i,o.next=i,i.prev=o,f.next=o,o.prev=f,o}function Yf(n,e,i,o){const u=Vc(n,e,i);return o?(u.next=o.next,u.prev=o,o.next.prev=u,o.next=u):(u.prev=u,u.next=u),u}function jh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Vc(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class fr{constructor(e,i){if(i>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=i}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Ma{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Ma.noSubdivision=new Ma({fill:new fr(0,0),line:new fr(0,0),tile:new fr(0,0),stencil:new fr(0,0),circle:1}),lt("SubdivisionGranularityExpression",fr),lt("SubdivisionGranularitySetting",Ma);const Hu=-32768,xr=32767;class Hp{constructor(e,i){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Re/e,this._canonical=i}_getKey(e,i){return(e+=32768)<<16|i+32768}_vertexToIndex(e,i){if(e<-32768||i<-32768||e>32767||i>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(e),u=0|Math.round(i),f=this._getKey(o,u);if(this._vertexDictionary.has(f))return this._vertexDictionary.get(f);const p=this._vertexBuffer.length/2;return this._vertexDictionary.set(f,p),this._vertexBuffer.push(o,u),p}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(u,f){const p=[];for(let y=0;y<f.length;y+=3){const x=f[y],T=f[y+1],E=f[y+2],C=u[2*x],D=u[2*x+1];(u[2*T]-C)*(u[2*E+1]-D)-(u[2*T+1]-D)*(u[2*E]-C)>0?(p.push(x),p.push(E),p.push(T)):(p.push(x),p.push(T),p.push(E))}return p})(this._vertexBuffer,e);const i=[],o=e.length;for(let u=0;u<o;u+=3){const f=[e[u+0],e[u+1],e[u+2]],p=[this._vertexBuffer[2*e[u+0]+0],this._vertexBuffer[2*e[u+0]+1],this._vertexBuffer[2*e[u+1]+0],this._vertexBuffer[2*e[u+1]+1],this._vertexBuffer[2*e[u+2]+0],this._vertexBuffer[2*e[u+2]+1]];let y=1/0,x=1/0,T=-1/0,E=-1/0;for(let O=0;O<3;O++){const N=p[2*O],G=p[2*O+1];y=Math.min(y,N),T=Math.max(T,N),x=Math.min(x,G),E=Math.max(E,G)}if(y===T||x===E)continue;const C=Math.floor(y/this._granularityCellSize),D=Math.ceil(T/this._granularityCellSize),I=Math.floor(x/this._granularityCellSize),L=Math.ceil(E/this._granularityCellSize);if(C!==D||I!==L)for(let O=I;O<L;O++){const N=this._scanlineGenerateVertexRingForCellRow(O,p,f);Ko(this._vertexBuffer,N,i)}else i.push(...f)}return i}_scanlineGenerateVertexRingForCellRow(e,i,o){const u=e*this._granularityCellSize,f=u+this._granularityCellSize,p=[];for(let y=0;y<3;y++){const x=i[2*y],T=i[2*y+1],E=i[2*(y+1)%6],C=i[(2*(y+1)+1)%6],D=i[2*(y+2)%6],I=i[(2*(y+2)+1)%6],L=E-x,O=C-T,N=L===0,G=O===0,J=(u-T)/O,q=(f-T)/O,$=Math.min(J,q),te=Math.max(J,q);if(!G&&($>=1||te<=0)||G&&(T<u||T>f)){C>=u&&C<=f&&p.push(o[(y+1)%3]);continue}!G&&$>0&&p.push(this._vertexToIndex(x+L*$,T+O*$));const re=x+L*Math.max($,0),we=x+L*Math.min(te,1);N||this._generateIntraEdgeVertices(p,x,T,E,C,re,we),!G&&te<1&&p.push(this._vertexToIndex(x+L*te,T+O*te)),(G||C>=u&&C<=f)&&p.push(o[(y+1)%3]),!G&&(C<=u||C>=f)&&this._generateInterEdgeVertices(p,x,T,E,C,D,I,we,u,f)}return p}_generateIntraEdgeVertices(e,i,o,u,f,p,y){const x=u-i,T=f-o,E=T===0,C=E?Math.min(i,u):Math.min(p,y),D=E?Math.max(i,u):Math.max(p,y),I=Math.floor(C/this._granularityCellSize)+1,L=Math.ceil(D/this._granularityCellSize)-1;if(E?i<u:p<y)for(let O=I;O<=L;O++){const N=O*this._granularityCellSize;e.push(this._vertexToIndex(N,o+T*(N-i)/x))}else for(let O=L;O>=I;O--){const N=O*this._granularityCellSize;e.push(this._vertexToIndex(N,o+T*(N-i)/x))}}_generateInterEdgeVertices(e,i,o,u,f,p,y,x,T,E){const C=f-o,D=p-u,I=y-f,L=(T-f)/I,O=(E-f)/I,N=Math.min(L,O),G=Math.max(L,O),J=u+D*N;let q=Math.floor(Math.min(J,x)/this._granularityCellSize)+1,$=Math.ceil(Math.max(J,x)/this._granularityCellSize)-1,te=x<J;const re=I===0;if(re&&(y===T||y===E))return;if(re||N>=1||G<=0){const Ne=o-y,ke=p+(i-p)*Math.min((T-y)/Ne,(E-y)/Ne);q=Math.floor(Math.min(ke,x)/this._granularityCellSize)+1,$=Math.ceil(Math.max(ke,x)/this._granularityCellSize)-1,te=x<ke}const we=C>0?E:T;if(te)for(let Ne=q;Ne<=$;Ne++)e.push(this._vertexToIndex(Ne*this._granularityCellSize,we));else for(let Ne=$;Ne>=q;Ne--)e.push(this._vertexToIndex(Ne*this._granularityCellSize,we))}_generateOutline(e){const i=[];for(const o of e){const u=Na(o,this._granularity,!0),f=this._pointArrayToIndices(u),p=[];for(let y=1;y<f.length;y++)p.push(f[y-1]),p.push(f[y]);i.push(p)}return i}_handlePoles(e){let i=!1,o=!1;this._canonical&&(this._canonical.y===0&&(i=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(i||o)&&this._fillPoles(e,i,o)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let i=0;i<e.length;i+=2){const o=e[i+1];o===Hu&&(e[i+1]=-32767),o===xr&&(e[i+1]=32766)}}_generatePoleQuad(e,i,o,u,f,p){u>f!=(p===Hu)?(e.push(i),e.push(o),e.push(this._vertexToIndex(u,p)),e.push(o),e.push(this._vertexToIndex(f,p)),e.push(this._vertexToIndex(u,p))):(e.push(o),e.push(i),e.push(this._vertexToIndex(u,p)),e.push(this._vertexToIndex(f,p)),e.push(o),e.push(this._vertexToIndex(u,p)))}_fillPoles(e,i,o){const u=this._vertexBuffer,f=Re,p=e.length;for(let y=2;y<p;y+=3){const x=e[y-2],T=e[y-1],E=e[y],C=u[2*x],D=u[2*x+1],I=u[2*T],L=u[2*T+1],O=u[2*E],N=u[2*E+1];i&&(D===0&&L===0&&this._generatePoleQuad(e,x,T,C,I,Hu),L===0&&N===0&&this._generatePoleQuad(e,T,E,I,O,Hu),N===0&&D===0&&this._generatePoleQuad(e,E,x,O,C,Hu)),o&&(D===f&&L===f&&this._generatePoleQuad(e,x,T,C,I,xr),L===f&&N===f&&this._generatePoleQuad(e,T,E,I,O,xr),N===f&&D===f&&this._generatePoleQuad(e,E,x,O,C,xr))}}_initializeVertices(e){for(let i=0;i<e.length;i+=2)this._vertexToIndex(e[i],e[i+1])}subdividePolygonInternal(e,i){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:u}=(function(y){const x=[],T=[];for(const E of y)if(E.length!==0){E!==y[0]&&x.push(T.length/2);for(let C=0;C<E.length;C++)T.push(E[C].x),T.push(E[C].y)}return{flattened:T,holeIndices:x}})(e);let f;this._initializeVertices(o);try{const y=(function(T,E,C=2){const D=E&&E.length,I=D?E[0]*C:T.length;let L=Fc(T,0,I,C,!0);const O=[];if(!L||L.next===L.prev)return O;let N,G,J;if(D&&(L=(function(q,$,te,re){const we=[];for(let Ne=0,ke=$.length;Ne<ke;Ne++){const $e=Fc(q,$[Ne]*re,Ne<ke-1?$[Ne+1]*re:q.length,re,!1);$e===$e.next&&($e.steiner=!0),we.push(Hf($e))}we.sort(Gd);for(let Ne=0;Ne<we.length;Ne++)te=Zp(we[Ne],te);return te})(T,E,L,C)),T.length>80*C){N=T[0],G=T[1];let q=N,$=G;for(let te=C;te<I;te+=C){const re=T[te],we=T[te+1];re<N&&(N=re),we<G&&(G=we),re>q&&(q=re),we>$&&($=we)}J=Math.max(q-N,$-G),J=J!==0?32767/J:0}return Nc(L,O,C,N,G,J,0),O})(o,u),x=this._convertIndices(o,y);f=this._subdivideTrianglesScanline(x)}catch(y){console.error(y)}let p=[];return i&&(p=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(f),{verticesFlattened:this._vertexBuffer,indicesTriangles:f,indicesLineList:p}}_convertIndices(e,i){const o=[];for(let u=0;u<i.length;u++)o.push(this._vertexToIndex(e[2*i[u]],e[2*i[u]+1]));return o}_pointArrayToIndices(e){const i=[];for(let o=0;o<e.length;o++){const u=e[o];i.push(this._vertexToIndex(u.x,u.y))}return i}}function bo(n,e,i,o=!0){return new Hp(i,e).subdividePolygonInternal(n,o)}function Na(n,e,i=!1){if(!n||n.length<1)return[];if(n.length<2)return[];const o=n[0],u=n[n.length-1],f=i&&(o.x!==u.x||o.y!==u.y);if(e<2)return f?[...n,n[0]]:[...n];const p=Math.floor(Re/e),y=[];y.push(new ge(n[0].x,n[0].y));const x=n.length,T=f?x:x-1;for(let E=0;E<T;E++){const C=n[E],D=E<x-1?n[E+1]:n[0],I=C.x,L=C.y,O=D.x,N=D.y,G=I!==O,J=L!==N;if(!G&&!J)continue;const q=O-I,$=N-L,te=Math.abs(q),re=Math.abs($);let we=I,Ne=L;for(;;){const $e=q>0?(Math.floor(we/p)+1)*p:(Math.ceil(we/p)-1)*p,at=$>0?(Math.floor(Ne/p)+1)*p:(Math.ceil(Ne/p)-1)*p,Ye=Math.abs(we-$e),Fe=Math.abs(Ne-at),ze=Math.abs(we-O),_t=Math.abs(Ne-N),pt=G?Ye/te:Number.POSITIVE_INFINITY,vt=J?Fe/re:Number.POSITIVE_INFINITY;if((ze<=Ye||!G)&&(_t<=Fe||!J))break;if(pt<vt&&G||!J){we=$e,Ne+=$*pt;const ct=new ge(we,Math.round(Ne));y[y.length-1].x===ct.x&&y[y.length-1].y===ct.y||y.push(ct)}else{we+=q*vt,Ne=at;const ct=new ge(Math.round(we),Ne);y[y.length-1].x===ct.x&&y[y.length-1].y===ct.y||y.push(ct)}}const ke=new ge(O,N);y[y.length-1].x===ke.x&&y[y.length-1].y===ke.y||y.push(ke)}return y}function Ko(n,e,i){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,u=n[2*e[0]];for(let x=1;x<e.length;x++){const T=n[2*e[x]];T<u&&(u=T,o=x)}const f=e.length;let p=o,y=(p+1)%f;for(;;){const x=p-1>=0?p-1:f-1,T=(y+1)%f,E=n[2*e[x]],C=n[2*e[T]],D=n[2*e[p]],I=n[2*e[p]+1],L=n[2*e[y]+1];let O=!1;if(E<C)O=!0;else if(E>C)O=!1;else{const N=L-I,G=-(n[2*e[y]]-D),J=I<L?1:-1;((E-D)*N+(n[2*e[x]+1]-I)*G)*J>((C-D)*N+(n[2*e[T]+1]-I)*G)*J&&(O=!0)}if(O){const N=e[x],G=e[p],J=e[y];N!==G&&N!==J&&G!==J&&i.push(J,G,N),p--,p<0&&(p=f-1)}else{const N=e[T],G=e[p],J=e[y];N!==G&&N!==J&&G!==J&&i.push(J,G,N),y++,y>=f&&(y=0)}if(x===T)break}}function qd(n,e,i,o,u,f,p,y,x){const T=u.length/2,E=p&&y&&x;if(T<He.MAX_VERTEX_ARRAY_LENGTH){const C=e.prepareSegment(T,i,o),D=C.vertexLength;for(let O=0;O<f.length;O+=3)o.emplaceBack(D+f[O],D+f[O+1],D+f[O+2]);let I,L;C.vertexLength+=T,C.primitiveLength+=f.length/3,E&&(L=p.prepareSegment(T,i,y),I=L.vertexLength,L.vertexLength+=T);for(let O=0;O<u.length;O+=2)n(u[O],u[O+1]);if(E)for(let O=0;O<x.length;O++){const N=x[O];for(let G=1;G<N.length;G+=2)y.emplaceBack(I+N[G-1],I+N[G]);L.primitiveLength+=N.length/2}}else(function(C,D,I,L,O,N){const G=[];for(let re=0;re<L.length/2;re++)G.push(-1);const J={count:0};let q=0,$=C.getOrCreateLatestSegment(D,I),te=$.vertexLength;for(let re=2;re<O.length;re+=3){const we=O[re-2],Ne=O[re-1],ke=O[re];let $e=G[we]<q,at=G[Ne]<q,Ye=G[ke]<q;$.vertexLength+(($e?1:0)+(at?1:0)+(Ye?1:0))>He.MAX_VERTEX_ARRAY_LENGTH&&($=C.createNewSegment(D,I),q=J.count,$e=!0,at=!0,Ye=!0,te=0);const Fe=$u(G,L,N,J,we,$e,$),ze=$u(G,L,N,J,Ne,at,$),_t=$u(G,L,N,J,ke,Ye,$);I.emplaceBack(te+Fe-q,te+ze-q,te+_t-q),$.primitiveLength++}})(e,i,o,u,f,n),E&&(function(C,D,I,L,O,N){const G=[];for(let re=0;re<L.length/2;re++)G.push(-1);const J={count:0};let q=0,$=C.getOrCreateLatestSegment(D,I),te=$.vertexLength;for(let re=0;re<O.length;re++){const we=O[re];for(let Ne=1;Ne<O[re].length;Ne+=2){const ke=we[Ne-1],$e=we[Ne];let at=G[ke]<q,Ye=G[$e]<q;$.vertexLength+((at?1:0)+(Ye?1:0))>He.MAX_VERTEX_ARRAY_LENGTH&&($=C.createNewSegment(D,I),q=J.count,at=!0,Ye=!0,te=0);const Fe=$u(G,L,N,J,ke,at,$),ze=$u(G,L,N,J,$e,Ye,$);I.emplaceBack(te+Fe-q,te+ze-q),$.primitiveLength++}}})(p,i,y,u,x,n),e.forceNewSegmentOnNextPrepare(),p?.forceNewSegmentOnNextPrepare()}function $u(n,e,i,o,u,f,p){if(f){const y=o.count;return i(e[2*u],e[2*u+1]),n[u]=o.count,o.count++,p.vertexLength++,y}return n[u]}class ja{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new U,this.indexArray=new Me,this.indexArray2=new be,this.programConfigurations=new Qi(e.layers,e.zoom),this.segments=new He,this.segments2=new He,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Nh("fill",this.layers,i);const u=this.layers[0].layout.get("fill-sort-key"),f=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,D=yo(y,C);if(!this.layers[0]._featureFilter.filter(new si(this.zoom),D,o))continue;const I=f?u.evaluate(D,{},o,i.availableImages):void 0,L={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?D.geometry:ca(y),patterns:{},sortKey:I};p.push(L)}f&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:E}=y;if(this.hasDependencies){const C=Ud("fill",this.layers,y,{zoom:this.zoom},i);this.patternFeatures.push(C)}else this.addFeature(y,x,T,o,{},i.subdivisionGranularity);i.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}addFeatures(e,i,o){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,o,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ql),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,u,f,p){for(const y of vu(i,500)){const x=bo(y,u,p.fill.getGranularityForZoomLevel(u.z)),T=this.layoutVertexArray;qd(((E,C)=>{T.emplaceBack(E,C)}),this.segments,this.layoutVertexArray,this.indexArray,x.verticesFlattened,x.indicesTriangles,this.segments2,this.indexArray2,x.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,canonical:u})}}let Wf,Xu;lt("FillBucket",ja,{omit:["layers","patternFeatures"]});var Vh={get paint(){return Xu=Xu||new Sn({"fill-antialias":new Tt(xe.paint_fill["fill-antialias"]),"fill-opacity":new Pt(xe.paint_fill["fill-opacity"]),"fill-color":new Pt(xe.paint_fill["fill-color"]),"fill-outline-color":new Pt(xe.paint_fill["fill-outline-color"]),"fill-translate":new Tt(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new go(xe.paint_fill["fill-pattern"])})},get layout(){return Wf=Wf||new Sn({"fill-sort-key":new Pt(xe.layout_fill["fill-sort-key"])})}};class Uh extends Rr{constructor(e,i){super(e,Vh,i)}recalculate(e,i){super.recalculate(e,i);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new ja(e)}queryRadius(){return Gl(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:i,transform:o,pixelsToTileUnits:u}){return Bc(Rh(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,u),i)}isTileClipped(){return!0}}const Uc=zt([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),$p=zt([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Xp}=Uc;class Jo{constructor(e,i,o,u,f){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=f,e.readFields(Yp,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,o=[];let u,f=1,p=0,y=0,x=0;for(;e.pos<i;){if(p<=0){const T=e.readVarint();f=7&T,p=T>>3}if(p--,f===1||f===2)y+=e.readSVarint(),x+=e.readSVarint(),f===1&&(u&&o.push(u),u=[]),u&&u.push(new ge(y,x));else{if(f!==7)throw new Error(`unknown command ${f}`);u&&u.push(u[0].clone())}}return u&&o.push(u),o}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let o=1,u=0,f=0,p=0,y=1/0,x=-1/0,T=1/0,E=-1/0;for(;e.pos<i;){if(u<=0){const C=e.readVarint();o=7&C,u=C>>3}if(u--,o===1||o===2)f+=e.readSVarint(),p+=e.readSVarint(),f<y&&(y=f),f>x&&(x=f),p<T&&(T=p),p>E&&(E=p);else if(o!==7)throw new Error(`unknown command ${o}`)}return[y,T,x,E]}toGeoJSON(e,i,o){const u=this.extent*Math.pow(2,o),f=this.extent*e,p=this.extent*i,y=this.loadGeometry();function x(D){return[360*(D.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+p)/u)*Math.PI))-90]}function T(D){return D.map(x)}let E;if(this.type===1){const D=[];for(const L of y)D.push(L[0]);const I=T(D);E=D.length===1?{type:"Point",coordinates:I[0]}:{type:"MultiPoint",coordinates:I}}else if(this.type===2){const D=y.map(T);E=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=Gh(y),I=[];for(const L of D)I.push(L.map(T));E=I.length===1?{type:"Polygon",coordinates:I[0]}:{type:"MultiPolygon",coordinates:I}}}const C={type:"Feature",geometry:E,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function Yp(n,e,i){n===1?e.id=i.readVarint():n===2?(function(o,u){const f=o.readVarint()+o.pos;for(;o.pos<f;){const p=u._keys[o.readVarint()],y=u._values[o.readVarint()];u.properties[p]=y}})(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function Gh(n){const e=n.length;if(e<=1)return[n];const i=[];let o,u;for(let f=0;f<e;f++){const p=Wp(n[f]);p!==0&&(u===void 0&&(u=p<0),u===p<0?(o&&i.push(o),o=[n[f]]):o&&o.push(n[f]))}return o&&i.push(o),i}function Wp(n){let e=0;for(let i,o,u=0,f=n.length,p=f-1;u<f;p=u++)i=n[u],o=n[p],e+=(o.x-i.x)*(i.y+o.y);return e}Jo.types=["Unknown","Point","LineString","Polygon"];class Fm{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Nm,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Jo(this._pbf,i,this.extent,this._keys,this._values)}}function Nm(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push((function(o){let u=null;const f=o.readVarint()+o.pos;for(;o.pos<f;){const p=o.readVarint()>>3;u=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(i))}class zi{constructor(e,i){this.layers=e.readFields(Ji,{},i)}}function Ji(n,e,i){if(n===3){const o=new Fm(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}const oi=Math.pow(2,13);function ai(n,e,i,o,u,f,p,y){n.emplaceBack(e,i,2*Math.floor(o*oi)+p,u*oi*2,f*oi*2,Math.round(y))}class Ni{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new X,this.centroidVertexArray=new P,this.indexArray=new Me,this.programConfigurations=new Qi(e.layers,e.zoom),this.segments=new He,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.features=[],this.hasDependencies=Nh("fill-extrusion",this.layers,i);for(const{feature:u,id:f,index:p,sourceLayerIndex:y}of e){const x=this.layers[0]._featureFilter.needGeometry,T=yo(u,x);if(!this.layers[0]._featureFilter.filter(new si(this.zoom),T,o))continue;const E={id:f,sourceLayerIndex:y,index:p,geometry:x?T.geometry:ca(u),properties:u.properties,type:u.type,patterns:{}};this.hasDependencies?this.features.push(Ud("fill-extrusion",this.layers,E,{zoom:this.zoom},i)):this.addFeature(E,E.geometry,p,o,{},i.subdivisionGranularity),i.featureIndex.insert(u,E.geometry,p,y,this.index,!0)}}addFeatures(e,i,o){for(const u of this.features){const{geometry:f}=u;this.addFeature(u,f,u.index,i,o,e.subdivisionGranularity)}}update(e,i,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xp),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,$p.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,o,u,f,p){for(const y of vu(i,500)){const x={x:0,y:0,sampleCount:0},T=this.layoutVertexArray.length;this.processPolygon(x,u,e,y,p);const E=this.layoutVertexArray.length-T,C=Math.floor(x.x/x.sampleCount),D=Math.floor(x.y/x.sampleCount);for(let I=0;I<E;I++)this.centroidVertexArray.emplaceBack(C,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,canonical:u})}processPolygon(e,i,o,u,f){if(u.length<1||Yu(u[0]))return;for(const C of u)C.length!==0&&Va(e,C);const p={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=f.fill.getGranularityForZoomLevel(i.z),x=Jo.types[o.type]==="Polygon";for(const C of u){if(C.length===0||Yu(C))continue;const D=Na(C,y,x);this._generateSideFaces(D,p)}if(!x)return;const T=bo(u,i,y,!1),E=this.layoutVertexArray;qd(((C,D)=>{ai(E,C,D,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles)}_generateSideFaces(e,i){let o=0;for(let u=1;u<e.length;u++){const f=e[u],p=e[u-1];if(Zl(f,p))continue;i.segment.vertexLength+4>He.MAX_VERTEX_ARRAY_LENGTH&&(i.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=f.sub(p)._perp()._unit(),x=p.dist(f);o+x>32768&&(o=0),ai(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,0,o),ai(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,1,o),o+=x,ai(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,0,o),ai(this.layoutVertexArray,p.x,p.y,y.x,y.y,0,1,o);const T=i.segment.vertexLength;this.indexArray.emplaceBack(T,T+2,T+1),this.indexArray.emplaceBack(T+1,T+2,T+3),i.segment.vertexLength+=4,i.segment.primitiveLength+=2}}}function Va(n,e){for(let i=0;i<e.length;i++){const o=e[i];i===e.length-1&&e[0].x===o.x&&e[0].y===o.y||(n.x+=o.x,n.y+=o.y,n.sampleCount++)}}function Zl(n,e){return n.x===e.x&&(n.x<0||n.x>Re)||n.y===e.y&&(n.y<0||n.y>Re)}function Yu(n){return n.every((e=>e.x<0))||n.every((e=>e.x>Re))||n.every((e=>e.y<0))||n.every((e=>e.y>Re))}let Zd;lt("FillExtrusionBucket",Ni,{omit:["layers","features"]});var el={get paint(){return Zd=Zd||new Sn({"fill-extrusion-opacity":new Tt(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pt(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new go(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Pt(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pt(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Tt(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Gn extends Rr{constructor(e,i){super(e,el,i)}createBucket(e){return new Ni(e)}queryRadius(){return Gl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p,pixelPosMatrix:y}){const x=Rh(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-f.bearingInRadians,p),T=this.paint.get("fill-extrusion-height").evaluate(i,o),E=this.paint.get("fill-extrusion-base").evaluate(i,o),C=(function(I,L){const O=[];for(const N of I){const G=[N.x,N.y,0,1];Kn(G,G,L),O.push(new ge(G[0]/G[3],G[1]/G[3]))}return O})(x,y),D=(function(I,L,O,N){const G=[],J=[],q=N[8]*L,$=N[9]*L,te=N[10]*L,re=N[11]*L,we=N[8]*O,Ne=N[9]*O,ke=N[10]*O,$e=N[11]*O;for(const at of I){const Ye=[],Fe=[];for(const ze of at){const _t=ze.x,pt=ze.y,vt=N[0]*_t+N[4]*pt+N[12],ct=N[1]*_t+N[5]*pt+N[13],Ct=N[2]*_t+N[6]*pt+N[14],gi=N[3]*_t+N[7]*pt+N[15],ni=Ct+te,xn=gi+re,Yr=vt+we,ur=ct+Ne,bn=Ct+ke,un=gi+$e,Ri=new ge((vt+q)/xn,(ct+$)/xn);Ri.z=ni/xn,Ye.push(Ri);const Rn=new ge(Yr/un,ur/un);Rn.z=bn/un,Fe.push(Rn)}G.push(Ye),J.push(Fe)}return[G,J]})(u,E,T,y);return(function(I,L,O){let N=1/0;Bc(O,L)&&(N=Hl(O,L[0]));for(let G=0;G<L.length;G++){const J=L[G],q=I[G];for(let $=0;$<J.length-1;$++){const te=J[$],re=[te,J[$+1],q[$+1],q[$],te];Lc(O,re)&&(N=Math.min(N,Hl(O,re)))}}return N!==1/0&&N})(D[0],D[1],C)}}function fs(n,e){return n.x*e.x+n.y*e.y}function Hl(n,e){if(n.length===1){let i=0;const o=e[i++];let u;for(;!u||o.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],p=n[0],y=u.sub(o),x=f.sub(o),T=p.sub(o),E=fs(y,y),C=fs(y,x),D=fs(x,x),I=fs(T,y),L=fs(T,x),O=E*D-C*C,N=(D*I-C*L)/O,G=(E*L-C*I)/O,J=o.z*(1-N-G)+u.z*N+f.z*G;if(isFinite(J))return J}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}const Qf=zt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Ua}=Qf,Gc=zt([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:qh}=Gc,Ea=Math.cos(Math.PI/180*37.5),Hd=Math.pow(2,14)/.5;class qc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new W,this.layoutVertexArray2=new Y,this.indexArray=new Me,this.programConfigurations=new Qi(e.layers,e.zoom),this.segments=new He,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id))}populate(e,i,o){this.hasDependencies=Nh("line",this.layers,i)||this.hasLineDasharray(this.layers);const u=this.layers[0].layout.get("line-sort-key"),f=!u.isConstant(),p=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,D=yo(y,C);if(!this.layers[0]._featureFilter.filter(new si(this.zoom),D,o))continue;const I=f?u.evaluate(D,{},o):void 0,L={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?D.geometry:ca(y),patterns:{},dashes:{},sortKey:I};p.push(L)}f&&p.sort(((y,x)=>y.sortKey-x.sortKey));for(const y of p){const{geometry:x,index:T,sourceLayerIndex:E}=y;this.hasDependencies?(Nh("line",this.layers,i)?Ud("line",this.layers,y,{zoom:this.zoom},i):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,y,this.zoom,i),this.patternFeatures.push(y)):this.addFeature(y,x,T,o,{},{},i.subdivisionGranularity),i.featureIndex.insert(e[T].feature,x,T,E,this.index)}}update(e,i,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,{imagePositions:o,dashPositions:u})}addFeatures(e,i,o,u){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,i,o,u,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,qh)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ua),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,u,f,p,y){const x=this.layers[0].layout,T=x.get("line-join").evaluate(e,{}),E=x.get("line-cap"),C=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const I of i)this.addLine(I,e,T,E,C,D,u,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{imagePositions:f,dashPositions:p,canonical:u})}addLine(e,i,o,u,f,p,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=Na(e,y?x.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let q=0;q<e.length-1;q++)this.totalDistance+=e[q].dist(e[q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=Jo.types[i.type]==="Polygon";let E=e.length;for(;E>=2&&e[E-1].equals(e[E-2]);)E--;let C=0;for(;C<E-1&&e[C].equals(e[C+1]);)C++;if(E<(T?3:2))return;o==="bevel"&&(f=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let L,O,N,G,J;this.e1=this.e2=-1,T&&(L=e[E-2],J=e[C].sub(L)._unit()._perp());for(let q=C;q<E;q++){if(N=q===E-1?T?e[C+1]:void 0:e[q+1],N&&e[q].equals(N))continue;J&&(G=J),L&&(O=L),L=e[q],J=N?N.sub(L)._unit()._perp():G,G=G||J;let $=G.add(J);$.x===0&&$.y===0||$._unit();const te=G.x*J.x+G.y*J.y,re=$.x*J.x+$.y*J.y,we=re!==0?1/re:1/0,Ne=2*Math.sqrt(2-2*re),ke=re<Ea&&O&&N,$e=G.x*J.y-G.y*J.x>0;if(ke&&q>C){const Fe=L.dist(O);if(Fe>2*D){const ze=L.sub(L.sub(O)._mult(D/Fe)._round());this.updateDistance(O,ze),this.addCurrentVertex(ze,G,0,0,I),O=ze}}const at=O&&N;let Ye=at?o:T?"butt":u;if(at&&Ye==="round"&&(we<p?Ye="miter":we<=2&&(Ye="fakeround")),Ye==="miter"&&we>f&&(Ye="bevel"),Ye==="bevel"&&(we>2&&(Ye="flipbevel"),we<f&&(Ye="miter")),O&&this.updateDistance(O,L),Ye==="miter")$._mult(we),this.addCurrentVertex(L,$,0,0,I);else if(Ye==="flipbevel"){if(we>100)$=J.mult(-1);else{const Fe=we*G.add(J).mag()/G.sub(J).mag();$._perp()._mult(Fe*($e?-1:1))}this.addCurrentVertex(L,$,0,0,I),this.addCurrentVertex(L,$.mult(-1),0,0,I)}else if(Ye==="bevel"||Ye==="fakeround"){const Fe=-Math.sqrt(we*we-1),ze=$e?Fe:0,_t=$e?0:Fe;if(O&&this.addCurrentVertex(L,G,ze,_t,I),Ye==="fakeround"){const pt=Math.round(180*Ne/Math.PI/20);for(let vt=1;vt<pt;vt++){let ct=vt/pt;if(ct!==.5){const gi=ct-.5;ct+=ct*gi*(ct-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*gi*gi+(.848013+te*(.215638*te-1.06021)))}const Ct=J.sub(G)._mult(ct)._add(G)._unit()._mult($e?-1:1);this.addHalfVertex(L,Ct.x,Ct.y,!1,$e,0,I)}}N&&this.addCurrentVertex(L,J,-ze,-_t,I)}else if(Ye==="butt")this.addCurrentVertex(L,$,0,0,I);else if(Ye==="square"){const Fe=O?1:-1;this.addCurrentVertex(L,$,Fe,Fe,I)}else Ye==="round"&&(O&&(this.addCurrentVertex(L,G,0,0,I),this.addCurrentVertex(L,G,1,1,I,!0)),N&&(this.addCurrentVertex(L,J,-1,-1,I,!0),this.addCurrentVertex(L,J,0,0,I)));if(ke&&q<E-1){const Fe=L.dist(N);if(Fe>2*D){const ze=L.add(N.sub(L)._mult(D/Fe)._round());this.updateDistance(L,ze),this.addCurrentVertex(ze,J,0,0,I),L=ze}}}}addCurrentVertex(e,i,o,u,f,p=!1){const y=i.y*u-i.x,x=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,p,!1,o,f),this.addHalfVertex(e,y,x,p,!0,-u,f),this.distance>Hd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,i,o,u,f,p))}addHalfVertex({x:e,y:i},o,u,f,p,y,x){const T=.5*(this.lineClips?this.scaledDistance*(Hd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,E,this.e2),x.primitiveLength++),p?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}hasLineDasharray(e){for(const i of e){const o=i.paint.get("line-dasharray");if(o&&!o.isConstant())return!0}return!1}addLineDashDependencies(e,i,o,u){for(const f of e){const p=f.paint.get("line-dasharray");if(!p||p.value.kind==="constant")continue;const y=f.layout.get("line-cap")==="round",x={dasharray:p.value.evaluate({zoom:o-1},i,{}),round:y},T={dasharray:p.value.evaluate({zoom:o},i,{}),round:y},E={dasharray:p.value.evaluate({zoom:o+1},i,{}),round:y},C=`${x.dasharray.join(",")},${x.round}`,D=`${T.dasharray.join(",")},${T.round}`,I=`${E.dasharray.join(",")},${E.round}`;u.dashDependencies[C]=x,u.dashDependencies[D]=T,u.dashDependencies[I]=E,i.dashes[f.id]={min:C,mid:D,max:I}}}}let Kf,Zh;lt("LineBucket",qc,{omit:["layers","patternFeatures"]});var Hh={get paint(){return Zh=Zh||new Sn({"line-opacity":new Pt(xe.paint_line["line-opacity"]),"line-color":new Pt(xe.paint_line["line-color"]),"line-translate":new Tt(xe.paint_line["line-translate"]),"line-translate-anchor":new Tt(xe.paint_line["line-translate-anchor"]),"line-width":new Pt(xe.paint_line["line-width"]),"line-gap-width":new Pt(xe.paint_line["line-gap-width"]),"line-offset":new Pt(xe.paint_line["line-offset"]),"line-blur":new Pt(xe.paint_line["line-blur"]),"line-dasharray":new go(xe.paint_line["line-dasharray"]),"line-pattern":new go(xe.paint_line["line-pattern"]),"line-gradient":new rr(xe.paint_line["line-gradient"])})},get layout(){return Kf=Kf||new Sn({"line-cap":new Tt(xe.layout_line["line-cap"]),"line-join":new Pt(xe.layout_line["line-join"]),"line-miter-limit":new Tt(xe.layout_line["line-miter-limit"]),"line-round-limit":new Tt(xe.layout_line["line-round-limit"]),"line-sort-key":new Pt(xe.layout_line["line-sort-key"])})}};class $l extends Pt{possiblyEvaluate(e,i){return i=new si(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,u){return i=ii({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,u)}}let qn;class Xl extends Rr{constructor(e,i){super(e,Hh,i),this.gradientVersion=0,qn||(qn=new $l(Hh.paint.properties["line-width"].specification),qn.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const i=this.gradientExpression();this.stepInterpolant=!!(function(o){return o._styleExpression!==void 0})(i)&&i._styleExpression.expression instanceof Ks,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,i){super.recalculate(e,i),this.paint._values["line-floorwidth"]=qn.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new qc(e)}queryRadius(e){const i=e,o=Wu(qu("line-width",this,i),qu("line-gap-width",this,i)),u=qu("line-offset",this,i);return o/2+Math.abs(u)+Gl(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:i,featureState:o,geometry:u,transform:f,pixelsToTileUnits:p}){const y=Rh(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-f.bearingInRadians,p),x=p/2*Wu(this.paint.get("line-width").evaluate(i,o),this.paint.get("line-gap-width").evaluate(i,o)),T=this.paint.get("line-offset").evaluate(i,o);return T&&(u=(function(E,C){const D=[];for(let I=0;I<E.length;I++){const L=Bd(E[I]),O=[];for(let N=0;N<L.length;N++){const G=L[N],J=L[N-1],q=L[N+1],$=N===0?new ge(0,0):G.sub(J)._unit()._perp(),te=N===L.length-1?new ge(0,0):q.sub(G)._unit()._perp(),re=$._add(te)._unit(),we=re.x*te.x+re.y*te.y;we!==0&&re._mult(1/we),O.push(re._mult(C)._add(G))}D.push(O)}return D})(u,T*p)),(function(E,C,D){for(let I=0;I<C.length;I++){const L=C[I];if(E.length>=3){for(let O=0;O<L.length;O++)if(Gu(E,L[O]))return!0}if(kc(E,L,D))return!0}return!1})(y,u,x)}isTileClipped(){return!0}}function Wu(n,e){return e>0?e+2*n:n}const tl=zt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Jf=zt([{name:"a_projected_pos",components:3,type:"Float32"}],4);zt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ep=zt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);zt([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const tp=zt([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$h=zt([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ip(n,e,i){return n.sections.forEach((o=>{o.text=(function(u,f,p){const y=f.layout.get("text-transform").evaluate(p,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),Ba.applyArabicShaping&&(u=Ba.applyArabicShaping(u)),u})(o.text,e,i)})),n}zt([{name:"triangle",components:3,type:"Uint16"}]),zt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),zt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),zt([{type:"Float32",name:"offsetX"}]),zt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),zt([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var Di=24;const Zc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Aa={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Qp={40:!0};function np(n,e,i,o,u,f){if("fontStack"in e){const p=i[e.fontStack],y=p&&p[n];return y?y.metrics.advance*e.scale+u:0}{const p=o[e.imageName];return p?p.displaySize[0]*e.scale*Di/f+u:0}}function Kp(n,e,i,o){const u=Math.pow(n-e,2);return o?n<e?u/2:2*u:u+Math.abs(i)*i}function Yl(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Xh(n,e,i,o,u,f){let p=null,y=Kp(e,i,u,f);for(const x of o){const T=Kp(e-x.x,i,u,f)+x.badness;T<=y&&(p=x,y=T)}return{index:n,x:e,priorBreak:p,badness:y}}function $d(n){return n?$d(n.priorBreak).concat(n.index):[]}class Fs{constructor(e="",i=[],o=[]){this.text=e,this.sections=i,this.sectionIndex=o,this.imageSectionID=null}static fromFeature(e,i){const o=new Fs;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?o.addImageSection(f):o.addTextSection(f,i)}return o}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let i="",o={premature:!0,value:void 0};const u=e[Symbol.iterator]();let f=u.next();const p=e[Symbol.iterator]();p.next();let y=p.next();for(;!f.done;)i+=!y.done&&Fu(y.value.codePointAt(0))&&!Zc[y.value]||!o.premature&&Fu(o.value.codePointAt(0))&&!Zc[o.value]||!Zc[f.value]?f.value:Zc[f.value],o={value:f.value,premature:!1},f=u.next(),y=p.next();return i})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),i=e?e[0].length:0,o=this.text.match(/\S\s*$/),u=o?o[0].length-1:0;this.text=this.text.substring(i,this.text.length-u),this.sectionIndex=this.sectionIndex.slice(i,this.sectionIndex.length-u)}substring(e,i){const o=[...this.text].slice(e,i).join(""),u=this.sectionIndex.slice(e,i);return new Fs(o,this.sections,u)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}getMaxImageSize(e){let i=0,o=0;for(let u=0;u<this.length();u++){const f=this.getSection(u);if("imageName"in f){const p=e[f.imageName];if(!p)continue;const y=p.displaySize;i=Math.max(i,y[0]),o=Math.max(o,y[1])}}return{maxImageWidth:i,maxImageHeight:o}}addTextSection(e,i){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||i});const o=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>o)))}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void tn("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:i}),this.sectionIndex.push(this.sections.length-1)):tn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,i,o,u,f){const p=[],y=this.determineAverageLineWidth(e,i,o,u,f),x=this.hasZeroWidthSpaces();let T=0,E=0;const C=this.text[Symbol.iterator]();let D=C.next();const I=this.text[Symbol.iterator]();I.next();let L=I.next();const O=this.text[Symbol.iterator]();O.next(),O.next();let N=O.next();for(;!D.done;){const G=this.getSection(E),J=D.value.codePointAt(0);if(Eh(J)||(T+=np(J,G,o,u,e,f)),!L.done){const q=Uo(J),$=L.value.codePointAt(0);(Aa[J]||q||"imageName"in G||!N.done&&Qp[$])&&p.push(Xh(E+1,T,y,p,Yl(J,$,q&&x),!1))}E++,D=C.next(),L=I.next(),N=O.next()}return $d(Xh(this.length(),T,y,p,0,!0))}determineAverageLineWidth(e,i,o,u,f){let p=0,y=0;for(const x of this.text){const T=this.getSection(y);p+=np(x.codePointAt(0),T,o,u,e,f),y++}return p/Math.max(1,Math.ceil(p/i))}}const Xd=4294967296,rp=1/Xd,ap=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Yh{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,i,o=this.length){for(;this.pos<o;){const u=this.readVarint(),f=u>>3,p=this.pos;this.type=7&u,e(f,i,this),this.pos===p&&this.skip(u)}return i}readMessage(e,i){return this.readFields(e,i,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Xd;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Xd;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const i=this.buf;let o,u;return u=i[this.pos++],o=127&u,u<128?o:(u=i[this.pos++],o|=(127&u)<<7,u<128?o:(u=i[this.pos++],o|=(127&u)<<14,u<128?o:(u=i[this.pos++],o|=(127&u)<<21,u<128?o:(u=i[this.pos],o|=(15&u)<<28,(function(f,p,y){const x=y.buf;let T,E;if(E=x[y.pos++],T=(112&E)>>4,E<128||(E=x[y.pos++],T|=(127&E)<<3,E<128)||(E=x[y.pos++],T|=(127&E)<<10,E<128)||(E=x[y.pos++],T|=(127&E)<<17,E<128)||(E=x[y.pos++],T|=(127&E)<<24,E<128)||(E=x[y.pos++],T|=(1&E)<<31,E<128))return il(f,T,p);throw new Error("Expected varint not more than 10 bytes")})(o,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,i=this.pos;return this.pos=e,e-i>=12&&ap?ap.decode(this.buf.subarray(i,e)):(function(o,u,f){let p="",y=u;for(;y<f;){const x=o[y];let T,E,C,D=null,I=x>239?4:x>223?3:x>191?2:1;if(y+I>f)break;I===1?x<128&&(D=x):I===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):I===3?(T=o[y+1],E=o[y+2],(192&T)==128&&(192&E)==128&&(D=(15&x)<<12|(63&T)<<6|63&E,(D<=2047||D>=55296&&D<=57343)&&(D=null))):I===4&&(T=o[y+1],E=o[y+2],C=o[y+3],(192&T)==128&&(192&E)==128&&(192&C)==128&&(D=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&C,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,I=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=I}return p})(this.buf,i,e)}readBytes(){const e=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,e);return this.pos=e,i}readPackedVarint(e=[],i){const o=this.readPackedEnd();for(;this.pos<o;)e.push(this.readVarint(i));return e}readPackedSVarint(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const i=this.readPackedEnd();for(;this.pos<i;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const i=7&e;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(e,i){this.writeVarint(e<<3|i)}realloc(e){let i=this.length||16;for(;i<this.pos+e;)i*=2;if(i!==this.length){const o=new Uint8Array(i);o.set(this.buf),this.buf=o,this.dataView=new DataView(o.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*rp),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*rp),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(i,o){let u,f;if(i>=0?(u=i%4294967296|0,f=i/4294967296|0):(u=~(-i%4294967296),f=~(-i/4294967296),4294967295^u?u=u+1|0:(u=0,f=f+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),(function(p,y,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)})(u,0,o),(function(p,y){const x=(7&p)<<4;y.buf[y.pos++]|=x|((p>>>=3)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p|((p>>>=7)?128:0),p&&(y.buf[y.pos++]=127&p)))))})(f,o)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const i=this.pos;this.pos=(function(u,f,p){for(let y,x,T=0;T<f.length;T++){if(y=f.charCodeAt(T),y>55295&&y<57344){if(!x){y>56319||T+1===f.length?(u[p++]=239,u[p++]=191,u[p++]=189):x=y;continue}if(y<56320){u[p++]=239,u[p++]=191,u[p++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(u[p++]=239,u[p++]=191,u[p++]=189,x=null);y<128?u[p++]=y:(y<2048?u[p++]=y>>6|192:(y<65536?u[p++]=y>>12|224:(u[p++]=y>>18|240,u[p++]=y>>12&63|128),u[p++]=y>>6&63|128),u[p++]=63&y|128)}return p})(this.buf,e,this.pos);const o=this.pos-i;o>=128&&Yd(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const i=e.length;this.writeVarint(i),this.realloc(i);for(let o=0;o<i;o++)this.buf[this.pos++]=e[o]}writeRawMessage(e,i){this.pos++;const o=this.pos;e(i,this);const u=this.pos-o;u>=128&&Yd(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u}writeMessage(e,i,o){this.writeTag(e,2),this.writeRawMessage(i,o)}writePackedVarint(e,i){i.length&&this.writeMessage(e,jm,i)}writePackedSVarint(e,i){i.length&&this.writeMessage(e,Vm,i)}writePackedBoolean(e,i){i.length&&this.writeMessage(e,em,i)}writePackedFloat(e,i){i.length&&this.writeMessage(e,Um,i)}writePackedDouble(e,i){i.length&&this.writeMessage(e,Jp,i)}writePackedFixed32(e,i){i.length&&this.writeMessage(e,Hc,i)}writePackedSFixed32(e,i){i.length&&this.writeMessage(e,Wd,i)}writePackedFixed64(e,i){i.length&&this.writeMessage(e,tm,i)}writePackedSFixed64(e,i){i.length&&this.writeMessage(e,im,i)}writeBytesField(e,i){this.writeTag(e,2),this.writeBytes(i)}writeFixed32Field(e,i){this.writeTag(e,5),this.writeFixed32(i)}writeSFixed32Field(e,i){this.writeTag(e,5),this.writeSFixed32(i)}writeFixed64Field(e,i){this.writeTag(e,1),this.writeFixed64(i)}writeSFixed64Field(e,i){this.writeTag(e,1),this.writeSFixed64(i)}writeVarintField(e,i){this.writeTag(e,0),this.writeVarint(i)}writeSVarintField(e,i){this.writeTag(e,0),this.writeSVarint(i)}writeStringField(e,i){this.writeTag(e,2),this.writeString(i)}writeFloatField(e,i){this.writeTag(e,5),this.writeFloat(i)}writeDoubleField(e,i){this.writeTag(e,1),this.writeDouble(i)}writeBooleanField(e,i){this.writeVarintField(e,+i)}}function il(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function Yd(n,e,i){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(let u=i.pos-1;u>=n;u--)i.buf[u+o]=i.buf[u]}function jm(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function Vm(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function Um(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function Jp(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function em(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function Hc(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function Wd(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function tm(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function im(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}function nm(n,e,i){n===1&&i.readMessage(rm,e)}function rm(n,e,i){if(n===3){const{id:o,bitmap:u,width:f,height:p,left:y,top:x,advance:T}=i.readMessage(am,{});e.push({id:o,bitmap:new Oc({width:f+6,height:p+6},u),metrics:{width:f,height:p,left:y,top:x,advance:T}})}}function am(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}function sp(n){let e=0,i=0;for(const p of n)e+=p.w*p.h,i=Math.max(i,p.w);n.sort(((p,y)=>y.h-p.h));const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const p of n)for(let y=o.length-1;y>=0;y--){const x=o[y];if(!(p.w>x.w||p.h>x.h)){if(p.x=x.x,p.y=x.y,f=Math.max(f,p.y+p.h),u=Math.max(u,p.x+p.w),p.w===x.w&&p.h===x.h){const T=o.pop();T&&y<o.length&&(o[y]=T)}else p.h===x.h?(x.x+=p.w,x.w-=p.w):p.w===x.w?(x.y+=p.h,x.h-=p.h):(o.push({x:x.x+p.w,y:x.y,w:x.w-p.w,h:p.h}),x.y+=p.h,x.h-=p.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}class $c{constructor(e,{pixelRatio:i,version:o,stretchX:u,stretchY:f,content:p,textFitWidth:y,textFitHeight:x}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=f,this.content=p,this.version=o,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class op{constructor(e,i){const o={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,o,f),this.addImages(i,u,f);const{w:p,h:y}=sp(f),x=new Pn({width:p||1,height:y||1});for(const T in e){const E=e[T],C=o[T].paddedRect;Pn.copy(E.data,x,{x:0,y:0},{x:C.x+1,y:C.y+1},E.data)}for(const T in i){const E=i[T],C=u[T].paddedRect,D=C.x+1,I=C.y+1,L=E.data.width,O=E.data.height;Pn.copy(E.data,x,{x:0,y:0},{x:D,y:I},E.data),Pn.copy(E.data,x,{x:0,y:O-1},{x:D,y:I-1},{width:L,height:1}),Pn.copy(E.data,x,{x:0,y:0},{x:D,y:I+O},{width:L,height:1}),Pn.copy(E.data,x,{x:L-1,y:0},{x:D-1,y:I},{width:1,height:O}),Pn.copy(E.data,x,{x:0,y:0},{x:D+L,y:I},{width:1,height:O})}this.image=x,this.iconPositions=o,this.patternPositions=u}addImages(e,i,o){for(const u in e){const f=e[u],p={x:0,y:0,w:f.data.width+2,h:f.data.height+2};o.push(p),i[u]=new $c(p,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),i),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,f]=e.tl;o.update(i.data,void 0,{x:u,y:f})}}var nl;function Ii(n,e,i,o,u,f,p,y,x,T,E,C,D,I,L){const O=Fs.fromFeature(n,u);let N;C===k.aA.vertical&&O.verticalizePunctuation();let G=O.determineLineBreaks(T,f,e,o,I);const{processBidirectionalText:J,processStyledBidirectionalText:q}=Ba;if(J&&O.sections.length===1){N=[],G=G.map((we=>O.toCodeUnitIndex(we)));const re=J(O.toString(),G);for(const we of re){const Ne=[...we].map((()=>0));N.push(new Fs(we,O.sections,Ne))}}else if(q){N=[],G=G.map((ke=>O.toCodeUnitIndex(ke)));let re=0;const we=[];for(const ke of O.text)we.push(...Array(ke.length).fill(O.sectionIndex[re])),re++;const Ne=q(O.text,we,G);for(const ke of Ne){const $e=[];let at="";for(const Ye of ke[0])$e.push(ke[1][at.length]),at+=Ye;N.push(new Fs(ke[0],O.sections,$e))}}else N=(function(re,we){const Ne=[];let ke=0;for(const $e of we)Ne.push(re.substring(ke,$e)),ke=$e;return ke<re.length()&&Ne.push(re.substring(ke,re.length())),Ne})(O,G);const $=[],te={positionedLines:$,text:O.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:C,iconsInText:!1,verticalizable:!1};return(function(re,we,Ne,ke,$e,at,Ye,Fe,ze,_t,pt,vt){let ct=0,Ct=0,gi=0,ni=0;const xn=Fe==="right"?1:Fe==="left"?0:.5,Yr=Di/vt;let ur=0;for(const Ri of $e){Ri.trim();const Rn=Ri.getMaxScale(),Hn={positionedGlyphs:[],lineOffset:0};re.positionedLines[ur]=Hn;const en=Hn.positionedGlyphs;let qa=0;if(!Ri.length()){Ct+=at,++ur;continue}const Wr=Gm(ke,Ri,Yr);let Za=0;for(const br of Ri.text){const An=Ri.getSection(Za),cr=br.codePointAt(0),Ln=qm(ze,pt,cr),wr={glyph:cr,imageName:null,x:ct,y:Ct+-17,vertical:Ln,scale:1,fontStack:"",sectionIndex:Ri.getSectionIndex(Za),metrics:null,rect:null};let ic;if("fontStack"in An){if(ic=Zm(An,cr,Ln,Wr,we,Ne),!ic)continue;wr.fontStack=An.fontStack}else{if(re.iconsInText=!0,An.scale*=Yr,ic=Hm(An,Ln,Rn,Wr,ke),!ic)continue;qa=Math.max(qa,ic.imageOffset),wr.imageName=An.imageName}const{rect:cl,metrics:Lp,baselineOffset:lh}=ic;wr.y+=lh,wr.scale=An.scale,wr.metrics=Lp,wr.rect=cl,en.push(wr),Ln?(re.verticalizable=!0,ct+=("imageName"in An?Lp.advance:Di)*An.scale+_t):ct+=Lp.advance*An.scale+_t,Za++}en.length!==0&&(gi=Math.max(ct-_t,gi),Qd(en,0,en.length-1,xn)),ct=0,Hn.lineOffset=Math.max(qa,(Rn-1)*Di);const To=at*Rn+qa;Ct+=To,ni=Math.max(To,ni),++ur}const{horizontalAlign:bn,verticalAlign:un}=Wh(Ye);(function(Ri,Rn,Hn,en,qa,Wr,Za,To,br){const An=(Rn-Hn)*qa;let cr=0;cr=Wr!==Za?-To*en- -17:-en*br*Za+.5*Za;for(const Ln of Ri)for(const wr of Ln.positionedGlyphs)wr.x+=An,wr.y+=cr})(re.positionedLines,xn,bn,un,gi,ni,at,Ct,$e.length),re.top+=-un*Ct,re.bottom=re.top+Ct,re.left+=-bn*gi,re.right=re.left+gi})(te,e,i,o,N,p,y,x,C,T,D,L),!(function(re){for(const we of re)if(we.positionedGlyphs.length!==0)return!1;return!0})($)&&te}function Wh(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Gm(n,e,i){const o=e.getMaxScale()*Di,{maxImageWidth:u,maxImageHeight:f}=e.getMaxImageSize(n),p=Math.max(o,f*i);return{verticalLineContentWidth:Math.max(o,u*i),horizontalLineContentHeight:p}}function lp(n){switch(n){case"top":return 0;case"center":return .5;default:return 1}}function qm(n,e,i){return!(n===k.aA.horizontal||!e&&!Ec(i)||e&&(Eh(i)||(o=i,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Zm(n,e,i,o,u,f){const p=f[n.fontStack],y=(function(T,E,C,D){if(T&&T.rect)return T;const I=E[C.fontStack],L=I&&I[D];return L?{rect:null,metrics:L.metrics}:null})(p&&p[e],u,n,e);if(y===null)return null;let x;if(i)x=o.verticalLineContentWidth-n.scale*Di;else{const T=lp(n.verticalAlign);x=(o.horizontalLineContentHeight-n.scale*Di)*T}return{rect:y.rect,metrics:y.metrics,baselineOffset:x}}function Hm(n,e,i,o,u){const f=u[n.imageName];if(!f)return null;const p=f.paddedRect,y=f.displaySize,x={width:y[0],height:y[1],left:1,top:-3,advance:e?y[1]:y[0]};let T;if(e)T=o.verticalLineContentWidth-y[1]*n.scale;else{const E=lp(n.verticalAlign);T=(o.horizontalLineContentHeight-y[1]*n.scale)*E}return{rect:p,metrics:x,baselineOffset:T,imageOffset:(e?y[0]:y[1])*n.scale-Di*i}}function Qd(n,e,i,o){if(o===0)return;const u=n[i],f=(n[i].x+u.metrics.advance*u.scale)*o;for(let p=e;p<=i;p++)n[p].x-=f}function Xc(n,e,i){const{horizontalAlign:o,verticalAlign:u}=Wh(i),f=e[0]-n.displaySize[0]*o,p=e[1]-n.displaySize[1]*u;return{image:n,top:p,bottom:p+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function Kd(n){var e,i;let o=n.left,u=n.top,f=n.right-o,p=n.bottom-u;const y=(e=n.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",x=(i=n.image.textFitHeight)!==null&&i!==void 0?i:"stretchOrShrink",T=(n.image.content[2]-n.image.content[0])/(n.image.content[3]-n.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&f/p<T||y==="proportional"){const E=Math.ceil(p*T);o*=E/f,f=E}}else if(y==="proportional"&&x==="stretchOnly"&&T!==0&&f/p>T){const E=Math.ceil(f/T);u*=E/p,p=E}return{x1:o,y1:u,x2:o+f,y2:u+p}}function Qh(n,e,i,o,u,f){const p=n.image;let y;if(p.content){const N=p.content,G=p.pixelRatio||1;y=[N[0]/G,N[1]/G,p.displaySize[0]-N[2]/G,p.displaySize[1]-N[3]/G]}const x=e.left*f,T=e.right*f;let E,C,D,I;i==="width"||i==="both"?(I=u[0]+x-o[3],C=u[0]+T+o[1]):(I=u[0]+(x+T-p.displaySize[0])/2,C=I+p.displaySize[0]);const L=e.top*f,O=e.bottom*f;return i==="height"||i==="both"?(E=u[1]+L-o[0],D=u[1]+O+o[2]):(E=u[1]+(L+O-p.displaySize[1])/2,D=E+p.displaySize[1]),{image:p,top:E,right:C,bottom:D,left:I,collisionPadding:y}}lt("ImagePosition",$c),lt("ImageAtlas",op),k.aA=void 0,(nl=k.aA||(k.aA={}))[nl.none=0]="none",nl[nl.horizontal=1]="horizontal",nl[nl.vertical=2]="vertical",nl[nl.horizontalOnly=3]="horizontalOnly";const Ns=128,ha=32640;function js(n,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new si(n+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:u}=i;let f=0;for(;f<o.length&&o[f]<=n;)f++;f=Math.max(0,f-1);let p=f;for(;p<o.length&&o[p]<n+1;)p++;p=Math.min(o.length-1,p);const y=o[f],x=o[p];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:x,minSize:i.evaluate(new si(y)),maxSize:i.evaluate(new si(x)),interpolationType:u}}}function Qu(n,e,i){let o="never";const u=n.get(e);return u?o=u:n.get(i)&&(o="always"),o}const $m=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kh(n,e,i,o,u,f,p,y,x,T,E,C,D){const I=y?Math.min(ha,Math.round(y[0])):0,L=y?Math.min(ha,Math.round(y[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*u),f,p,(I<<1)+(x?1:0),L,16*T,16*E,256*C,256*D)}function Jd(n,e,i){n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i),n.emplaceBack(e.x,e.y,i)}function sm(n){for(const e of n.sections)if(zc(e.text))return!0;return!1}class ef{constructor(e){this.layoutVertexArray=new K,this.indexArray=new Me,this.programConfigurations=e,this.segments=new He,this.dynamicLayoutVertexArray=new ae,this.opacityVertexArray=new le,this.hasVisibleVertices=!1,this.placedSymbolArray=new l}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,o,u){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tl.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Jf.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,$m,!0),this.opacityVertexBuffer.itemSize=1),(o||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}lt("SymbolBuffers",ef);class up{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new He,this.collisionVertexArray=new de}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ep.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}lt("CollisionBuffers",up);class Wl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((p=>p.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=js(this.zoom,i["text-size"]),this.iconSizeData=js(this.zoom,i["icon-size"]);const o=this.layers[0].layout,u=o.get("symbol-sort-key"),f=o.get("symbol-z-order");this.canOverlap=Qu(o,"text-overlap","text-allow-overlap")!=="never"||Qu(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!u.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map((p=>k.aA[p]))),this.stateDependentLayerIds=this.layers.filter((p=>p.isStateDependent())).map((p=>p.id)),this.sourceID=e.sourceID}createArrays(){this.text=new ef(new Qi(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new ef(new Qi(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new v,this.lineVertexArray=new w,this.symbolInstances=new _,this.textAnchorOffsets=new A}calculateGlyphDependencies(e,i,o,u,f){for(const p of e)if(i[p.codePointAt(0)]=!0,(o||u)&&f){const y=Zc[p];y&&(i[y.codePointAt(0)]=!0)}}populate(e,i,o){const u=this.layers[0],f=u.layout,p=f.get("text-font"),y=f.get("text-field"),x=f.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof Xn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=f.get("symbol-sort-key");if(this.features=[],!T&&!E)return;const D=i.iconDependencies,I=i.glyphDependencies,L=i.availableImages,O=new si(this.zoom);for(const{feature:N,id:G,index:J,sourceLayerIndex:q}of e){const $=u._featureFilter.needGeometry,te=yo(N,$);if(!u._featureFilter.filter(O,te,o))continue;let re,we;if($||(te.geometry=ca(N)),T){const ke=u.getValueAndResolveTokens("text-field",te,o,L),$e=Xn.factory(ke),at=this.hasRTLText=this.hasRTLText||sm($e);(!at||Ba.getRTLTextPluginStatus()==="unavailable"||at&&Ba.isParsed())&&(re=ip($e,u,te))}if(E){const ke=u.getValueAndResolveTokens("icon-image",te,o,L);we=ke instanceof Sr?ke:Sr.fromString(ke)}if(!re&&!we)continue;const Ne=this.sortFeaturesByKey?C.evaluate(te,{},o):void 0;if(this.features.push({id:G,text:re,icon:we,index:J,sourceLayerIndex:q,geometry:te.geometry,properties:N.properties,type:Jo.types[N.type],sortKey:Ne}),we&&(D[we.name]=!0),re){const ke=p.evaluate(te,{},o).join(","),$e=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(k.aA.vertical)>=0;for(const at of re.sections)if(at.image)D[at.image.name]=!0;else{const Ye=Sa(re.toString()),Fe=at.fontStack||ke,ze=I[Fe]=I[Fe]||{};this.calculateGlyphDependencies(at.text,ze,$e,this.allowVerticalPlacement,Ye)}}}f.get("symbol-placement")==="line"&&(this.features=(function(N){const G={},J={},q=[];let $=0;function te(ke){q.push(N[ke]),$++}function re(ke,$e,at){const Ye=J[ke];return delete J[ke],J[$e]=Ye,q[Ye].geometry[0].pop(),q[Ye].geometry[0]=q[Ye].geometry[0].concat(at[0]),Ye}function we(ke,$e,at){const Ye=G[$e];return delete G[$e],G[ke]=Ye,q[Ye].geometry[0].shift(),q[Ye].geometry[0]=at[0].concat(q[Ye].geometry[0]),Ye}function Ne(ke,$e,at){const Ye=at?$e[0][$e[0].length-1]:$e[0][0];return`${ke}:${Ye.x}:${Ye.y}`}for(let ke=0;ke<N.length;ke++){const $e=N[ke],at=$e.geometry,Ye=$e.text?$e.text.toString():null;if(!Ye){te(ke);continue}const Fe=Ne(Ye,at),ze=Ne(Ye,at,!0);if(Fe in J&&ze in G&&J[Fe]!==G[ze]){const _t=we(Fe,ze,at),pt=re(Fe,ze,q[_t].geometry);delete G[Fe],delete J[ze],J[Ne(Ye,q[pt].geometry,!0)]=pt,q[_t].geometry=null}else Fe in J?re(Fe,ze,at):ze in G?we(Fe,ze,at):(te(ke),G[Fe]=$-1,J[ze]=$-1)}return q.filter((ke=>ke.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((N,G)=>N.sortKey-G.sortKey))}update(e,i,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,{imagePositions:o}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0){let u=e.dist(i[e.segment+1]),f=e.dist(i[e.segment]);const p={};for(let y=e.segment+1;y<i.length;y++)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:u},y<i.length-1&&(u+=i[y+1].dist(i[y]));for(let y=e.segment||0;y>=0;y--)p[y]={x:i[y].x,y:i[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=i[y-1].dist(i[y]));for(let y=0;y<i.length;y++){const x=p[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,u,f,p,y,x,T,E,C,D){const I=e.indexArray,L=e.layoutVertexArray,O=e.segments.prepareSegment(4*i.length,L,I,this.canOverlap?p.sortKey:void 0),N=this.glyphOffsetArray.length,G=O.vertexLength,J=this.allowVerticalPlacement&&y===k.aA.vertical?Math.PI/2:0,q=p.text&&p.text.sections;for(let $=0;$<i.length;$++){const{tl:te,tr:re,bl:we,br:Ne,tex:ke,pixelOffsetTL:$e,pixelOffsetBR:at,minFontScaleX:Ye,minFontScaleY:Fe,glyphOffset:ze,isSDF:_t,sectionIndex:pt}=i[$],vt=O.vertexLength,ct=ze[1];Kh(L,x.x,x.y,te.x,ct+te.y,ke.x,ke.y,o,_t,$e.x,$e.y,Ye,Fe),Kh(L,x.x,x.y,re.x,ct+re.y,ke.x+ke.w,ke.y,o,_t,at.x,$e.y,Ye,Fe),Kh(L,x.x,x.y,we.x,ct+we.y,ke.x,ke.y+ke.h,o,_t,$e.x,at.y,Ye,Fe),Kh(L,x.x,x.y,Ne.x,ct+Ne.y,ke.x+ke.w,ke.y+ke.h,o,_t,at.x,at.y,Ye,Fe),Jd(e.dynamicLayoutVertexArray,x,J),I.emplaceBack(vt,vt+2,vt+1),I.emplaceBack(vt+1,vt+2,vt+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ze[0]),$!==i.length-1&&pt===i[$+1].sectionIndex||e.programConfigurations.populatePaintArrays(L.length,p,p.index,{imagePositions:{},canonical:D,formattedSection:q&&q[pt]})}e.placedSymbolArray.emplaceBack(x.x,x.y,N,this.glyphOffsetArray.length-N,G,T,E,x.segment,o?o[0]:0,o?o[1]:0,u[0],u[1],y,0,!1,0,C)}_addCollisionDebugVertex(e,i,o,u,f,p){return i.emplaceBack(0,0),e.emplaceBack(o.x,o.y,u,f,Math.round(p.x),Math.round(p.y))}addCollisionDebugVertices(e,i,o,u,f,p,y){const x=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),T=x.vertexLength,E=f.layoutVertexArray,C=f.collisionVertexArray,D=y.anchorX,I=y.anchorY;this._addCollisionDebugVertex(E,C,p,D,I,new ge(e,i)),this._addCollisionDebugVertex(E,C,p,D,I,new ge(o,i)),this._addCollisionDebugVertex(E,C,p,D,I,new ge(o,u)),this._addCollisionDebugVertex(E,C,p,D,I,new ge(e,u)),x.vertexLength+=4;const L=f.indexArray;L.emplaceBack(T,T+1),L.emplaceBack(T+1,T+2),L.emplaceBack(T+2,T+3),L.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(e,i,o,u){for(let f=e;f<i;f++){const p=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(p.x1,p.y1,p.x2,p.y2,u?this.textCollisionBox:this.iconCollisionBox,p.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new up(ee,tp.members,be),this.iconCollisionBox=new up(ee,tp.members,be);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,o,u,f,p,y,x,T){const E={};for(let C=i;C<o;C++){const D=e.get(C);E.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.textFeatureIndex=D.featureIndex;break}for(let C=u;C<f;C++){const D=e.get(C);E.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalTextFeatureIndex=D.featureIndex;break}for(let C=p;C<y;C++){const D=e.get(C);E.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.iconFeatureIndex=D.featureIndex;break}for(let C=x;C<T;C++){const D=e.get(C);E.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},E.verticalIconFeatureIndex=D.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),u=o.vertexStartIndex+4*o.numGlyphs;for(let f=o.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+2,f+1),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),u=[],f=[],p=[];for(let y=0;y<this.symbolInstances.length;++y){p.push(y);const x=this.symbolInstances.get(y);u.push(0|Math.round(i*x.anchorX+o*x.anchorY)),f.push(x.featureIndex)}return p.sort(((y,x)=>u[y]-u[x]||f[x]-f[y])),p}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(((u,f,p)=>{u>=0&&p.indexOf(u)===f&&this.addIndicesForPlacedSymbol(this.text,u)})),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let cp,hp;lt("SymbolBucket",Wl,{omit:["layers","collisionBoxArray","features","compareText"]}),Wl.MAX_GLYPHS=65535,Wl.addDynamicAttributes=Jd;var dp={get paint(){return hp=hp||new Sn({"icon-opacity":new Pt(xe.paint_symbol["icon-opacity"]),"icon-color":new Pt(xe.paint_symbol["icon-color"]),"icon-halo-color":new Pt(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pt(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pt(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Pt(xe.paint_symbol["text-opacity"]),"text-color":new Pt(xe.paint_symbol["text-color"],{runtimeType:Kr,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Pt(xe.paint_symbol["text-halo-color"]),"text-halo-width":new Pt(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new Pt(xe.paint_symbol["text-halo-blur"]),"text-translate":new Tt(xe.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(xe.paint_symbol["text-translate-anchor"])})},get layout(){return cp=cp||new Sn({"symbol-placement":new Tt(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pt(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Tt(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Tt(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Tt(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pt(xe.layout_symbol["icon-size"]),"icon-text-fit":new Tt(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Tt(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pt(xe.layout_symbol["icon-image"]),"icon-rotate":new Pt(xe.layout_symbol["icon-rotate"]),"icon-padding":new Pt(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new Pt(xe.layout_symbol["icon-offset"]),"icon-anchor":new Pt(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(xe.layout_symbol["text-rotation-alignment"]),"text-field":new Pt(xe.layout_symbol["text-field"]),"text-font":new Pt(xe.layout_symbol["text-font"]),"text-size":new Pt(xe.layout_symbol["text-size"]),"text-max-width":new Pt(xe.layout_symbol["text-max-width"]),"text-line-height":new Tt(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new Pt(xe.layout_symbol["text-letter-spacing"]),"text-justify":new Pt(xe.layout_symbol["text-justify"]),"text-radial-offset":new Pt(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Pt(xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Pt(xe.layout_symbol["text-anchor"]),"text-max-angle":new Tt(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(xe.layout_symbol["text-writing-mode"]),"text-rotate":new Pt(xe.layout_symbol["text-rotate"]),"text-padding":new Tt(xe.layout_symbol["text-padding"]),"text-keep-upright":new Tt(xe.layout_symbol["text-keep-upright"]),"text-transform":new Pt(xe.layout_symbol["text-transform"]),"text-offset":new Pt(xe.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new Tt(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new Tt(xe.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(xe.layout_symbol["text-optional"])})}};class tf{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Ui,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}lt("FormatSectionOverride",tf,{omit:["defaultValue"]});class Yc extends Rr{constructor(e,i){super(e,dp,i)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const u=[];for(const f of o)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,u){const f=this.layout.get(e).evaluate(i,{},o,u),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||ao(p.value)||!f?f:(function(y,x){return x.replace(/{([^{}]+)}/g,((T,E)=>y&&E in y?String(y[E]):""))})(i.properties,f)}createBucket(e){return new Wl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of dp.paint.overridableProperties){if(!Yc.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new tf(i),u=new bc(o,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new zr("source",u):new so("composite",u,i.value.zoomStops),this.paint._values[e]=new Ir(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&Yc.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),u=dp.paint.properties[i];let f=!1;const p=y=>{for(const x of y)if(u.overrides&&u.overrides.hasOverride(x))return void(f=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Xn)p(o.value.value.sections);else if(o.value.kind==="source"||o.value.kind==="composite"){const y=T=>{f||(T instanceof ea&&Xi(T.value)===Xa?p(T.value.sections):T instanceof mu?p(T.sections):T.eachChild(y))},x=o.value;x._styleExpression&&y(x._styleExpression.expression)}return f}}let om;var Xm={get paint(){return om=om||new Sn({"background-color":new Tt(xe.paint_background["background-color"]),"background-pattern":new Pr(xe.paint_background["background-pattern"]),"background-opacity":new Tt(xe.paint_background["background-opacity"])})}};class Jh extends Rr{constructor(e,i){super(e,Xm,i)}}class Ym extends Rr{constructor(e,i){super(e,{},i),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class lm{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const fi={once:!0},ed=63710088e-1;class Vs{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Vs(Et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,u=e.lat*i,f=Math.sin(o)*Math.sin(u)+Math.cos(o)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return ed*Math.acos(Math.min(f,1))}static convert(e){if(e instanceof Vs)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Vs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Vs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const nf=2*Math.PI*ed;function fp(n){return nf*Math.cos(n*Math.PI/180)}function rf(n){return(180+n)/360}function Wc(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function td(n,e){return n/fp(e)}function um(n){return 360*n-180}function id(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function cm(n,e){return n*fp(id(e))}class nd{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=Vs.convert(e);return new nd(rf(o.lng),Wc(o.lat),td(i,o.lat))}toLngLat(){return new Vs(um(this.x),id(this.y))}toAltitude(){return cm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/nf*(e=id(this.y),1/Math.cos(e*Math.PI/180));var e}}function pp(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class af{constructor(e,i,o){if(!(function(u,f,p){return!(u<0||u>25||p<0||p>=Math.pow(2,u)||f<0||f>=Math.pow(2,u))})(e,i,o))throw new Error(`x=${i}, y=${o}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=o,this.key=Zn(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,o){const u=(function(p,y,x){var T=pp(256*p,256*(y=Math.pow(2,x)-y-1),x),E=pp(256*(p+1),256*(y+1),x);return T[0]+","+T[1]+","+E[0]+","+E[1]})(this.x,this.y,this.z),f=(function(p,y,x){let T,E="";for(let C=p;C>0;C--)T=1<<C-1,E+=(y&T?1:0)+(x&T?2:0);return E})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,f).replace(/{bbox-epsg-3857}/g,u)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new ge((e.x*i-this.x)*Re,(e.y*i-this.y)*Re)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qi{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Zn(e,i.z,i.z,i.x,i.y)}}class da{constructor(e,i,o,u,f){if(this.terrainRttPosMatrix32f=null,e<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${o}`);this.overscaledZ=e,this.wrap=i,this.canonical=new af(o,+u,+f),this.key=Zn(i,e,o,u,f)}clone(){return new da(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new da(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new da(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-e;return e>this.canonical.z?Zn(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):Zn(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const i=this.canonical.z-e.canonical.z;return!(i<0)&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new da(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,u=2*this.canonical.y;return[new da(i,this.wrap,i,o,u),new da(i,this.wrap,i,o+1,u),new da(i,this.wrap,i,o,u+1),new da(i,this.wrap,i,o+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new da(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new da(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new nd(e.x-this.wrap,e.y))}}function Zn(n,e,i,o,u){(n*=2)<0&&(n=-1*n-1);const f=1<<i;return(f*f*n+f*u+o).toString(36)+i.toString(36)+e.toString(36)}function rd(n,e){return e?n.properties[e]:n.id}function hm(n,e){const i={id:n.id};if(e.removeAllProperties&&(delete n.removeProperties,delete n.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const o of e.removeProperties){const u=n.addOrUpdateProperties.findIndex((f=>f.key===o));u>-1&&n.addOrUpdateProperties.splice(u,1)}return(n.removeAllProperties||e.removeAllProperties)&&(i.removeAllProperties=!0),(n.removeProperties||e.removeProperties)&&(i.removeProperties=[...n.removeProperties||[],...e.removeProperties||[]]),(n.addOrUpdateProperties||e.addOrUpdateProperties)&&(i.addOrUpdateProperties=[...n.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(n.newGeometry||e.newGeometry)&&(i.newGeometry=e.newGeometry||n.newGeometry),i}function dm(n){var e,i;if(!n)return{};const o={};return o.removeAll=n.removeAll,o.remove=new Set(n.remove||[]),o.add=new Map((e=n.add)===null||e===void 0?void 0:e.map((u=>[u.id,u]))),o.update=new Map((i=n.update)===null||i===void 0?void 0:i.map((u=>[u.id,u]))),o}lt("CanonicalTileID",af),lt("OverscaledTileID",da,{omit:["terrainRttPosMatrix32f"]});class sf{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class of{constructor(e,i,o,u,f){this.type="Feature",this._vectorTileFeature=e,this._x=o,this._y=u,this._z=i,this.properties=e.properties,this.id=f}projectPoint(e,i,o,u){return[360*(e.x+i)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/u)*Math.PI))-90]}projectLine(e,i,o,u){return e.map((f=>this.projectPoint(f,i,o,u)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,i=e.extent*Math.pow(2,this._z),o=e.extent*this._x,u=e.extent*this._y,f=e.loadGeometry();switch(e.type){case 1:{const p=[];for(const x of f)p.push(x[0]);const y=this.projectLine(p,o,u,i);this._geometry=p.length===1?{type:"Point",coordinates:y[0]}:{type:"MultiPoint",coordinates:y};break}case 2:{const p=f.map((y=>this.projectLine(y,o,u,i)));this._geometry=p.length===1?{type:"LineString",coordinates:p[0]}:{type:"MultiLineString",coordinates:p};break}case 3:{const p=Gh(f),y=[];for(const x of p)y.push(x.map((T=>this.projectLine(T,o,u,i))));this._geometry=y.length===1?{type:"Polygon",coordinates:y[0]}:{type:"MultiPolygon",coordinates:y};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&i!=="_x"&&i!=="_y"&&i!=="_z"&&(e[i]=this[i]);return e}}class rl{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,i,o){this._name=e,this.dataBuffer=i,typeof o=="number"?this._size=o:(this.nullabilityBuffer=o,this._size=o.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class ad extends rl{}class lf extends ad{getValueFromBuffer(e){return this.dataBuffer[e]}}class sd extends ad{getValueFromBuffer(e){return this.dataBuffer[e]}}class uf extends rl{delta;constructor(e,i,o,u){super(e,i,u),this.delta=o}}class mp extends uf{constructor(e,i,o,u){super(e,Int32Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class cf extends rl{constructor(e,i,o){super(e,Int32Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}class Wm{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,i,o,u,f=4096){this._name=e,this._geometryVector=i,this._idVector=o,this._propertyVectors=u,this._extent=f}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((i=>[i.name,i])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let i=0;for(;i<this.numFeatures;){let o;this.idVector&&(o=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(i)):this.idVector.getValue(i));const u=e?.next().value,f={};for(const p of this.propertyVectors){if(!p)continue;const y=p.name,x=p.getValue(i);x!==null&&(f[y]=x)}i++,yield{id:o,geometry:u,properties:f}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],i=this.geometryVector.getGeometries();for(let o=0;o<this.numFeatures;o++){let u;this.idVector&&(u=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(o)):this.idVector.getValue(o));const f={coordinates:i[o],type:this.geometryVector.geometryType(o)},p={};for(const y of this.propertyVectors){if(!y)continue;const x=y.name,T=y.getValue(o);T!==null&&(p[x]=T)}e.push({id:u,geometry:f,properties:p})}return e}containsMaxSaveIntegerValues(e){return e instanceof lf||e instanceof cf&&e instanceof mp||e instanceof sd}}class fm{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Jt,al,vn,ps,Ql,Hr,or,lr,gp,fa;function Qn(n,e,i){const o=new Int32Array(i);let u=0,f=e.get();for(let p=0;p<o.length;p++){let y=n[f++],x=127&y;y<128||(y=n[f++],x|=(127&y)<<7,y<128||(y=n[f++],x|=(127&y)<<14,y<128||(y=n[f++],x|=(127&y)<<21,y<128||(y=n[f++],x|=(15&y)<<28)))),o[u++]=x}return e.set(f),o}function hf(n,e,i){const o=new BigInt64Array(i);for(let u=0;u<o.length;u++)o[u]=pm(n,e);return o}function ms(n,e){let i,o;return o=n[e.get()],e.increment(),i=127&o,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<7,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<14,o<128?i:(o=n[e.get()],e.increment(),i|=(127&o)<<21,o<128?i:(o=n[e.get()],i|=(15&o)<<28,(function(u,f,p){let y,x;if(x=f[p.get()],p.increment(),y=(112&x)>>4,x<128||(x=f[p.get()],p.increment(),y|=(127&x)<<3,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<10,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<17,x<128)||(x=f[p.get()],p.increment(),y|=(127&x)<<24,x<128)||(x=f[p.get()],p.increment(),y|=(1&x)<<31,x<128))return 4294967296*y+(u>>>0);throw new Error("Expected varint not more than 10 bytes")})(i,n,e)))))}function df(n,e,i,o){throw new Error("FastPFor is not implemented yet.")}function Kl(n){return n>>>1^-(1&n)}function Ku(n){return n>>1n^-(1n&n)}function pm(n,e){let i=0n,o=0,u=e.get();for(;u<n.length;){const f=n[u++];if(i|=BigInt(127&f)<<BigInt(o),!(128&f))break;if(o+=7,o>=64)throw new Error("Varint too long")}return e.set(u),i}function Qc(n,e,i){const o=new Int32Array(i);let u=0;for(let f=0;f<e;f++){const p=n[f];o.fill(n[f+e],u,u+p),u+=p}return o}function Ga(n,e,i){const o=new BigInt64Array(i);let u=0;for(let f=0;f<e;f++){const p=Number(n[f]);o.fill(n[f+e],u,u+p),u+=p}return o}function _p(n,e,i){const o=new Float64Array(i);let u=0;for(let f=0;f<e;f++){const p=n[f];o.fill(n[f+e],u,u+p),u+=p}return o}function Kc(n){const e=n.length/4*4;let i=1;if(e>=4)for(let o=n[0];i<e-4;i+=4)o=n[i]+=o,o=n[i+1]+=o,o=n[i+2]+=o,o=n[i+3]+=o;for(;i!=n.length;)n[i]+=n[i-1],++i}function wo(n){n[0]=n[0]>>>1^-(1&n[0]),n[1]=n[1]>>>1^-(1&n[1]);const e=n.length/4*4;let i=2;if(e>=4)for(;i<e-4;i+=4){const o=n[i],u=n[i+1],f=n[i+2],p=n[i+3];n[i]=(o>>>1^-(1&o))+n[i-2],n[i+1]=(u>>>1^-(1&u))+n[i-1],n[i+2]=(f>>>1^-(1&f))+n[i],n[i+3]=(p>>>1^-(1&p))+n[i+1]}for(;i!=n.length;i+=2)n[i]=(n[i]>>>1^-(1&n[i]))+n[i-2],n[i+1]=(n[i+1]>>>1^-(1&n[i+1]))+n[i-1]}(function(n){n.NONE="NONE",n.DELTA="DELTA",n.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",n.RLE="RLE",n.MORTON="MORTON",n.PDE="PDE"})(Jt||(Jt={})),(function(n){n.NONE="NONE",n.FAST_PFOR="FAST_PFOR",n.VARINT="VARINT",n.ALP="ALP"})(al||(al={})),(function(n){n.PRESENT="PRESENT",n.DATA="DATA",n.OFFSET="OFFSET",n.LENGTH="LENGTH"})(vn||(vn={}));class yp{_dictionaryType;_offsetType;_lengthType;constructor(e,i,o){this._dictionaryType=e,this._offsetType=i,this._lengthType=o}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function $r(n,e){const i=(function(o,u){const f=o[u.get()],p=Object.values(vn)[f>>4];let y=null;switch(p){case vn.DATA:y=new yp(Object.values(ps)[15&f]);break;case vn.OFFSET:y=new yp(null,Object.values(Ql)[15&f]);break;case vn.LENGTH:y=new yp(null,null,Object.values(Hr)[15&f])}u.increment();const x=o[u.get()],T=Object.values(Jt)[x>>5],E=Object.values(Jt)[x>>2&7],C=Object.values(al)[3&x];u.increment();const D=Qn(o,u,2),I=D[0];return{physicalStreamType:p,logicalStreamType:y,logicalLevelTechnique1:T,logicalLevelTechnique2:E,physicalLevelTechnique:C,numValues:I,byteLength:D[1],decompressedCount:I}})(n,e);return i.logicalLevelTechnique1===Jt.MORTON?(function(o,u,f){const p=Qn(u,f,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:o.decompressedCount,numBits:p[0],coordinateShift:p[1]}})(i,n,e):Jt.RLE!==i.logicalLevelTechnique1&&Jt.RLE!==i.logicalLevelTechnique2||al.NONE===i.physicalLevelTechnique?i:(function(o,u,f){const p=Qn(u,f,2);return{physicalStreamType:o.physicalStreamType,logicalStreamType:o.logicalStreamType,logicalLevelTechnique1:o.logicalLevelTechnique1,logicalLevelTechnique2:o.logicalLevelTechnique2,physicalLevelTechnique:o.physicalLevelTechnique,numValues:o.numValues,byteLength:o.byteLength,decompressedCount:p[1],runs:p[0],numRleValues:p[1]}})(i,n,e)}(function(n){n.NONE="NONE",n.SINGLE="SINGLE",n.SHARED="SHARED",n.VERTEX="VERTEX",n.MORTON="MORTON",n.FSST="FSST"})(ps||(ps={})),(function(n){n.VERTEX="VERTEX",n.INDEX="INDEX",n.STRING="STRING",n.KEY="KEY"})(Ql||(Ql={})),(function(n){n.VAR_BINARY="VAR_BINARY",n.GEOMETRIES="GEOMETRIES",n.PARTS="PARTS",n.RINGS="RINGS",n.TRIANGLES="TRIANGLES",n.SYMBOL="SYMBOL",n.DICTIONARY="DICTIONARY"})(Hr||(Hr={})),(function(n){n[n.FLAT=0]="FLAT",n[n.CONST=1]="CONST",n[n.SEQUENCE=2]="SEQUENCE",n[n.DICTIONARY=3]="DICTIONARY",n[n.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(or||(or={}));class Xr{values;_size;constructor(e,i){this.values=e,this._size=i}get(e){const i=Math.floor(e/8);return(this.values[i]>>e%8&1)==1}set(e,i){const o=Math.floor(e/8);this.values[o]=this.values[o]|(i?1:0)<<e%8}getInt(e){const i=Math.floor(e/8);return this.values[i]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function kr(n,e,i,o,u){return(function(f,p,y){switch(p.logicalLevelTechnique1){case Jt.DELTA:return p.logicalLevelTechnique2===Jt.RLE?(function(x,T,E){const C=new Int32Array(E);let D=0,I=0;for(let L=0;L<T;L++){const O=x[L],N=Kl(x[L+T]);for(let G=0;G<O;G++)I+=N,C[D++]=I}return C})(f,p.runs,p.numRleValues):((function(x){x[0]=x[0]>>>1^-(1&x[0]);const T=x.length/4*4;let E=1;if(T>=4)for(;E<T-4;E+=4){const C=x[E],D=x[E+1],I=x[E+2],L=x[E+3];x[E]=(C>>>1^-(1&C))+x[E-1],x[E+1]=(D>>>1^-(1&D))+x[E],x[E+2]=(I>>>1^-(1&I))+x[E+1],x[E+3]=(L>>>1^-(1&L))+x[E+2]}for(;E!=x.length;++E)x[E]=(x[E]>>>1^-(1&x[E]))+x[E-1]})(f),f);case Jt.RLE:return(function(x,T,E){return E?(function(C,D,I){const L=new Int32Array(I);let O=0;for(let N=0;N<D;N++){const G=C[N];let J=C[N+D];J=J>>>1^-(1&J),L.fill(J,O,O+G),O+=G}return L})(x,T.runs,T.numRleValues):Qc(x,T.runs,T.numRleValues)})(f,p,y);case Jt.MORTON:return Kc(f),f;case Jt.COMPONENTWISE_DELTA:return wo(f),f;case Jt.NONE:return y&&(function(x){for(let T=0;T<x.length;T++){const E=x[T];x[T]=E>>>1^-(1&E)}})(f),f;default:throw new Error(`The specified Logical level technique is not supported: ${p.logicalLevelTechnique1}`)}})(ff(n,e,i),i,o)}function Jl(n,e,i){return(function(o,u){if(u.logicalLevelTechnique1===Jt.DELTA&&u.logicalLevelTechnique2===Jt.NONE)return(function(p){const y=new Int32Array(p.length+1);y[0]=0,y[1]=Kl(p[0]);let x=y[1],T=2;for(;T!=y.length;++T){const E=p[T-1];x+=E>>>1^-(1&E),y[T]=y[T-1]+x}return y})(o);if(u.logicalLevelTechnique1===Jt.RLE&&u.logicalLevelTechnique2===Jt.NONE)return(function(p,y,x){const T=new Int32Array(x+1);T[0]=0;let E=1,C=T[0];for(let D=0;D<y;D++){const I=p[D],L=p[D+y];for(let O=E;O<E+I;O++)T[O]=L+C,C=T[O];E+=I}return T})(o,u.runs,u.numRleValues);if(u.logicalLevelTechnique1===Jt.NONE&&u.logicalLevelTechnique2===Jt.NONE){(function(p){let y=0;for(let x=0;x<p.length;x++)p[x]+=y,y=p[x]})(o);const f=new Int32Array(u.numValues+1);return f[0]=0,f.set(o,1),f}if(u.logicalLevelTechnique1===Jt.DELTA&&u.logicalLevelTechnique2===Jt.RLE){const f=(function(p,y,x){const T=new Int32Array(x+1);T[0]=0;let E=1,C=T[0];for(let D=0;D<y;D++){const I=p[D];let L=p[D+y];L=L>>>1^-(1&L);for(let O=E;O<E+I;O++)T[O]=L+C,C=T[O];E+=I}return T})(o,u.runs,u.numRleValues);return Kc(f),f}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(ff(n,e,i),i)}function ff(n,e,i){const o=i.physicalLevelTechnique;if(o===al.FAST_PFOR)return df();if(o===al.VARINT)return Qn(n,e,i.numValues);if(o===al.NONE){const u=e.get();e.add(i.byteLength);const f=n.subarray(u,e.get());return new Int32Array(f)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function vp(n,e,i,o){const u=ff(n,e,i);if(u.length===1){const f=u[0];return o?Kl(f):f}return o?(function(f){return Kl(f[1])})(u):(function(f){return f[1]})(u)}function mm(n,e,i){return(function(o){if(o.length==2){const u=Kl(o[1]);return[u,u]}return[Kl(o[2]),Kl(o[3])]})(ff(n,e,i))}function gm(n,e,i){return(function(o){if(o.length==2){const u=Ku(o[1]);return[u,u]}return[Ku(o[2]),Ku(o[3])]})(hf(n,e,i.numValues))}function _m(n,e,i,o){return(function(u,f,p){switch(f.logicalLevelTechnique1){case Jt.DELTA:return f.logicalLevelTechnique2===Jt.RLE?(function(y,x,T){const E=new BigInt64Array(T);let C=0,D=0n;for(let I=0;I<x;I++){const L=Number(y[I]),O=Ku(y[I+x]);for(let N=0;N<L;N++)D+=O,E[C++]=D}return E})(u,f.runs,f.numRleValues):((function(y){y[0]=y[0]>>1n^-(1n&y[0]);const x=y.length/4*4;let T=1;if(x>=4)for(;T<x-4;T+=4){const E=y[T],C=y[T+1],D=y[T+2],I=y[T+3];y[T]=(E>>1n^-(1n&E))+y[T-1],y[T+1]=(C>>1n^-(1n&C))+y[T],y[T+2]=(D>>1n^-(1n&D))+y[T+1],y[T+3]=(I>>1n^-(1n&I))+y[T+2]}for(;T!=y.length;++T)y[T]=(y[T]>>1n^-(1n&y[T]))+y[T-1]})(u),u);case Jt.RLE:return(function(y,x,T){return T?(function(E,C,D){const I=new BigInt64Array(D);let L=0;for(let O=0;O<C;O++){const N=Number(E[O]);let G=E[O+C];G=G>>1n^-(1n&G),I.fill(G,L,L+N),L+=N}return I})(y,x.runs,x.numRleValues):Ga(y,x.runs,x.numRleValues)})(u,f,p);case Jt.NONE:return p&&(function(y){for(let x=0;x<y.length;x++){const T=y[x];y[x]=T>>1n^-(1n&T)}})(u),u;default:throw new Error(`The specified Logical level technique is not supported: ${f.logicalLevelTechnique1}`)}})(hf(n,e,i.numValues),i,o)}function ym(n,e,i,o){const u=hf(n,e,i.numValues);if(u.length===1){const f=u[0];return o?Ku(f):f}return o?(function(f){return Ku(f[1])})(u):(function(f){return f[1]})(u)}function pf(n,e,i,o,u){return(function(f,p,y,x){switch(p.logicalLevelTechnique1){case Jt.DELTA:return p.logicalLevelTechnique2===Jt.RLE&&(f=Qc(f,p.runs,p.numRleValues)),(function(T,E){const C=new Int32Array(T.size());let D=0;T.get(0)?(C[0]=T.get(0)?E[0]>>>1^-(1&E[0]):0,D=1):C[0]=0;let I=1;for(;I!=C.length;++I)C[I]=T.get(I)?C[I-1]+(E[D]>>>1^-(1&E[D++])):C[I-1];return C})(x,f);case Jt.RLE:return(function(T,E,C,D){const I=E;return C?(function(L,O,N){const G=new Int32Array(L.size());let J=0;for(let q=0;q<N;q++){const $=O[q];let te=O[q+N];te=te>>>1^-(1&te);for(let re=J;re<J+$;re++)L.get(re)?G[re]=te:(G[re]=0,J++);J+=$}return G})(D,T,I.runs):(function(L,O,N){const G=new Int32Array(L.size());let J=0;for(let q=0;q<N;q++){const $=O[q],te=O[q+N];for(let re=J;re<J+$;re++)L.get(re)?G[re]=te:(G[re]=0,J++);J+=$}return G})(D,T,I.runs)})(f,p,y,x);case Jt.MORTON:return Kc(f),f;case Jt.COMPONENTWISE_DELTA:return wo(f),f;case Jt.NONE:return f=y?(function(T,E){const C=new Int32Array(T.size());let D=0,I=0;for(;I!=C.length;++I)if(T.get(I)){const L=E[D++];C[I]=L>>>1^-(1&L)}else C[I]=0;return C})(x,f):(function(T,E){const C=new Int32Array(T.size());let D=0,I=0;for(;I!=C.length;++I)C[I]=T.get(I)?E[D++]:0;return C})(x,f),f;default:throw new Error("The specified Logical level technique is not supported")}})(i.physicalLevelTechnique===al.FAST_PFOR?df():Qn(n,e,i.numValues),i,o,u)}function sl(n,e,i,o){const u=n.logicalLevelTechnique1;if(u===Jt.RLE)return n.runs===1?or.CONST:or.FLAT;const f=e instanceof Xr?e.size():e;if(u===Jt.DELTA&&n.logicalLevelTechnique2===Jt.RLE){const p=n.runs,y=2;if(n.numRleValues!==f)return or.FLAT;if(p===1)return or.SEQUENCE;if(p===2){const x=o.get();let T;if(n.physicalLevelTechnique===al.VARINT)T=Qn(i,o,4);else{const E=o.get();T=new Int32Array(i.buffer,i.byteOffset+E,4)}if(o.set(x),T[2]===y&&T[3]===y)return or.SEQUENCE}}return n.numValues===1?or.CONST:or.FLAT}class Jc extends ad{getValueFromBuffer(e){return this.dataBuffer[e]}}class xp extends uf{constructor(e,i,o,u){super(e,BigInt64Array.of(i),o,u)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class eh{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,i,o){this._geometryOffsets=e,this._partOffsets=i,this._ringOffsets=o}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function eu(n,e,i){return{x:th(n,e)-i,y:th(n>>1,e)-i}}function th(n,e){let i=0;for(let o=0;o<e;o++)i|=(n&1<<2*o)>>o;return i}(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON",n[n.MULTIPOINT=3]="MULTIPOINT",n[n.MULTILINESTRING=4]="MULTILINESTRING",n[n.MULTIPOLYGON=5]="MULTIPOLYGON"})(lr||(lr={})),(function(n){n[n.POINT=0]="POINT",n[n.LINESTRING=1]="LINESTRING",n[n.POLYGON=2]="POLYGON"})(gp||(gp={})),(function(n){n[n.MORTON=0]="MORTON",n[n.VEC_2=1]="VEC_2",n[n.VEC_3=2]="VEC_3"})(fa||(fa={}));class vm{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((i=>[i]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,i){return[e].concat(i)}createMultiPolygon(e){return e.flat()}}function od(n){const e=new Array(n.numGeometries);let i=1,o=1,u=1,f=0;const p=new vm;let y=0,x=0;const T=n.mortonSettings,E=n.topologyVector,C=E.geometryOffsets,D=E.partOffsets,I=E.ringOffsets,L=n.vertexOffsets,O=n.containsPolygonGeometry(),N=n.vertexBuffer;for(let G=0;G<n.numGeometries;G++){const J=n.geometryType(G);if(J===lr.POINT){if(L&&L.length!==0)if(n.vertexBufferType===fa.VEC_2){const q=2*L[x++],$=new ge(N[q],N[q+1]);e[f++]=p.createPoint($)}else{const q=eu(N[L[x++]],T.numBits,T.coordinateShift),$=new ge(q.x,q.y);e[f++]=p.createPoint($)}else{const q=new ge(N[y++],N[y++]);e[f++]=p.createPoint(q)}C&&u++,D&&i++,I&&o++}else if(J===lr.MULTIPOINT){const q=C[u]-C[u-1];u++;const $=new Array(q);if(L&&L.length!==0){for(let te=0;te<q;te++){const re=2*L[x++];$[te]=new ge(N[re],N[re+1])}e[f++]=p.createMultiPoint($)}else{for(let te=0;te<q;te++){const re=N[y++],we=N[y++];$[te]=new ge(re,we)}e[f++]=p.createMultiPoint($)}}else if(J===lr.LINESTRING){let q,$=0;O?($=I[o]-I[o-1],o++):$=D[i]-D[i-1],i++,L&&L.length!==0?(q=n.vertexBufferType===fa.VEC_2?gf(N,L,x,$,!1):bp(N,L,x,$,!1,T),x+=$):(q=mf(N,y,$,!1),y+=2*$),e[f++]=p.createLineString(q),C&&u++}else if(J===lr.POLYGON){const q=D[i]-D[i-1];i++;const $=new Array(q-1);let te=I[o]-I[o-1];if(o++,L&&L.length!==0){const re=n.vertexBufferType===fa.VEC_2?nh(N,L,x,te):Ju(N,L,x,te,0,T);x+=te;for(let we=0;we<$.length;we++)te=I[o]-I[o-1],o++,$[we]=n.vertexBufferType===fa.VEC_2?nh(N,L,x,te):Ju(N,L,x,te,0,T),x+=te;e[f++]=p.createPolygon(re,$)}else{const re=ih(N,y,te);y+=2*te;for(let we=0;we<$.length;we++)te=I[o]-I[o-1],o++,$[we]=ih(N,y,te),y+=2*te;e[f++]=p.createPolygon(re,$)}C&&u++}else if(J===lr.MULTILINESTRING){const q=C[u]-C[u-1];u++;const $=new Array(q);if(L&&L.length!==0){for(let te=0;te<q;te++){let re=0;O?(re=I[o]-I[o-1],o++):re=D[i]-D[i-1],i++;const we=n.vertexBufferType===fa.VEC_2?gf(N,L,x,re,!1):bp(N,L,x,re,!1,T);$[te]=we,x+=re}e[f++]=p.createMultiLineString($)}else{for(let te=0;te<q;te++){let re=0;O?(re=I[o]-I[o-1],o++):re=D[i]-D[i-1],i++,$[te]=mf(N,y,re,!1),y+=2*re}e[f++]=p.createMultiLineString($)}}else{if(J!==lr.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const q=C[u]-C[u-1];u++;const $=new Array(q);let te=0;if(L&&L.length!==0){for(let re=0;re<q;re++){const we=D[i]-D[i-1];i++;const Ne=new Array(we-1);te=I[o]-I[o-1],o++;const ke=n.vertexBufferType===fa.VEC_2?nh(N,L,x,te):Ju(N,L,x,te,0,T);x+=te;for(let $e=0;$e<Ne.length;$e++)te=I[o]-I[o-1],o++,Ne[$e]=n.vertexBufferType===fa.VEC_2?nh(N,L,x,te):Ju(N,L,x,te,0,T),x+=te;$[re]=p.createPolygon(ke,Ne)}e[f++]=p.createMultiPolygon($)}else{for(let re=0;re<q;re++){const we=D[i]-D[i-1];i++;const Ne=new Array(we-1);te=I[o]-I[o-1],o++;const ke=ih(N,y,te);y+=2*te;for(let $e=0;$e<Ne.length;$e++){const at=I[o]-I[o-1];o++,Ne[$e]=ih(N,y,at),y+=2*at}$[re]=p.createPolygon(ke,Ne)}e[f++]=p.createMultiPolygon($)}}}}return e}function ih(n,e,i){return mf(n,e,i,!0)}function nh(n,e,i,o){return gf(n,e,i,o,!0)}function Ju(n,e,i,o,u,f){return bp(n,e,i,o,!0,f)}function mf(n,e,i,o){const u=new Array(o?i+1:i);for(let f=0;f<2*i;f+=2)u[f/2]=new ge(n[e+f],n[e+f+1]);return o&&(u[u.length-1]=u[0]),u}function gf(n,e,i,o,u){const f=new Array(u?o+1:o);for(let p=0;p<2*o;p+=2){const y=2*e[i+p/2];f[p/2]=new ge(n[y],n[y+1])}return u&&(f[f.length-1]=f[0]),f}function bp(n,e,i,o,u,f){const p=new Array(u?o+1:o);for(let y=0;y<o;y++){const x=eu(n[e[i+y]],f.numBits,f.coordinateShift);p[y]=new ge(x.x,x.y)}return u&&(p[p.length-1]=p[0]),p}class wp{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,i,o,u,f){this._vertexBufferType=e,this._topologyVector=i,this._vertexOffsets=o,this._vertexBuffer=u,this._mortonSettings=f}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=od(this);let i=0;for(;i<this.numGeometries;)yield{coordinates:e[i],type:this.geometryType(i)},i++}getSimpleEncodedVertex(e){const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const o=eu(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[o.x,o.y]}const i=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[i],this.vertexBuffer[i+1]]}getGeometries(){return od(this)}get mortonSettings(){return this._mortonSettings}}class xm extends wp{_numGeometries;_geometryType;constructor(e,i,o,u,f,p,y){super(o,u,f,p,y),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===lr.POLYGON||this._geometryType===lr.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class _f extends wp{_geometryTypes;constructor(e,i,o,u,f,p){super(e,o,u,f,p),this._geometryTypes=i}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===lr.POLYGON||this.geometryType(e)===lr.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class bm{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,i,o,u){this._triangleOffsets=e,this._indexBuffer=i,this._vertexBuffer=o,this._topologyVector=u}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),i=this._topologyVector,o=i.partOffsets,u=i.ringOffsets,f=i.geometryOffsets;let p=0,y=1,x=1,T=1;for(let E=0;E<this.numGeometries;E++)switch(this.geometryType(E)){case lr.POLYGON:{const C=o[y]-o[y-1];y++;const D=[];for(let I=0;I<C;I++){const L=u[x]-u[x-1];x++;const O=[];for(let N=0;N<L;N++){const G=this._vertexBuffer[p++],J=this._vertexBuffer[p++];O.push(new ge(G,J))}O.length>0&&O.push(O[0]),D.push(O)}e[E]=D,f&&T++}break;case lr.MULTIPOLYGON:{const C=f[T]-f[T-1];T++;const D=[];for(let I=0;I<C;I++){const L=o[y]-o[y-1];y++;for(let O=0;O<L;O++){const N=u[x]-u[x-1];x++;const G=[];for(let J=0;J<N;J++){const q=this._vertexBuffer[p++],$=this._vertexBuffer[p++];G.push(new ge(q,$))}G.length>0&&G.push(G[0]),D.push(G)}}e[E]=D}}return e}[Symbol.iterator](){return null}}function ld(n,e,i,o,u,f){return new yf(n,e,i,o,u,f)}class yf extends bm{_numGeometries;_geometryType;constructor(e,i,o,u,f,p){super(o,u,f,p),this._numGeometries=e,this._geometryType=i}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function ud(n,e,i,o,u){return new Qm(n,e,i,o,u)}class Qm extends bm{_geometryTypes;constructor(e,i,o,u,f){super(i,o,u,f),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function cd(n,e,i,o,u){const f=$r(n,i);let p=null,y=null,x=null,T=null,E=null,C=null,D=null,I=null;if(sl(f,o,n,i)===or.CONST){const O=vp(n,i,f,!1);for(let N=0;N<e-1;N++){const G=$r(n,i);switch(G.physicalStreamType){case vn.LENGTH:switch(G.logicalStreamType.lengthType){case Hr.GEOMETRIES:p=Jl(n,i,G);break;case Hr.PARTS:y=Jl(n,i,G);break;case Hr.RINGS:x=Jl(n,i,G);break;case Hr.TRIANGLES:D=Jl(n,i,G)}break;case vn.OFFSET:switch(G.logicalStreamType.offsetType){case Ql.VERTEX:T=kr(n,i,G,!1);break;case Ql.INDEX:I=kr(n,i,G,!1)}break;case vn.DATA:ps.VERTEX===G.logicalStreamType.dictionaryType?E=kr(n,i,G,!0):(C={numBits:G.numBits,coordinateShift:G.coordinateShift},E=kr(n,i,G,!1))}}return I!==null?p!=null||y!=null?ld(o,O,D,I,E,new eh(p,y,x)):ld(o,O,D,I,E):C===null?(function(N,G,J,q,$){return new xm(N,G,fa.VEC_2,J,q,$)})(o,O,new eh(p,y,x),T,E):(function(N,G,J,q,$,te){return new xm(N,G,fa.MORTON,J,q,$,te)})(o,O,new eh(p,y,x),T,E,C)}const L=kr(n,i,f,!1);for(let O=0;O<e-1;O++){const N=$r(n,i);switch(N.physicalStreamType){case vn.LENGTH:switch(N.logicalStreamType.lengthType){case Hr.GEOMETRIES:p=kr(n,i,N,!1);break;case Hr.PARTS:y=kr(n,i,N,!1);break;case Hr.RINGS:x=kr(n,i,N,!1);break;case Hr.TRIANGLES:D=Jl(n,i,N)}break;case vn.OFFSET:switch(N.logicalStreamType.offsetType){case Ql.VERTEX:T=kr(n,i,N,!1);break;case Ql.INDEX:I=kr(n,i,N,!1)}break;case vn.DATA:ps.VERTEX===N.logicalStreamType.dictionaryType?E=kr(n,i,N,!0):(C={numBits:N.numBits,coordinateShift:N.coordinateShift},E=kr(n,i,N,!1))}}return I!==null&&y===null?ud(L,D,I,E):(p!==null?(p=Tp(L,p,2),y!==null&&x!==null?(y=Sp(L,p,y,!1),x=(function(O,N,G,J){const q=new Int32Array(G[G.length-1]+1);let $=0;q[0]=$;let te=1,re=1,we=0;for(let Ne=0;Ne<O.length;Ne++){const ke=O[Ne],$e=N[Ne+1]-N[Ne];if(ke!==0&&ke!==3)for(let at=0;at<$e;at++){const Ye=G[te]-G[te-1];te++;for(let Fe=0;Fe<Ye;Fe++)$=q[re++]=$+J[we++]}else for(let at=0;at<$e;at++)q[re++]=++$,te++}return q})(L,p,y,x)):y!==null&&(y=(function(O,N,G){const J=new Int32Array(N[N.length-1]+1);let q=0;J[0]=q;let $=1,te=0;for(let re=0;re<O.length;re++){const we=O[re],Ne=N[re+1]-N[re];if(we===4||we===1)for(let ke=0;ke<Ne;ke++)q=J[$++]=q+G[te++];else for(let ke=0;ke<Ne;ke++)J[$++]=++q}return J})(L,p,y))):y!==null&&x!==null?(y=Tp(L,y,1),x=Sp(L,y,x,!0)):y!==null&&(y=Tp(L,y,0)),I!==null?ud(L,D,I,E,new eh(p,y,x)):C===null?(function(O,N,G,J){return new _f(fa.VEC_2,O,N,G,J)})(L,new eh(p,y,x),T,E):(function(O,N,G,J,q){return new _f(fa.MORTON,O,N,G,J,q)})(L,new eh(p,y,x),T,E,C))}function Tp(n,e,i){const o=new Int32Array(n.length+1);let u=0;o[0]=u;let f=0;for(let p=0;p<n.length;p++)u=o[p+1]=u+(n[p]>i?e[f++]:1);return o}function Sp(n,e,i,o){const u=new Int32Array(e[e.length-1]+1);let f=0;u[0]=f;let p=1,y=0;for(let x=0;x<n.length;x++){const T=n[x],E=e[x+1]-e[x];if(T===5||T===2||o&&(T===4||T===1))for(let C=0;C<E;C++)f=u[p++]=f+i[y++];else for(let C=0;C<E;C++)u[p++]=++f}return u}class wm extends rl{dataVector;constructor(e,i,o){super(e,i.getBuffer(),o),this.dataVector=i}getValueFromBuffer(e){return this.dataVector.get(e)}}class Tm extends ad{getValueFromBuffer(e){return this.dataBuffer[e]}}class Mp extends rl{constructor(e,i,o){super(e,BigInt64Array.of(i),o)}getValueFromBuffer(e){return this.dataBuffer[0]}}function ec(n,e,i){return Ep(n,Math.ceil(e/8),i)}function Ep(n,e,i){const o=new Uint8Array(e);let u=0;for(;u<e;){const f=n[i.increment()];if(f<=127){const p=f+3,y=n[i.increment()],x=u+p;o.fill(y,u,x),u=x}else{const p=256-f;for(let y=0;y<p;y++)o[u++]=n[i.increment()]}}return o}const Sm=new TextDecoder;function rh(n,e,i){return i-e>=12?Sm.decode(n.subarray(e,i)):(function(o,u,f){let p="",y=u;for(;y<f;){const x=o[y];let T,E,C,D=null,I=x>239?4:x>223?3:x>191?2:1;if(y+I>f)break;I===1?x<128&&(D=x):I===2?(T=o[y+1],(192&T)==128&&(D=(31&x)<<6|63&T,D<=127&&(D=null))):I===3?(T=o[y+1],E=o[y+2],(192&T)==128&&(192&E)==128&&(D=(15&x)<<12|(63&T)<<6|63&E,(D<=2047||D>=55296&&D<=57343)&&(D=null))):I===4&&(T=o[y+1],E=o[y+2],C=o[y+3],(192&T)==128&&(192&E)==128&&(192&C)==128&&(D=(15&x)<<18|(63&T)<<12|(63&E)<<6|63&C,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,I=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),y+=I}return p})(n,e,i)}class Ap extends rl{offsetBuffer;constructor(e,i,o,u){super(e,o,u),this.offsetBuffer=i}}class Mm extends Ap{textEncoder;constructor(e,i,o,u){super(e,i,o,u??i.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return rh(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class tu extends Ap{indexBuffer;textEncoder;constructor(e,i,o,u,f){super(e,o,u,f??i.length),this.indexBuffer=i,this.indexBuffer=i,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const i=this.indexBuffer[e];return rh(this.dataBuffer,this.offsetBuffer[i],this.offsetBuffer[i+1])}}class vf extends Ap{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,i,o,u,f,p,y){super(e,o,u,y),this.indexBuffer=i,this.symbolOffsetBuffer=f,this.symbolTableBuffer=p,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(o,u,f){const p=[],y=new Array(u.length).fill(0);for(let x=1;x<u.length;x++)y[x]=y[x-1]+u[x-1];for(let x=0;x<f.length;x++)if(f[x]===255)p.push(f[++x]);else{const T=u[f[x]],E=y[f[x]];for(let C=0;C<T;C++)p.push(o[E+C])}return new Uint8Array(p)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const i=this.indexBuffer[e];return rh(this.decodedDictionary,this.offsetBuffer[i],this.offsetBuffer[i+1])}offsetToLengthBuffer(e){const i=new Uint32Array(e.length-1);let o=e[0];for(let u=1;u<e.length;u++){const f=e[u];i[u-1]=f-o,o=f}return i}}function xf(n,e,i,o,u,f){return i.type==="scalarType"?(function(p,y,x,T,E,C){let D=null,I=0;if(p===0)return null;if(C.nullable){const O=$r(y,x);I=O.numValues;const N=x.get(),G=ec(y,I,x);x.set(N+O.byteLength),D=new Xr(G,O.numValues)}const L=D??T;switch(E.physicalType){case 4:case 3:return(function(O,N,G,J,q){const $=$r(O,N),te=sl($,q,O,N),re=J.physicalType===3;if(te===or.FLAT){const we=tc(q)?pf(O,N,$,re,q):kr(O,N,$,re);return new lf(G.name,we,q)}if(te===or.SEQUENCE){const we=mm(O,N,$);return new mp(G.name,we[0],we[1],$.numRleValues)}{const we=vp(O,N,$,re);return new cf(G.name,we,q)}})(y,x,C,E,L);case 9:return(function(O,N,G,J,q){let $=null,te=null,re=null,we=null,Ne=null,ke=null,$e=null,at=null;for(let Ye=0;Ye<J;Ye++){const Fe=$r(N,G);if(Fe.byteLength!==0)switch(Fe.physicalStreamType){case vn.PRESENT:{const ze=ec(N,Fe.numValues,G);ke=new Xr(ze,Fe.numValues);break}case vn.OFFSET:te=q!=null||ke!=null?pf(N,G,Fe,!1,q??ke):kr(N,G,Fe,!1);break;case vn.LENGTH:{const ze=Jl(N,G,Fe);Hr.DICTIONARY===Fe.logicalStreamType.lengthType?$=ze:Hr.SYMBOL===Fe.logicalStreamType.lengthType?we=ze:$e=ze;break}case vn.DATA:{const ze=N.subarray(G.get(),G.get()+Fe.byteLength);G.add(Fe.byteLength);const _t=Fe.logicalStreamType.dictionaryType;ps.FSST===_t?Ne=ze:ps.SINGLE===_t||ps.SHARED===_t?re=ze:ps.NONE===_t&&(at=ze);break}}}return(function(Ye,Fe,ze,_t,pt,vt,ct){return Fe?new vf(Ye,ze,_t,pt,vt,Fe,ct):null})(O,Ne,te,$,re,we,q??ke)??(function(Ye,Fe,ze,_t,pt){return Fe?pt?new tu(Ye,ze,_t,Fe,pt):new tu(Ye,ze,_t,Fe):null})(O,re,te,$,q??ke)??(function(Ye,Fe,ze,_t,pt){if(!Fe||!ze)return null;if(_t)return pt?new tu(Ye,_t,Fe,ze,pt):new tu(Ye,_t,Fe,ze);if(pt&&pt.size()!==Fe.length-1){const vt=new Int32Array(pt.size());let ct=0;for(let Ct=0;Ct<pt.size();Ct++)vt[Ct]=pt.get(Ct)?ct++:0;return new tu(Ye,vt,Fe,ze,pt)}return pt?new Mm(Ye,Fe,ze,pt):new Mm(Ye,Fe,ze)})(O,$e,at,te,q??ke)})(C.name,y,x,C.nullable?p-1:p,D);case 0:return(function(O,N,G,J,q){const $=$r(O,N),te=$.numValues,re=N.get(),we=tc(q)?(function(ke,$e,at,Ye){const Fe=Ep(ke,Math.ceil($e/8),at),ze=new Xr(Fe,$e),_t=Ye.size(),pt=new Xr(new Uint8Array(_t),_t);let vt=0;for(let ct=0;ct<Ye.size();ct++){const Ct=!!Ye.get(ct)&&ze.get(vt++);pt.set(ct,Ct)}return pt.getBuffer()})(O,te,N,q):ec(O,te,N);N.set(re+$.byteLength);const Ne=new Xr(we,te);return new wm(G.name,Ne,q)})(y,x,C,0,L);case 6:case 5:return(function(O,N,G,J,q){const $=$r(O,N),te=sl($,J,O,N),re=q.physicalType===5;if(te===or.FLAT){const we=tc(J)?(function(Ne,ke,$e,at,Ye){return(function(Fe,ze,_t,pt){switch(ze.logicalLevelTechnique1){case Jt.DELTA:return ze.logicalLevelTechnique2===Jt.RLE&&(Fe=Ga(Fe,ze.runs,ze.numRleValues)),(function(vt,ct){const Ct=new BigInt64Array(vt.size());let gi=0;vt.get(0)?(Ct[0]=vt.get(0)?ct[0]>>1n^-(1n&ct[0]):0n,gi=1):Ct[0]=0n;let ni=1;for(;ni!=Ct.length;++ni)Ct[ni]=vt.get(ni)?Ct[ni-1]+(ct[gi]>>1n^-(1n&ct[gi++])):Ct[ni-1];return Ct})(pt,Fe);case Jt.RLE:return(function(vt,ct,Ct,gi){const ni=ct;return Ct?(function(xn,Yr,ur){const bn=new BigInt64Array(xn.size());let un=0;for(let Ri=0;Ri<ur;Ri++){const Rn=Number(Yr[Ri]);let Hn=Yr[Ri+ur];Hn=Hn>>1n^-(1n&Hn);for(let en=un;en<un+Rn;en++)xn.get(en)?bn[en]=Hn:(bn[en]=0n,un++);un+=Rn}return bn})(gi,vt,ni.runs):(function(xn,Yr,ur){const bn=new BigInt64Array(xn.size());let un=0;for(let Ri=0;Ri<ur;Ri++){const Rn=Number(Yr[Ri]),Hn=Yr[Ri+ur];for(let en=un;en<un+Rn;en++)xn.get(en)?bn[en]=Hn:(bn[en]=0n,un++);un+=Rn}return bn})(gi,vt,ni.runs)})(Fe,ze,_t,pt);case Jt.NONE:return Fe=_t?(function(vt,ct){const Ct=new BigInt64Array(vt.size());let gi=0,ni=0;for(;ni!=Ct.length;++ni)if(vt.get(ni)){const xn=ct[gi++];Ct[ni]=xn>>1n^-(1n&xn)}else Ct[ni]=0n;return Ct})(pt,Fe):(function(vt,ct){const Ct=new BigInt64Array(vt.size());let gi=0,ni=0;for(;ni!=Ct.length;++ni)Ct[ni]=vt.get(ni)?ct[gi++]:0n;return Ct})(pt,Fe),Fe;default:throw new Error("The specified Logical level technique is not supported")}})(hf(Ne,ke,$e.numValues),$e,at,Ye)})(O,N,$,re,J):_m(O,N,$,re);return new Jc(G.name,we,J)}if(te===or.SEQUENCE){const we=gm(O,N,$);return new xp(G.name,we[0],we[1],$.numRleValues)}{const we=ym(O,N,$,re);return new Mp(G.name,we,J)}})(y,x,C,L,E);case 7:return(function(O,N,G,J){const q=$r(O,N),$=tc(J)?(function(te,re,we,Ne){const ke=re.get(),$e=ke+Ne*Float32Array.BYTES_PER_ELEMENT,at=new Uint8Array(te.subarray(ke,$e)).buffer,Ye=new Float32Array(at);re.set($e);const Fe=we.size(),ze=new Float32Array(Fe);let _t=0;for(let pt=0;pt<Fe;pt++)ze[pt]=we.get(pt)?Ye[_t++]:0;return ze})(O,N,J,q.numValues):(function(te,re,we){const Ne=re.get(),ke=Ne+we*Float32Array.BYTES_PER_ELEMENT,$e=new Uint8Array(te.subarray(Ne,ke)).buffer,at=new Float32Array($e);return re.set(ke),at})(O,N,q.numValues);return new Tm(G.name,$,J)})(y,x,C,L);case 8:return(function(O,N,G,J){const q=$r(O,N),$=tc(J)?(function(te,re,we,Ne){const ke=re.get(),$e=ke+Ne*Float64Array.BYTES_PER_ELEMENT,at=new Uint8Array(te.subarray(ke,$e)).buffer,Ye=new Float64Array(at);re.set($e);const Fe=we.size(),ze=new Float64Array(Fe);let _t=0;for(let pt=0;pt<Fe;pt++)ze[pt]=we.get(pt)?Ye[_t++]:0;return ze})(O,N,J,q.numValues):(function(te,re,we){const Ne=re.get(),ke=Ne+we*Float64Array.BYTES_PER_ELEMENT,$e=new Uint8Array(te.subarray(Ne,ke)).buffer,at=new Float64Array($e);return re.set(ke),at})(O,N,q.numValues);return new sd(G.name,$,J)})(y,x,C,L);default:throw new Error(`The specified data type for the field is currently not supported: ${E}`)}})(o,n,e,u,i.scalarType,i):o!=1?null:(function(p,y,x,T){let E=null,C=null,D=null,I=null,L=!1;for(;!L;){const J=$r(p,y);switch(J.physicalStreamType){case vn.LENGTH:Hr.DICTIONARY===J.logicalStreamType.lengthType?E=Jl(p,y,J):D=Jl(p,y,J);break;case vn.DATA:ps.SINGLE===J.logicalStreamType.dictionaryType||ps.SHARED===J.logicalStreamType.dictionaryType?(C=p.subarray(y.get(),y.get()+J.byteLength),L=!0):I=p.subarray(y.get(),y.get()+J.byteLength),y.add(J.byteLength)}}const O=x.complexType.children,N=[];let G=0;for(const J of O){const q=Qn(p,y,1)[0];if(q==0)continue;const $=`${x.name}${J.name==="default"?"":":"+J.name}`;if(q!==2||J.type!=="scalarField"||J.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const te=$r(p,y),re=ec(p,te.numValues,y),we=$r(p,y),Ne=we.decompressedCount!==T?pf(p,y,we,!1,new Xr(re,te.numValues)):kr(p,y,we,!1);N[G++]=I?new vf($,Ne,E,C,D,I,new Xr(re,te.numValues)):new tu($,Ne,E,C,new Xr(re,te.numValues))}return N})(n,e,i,u)}function tc(n){return n instanceof Xr}function Em(n){if(n.name==="id")return!1;if(n.type==="scalarType"){const e=n.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(n.type==="complexType"){const e=n.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",n),!1}const Cp=new TextDecoder;function ol(n,e){const i=Qn(n,e,1)[0];if(i===0)return"";const o=e.get(),u=n.subarray(o,o+i);return e.add(i),Cp.decode(u)}function ll(n,e){const i=Qn(n,e,1)[0]>>>0,o=!!(4&i),u=!!(2&i),f=Qn(n,e,1)[0]>>>0,p={};if(1&i&&(p.nullable=!0),u){const y={};if(o?(y.type="logicalType",y.logicalType=f):(y.type="physicalType",y.physicalType=f),8&i){const x=Qn(n,e,1)[0]>>>0;y.children=new Array(x);for(let T=0;T<x;T++)y.children[T]=ll(n,e)}p.type="complexField",p.complexField=y}else{const y={};o?(y.type="logicalType",y.logicalType=f):(y.type="physicalType",y.physicalType=f),p.type="scalarField",p.scalarField=y}return p}function iu(n,e){const i=Qn(n,e,1)[0]>>>0,o=(function(u){switch(u){case 0:case 1:case 2:case 3:{const f={};f.nullable=!!(1&u),f.columnScope=0;const p={};return p.physicalType=u>1?6:4,p.type="physicalType",f.scalarType=p,f.type="scalarType",f}case 4:{const f={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:0};return f.type="complexType",f.complexType=p,f}case 30:{const f={nullable:!1,columnScope:0},p={type:"physicalType",physicalType:1};return f.type="complexType",f.complexType=p,f}default:return(function(f){let p=null;switch(f){case 10:case 11:p=0;break;case 12:case 13:p=1;break;case 14:case 15:p=2;break;case 16:case 17:p=3;break;case 18:case 19:p=4;break;case 20:case 21:p=5;break;case 22:case 23:p=6;break;case 24:case 25:p=7;break;case 26:case 27:p=8;break;case 28:case 29:p=9;break;default:return null}const y={};y.nullable=!!(1&f),y.columnScope=0;const x={type:"physicalType"};return x.physicalType=p,y.type="scalarType",y.scalarType=x,y})(u)}})(i);if(!o)throw new Error(`Unsupported column type code: ${i}`);if((function(u){return u>=10})(i)?o.name=ol(n,e):i>=0&&i<=3?o.name="id":i===4&&(o.name="geometry"),(function(u){return u===30})(i)){const u=Qn(n,e,1)[0]>>>0,f=o.complexType;f.children=new Array(u);for(let p=0;p<u;p++)f.children[p]=ll(n,e)}return o}function hd(n,e){const i={featureTables:[]},o={};o.name=ol(n,e);const u=Qn(n,e,1)[0]>>>0,f=Qn(n,e,1)[0]>>>0;o.columns=new Array(f);for(let p=0;p<f;p++)o.columns[p]=iu(n,e);return i.featureTables.push(o),[i,u]}function dd(n,e,i,o,u,f,p=!1){const y=e.scalarType.physicalType,x=sl(u,f,n,i);if(y===4)switch(x){case or.FLAT:{const T=kr(n,i,u,!1);return new lf(o,T,f)}case or.SEQUENCE:{const T=mm(n,i,u);return new mp(o,T[0],T[1],u.numRleValues)}case or.CONST:{const T=vp(n,i,u,!1);return new cf(o,T,f)}}else switch(x){case or.FLAT:{if(p){const E=(function(C,D,I,L){const O=(function(N,G,J){const q=new Float64Array(G);for(let $=0;$<G;$++)q[$]=ms(N,J);return q})(C,I.numValues,D);return(function(N,G,J){switch(G.logicalLevelTechnique1){case Jt.DELTA:return G.logicalLevelTechnique2===Jt.RLE&&(N=_p(N,G.runs,G.numRleValues)),(function(q){q[0]=q[0]%2==1?(q[0]+1)/-2:q[0]/2;const $=q.length/4*4;let te=1;if($>=4)for(;te<$-4;te+=4){const re=q[te],we=q[te+1],Ne=q[te+2],ke=q[te+3];q[te]=(re%2==1?(re+1)/-2:re/2)+q[te-1],q[te+1]=(we%2==1?(we+1)/-2:we/2)+q[te],q[te+2]=(Ne%2==1?(Ne+1)/-2:Ne/2)+q[te+1],q[te+3]=(ke%2==1?(ke+1)/-2:ke/2)+q[te+2]}for(;te!=q.length;++te)q[te]=(q[te]%2==1?(q[te]+1)/-2:q[te]/2)+q[te-1]})(N),N;case Jt.RLE:return(function(q,$,te){return _p(q,$.runs,$.numRleValues)})(N,G);case Jt.NONE:return N;default:throw new Error(`The specified Logical level technique is not supported: ${G.logicalLevelTechnique1}`)}})(O,I)})(n,i,u);return new sd(o,E,f)}const T=_m(n,i,u,!1);return new Jc(o,T,f)}case or.SEQUENCE:{const T=gm(n,i,u);return new xp(o,T[0],T[1],u.numRleValues)}case or.CONST:{const T=ym(n,i,u,!1);return new Mp(o,T,f)}}throw new Error("Vector type not supported for id column.")}class nu{constructor(e,i){var o;switch(this._featureData=e,this.properties=this._featureData.properties||{},(o=this._featureData.geometry)===null||o===void 0?void 0:o.type){case lr.POINT:case lr.MULTIPOINT:this.type=1;break;case lr.LINESTRING:case lr.MULTILINESTRING:this.type=2;break;case lr.POLYGON:case lr.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=i,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const i of this._featureData.geometry.coordinates){const o=[];for(const u of i)o.push(new ge(u.x,u.y));e.push(o)}return e}}class Km{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new nu(this.features[e],this.extent)}}class zp{constructor(e){this.layers={};const i=(function(o,u,f=!0){const p=new fm(0),y=[];for(;p.get()<o.length;){const x=Qn(o,p,1)[0]>>>0,T=p.get()+x;if(T>o.length)throw new Error(`Block overruns tile: ${T} > ${o.length}`);if(Qn(o,p,1)[0]>>>0!=1){p.set(T);continue}const E=hd(o,p),C=E[1],D=E[0].featureTables[0];let I=null,L=null;const O=[];let N=0;for(const J of D.columns){const q=J.name;if(q==="id"){let $=null;if(J.nullable){const re=$r(o,p),we=p.get(),Ne=ec(o,re.numValues,p);p.set(we+re.byteLength),$=new Xr(Ne,re.numValues)}const te=$r(o,p);N=te.decompressedCount,I=dd(o,J,p,q,te,$??N,f)}else if(q==="geometry"){const $=Qn(o,p,1)[0];if(N===0){const te=p.get();N=$r(o,p).decompressedCount,p.set(te)}L=cd(o,$,p,N)}else{const $=Em(J)?Qn(o,p,1)[0]:1;if($===0&&J.type==="scalarType")continue;const te=xf(o,p,J,$,N);if(te)if(Array.isArray(te))for(const re of te)O.push(re);else O.push(te)}}const G=new Wm(D.name,L,I,O,C);y.push(G),p.set(T)}return y})(new Uint8Array(e));this.layers=i.reduce(((o,u)=>Object.assign(Object.assign({},o),{[u.name]:new Km(u)})),{})}}class Us{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const i=new Us;return i.extend(e(new ge(this.minX,this.minY))),i.extend(e(new ge(this.maxX,this.minY))),i.extend(e(new ge(this.minX,this.maxY))),i.extend(e(new ge(this.maxX,this.maxY))),i}static fromPoints(e){const i=new Us;for(const o of e)i.extend(o);return i}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Jm{constructor(e,i){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=i,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],i=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const o of i){const u=[];for(const f of o)u.push(new ge(f[0],f[1]));e.push(u)}return e}}const ah="_geojsonTileLayer";function bf(n,e){e.writeVarintField(15,n.version||1),e.writeStringField(1,n.name||""),e.writeVarintField(5,n.extent||4096);const i={keys:[],values:[],keycache:{},valuecache:{}};for(let f=0;f<n.length;f++)i.feature=n.feature(f),e.writeMessage(2,Am,i);const o=i.keys;for(const f of o)e.writeStringField(3,f);const u=i.values;for(const f of u)e.writeMessage(4,oh,f)}function Am(n,e){if(!n.feature)return;const i=n.feature;i.id!==void 0&&e.writeVarintField(1,i.id),e.writeMessage(2,eg,n),e.writeVarintField(3,i.type),e.writeMessage(4,Cm,i)}function eg(n,e){for(const i in n.feature?.properties){let o=n.feature.properties[i],u=n.keycache[i];if(o===null)continue;u===void 0&&(n.keys.push(i),u=n.keys.length-1,n.keycache[i]=u),e.writeVarint(u),typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"&&(o=JSON.stringify(o));const f=typeof o+":"+o;let p=n.valuecache[f];p===void 0&&(n.values.push(o),p=n.values.length-1,n.valuecache[f]=p),e.writeVarint(p)}}function sh(n,e){return(e<<3)+(7&n)}function fd(n){return n<<1^n>>31}function Cm(n,e){const i=n.loadGeometry(),o=n.type;let u=0,f=0;for(const p of i){let y=1;o===1&&(y=p.length),e.writeVarint(sh(1,y));const x=o===3?p.length-1:p.length;for(let T=0;T<x;T++){T===1&&o!==1&&e.writeVarint(sh(2,x-1));const E=p[T].x-u,C=p[T].y-f;e.writeVarint(fd(E)),e.writeVarint(fd(C)),u+=E,f+=C}n.type===3&&e.writeVarint(sh(7,1))}}function oh(n,e){const i=typeof n;i==="string"?e.writeStringField(1,n):i==="boolean"?e.writeBooleanField(7,n):i==="number"&&(n%1!=0?e.writeDoubleField(3,n):n<0?e.writeSVarintField(6,n):e.writeVarintField(5,n))}class Dp{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new co(Re,16,0),this.grid3D=new co(Re,16,0),this.featureIndexArray=new R,this.promoteId=i}insert(e,i,o,u,f,p){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,u,f);const x=p?this.grid3D:this.grid;for(let T=0;T<i.length;T++){const E=i[T],C=[1/0,1/0,-1/0,-1/0];for(let D=0;D<E.length;D++){const I=E[D];C[0]=Math.min(C[0],I.x),C[1]=Math.min(C[1],I.y),C[2]=Math.max(C[2],I.x),C[3]=Math.max(C[3],I.y)}C[0]<Re&&C[1]<Re&&C[2]>=0&&C[3]>=0&&x.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new zi(new Yh(this.rawTileData)).layers:new zp(this.rawTileData).layers,this.sourceLayerCoder=new sf(this.vtLayers?Object.keys(this.vtLayers).sort():[ah])),this.vtLayers}query(e,i,o,u){this.loadVTLayers();const f=e.params,p=Re/e.tileSize/e.scale,y=jr(f.filter,f.globalState),x=e.queryGeometry,T=e.queryPadding*p,E=Us.fromPoints(x),C=this.grid.query(E.minX-T,E.minY-T,E.maxX+T,E.maxY+T),D=Us.fromPoints(e.cameraQueryGeometry).expandBy(T),I=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,((N,G,J,q)=>(function($,te,re,we,Ne){for(const $e of $)if(te<=$e.x&&re<=$e.y&&we>=$e.x&&Ne>=$e.y)return!0;const ke=[new ge(te,re),new ge(te,Ne),new ge(we,Ne),new ge(we,re)];if($.length>2){for(const $e of ke)if(Gu($,$e))return!0}for(let $e=0;$e<$.length-1;$e++)if(Op($[$e],$[$e+1],ke))return!0;return!1})(e.cameraQueryGeometry,N-T,G-T,J+T,q+T)));for(const N of I)C.push(N);C.sort(Tf);const L={};let O;for(let N=0;N<C.length;N++){const G=C[N];if(G===O)continue;O=G;const J=this.featureIndexArray.get(G);let q=null;this.loadMatchingFeature(L,J.bucketIndex,J.sourceLayerIndex,J.featureIndex,y,f.layers,f.availableImages,i,o,u,(($,te,re)=>(q||(q=ca($)),te.queryIntersectsFeature({queryGeometry:x,feature:$,featureState:re,geometry:q,zoom:this.z,transform:e.transform,pixelsToTileUnits:p,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return L}loadMatchingFeature(e,i,o,u,f,p,y,x,T,E,C){const D=this.bucketLayerIDs[i];if(p&&!D.some((N=>p.has(N))))return;const I=this.sourceLayerCoder.decode(o),L=this.vtLayers[I].feature(u);if(f.needGeometry){const N=yo(L,!0);if(!f.filter(new si(this.tileID.overscaledZ),N,this.tileID.canonical))return}else if(!f.filter(new si(this.tileID.overscaledZ),L))return;const O=this.getId(L,I);for(let N=0;N<D.length;N++){const G=D[N];if(p&&!p.has(G))continue;const J=x[G];if(!J)continue;let q={};O&&E&&(q=E.getState(J.sourceLayer||ah,O));const $=ii({},T[G]);$.paint=wf($.paint,J.paint,L,q,y),$.layout=wf($.layout,J.layout,L,q,y);const te=!C||C(L,J,q);if(!te)continue;const re=new of(L,this.z,this.x,this.y,O);re.layer=$;let we=e[G];we===void 0&&(we=e[G]=[]),we.push({featureIndex:u,feature:re,intersectionZ:te})}}lookupSymbolFeatures(e,i,o,u,f,p,y,x){const T={};this.loadVTLayers();const E=jr(f.filterSpec,f.globalState);for(const C of e)this.loadMatchingFeature(T,o,u,C,E,p,y,x,i);return T}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){var o;let u=e.id;return this.promoteId&&(u=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof u=="boolean"&&(u=Number(u)),u===void 0&&(!((o=e.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(u=Number(e.properties.cluster_id))),u}}function wf(n,e,i,o,u){return Jn(n,((f,p)=>{const y=e instanceof Zo?e.get(p):null;return y&&y.evaluate?y.evaluate(i,o,u):y}))}function Tf(n,e){return e-n}function Ip(n,e,i,o,u){const f=[];for(let p=0;p<n.length;p++){const y=n[p];let x;for(let T=0;T<y.length-1;T++){let E=y[T],C=y[T+1];E.x<e&&C.x<e||(E.x<e?E=new ge(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x<e&&(C=new ge(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y<i&&C.y<i||(E.y<i?E=new ge(E.x+(i-E.y)/(C.y-E.y)*(C.x-E.x),i)._round():C.y<i&&(C=new ge(E.x+(i-E.y)/(C.y-E.y)*(C.x-E.x),i)._round()),E.x>=o&&C.x>=o||(E.x>=o?E=new ge(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x>=o&&(C=new ge(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y>=u&&C.y>=u||(E.y>=u?E=new ge(E.x+(u-E.y)/(C.y-E.y)*(C.x-E.x),u)._round():C.y>=u&&(C=new ge(E.x+(u-E.y)/(C.y-E.y)*(C.x-E.x),u)._round()),x&&E.equals(x[x.length-1])||(x=[E],f.push(x)),x.push(C)))))}}return f}function zm(n,e,i,o,u){switch(e){case 1:return(function(f,p,y,x){const T=[];for(const E of f)for(const C of E){const D=x===0?C.x:C.y;D>=p&&D<=y&&T.push([C])}return T})(n,i,o,u);case 2:return r(n,i,o,u,!1);case 3:return r(n,i,o,u,!0)}return[]}function Sf(n,e,i,o,u){const f=o===0?s:c;let p=[];const y=[];for(let E=0;E<n.length-1;E++){const C=n[E],D=n[E+1],I=o===0?C.x:C.y,L=o===0?D.x:D.y;let O=!1;I<e?L>e&&p.push(f(C,D,e)):I>i?L<i&&p.push(f(C,D,i)):p.push(C),L<e&&I>=e&&(p.push(f(C,D,e)),O=!0),L>i&&I<=i&&(p.push(f(C,D,i)),O=!0),!u&&O&&(y.push(p),p=[])}const x=n.length-1,T=o===0?n[x].x:n[x].y;return T>=e&&T<=i&&p.push(n[x]),u&&p.length>0&&!p[0].equals(p[p.length-1])&&p.push(new ge(p[0].x,p[0].y)),p.length>0&&y.push(p),y}function r(n,e,i,o,u){const f=[];for(const p of n){const y=Sf(p,e,i,o,u);y.length>0&&f.push(...y)}return f}function s(n,e,i){return new ge(i,n.y+(i-n.x)/(e.x-n.x)*(e.y-n.y))}function c(n,e,i){return new ge(n.x+(i-n.y)/(e.y-n.y)*(e.x-n.x),i)}lt("FeatureIndex",Dp,{omit:["rawTileData","sourceLayerCoder"]});class g extends ge{constructor(e,i,o,u){super(e,i),this.angle=o,u!==void 0&&(this.segment=u)}clone(){return new g(this.x,this.y,this.angle,this.segment)}}function b(n,e,i,o,u){if(e.segment===void 0||i===0)return!0;let f=e,p=e.segment+1,y=0;for(;y>-i/2;){if(p--,p<0)return!1;y-=n[p].dist(f),f=n[p]}y+=n[p].dist(n[p+1]),p++;const x=[];let T=0;for(;y<i/2;){const E=n[p],C=n[p+1];if(!C)return!1;let D=n[p-1].angleTo(E)-E.angleTo(C);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:D}),T+=D;y-x[0].distance>o;)T-=x.shift().angleDelta;if(T>u)return!1;p++,y+=E.dist(C)}return!0}function M(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function B(n,e,i){return n?.6*e*i:0}function Z(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function ce(n,e,i,o,u,f){const p=B(i,u,f),y=Z(i,o)*f;let x=0;const T=M(n)/2;for(let E=0;E<n.length-1;E++){const C=n[E],D=n[E+1],I=C.dist(D);if(x+I>T){const L=(T-x)/I,O=Yi.number(C.x,D.x,L),N=Yi.number(C.y,D.y,L),G=new g(O,N,D.angleTo(C),E);return G._round(),!p||b(n,G,y,p,e)?G:void 0}x+=I}}function Ie(n,e,i,o,u,f,p,y,x){const T=B(o,f,p),E=Z(o,u),C=E*p,D=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-C<e/4&&(e=C+e/4),Ge(n,D?e/2*y%e:(E/2+2*f)*p*y%e,e,T,i,C,D,!1,x)}function Ge(n,e,i,o,u,f,p,y,x){const T=f/2,E=M(n);let C=0,D=e-i,I=[];for(let L=0;L<n.length-1;L++){const O=n[L],N=n[L+1],G=O.dist(N),J=N.angleTo(O);for(;D+i<C+G;){D+=i;const q=(D-C)/G,$=Yi.number(O.x,N.x,q),te=Yi.number(O.y,N.y,q);if($>=0&&$<x&&te>=0&&te<x&&D-T>=0&&D+T<=E){const re=new g($,te,J,L);re._round(),o&&!b(n,re,f,o,u)||I.push(re)}}C+=G}return y||I.length||p||(I=Ge(n,C/2,i,o,u,f,p,!0,x)),I}function We(n,e,i,o){const u=[],f=n.image,p=f.pixelRatio,y=f.paddedRect.w-2,x=f.paddedRect.h-2;let T={x1:n.left,y1:n.top,x2:n.right,y2:n.bottom};const E=f.stretchX||[[0,y]],C=f.stretchY||[[0,x]],D=(ze,_t)=>ze+_t[1]-_t[0],I=E.reduce(D,0),L=C.reduce(D,0),O=y-I,N=x-L;let G=0,J=I,q=0,$=L,te=0,re=O,we=0,Ne=N;if(f.content&&o){const ze=f.content,_t=ze[2]-ze[0],pt=ze[3]-ze[1];(f.textFitWidth||f.textFitHeight)&&(T=Kd(n)),G=Pe(E,0,ze[0]),q=Pe(C,0,ze[1]),J=Pe(E,ze[0],ze[2]),$=Pe(C,ze[1],ze[3]),te=ze[0]-G,we=ze[1]-q,re=_t-J,Ne=pt-$}const ke=T.x1,$e=T.y1,at=T.x2-ke,Ye=T.y2-$e,Fe=(ze,_t,pt,vt)=>{const ct=At(ze.stretch-G,J,at,ke),Ct=Nt(ze.fixed-te,re,ze.stretch,I),gi=At(_t.stretch-q,$,Ye,$e),ni=Nt(_t.fixed-we,Ne,_t.stretch,L),xn=At(pt.stretch-G,J,at,ke),Yr=Nt(pt.fixed-te,re,pt.stretch,I),ur=At(vt.stretch-q,$,Ye,$e),bn=Nt(vt.fixed-we,Ne,vt.stretch,L),un=new ge(ct,gi),Ri=new ge(xn,gi),Rn=new ge(xn,ur),Hn=new ge(ct,ur),en=new ge(Ct/p,ni/p),qa=new ge(Yr/p,bn/p),Wr=e*Math.PI/180;if(Wr){const br=Math.sin(Wr),An=Math.cos(Wr),cr=[An,-br,br,An];un._matMult(cr),Ri._matMult(cr),Hn._matMult(cr),Rn._matMult(cr)}const Za=ze.stretch+ze.fixed,To=_t.stretch+_t.fixed;return{tl:un,tr:Ri,bl:Hn,br:Rn,tex:{x:f.paddedRect.x+1+Za,y:f.paddedRect.y+1+To,w:pt.stretch+pt.fixed-Za,h:vt.stretch+vt.fixed-To},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:en,pixelOffsetBR:qa,minFontScaleX:re/p/at,minFontScaleY:Ne/p/Ye,isSDF:i}};if(o&&(f.stretchX||f.stretchY)){const ze=Oe(E,O,I),_t=Oe(C,N,L);for(let pt=0;pt<ze.length-1;pt++){const vt=ze[pt],ct=ze[pt+1];for(let Ct=0;Ct<_t.length-1;Ct++)u.push(Fe(vt,_t[Ct],ct,_t[Ct+1]))}}else u.push(Fe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return u}function Pe(n,e,i){let o=0;for(const u of n)o+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return o}function Oe(n,e,i){const o=[{fixed:-1,stretch:0}];for(const[u,f]of n){const p=o[o.length-1];o.push({fixed:u-p.stretch,stretch:p.stretch}),o.push({fixed:u-p.stretch,stretch:p.stretch+(f-u)})}return o.push({fixed:e+1,stretch:i}),o}function At(n,e,i,o){return n/e*i+o}function Nt(n,e,i,o){return n-e*i/o}lt("Anchor",g);class ji{constructor(e,i,o,u,f,p,y,x,T,E){var C;if(this.boxStartIndex=e.length,T){let D=p.top,I=p.bottom;const L=p.collisionPadding;L&&(D-=L[1],I+=L[3]);let O=I-D;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{const D=!((C=p.image)===null||C===void 0)&&C.content&&(p.image.textFitWidth||p.image.textFitHeight)?Kd(p):{x1:p.left,y1:p.top,x2:p.right,y2:p.bottom};D.y1=D.y1*y-x[0],D.y2=D.y2*y+x[2],D.x1=D.x1*y-x[3],D.x2=D.x2*y+x[1];const I=p.collisionPadding;if(I&&(D.x1-=I[0]*y,D.y1-=I[1]*y,D.x2+=I[2]*y,D.y2+=I[3]*y),E){const L=new ge(D.x1,D.y1),O=new ge(D.x2,D.y1),N=new ge(D.x1,D.y2),G=new ge(D.x2,D.y2),J=E*Math.PI/180;L._rotate(J),O._rotate(J),N._rotate(J),G._rotate(J),D.x1=Math.min(L.x,O.x,N.x,G.x),D.x2=Math.max(L.x,O.x,N.x,G.x),D.y1=Math.min(L.y,O.y,N.y,G.y),D.y2=Math.max(L.y,O.y,N.y,G.y)}e.emplaceBack(i.x,i.y,D.x1,D.y1,D.x2,D.y2,o,u,f)}this.boxEndIndex=e.length}}class ye{constructor(e=[],i=(o,u)=>o<u?-1:o>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,u=i[e];for(;e>0;){const f=e-1>>1,p=i[f];if(o(u,p)>=0)break;i[e]=p,e=f}i[e]=u}_down(e){const{data:i,compare:o}=this,u=this.length>>1,f=i[e];for(;e<u;){let p=1+(e<<1);const y=p+1;if(y<this.length&&o(i[y],i[p])<0&&(p=y),o(i[p],f)>=0)break;i[e]=i[p],e=p}i[e]=f}}function pe(n,e=1,i=!1){const o=Us.fromPoints(n[0]),u=Math.min(o.width(),o.height());let f=u/2;const p=new ye([],De),{minX:y,minY:x,maxX:T,maxY:E}=o;if(u===0)return new ge(y,x);for(let I=y;I<T;I+=u)for(let L=x;L<E;L+=u)p.push(new Ze(I+f,L+f,f,n));let C=(function(I){let L=0,O=0,N=0;const G=I[0];for(let J=0,q=G.length,$=q-1;J<q;$=J++){const te=G[J],re=G[$],we=te.x*re.y-re.x*te.y;O+=(te.x+re.x)*we,N+=(te.y+re.y)*we,L+=3*we}return new Ze(O/L,N/L,0,I)})(n),D=p.length;for(;p.length;){const I=p.pop();(I.d>C.d||!C.d)&&(C=I,i&&console.log("found best %d after %d probes",Math.round(1e4*I.d)/1e4,D)),I.max-C.d<=e||(f=I.h/2,p.push(new Ze(I.p.x-f,I.p.y-f,f,n)),p.push(new Ze(I.p.x+f,I.p.y-f,f,n)),p.push(new Ze(I.p.x-f,I.p.y+f,f,n)),p.push(new Ze(I.p.x+f,I.p.y+f,f,n)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${C.d}`)),C.p}function De(n,e){return e.max-n.max}function Ze(n,e,i,o){this.p=new ge(n,e),this.h=i,this.d=(function(u,f){let p=!1,y=1/0;for(let x=0;x<f.length;x++){const T=f[x];for(let E=0,C=T.length,D=C-1;E<C;D=E++){const I=T[E],L=T[D];I.y>u.y!=L.y>u.y&&u.x<(L.x-I.x)*(u.y-I.y)/(L.y-I.y)+I.x&&(p=!p),y=Math.min(y,vr(u,I,L))}}return(p?1:-1)*Math.sqrt(y)})(this.p,o),this.max=this.d+this.h*Math.SQRT2}var St;k.aQ=void 0,(St=k.aQ||(k.aQ={}))[St.center=1]="center",St[St.left=2]="left",St[St.right=3]="right",St[St.top=4]="top",St[St.bottom=5]="bottom",St[St["top-left"]=6]="top-left",St[St["top-right"]=7]="top-right",St[St["bottom-left"]=8]="bottom-left",St[St["bottom-right"]=9]="bottom-right";const bi=Number.POSITIVE_INFINITY;function Rt(n,e){return e[1]!==bi?(function(i,o,u){let f=0,p=0;switch(o=Math.abs(o),u=Math.abs(u),i){case"top-right":case"top-left":case"top":p=u-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-u}switch(i){case"top-right":case"bottom-right":case"right":f=-o;break;case"top-left":case"bottom-left":case"left":f=o}return[f,p]})(n,e[0],e[1]):(function(i,o){let u=0,f=0;o<0&&(o=0);const p=o/Math.SQRT2;switch(i){case"top-right":case"top-left":f=p-7;break;case"bottom-right":case"bottom-left":f=7-p;break;case"bottom":f=7-o;break;case"top":f=o-7}switch(i){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=o;break;case"right":u=-o}return[u,f]})(n,e[0])}function ei(n,e,i){var o;const u=n.layout,f=(o=u.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(e,{},i);if(f){const y=f.values,x=[];for(let T=0;T<y.length;T+=2){const E=x[T]=y[T],C=y[T+1].map((D=>D*Di));E.startsWith("top")?C[1]-=7:E.startsWith("bottom")&&(C[1]+=7),x[T+1]=C}return new mn(x)}const p=u.get("text-variable-anchor");if(p){let y;y=n._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[u.get("text-radial-offset").evaluate(e,{},i)*Di,bi]:u.get("text-offset").evaluate(e,{},i).map((T=>T*Di));const x=[];for(const T of p)x.push(T,Rt(T,y));return new mn(x)}return null}function di(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pi(n,e,i,o,u,f,p,y,x,T,E,C){let D=f.textMaxSize.evaluate(e,{});D===void 0&&(D=p);const I=n.layers[0].layout,L=I.get("icon-offset").evaluate(e,{},E),O=Dm(i.horizontal),N=p/24,G=n.tilePixelRatio*N,J=n.tilePixelRatio*D/24,q=n.tilePixelRatio*y,$=n.tilePixelRatio*I.get("symbol-spacing"),te=I.get("text-padding")*n.tilePixelRatio,re=(function(pt,vt,ct,Ct=1){const gi=pt.get("icon-padding").evaluate(vt,{},ct),ni=gi&&gi.values;return[ni[0]*Ct,ni[1]*Ct,ni[2]*Ct,ni[3]*Ct]})(I,e,E,n.tilePixelRatio),we=I.get("text-max-angle")/180*Math.PI,Ne=I.get("text-rotation-alignment")!=="viewport"&&I.get("symbol-placement")!=="point",ke=I.get("icon-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",$e=I.get("symbol-placement"),at=$/2,Ye=I.get("icon-text-fit");let Fe;o&&Ye!=="none"&&(n.allowVerticalPlacement&&i.vertical&&(Fe=Qh(o,i.vertical,Ye,I.get("icon-text-fit-padding"),L,N)),O&&(o=Qh(o,O,Ye,I.get("icon-text-fit-padding"),L,N)));const ze=E?C.line.getGranularityForZoomLevel(E.z):1,_t=(pt,vt)=>{vt.x<0||vt.x>=Re||vt.y<0||vt.y>=Re||(function(ct,Ct,gi,ni,xn,Yr,ur,bn,un,Ri,Rn,Hn,en,qa,Wr,Za,To,br,An,cr,Ln,wr,ic,cl,Lp){const lh=ct.addToLineVertexArray(Ct,gi);let pd,Mf,Ef,Af,Sg=0,Mg=0,Eg=0,Ag=0,lg=-1,ug=-1;const nc={};let Cg=Gi("");if(ct.allowVerticalPlacement&&ni.vertical){const pa=bn.layout.get("text-rotate").evaluate(Ln,{},cl)+90;Ef=new ji(un,Ct,Ri,Rn,Hn,ni.vertical,en,qa,Wr,pa),ur&&(Af=new ji(un,Ct,Ri,Rn,Hn,ur,To,br,Wr,pa))}if(xn){const pa=bn.layout.get("icon-rotate").evaluate(Ln,{}),Gs=bn.layout.get("icon-text-fit")!=="none",md=We(xn,pa,ic,Gs),dl=ur?We(ur,pa,ic,Gs):void 0;Mf=new ji(un,Ct,Ri,Rn,Hn,xn,To,br,!1,pa),Sg=4*md.length;const gd=ct.iconSizeData;let ru=null;gd.kind==="source"?(ru=[Ns*bn.layout.get("icon-size").evaluate(Ln,{})],ru[0]>ha&&tn(`${ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):gd.kind==="composite"&&(ru=[Ns*wr.compositeIconSizes[0].evaluate(Ln,{},cl),Ns*wr.compositeIconSizes[1].evaluate(Ln,{},cl)],(ru[0]>ha||ru[1]>ha)&&tn(`${ct.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ct.addSymbols(ct.icon,md,ru,cr,An,Ln,k.aA.none,Ct,lh.lineStartIndex,lh.lineLength,-1,cl),lg=ct.icon.placedSymbolArray.length-1,dl&&(Mg=4*dl.length,ct.addSymbols(ct.icon,dl,ru,cr,An,Ln,k.aA.vertical,Ct,lh.lineStartIndex,lh.lineLength,-1,cl),ug=ct.icon.placedSymbolArray.length-1)}const zg=Object.keys(ni.horizontal);for(const pa of zg){const Gs=ni.horizontal[pa];if(!pd){Cg=Gi(Gs.text);const dl=bn.layout.get("text-rotate").evaluate(Ln,{},cl);pd=new ji(un,Ct,Ri,Rn,Hn,Gs,en,qa,Wr,dl)}const md=Gs.positionedLines.length===1;if(Eg+=ul(ct,Ct,Gs,Yr,bn,Wr,Ln,Za,lh,ni.vertical?k.aA.horizontal:k.aA.horizontalOnly,md?zg:[pa],nc,lg,wr,cl),md)break}ni.vertical&&(Ag+=ul(ct,Ct,ni.vertical,Yr,bn,Wr,Ln,Za,lh,k.aA.vertical,["vertical"],nc,ug,wr,cl));const e_=pd?pd.boxStartIndex:ct.collisionBoxArray.length,t_=pd?pd.boxEndIndex:ct.collisionBoxArray.length,i_=Ef?Ef.boxStartIndex:ct.collisionBoxArray.length,n_=Ef?Ef.boxEndIndex:ct.collisionBoxArray.length,r_=Mf?Mf.boxStartIndex:ct.collisionBoxArray.length,a_=Mf?Mf.boxEndIndex:ct.collisionBoxArray.length,s_=Af?Af.boxStartIndex:ct.collisionBoxArray.length,o_=Af?Af.boxEndIndex:ct.collisionBoxArray.length;let hl=-1;const Pm=(pa,Gs)=>pa&&pa.circleDiameter?Math.max(pa.circleDiameter,Gs):Gs;hl=Pm(pd,hl),hl=Pm(Ef,hl),hl=Pm(Mf,hl),hl=Pm(Af,hl);const Dg=hl>-1?1:0;Dg&&(hl*=Lp/Di),ct.glyphOffsetArray.length>=Wl.MAX_GLYPHS&&tn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ln.sortKey!==void 0&&ct.addToSortKeyRanges(ct.symbolInstances.length,Ln.sortKey);const l_=ei(bn,Ln,cl),[u_,c_]=(function(pa,Gs){const md=pa.length,dl=Gs?.values;if(dl?.length>0)for(let gd=0;gd<dl.length;gd+=2){const ru=dl[gd+1];pa.emplaceBack(k.aQ[dl[gd]],ru[0],ru[1])}return[md,pa.length]})(ct.textAnchorOffsets,l_);ct.symbolInstances.emplaceBack(Ct.x,Ct.y,nc.right>=0?nc.right:-1,nc.center>=0?nc.center:-1,nc.left>=0?nc.left:-1,nc.vertical||-1,lg,ug,Cg,e_,t_,i_,n_,r_,a_,s_,o_,Ri,Eg,Ag,Sg,Mg,Dg,0,en,hl,u_,c_)})(n,vt,pt,i,o,u,Fe,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,G,[te,te,te,te],Ne,x,q,re,ke,L,e,f,T,E,p)};if($e==="line")for(const pt of Ip(e.geometry,0,0,Re,Re)){const vt=Na(pt,ze),ct=Ie(vt,$,we,i.vertical||O,o,24,J,n.overscaling,Re);for(const Ct of ct)O&&Kg(n,O.text,at,Ct)||_t(vt,Ct)}else if($e==="line-center"){for(const pt of e.geometry)if(pt.length>1){const vt=Na(pt,ze),ct=ce(vt,we,i.vertical||O,o,24,J);ct&&_t(vt,ct)}}else if(e.type==="Polygon")for(const pt of vu(e.geometry,0)){const vt=pe(pt,16);_t(Na(pt[0],ze,!0),new g(vt.x,vt.y,0))}else if(e.type==="LineString")for(const pt of e.geometry){const vt=Na(pt,ze);_t(vt,new g(vt[0].x,vt[0].y,0))}else if(e.type==="Point")for(const pt of e.geometry)for(const vt of pt)_t([vt],new g(vt.x,vt.y,0))}function ul(n,e,i,o,u,f,p,y,x,T,E,C,D,I,L){const O=(function(J,q,$,te,re,we,Ne,ke){const $e=te.layout.get("text-rotate").evaluate(we,{})*Math.PI/180,at=[];for(const Ye of q.positionedLines)for(const Fe of Ye.positionedGlyphs){if(!Fe.rect)continue;const ze=Fe.rect||{};let _t=4,pt=!0,vt=1,ct=0;const Ct=(re||ke)&&Fe.vertical,gi=Fe.metrics.advance*Fe.scale/2;if(ke&&q.verticalizable&&(ct=Ye.lineOffset/2-(Fe.imageName?-(Di-Fe.metrics.width*Fe.scale)/2:(Fe.scale-1)*Di)),Fe.imageName){const br=Ne[Fe.imageName];pt=br.sdf,vt=br.pixelRatio,_t=1/vt}const ni=re?[Fe.x+gi,Fe.y]:[0,0];let xn=re?[0,0]:[Fe.x+gi+$[0],Fe.y+$[1]-ct],Yr=[0,0];Ct&&(Yr=xn,xn=[0,0]);const ur=Fe.metrics.isDoubleResolution?2:1,bn=(Fe.metrics.left-_t)*Fe.scale-gi+xn[0],un=(-Fe.metrics.top-_t)*Fe.scale+xn[1],Ri=bn+ze.w/ur*Fe.scale/vt,Rn=un+ze.h/ur*Fe.scale/vt,Hn=new ge(bn,un),en=new ge(Ri,un),qa=new ge(bn,Rn),Wr=new ge(Ri,Rn);if(Ct){const br=new ge(-gi,gi- -17),An=-Math.PI/2,cr=12-gi,Ln=new ge(22-cr,-(Fe.imageName?cr:0)),wr=new ge(...Yr);Hn._rotateAround(An,br)._add(Ln)._add(wr),en._rotateAround(An,br)._add(Ln)._add(wr),qa._rotateAround(An,br)._add(Ln)._add(wr),Wr._rotateAround(An,br)._add(Ln)._add(wr)}if($e){const br=Math.sin($e),An=Math.cos($e),cr=[An,-br,br,An];Hn._matMult(cr),en._matMult(cr),qa._matMult(cr),Wr._matMult(cr)}const Za=new ge(0,0),To=new ge(0,0);at.push({tl:Hn,tr:en,bl:qa,br:Wr,tex:ze,writingMode:q.writingMode,glyphOffset:ni,sectionIndex:Fe.sectionIndex,isSDF:pt,pixelOffsetTL:Za,pixelOffsetBR:To,minFontScaleX:0,minFontScaleY:0})}return at})(0,i,y,u,f,p,o,n.allowVerticalPlacement),N=n.textSizeData;let G=null;N.kind==="source"?(G=[Ns*u.layout.get("text-size").evaluate(p,{})],G[0]>ha&&tn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):N.kind==="composite"&&(G=[Ns*I.compositeTextSizes[0].evaluate(p,{},L),Ns*I.compositeTextSizes[1].evaluate(p,{},L)],(G[0]>ha||G[1]>ha)&&tn(`${n.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),n.addSymbols(n.text,O,G,y,f,p,T,e,x.lineStartIndex,x.lineLength,D,L);for(const J of E)C[J]=n.text.placedSymbolArray.length-1;return 4*O.length}function Dm(n){for(const e in n)return n[e];return null}function Kg(n,e,i,o){const u=n.compareText;if(e in u){const f=u[e];for(let p=f.length-1;p>=0;p--)if(o.dist(f[p])<i)return!0}else u[e]=[];return u[e].push(o),!1}const bg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class tg{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=o>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=bg[15&o];if(!f)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new tg(y,p,f,e)}constructor(e,i=64,o=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=bg.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+y+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return ig(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:p,nodeSize:y}=this,x=[0,f.length-1,0],T=[];for(;x.length;){const E=x.pop()||0,C=x.pop()||0,D=x.pop()||0;if(C-D<=y){for(let N=D;N<=C;N++){const G=p[2*N],J=p[2*N+1];G>=e&&G<=o&&J>=i&&J<=u&&T.push(f[N])}continue}const I=D+C>>1,L=p[2*I],O=p[2*I+1];L>=e&&L<=o&&O>=i&&O<=u&&T.push(f[I]),(E===0?e<=L:i<=O)&&(x.push(D),x.push(I-1),x.push(1-E)),(E===0?o>=L:u>=O)&&(x.push(I+1),x.push(C),x.push(1-E))}return T}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:p}=this,y=[0,u.length-1,0],x=[],T=o*o;for(;y.length;){const E=y.pop()||0,C=y.pop()||0,D=y.pop()||0;if(C-D<=p){for(let N=D;N<=C;N++)Tg(f[2*N],f[2*N+1],e,i)<=T&&x.push(u[N]);continue}const I=D+C>>1,L=f[2*I],O=f[2*I+1];Tg(L,O,e,i)<=T&&x.push(u[I]),(E===0?e-o<=L:i-o<=O)&&(y.push(D),y.push(I-1),y.push(1-E)),(E===0?e+o>=L:i+o>=O)&&(y.push(I+1),y.push(C),y.push(1-E))}return x}}function ig(n,e,i,o,u,f){if(u-o<=i)return;const p=o+u>>1;wg(n,e,p,o,u,f),ig(n,e,i,o,p-1,1-f),ig(n,e,i,p+1,u,1-f)}function wg(n,e,i,o,u,f){for(;u>o;){if(u-o>600){const T=u-o+1,E=i-o+1,C=Math.log(T),D=.5*Math.exp(2*C/3),I=.5*Math.sqrt(C*D*(T-D)/T)*(E-T/2<0?-1:1);wg(n,e,i,Math.max(o,Math.floor(i-E*D/T+I)),Math.min(u,Math.floor(i+(T-E)*D/T+I)),f)}const p=e[2*i+f];let y=o,x=u;for(Pp(n,e,o,i),e[2*u+f]>p&&Pp(n,e,o,u);y<x;){for(Pp(n,e,y,x),y++,x--;e[2*y+f]<p;)y++;for(;e[2*x+f]>p;)x--}e[2*o+f]===p?Pp(n,e,o,x):(x++,Pp(n,e,x,u)),x<=i&&(o=x+1),i<=x&&(u=x-1)}}function Pp(n,e,i,o){ng(n,i,o),ng(e,2*i,2*o),ng(e,2*i+1,2*o+1)}function ng(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function Tg(n,e,i,o){const u=n-i,f=e-o;return u*u+f*f}var rg;k.cI=void 0,(rg=k.cI||(k.cI={})).create="create",rg.load="load",rg.fullLoad="fullLoad";let Im=null,Rp=[];const ag=1e3/60,sg="loadTime",og="fullLoadTime",Jg={mark(n){performance.mark(n)},frame(n){const e=n;Im!=null&&Rp.push(e-Im),Im=e},clearMetrics(){Im=null,Rp=[],performance.clearMeasures(sg),performance.clearMeasures(og);for(const n in k.cI)performance.clearMarks(k.cI[n])},getPerformanceMetrics(){performance.measure(sg,k.cI.create,k.cI.load),performance.measure(og,k.cI.create,k.cI.fullLoad);const n=performance.getEntriesByName(sg)[0].duration,e=performance.getEntriesByName(og)[0].duration,i=Rp.length,o=1/(Rp.reduce(((f,p)=>f+p),0)/i/1e3),u=Rp.filter((f=>f>ag)).reduce(((f,p)=>f+(p-ag)/ag),0);return{loadTime:n,fullLoadTime:e,fps:o,percentDroppedFrames:u/(i+u)*100,totalFrames:i}}};k.$=me,k.A=dt,k.B=Ru,k.C=Ll,k.D=Tt,k.E=ui,k.F=function([n,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(i),y:n*Math.sin(e)*Math.sin(i),z:n*Math.cos(i)}},k.G=Yi,k.H=si,k.I=$c,k.J=Pu,k.K=function(n){if(fn==null){const e=n.navigator?n.navigator.userAgent:null;fn=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return fn},k.L=class{constructor(n,e){this.target=n,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new lm((()=>this.process())),this.subscription=pl(this.target,"message",(i=>this.receive(i)),!1),this.globalScope=ma(self)?n:window}registerMessageHandler(n,e){this.messageHandlers[n]=e}unregisterMessageHandler(n){delete this.messageHandlers[n]}sendAsync(n,e){return new Promise(((i,o)=>{const u=Math.round(1e18*Math.random()).toString(36).substring(0,10),f=e?pl(e.signal,"abort",(()=>{f?.unsubscribe(),delete this.resolveRejects[u];const x={id:u,type:"<cancel>",origin:location.origin,targetMapId:n.targetMapId,sourceMapId:this.mapId};this.target.postMessage(x)}),fi):null;this.resolveRejects[u]={resolve:x=>{f?.unsubscribe(),i(x)},reject:x=>{f?.unsubscribe(),o(x)}};const p=[],y=Object.assign(Object.assign({},n),{id:u,sourceMapId:this.mapId,origin:location.origin,data:fo(n.data,p)});this.target.postMessage(y,{transfer:p})}))}receive(n){const e=n.data,i=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[i];const o=this.abortControllers[i];return delete this.abortControllers[i],void(o&&o.abort())}if(ma(self)||e.mustQueue)return this.tasks[i]=e,this.taskQueue.push(i),void this.invoker.trigger();this.processTask(i,e)}}process(){if(this.taskQueue.length===0)return;const n=this.taskQueue.shift(),e=this.tasks[n];delete this.tasks[n],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(n,e)}processTask(n,e){return d(this,void 0,void 0,(function*(){if(e.type==="<response>"){const u=this.resolveRejects[n];return delete this.resolveRejects[n],u?void(e.error?u.reject(kl(e.error)):u.resolve(kl(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(n,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const i=kl(e.data),o=new AbortController;this.abortControllers[n]=o;try{const u=yield this.messageHandlers[e.type](e.sourceMapId,i,o);this.completeTask(n,null,u)}catch(u){this.completeTask(n,u)}}))}completeTask(n,e,i){const o=[];delete this.abortControllers[n];const u={id:n,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?fo(e):null,data:fo(i,o)};this.target.postMessage(u,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},k.M=_e,k.N=function(){var n=new dt(16);return dt!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},k.O=function(n,e,i){var o,u,f,p,y,x,T,E,C,D,I,L,O=i[0],N=i[1],G=i[2];return e===n?(n[12]=e[0]*O+e[4]*N+e[8]*G+e[12],n[13]=e[1]*O+e[5]*N+e[9]*G+e[13],n[14]=e[2]*O+e[6]*N+e[10]*G+e[14],n[15]=e[3]*O+e[7]*N+e[11]*G+e[15]):(u=e[1],f=e[2],p=e[3],y=e[4],x=e[5],T=e[6],E=e[7],C=e[8],D=e[9],I=e[10],L=e[11],n[0]=o=e[0],n[1]=u,n[2]=f,n[3]=p,n[4]=y,n[5]=x,n[6]=T,n[7]=E,n[8]=C,n[9]=D,n[10]=I,n[11]=L,n[12]=o*O+y*N+C*G+e[12],n[13]=u*O+x*N+D*G+e[13],n[14]=f*O+T*N+I*G+e[14],n[15]=p*O+E*N+L*G+e[15]),n},k.P=ge,k.Q=function(n,e,i){var o=i[0],u=i[1],f=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*u,n[5]=e[5]*u,n[6]=e[6]*u,n[7]=e[7]*u,n[8]=e[8]*f,n[9]=e[9]*f,n[10]=e[10]*f,n[11]=e[11]*f,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},k.R=Pn,k.S=function(n,e,i){var o=e[0],u=e[1],f=e[2],p=e[3],y=e[4],x=e[5],T=e[6],E=e[7],C=e[8],D=e[9],I=e[10],L=e[11],O=e[12],N=e[13],G=e[14],J=e[15],q=i[0],$=i[1],te=i[2],re=i[3];return n[0]=q*o+$*y+te*C+re*O,n[1]=q*u+$*x+te*D+re*N,n[2]=q*f+$*T+te*I+re*G,n[3]=q*p+$*E+te*L+re*J,n[4]=(q=i[4])*o+($=i[5])*y+(te=i[6])*C+(re=i[7])*O,n[5]=q*u+$*x+te*D+re*N,n[6]=q*f+$*T+te*I+re*G,n[7]=q*p+$*E+te*L+re*J,n[8]=(q=i[8])*o+($=i[9])*y+(te=i[10])*C+(re=i[11])*O,n[9]=q*u+$*x+te*D+re*N,n[10]=q*f+$*T+te*I+re*G,n[11]=q*p+$*E+te*L+re*J,n[12]=(q=i[12])*o+($=i[13])*y+(te=i[14])*C+(re=i[15])*O,n[13]=q*u+$*x+te*D+re*N,n[14]=q*f+$*T+te*I+re*G,n[15]=q*p+$*E+te*L+re*J,n},k.T=Ki,k.U=function(n,e){const i={};for(let o=0;o<e.length;o++){const u=e[o];u in n&&(i[u]=n[u])}return i},k.V=Vs,k.W=Et,k.X=Wc,k.Y=rf,k.Z=se,k._=d,k.a=H,k.a$=cm,k.a0=$t,k.a1=Zs,k.a2=da,k.a3=um,k.a4=id,k.a5=Re,k.a6=function(n,e,i){if(!n)return e||{};if(!e)return n||{};const o=dm(n),u=dm(e);(function(p,y){y.removeAll&&(p.add.clear(),p.update.clear(),p.remove.clear(),y.remove.clear());for(const x of y.remove)p.add.delete(x),p.update.delete(x);for(const[x,T]of y.update){const E=p.update.get(x);E&&(y.update.set(x,hm(E,T)),p.update.delete(x))}})(o,u);const f={};if((o.removeAll||u.removeAll)&&(f.removeAll=!0),f.remove=new Set([...o.remove,...u.remove]),f.add=new Map([...o.add,...u.add]),f.update=new Map([...o.update,...u.update]),f.remove.size&&f.add.size)for(const p of f.add.keys())f.remove.delete(p);return(function(p){const y={};return p.removeAll&&(y.removeAll=p.removeAll),p.remove&&(y.remove=Array.from(p.remove)),p.add&&(y.add=Array.from(p.add.values())),p.update&&(y.update=Array.from(p.update.values())),y})(f)},k.a7=function(n,e){if(n==null||n.type==null)return!0;if(n.type==="Feature")return rd(n,e)!=null;if(n.type==="FeatureCollection"){const i=new Set;for(const o of n.features){const u=rd(o,e);if(u==null||i.has(u))return!1;i.add(u)}return!0}return!1},k.a8=function(n,e){const i=new Map;if(!(n==null||n.type==null))if(n.type==="Feature")i.set(rd(n,e),n);else for(const o of n.features)i.set(rd(o,e),o);return i},k.a9=function(n,e,i){var o,u;if(e.removeAll)n.clear();else if(e.remove)for(const f of e.remove)n.delete(f);if(e.add)for(const f of e.add){const p=rd(f,i);p!=null&&n.set(p,f)}if(e.update)for(const f of e.update){let p=n.get(f.id);if(!p)continue;const y=!!f.newGeometry,x=f.removeAllProperties||((o=f.removeProperties)===null||o===void 0?void 0:o.length)>0||((u=f.addOrUpdateProperties)===null||u===void 0?void 0:u.length)>0;if((y||x)&&(p=Object.assign({},p),n.set(f.id,p),y&&(p.geometry=f.newGeometry),x)){if(p.properties=f.removeAllProperties?{}:Object.assign({},p.properties||{}),f.removeProperties)for(const T of f.removeProperties)delete p.properties[T];if(f.addOrUpdateProperties)for(const{key:T,value:E}of f.addOrUpdateProperties)p.properties[T]=E}}},k.aB=function(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:u}){return n.kind==="source"?o/Ns:n.kind==="composite"?Yi.number(o/Ns,u/Ns,i):e},k.aC=function(n,e){var i=e[0],o=e[1],u=e[2],f=e[3],p=e[4],y=e[5],x=e[6],T=e[7],E=e[8],C=e[9],D=e[10],I=e[11],L=e[12],O=e[13],N=e[14],G=e[15],J=i*y-o*p,q=i*x-u*p,$=i*T-f*p,te=o*x-u*y,re=o*T-f*y,we=u*T-f*x,Ne=E*O-C*L,ke=E*N-D*L,$e=E*G-I*L,at=C*N-D*O,Ye=C*G-I*O,Fe=D*G-I*N,ze=J*Fe-q*Ye+$*at+te*$e-re*ke+we*Ne;return ze?(n[0]=(y*Fe-x*Ye+T*at)*(ze=1/ze),n[1]=(u*Ye-o*Fe-f*at)*ze,n[2]=(O*we-N*re+G*te)*ze,n[3]=(D*re-C*we-I*te)*ze,n[4]=(x*$e-p*Fe-T*ke)*ze,n[5]=(i*Fe-u*$e+f*ke)*ze,n[6]=(N*$-L*we-G*q)*ze,n[7]=(E*we-D*$+I*q)*ze,n[8]=(p*Ye-y*$e+T*Ne)*ze,n[9]=(o*$e-i*Ye-f*Ne)*ze,n[10]=(L*re-O*$+G*J)*ze,n[11]=(C*$-E*re-I*J)*ze,n[12]=(y*ke-p*at-x*Ne)*ze,n[13]=(i*at-o*ke+u*Ne)*ze,n[14]=(O*q-L*te-N*J)*ze,n[15]=(E*te-C*q+D*J)*ze,n):null},k.aD=st,k.aE=function(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)},k.aF=function(n){return n[0]=0,n[1]=0,n},k.aG=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n},k.aH=Jd,k.aI=Kn,k.aJ=function(n,e,i,o){const u=e.y-n.y,f=e.x-n.x,p=o.y-i.y,y=o.x-i.x,x=p*f-y*u;if(x===0)return null;const T=(y*(n.y-i.y)-p*(n.x-i.x))/x;return new ge(n.x+T*f,n.y+T*u)},k.aK=Ip,k.aL=Lc,k.aM=function(n){let e=1/0,i=1/0,o=-1/0,u=-1/0;for(const f of n)e=Math.min(e,f.x),i=Math.min(i,f.y),o=Math.max(o,f.x),u=Math.max(u,f.y);return[e,i,o,u]},k.aN=Di,k.aO=tt,k.aP=function(n,e,i,o,u=!1){if(!i[0]&&!i[1])return[0,0];const f=u?o==="map"?-n.bearingInRadians:0:o==="viewport"?n.bearingInRadians:0;if(f){const p=Math.sin(f),y=Math.cos(f);i=[i[0]*y-i[1]*p,i[0]*p+i[1]*y]}return[u?i[0]:tt(e,i[0],n.zoom),u?i[1]:tt(e,i[1],n.zoom)]},k.aR=Qu,k.aS=di,k.aT=Wh,k.aU=tg,k.aV=zt,k.aW=Ma,k.aX=P,k.aY=He,k.aZ=Me,k.a_=Fr,k.aa=ah,k.ab=nd,k.ac=Us,k.ad=25,k.ae=af,k.af=n=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((i=>{e.onloadstart=()=>{i(e)};for(const o of n){const u=window.document.createElement("source");Ue(o)||(e.crossOrigin="Anonymous"),u.src=o,e.appendChild(u)}}))},k.ag=Je,k.ah=function(){return wi++},k.ai=t,k.aj=Wl,k.ak=jr,k.al=yo,k.am=of,k.an=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,o,u,f)=>{const p=u||f;return e[o]=!p||p.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e},k.ao=ft,k.ap=85.051129,k.aq=er,k.ar=function(n){return Math.pow(2,n)},k.as=Yt,k.at=td,k.au=function(n){return Math.log(n)/Math.LN2},k.av=function(n){var e=n[0],i=n[1];return e*e+i*i},k.aw=function(n){if(!n.length)return new Set;const e=Math.max(...n.map((x=>x.canonical.z)));let i=1/0,o=-1/0,u=1/0,f=-1/0;const p=[];for(const x of n){const{x:T,y:E,z:C}=x.canonical,D=Math.pow(2,e-C),I=T*D,L=E*D;p.push({id:x,x:I,y:L}),I<i&&(i=I),I>o&&(o=I),L<u&&(u=L),L>f&&(f=L)}const y=new Set;for(const x of p)x.x!==i&&x.x!==o&&x.y!==u&&x.y!==f||y.add(x.id);return y},k.ax=function(n,e){const i=Math.abs(2*n.wrap)-+(n.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return n.overscaledZ-e.overscaledZ||o-i||e.canonical.y-n.canonical.y||e.canonical.x-n.canonical.x},k.ay=class{constructor(n,e){this.max=n,this.onRemove=e,this.reset()}reset(){for(const n in this.data)for(const e of this.data[n])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(n,e,i){const o=n.wrapped().key;this.data[o]===void 0&&(this.data[o]=[]);const u={value:e,timeout:void 0};if(i!==void 0&&(u.timeout=setTimeout((()=>{this.remove(n,u)}),i)),this.data[o].push(u),this.order.push(o),this.order.length>this.max){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const e=this.data[n].shift();return e.timeout&&clearTimeout(e.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),e.value}getByKey(n){const e=this.data[n];return e?e[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,e){if(!this.has(n))return this;const i=n.wrapped().key,o=e===void 0?0:this.data[i].indexOf(e),u=this.data[i][o];return this.data[i].splice(o,1),u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(u.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(n){const e=[];for(const i in this.data)for(const o of this.data[i])n(o.value)||e.push(o);for(const i of e)this.remove(i.value.tileID,i)}},k.az=function(n,e){let i=0,o=0;if(n.kind==="constant")o=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:p}=n,y=u?ft(Ar.interpolationFactor(u,e,f,p),0,1):0;n.kind==="camera"?o=Yi.number(n.minSize,n.maxSize,y):i=y}return{uSizeT:i,uSize:o}},k.b=gs,k.b$=class extends dr{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},k.b0=cn,k.b1=Vi,k.b2=function(n){var e=new dt(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e},k.b3=function(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n},k.b4=function(n,e){var i=e[0],o=e[1],u=e[2],f=i*i+o*o+u*u;return f>0&&(f=1/Math.sqrt(f)),n[0]=e[0]*f,n[1]=e[1]*f,n[2]=e[2]*f,n},k.b5=hn,k.b6=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]},k.b7=function(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n[3]=e[3]*i[3],n},k.b8=bt,k.b9=function(n,e,i){const o=e[0]*i[0]+e[1]*i[1]+e[2]*i[2];return o===0?null:(-(n[0]*i[0]+n[1]*i[1]+n[2]*i[2])-i[3])/o},k.bA=function(){return new Float64Array(3)},k.bB=function(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n},k.bC=Ve,k.bD=function(n,e,i){var o=i[0],u=i[1],f=i[2],p=i[3],y=e[0],x=e[1],T=e[2],E=u*T-f*x,C=f*y-o*T,D=o*x-u*y;return n[0]=y+p*(E+=E)+u*(D+=D)-f*(C+=C),n[1]=x+p*C+f*E-o*D,n[2]=T+p*D+o*C-u*E,n},k.bE=function(n,e,i){const o=(function(x){var T=x[3],E=x[4],C=x[5],D=x[6],I=x[7],L=x[8];return x[0]*(L*E-C*I)+x[1]*(-L*T+C*D)+x[2]*(I*T-E*D)})([n[0],n[1],n[2],e[0],e[1],e[2],i[0],i[1],i[2]]);if(o===0)return null;const u=hn([],[e[0],e[1],e[2]],[i[0],i[1],i[2]]),f=hn([],[i[0],i[1],i[2]],[n[0],n[1],n[2]]),p=hn([],[n[0],n[1],n[2]],[e[0],e[1],e[2]]),y=cn([],u,-n[3]);return Vi(y,y,cn([],f,-e[3])),Vi(y,y,cn([],p,-i[3])),cn(y,y,1/o),y},k.bF=ed,k.bG=function(){return new Float64Array(4)},k.bH=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[0]*Math.cos(o)-u[1]*Math.sin(o),f[1]=u[0]*Math.sin(o)+u[1]*Math.cos(o),f[2]=u[2],n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},k.bI=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[0],f[1]=u[1]*Math.cos(o)-u[2]*Math.sin(o),f[2]=u[1]*Math.sin(o)+u[2]*Math.cos(o),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},k.bJ=function(n,e,i,o){var u=[],f=[];return u[0]=e[0]-i[0],u[1]=e[1]-i[1],u[2]=e[2]-i[2],f[0]=u[2]*Math.sin(o)+u[0]*Math.cos(o),f[1]=u[1],f[2]=u[2]*Math.cos(o)-u[0]*Math.sin(o),n[0]=f[0]+i[0],n[1]=f[1]+i[1],n[2]=f[2]+i[2],n},k.bK=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[0],p=e[1],y=e[2],x=e[3],T=e[8],E=e[9],C=e[10],D=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u-T*o,n[1]=p*u-E*o,n[2]=y*u-C*o,n[3]=x*u-D*o,n[8]=f*o+T*u,n[9]=p*o+E*u,n[10]=y*o+C*u,n[11]=x*o+D*u,n},k.bL=function(n,e){const i=ie(n,360),o=ie(e,360),u=o-i,f=o>i?u-360:u+360;return Math.abs(u)<Math.abs(f)?u:f},k.bM=function(n){return n[0]=0,n[1]=0,n[2]=0,n},k.bN=function(n,e,i,o){const u=Math.sqrt(n*n+e*e),f=Math.sqrt(i*i+o*o);n/=u,e/=u,i/=f,o/=f;const p=Math.acos(n*i+e*o);return-e*i+n*o>0?p:-p},k.bO=function(n,e){const i=ie(n,2*Math.PI),o=ie(e,2*Math.PI);return Math.min(Math.abs(i-o),Math.abs(i-o+2*Math.PI),Math.abs(i-o-2*Math.PI))},k.bP=function(){const n={},e=xe.$version;for(const i in xe.$root){const o=xe.$root[i];if(o.required){let u=null;u=i==="version"?e:o.type==="array"?[]:{},u!=null&&(n[i]=u)}}return n},k.bQ=Se,k.bR=oa,k.bS=function n(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let o=0;o<e.length;o++)if(!n(e[o],i[o]))return!1;return!0}if(typeof e=="object"&&e!==null&&i!==null){if(typeof i!="object"||Object.keys(e).length!==Object.keys(i).length)return!1;for(const o in e)if(!n(e[o],i[o]))return!1;return!0}return e===i},k.bT=function(n){n=n.slice();const e=Object.create(null);for(let i=0;i<n.length;i++)e[n[i].id]=n[i];for(let i=0;i<n.length;i++)"ref"in n[i]&&(n[i]=Cn(n[i],e[n[i].ref]));return n},k.bU=function(n,e){if(n.type==="custom")return new Ym(n,e);switch(n.type){case"background":return new Jh(n,e);case"circle":return new Ff(n,e);case"color-relief":return new Gp(n,e);case"fill":return new Uh(n,e);case"fill-extrusion":return new Gn(n,e);case"heatmap":return new Np(n,e);case"hillshade":return new jp(n,e);case"line":return new Xl(n,e);case"raster":return new Gr(n,e);case"symbol":return new Yc(n,e)}},k.bV=n=>n.type==="raster",k.bW=Qr,k.bX=function(n,e){if(!n)return[{command:"setStyle",args:[e]}];let i=[];try{if(!Ut(n.version,e.version))return[{command:"setStyle",args:[e]}];Ut(n.center,e.center)||i.push({command:"setCenter",args:[e.center]}),Ut(n.state,e.state)||i.push({command:"setGlobalState",args:[e.state]}),Ut(n.centerAltitude,e.centerAltitude)||i.push({command:"setCenterAltitude",args:[e.centerAltitude]}),Ut(n.zoom,e.zoom)||i.push({command:"setZoom",args:[e.zoom]}),Ut(n.bearing,e.bearing)||i.push({command:"setBearing",args:[e.bearing]}),Ut(n.pitch,e.pitch)||i.push({command:"setPitch",args:[e.pitch]}),Ut(n.roll,e.roll)||i.push({command:"setRoll",args:[e.roll]}),Ut(n.sprite,e.sprite)||i.push({command:"setSprite",args:[e.sprite]}),Ut(n.glyphs,e.glyphs)||i.push({command:"setGlyphs",args:[e.glyphs]}),Ut(n.transition,e.transition)||i.push({command:"setTransition",args:[e.transition]}),Ut(n.light,e.light)||i.push({command:"setLight",args:[e.light]}),Ut(n.terrain,e.terrain)||i.push({command:"setTerrain",args:[e.terrain]}),Ut(n.sky,e.sky)||i.push({command:"setSky",args:[e.sky]}),Ut(n.projection,e.projection)||i.push({command:"setProjection",args:[e.projection]});const o={},u=[];(function(p,y,x,T){let E;for(E in y=y||{},p=p||{})Object.prototype.hasOwnProperty.call(p,E)&&(Object.prototype.hasOwnProperty.call(y,E)||Ei(E,x,T));for(E in y)Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(p,E)?Ut(p[E],y[E])||(p[E].type==="geojson"&&y[E].type==="geojson"&&Li(p,y,E)?Si(x,{command:"setGeoJSONSourceData",args:[E,y[E].data]}):wn(E,y,x,T)):$n(E,y,x))})(n.sources,e.sources,u,o);const f=[];n.layers&&n.layers.forEach((p=>{"source"in p&&o[p.source]?i.push({command:"removeLayer",args:[p.id]}):f.push(p)})),i=i.concat(u),(function(p,y,x){y=y||[];const T=(p=p||[]).map(ml),E=y.map(ml),C=p.reduce(So,{}),D=y.reduce(So,{}),I=T.slice(),L=Object.create(null);let O,N,G,J,q;for(let $=0,te=0;$<T.length;$++)O=T[$],Object.prototype.hasOwnProperty.call(D,O)?te++:(Si(x,{command:"removeLayer",args:[O]}),I.splice(I.indexOf(O,te),1));for(let $=0,te=0;$<E.length;$++)O=E[E.length-1-$],I[I.length-1-$]!==O&&(Object.prototype.hasOwnProperty.call(C,O)?(Si(x,{command:"removeLayer",args:[O]}),I.splice(I.lastIndexOf(O,I.length-te),1)):te++,J=I[I.length-$],Si(x,{command:"addLayer",args:[D[O],J]}),I.splice(I.length-$,0,O),L[O]=!0);for(let $=0;$<E.length;$++)if(O=E[$],N=C[O],G=D[O],!L[O]&&!Ut(N,G))if(Ut(N.source,G.source)&&Ut(N["source-layer"],G["source-layer"])&&Ut(N.type,G.type)){for(q in zn(N.layout,G.layout,x,O,null,"setLayoutProperty"),zn(N.paint,G.paint,x,O,null,"setPaintProperty"),Ut(N.filter,G.filter)||Si(x,{command:"setFilter",args:[O,G.filter]}),Ut(N.minzoom,G.minzoom)&&Ut(N.maxzoom,G.maxzoom)||Si(x,{command:"setLayerZoomRange",args:[O,G.minzoom,G.maxzoom]}),N)Object.prototype.hasOwnProperty.call(N,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?zn(N[q],G[q],x,O,q.slice(6),"setPaintProperty"):Ut(N[q],G[q])||Si(x,{command:"setLayerProperty",args:[O,q,G[q]]}));for(q in G)Object.prototype.hasOwnProperty.call(G,q)&&!Object.prototype.hasOwnProperty.call(N,q)&&q!=="layout"&&q!=="paint"&&q!=="filter"&&q!=="metadata"&&q!=="minzoom"&&q!=="maxzoom"&&(q.indexOf("paint.")===0?zn(N[q],G[q],x,O,q.slice(6),"setPaintProperty"):Ut(N[q],G[q])||Si(x,{command:"setLayerProperty",args:[O,q,G[q]]}))}else Si(x,{command:"removeLayer",args:[O]}),J=I[I.lastIndexOf(O)+1],Si(x,{command:"addLayer",args:[G,J]})})(f,e.layers,i)}catch(o){console.warn("Unable to compute style diff:",o),i=[{command:"setStyle",args:[e]}]}return i},k.bY=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},k.bZ=Jn,k.b_=qs,k.ba=dn,k.bb=function(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n},k.bc=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]},k.bd=qi,k.be=Zn,k.bf=function(n,e,i,o,u){var f=1/Math.tan(e/2);if(n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,u!=null&&u!==1/0){var p=1/(o-u);n[10]=(u+o)*p,n[14]=2*u*o*p}else n[10]=-1,n[14]=-2*o;return n},k.bg=function(n){var e=new dt(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},k.bh=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[0],p=e[1],y=e[2],x=e[3],T=e[4],E=e[5],C=e[6],D=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=f*u+T*o,n[1]=p*u+E*o,n[2]=y*u+C*o,n[3]=x*u+D*o,n[4]=T*u-f*o,n[5]=E*u-p*o,n[6]=C*u-y*o,n[7]=D*u-x*o,n},k.bi=function(n,e,i){var o=Math.sin(i),u=Math.cos(i),f=e[4],p=e[5],y=e[6],x=e[7],T=e[8],E=e[9],C=e[10],D=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=f*u+T*o,n[5]=p*u+E*o,n[6]=y*u+C*o,n[7]=x*u+D*o,n[8]=T*u-f*o,n[9]=E*u-p*o,n[10]=C*u-y*o,n[11]=D*u-x*o,n},k.bj=function(){const n=new Float32Array(16);return Yt(n),n},k.bk=function(){const n=new Float64Array(16);return Yt(n),n},k.bl=function(){return new Float64Array(16)},k.bm=function(n,e,i){const o=new Float64Array(4);return Ve(o,n,e-90,i),o},k.bn=function(n,e,i,o){var u,f,p,y,x,T=e[0],E=e[1],C=e[2],D=e[3],I=i[0],L=i[1],O=i[2],N=i[3];return(f=T*I+E*L+C*O+D*N)<0&&(f=-f,I=-I,L=-L,O=-O,N=-N),1-f>jt?(u=Math.acos(f),p=Math.sin(u),y=Math.sin((1-o)*u)/p,x=Math.sin(o*u)/p):(y=1-o,x=o),n[0]=y*T+x*I,n[1]=y*E+x*L,n[2]=y*C+x*O,n[3]=y*D+x*N,n},k.bo=function(n){const e=new Float64Array(9);(function(f,p){var y=p[0],x=p[1],T=p[2],E=p[3],C=y+y,D=x+x,I=T+T,L=y*C,O=x*C,N=x*D,G=T*C,J=T*D,q=T*I,$=E*C,te=E*D,re=E*I;f[0]=1-N-q,f[3]=O-re,f[6]=G+te,f[1]=O+re,f[4]=1-L-q,f[7]=J-$,f[2]=G-te,f[5]=J+$,f[8]=1-L-N})(e,n);const i=Fr(-Math.asin(ft(e[2],-1,1)));let o,u;return Math.hypot(e[5],e[8])<.001?(o=0,u=-Fr(Math.atan2(e[3],e[4]))):(o=Fr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),u=Fr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:o,pitch:i+90,bearing:u}},k.bp=function(n,e){return n.roll==e.roll&&n.pitch==e.pitch&&n.bearing==e.bearing},k.bq=Xt,k.br=Fa,k.bs=Hu,k.bt=xr,k.bu=fr,k.bv=Ae,k.bw=it,k.bx=Yn,k.by=function(n,e,i,o,u){return Ae(o,u,ft((n-e)/(i-e),0,1))},k.bz=ie,k.c=ue,k.c$=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},k.c0=Xo,k.c1=class extends dr{constructor(n,e){super(n,e),this.current=Ic}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},k.c2=ks,k.c3=class extends dr{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},k.c4=class extends dr{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},k.c5=Dt,k.c6=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},k.c7=function(n,e,i){var o=e[0],u=e[1],f=e[2];return n[0]=o*i[0]+u*i[3]+f*i[6],n[1]=o*i[1]+u*i[4]+f*i[7],n[2]=o*i[2]+u*i[5]+f*i[8],n},k.c8=function(n,e,i,o,u,f,p){var y=1/(e-i),x=1/(o-u),T=1/(f-p);return n[0]=-2*y,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*T,n[11]=0,n[12]=(e+i)*y,n[13]=(u+o)*x,n[14]=(p+f)*T,n[15]=1,n},k.c9=class extends dr{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(4*n.length);for(let i=0;i<n.length;i++)e[4*i]=n[i].r,e[4*i+1]=n[i].g,e[4*i+2]=n[i].b,e[4*i+3]=n[i].a;this.gl.uniform4fv(this.location,e)}}},k.cA=function(n,e){return V[e]&&(n instanceof MouseEvent||n instanceof WheelEvent)},k.cB=function(n,e){return ve[e]&&"touches"in n},k.cC=function(n){return ve[n]||V[n]},k.cD=function(n,e,i){var o=e[0],u=e[1];return n[0]=i[0]*o+i[4]*u+i[12],n[1]=i[1]*o+i[5]*u+i[13],n},k.cE=function(n,e){const{x:i,y:o}=nd.fromLngLat(e);return!(n<0||n>25||o<0||o>=1||i<0||i>=1)},k.cF=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},k.cG=class extends Ho{},k.cH=Jg,k.cJ=he,k.cK=function(n,e){ue.REGISTERED_PROTOCOLS[n]=e},k.cL=function(n){delete ue.REGISTERED_PROTOCOLS[n]},k.cM=function(n,e){const i={};for(let u=0;u<n.length;u++){const f=e&&e[n[u].id]||Ts(n[u]);e&&(e[n[u].id]=f);let p=i[f];p||(p=i[f]=[]),p.push(n[u])}const o=[];for(const u in i)o.push(i[u]);return o},k.cN=lt,k.cO=sf,k.cP=Dp,k.cQ=op,k.cR=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Re/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0],i=e.layout,o=e._unevaluatedLayout._values,u={layoutIconSize:o["icon-size"].possiblyEvaluate(new si(n.bucket.zoom+1),n.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new si(n.bucket.zoom+1),n.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new si(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.textSizeData;u.compositeTextSizes=[o["text-size"].possiblyEvaluate(new si(T),n.canonical),o["text-size"].possiblyEvaluate(new si(E),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=n.bucket.iconSizeData;u.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new si(T),n.canonical),o["icon-size"].possiblyEvaluate(new si(E),n.canonical)]}const f=i.get("text-line-height")*Di,p=i.get("text-rotation-alignment")!=="viewport"&&i.get("symbol-placement")!=="point",y=i.get("text-keep-upright"),x=i.get("text-size");for(const T of n.bucket.features){const E=i.get("text-font").evaluate(T,{},n.canonical).join(","),C=x.evaluate(T,{},n.canonical),D=u.layoutTextSize.evaluate(T,{},n.canonical),I=u.layoutIconSize.evaluate(T,{},n.canonical),L={horizontal:{},vertical:void 0},O=T.text;let N,G=[0,0];if(O){const $=O.toString(),te=i.get("text-letter-spacing").evaluate(T,{},n.canonical)*Di,re=ku($)?te:0,we=i.get("text-anchor").evaluate(T,{},n.canonical),Ne=ei(e,T,n.canonical);if(!Ne){const Ye=i.get("text-radial-offset").evaluate(T,{},n.canonical);G=Ye?Rt(we,[Ye*Di,bi]):i.get("text-offset").evaluate(T,{},n.canonical).map((Fe=>Fe*Di))}let ke=p?"center":i.get("text-justify").evaluate(T,{},n.canonical);const $e=i.get("symbol-placement")==="point"?i.get("text-max-width").evaluate(T,{},n.canonical)*Di:1/0,at=()=>{n.bucket.allowVerticalPlacement&&Sa($)&&(L.vertical=Ii(O,n.glyphMap,n.glyphPositions,n.imagePositions,E,$e,f,we,"left",re,G,k.aA.vertical,!0,D,C))};if(!p&&Ne){const Ye=new Set;if(ke==="auto")for(let ze=0;ze<Ne.values.length;ze+=2)Ye.add(di(Ne.values[ze]));else Ye.add(ke);let Fe=!1;for(const ze of Ye)if(!L.horizontal[ze])if(Fe)L.horizontal[ze]=L.horizontal[0];else{const _t=Ii(O,n.glyphMap,n.glyphPositions,n.imagePositions,E,$e,f,"center",ze,re,G,k.aA.horizontal,!1,D,C);_t&&(L.horizontal[ze]=_t,Fe=_t.positionedLines.length===1)}at()}else{ke==="auto"&&(ke=di(we));const Ye=Ii(O,n.glyphMap,n.glyphPositions,n.imagePositions,E,$e,f,we,ke,re,G,k.aA.horizontal,!1,D,C);Ye&&(L.horizontal[ke]=Ye),at(),Sa($)&&p&&y&&(L.vertical=Ii(O,n.glyphMap,n.glyphPositions,n.imagePositions,E,$e,f,we,ke,re,G,k.aA.vertical,!1,D,C))}}let J=!1;if(T.icon&&T.icon.name){const $=n.imageMap[T.icon.name];$&&(N=Xc(n.imagePositions[T.icon.name],i.get("icon-offset").evaluate(T,{},n.canonical),i.get("icon-anchor").evaluate(T,{},n.canonical)),J=!!$.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=J:n.bucket.sdfIcons!==J&&tn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),($.pixelRatio!==n.bucket.pixelRatio||i.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const q=Dm(L.horizontal)||L.vertical;n.bucket.iconsInText=!!q&&q.iconsInText,(q||N)&&Pi(n.bucket,T,L,N,n.imageMap,u,D,I,G,J,n.canonical,n.subdivisionGranularity)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},k.cS=ja,k.cT=Ni,k.cU=qc,k.cV=function(n){const e=new Yh;return(function(i,o){for(const u in i.layers)o.writeMessage(3,bf,i.layers[u])})(n,e),e.finish()},k.cW=function(n,e,i,o,u,f){let p=zm(n,e,i,u,0);return p=zm(p,e,o,f,1),p},k.cX=class{constructor(n){this.maxEntries=n,this.map=new Map}get(n){const e=this.map.get(n);return e!==void 0&&(this.map.delete(n),this.map.set(n,e)),e}set(n,e){if(this.map.has(n))this.map.delete(n);else if(this.map.size>=this.maxEntries){const i=this.map.keys().next().value;this.map.delete(i)}this.map.set(n,e)}clear(){this.map.clear()}},k.cY=zi,k.cZ=Yh,k.c_=zp,k.ca=class extends dr{constructor(n,e){super(n,e),this.current=new Array}set(n){if(n!=this.current){this.current=n;const e=new Float32Array(n);this.gl.uniform1fv(this.location,e)}}},k.cb=class extends Vu{},k.cc=$h,k.cd=class extends Ls{},k.ce=Vf,k.cf=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},k.cg=Vd,k.ch=function(n,e,i){var o=e[0],u=e[1],f=e[2],p=i[3]*o+i[7]*u+i[11]*f+i[15];return n[0]=(i[0]*o+i[4]*u+i[8]*f+i[12])/(p=p||1),n[1]=(i[1]*o+i[5]*u+i[9]*f+i[13])/p,n[2]=(i[2]*o+i[6]*u+i[10]*f+i[14])/p,n},k.ci=class extends la{},k.cj=class extends Ul{},k.ck=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]&&n[4]===e[4]&&n[5]===e[5]&&n[6]===e[6]&&n[7]===e[7]&&n[8]===e[8]&&n[9]===e[9]&&n[10]===e[10]&&n[11]===e[11]&&n[12]===e[12]&&n[13]===e[13]&&n[14]===e[14]&&n[15]===e[15]},k.cl=function(n,e){var i=n[0],o=n[1],u=n[2],f=n[3],p=n[4],y=n[5],x=n[6],T=n[7],E=n[8],C=n[9],D=n[10],I=n[11],L=n[12],O=n[13],N=n[14],G=n[15],J=e[0],q=e[1],$=e[2],te=e[3],re=e[4],we=e[5],Ne=e[6],ke=e[7],$e=e[8],at=e[9],Ye=e[10],Fe=e[11],ze=e[12],_t=e[13],pt=e[14],vt=e[15];return Math.abs(i-J)<=jt*Math.max(1,Math.abs(i),Math.abs(J))&&Math.abs(o-q)<=jt*Math.max(1,Math.abs(o),Math.abs(q))&&Math.abs(u-$)<=jt*Math.max(1,Math.abs(u),Math.abs($))&&Math.abs(f-te)<=jt*Math.max(1,Math.abs(f),Math.abs(te))&&Math.abs(p-re)<=jt*Math.max(1,Math.abs(p),Math.abs(re))&&Math.abs(y-we)<=jt*Math.max(1,Math.abs(y),Math.abs(we))&&Math.abs(x-Ne)<=jt*Math.max(1,Math.abs(x),Math.abs(Ne))&&Math.abs(T-ke)<=jt*Math.max(1,Math.abs(T),Math.abs(ke))&&Math.abs(E-$e)<=jt*Math.max(1,Math.abs(E),Math.abs($e))&&Math.abs(C-at)<=jt*Math.max(1,Math.abs(C),Math.abs(at))&&Math.abs(D-Ye)<=jt*Math.max(1,Math.abs(D),Math.abs(Ye))&&Math.abs(I-Fe)<=jt*Math.max(1,Math.abs(I),Math.abs(Fe))&&Math.abs(L-ze)<=jt*Math.max(1,Math.abs(L),Math.abs(ze))&&Math.abs(O-_t)<=jt*Math.max(1,Math.abs(O),Math.abs(_t))&&Math.abs(N-pt)<=jt*Math.max(1,Math.abs(N),Math.abs(pt))&&Math.abs(G-vt)<=jt*Math.max(1,Math.abs(G),Math.abs(vt))},k.cm=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},k.cn=n=>n.type==="symbol",k.co=n=>n.type==="circle",k.cp=n=>n.type==="heatmap",k.cq=n=>n.type==="line",k.cr=n=>n.type==="fill",k.cs=n=>n.type==="fill-extrusion",k.ct=n=>n.type==="hillshade",k.cu=n=>n.type==="color-relief",k.cv=n=>n.type==="background",k.cw=n=>n.type==="custom",k.cx=Qe,k.cy=function(n,e,i){const o=Lt(e.x-i.x,e.y-i.y),u=Lt(n.x-i.x,n.y-i.y),f=Math.atan2(o[0]*u[1]-o[1]*u[0],(function(p,y){return p[0]*y[0]+p[1]*y[1]})(o,u));return Fr(f)},k.cz=ht,k.d=Ue,k.d0=function(n,e,i,o,u){return d(this,void 0,void 0,(function*(){if($t())try{return yield Zs(n,e,i,o,u)}catch{}return(function(f,p,y,x,T){const E=f.width,C=f.height;Ha&&za||(Ha=new OffscreenCanvas(E,C),za=Ha.getContext("2d",{willReadFrequently:!0})),Ha.width=E,Ha.height=C,za.drawImage(f,0,0,E,C);const D=za.getImageData(p,y,x,T);return za.clearRect(0,0,E,C),D.data})(n,e,i,o,u)}))},k.d1=Vp,k.d2=Be,k.d3=class{constructor(n,e){this.layers={[ah]:this},this.name=ah,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=n.length,this.features=n}feature(n){return new Jm(this.features[n],this.extent)}},k.d4=zu,k.d5=Ba,k.e=ii,k.f=n=>d(void 0,void 0,void 0,(function*(){if(n.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(n)],{type:"image/png"});try{return createImageBitmap(e)}catch(i){throw new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),k.g=Te,k.h=n=>new Promise(((e,i)=>{const o=new Image;o.onload=()=>{e(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame((()=>{o.src=_s}))},o.onerror=()=>i(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const u=new Blob([new Uint8Array(n)],{type:"image/png"});o.src=n.byteLength?URL.createObjectURL(u):_s})),k.i=ma,k.j=(n,e)=>je(ii(n,{type:"json"}),e),k.k=yi,k.l=Ft,k.m=je,k.n=(n,e)=>je(ii(n,{type:"arrayBuffer"}),e),k.o=function(n){return new Yh(n).readFields(nm,[])},k.p=sp,k.q=function(n){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(n))},k.r=Oc,k.s=pl,k.t=Sn,k.u=xe,k.v=Rl,k.w=tn,k.x=qo,k.y=Bl,k.z=mo})),rt("worker",["./shared"],(function(k){class d{constructor(V,j){this.keyCache={},V&&this.replace(V,j)}replace(V,j){this._layerConfigs={},this._layers={},this.update(V,[],j)}update(V,j,H){for(const ue of V){this._layerConfigs[ue.id]=ue;const Te=this._layers[ue.id]=k.bU(ue,H);Te._featureFilter=k.ak(Te.filter,H),this.keyCache[ue.id]&&delete this.keyCache[ue.id]}for(const ue of j)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const se=k.cM(Object.values(this._layerConfigs),this.keyCache);for(const ue of se){const Te=ue.map((gt=>this._layers[gt.id])),_e=Te[0];if(_e.visibility==="none")continue;const he=_e.source||"";let Se=this.familiesBySource[he];Se||(Se=this.familiesBySource[he]={});const je=_e.sourceLayer||k.aa;let Ue=Se[je];Ue||(Ue=Se[je]=[]),Ue.push(Te)}}}class ge{constructor(V){const j={},H=[];for(const _e in V){const he=V[_e],Se=j[_e]={};for(const je in he){const Ue=he[+je];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const gt={x:0,y:0,w:Ue.bitmap.width+2,h:Ue.bitmap.height+2};H.push(gt),Se[je]={rect:gt,metrics:Ue.metrics}}}const{w:se,h:ue}=k.p(H),Te=new k.r({width:se||1,height:ue||1});for(const _e in V){const he=V[_e];for(const Se in he){const je=he[+Se];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const Ue=j[_e][Se].rect;k.r.copy(je.bitmap,Te,{x:0,y:0},{x:Ue.x+1,y:Ue.y+1},je.bitmap)}}this.image=Te,this.positions=j}}k.cN("GlyphAtlas",ge);class Be{constructor(V){this.tileID=new k.a2(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,j,H,se,ue){return k._(this,void 0,void 0,(function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new k.ai;const Te=new k.cO(Object.keys(V.layers).sort()),_e=new k.cP(this.tileID,this.promoteId);_e.bucketLayerIDs=[];const he={},Se={featureIndex:_e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:H,subdivisionGranularity:ue},je=j.familiesBySource[this.source];for(const Li in je){const zn=V.layers[Li];if(!zn)continue;zn.version===1&&k.w(`Vector tile source "${this.source}" layer "${Li}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ml=Te.encode(Li),So=[];for(let Je=0;Je<zn.length;Je++){const pr=zn.feature(Je),mr=_e.getId(pr,Li);So.push({feature:pr,id:mr,index:Je,sourceLayerIndex:ml})}for(const Je of je[Li]){const pr=Je[0];pr.source!==this.source&&k.w(`layer.source = ${pr.source} does not equal this.source = ${this.source}`),pr.isHidden(this.zoom,!0)||(ut(Je,this.zoom,H),(he[pr.id]=pr.createBucket({index:_e.bucketLayerIDs.length,layers:Je,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ml,sourceID:this.source})).populate(So,Se,this.tileID.canonical),_e.bucketLayerIDs.push(Je.map((mr=>mr.id))))}}const Ue=k.bZ(Se.glyphDependencies,(Li=>Object.keys(Li).map(Number)));this.inFlightDependencies.forEach((Li=>Li?.abort())),this.inFlightDependencies=[];let gt=Promise.resolve({});if(Object.keys(Ue).length){const Li=new AbortController;this.inFlightDependencies.push(Li),gt=se.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},Li)}const Mt=Object.keys(Se.iconDependencies);let Ft=Promise.resolve({});if(Mt.length){const Li=new AbortController;this.inFlightDependencies.push(Li),Ft=se.sendAsync({type:"GI",data:{icons:Mt,source:this.source,tileID:this.tileID,type:"icons"}},Li)}const yi=Object.keys(Se.patternDependencies);let ui=Promise.resolve({});if(yi.length){const Li=new AbortController;this.inFlightDependencies.push(Li),ui=se.sendAsync({type:"GI",data:{icons:yi,source:this.source,tileID:this.tileID,type:"patterns"}},Li)}const xe=Se.dashDependencies;let Ti=Promise.resolve({});if(Object.keys(xe).length){const Li=new AbortController;this.inFlightDependencies.push(Li),Ti=se.sendAsync({type:"GDA",data:{dashes:xe}},Li)}const[Cn,Ut,Si,$n]=yield Promise.all([gt,Ft,ui,Ti]),Ei=new ge(Cn),wn=new k.cQ(Ut,Si);for(const Li in he){const zn=he[Li];zn instanceof k.aj?(ut(zn.layers,this.zoom,H),k.cR({bucket:zn,glyphMap:Cn,glyphPositions:Ei.positions,imageMap:Ut,imagePositions:wn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Se.subdivisionGranularity})):zn.hasDependencies&&(zn instanceof k.cS||zn instanceof k.cT||zn instanceof k.cU)&&(ut(zn.layers,this.zoom,H),zn.addFeatures(Se,this.tileID.canonical,wn.patternPositions,$n))}return this.status="done",{buckets:Object.values(he).filter((Li=>!Li.isEmpty())),featureIndex:_e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ei.image,imageAtlas:wn,dashPositions:$n,glyphMap:this.returnDependencies?Cn:null,iconMap:this.returnDependencies?Ut:null,glyphPositions:this.returnDependencies?Ei.positions:null}}))}}function ut(ve,V,j){const H=new k.H(V);for(const se of ve)se.recalculate(H,j)}class mt{constructor(V,j,H,se,ue){this.type=V,this.properties=H||{},this.extent=ue,this.pointsArray=j,this.id=se}loadGeometry(){return this.pointsArray.map((V=>V.map((j=>new k.P(j.x,j.y)))))}}class Ke{constructor(V,j,H){this.version=2,this._myFeatures=V,this.name=j,this.length=V.length,this.extent=H}feature(V){return this._myFeatures[V]}}class kt{constructor(){this.layers={}}addLayer(V){this.layers[V.name]=V}}function Ht(ve){let V=k.cV(ve);return V.byteOffset===0&&V.byteLength===V.buffer.byteLength||(V=new Uint8Array(V)),{vectorTile:ve,rawData:V.buffer}}function xt(ve,V,j){const{extent:H}=ve,se=Math.pow(2,j.z-V.z),ue=(j.x-V.x*se)*H,Te=(j.y-V.y*se)*H,_e=[];for(let he=0;he<ve.length;he++){const Se=ve.feature(he);let je=Se.loadGeometry();for(const gt of je)for(const Mt of gt)Mt.x=Mt.x*se-ue,Mt.y=Mt.y*se-Te;const Ue=128;je=k.cW(je,Se.type,-Ue,-Ue,H+Ue,H+Ue),je.length!==0&&_e.push(new mt(Se.type,je,Se.properties,Se.id,H))}return new Ke(_e,ve.name,H)}class me{constructor(V,j,H){this.actor=V,this.layerIndex=j,this.availableImages=H,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new k.cX(1e3)}loadVectorTile(V,j){return k._(this,void 0,void 0,(function*(){const H=yield k.n(V.request,j);try{return{vectorTile:V.encoding!=="mlt"?new k.cY(new k.cZ(H.data)):new k.c_(H.data),rawData:H.data,cacheControl:H.cacheControl,expires:H.expires}}catch(se){const ue=new Uint8Array(H.data);let Te=`Unable to parse the tile at ${V.request.url}, `;throw Te+=ue[0]===31&&ue[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${se.message}`,new Error(Te)}}))}loadTile(V){return k._(this,void 0,void 0,(function*(){const{uid:j,overzoomParameters:H}=V;H&&(V.request=H.overzoomRequest);const se=!!(V&&V.request&&V.request.collectResourceTiming)&&new k.c$(V.request),ue=new Be(V);this.loading[j]=ue;const Te=new AbortController;ue.abort=Te;try{const _e=yield this.loadVectorTile(V,Te);if(delete this.loading[j],!_e)return null;if(H){const gt=this._getOverzoomTile(V,_e.vectorTile);_e.rawData=gt.rawData,_e.vectorTile=gt.vectorTile}const he=_e.rawData,Se={};_e.expires&&(Se.expires=_e.expires),_e.cacheControl&&(Se.cacheControl=_e.cacheControl);const je={};if(se){const gt=se.finish();gt&&(je.resourceTiming=JSON.parse(JSON.stringify(gt)))}ue.vectorTile=_e.vectorTile;const Ue=ue.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[j]=ue,this.fetching[j]={rawTileData:he,cacheControl:Se,resourceTiming:je};try{const gt=yield Ue;return k.e({rawTileData:he.slice(0),encoding:V.encoding},gt,Se,je)}finally{delete this.fetching[j]}}catch(_e){throw delete this.loading[j],ue.status="done",this.loaded[j]=ue,_e}}))}_getOverzoomTile(V,j){const{tileID:H,source:se,overzoomParameters:ue}=V,{maxZoomTileID:Te}=ue,_e=`${Te.key}_${H.key}`,he=this.overzoomedTileResultCache.get(_e);if(he)return he;const Se=new kt,je=this.layerIndex.familiesBySource[se];for(const gt in je){const Mt=j.layers[gt];if(!Mt)continue;const Ft=xt(Mt,Te,H.canonical);Ft.length>0&&Se.addLayer(Ft)}const Ue=Ht(Se);return this.overzoomedTileResultCache.set(_e,Ue),Ue}reloadTile(V){return k._(this,void 0,void 0,(function*(){const j=V.uid;if(!this.loaded||!this.loaded[j])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const H=this.loaded[j];if(H.showCollisionBoxes=V.showCollisionBoxes,H.status==="parsing"){const se=yield H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);let ue;if(this.fetching[j]){const{rawTileData:Te,cacheControl:_e,resourceTiming:he}=this.fetching[j];delete this.fetching[j],ue=k.e({rawTileData:Te.slice(0),encoding:V.encoding},se,_e,he)}else ue=se;return ue}if(H.status==="done"&&H.vectorTile)return H.parse(H.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)}))}abortTile(V){return k._(this,void 0,void 0,(function*(){const j=this.loading,H=V.uid;j&&j[H]&&j[H].abort&&(j[H].abort.abort(),delete j[H])}))}removeTile(V){return k._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]}))}}class $t{constructor(){this.loaded={}}loadTile(V){return k._(this,void 0,void 0,(function*(){const{uid:j,encoding:H,rawImageData:se,redFactor:ue,greenFactor:Te,blueFactor:_e,baseShift:he}=V,Se=se.width+2,je=se.height+2,Ue=k.b(se)?new k.R({width:Se,height:je},yield k.d0(se,-1,-1,Se,je)):se,gt=new k.d1(j,Ue,H,ue,Te,_e,he);return this.loaded=this.loaded||{},this.loaded[j]=gt,gt}))}removeTile(V){const j=this.loaded,H=V.uid;j&&j[H]&&delete j[H]}}var jt,dt,Dt=(function(){if(dt)return jt;function ve(j,H){if(j.length!==0){V(j[0],H);for(var se=1;se<j.length;se++)V(j[se],!H)}}function V(j,H){for(var se=0,ue=0,Te=0,_e=j.length,he=_e-1;Te<_e;he=Te++){var Se=(j[Te][0]-j[he][0])*(j[he][1]+j[Te][1]),je=se+Se;ue+=Math.abs(se)>=Math.abs(Se)?se-je+Se:Se-je+se,se=je}se+ue>=0!=!!H&&j.reverse()}return dt=1,jt=function j(H,se){var ue,Te=H&&H.type;if(Te==="FeatureCollection")for(ue=0;ue<H.features.length;ue++)j(H.features[ue],se);else if(Te==="GeometryCollection")for(ue=0;ue<H.geometries.length;ue++)j(H.geometries[ue],se);else if(Te==="Feature")j(H.geometry,se);else if(Te==="Polygon")ve(H.coordinates,se);else if(Te==="MultiPolygon")for(ue=0;ue<H.coordinates.length;ue++)ve(H.coordinates[ue],se);return H}})(),Yt=k.d2(Dt);const It={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ve=>ve},bt=Math.fround||(li=new Float32Array(1),ve=>(li[0]=+ve,li[0]));var li;class Vi{constructor(V){this.options=Object.assign(Object.create(It),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:j,minZoom:H,maxZoom:se}=this.options;j&&console.time("total time");const ue=`prepare ${V.length} points`;j&&console.time(ue),this.points=V;const Te=[];for(let he=0;he<V.length;he++){const Se=V[he];if(!Se.geometry)continue;const[je,Ue]=Se.geometry.coordinates,gt=bt(Mi(je)),Mt=bt(dn(Ue));Te.push(gt,Mt,1/0,he,-1,1),this.options.reduce&&Te.push(0)}let _e=this.trees[se+1]=this._createTree(Te);j&&console.timeEnd(ue);for(let he=se;he>=H;he--){const Se=+Date.now();_e=this.trees[he]=this._createTree(this._cluster(_e,he)),j&&console.log("z%d: %d clusters in %dms",he,_e.numItems,+Date.now()-Se)}return j&&console.timeEnd("total time"),this}getClusters(V,j){let H=((V[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,V[1]));let ue=V[2]===180?180:((V[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)H=-180,ue=180;else if(H>ue){const Ue=this.getClusters([H,se,180,Te],j),gt=this.getClusters([-180,se,ue,Te],j);return Ue.concat(gt)}const _e=this.trees[this._limitZoom(j)],he=_e.range(Mi(H),dn(Te),Mi(ue),dn(se)),Se=_e.data,je=[];for(const Ue of he){const gt=this.stride*Ue;je.push(Se[gt+5]>1?cn(Se,gt,this.clusterProps):this.points[Se[gt+3]])}return je}getChildren(V){const j=this._getOriginId(V),H=this._getOriginZoom(V),se="No cluster with the specified id.",ue=this.trees[H];if(!ue)throw new Error(se);const Te=ue.data;if(j*this.stride>=Te.length)throw new Error(se);const _e=this.options.radius/(this.options.extent*Math.pow(2,H-1)),he=ue.within(Te[j*this.stride],Te[j*this.stride+1],_e),Se=[];for(const je of he){const Ue=je*this.stride;Te[Ue+4]===V&&Se.push(Te[Ue+5]>1?cn(Te,Ue,this.clusterProps):this.points[Te[Ue+3]])}if(Se.length===0)throw new Error(se);return Se}getLeaves(V,j,H){const se=[];return this._appendLeaves(se,V,j=j||10,H=H||0,0),se}getTile(V,j,H){const se=this.trees[this._limitZoom(V)],ue=Math.pow(2,V),{extent:Te,radius:_e}=this.options,he=_e/Te,Se=(H-he)/ue,je=(H+1+he)/ue,Ue={features:[]};return this._addTileFeatures(se.range((j-he)/ue,Se,(j+1+he)/ue,je),se.data,j,H,ue,Ue),j===0&&this._addTileFeatures(se.range(1-he/ue,Se,1,je),se.data,ue,H,ue,Ue),j===ue-1&&this._addTileFeatures(se.range(0,Se,he/ue,je),se.data,-1,H,ue,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(V){let j=this._getOriginZoom(V)-1;for(;j<=this.options.maxZoom;){const H=this.getChildren(V);if(j++,H.length!==1)break;V=H[0].properties.cluster_id}return j}_appendLeaves(V,j,H,se,ue){const Te=this.getChildren(j);for(const _e of Te){const he=_e.properties;if(he&&he.cluster?ue+he.point_count<=se?ue+=he.point_count:ue=this._appendLeaves(V,he.cluster_id,H,se,ue):ue<se?ue++:V.push(_e),V.length===H)break}return ue}_createTree(V){const j=new k.aU(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let H=0;H<V.length;H+=this.stride)j.add(V[H],V[H+1]);return j.finish(),j.data=V,j}_addTileFeatures(V,j,H,se,ue,Te){for(const _e of V){const he=_e*this.stride,Se=j[he+5]>1;let je,Ue,gt;if(Se)je=hn(j,he,this.clusterProps),Ue=j[he],gt=j[he+1];else{const yi=this.points[j[he+3]];je=yi.properties;const[ui,xe]=yi.geometry.coordinates;Ue=Mi(ui),gt=dn(xe)}const Mt={type:1,geometry:[[Math.round(this.options.extent*(Ue*ue-H)),Math.round(this.options.extent*(gt*ue-se))]],tags:je};let Ft;Ft=Se||this.options.generateId?j[he+3]:this.points[j[he+3]].id,Ft!==void 0&&(Mt.id=Ft),Te.features.push(Mt)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,j){const{radius:H,extent:se,reduce:ue,minPoints:Te}=this.options,_e=H/(se*Math.pow(2,j)),he=V.data,Se=[],je=this.stride;for(let Ue=0;Ue<he.length;Ue+=je){if(he[Ue+2]<=j)continue;he[Ue+2]=j;const gt=he[Ue],Mt=he[Ue+1],Ft=V.within(he[Ue],he[Ue+1],_e),yi=he[Ue+5];let ui=yi;for(const xe of Ft){const Ti=xe*je;he[Ti+2]>j&&(ui+=he[Ti+5])}if(ui>yi&&ui>=Te){let xe,Ti=gt*yi,Cn=Mt*yi,Ut=-1;const Si=(Ue/je<<5)+(j+1)+this.points.length;for(const $n of Ft){const Ei=$n*je;if(he[Ei+2]<=j)continue;he[Ei+2]=j;const wn=he[Ei+5];Ti+=he[Ei]*wn,Cn+=he[Ei+1]*wn,he[Ei+4]=Si,ue&&(xe||(xe=this._map(he,Ue,!0),Ut=this.clusterProps.length,this.clusterProps.push(xe)),ue(xe,this._map(he,Ei)))}he[Ue+4]=Si,Se.push(Ti/ui,Cn/ui,1/0,Si,-1,ui),ue&&Se.push(Ut)}else{for(let xe=0;xe<je;xe++)Se.push(he[Ue+xe]);if(ui>1)for(const xe of Ft){const Ti=xe*je;if(!(he[Ti+2]<=j)){he[Ti+2]=j;for(let Cn=0;Cn<je;Cn++)Se.push(he[Ti+Cn])}}}}return Se}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,j,H){if(V[j+5]>1){const Te=this.clusterProps[V[j+6]];return H?Object.assign({},Te):Te}const se=this.points[V[j+3]].properties,ue=this.options.map(se);return H&&ue===se?Object.assign({},ue):ue}}function cn(ve,V,j){return{type:"Feature",id:ve[V+3],properties:hn(ve,V,j),geometry:{type:"Point",coordinates:[(H=ve[V],360*(H-.5)),Kn(ve[V+1])]}};var H}function hn(ve,V,j){const H=ve[V+5],se=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H,ue=ve[V+6],Te=ue===-1?{}:Object.assign({},j[ue]);return Object.assign(Te,{cluster:!0,cluster_id:ve[V+3],point_count:H,point_count_abbreviated:se})}function Mi(ve){return ve/360+.5}function dn(ve){const V=Math.sin(ve*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function Kn(ve){const V=(180-360*ve)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Hi(ve,V,j,H){let se=H;const ue=V+(j-V>>1);let Te,_e=j-V;const he=ve[V],Se=ve[V+1],je=ve[j],Ue=ve[j+1];for(let gt=V+3;gt<j;gt+=3){const Mt=Ve(ve[gt],ve[gt+1],he,Se,je,Ue);if(Mt>se)Te=gt,se=Mt;else if(Mt===se){const Ft=Math.abs(gt-ue);Ft<_e&&(Te=gt,_e=Ft)}}se>H&&(Te-V>3&&Hi(ve,V,Te,H),ve[Te+2]=se,j-Te>3&&Hi(ve,Te,j,H))}function Ve(ve,V,j,H,se,ue){let Te=se-j,_e=ue-H;if(Te!==0||_e!==0){const he=((ve-j)*Te+(V-H)*_e)/(Te*Te+_e*_e);he>1?(j=se,H=ue):he>0&&(j+=Te*he,H+=_e*he)}return Te=ve-j,_e=V-H,Te*Te+_e*_e}function st(ve,V,j,H){const se={id:ve??null,type:V,geometry:j,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")Lt(se,j);else if(V==="Polygon")Lt(se,j[0]);else if(V==="MultiLineString")for(const ue of j)Lt(se,ue);else if(V==="MultiPolygon")for(const ue of j)Lt(se,ue[0]);return se}function Lt(ve,V){for(let j=0;j<V.length;j+=3)ve.minX=Math.min(ve.minX,V[j]),ve.minY=Math.min(ve.minY,V[j+1]),ve.maxX=Math.max(ve.maxX,V[j]),ve.maxY=Math.max(ve.maxY,V[j+1])}function Re(ve,V,j,H){if(!V.geometry)return;const se=V.geometry.coordinates;if(se&&se.length===0)return;const ue=V.geometry.type,Te=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2);let _e=[],he=V.id;if(j.promoteId?he=V.properties[j.promoteId]:j.generateId&&(he=H||0),ue==="Point")tt(se,_e);else if(ue==="MultiPoint")for(const Se of se)tt(Se,_e);else if(ue==="LineString")ie(se,_e,Te,!1);else if(ue==="MultiLineString"){if(j.lineMetrics){for(const Se of se)_e=[],ie(Se,_e,Te,!1),ve.push(st(he,"LineString",_e,V.properties));return}Ae(se,_e,Te,!1)}else if(ue==="Polygon")Ae(se,_e,Te,!0);else{if(ue!=="MultiPolygon"){if(ue==="GeometryCollection"){for(const Se of V.geometry.geometries)Re(ve,{id:he,geometry:Se,properties:V.properties},j,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Se of se){const je=[];Ae(Se,je,Te,!0),_e.push(je)}}ve.push(st(he,ue,_e,V.properties))}function tt(ve,V){V.push(it(ve[0]),Qe(ve[1]),0)}function ie(ve,V,j,H){let se,ue,Te=0;for(let he=0;he<ve.length;he++){const Se=it(ve[he][0]),je=Qe(ve[he][1]);V.push(Se,je,0),he>0&&(Te+=H?(se*je-Se*ue)/2:Math.sqrt(Math.pow(Se-se,2)+Math.pow(je-ue,2))),se=Se,ue=je}const _e=V.length-3;V[2]=1,Hi(V,0,_e,j),V[_e+2]=1,V.size=Math.abs(Te),V.start=0,V.end=V.size}function Ae(ve,V,j,H){for(let se=0;se<ve.length;se++){const ue=[];ie(ve[se],ue,j,H),V.push(ue)}}function it(ve){return ve/360+.5}function Qe(ve){const V=Math.sin(ve*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function ht(ve,V,j,H,se,ue,Te,_e){if(H/=V,ue>=(j/=V)&&Te<H)return ve;if(Te<j||ue>=H)return null;const he=[];for(const Se of ve){const je=Se.geometry;let Ue=Se.type;const gt=se===0?Se.minX:Se.minY,Mt=se===0?Se.maxX:Se.maxY;if(gt>=j&&Mt<H){he.push(Se);continue}if(Mt<j||gt>=H)continue;let Ft=[];if(Ue==="Point"||Ue==="MultiPoint")ft(je,Ft,j,H,se);else if(Ue==="LineString")Et(je,Ft,j,H,se,!1,_e.lineMetrics);else if(Ue==="MultiLineString")wi(je,Ft,j,H,se,!1);else if(Ue==="Polygon")wi(je,Ft,j,H,se,!0);else if(Ue==="MultiPolygon")for(const yi of je){const ui=[];wi(yi,ui,j,H,se,!0),ui.length&&Ft.push(ui)}if(Ft.length){if(_e.lineMetrics&&Ue==="LineString"){for(const yi of Ft)he.push(st(Se.id,Ue,yi,Se.tags));continue}Ue!=="LineString"&&Ue!=="MultiLineString"||(Ft.length===1?(Ue="LineString",Ft=Ft[0]):Ue="MultiLineString"),Ue!=="Point"&&Ue!=="MultiPoint"||(Ue=Ft.length===3?"Point":"MultiPoint"),he.push(st(Se.id,Ue,Ft,Se.tags))}}return he.length?he:null}function ft(ve,V,j,H,se){for(let ue=0;ue<ve.length;ue+=3){const Te=ve[ue+se];Te>=j&&Te<=H&&Jn(V,ve[ue],ve[ue+1],ve[ue+2])}}function Et(ve,V,j,H,se,ue,Te){let _e=ii(ve);const he=se===0?qs:Qr;let Se,je,Ue=ve.start;for(let ui=0;ui<ve.length-3;ui+=3){const xe=ve[ui],Ti=ve[ui+1],Cn=ve[ui+2],Ut=ve[ui+3],Si=ve[ui+4],$n=se===0?xe:Ti,Ei=se===0?Ut:Si;let wn=!1;Te&&(Se=Math.sqrt(Math.pow(xe-Ut,2)+Math.pow(Ti-Si,2))),$n<j?Ei>j&&(je=he(_e,xe,Ti,Ut,Si,j),Te&&(_e.start=Ue+Se*je)):$n>H?Ei<H&&(je=he(_e,xe,Ti,Ut,Si,H),Te&&(_e.start=Ue+Se*je)):Jn(_e,xe,Ti,Cn),Ei<j&&$n>=j&&(je=he(_e,xe,Ti,Ut,Si,j),wn=!0),Ei>H&&$n<=H&&(je=he(_e,xe,Ti,Ut,Si,H),wn=!0),!ue&&wn&&(Te&&(_e.end=Ue+Se*je),V.push(_e),_e=ii(ve)),Te&&(Ue+=Se)}let gt=ve.length-3;const Mt=ve[gt],Ft=ve[gt+1],yi=se===0?Mt:Ft;yi>=j&&yi<=H&&Jn(_e,Mt,Ft,ve[gt+2]),gt=_e.length-3,ue&&gt>=3&&(_e[gt]!==_e[0]||_e[gt+1]!==_e[1])&&Jn(_e,_e[0],_e[1],_e[2]),_e.length&&V.push(_e)}function ii(ve){const V=[];return V.size=ve.size,V.start=ve.start,V.end=ve.end,V}function wi(ve,V,j,H,se,ue){for(const Te of ve)Et(Te,V,j,H,se,ue,!1)}function Jn(ve,V,j,H){ve.push(V,j,H)}function qs(ve,V,j,H,se,ue){const Te=(ue-V)/(H-V);return Jn(ve,ue,j+(se-j)*Te,1),Te}function Qr(ve,V,j,H,se,ue){const Te=(ue-j)/(se-j);return Jn(ve,V+(H-V)*Te,ue,1),Te}function fl(ve,V){const j=[];for(let H=0;H<ve.length;H++){const se=ve[H],ue=se.type;let Te;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")Te=tn(se.geometry,V);else if(ue==="MultiLineString"||ue==="Polygon"){Te=[];for(const _e of se.geometry)Te.push(tn(_e,V))}else if(ue==="MultiPolygon"){Te=[];for(const _e of se.geometry){const he=[];for(const Se of _e)he.push(tn(Se,V));Te.push(he)}}j.push(st(se.id,ue,Te,se.tags))}return j}function tn(ve,V){const j=[];j.size=ve.size,ve.start!==void 0&&(j.start=ve.start,j.end=ve.end);for(let H=0;H<ve.length;H+=3)j.push(ve[H]+V,ve[H+1],ve[H+2]);return j}function Or(ve,V){if(ve.transformed)return ve;const j=1<<ve.z,H=ve.x,se=ve.y;for(const ue of ve.features){const Te=ue.geometry,_e=ue.type;if(ue.geometry=[],_e===1)for(let he=0;he<Te.length;he+=2)ue.geometry.push(ma(Te[he],Te[he+1],V,j,H,se));else for(let he=0;he<Te.length;he++){const Se=[];for(let je=0;je<Te[he].length;je+=2)Se.push(ma(Te[he][je],Te[he][je+1],V,j,H,se));ue.geometry.push(Se)}}return ve.transformed=!0,ve}function ma(ve,V,j,H,se,ue){return[Math.round(j*(ve*H-se)),Math.round(j*(V*H-ue))]}function fn(ve,V,j,H,se){const ue=V===se.maxZoom?0:se.tolerance/((1<<V)*se.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:ve.length,source:null,x:j,y:H,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const _e of ve)gs(Te,_e,ue,se);return Te}function gs(ve,V,j,H){const se=V.geometry,ue=V.type,Te=[];if(ve.minX=Math.min(ve.minX,V.minX),ve.minY=Math.min(ve.minY,V.minY),ve.maxX=Math.max(ve.maxX,V.maxX),ve.maxY=Math.max(ve.maxY,V.maxY),ue==="Point"||ue==="MultiPoint")for(let _e=0;_e<se.length;_e+=3)Te.push(se[_e],se[_e+1]),ve.numPoints++,ve.numSimplified++;else if(ue==="LineString")_s(Te,se,ve,j,!1,!1);else if(ue==="MultiLineString"||ue==="Polygon")for(let _e=0;_e<se.length;_e++)_s(Te,se[_e],ve,j,ue==="Polygon",_e===0);else if(ue==="MultiPolygon")for(let _e=0;_e<se.length;_e++){const he=se[_e];for(let Se=0;Se<he.length;Se++)_s(Te,he[Se],ve,j,!0,Se===0)}if(Te.length){let _e=V.tags||null;if(ue==="LineString"&&H.lineMetrics){_e={};for(const Se in V.tags)_e[Se]=V.tags[Se];_e.mapbox_clip_start=se.start/se.size,_e.mapbox_clip_end=se.end/se.size}const he={geometry:Te,type:ue==="Polygon"||ue==="MultiPolygon"?3:ue==="LineString"||ue==="MultiLineString"?2:1,tags:_e};V.id!==null&&(he.id=V.id),ve.features.push(he)}}function _s(ve,V,j,H,se,ue){const Te=H*H;if(H>0&&V.size<(se?Te:H))return void(j.numPoints+=V.length/3);const _e=[];for(let he=0;he<V.length;he+=3)(H===0||V[he+2]>Te)&&(j.numSimplified++,_e.push(V[he],V[he+1])),j.numPoints++;se&&(function(he,Se){let je=0;for(let Ue=0,gt=he.length,Mt=gt-2;Ue<gt;Mt=Ue,Ue+=2)je+=(he[Ue]-he[Mt])*(he[Ue+1]+he[Mt+1]);if(je>0===Se)for(let Ue=0,gt=he.length;Ue<gt/2;Ue+=2){const Mt=he[Ue],Ft=he[Ue+1];he[Ue]=he[gt-2-Ue],he[Ue+1]=he[gt-1-Ue],he[gt-2-Ue]=Mt,he[gt-1-Ue]=Ft}})(_e,ue),ve.push(_e)}const Zs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ha{constructor(V,j){const H=(j=this.options=(function(ue,Te){for(const _e in Te)ue[_e]=Te[_e];return ue})(Object.create(Zs),j)).debug;if(H&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");let se=(function(ue,Te){const _e=[];if(ue.type==="FeatureCollection")for(let he=0;he<ue.features.length;he++)Re(_e,ue.features[he],Te,he);else Re(_e,ue.type==="Feature"?ue:{geometry:ue},Te);return _e})(V,j);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),se=(function(ue,Te){const _e=Te.buffer/Te.extent;let he=ue;const Se=ht(ue,1,-1-_e,_e,0,-1,2,Te),je=ht(ue,1,1-_e,2+_e,0,-1,2,Te);return(Se||je)&&(he=ht(ue,1,-_e,1+_e,0,-1,2,Te)||[],Se&&(he=fl(Se,1).concat(he)),je&&(he=he.concat(fl(je,-1)))),he})(se,j),se.length&&this.splitTile(se,0,0,0),H&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,j,H,se,ue,Te,_e){const he=[V,j,H,se],Se=this.options,je=Se.debug;for(;he.length;){se=he.pop(),H=he.pop(),j=he.pop(),V=he.pop();const Ue=1<<j,gt=za(j,H,se);let Mt=this.tiles[gt];if(!Mt&&(je>1&&console.time("creation"),Mt=this.tiles[gt]=fn(V,j,H,se,Se),this.tileCoords.push({z:j,x:H,y:se}),je)){je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,H,se,Mt.numFeatures,Mt.numPoints,Mt.numSimplified),console.timeEnd("creation"));const wn=`z${j}`;this.stats[wn]=(this.stats[wn]||0)+1,this.total++}if(Mt.source=V,ue==null){if(j===Se.indexMaxZoom||Mt.numPoints<=Se.indexMaxPoints)continue}else{if(j===Se.maxZoom||j===ue)continue;if(ue!=null){const wn=ue-j;if(H!==Te>>wn||se!==_e>>wn)continue}}if(Mt.source=null,V.length===0)continue;je>1&&console.time("clipping");const Ft=.5*Se.buffer/Se.extent,yi=.5-Ft,ui=.5+Ft,xe=1+Ft;let Ti=null,Cn=null,Ut=null,Si=null,$n=ht(V,Ue,H-Ft,H+ui,0,Mt.minX,Mt.maxX,Se),Ei=ht(V,Ue,H+yi,H+xe,0,Mt.minX,Mt.maxX,Se);V=null,$n&&(Ti=ht($n,Ue,se-Ft,se+ui,1,Mt.minY,Mt.maxY,Se),Cn=ht($n,Ue,se+yi,se+xe,1,Mt.minY,Mt.maxY,Se),$n=null),Ei&&(Ut=ht(Ei,Ue,se-Ft,se+ui,1,Mt.minY,Mt.maxY,Se),Si=ht(Ei,Ue,se+yi,se+xe,1,Mt.minY,Mt.maxY,Se),Ei=null),je>1&&console.timeEnd("clipping"),he.push(Ti||[],j+1,2*H,2*se),he.push(Cn||[],j+1,2*H,2*se+1),he.push(Ut||[],j+1,2*H+1,2*se),he.push(Si||[],j+1,2*H+1,2*se+1)}}getTile(V,j,H){V=+V,j=+j,H=+H;const se=this.options,{extent:ue,debug:Te}=se;if(V<0||V>24)return null;const _e=1<<V,he=za(V,j=j+_e&_e-1,H);if(this.tiles[he])return Or(this.tiles[he],ue);Te>1&&console.log("drilling down to z%d-%d-%d",V,j,H);let Se,je=V,Ue=j,gt=H;for(;!Se&&je>0;)je--,Ue>>=1,gt>>=1,Se=this.tiles[za(je,Ue,gt)];return Se&&Se.source?(Te>1&&(console.log("found parent tile z%d-%d-%d",je,Ue,gt),console.time("drilling down")),this.splitTile(Se.source,je,Ue,gt,V,j,H),Te>1&&console.timeEnd("drilling down"),this.tiles[he]?Or(this.tiles[he],ue):null):null}}function za(ve,V,j){return 32*((1<<ve)*j+V)+ve}class pl extends me{constructor(V,j,H,se=er){super(V,j,H),this._dataUpdateable=new Map,this._createGeoJSONIndex=se}loadVectorTile(V,j){return k._(this,void 0,void 0,(function*(){const H=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const se=this._geoJSONIndex.getTile(H.z,H.x,H.y);return se?Ht(new k.d3(se.features,{version:2,extent:k.a5})):null}))}loadData(V){return k._(this,void 0,void 0,(function*(){var j;(j=this._pendingRequest)===null||j===void 0||j.abort();const H=this._startPerformance(V);this._pendingRequest=new AbortController;try{(!this._pendingData||V.request||V.data||V.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest));const se=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(se,V),this.loaded={};const ue={};return this._finishPerformance(H,V,ue),ue}catch(se){if(delete this._pendingRequest,k.Z(se))return{abandoned:!0};throw se}}))}_startPerformance(V){var j;if(!((j=V?.request)===null||j===void 0)&&j.collectResourceTiming)return new k.c$(V.request)}_finishPerformance(V,j,H){if(!V)return;const se=V.finish();se&&(H.resourceTiming={},H.resourceTiming[j.source]=JSON.parse(JSON.stringify(se)))}getData(){return k._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(V){const j=this.loaded;return j&&j[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,j){return k._(this,void 0,void 0,(function*(){let H;if(V.request?H=yield this.loadGeoJSONFromUrl(V.request,V.promoteId,j):V.data?H=this._loadGeoJSONFromObject(V.data,V.promoteId):V.dataDiff&&(H=this._loadGeoJSONFromDiff(V.dataDiff,V.promoteId,V.source)),delete this._pendingRequest,typeof H!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);return Yt(H,!0),V.filter&&(H=this._filterGeoJSON(H,V.filter)),H}))}loadGeoJSONFromUrl(V,j,H){return k._(this,void 0,void 0,(function*(){const se=yield k.j(V,H);return this._dataUpdateable=k.a7(se.data,j)?k.a8(se.data,j):void 0,se.data}))}_loadGeoJSONFromObject(V,j){return this._dataUpdateable=k.a7(V,j)?k.a8(V,j):void 0,V}_loadGeoJSONFromDiff(V,j,H){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${H}`);k.a9(this._dataUpdateable,V,j);const se=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(se)}_filterGeoJSON(V,j){const H=k.d4(j,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(H.result==="error")throw new Error(H.value.map((ue=>`${ue.key}: ${ue.message}`)).join(", "));const se=V.features.filter((ue=>H.value.evaluate({zoom:0},ue)));return this._toFeatureCollection(se)}_toFeatureCollection(V){return{type:"FeatureCollection",features:V}}removeSource(V){return k._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}function er(ve,V){return V.cluster?new Vi((function({superclusterOptions:j,clusterProperties:H}){if(!H||!j)return j;const se={},ue={},Te={accumulated:null,zoom:0},_e={properties:null},he=Object.keys(H);for(const Se of he){const[je,Ue]=H[Se],gt=k.d4(Ue),Mt=k.d4(typeof je=="string"?[je,["accumulated"],["get",Se]]:je);se[Se]=gt.value,ue[Se]=Mt.value}return j.map=Se=>{_e.properties=Se;const je={};for(const Ue of he)je[Ue]=se[Ue].evaluate(Te,_e);return je},j.reduce=(Se,je)=>{_e.properties=je;for(const Ue of he)Te.accumulated=Se[Ue],Se[Ue]=ue[Ue].evaluate(Te,_e)},j})(V)).load(ve.features):(function(j,H){return new Ha(j,H)})(ve,V.geojsonVtOptions)}class Fr{constructor(V){this.self=V,this.actor=new k.L(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(j,H)=>{if(this.externalWorkerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.externalWorkerSourceTypes[j]=H},this.self.addProtocol=k.cK,this.self.removeProtocol=k.cL,this.self.registerRTLTextPlugin=j=>{k.d5.setMethods(j)},this.actor.registerMessageHandler("LDT",((j,H)=>this._getDEMWorkerSource(j,H.source).loadTile(H))),this.actor.registerMessageHandler("RDT",((j,H)=>k._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(j,H.source).removeTile(H)})))),this.actor.registerMessageHandler("GCEZ",((j,H)=>k._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,H.type,H.source).getClusterExpansionZoom(H)})))),this.actor.registerMessageHandler("GCC",((j,H)=>k._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,H.type,H.source).getClusterChildren(H)})))),this.actor.registerMessageHandler("GCL",((j,H)=>k._(this,void 0,void 0,(function*(){return this._getWorkerSource(j,H.type,H.source).getClusterLeaves(H)})))),this.actor.registerMessageHandler("LD",((j,H)=>this._getWorkerSource(j,H.type,H.source).loadData(H))),this.actor.registerMessageHandler("GD",((j,H)=>this._getWorkerSource(j,H.type,H.source).getData())),this.actor.registerMessageHandler("LT",((j,H)=>this._getWorkerSource(j,H.type,H.source).loadTile(H))),this.actor.registerMessageHandler("RT",((j,H)=>this._getWorkerSource(j,H.type,H.source).reloadTile(H))),this.actor.registerMessageHandler("AT",((j,H)=>this._getWorkerSource(j,H.type,H.source).abortTile(H))),this.actor.registerMessageHandler("RMT",((j,H)=>this._getWorkerSource(j,H.type,H.source).removeTile(H))),this.actor.registerMessageHandler("RS",((j,H)=>k._(this,void 0,void 0,(function*(){if(!this.workerSources[j]||!this.workerSources[j][H.type]||!this.workerSources[j][H.type][H.source])return;const se=this.workerSources[j][H.type][H.source];delete this.workerSources[j][H.type][H.source],se.removeSource!==void 0&&se.removeSource(H)})))),this.actor.registerMessageHandler("RM",(j=>k._(this,void 0,void 0,(function*(){delete this.layerIndexes[j],delete this.availableImages[j],delete this.workerSources[j],delete this.demWorkerSources[j],this.globalStates.delete(j)})))),this.actor.registerMessageHandler("SR",((j,H)=>k._(this,void 0,void 0,(function*(){this.referrer=H})))),this.actor.registerMessageHandler("SRPS",((j,H)=>this._syncRTLPluginState(j,H))),this.actor.registerMessageHandler("IS",((j,H)=>k._(this,void 0,void 0,(function*(){this.self.importScripts(H)})))),this.actor.registerMessageHandler("SI",((j,H)=>this._setImages(j,H))),this.actor.registerMessageHandler("UL",((j,H)=>k._(this,void 0,void 0,(function*(){this._getLayerIndex(j).update(H.layers,H.removedIds,this._getGlobalState(j))})))),this.actor.registerMessageHandler("UGS",((j,H)=>k._(this,void 0,void 0,(function*(){const se=this._getGlobalState(j);for(const ue in H)se[ue]=H[ue]})))),this.actor.registerMessageHandler("SL",((j,H)=>k._(this,void 0,void 0,(function*(){this._getLayerIndex(j).replace(H,this._getGlobalState(j))}))))}_getGlobalState(V){let j=this.globalStates.get(V);return j||(j={},this.globalStates.set(V,j)),j}_setImages(V,j){return k._(this,void 0,void 0,(function*(){this.availableImages[V]=j;for(const H in this.workerSources[V]){const se=this.workerSources[V][H];for(const ue in se)se[ue].availableImages=j}}))}_syncRTLPluginState(V,j){return k._(this,void 0,void 0,(function*(){return yield k.d5.syncState(j,this.self.importScripts)}))}_getAvailableImages(V){let j=this.availableImages[V];return j||(j=[]),j}_getLayerIndex(V){let j=this.layerIndexes[V];return j||(j=this.layerIndexes[V]=new d),j}_getWorkerSource(V,j,H){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][j]||(this.workerSources[V][j]={}),!this.workerSources[V][j][H]){const se={sendAsync:(ue,Te)=>(ue.targetMapId=V,this.actor.sendAsync(ue,Te))};switch(j){case"vector":this.workerSources[V][j][H]=new me(se,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][j][H]=new pl(se,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][j][H]=new this.externalWorkerSourceTypes[j](se,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][j][H]}_getDEMWorkerSource(V,j){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][j]||(this.demWorkerSources[V][j]=new $t),this.demWorkerSources[V][j]}}return k.i(self)&&(self.worker=new Fr(self)),Fr})),rt("index",["exports","./shared"],(function(k,d){var ge="5.14.0";function Be(){var m=new d.A(4);return d.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let ut,mt,Ke;const kt={frame(m,t,a){const l=requestAnimationFrame((_=>{h(),t(_)})),{unsubscribe:h}=d.s(m.signal,"abort",(()=>{h(),cancelAnimationFrame(l),a(new d.a(m.signal.reason))}),!1)},frameAsync(m){return new Promise(((t,a)=>{this.frame(m,t,a)}))},getImageData(m,t=0){return this.getImageCanvasContext(m).getImageData(-t,-t,m.width+2*t,m.height+2*t)},getImageCanvasContext(m){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=m.width,t.height=m.height,a.drawImage(m,0,0,m.width,m.height),a},resolveURL:m=>(ut||(ut=document.createElement("a")),ut.href=m,ut.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return Ke!==void 0?Ke:!!matchMedia&&(mt==null&&(mt=matchMedia("(prefers-reduced-motion: reduce)")),mt.matches)},set prefersReducedMotion(m){Ke=m}},Ht=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(m){this._frozenAt=m}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function xt(){return Ht.getCurrentTime()}class me{static testProp(t){if(!me.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in me.docStyle)return t[a];return t[0]}static create(t,a,l){const h=window.document.createElement(t);return a!==void 0&&(h.className=a),l&&l.appendChild(h),h}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){me.docStyle&&me.selectProp&&(me.userSelect=me.docStyle[me.selectProp],me.docStyle[me.selectProp]="none")}static enableDrag(){me.docStyle&&me.selectProp&&(me.docStyle[me.selectProp]=me.userSelect)}static setTransform(t,a){t.style[me.transformProp]=a}static addEventListener(t,a,l,h={}){t.addEventListener(a,l,"passive"in h?h:h.capture)}static removeEventListener(t,a,l,h={}){t.removeEventListener(a,l,"passive"in h?h:h.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",me.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",me.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",me.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,l){const h=a.boundingClientRect;return new d.P((l.clientX-h.left)/a.x-t.clientLeft,(l.clientY-h.top)/a.y-t.clientTop)}static mousePos(t,a){const l=me.getScale(t);return me.getPoint(t,l,a)}static touchPos(t,a){const l=[],h=me.getScale(t);for(let _=0;_<a.length;_++)l.push(me.getPoint(t,h,a[_]));return l}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),l=a.querySelectorAll("script");for(const h of l)h.remove();return me.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const l=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!l.includes("javascript:")&&!l.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const l of a)me.removeAttributes(l),me.clean(l)}static removeAttributes(t){for(const{name:a,value:l}of t.attributes)me.isPossiblyDangerous(a,l)&&t.removeAttribute(a)}}me.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,me.selectProp=me.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),me.transformProp=me.testProp(["transform","WebkitTransform"]);const $t={supported:!1,testSupport:function(m){!Dt&&dt&&(Yt?It(m):jt=m)}};let jt,dt,Dt=!1,Yt=!1;function It(m){const t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,dt),m.isContextLost())return;$t.supported=!0}catch{}m.deleteTexture(t),Dt=!0}var bt;typeof document<"u"&&(dt=document.createElement("img"),dt.onload=()=>{jt&&It(jt),jt=null,Yt=!0},dt.onerror=()=>{Dt=!0,jt=null},dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(m){let t,a,l,h;m.resetRequestQueue=()=>{t=[],a=0,l=0,h={}},m.addThrottleControl=S=>{const A=l++;return h[A]=S,A},m.removeThrottleControl=S=>{delete h[S],v()},m.getImage=(S,A,z=!0)=>new Promise(((R,P)=>{$t.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),d.e(S,{type:"image"}),t.push({abortController:A,requestParameters:S,supportImageRefresh:z,state:"queued",onError:F=>{P(F)},onSuccess:F=>{R(F)}}),v()}));const _=S=>d._(this,void 0,void 0,(function*(){S.state="running";const{requestParameters:A,supportImageRefresh:z,onError:R,onSuccess:P,abortController:F}=S,U=z===!1&&!d.i(self)&&!d.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce(((Y,Q)=>Y&&Q==="accept"),!0));a++;const X=U?w(A,F):d.m(A,F);try{const Y=yield X;delete S.abortController,S.state="completed",Y.data instanceof HTMLImageElement||d.b(Y.data)?P(Y):Y.data&&P({data:yield(W=Y.data,typeof createImageBitmap=="function"?d.f(W):d.h(W)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete S.abortController,R(Y)}finally{a--,v()}var W})),v=()=>{const S=(()=>{for(const A of Object.keys(h))if(h[A]())return!0;return!1})()?d.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=a;A<S&&t.length>0;A++){const z=t.shift();z.abortController.signal.aborted?A--:_(z)}},w=(S,A)=>new Promise(((z,R)=>{const P=new Image,F=S.url,U=S.credentials;U&&U==="include"?P.crossOrigin="use-credentials":(U&&U==="same-origin"||!d.d(F))&&(P.crossOrigin="anonymous"),A.signal.addEventListener("abort",(()=>{P.src="",R(new d.a(A.signal.reason))})),P.fetchPriority="high",P.onload=()=>{P.onerror=P.onload=null,z({data:P})},P.onerror=()=>{P.onerror=P.onload=null,A.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},P.src=F}))})(bt||(bt={})),bt.resetRequestQueue();class li{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Vi(m){const t=[];if(typeof m=="string")t.push({id:"default",url:m});else if(m&&m.length>0){const a=[];for(const{id:l,url:h}of m){const _=`${l}${h}`;a.indexOf(_)===-1&&(a.push(_),t.push({id:l,url:h}))}}return t}function cn(m,t,a){try{const l=new URL(m);return l.pathname+=`${t}${a}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function hn(m){const{userImage:t}=m;return!!(t&&t.render&&t.render())&&(m.data.replace(new Uint8Array(t.data.buffer)),!0)}class Mi extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:l}of this.requestors)l(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const l=a.spriteData;a.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let l=!0;const h=a.data||a.spriteData;return this._validateStretch(a.stretchX,h&&h.width)||(this.fire(new d.k(new Error(`Image "${t}" has invalid "stretchX" value`))),l=!1),this._validateStretch(a.stretchY,h&&h.height)||(this.fire(new d.k(new Error(`Image "${t}" has invalid "stretchY" value`))),l=!1),this._validateContent(a.content,a)||(this.fire(new d.k(new Error(`Image "${t}" has invalid "content" value`))),l=!1),l}_validateStretch(t,a){if(!t)return!0;let l=0;for(const h of t){if(h[0]<l||h[1]<h[0]||a<h[1])return!1;l=h[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const l=a.spriteData,h=l&&l.width||a.data.width,_=l&&l.height||a.data.height;return!(t[0]<0||h<t[0]||t[1]<0||_<t[1]||t[2]<0||h<t[2]||t[3]<0||_<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,l=!0){const h=this.getImage(t);if(l&&(h.data.width!==a.data.width||h.data.height!==a.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=h.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,l)=>{let h=!0;if(!this.isLoaded())for(const _ of t)this.images[_]||(h=!1);this.isLoaded()||h?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const l of t){let h=this.getImage(l);h||(this.fire(new d.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?a[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],l=this.getImage(t);if(!l)return null;if(a&&a.position.version===l.version)return a.position;if(a)a.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},_=new d.I(h,l);this.patterns[t]={bin:h,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:a,h:l}=d.p(t),h=this.atlasImage;h.resize({width:a||1,height:l||1});for(const _ in this.patterns){const{bin:v}=this.patterns[_],w=v.x+1,S=v.y+1,A=this.getImage(_).data,z=A.width,R=A.height;d.R.copy(A,h,{x:0,y:0},{x:w,y:S},{width:z,height:R}),d.R.copy(A,h,{x:0,y:R-1},{x:w,y:S-1},{width:z,height:1}),d.R.copy(A,h,{x:0,y:0},{x:w,y:S+R},{width:z,height:1}),d.R.copy(A,h,{x:z-1,y:0},{x:w-1,y:S},{width:1,height:R}),d.R.copy(A,h,{x:0,y:0},{x:w+z,y:S},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const l=this.getImage(a);l||d.w(`Image with ID: "${a}" was not found`),hn(l)&&this.updateImage(a,l)}}cloneImages(){const t={};for(const a in this.images){const l=this.images[a];t[a]=Object.assign(Object.assign({},l),{data:l.data?l.data.clone():null})}return t}}const dn=1e20;function Kn(m,t,a,l,h,_,v,w,S){for(let A=t;A<t+l;A++)Hi(m,a*_+A,_,h,v,w,S);for(let A=a;A<a+h;A++)Hi(m,A*_+t,1,l,v,w,S)}function Hi(m,t,a,l,h,_,v){_[0]=0,v[0]=-dn,v[1]=dn,h[0]=m[t];for(let w=1,S=0,A=0;w<l;w++){h[w]=m[t+w*a];const z=w*w;do{const R=_[S];A=(h[w]-h[R]+z-R*R)/(w-R)/2}while(A<=v[S]&&--S>-1);S++,_[S]=w,v[S]=A,v[S+1]=dn}for(let w=0,S=0;w<l;w++){for(;v[S+1]<w;)S++;const A=_[S],z=w-A;m[t+w*a]=h[A]+z*z}}const Ve=d.v.layout_symbol["text-font"].default.join(",");class st{constructor(t,a,l){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=l}setURL(t){this.url=t}getGlyphs(t){return d._(this,void 0,void 0,(function*(){const a=[];for(const _ in t)for(const v of t[_])a.push(this._getAndCacheGlyphsPromise(_,v));const l=yield Promise.all(a),h={};for(const{stack:_,id:v,glyph:w}of l)h[_]||(h[_]={}),h[_][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return h}))}_getAndCacheGlyphsPromise(t,a){return d._(this,void 0,void 0,(function*(){let l=this.entries[t];l||(l=this.entries[t]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[a];return h!==void 0?{stack:t,id:a,glyph:h}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(h=l.glyphs[a]=this._drawGlyph(l,t,a),{stack:t,id:a,glyph:h}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return d._(this,void 0,void 0,(function*(){const l=this.entries[t],h=Math.floor(a/256);if(l.ranges[h])return{stack:t,id:a,glyph:null};if(!l.requests[h]){const _=st.loadGlyphRange(t,h,this.url,this.requestManager);l.requests[h]=_}try{const _=yield l.requests[h];for(const v in _)l.glyphs[+v]=_[+v];return l.ranges[h]=!0,{stack:t,id:a,glyph:_[a]||null}}catch(_){const v=l.glyphs[a]=this._drawGlyph(l,t,a);return this._warnOnMissingGlyphRange(v,h,a,_),{stack:t,id:a,glyph:v}}}))}_warnOnMissingGlyphRange(t,a,l,h){const _=256*a,v=_+255,w=l.toString(16).padStart(4,"0").toUpperCase();d.w(`Unable to load glyph range ${a}, ${_}-${v}. Rendering codepoint U+${w} locally instead. ${h}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&d.q(t)}_drawGlyph(t,a,l){const h=a===Ve&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(l),_=h?"ideographTinySDF":"tinySDF";t[_]||(t[_]=this._createTinySDF(h?this.localIdeographFontFamily:a));const v=t[_].draw(String.fromCodePoint(l));return{id:l,bitmap:new d.r({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const l=a.map((h=>/[-\w]+/.test(h)?h:`'${CSS.escape(h)}'`)).join(",");return new st.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:l,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let l;for(const[h,_]of Object.entries(a))new RegExp(`\\b${h}\\b`,"i").test(t)&&(l=`${_}`);return l}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}st.loadGlyphRange=function(m,t,a,l){return d._(this,void 0,void 0,(function*(){const h=256*t,_=h+255,v=l.transformRequest(a.replace("{fontstack}",m).replace("{range}",`${h}-${_}`),"Glyphs"),w=yield d.n(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${t}, ${h}-${_}`);const S={};for(const A of d.o(w.data))S[A.id]=A;return S}))},st.TinySDF=class{constructor({fontSize:m=24,buffer:t=3,radius:a=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:_="normal",fontStyle:v="normal",lang:w=null}={}){this.buffer=t,this.cutoff=l,this.radius=a,this.lang=w;const S=this.size=m+4*t,A=this._createCanvas(S),z=this.ctx=A.getContext("2d",{willReadFrequently:!0});z.font=`${v} ${_} ${m}px ${h}`,z.textBaseline="alphabetic",z.textAlign="left",z.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(m){const t=document.createElement("canvas");return t.width=t.height=m,t}draw(m){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:_}=this.ctx.measureText(m),v=Math.ceil(a),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-h))),S=Math.min(this.size-this.buffer,v+Math.ceil(l)),A=w+2*this.buffer,z=S+2*this.buffer,R=Math.max(A*z,0),P=new Uint8ClampedArray(R),F={data:P,width:A,height:z,glyphWidth:w,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(w===0||S===0)return F;const{ctx:U,buffer:X,gridInner:W,gridOuter:Y}=this;this.lang&&(U.lang=this.lang),U.clearRect(X,X,w,S),U.fillText(m,X,X+v);const Q=U.getImageData(X,X,w,S);Y.fill(dn,0,R),W.fill(0,0,R);for(let ne=0;ne<S;ne++)for(let K=0;K<w;K++){const ae=Q.data[4*(ne*w+K)+3]/255;if(ae===0)continue;const le=(ne+X)*A+K+X;if(ae===1)Y[le]=0,W[le]=dn;else{const ee=.5-ae;Y[le]=ee>0?ee*ee:0,W[le]=ee<0?ee*ee:0}}Kn(Y,0,0,A,z,A,this.f,this.v,this.z),Kn(W,X,X,w,S,A,this.f,this.v,this.z);for(let ne=0;ne<R;ne++){const K=Math.sqrt(Y[ne])-Math.sqrt(W[ne]);P[ne]=Math.round(255-255*(K/this.radius+this.cutoff))}return F}};class Lt{constructor(){this.specification=d.u.light.position}possiblyEvaluate(t,a){return d.F(t.expression.evaluate(a))}interpolate(t,a,l){return{x:d.G.number(t.x,a.x,l),y:d.G.number(t.y,a.y,l),z:d.G.number(t.z,a.z,l)}}}let Re;class tt extends d.E{constructor(t){super(),Re=Re||new d.t({anchor:new d.D(d.u.light.anchor),position:new Lt,color:new d.D(d.u.light.color),intensity:new d.D(d.u.light.intensity)}),this._transitionable=new d.x(Re,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(d.y,t,a))for(const l in t){const h=t[l];l.endsWith(d.z)?this._transitionable.setTransition(l.slice(0,-d.z.length),h):this._transitionable.setValue(l,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,l){return(!l||l.validate!==!1)&&d.B(this,t.call(d.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.u}))}}const ie=new d.t({"sky-color":new d.D(d.u.sky["sky-color"]),"horizon-color":new d.D(d.u.sky["horizon-color"]),"fog-color":new d.D(d.u.sky["fog-color"]),"fog-ground-blend":new d.D(d.u.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.u.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.u.sky["atmosphere-blend"])});class Ae extends d.E{constructor(t){super(),this._transitionable=new d.x(ie,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.H(0))}setSky(t,a={}){if(!this._validate(d.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in t){const h=t[l];l.endsWith(d.z)?this._transitionable.setTransition(l.slice(0,-d.z.length),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,l={}){return l?.validate!==!1&&d.B(this,t.call(d.C,d.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:d.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class it{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const l=t.join(",")+String(a);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(t,a)),this.dashEntry[l]}getDashRanges(t,a,l){const h=[];let _=t.length%2==1?-t[t.length-1]*l:0,v=t[0]*l,w=!0;h.push({left:_,right:v,isDash:w,zeroLength:t[0]===0});let S=t[0];for(let A=1;A<t.length;A++){w=!w;const z=t[A];_=S*l,S+=z,v=S*l,h.push({left:_,right:v,isDash:w,zeroLength:z===0})}return h}addRoundDash(t,a,l){const h=a/2;for(let _=-l;_<=l;_++){const v=this.width*(this.nextRow+l+_);let w=0,S=t[w];for(let A=0;A<this.width;A++){A/S.right>1&&(S=t[++w]);const z=Math.abs(A-S.left),R=Math.abs(A-S.right),P=Math.min(z,R);let F;const U=_/l*(h+1);if(S.isDash){const X=h-Math.abs(U);F=Math.sqrt(P*P+X*X)}else F=h-Math.sqrt(P*P+U*U);this.data[v+A]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const S=t[w],A=t[w+1];S.zeroLength?t.splice(w,1):A&&A.isDash===S.isDash&&(A.left=S.left,t.splice(w,1))}const a=t[0],l=t[t.length-1];a.isDash===l.isDash&&(a.left=l.left-this.width,l.right=a.right+this.width);const h=this.width*this.nextRow;let _=0,v=t[_];for(let w=0;w<this.width;w++){w/v.right>1&&(v=t[++_]);const S=Math.abs(w-v.left),A=Math.abs(w-v.right),z=Math.min(S,A);this.data[h+w]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(t,a){const l=a?7:0,h=2*l+1;if(this.nextRow+h>this.height)return d.w("LineAtlas out of space"),null;let _=0;for(let w=0;w<t.length;w++)_+=t[w];if(_!==0){const w=this.width/_,S=this.getDashRanges(t,this.width,w);a?this.addRoundDash(S,w,l):this.addRegularDash(S)}const v={y:this.nextRow+l,height:2*l,width:_};return this.nextRow+=h,this.dirty=!0,v}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Qe="maplibre_preloaded_worker_pool";class ht{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ht.workerCount;)this.workers.push(new Worker(d.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Qe]}numActive(){return Object.keys(this.active).length}}const ft=Math.floor(kt.hardwareConcurrency/2);let Et,ii;function wi(){return Et||(Et=new ht),Et}ht.workerCount=d.K(globalThis)?Math.max(Math.min(ft,3),1):1;class Jn{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const l=this.workerPool.acquire(a);for(let h=0;h<l.length;h++){const _=new d.L(l[h],a);_.name=`Worker ${h}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:t,data:a}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const l of this.actors)l.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function qs(){return ii||(ii=new Jn(wi(),d.M),ii.registerMessageHandler("GR",((m,t,a)=>d.m(t,a)))),ii}function Qr(m,t){const a=d.N();return d.O(a,a,[1,1,0]),d.Q(a,a,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?d.S(a,a,m.calculatePosMatrix(t.toUnwrapped())):a}function fl(m,t,a,l,h,_,v){var w;const S=(function(P,F,U){if(P)for(const X of P){const W=F[X];if(W&&W.source===U&&W.type==="fill-extrusion")return!0}else for(const X in F){const W=F[X];if(W.source===U&&W.type==="fill-extrusion")return!0}return!1})((w=h?.layers)!==null&&w!==void 0?w:null,t,m.id),A=_.maxPitchScaleFactor(),z=m.tilesIn(l,A,S);z.sort(tn);const R=[];for(const P of z)R.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(t,a,m.getState(),P.queryGeometry,P.cameraQueryGeometry,P.scale,h,_,A,Qr(_,P.tileID),v?(F,U)=>v(P.tileID,F,U):void 0)});return(function(P,F){for(const U in P)for(const X of P[U])Or(X,F);return P})((function(P){const F={},U={};for(const X of P){const W=X.queryResults,Y=X.wrappedTileID,Q=U[Y]=U[Y]||{};for(const ne in W){const K=W[ne],ae=Q[ne]=Q[ne]||{},le=F[ne]=F[ne]||[];for(const ee of K)ae[ee.featureIndex]||(ae[ee.featureIndex]=!0,le.push(ee))}}return F})(R),m)}function tn(m,t){const a=m.tileID,l=t.tileID;return a.overscaledZ-l.overscaledZ||a.canonical.y-l.canonical.y||a.wrap-l.wrap||a.canonical.x-l.canonical.x}function Or(m,t){const a=m.feature,l=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=l}function ma(m,t,a){return d._(this,void 0,void 0,(function*(){let l=m;if(m.url?l=(yield d.j(t.transformRequest(m.url,"Source"),a)).data:yield kt.frameAsync(a),!l)return null;const h=d.U(d.e(l,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map((_=>_.id))),h}))}class fn{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof d.V?new d.V(t.lng,t.lat):d.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof d.V?new d.V(t.lng,t.lat):d.V.convert(t),this}extend(t){const a=this._sw,l=this._ne;let h,_;if(t instanceof d.V)h=t,_=t;else{if(!(t instanceof fn))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(fn.convert(t)):this.extend(d.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(d.V.convert(t)):this;if(h=t._sw,_=t._ne,!h||!_)return this}return a||l?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),l.lng=Math.max(_.lng,l.lng),l.lat=Math.max(_.lat,l.lat)):(this._sw=new d.V(h.lng,h.lat),this._ne=new d.V(_.lng,_.lat)),this}getCenter(){return new d.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.V(this.getWest(),this.getNorth())}getSouthEast(){return new d.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:l}=d.V.convert(t);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}intersects(t){if(!((t=fn.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=d.W(this.getWest(),-180,180),l=d.W(this.getEast(),-180,180),h=d.W(t.getWest(),-180,180),_=d.W(t.getEast(),-180,180),v=a>=l,w=h>=_;return!(!v||!w)||(v?_>=a||h<=l:w?l>=h||a<=_:h<=l&&_>=a)}static convert(t){return t instanceof fn?t:t&&new fn(t)}static fromLngLat(t,a=0){const l=360*a/40075017,h=l/Math.cos(Math.PI/180*t.lat);return new fn(new d.V(t.lng-h,t.lat-l),new d.V(t.lng+h,t.lat+l))}adjustAntiMeridian(){const t=new d.V(this._sw.lng,this._sw.lat),a=new d.V(this._ne.lng,this._ne.lat);return new fn(t,t.lng>a.lng?new d.V(a.lng+360,a.lat):a)}}class gs{constructor(t,a,l){this.bounds=fn.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=l||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),l=Math.floor(d.Y(this.bounds.getWest())*a),h=Math.floor(d.X(this.bounds.getNorth())*a),_=Math.ceil(d.Y(this.bounds.getEast())*a),v=Math.ceil(d.X(this.bounds.getSouth())*a);return t.x>=l&&t.x<_&&t.y>=h&&t.y<v}}class _s extends d.E{constructor(t,a,l,h){if(super(),this.id=t,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=d.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield ma(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(d.e(this,t),t.bounds&&(this.tileBounds=new gs(t.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,d.Z(t)||this.fire(new d.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(t){return d._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((_,v)=>{t.reloadPromise={resolve:_,reject:v}}))}else t.actor=this.dispatcher.getActor(),h="LT";t.abortController=new AbortController;try{const _=yield t.actor.sendAsync({type:h,data:l},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,_)}catch(_){if(delete t.abortController,t.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,l=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(l,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const l=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(l.resolve).catch(l.reject)}}abortTile(t){return d._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Zs extends d.E{constructor(t,a,l,h){super(),this.id=t,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},a),d.e(this,d.U(a,["url","scheme","tileSize"]))}load(){return d._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield ma(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(d.e(this,a),a.bounds&&(this.tileBounds=new gs(a.bounds,this.minzoom,this.maxzoom)),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,d.Z(a)||this.fire(new d.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return d.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return d._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const l=yield bt.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&t.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,_=h.gl,v=l.data;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new d.T(h,v,_.RGBA,{useMipmap:!0}),t.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(l){if(delete t.abortController,t.aborted)t.state="unloaded";else if(l)throw t.state="errored",l}}))}abortTile(t){return d._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class Ha extends Zs{constructor(t,a,l,h){super(t,a,l,h),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return d._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const h=yield bt.getImage(l,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){const _=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const v=d.b(_)&&d.$()?_:yield this.readImageNow(_),w={type:this.type,uid:t.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const S=yield t.actor.sendAsync({type:"LDT",data:w});t.dem=S,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}}))}readImageNow(t){return d._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&d.a0()){const a=t.width+2,l=t.height+2;try{return new d.R({width:a,height:l},yield d.a1(t,-1,-1,a,l))}catch{}}return kt.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,l=Math.pow(2,a.z),h=(a.x-1+l)%l,_=a.x===0?t.wrap-1:t.wrap,v=(a.x+1+l)%l,w=a.x+1===l?t.wrap+1:t.wrap,S={};return S[new d.a2(t.overscaledZ,_,a.z,h,a.y).key]={backfilled:!1},S[new d.a2(t.overscaledZ,w,a.z,v,a.y).key]={backfilled:!1},a.y>0&&(S[new d.a2(t.overscaledZ,_,a.z,h,a.y-1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,w,a.z,v,a.y-1).key]={backfilled:!1}),a.y+1<l&&(S[new d.a2(t.overscaledZ,_,a.z,h,a.y+1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},S[new d.a2(t.overscaledZ,w,a.z,v,a.y+1).key]={backfilled:!1}),S}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function za(m){return m.type==="GeometryCollection"?m.geometries.map((t=>t.coordinates)).flat(1/0):m.coordinates.flat(1/0)}function pl(m){const t=new fn;let a;switch(m.type){case"FeatureCollection":a=m.features.map((l=>za(l.geometry))).flat(1/0);break;case"Feature":a=za(m.geometry);break;default:a=za(m)}if(a.length==0)return t;for(let l=0;l<a.length-1;l+=2)t.extend([a[l],a[l+1]]);return t}class er extends d.E{constructor(t,a,l,h){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=l.getActor(),this.setEventedParent(h),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=d.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:d.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:d.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(d.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||d.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return d._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const l=this._updateWorkerData();return a?l:this}updateData(t,a){this._pendingWorkerUpdate.diff=d.a6(this._pendingWorkerUpdate.diff,t);const l=this._updateWorkerData();return a?l:this}getData(){return d._(this,void 0,void 0,(function*(){const t=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return d._(this,void 0,void 0,(function*(){return pl(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:l}})}_updateWorkerData(){return d._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void d.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,l=d.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(l.request=this.map._requestManager.transformRequest(kt.resolveURL(t),"Source"),l.request.collectResourceTiming=this._collectResourceTiming):l.data=t,this._pendingWorkerUpdate.data=void 0):a&&(l.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new d.l("dataloading",{dataType:"source"}));try{const h=yield this.actor.sendAsync({type:"LD",data:l});if(this._isUpdatingWorker=!1,this._removed||h.abandoned)return void this.fire(new d.l("dataabort",{dataType:"source"}));a&&this._applyDiff(a);let _=null;h.resourceTiming&&h.resourceTiming[this.id]&&(_=h.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&_&&_.length>0&&d.e(v,{resourceTiming:_}),this.fire(new d.l("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new d.l("data",Object.assign(Object.assign({},v),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(a)})))}catch(h){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new d.l("dataabort",{dataType:"source"}));this.fire(new d.k(h))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiff(t){const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){if(!d.a7(this._data.geojson,a))throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:d.a8(this._data.geojson,a)}}this._data.updateable&&d.a9(this._data.updateable,t,a)}_getShouldReloadTileOptions(t){if(this._options.cluster||!t||t.removeAll)return;const{add:a=[],update:l=[],remove:h=[]}=t||{},_=new Set([...l.map((v=>v.id)),...h]);for(const v of _.values())if(typeof v!="number"&&this.promoteId==null)return void d.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs. Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...l.map((v=>v.newGeometry)),...a.map((v=>v.geometry))].filter(Boolean).map((v=>pl(v))),prevIds:_}}shouldReloadTile(t,{nextBounds:a,prevIds:l}){if(!t.latestFeatureIndex)return t.state!=="unloaded";const h=t.latestFeatureIndex.loadVTLayers();for(let S=0;S<t.latestFeatureIndex.featureIndexArray.length;S++){const A=t.latestFeatureIndex.featureIndexArray.get(S),z=h[d.aa].feature(A.featureIndex),R=t.latestFeatureIndex.getId(z,d.aa);if(l.has(R))return!0}const{buffer:_,extent:v}=this.workerOptions.geojsonVtOptions,w=(function({x:S,y:A,z},R=0){const P=d.a3((S-R)/Math.pow(2,z)),F=d.a4((A+1+R)/Math.pow(2,z)),U=d.a3((S+1+R)/Math.pow(2,z)),X=d.a4((A-R)/Math.pow(2,z));return new fn([P,F],[U,X])})(t.tileID.canonical,_/v);for(const S of a)if(w.intersects(S))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return d._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const l={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const h=yield this.actor.sendAsync({type:a,data:l},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(h,this.map.painter,a==="RT")}))}abortTile(t){return d._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return d._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Fr extends d.E{constructor(t,a,l,h){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=l,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=a}load(t){return d._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new d.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield bt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,d.Z(a)||this.fire(new d.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(d.ab.fromLngLat);var l;return this.tileID=(function(h){const _=d.ac.fromPoints(h),v=_.width(),w=_.height(),S=Math.max(v,w),A=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),z=Math.pow(2,A);return new d.ae(A,Math.floor((_.minX+_.maxX)/2*z),Math.floor((_.minY+_.maxY)/2*z))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((h=>this.tileID.getTilePoint(h)._round())),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new d.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new d.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return d._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:l,maxX:h,maxY:_}=d.ac.fromPoints(t),v={};for(let w=0;w<=d.ad;w++){const S=Math.pow(2,w),A=Math.floor(a*S),z=Math.floor(l*S),R=Math.floor(h*S),P=Math.floor(_*S);v[w]={minTileX:A,minTileY:z,maxTileX:R,maxTileY:P}}return v}}class ve extends Fr{constructor(t,a,l,h){super(t,a,l,h),this.roundZoom=!0,this.type="video",this.options=a}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield d.af(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new d.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new d.k(new d.ag(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new d.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const _=this.tiles[h];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,l=!0)}l&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class V extends Fr{constructor(t,a,l,h){super(t,a,l,h),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((_=>!Array.isArray(_)||_.length!==2||_.some((v=>typeof v!="number"))))||this.fire(new d.k(new d.ag(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.k(new d.ag(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new d.k(new d.ag(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new d.k(new d.ag(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.k(new d.ag(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return d._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,l=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new d.T(a,this.canvas,l.RGBA,{premultiply:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));let h=!1;for(const _ in this.tiles){const v=this.tiles[_];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,h=!0)}h&&this.fire(new d.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const j={},H=m=>{switch(m){case"geojson":return er;case"image":return Fr;case"raster":return Zs;case"raster-dem":return Ha;case"vector":return _s;case"video":return ve;case"canvas":return V}return j[m]},se="RTLPluginLoaded";class ue extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=qs()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return d._(this,arguments,void 0,(function*(a,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=kt.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return d._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.l(se))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Te=null;function _e(){return Te||(Te=new ue),Te}var he,Se;(function(m){m[m.Base=0]="Base",m[m.Parent=1]="Parent"})(he||(he={})),(function(m){m[m.Departing=0]="Departing",m[m.Incoming=1]="Incoming"})(Se||(Se={}));class je{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=d.ah(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:l,fadeEndTime:h}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=l,this.fadeEndTime=h}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=xt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(h,_){const v={};if(!_)return v;for(const w of h){const S=w.layerIds.map((A=>_.getLayer(A))).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map((A=>S.filter((z=>z.id===A))[0])));for(const A of S)v[A.id]=w}}return v})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof d.aj){if(this.hasSymbolBuckets=!0,!l)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const _=this.buckets[h];if(_ instanceof d.aj&&_.hasRTLText){this.hasRTLText=!0,_e().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const _=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(h).queryRadius(_))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new d.ai}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new d.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new d.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,l,h,_,v,w,S,A,z,R){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:_,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:S,params:w,queryPadding:this.queryPadding*A,getElevation:R},t,a,l):{}}querySourceFeatures(t,a){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),_=a&&a.sourceLayer?a.sourceLayer:"",v=h[d.aa]||h[_];if(!v)return;const w=d.ak(a?.filter,a?.globalState),{z:S,x:A,y:z}=this.tileID.canonical,R={z:S,x:A,y:z};for(let P=0;P<v.length;P++){const F=v.feature(P);if(w.needGeometry){const W=d.al(F,!0);if(!w.filter(new d.H(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!w.filter(new d.H(this.tileID.overscaledZ),F))continue;const U=l.getId(F,_),X=new d.am(F,S,A,z,U);X.tile=R,t.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const l=d.an(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(a)if(this.expirationTime<a)h=!0;else{const _=this.expirationTime-a;_?this.expirationTime=l+Math.max(_,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!a.style.hasLayer(h))continue;const _=this.buckets[h],v=_.layers[0].sourceLayer||d.aa,w=l[v],S=t[v];if(!w||!S||Object.keys(S).length===0)continue;_.update(S,w,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const A=a&&a.style&&a.style.getLayer(h);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(_)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<xt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=xt()+t}setDependencies(t,a){const l={};for(const h of a)l[h]=!0;this.dependencies[t]=l}hasDependency(t,a){for(const l of t){const h=this.dependencies[l];if(h){for(const _ of a)if(h[_])return!0}}return!1}}class Ue{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,l){const h=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},d.e(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==h&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const _ in this.state[t][h])l[_]||(this.deletedStates[t][h][_]=null)}else for(const _ in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][_]===null&&delete this.deletedStates[t][h][_]}removeFeatureState(t,a,l){if(this.deletedStates[t]===null)return;const h=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&a!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,a){const l=String(a),h=d.e({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const _=this.deletedStates[t][a];if(_===null)return{};for(const v in _)delete h[v]}return h}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const _={};for(const v in this.stateChanges[h])this.state[h][v]||(this.state[h][v]={}),d.e(this.state[h][v],this.stateChanges[h][v]),_[v]=this.state[h][v];l[h]=_}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const _={};if(this.deletedStates[h]===null)for(const v in this.state[h])_[v]={},this.state[h][v]={};else for(const v in this.deletedStates[h]){if(this.deletedStates[h][v]===null)this.state[h][v]={};else for(const w of Object.keys(this.deletedStates[h][v]))delete this.state[h][v][w];_[v]=this.state[h][v]}l[h]=l[h]||{},d.e(l[h],_)}this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0&&t.setFeatureState(l,a)}}const gt=89.25;function Mt(m,t){const a=d.ao(t.lat,-d.ap,d.ap);return new d.P(d.Y(t.lng)*m,d.X(a)*m)}function Ft(m,t){return new d.ab(t.x/m,t.y/m).toLngLat()}function yi(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(d.aq(90-m.pitch)),Math.tan(d.aq(gt-m.pitch)))}function ui(m,t){const a=m.canonical,l=t/d.ar(a.z),h=a.x+Math.pow(2,a.z)*m.wrap,_=d.as(new Float64Array(16));return d.O(_,_,[h*l,a.y*l,0]),d.Q(_,_,[l/d.a5,l/d.a5,1]),_}function xe(m,t,a,l,h){const _=d.ab.fromLngLat(m,t),v=h*d.at(1,m.lat),{x:w,y:S,z:A}=Ti(a,l);return new d.ab(_.x+v*-w,_.y+v*-S,_.z+v*-A)}function Ti(m,t){const a=d.aq(m),l=d.aq(t),h=Math.cos(-a),_=Math.sin(a);return{x:_*Math.sin(l),y:-_*Math.cos(l),z:h}}function Cn(m,t,a){const l=t.intersectsFrustum(m);if(!a||l===0)return l;const h=t.intersectsPlane(a);return h===0?0:l===2&&h===2?2:1}function Ut(m,t,a){let l=0;const h=(a-t)/10;for(let _=0;_<10;_++)l+=h*Math.pow(Math.cos(t+(_+.5)/10*(a-t)),m);return l}function Si(m,t){return function(a,l,h,_,v){const w=2*((m-1)/d.au(Math.cos(d.aq(gt-v))/Math.cos(d.aq(gt)))-1),S=Math.acos(h/_),A=2*Ut(w-1,0,d.aq(v/2)),z=Math.min(d.aq(gt),S+d.aq(v/2)),R=Ut(w-1,Math.min(z,S-d.aq(v/2)),z),P=Math.atan(l/h),F=Math.hypot(l,h);let U=a;return U+=d.au(_/F/Math.max(.5,Math.cos(d.aq(v/2)))),U+=w*d.au(Math.cos(P))/2,U-=d.au(Math.max(1,R/A/t))/2,U}}const $n=Si(9.314,3);function Ei(m,t){const a=(t.roundZoom?Math.round:Math.floor)(m.zoom+d.au(m.tileSize/t.tileSize));return Math.max(0,a)}function wn(m,t){const a=m.getCameraFrustum(),l=m.getClippingPlane(),h=m.screenPointToMercatorCoordinate(m.getCameraPoint()),_=d.ab.fromLngLat(m.center,m.elevation);h.z=_.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;const v=m.getCoveringTilesDetailsProvider(),w=v.allowVariableZoom(m,t),S=Ei(m,t),A=t.minzoom||0,z=t.maxzoom!==void 0?t.maxzoom:m.maxZoom,R=Math.min(Math.max(0,S),z),P=Math.pow(2,R),F=[P*h.x,P*h.y,0],U=[P*_.x,P*_.y,0],X=Math.hypot(_.x-h.x,_.y-h.y),W=Math.abs(_.z-h.z),Y=Math.hypot(X,W),Q=ae=>({zoom:0,x:0,y:0,wrap:ae,fullyVisible:!1}),ne=[],K=[];if(m.renderWorldCopies&&v.allowWorldCopies())for(let ae=1;ae<=3;ae++)ne.push(Q(-ae)),ne.push(Q(ae));for(ne.push(Q(0));ne.length>0;){const ae=ne.pop(),le=ae.x,ee=ae.y;let de=ae.fullyVisible;const Me={x:le,y:ee,z:ae.zoom},be=v.getTileBoundingVolume(Me,ae.wrap,m.elevation,t);if(!de){const et=Cn(a,be,l);if(et===0)continue;de=et===2}const Ee=v.distanceToTile2d(h.x,h.y,Me,be);let Ce=S;w&&(Ce=(t.calculateTileZoom||$n)(m.zoom+d.au(m.tileSize/t.tileSize),Ee,W,Y,m.fov)),Ce=(t.roundZoom?Math.round:Math.floor)(Ce),Ce=Math.max(0,Ce);const He=Math.min(Ce,z);if(ae.wrap=v.getWrap(_,Me,ae.wrap),ae.zoom>=He){if(ae.zoom<A)continue;const et=R-ae.zoom,qe=F[0]-.5-(le<<et),wt=F[1]-.5-(ee<<et),Vt=t.reparseOverscaled?Math.max(ae.zoom,Ce):ae.zoom;K.push({tileID:new d.a2(ae.zoom===z?Vt:ae.zoom,ae.wrap,ae.zoom,le,ee),distanceSq:d.av([U[0]-.5-le,U[1]-.5-ee]),tileDistanceToCamera:Math.sqrt(qe*qe+wt*wt)})}else for(let et=0;et<4;et++)ne.push({zoom:ae.zoom+1,x:(le<<1)+et%2,y:(ee<<1)+(et>>1),wrap:ae.wrap,fullyVisible:de})}return K.sort(((ae,le)=>ae.distanceSq-le.distanceSq)).map((ae=>ae.tileID))}const Li=d.ac.fromPoints([new d.P(0,0),new d.P(d.a5,d.a5)]);function zn(m){return m==="raster"||m==="image"||m==="video"}function ml(m,t,a,l,h,_,v){if(!t.hasData())return!1;const{tileID:w,fadingRole:S,fadingDirection:A,fadingParentID:z}=t;if(S===he.Base&&A===Se.Incoming&&z)return a[z.key]=z,!0;const R=Math.max(w.overscaledZ-h,_);for(let P=w.overscaledZ-1;P>=R;P--){const F=w.scaledTo(P),U=m.getLoadedTile(F);if(U)return t.setCrossFadeLogic({fadingRole:he.Base,fadingDirection:Se.Incoming,fadingParentID:U.tileID,fadeEndTime:l+v}),U.setCrossFadeLogic({fadingRole:he.Parent,fadingDirection:Se.Departing,fadeEndTime:l+v}),a[F.key]=F,!0}return!1}function So(m,t,a,l,h,_){if(!t.hasData())return!1;const v=t.tileID.children(h);let w=Je(m,t,v,a,l,h,_);if(w)return!0;for(const S of v)Je(m,t,S.children(h),a,l,h,_)&&(w=!0);return w}function Je(m,t,a,l,h,_,v){if(a[0].overscaledZ>=_)return!1;let w=!1;for(const S of a){const A=m.getLoadedTile(S);if(!A)continue;const{fadingRole:z,fadingDirection:R,fadingParentID:P}=A;z===he.Base&&R===Se.Departing&&P||(A.setCrossFadeLogic({fadingRole:he.Base,fadingDirection:Se.Departing,fadingParentID:t.tileID,fadeEndTime:h+v}),t.setCrossFadeLogic({fadingRole:he.Parent,fadingDirection:Se.Incoming,fadeEndTime:h+v})),l[S.key]=S,w=!0}return w}function pr(m,t,a,l){const h=m.tileID;return!!m.selfFading||!m.hasData()&&!!t.has(h)&&(m.setSelfFadeLogic(a+l),!0)}function mr(m,t){var a;m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let l=t.tileID.canonical.x-m.tileID.canonical.x;const h=t.tileID.canonical.y-m.tileID.canonical.y,_=Math.pow(2,m.tileID.canonical.z),v=t.tileID.key;l===0&&h===0||Math.abs(h)>1||(Math.abs(l)>1&&(Math.abs(l+_)===1?l+=_:Math.abs(l-_)===1&&(l-=_)),t.dem&&m.dem&&(m.dem.backfillBorder(t.dem,l,h),!((a=m.neighboringTiles)===null||a===void 0)&&a[v]&&(m.neighboringTiles[v].backfilled=!0)))}class Da{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const l in this._tiles){const h=this._tiles[l];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+t),a[h.tileID.key]=h}this._tiles=a}setFeatureState(t,a){for(const l in this._tiles)this._tiles[l].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(d.ax).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var l;return(l=this.getTileById(t))===null||l===void 0?void 0:l.isRenderable(a)}getRenderableIds(t=0,a){const l=[];for(const h of this.getAllIds())this.isIdRenderable(h,a)&&l.push(this.getTileById(h));return a?l.sort(((h,_)=>{const v=h.tileID,w=_.tileID,S=new d.P(v.canonical.x,v.canonical.y)._rotate(-t),A=new d.P(w.canonical.x,w.canonical.y)._rotate(-t);return v.overscaledZ-w.overscaledZ||A.y-S.y||A.x-S.x})).map((h=>h.tileID.key)):l.map((h=>h.tileID)).sort(d.ax).map((h=>h.key))}}class Ui extends d.E{constructor(t,a,l){super(),this.id=t,this.dispatcher=l,this.on("data",(h=>this._dataHandler(h))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((h,_,v,w)=>{const S=new(H(_.type))(h,_,v,w);if(S.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${S.id}`);return S})(t,a,l,this),this._inViewTiles=new Da,this._outOfViewCache=new d.ay(0,(h=>this._unloadTile(h))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Ue,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Da}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,l){return d._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,l)}catch(h){t.state="errored",h.status!==404?this._source.fire(new d.k(h,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new d.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const l=this.getLoadedTile(t.scaledTo(a));if(l)return this._inViewTiles.isIdRenderable(l.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const l of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(l);a&&!this._source.shouldReloadTile(h,a)||(t?this._reloadTile(l,"expired"):h.state!=="errored"&&this._reloadTile(l,"reloading"))}}}_reloadTile(t,a){return d._(this,void 0,void 0,(function*(){const l=this._inViewTiles.getTileById(t);l&&(l.state!=="loading"&&(l.state=a),yield this._loadTile(l,t,a))}))}_tileLoaded(t,a,l){t.timeAdded=xt(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(h,_){var v,w;const S=_.getRenderableIds();for(const A of S){if(!h.neighboringTiles||!h.neighboringTiles[A])continue;const z=_.getTileById(A);h.neighboringTiles[A].backfilled||mr(h,z),!((w=(v=z.neighboringTiles)===null||v===void 0?void 0:v[h.tileID.key])===null||w===void 0)&&w.backfilled||mr(z,h)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new d.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const l=this._getLoadedDescendents(a),h=new Set;for(const _ of a){const v=l[_.key];if(!v?.length){h.add(_);continue}const w=_.overscaledZ+Ui.maxOverzooming,S=v.filter((R=>R.tileID.overscaledZ<=w));if(!S.length){h.add(_);continue}const A=Math.min(...S.map((R=>R.tileID.overscaledZ))),z=S.filter((R=>R.tileID.overscaledZ===A)).map((R=>R.tileID));for(const R of z)t[R.key]=R;this._areDescendentsComplete(z,A,_.overscaledZ)||h.add(_)}return h}_getLoadedDescendents(t){var a;const l={};for(const h of this._inViewTiles.getAllTiles().filter((_=>_.hasData())))for(const _ of t)h.tileID.isChildOf(_)&&(l[a=_.key]||(l[a]=[])).push(h);return l}_areDescendentsComplete(t,a,l){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-l)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,l=Math.ceil(t.height/this._source.tileSize)+1,h=Math.floor(a*l*(this._maxTileCacheZoomLevels===null?d.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._outOfViewCache.setMaxSize(_)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let l;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?l=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((S=>new d.a2(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y))):(l=wn(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter((S=>this._source.hasTile(S))))):l=[],this.usedForTerrain&&(l=this._addTerrainIdealTiles(l));const h=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,h&&this.fire(new d.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const _=Ei(t,this._source),v=this._updateRetainedTiles(l,_),w=zn(this._source.type);w&&this._rasterFadeDuration>0&&!a&&(function(S,A,z,R,P,F,U){const X=xt(),W=d.aw(A);for(const Y of A){const Q=S.getTileById(Y.key);Q.fadingDirection!==Se.Departing&&Q.fadeOpacity!==0||Q.resetFadeLogic(),ml(S,Q,z,X,R,P,U)||So(S,Q,z,X,F,U)||pr(Q,W,X,U)||Q.resetFadeLogic()}})(this._inViewTiles,l,v,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),w?this._cleanUpRasterTiles(v):this._cleanUpVectorTiles(v)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(a);t[a]?l.clearSymbolFadeHold():l.hasSymbolBuckets?l.holdingForSymbolFade()?l.symbolFadeFinished()&&this._removeTile(a):l.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const l of t)if(l.canonical.z>this._source.minzoom){const h=l.scaledTo(l.canonical.z-1);a.push(h);const _=l.scaledTo(Math.max(this._source.minzoom,Math.min(l.canonical.z,5)));a.push(_)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var l;const h=new Set;for(const A of t)this._addTile(A).hasData()||h.add(A);const _=t.reduce(((A,z)=>(A[z.key]=z,A)),{}),v=this._retainLoadedChildren(_,h),w={},S=Math.max(a-Ui.maxUnderzooming,this._source.minzoom);for(const A of v){let z=this._inViewTiles.getTileById(A.key),R=z?.wasRequested();for(let P=A.overscaledZ-1;P>=S;--P){const F=A.scaledTo(P);if(w[F.key])break;if(w[F.key]=!0,z=this.getTile(F),!z&&R&&(z=this._addTile(F)),z){const U=z.hasData();if((U||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||R)&&(_[F.key]=F),R=z.wasRequested(),U)break}}}return _}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const l=a;return a||(a=new je(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),l||this._source.fire(new d.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const l=a.getExpiryTimeout();l&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),l))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const l=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||l.state=="errored")&&t.some((h=>h.equals(l.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,l){const h=[],_=this.transform;if(!_)return h;const v=_.getCoveringTilesDetailsProvider().allowWorldCopies(),w=l?_.getCameraQueryGeometry(t):t,S=F=>_.screenPointToMercatorCoordinate(F,this.terrain),A=this.transformBbox(t,S,!v),z=this.transformBbox(w,S,!v),R=this.getIds(),P=d.ac.fromPoints(z);for(let F=0;F<R.length;F++){const U=this._inViewTiles.getTileById(R[F]);if(U.holdingForSymbolFade())continue;const X=v?[U.tileID]:[U.tileID.unwrapTo(-1),U.tileID.unwrapTo(0)],W=Math.pow(2,_.zoom-U.tileID.overscaledZ),Y=a*U.queryPadding*d.a5/U.tileSize/W;for(const Q of X){const ne=P.map((K=>Q.getTilePoint(new d.ab(K.x,K.y))));if(ne.expandBy(Y),ne.intersects(Li)){const K=A.map((le=>Q.getTilePoint(le))),ae=z.map((le=>Q.getTilePoint(le)));h.push({tile:U,tileID:v?Q:Q.unwrapTo(0),queryGeometry:K,cameraQueryGeometry:ae,scale:W})}}}return h}transformBbox(t,a,l){let h=t.map(a);if(l){const _=d.ac.fromPoints(t);_.shrinkBy(.001*Math.min(_.width(),_.height()));const v=_.map(a);d.ac.fromPoints(h).covers(v)||(h=h.map((w=>w.x>.5?new d.ab(w.x-1,w.y,w.z):w)))}return h}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((l=>this._inViewTiles.getTileById(l).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!zn(this._source.type)||!(function(t,a){if(a<=0)return!1;const l=xt();for(const h of t.getAllTiles())if(h.fadeEndTime>=l)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,l){this._state.updateState(t=t||d.aa,a,l)}removeFeatureState(t,a,l){this._state.removeFeatureState(t=t||d.aa,a,l)}getFeatureState(t,a){return this._state.getState(t=t||d.aa,a)}setDependencies(t,a,l){const h=this._inViewTiles.getTileById(t);h&&h.setDependencies(a,l)}reloadTilesForDependencies(t,a){for(const l of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(l).hasDependency(t,a)&&this._reloadTile(l,"reloading");this._outOfViewCache.filter((l=>!l.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}Ui.maxUnderzooming=10,Ui.maxOverzooming=3;class nt{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=d.ao(t,0,1);let a=1,l=this._distances[a];const h=t*this.paddedLength+this.padding;for(;l<h&&a<this._distances.length;)l=this._distances[++a];const _=a-1,v=this._distances[_],w=l-v,S=w>0?(h-v)/w:0;return this.points[_].mult(1-S).add(this.points[a].mult(S))}}function qt(m,t){let a=!0;return m==="always"||m!=="never"&&t!=="never"||(a=!1),a}class Wt{constructor(t,a,l){const h=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/l),this.yCellCount=Math.ceil(a/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)h.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,l,h,_){this._forEachCell(a,l,h,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(_)}insertCircle(t,a,l,h){this._forEachCell(a-h,l-h,a+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(l),this.circles.push(h)}_insertBoxCell(t,a,l,h,_,v){this.boxCells[_].push(v)}_insertCircleCell(t,a,l,h,_,v){this.circleCells[_].push(v)}_query(t,a,l,h,_,v,w){if(l<0||t>this.width||h<0||a>this.height)return[];const S=[];if(t<=0&&a<=0&&this.width<=l&&this.height<=h){if(_)return[{key:null,x1:t,y1:a,x2:l,y2:h}];for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const z=this.circles[3*A],R=this.circles[3*A+1],P=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:z-P,y1:R-P,x2:z+P,y2:R+P})}}else this._forEachCell(t,a,l,h,this._queryCell,S,{hitTest:_,overlapMode:v,seenUids:{box:{},circle:{}}},w);return S}query(t,a,l,h){return this._query(t,a,l,h,!1,null)}hitTest(t,a,l,h,_,v){return this._query(t,a,l,h,!0,_,v).length>0}hitTestCircle(t,a,l,h,_){const v=t-l,w=t+l,S=a-l,A=a+l;if(w<0||v>this.width||A<0||S>this.height)return!1;const z=[];return this._forEachCell(v,S,w,A,this._queryCellCircle,z,{hitTest:!0,overlapMode:h,circle:{x:t,y:a,radius:l},seenUids:{box:{},circle:{}}},_),z.length>0}_queryCell(t,a,l,h,_,v,w,S){const{seenUids:A,hitTest:z,overlapMode:R}=w,P=this.boxCells[_];if(P!==null){const U=this.bboxes;for(const X of P)if(!A.box[X]){A.box[X]=!0;const W=4*X,Y=this.boxKeys[X];if(t<=U[W+2]&&a<=U[W+3]&&l>=U[W+0]&&h>=U[W+1]&&(!S||S(Y))&&(!z||!qt(R,Y.overlapMode))&&(v.push({key:Y,x1:U[W],y1:U[W+1],x2:U[W+2],y2:U[W+3]}),z))return!0}}const F=this.circleCells[_];if(F!==null){const U=this.circles;for(const X of F)if(!A.circle[X]){A.circle[X]=!0;const W=3*X,Y=this.circleKeys[X];if(this._circleAndRectCollide(U[W],U[W+1],U[W+2],t,a,l,h)&&(!S||S(Y))&&(!z||!qt(R,Y.overlapMode))){const Q=U[W],ne=U[W+1],K=U[W+2];if(v.push({key:Y,x1:Q-K,y1:ne-K,x2:Q+K,y2:ne+K}),z)return!0}}}return!1}_queryCellCircle(t,a,l,h,_,v,w,S){const{circle:A,seenUids:z,overlapMode:R}=w,P=this.boxCells[_];if(P!==null){const U=this.bboxes;for(const X of P)if(!z.box[X]){z.box[X]=!0;const W=4*X,Y=this.boxKeys[X];if(this._circleAndRectCollide(A.x,A.y,A.radius,U[W+0],U[W+1],U[W+2],U[W+3])&&(!S||S(Y))&&!qt(R,Y.overlapMode))return v.push(!0),!0}}const F=this.circleCells[_];if(F!==null){const U=this.circles;for(const X of F)if(!z.circle[X]){z.circle[X]=!0;const W=3*X,Y=this.circleKeys[X];if(this._circlesCollide(U[W],U[W+1],U[W+2],A.x,A.y,A.radius)&&(!S||S(Y))&&!qt(R,Y.overlapMode))return v.push(!0),!0}}}_forEachCell(t,a,l,h,_,v,w,S){const A=this._convertToXCellCoord(t),z=this._convertToYCellCoord(a),R=this._convertToXCellCoord(l),P=this._convertToYCellCoord(h);for(let F=A;F<=R;F++)for(let U=z;U<=P;U++)if(_.call(this,t,a,l,h,this.xCellCount*U+F,v,w,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,l,h,_,v){const w=h-t,S=_-a,A=l+v;return A*A>w*w+S*S}_circleAndRectCollide(t,a,l,h,_,v,w){const S=(v-h)/2,A=Math.abs(t-(h+S));if(A>S+l)return!1;const z=(w-_)/2,R=Math.abs(a-(_+z));if(R>z+l)return!1;if(A<=S||R<=z)return!0;const P=A-S,F=R-z;return P*P+F*F<=l*l}}function Kr(m,t,a){const l=d.N();if(!m){const{vecSouth:R,vecEast:P}=$a(t),F=Be();F[0]=P[0],F[1]=P[1],F[2]=R[0],F[3]=R[1],h=F,(z=(v=(_=F)[0])*(A=_[3])-(S=_[2])*(w=_[1]))&&(h[0]=A*(z=1/z),h[1]=-w*z,h[2]=-S*z,h[3]=v*z),l[0]=F[0],l[1]=F[1],l[4]=F[2],l[5]=F[3]}var h,_,v,w,S,A,z;return d.Q(l,l,[1/a,1/a,1]),l}function rc(m,t,a,l){if(m){const h=d.N();if(!t){const{vecSouth:_,vecEast:v}=$a(a);h[0]=v[0],h[1]=v[1],h[4]=_[0],h[5]=_[1]}return d.Q(h,h,[l,l,1]),h}return a.pixelsToClipSpaceMatrix}function $a(m){const t=Math.cos(m.rollInRadians),a=Math.sin(m.rollInRadians),l=Math.cos(m.pitchInRadians),h=Math.cos(m.bearingInRadians),_=Math.sin(m.bearingInRadians),v=d.aD();v[0]=-h*l*a-_*t,v[1]=-_*l*a+h*t;const w=d.aE(v);w<1e-9?d.aF(v):d.aG(v,v,1/w);const S=d.aD();S[0]=h*l*t-_*a,S[1]=_*l*t+h*a;const A=d.aE(S);return A<1e-9?d.aF(S):d.aG(S,S,1/A),{vecEast:S,vecSouth:v}}function Gt(m,t,a,l){let h;l?(h=[m,t,l(m,t),1],d.aI(h,h,a)):(h=[m,t,0,1],ga(h,h,a));const _=h[3];return{point:new d.P(h[0]/_,h[1]/_),signedDistanceFromCamera:_,isOccluded:!1}}function Mo(m,t){return .5+m/t*.5}function Xa(m,t){return m.x>=-t[0]&&m.x<=t[0]&&m.y>=-t[1]&&m.y<=t[1]}function ys(m,t,a,l,h,_,v,w,S,A,z,R,P){const F=a?m.textSizeData:m.iconSizeData,U=d.az(F,t.transform.zoom),X=[256/t.width*2+1,256/t.height*2+1],W=a?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;W.clear();const Y=m.lineVertexArray,Q=a?m.text.placedSymbolArray:m.icon.placedSymbolArray,ne=t.transform.width/t.transform.height;let K=!1;for(let ae=0;ae<Q.length;ae++){const le=Q.get(ae);if(le.hidden||le.writingMode===d.aA.vertical&&!K){Qa(le.numGlyphs,W);continue}K=!1;const ee=new d.P(le.anchorX,le.anchorY),de={getElevation:P,pitchedLabelPlaneMatrix:l,lineVertexArray:Y,pitchWithMap:_,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:ee,unwrappedTileID:S,width:A,height:z,translation:R},Me=_l(le.anchorX,le.anchorY,de);if(!Xa(Me.point,X)){Qa(le.numGlyphs,W);continue}const be=Mo(t.transform.cameraToCenterDistance,Me.signedDistanceFromCamera),Ee=d.aB(F,U,le),Ce=_?Ee*t.transform.getPitchedTextCorrection(le.anchorX,le.anchorY,S)/be:Ee*be,He=pn({projectionContext:de,pitchedLabelPlaneMatrixInverse:h,symbol:le,fontSize:Ce,flip:!1,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:ne,rotateToLine:w});K=He.useVertical,(He.notEnoughRoom||K||He.needsFlipping&&pn({projectionContext:de,pitchedLabelPlaneMatrixInverse:h,symbol:le,fontSize:Ce,flip:!0,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:W,aspectRatio:ne,rotateToLine:w}).notEnoughRoom)&&Qa(le.numGlyphs,W)}a?m.text.dynamicLayoutVertexBuffer.updateData(W):m.icon.dynamicLayoutVertexBuffer.updateData(W)}function Ya(m,t,a,l,h,_,v,w){const S=_.glyphStartIndex+_.numGlyphs,A=_.lineStartIndex,z=_.lineStartIndex+_.lineLength,R=t.getoffsetX(_.glyphStartIndex),P=t.getoffsetX(S-1),F=Ia(m*R,a,l,h,_.segment,A,z,w,v);if(!F)return null;const U=Ia(m*P,a,l,h,_.segment,A,z,w,v);return U?w.projectionCache.anyProjectionOccluded?null:{first:F,last:U}:null}function Wa(m,t,a,l){return m===d.aA.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*l?{useVertical:!0}:(m===d.aA.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function pn(m){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:l,fontSize:h,flip:_,keepUpright:v,glyphOffsetArray:w,dynamicLayoutVertexArray:S,aspectRatio:A,rotateToLine:z}=m,R=h/24,P=l.lineOffsetX*R,F=l.lineOffsetY*R;let U;if(l.numGlyphs>1){const X=l.glyphStartIndex+l.numGlyphs,W=l.lineStartIndex,Y=l.lineStartIndex+l.lineLength,Q=Ya(R,w,P,F,_,l,z,t);if(!Q)return{notEnoughRoom:!0};const ne=vs(Q.first.point.x,Q.first.point.y,t,a),K=vs(Q.last.point.x,Q.last.point.y,t,a);if(v&&!_){const ae=Wa(l.writingMode,ne,K,A);if(ae)return ae}U=[Q.first];for(let ae=l.glyphStartIndex+1;ae<X-1;ae++){const le=Ia(R*w.getoffsetX(ae),P,F,_,l.segment,W,Y,t,z);if(!le)return{notEnoughRoom:!0};U.push(le)}U.push(Q.last)}else{if(v&&!_){const W=ci(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,Y=l.lineStartIndex+l.segment+1,Q=new d.P(t.lineVertexArray.getx(Y),t.lineVertexArray.gety(Y)),ne=ci(Q.x,Q.y,t),K=ne.signedDistanceFromCamera>0?ne.point:gl(t.tileAnchorPoint,Q,W,1,t),ae=vs(W.x,W.y,t,a),le=vs(K.x,K.y,t,a),ee=Wa(l.writingMode,ae,le,A);if(ee)return ee}const X=Ia(R*w.getoffsetX(l.glyphStartIndex),P,F,_,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,t,z);if(!X||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[X]}for(const X of U)d.aH(S,X.point,X.angle);return{}}function gl(m,t,a,l,h){const _=m.add(m.sub(t)._unit()),v=ci(_.x,_.y,h).point,w=a.sub(v);return a.add(w._mult(l/w.mag()))}function gr(m,t,a){const l=t.projectionCache;if(l.projections[m])return l.projections[m];const h=new d.P(t.lineVertexArray.getx(m),t.lineVertexArray.gety(m)),_=ci(h.x,h.y,t);if(_.signedDistanceFromCamera>0)return l.projections[m]=_.point,l.anyProjectionOccluded=l.anyProjectionOccluded||_.isOccluded,_.point;const v=m-a.direction;return gl(a.distanceFromAnchor===0?t.tileAnchorPoint:new d.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),h,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function ci(m,t,a){const l=m+a.translation[0],h=t+a.translation[1];let _;return a.pitchWithMap?(_=Gt(l,h,a.pitchedLabelPlaneMatrix,a.getElevation),_.isOccluded=!1):(_=a.transform.projectTileCoordinates(l,h,a.unwrappedTileID,a.getElevation),_.point.x=(.5*_.point.x+.5)*a.width,_.point.y=(.5*-_.point.y+.5)*a.height),_}function vs(m,t,a,l){if(a.pitchWithMap){const h=[m,t,0,1];return d.aI(h,h,l),a.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],a.unwrappedTileID,a.getElevation).point}return{x:m/a.width*2-1,y:1-t/a.height*2}}function _l(m,t,a){return a.transform.projectTileCoordinates(m,t,a.unwrappedTileID,a.getElevation)}function yl(m,t,a){return m._unit()._perp()._mult(t*a)}function Hs(m,t,a,l,h,_,v,w,S){if(w.projectionCache.offsets[m])return w.projectionCache.offsets[m];const A=a.add(t);if(m+S.direction<l||m+S.direction>=h)return w.projectionCache.offsets[m]=A,A;const z=gr(m+S.direction,w,S),R=yl(z.sub(a),v,S.direction),P=a.add(R),F=z.add(R);return w.projectionCache.offsets[m]=d.aJ(_,A,P,F)||A,w.projectionCache.offsets[m]}function Ia(m,t,a,l,h,_,v,w,S){const A=l?m-t:m+t;let z=A>0?1:-1,R=0;l&&(z*=-1,R=Math.PI),z<0&&(R+=Math.PI);let P,F=z>0?_+h:_+h+1;w.projectionCache.cachedAnchorPoint?P=w.projectionCache.cachedAnchorPoint:(P=ci(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=P);let U,X,W=P,Y=P,Q=0,ne=0;const K=Math.abs(A),ae=[];let le;for(;Q+ne<=K;){if(F+=z,F<_||F>=v)return null;Q+=ne,Y=W,X=U;const Me={absOffsetX:K,direction:z,distanceFromAnchor:Q,previousVertex:Y};if(W=gr(F,w,Me),a===0)ae.push(Y),le=W.sub(Y);else{let be;const Ee=W.sub(Y);be=Ee.mag()===0?yl(gr(F+z,w,Me).sub(W),a,z):yl(Ee,a,z),X||(X=Y.add(be)),U=Hs(F,be,W,_,v,X,a,w,Me),ae.push(X),le=U.sub(X)}ne=le.mag()}const ee=le._mult((K-Q)/ne)._add(X||Y),de=R+Math.atan2(W.y-Y.y,W.x-Y.x);return ae.push(ee),{point:ee,angle:S?de:0,path:ae}}const au=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Qa(m,t){for(let a=0;a<m;a++){const l=t.length;t.resize(l+4),t.float32.set(au,3*l)}}function ga(m,t,a){const l=t[0],h=t[1];return m[0]=a[0]*l+a[4]*h+a[12],m[1]=a[1]*l+a[5]*h+a[13],m[3]=a[3]*l+a[7]*h+a[15],m}const pi=100;class uh{constructor(t,a=new Wt(t.width+200,t.height+200,25),l=new Wt(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=l,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+pi,this.screenBottomBoundary=t.height+pi,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,l,h,_,v,w,S,A,z,R,P){const F=this.projectAndGetPerspectiveRatio(t.anchorPointX+S[0],t.anchorPointY+S[1],_,z,P),U=l*F.perspectiveRatio;let X;if(v||w)X=this._projectCollisionBox(t,U,h,_,v,w,S,F,z,R,P);else{const le=F.x+(R?R.x*U:0),ee=F.y+(R?R.y*U:0);X={allPointsOccluded:!1,box:[le+t.x1*U,ee+t.y1*U,le+t.x2*U,ee+t.y2*U]}}const[W,Y,Q,ne]=X.box,K=v?X.allPointsOccluded:F.isOccluded;let ae=K;return ae||(ae=F.perspectiveRatio<this.perspectiveRatioCutoff),ae||(ae=!this.isInsideGrid(W,Y,Q,ne)),ae||a!=="always"&&this.grid.hitTest(W,Y,Q,ne,a,A)?{box:[W,Y,Q,ne],placeable:!1,offscreen:!1,occluded:K}:{box:[W,Y,Q,ne],placeable:!0,offscreen:this.isOffscreen(W,Y,Q,ne),occluded:K}}placeCollisionCircles(t,a,l,h,_,v,w,S,A,z,R,P,F,U){const X=[],W=new d.P(a.anchorX,a.anchorY),Y=this.getPerspectiveRatio(W.x,W.y,v,U),Q=(A?_*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,v)/Y:_*Y)/d.aN,ne={getElevation:U,pitchedLabelPlaneMatrix:w,lineVertexArray:l,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:W,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:F},K=Ya(Q,h,a.lineOffsetX*Q,a.lineOffsetY*Q,!1,a,!1,ne);let ae=!1,le=!1,ee=!0;if(K){const de=.5*R*Y+P,Me=new d.P(-100,-100),be=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Ee=new nt,Ce=K.first,He=K.last;let et=[];for(let Vt=Ce.path.length-1;Vt>=1;Vt--)et.push(Ce.path[Vt]);for(let Vt=1;Vt<He.path.length;Vt++)et.push(He.path[Vt]);const qe=2.5*de;if(A){const Vt=this.projectPathToScreenSpace(et,ne);et=Vt.some((_i=>_i.signedDistanceFromCamera<=0))?[]:Vt.map((_i=>_i.point))}let wt=[];if(et.length>0){const Vt=et[0].clone(),_i=et[0].clone();for(let Fi=1;Fi<et.length;Fi++)Vt.x=Math.min(Vt.x,et[Fi].x),Vt.y=Math.min(Vt.y,et[Fi].y),_i.x=Math.max(_i.x,et[Fi].x),_i.y=Math.max(_i.y,et[Fi].y);wt=Vt.x>=Me.x&&_i.x<=be.x&&Vt.y>=Me.y&&_i.y<=be.y?[et]:_i.x<Me.x||Vt.x>be.x||_i.y<Me.y||Vt.y>be.y?[]:d.aK([et],Me.x,Me.y,be.x,be.y)}for(const Vt of wt){Ee.reset(Vt,.25*de);let _i=0;_i=Ee.length<=.5*de?1:Math.ceil(Ee.paddedLength/qe)+1;for(let Fi=0;Fi<_i;Fi++){const xi=Fi/Math.max(_i-1,1),Zi=Ee.lerp(xi),Ci=Zi.x+pi,kn=Zi.y+pi;X.push(Ci,kn,de,0);const Gi=Ci-de,On=kn-de,on=Ci+de,_n=kn+de;if(ee=ee&&this.isOffscreen(Gi,On,on,_n),le=le||this.isInsideGrid(Gi,On,on,_n),t!=="always"&&this.grid.hitTestCircle(Ci,kn,de,t,z)&&(ae=!0,!S))return{circles:[],offscreen:!1,collisionDetected:ae}}}}return{circles:!S&&ae||!le||Y<this.perspectiveRatioCutoff?[]:X,offscreen:ee,collisionDetected:ae}}projectPathToScreenSpace(t,a){const l=(function(h,_){const v=d.N();return d.aC(v,_.pitchedLabelPlaneMatrix),h.map((w=>{const S=Gt(w.x,w.y,v,_.getElevation),A=_.transform.projectTileCoordinates(S.point.x,S.point.y,_.unwrappedTileID,_.getElevation);return A.point.x=(.5*A.point.x+.5)*_.width,A.point.y=(.5*-A.point.y+.5)*_.height,A}))})(t,a);return(function(h){let _=0,v=0,w=0,S=0;for(let A=0;A<h.length;A++)h[A].isOccluded?(w=A+1,S=0):(S++,S>v&&(v=S,_=w));return h.slice(_,_+v)})(l)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],l=new d.ac;for(const R of t){const P=new d.P(R.x+pi,R.y+pi);l.extend(P),a.push(P)}const{minX:h,minY:_,maxX:v,maxY:w}=l,S=this.grid.query(h,_,v,w).concat(this.ignoredGrid.query(h,_,v,w)),A={},z={};for(const R of S){const P=R.key;if(A[P.bucketInstanceId]===void 0&&(A[P.bucketInstanceId]={}),A[P.bucketInstanceId][P.featureIndex])continue;const F=[new d.P(R.x1,R.y1),new d.P(R.x2,R.y1),new d.P(R.x2,R.y2),new d.P(R.x1,R.y2)];d.aL(a,F)&&(A[P.bucketInstanceId][P.featureIndex]=!0,z[P.bucketInstanceId]===void 0&&(z[P.bucketInstanceId]=[]),z[P.bucketInstanceId].push(P.featureIndex))}return z}insertCollisionBox(t,a,l,h,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:_,collisionGroupID:v,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,l,h,_,v){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:h,featureIndex:_,collisionGroupID:v,overlapMode:a};for(let A=0;A<t.length;A+=4)w.insertCircle(S,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,a,l,h,_){if(_){let v;h?(v=[t,a,h(t,a),1],d.aI(v,v,_)):(v=[t,a,0,1],ga(v,v,_));const w=v[3];return{x:(v[0]/w+1)/2*this.transform.width+pi,y:(-v[1]/w+1)/2*this.transform.height+pi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{const v=this.transform.projectTileCoordinates(t,a,l,h);return{x:(v.point.x+1)/2*this.transform.width+pi,y:(1-v.point.y)/2*this.transform.height+pi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,l,h){const _=this.transform.projectTileCoordinates(t,a,l,h);return .5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5}isOffscreen(t,a,l,h){return l<pi||t>=this.screenRightBoundary||h<pi||a>this.screenBottomBoundary}isInsideGrid(t,a,l,h){return l>=0&&t<this.gridRightBoundary&&h>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=d.as([]);return d.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,l,h,_,v,w,S,A,z,R){let P=1,F=0,U=0,X=1;const W=t.anchorPointX+w[0],Y=t.anchorPointY+w[1];if(v&&!_){const et=this.projectAndGetPerspectiveRatio(W+1,Y,h,A,R),qe=et.x-S.x,wt=Math.atan((et.y-S.y)/qe)+(qe<0?Math.PI:0),Vt=Math.sin(wt),_i=Math.cos(wt);P=_i,F=Vt,U=-Vt,X=_i}else if(!v&&_){const et=$a(this.transform);P=et.vecEast[0],F=et.vecEast[1],U=et.vecSouth[0],X=et.vecSouth[1]}let Q=S.x,ne=S.y,K=a;_&&(Q=W,ne=Y,K=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),K*=this.transform.getPitchedTextCorrection(W,Y,h),z||(K*=d.ao(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(Q+=P*z.x*K+U*z.y*K,ne+=F*z.x*K+X*z.y*K);const ae=t.x1*K,le=t.x2*K,ee=(ae+le)/2,de=t.y1*K,Me=t.y2*K,be=(de+Me)/2,Ee=[{offsetX:ae,offsetY:de},{offsetX:ee,offsetY:de},{offsetX:le,offsetY:de},{offsetX:le,offsetY:be},{offsetX:le,offsetY:Me},{offsetX:ee,offsetY:Me},{offsetX:ae,offsetY:Me},{offsetX:ae,offsetY:be}];let Ce=[];for(const{offsetX:et,offsetY:qe}of Ee)Ce.push(new d.P(Q+P*et+U*qe,ne+F*et+X*qe));let He=!1;if(_){const et=Ce.map((qe=>this.projectAndGetPerspectiveRatio(qe.x,qe.y,h,A,R)));He=et.some((qe=>!qe.isOccluded)),Ce=et.map((qe=>new d.P(qe.x,qe.y)))}else He=!0;return{box:d.aM(Ce),allPointsOccluded:!He}}}class _d{constructor(t,a,l,h){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Eo{constructor(t,a,l,h,_){this.text=new _d(t?t.text:null,a,l,_),this.icon=new _d(t?t.icon:null,a,h,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ch{constructor(t,a,l){this.text=t,this.icon=a,this.skipFade=l}}class su{constructor(t,a,l,h,_){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=_}}class yd{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:l=>l.collisionGroupID===a}}return this.collisionGroups[t]}}function Tr(m,t,a,l,h){const{horizontalAlign:_,verticalAlign:v}=d.aT(m);return new d.P(-(_-.5)*t+l[0]*h,-(v-.5)*a+l[1]*h)}class ou{constructor(t,a,l,h,_){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new uh(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new yd(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(l,h)=>a.getElevation(t,l,h):null}getBucketParts(t,a,l,h){const _=l.getBucket(a),v=l.latestFeatureIndex;if(!_||!v||a.id!==_.layerIds[0])return;const w=l.collisionBoxArray,S=_.layers[0].layout,A=_.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),R=l.tileSize/d.a5,P=l.tileID.toUnwrapped(),F=S.get("text-rotation-alignment")==="map",U=d.aO(l,1,this.transform.zoom),X=d.aP(this.collisionIndex.transform,l,A.get("text-translate"),A.get("text-translate-anchor")),W=d.aP(this.collisionIndex.transform,l,A.get("icon-translate"),A.get("icon-translate-anchor")),Y=Kr(F,this.transform,U);this.retainedQueryData[_.bucketInstanceId]=new su(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,l.tileID);const Q={bucket:_,layout:S,translationText:X,translationIcon:W,unwrappedTileID:P,pitchedLabelPlaneMatrix:Y,scale:z,textPixelRatio:R,holdingForFade:l.holdingForSymbolFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:d.az(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(h)for(const ne of _.sortKeyRanges){const{sortKey:K,symbolInstanceStart:ae,symbolInstanceEnd:le}=ne;t.push({sortKey:K,symbolInstanceStart:ae,symbolInstanceEnd:le,parameters:Q})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(t,a,l,h,_,v,w,S,A,z,R,P,F,U,X,W,Y,Q,ne,K){const ae=d.aQ[t.textAnchor],le=[t.textOffset0,t.textOffset1],ee=Tr(ae,l,h,le,_),de=this.collisionIndex.placeCollisionBox(a,P,S,A,z,w,v,W,R.predicate,ne,ee,K);if((!Q||this.collisionIndex.placeCollisionBox(Q,P,S,A,z,w,v,Y,R.predicate,ne,ee,K).placeable)&&de.placeable){let Me;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(Me=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:le,width:l,height:h,anchor:ae,textBoxScale:_,prevAnchor:Me},this.markUsedJustification(U,ae,F,X),U.allowVerticalPlacement&&(this.markUsedOrientation(U,X,F),this.placedOrientations[F.crossTileID]=X),{shift:ee,placedGlyphBoxes:de}}}placeLayerBucketPart(t,a,l){const{bucket:h,layout:_,translationText:v,translationIcon:w,unwrappedTileID:S,pitchedLabelPlaneMatrix:A,textPixelRatio:z,holdingForFade:R,collisionBoxArray:P,partiallyEvaluatedTextSize:F,collisionGroup:U}=t.parameters,X=_.get("text-optional"),W=_.get("icon-optional"),Y=d.aR(_,"text-overlap","text-allow-overlap"),Q=Y==="always",ne=d.aR(_,"icon-overlap","icon-allow-overlap"),K=ne==="always",ae=_.get("text-rotation-alignment")==="map",le=_.get("text-pitch-alignment")==="map",ee=_.get("icon-text-fit")!=="none",de=_.get("symbol-z-order")==="viewport-y",Me=Q&&(K||!h.hasIconData()||W),be=K&&(Q||!h.hasTextData()||X);!h.collisionArrays&&P&&h.deserializeCollisionBoxes(P);const Ee=this.retainedQueryData[h.bucketInstanceId].tileID,Ce=this._getTerrainElevationFunc(Ee),He=this.transform.getFastPathSimpleProjectionMatrix(Ee),et=(qe,wt,Vt)=>{var _i,Fi;if(a[qe.crossTileID])return;if(R)return void(this.placements[qe.crossTileID]=new ch(!1,!1,!1));let xi=!1,Zi=!1,Ci=!0,kn=null,Gi={box:null,placeable:!1,offscreen:null,occluded:!1},On={placeable:!1},on=null,_n=null,ar=null,dr=0,Fa=0,ks=0;wt.textFeatureIndex?dr=wt.textFeatureIndex:qe.useRuntimeCollisionCircles&&(dr=qe.featureIndex),wt.verticalTextFeatureIndex&&(Fa=wt.verticalTextFeatureIndex);const Xo=wt.textBox;if(Xo){const Fn=ln=>{let Nn=d.aA.horizontal;if(h.allowVerticalPlacement&&!ln&&this.prevPlacement){const Lr=this.prevPlacement.placedOrientations[qe.crossTileID];Lr&&(this.placedOrientations[qe.crossTileID]=Lr,Nn=Lr,this.markUsedOrientation(h,Nn,qe))}return Nn},Wn=(ln,Nn)=>{if(h.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&wt.verticalTextBox){for(const Lr of h.writingModes)if(Lr===d.aA.vertical?(Gi=Nn(),On=Gi):Gi=ln(),Gi&&Gi.placeable)break}else Gi=ln()},sr=qe.textAnchorOffsetStartIndex,ua=qe.textAnchorOffsetEndIndex;if(ua===sr){const ln=(Nn,Lr)=>{const Qi=this.collisionIndex.placeCollisionBox(Nn,Y,z,Ee,S,le,ae,v,U.predicate,Ce,void 0,He);return Qi&&Qi.placeable&&(this.markUsedOrientation(h,Lr,qe),this.placedOrientations[qe.crossTileID]=Lr),Qi};Wn((()=>ln(Xo,d.aA.horizontal)),(()=>{const Nn=wt.verticalTextBox;return h.allowVerticalPlacement&&qe.numVerticalGlyphVertices>0&&Nn?ln(Nn,d.aA.vertical):{box:null,offscreen:null}})),Fn(Gi&&Gi.placeable)}else{let ln=d.aQ[(Fi=(_i=this.prevPlacement)===null||_i===void 0?void 0:_i.variableOffsets[qe.crossTileID])===null||Fi===void 0?void 0:Fi.anchor];const Nn=(Qi,Dh,Pc)=>{const Rc=Qi.x2-Qi.x1,Ih=Qi.y2-Qi.y1,ca=qe.textBoxScale,yo=ee&&ne==="never"?Dh:null;let Os=null,Ph=Y==="never"?1:2,Wo="never";ln&&Ph++;for(let Lc=0;Lc<Ph;Lc++){for(let vo=sr;vo<ua;vo++){const Bc=h.textAnchorOffsets.get(vo);if(ln&&Bc.textAnchor!==ln)continue;const kc=this.attemptAnchorPlacement(Bc,Qi,Rc,Ih,ca,ae,le,z,Ee,S,U,Wo,qe,h,Pc,v,w,yo,Ce);if(kc&&(Os=kc.placedGlyphBoxes,Os&&Os.placeable))return xi=!0,kn=kc.shift,Os}ln?ln=null:Wo=Y}return l&&!Os&&(Os={box:this.collisionIndex.placeCollisionBox(Xo,"always",z,Ee,S,le,ae,v,U.predicate,Ce,void 0,He).box,offscreen:!1,placeable:!1,occluded:!1}),Os};Wn((()=>Nn(Xo,wt.iconBox,d.aA.horizontal)),(()=>{const Qi=wt.verticalTextBox;return h.allowVerticalPlacement&&(!Gi||!Gi.placeable)&&qe.numVerticalGlyphVertices>0&&Qi?Nn(Qi,wt.verticalIconBox,d.aA.vertical):{box:null,occluded:!0,offscreen:null}})),Gi&&(xi=Gi.placeable,Ci=Gi.offscreen);const Lr=Fn(Gi&&Gi.placeable);if(!xi&&this.prevPlacement){const Qi=this.prevPlacement.variableOffsets[qe.crossTileID];Qi&&(this.variableOffsets[qe.crossTileID]=Qi,this.markUsedJustification(h,Qi.anchor,qe,Lr))}}}if(on=Gi,xi=on&&on.placeable,Ci=on&&on.offscreen,qe.useRuntimeCollisionCircles&&qe.centerJustifiedTextSymbolIndex>=0){const Fn=h.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex),Wn=d.aB(h.textSizeData,F,Fn),sr=_.get("text-padding");_n=this.collisionIndex.placeCollisionCircles(Y,Fn,h.lineVertexArray,h.glyphOffsetArray,Wn,S,A,l,le,U.predicate,qe.collisionCircleDiameter,sr,v,Ce),_n.circles.length&&_n.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),xi=Q||_n.circles.length>0&&!_n.collisionDetected,Ci=Ci&&_n.offscreen}if(wt.iconFeatureIndex&&(ks=wt.iconFeatureIndex),wt.iconBox){const Fn=Wn=>this.collisionIndex.placeCollisionBox(Wn,ne,z,Ee,S,le,ae,w,U.predicate,Ce,ee&&kn?kn:void 0,He);On&&On.placeable&&wt.verticalIconBox?(ar=Fn(wt.verticalIconBox),Zi=ar.placeable):(ar=Fn(wt.iconBox),Zi=ar.placeable),Ci=Ci&&ar.offscreen}const Ic=X||qe.numHorizontalGlyphVertices===0&&qe.numVerticalGlyphVertices===0,Yo=W||qe.numIconVertices===0;Ic||Yo?Yo?Ic||(Zi=Zi&&xi):xi=Zi&&xi:Zi=xi=Zi&&xi;const qr=Zi&&ar.placeable;if(xi&&on.placeable&&this.collisionIndex.insertCollisionBox(on.box,Y,_.get("text-ignore-placement"),h.bucketInstanceId,On&&On.placeable&&Fa?Fa:dr,U.ID),qr&&this.collisionIndex.insertCollisionBox(ar.box,ne,_.get("icon-ignore-placement"),h.bucketInstanceId,ks,U.ID),_n&&xi&&this.collisionIndex.insertCollisionCircles(_n.circles,Y,_.get("text-ignore-placement"),h.bucketInstanceId,dr,U.ID),l&&this.storeCollisionData(h.bucketInstanceId,Vt,wt,on,ar,_n),qe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[qe.crossTileID]=new ch((xi||Me)&&!on?.occluded,(Zi||be)&&!ar?.occluded,Ci||h.justReloaded),a[qe.crossTileID]=!0};if(de){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const qe=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let wt=qe.length-1;wt>=0;--wt){const Vt=qe[wt];et(h.symbolInstances.get(Vt),h.collisionArrays[Vt],Vt)}}else for(let qe=t.symbolInstanceStart;qe<t.symbolInstanceEnd;qe++)et(h.symbolInstances.get(qe),h.collisionArrays[qe],qe);h.justReloaded=!1}storeCollisionData(t,a,l,h,_,v){if(l.textBox||l.iconBox){let w,S;this.collisionBoxArrays.has(t)?w=this.collisionBoxArrays.get(t):(w=new Map,this.collisionBoxArrays.set(t,w)),w.has(a)?S=w.get(a):(S={text:null,icon:null},w.set(a,S)),l.textBox&&(S.text=h.box),l.iconBox&&(S.icon=_.box)}if(v){let w=this.collisionCircleArrays[t];w===void 0&&(w=this.collisionCircleArrays[t]=[]);for(let S=0;S<v.circles.length;S+=4)w.push(v.circles[S+0]-pi),w.push(v.circles[S+1]-pi),w.push(v.circles[S+2]),w.push(v.collisionDetected?1:0)}}markUsedJustification(t,a,l,h){let _;_=h===d.aA.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.aS(a)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=_>=0&&w!==_?0:l.crossTileID)}markUsedOrientation(t,a,l){const h=a===d.aA.horizontal||a===d.aA.horizontalOnly?a:0,_=a===d.aA.vertical?a:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)t.text.placedSymbolArray.get(w).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let l=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const h=a?a.symbolFadeChange(t):1,_=a?a.opacities:{},v=a?a.variableOffsets:{},w=a?a.placedOrientations:{};for(const S in this.placements){const A=this.placements[S],z=_[S];z?(this.opacities[S]=new Eo(z,h,A.text,A.icon),l=l||A.text!==z.text.placed||A.icon!==z.icon.placed):(this.opacities[S]=new Eo(null,h,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const S in _){const A=_[S];if(!this.opacities[S]){const z=new Eo(A,h,!1,!1);z.isHidden()||(this.opacities[S]=z,l=l||A.text.placed||A.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const l={};for(const h of a){const _=h.getBucket(t);_&&h.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(t,a,l,h){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const _=t.layers[0],v=_.layout,w=new Eo(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),A=v.get("icon-allow-overlap"),z=_._unevaluatedLayout.hasValue("text-variable-anchor")||_._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=v.get("text-rotation-alignment")==="map",P=v.get("text-pitch-alignment")==="map",F=v.get("icon-text-fit")!=="none",U=new Eo(null,0,S&&(A||!t.hasIconData()||v.get("icon-optional")),A&&(S||!t.hasTextData()||v.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const X=(Y,Q,ne)=>{for(let K=0;K<Q/4;K++)Y.opacityVertexArray.emplaceBack(ne);Y.hasVisibleVertices=Y.hasVisibleVertices||ne!==Co},W=this.collisionBoxArrays.get(t.bucketInstanceId);for(let Y=0;Y<t.symbolInstances.length;Y++){const Q=t.symbolInstances.get(Y),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:K,crossTileID:ae}=Q;let le=this.opacities[ae];l[ae]?le=w:le||(le=U,this.opacities[ae]=le),l[ae]=!0;const ee=Q.numIconVertices>0,de=this.placedOrientations[Q.crossTileID],Me=de===d.aA.vertical,be=de===d.aA.horizontal||de===d.aA.horizontalOnly;if(ne>0||K>0){const Ce=sc(le.text);X(t.text,ne,Me?Co:Ce),X(t.text,K,be?Co:Ce);const He=le.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach((wt=>{wt>=0&&(t.text.placedSymbolArray.get(wt).hidden=He||Me?1:0)})),Q.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=He||be?1:0);const et=this.variableOffsets[Q.crossTileID];et&&this.markUsedJustification(t,et.anchor,Q,de);const qe=this.placedOrientations[Q.crossTileID];qe&&(this.markUsedJustification(t,"left",Q,qe),this.markUsedOrientation(t,qe,Q))}if(ee){const Ce=sc(le.icon),He=!(F&&Q.verticalPlacedIconSymbolIndex&&Me);Q.placedIconSymbolIndex>=0&&(X(t.icon,Q.numIconVertices,He?Ce:Co),t.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=le.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(X(t.icon,Q.numVerticalIconVertices,He?Co:Ce),t.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}const Ee=W&&W.has(Y)?W.get(Y):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Ce=t.collisionArrays[Y];if(Ce){let He=new d.P(0,0);if(Ce.textBox||Ce.verticalTextBox){let et=!0;if(z){const qe=this.variableOffsets[ae];qe?(He=Tr(qe.anchor,qe.width,qe.height,qe.textOffset,qe.textBoxScale),R&&He._rotate(P?-this.transform.bearingInRadians:this.transform.bearingInRadians)):et=!1}if(Ce.textBox||Ce.verticalTextBox){let qe;Ce.textBox&&(qe=Me),Ce.verticalTextBox&&(qe=be),ac(t.textCollisionBox.collisionVertexArray,le.text.placed,!et||qe,Ee.text,He.x,He.y)}}if(Ce.iconBox||Ce.verticalIconBox){const et=!!(!be&&Ce.verticalIconBox);let qe;Ce.iconBox&&(qe=et),Ce.verticalIconBox&&(qe=!et),ac(t.iconCollisionBox.collisionVertexArray,le.icon.placed,qe,Ee.icon,F?He.x:0,F?He.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const l=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*l>t}setStale(){this.stale=!0}}function ac(m,t,a,l,h,_){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-pi,w=l[1]-pi,S=l[2]-pi,A=l[3]-pi;m.emplaceBack(t?1:0,a?1:0,h||0,_||0,v,w),m.emplaceBack(t?1:0,a?1:0,h||0,_||0,S,w),m.emplaceBack(t?1:0,a?1:0,h||0,_||0,S,A),m.emplaceBack(t?1:0,a?1:0,h||0,_||0,v,A)}const lu=Math.pow(2,25),$s=Math.pow(2,24),vd=Math.pow(2,17),vl=Math.pow(2,16),xs=Math.pow(2,9),xd=Math.pow(2,8),Ao=Math.pow(2,1);function sc(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const t=m.placed?1:0,a=Math.floor(127*m.opacity);return a*lu+t*$s+a*vd+t*vl+a*xs+t*xd+a*Ao+t}const Co=0;class Xs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,l,h,_){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(v,h,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort(((w,S)=>w.sortKey-S.sortKey)));this._currentPartIndex<v.length;)if(a.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,_())return!0;return!1}}class xl{constructor(t,a,l,h,_,v,w,S){this.placement=new ou(t,a,v,w,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,a,l){const h=xt(),_=()=>!this._forceFullPlacement&&xt()-h>2;for(;this._currentPlacementIndex>=0;){const v=a[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Xs(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Xt=512/d.a5/2;class Pa{constructor(t,a,l){this.tileID=t,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let _=0;_<a.length;_++){const v=a.get(_),w=v.key,S=h.get(w);S?S.push(v):h.set(w,[v])}for(const[_,v]of h){const w={positions:v.map((S=>({x:Math.floor(S.anchorX*Xt),y:Math.floor(S.anchorY*Xt)}))),crossTileIDs:v.map((S=>S.crossTileID))};if(w.positions.length>128){const S=new d.aU(w.positions.length,16,Uint16Array);for(const{x:A,y:z}of w.positions)S.add(A,z);S.finish(),delete w.positions,w.index=S}this._symbolsByKey[_]=w}}getScaledCoordinates(t,a){const{x:l,y:h,z:_}=this.tileID.canonical,{x:v,y:w,z:S}=a.canonical,A=Xt/Math.pow(2,S-_),z=(w*d.a5+t.anchorY)*A,R=h*d.a5*Xt;return{x:Math.floor((v*d.a5+t.anchorX)*A-l*d.a5*Xt),y:Math.floor(z-R)}}findMatches(t,a,l){const h=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let _=0;_<t.length;_++){const v=t.get(_);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const S=this.getScaledCoordinates(v,a);if(w.index){const A=w.index.range(S.x-h,S.y-h,S.x+h,S.y+h).sort();for(const z of A){const R=w.crossTileIDs[z];if(!l[R]){l[R]=!0,v.crossTileID=R;break}}}else if(w.positions)for(let A=0;A<w.positions.length;A++){const z=w.positions[A],R=w.crossTileIDs[A];if(Math.abs(z.x-S.x)<=h&&Math.abs(z.y-S.y)<=h&&!l[R]){l[R]=!0,v.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class hh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class uu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const l in this.indexes){const h=this.indexes[l],_={};for(const v in h){const w=h[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+a),_[w.tileID.key]=w}this.indexes[l]=_}this.lng=t}addBucket(t,a,l){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<a.symbolInstances.length;_++)a.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const h=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>t.overscaledZ)for(const w in v){const S=v[w];S.tileID.isChildOf(t)&&S.findMatches(a.symbolInstances,t,h)}else{const w=v[t.scaledTo(Number(_)).key];w&&w.findMatches(a.symbolInstances,t,h)}}for(let _=0;_<a.symbolInstances.length;_++){const v=a.symbolInstances.get(_);v.crossTileID||(v.crossTileID=l.generate(),h[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Pa(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const l of a.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[t][h]}removeStaleBuckets(t){let a=!1;for(const l in this.indexes){const h=this.indexes[l];for(const _ in h)t[h[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[_]),delete h[_],a=!0)}return a}}class Xn{constructor(){this.layerIndexes={},this.crossTileIDs=new hh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,l){let h=this.layerIndexes[t.id];h===void 0&&(h=this.layerIndexes[t.id]=new uu);let _=!1;const v={};h.handleWrapJump(l);for(const w of a){const S=w.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(w.tileID,S,this.crossTileIDs)&&(_=!0),v[S.bucketInstanceId]=!0)}return h.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(t){const a={};t.forEach((l=>{a[l]=!0}));for(const l in this.layerIndexes)a[l]||delete this.layerIndexes[l]}}var Dn="void main() {fragColor=vec4(1.0);}";const $i={prelude:Bt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Bt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Bt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Bt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Bt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Bt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Bt(Dn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Bt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Bt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Bt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Bt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Bt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Bt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Bt(Dn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Bt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Bt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Bt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Bt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Bt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Bt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Bt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Bt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Bt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Bt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Bt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Bt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Bt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Bt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Bt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Bt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Bt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Bt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Bt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Bt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Bt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Bt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Bt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Bt(m,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=t.match(/in ([\w]+) ([\w]+)/g),h=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=_?_.concat(h):h,w={};return{fragmentSource:m=m.replace(a,((S,A,z,R,P)=>(w[P]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${P}
in ${z} ${R} ${P};
#else
uniform ${z} ${R} u_${P};
#endif
`:`
#ifdef HAS_UNIFORM_u_${P}
    ${z} ${R} ${P} = u_${P};
#endif
`))),vertexSource:t=t.replace(a,((S,A,z,R,P)=>{const F=R==="float"?"vec2":"vec4",U=P.match(/color/)?"color":F;return w[P]?A==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
in ${z} ${F} a_${P};
out ${z} ${R} ${P};
#else
uniform ${z} ${R} u_${P};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = a_${P};
#else
    ${z} ${R} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = unpack_mix_${U}(a_${P}, u_${P}_t);
#else
    ${z} ${R} ${P} = u_${P};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
in ${z} ${F} a_${P};
#else
uniform ${z} ${R} u_${P};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${z} ${R} ${P} = a_${P};
#else
    ${z} ${R} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${z} ${R} ${P} = unpack_mix_${U}(a_${P}, u_${P}_t);
#else
    ${z} ${R} ${P} = u_${P};
#endif
`})),staticAttributes:l,staticUniforms:v}}class Bi{constructor(t,a,l){this.vertexBuffer=t,this.indexBuffer=a,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var _a=d.aV([{name:"a_pos",type:"Int16",components:2}]);const mn="#define PROJECTION_MERCATOR",Sr="mercator";class Yn{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Sr}get shaderDefine(){return mn}get shaderPreludeCode(){return $i.projectionMercator}get vertexShaderPreludeCode(){return $i.projectionMercator.vertexSource}get subdivisionGranularity(){return d.aW.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,l,h,_){if(this._cachedMesh)return this._cachedMesh;const v=new d.aX;v.emplaceBack(0,0),v.emplaceBack(d.a5,0),v.emplaceBack(0,d.a5),v.emplaceBack(d.a5,d.a5);const w=t.createVertexBuffer(v,_a.members),S=d.aY.simpleSegment(0,0,4,2),A=new d.aZ;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3);const z=t.createIndexBuffer(A);return this._cachedMesh=new Bi(w,z,S),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class Jr{constructor(t=0,a=0,l=0,h=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=l,this.right=h}interpolate(t,a,l){return a.top!=null&&t.top!=null&&(this.top=d.G.number(t.top,a.top,l)),a.bottom!=null&&t.bottom!=null&&(this.bottom=d.G.number(t.bottom,a.bottom,l)),a.left!=null&&t.left!=null&&(this.left=d.G.number(t.left,a.left,l)),a.right!=null&&t.right!=null&&(this.right=d.G.number(t.right,a.right,l)),this}getCenter(t,a){const l=d.ao((this.left+t-this.right)/2,0,t),h=d.ao((this.top+a-this.bottom)/2,0,a);return new d.P(l,h)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Jr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ka(m,t){if(!m.renderWorldCopies||m.lngRange)return;const a=t.lng-m.center.lng;t.lng+=a>180?-360:a<-180?360:0}function Xi(m){return Math.max(0,Math.floor(m))}class Ys{constructor(t,a){var l;this.applyConstrain=(h,_)=>this._constrainOverride!==null?this._constrainOverride(h,_):this._callbacks.defaultConstrain(h,_),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(l=a?.constrainOverride)!==null&&l!==void 0?l:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new d.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Xi(this._zoom),this._scale=d.ar(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Jr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,l){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=Xi(this._zoom),this._scale=d.ar(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new Jr(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!l&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=d.W(t,-180,180)*Math.PI/180;var l,h,_,v,w,S,A,z,R;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=Be(),l=this._rotationMatrix,_=-this._bearingInRadians,v=(h=this._rotationMatrix)[0],w=h[1],S=h[2],A=h[3],z=Math.sin(_),R=Math.cos(_),l[0]=v*R+S*z,l[1]=w*R+A*z,l[2]=v*-z+S*R,l[3]=w*-z+A*R)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=d.ao(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return d.a_(this._fovInRadians)}setFov(t){t=d.ao(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=d.aq(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=d.ar(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,l){this._unmodified=!1,this._edgeInsets.interpolate(t,a,l),this.constrainInternal(),this._calcMatrices()}resize(t,a,l=!0){this._width=t,this._height=a,l&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new fn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-d.ap,d.ap])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:l,minY:h,maxX:_,maxY:v}=d.ac.fromPoints(a).extend(t);return[new d.P(l,h),new d.P(_,h),new d.P(_,v),new d.P(l,v),new d.P(l,h)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:l}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(l),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=d.as(new Float64Array(16));d.Q(t,t,[this._width/2,-this._height/2,1]),d.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=d.as(new Float64Array(16)),d.Q(t,t,[1,-1,1]),d.O(t,t,[-1,-1,0]),d.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,l,h){const _=l!==void 0?l:this.bearing,v=h=h!==void 0?h:this.pitch,{distanceToCenter:w,clampedElevation:S}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,v),{x:A,y:z}=Ti(v,_),R=d.ab.fromLngLat(t,a);let P,F,U=d.a$(1,R.y),X=0;do{if(X+=1,X>10)break;F=w/U,P=new d.ab(R.x+A*F,R.y+z*F),U=1/P.meterInMercatorCoordinateUnits()}while(Math.abs(w-F*U)>1e-12);return{center:P.toLngLat(),elevation:S,zoom:d.au(this.height/2/Math.tan(this.fovInRadians/2)/F/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,l=d.at(1,this.center.lat)*this.worldSize,h=d.ab.fromLngLat(this.center,this.elevation),_=h.x/a,v=h.y/a,w=h.z/a,S=this.pitch,A=this.bearing,{x:z,y:R,z:P}=Ti(S,A),F=this.cameraToCenterDistance,U=_+F*-z,X=v+F*-R,W=w+F*P,{distanceToCenter:Y,clampedElevation:Q}=this._distanceToCenterFromAltElevationPitch(W/l,t,S),ne=Y*l,K=new d.ab((U+z*ne)*a,(X+R*ne)*a,0).toLngLat(),ae=d.at(1,K.lat),le=d.au(this.height/2/Math.tan(this.fovInRadians/2)/Y/ae/this.tileSize);this._elevation=Q,this._center=K,this.setZoom(le)}_distanceToCenterFromAltElevationPitch(t,a,l){const h=-Math.cos(d.aq(l)),_=t-a;let v,w=a;return h*_>=0||Math.abs(h)<.1?(v=1e4,w=t+v*h):v=-_/h,{distanceToCenter:v,clampedElevation:w}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=d.at(1,this.center.lat)*this.worldSize;return xe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/d.a5,1/a/d.a5]}}class ea{constructor(t,a){this.min=t,this.max=a,this.center=d.b0([],d.b1([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],l=d.b2(this.min),h=d.b2(this.max);for(let _=0;_<a.length;_++)l[_]=a[_]?this.min[_]:this.center[_],h[_]=a[_]?this.center[_]:this.max[_];return h[2]=this.max[2],new ea(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let l=0;l<t.planes.length;l++){const h=this.intersectsPlane(t.planes[l]);if(h===0)return 0;h===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],l=t[3];for(let h=0;h<3;h++)t[h]>0?(a+=t[h]*this.min[h],l+=t[h]*this.max[h]):(l+=t[h]*this.min[h],a+=t[h]*this.max[h]);return a>=0?2:l<0?0:1}}class zo{distanceToTile2d(t,a,l,h){const _=h.distanceX([t,a]),v=h.distanceY([t,a]);return Math.hypot(_,v)}getWrap(t,a,l){return l}getTileBoundingVolume(t,a,l,h){var _,v;let w=0,S=0;if(h?.terrain){const z=new d.a2(t.z,a,t.z,t.x,t.y),R=h.terrain.getMinMaxElevation(z);w=(_=R.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=R.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}const A=1<<t.z;return new ea([a+t.x/A,t.y/A,w],[a+(t.x+1)/A,(t.y+1)/A,S])}allowVariableZoom(t,a){const l=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,h=d.ao(78.5-l/2,0,60);return!!a.terrain||t.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class Mr{constructor(t,a,l){this.points=t,this.planes=a,this.aabb=l}static fromInvProjectionMatrix(t,a=1,l=0,h,_){const v=_?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],w=Math.pow(2,l),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((P=>(function(F,U,X,W){const Y=d.aI([],F,U),Q=1/Y[3]/X*W;return d.b7(Y,Y,[Q,Q,1/Y[3],Q])})(P,t,a,w)));h&&(function(P,F,U,X){const W=X?4:0,Y=X?0:4;let Q=0;const ne=[],K=[];for(let ee=0;ee<4;ee++){const de=d.b3([],P[ee+Y],P[ee+W]),Me=d.b8(de);d.b0(de,de,1/Me),ne.push(Me),K.push(de)}for(let ee=0;ee<4;ee++){const de=d.b9(P[ee+W],K[ee],U);Q=de!==null&&de>=0?Math.max(Q,de):Math.max(Q,ne[ee])}const ae=(function(ee,de){const Me=d.b3([],ee[de[0]],ee[de[1]]),be=d.b3([],ee[de[2]],ee[de[1]]),Ee=[0,0,0,0];return d.b4(Ee,d.b5([],Me,be)),Ee[3]=-d.b6(Ee,ee[de[0]]),Ee})(P,F),le=(function(ee,de){const Me=d.ba(ee),be=d.bb([],ee,1/Me),Ee=d.b3([],de,d.b0([],be,d.b6(de,be))),Ce=d.ba(Ee);if(Ce>0){const He=Math.sqrt(1-be[3]*be[3]),et=d.b0([],be,-be[3]),qe=d.b1([],et,d.b0([],Ee,He/Ce));return d.bc(de,qe)}return null})(U,ae);if(le!==null){const ee=le/d.b6(K[0],ae);Q=Math.min(Q,ee)}for(let ee=0;ee<4;ee++){const de=Math.min(Q,ne[ee]);P[ee+Y]=[P[ee+W][0]+K[ee][0]*de,P[ee+W][1]+K[ee][1]*de,P[ee+W][2]+K[ee][2]*de,1]}})(S,v[0],h,_);const A=v.map((P=>{const F=d.b3([],S[P[0]],S[P[1]]),U=d.b3([],S[P[2]],S[P[1]]),X=d.b4([],d.b5([],F,U)),W=-d.b6(X,S[P[1]]);return X.concat(W)})),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],R=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const P of S)for(let F=0;F<3;F++)z[F]=Math.min(z[F],P[F]),R[F]=Math.max(R[F],P[F]);return new Mr(S,A,new ea(z,R))}}class Bn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,l=!0){this._helper.resize(t,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,l)=>{l=d.ao(+l,this.minZoom,this.maxZoom);const h={center:new d.V(a.lng,a.lat),zoom:l};let _=this._helper._lngRange;if(!this._helper._renderWorldCopies&&_===null){const K=179.9999999999;_=[-K,K]}const v=this.tileSize*d.ar(h.zoom);let w=0,S=v,A=0,z=v,R=0,P=0;const{x:F,y:U}=this.size;if(this._helper._latRange){const K=this._helper._latRange;w=d.X(K[1])*v,S=d.X(K[0])*v,S-w<U&&(R=U/(S-w))}_&&(A=d.W(d.Y(_[0])*v,0,v),z=d.W(d.Y(_[1])*v,0,v),z<A&&(z+=v),z-A<F&&(P=F/(z-A)));const{x:X,y:W}=Mt(v,a);let Y,Q;const ne=Math.max(P||0,R||0);if(ne){const K=new d.P(P?(z+A)/2:X,R?(S+w)/2:W);return h.center=Ft(v,K).wrap(),h.zoom+=d.au(ne),h}if(this._helper._latRange){const K=U/2;W-K<w&&(Q=w+K),W+K>S&&(Q=S-K)}if(_){const K=(A+z)/2;let ae=X;this._helper._renderWorldCopies&&(ae=d.W(X,K-v/2,K+v/2));const le=F/2;ae-le<A&&(Y=A+le),ae+le>z&&(Y=z-le)}if(Y!==void 0||Q!==void 0){const K=new d.P(Y??X,Q??W);h.center=Ft(v,K).wrap()}return h},this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new Ys({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._coveringTilesDetailsProvider=new zo}clone(){const t=new Bn;return t.apply(this),t}apply(t,a,l){this._helper.apply(t,a,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new d.bd(0,t)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new d.P(0,0)),h=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,0)),_=this.screenPointToMercatorCoordinate(new d.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new d.P(0,this._helper._height)),w=Math.floor(Math.min(l.x,h.x,_.x,v.x)),S=Math.floor(Math.max(l.x,h.x,_.x,v.x)),A=1;for(let z=w-A;z<=S+A;z++)z!==0&&a.push(new d.bd(z,t))}return a}getCameraFrustum(){return Mr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),l=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(t,a){const l=d.at(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(a,l),_=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),v=d.ab.fromLngLat(t),w=new d.ab(v.x-(h.x-_.x),v.y-(h.y-_.y));this.setCenter(w?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(d.ab.fromLngLat(t),a.getElevationForLngLat(t),this._pixelMatrix3D):this.coordinatePoint(d.ab.fromLngLat(t))}screenPointToLocation(t,a){var l;return(l=this.screenPointToMercatorCoordinate(t,a))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const l=a.pointCoordinate(t);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const l=a||0,h=[t.x,t.y,0,1],_=[t.x,t.y,1,1];d.aI(h,h,this._pixelMatrixInverse),d.aI(_,_,this._pixelMatrixInverse);const v=h[3],w=_[3],S=h[1]/v,A=_[1]/w,z=h[2]/v,R=_[2]/w,P=z===R?0:(l-z)/(R-z);return new d.ab(d.G.number(h[0]/v,_[0]/w,P)/this.worldSize,d.G.number(S,A,P)/this.worldSize,l)}coordinatePoint(t,a=0,l=this._pixelMatrix){const h=[t.x*this.worldSize,t.y*this.worldSize,a,1];return d.aI(h,h,l),new d.P(h[0]/h[3],h[1]/h[3])}getBounds(){const t=Math.max(0,this._helper._height/2-yi(this));return new fn().extend(this.screenPointToLocation(new d.P(0,t))).extend(this.screenPointToLocation(new d.P(this._helper._width,t))).extend(this.screenPointToLocation(new d.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new d.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-yi(this)}calculatePosMatrix(t,a=!1,l){var h;const _=(h=t.key)!==null&&h!==void 0?h:d.be(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),v=a?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(_)){const A=v.get(_);return l?A.f32:A.f64}const w=ui(t,this.worldSize);d.S(w,a?this._alignedProjMatrix:this._viewProjMatrix,w);const S={f64:w,f32:new Float32Array(w)};return v.set(_,S),l?S.f32:S.f64}calculateFogMatrix(t){const a=t.key,l=this._fogMatrixCacheF32;if(l.has(a))return l.get(a);const h=ui(t,this.worldSize);return d.S(h,this._fogMatrix,h),l.set(a,new Float32Array(h)),l.get(a)}calculateCenterFromCameraLngLatAlt(t,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,h)}_calculateNearFarZIfNeeded(t,a,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),_=t-h*this._helper._pixelPerMeter/Math.cos(a),v=h<0?_:t,w=Math.PI/2+this.pitchInRadians,S=d.aq(this.fov)*(Math.abs(Math.cos(d.aq(this.roll)))*this.height+Math.abs(Math.sin(d.aq(this.roll)))*this.width)/this.height*(.5+l.y/this.height),A=Math.sin(S)*v/Math.sin(d.ao(Math.PI-w-S,.01,Math.PI-.01)),z=yi(this),R=Math.atan(z/this._helper.cameraToCenterDistance),P=d.aq(.75),F=R>P?2*R*(.5+l.y/(2*z)):P,U=Math.sin(F)*v/Math.sin(d.ao(Math.PI-w-F,.01,Math.PI-.01)),X=Math.min(A,U);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*X+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=Mt(this.worldSize,this.center),l=a.x,h=a.y;this._helper._pixelPerMeter=d.at(1,this.center.lat)*this.worldSize;const _=d.aq(Math.min(this.pitch,gt)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(_));let w;this._calculateNearFarZIfNeeded(v,_,t),w=new Float64Array(16),d.bf(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),d.aC(this._invProjMatrix,w),w[8]=2*-t.x/this._helper._width,w[9]=2*t.y/this._helper._height,this._projectionMatrix=d.bg(w),d.Q(w,w,[1,-1,1]),d.O(w,w,[0,0,-this._helper.cameraToCenterDistance]),d.bh(w,w,-this.rollInRadians),d.bi(w,w,this.pitchInRadians),d.bh(w,w,-this.bearingInRadians),d.O(w,w,[-l,-h,0]),this._mercatorMatrix=d.Q([],w,[this.worldSize,this.worldSize,this.worldSize]),d.Q(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=d.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),d.O(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=d.aC([],w);const S=[0,0,-1,1];d.aI(S,S,this._invViewProjMatrix),this._cameraPosition=[S[0]/S[3],S[1]/S[3],S[2]/S[3]],this._fogMatrix=new Float64Array(16),d.bf(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,d.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),d.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),d.bh(this._fogMatrix,this._fogMatrix,-this.rollInRadians),d.bi(this._fogMatrix,this._fogMatrix,this.pitchInRadians),d.bh(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),d.O(this._fogMatrix,this._fogMatrix,[-l,-h,0]),d.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),d.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=d.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);const A=this._helper._width%2/2,z=this._helper._height%2/2,R=Math.cos(this.bearingInRadians),P=Math.sin(-this.bearingInRadians),F=l-Math.round(l)+R*A+P*z,U=h-Math.round(h)+R*z+P*A,X=new Float64Array(w);if(d.O(X,X,[F>.5?F-1:F,U>.5?U-1:U,0]),this._alignedProjMatrix=X,w=d.aC(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new d.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return d.aI(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=d.at(1,this.center.lat)*this.worldSize;return xe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const l=d.ab.fromLngLat(t),h=[l.x*this.worldSize,l.y*this.worldSize,a,1];return d.aI(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(t){const{overscaledTileID:a,aligned:l,applyTerrainMatrix:h}=t,_=this._helper.getMercatorTileCoordinates(a),v=a?this.calculatePosMatrix(a,l,!0):null;let w;return w=a&&a.terrainRttPosMatrix32f&&h?a.terrainRttPosMatrix32f:v||d.bj(),{mainMatrix:w,tileMercatorCoords:_,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,l){return 1}transformLightDirection(t){return d.b2(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,l,h){const _=this.calculatePosMatrix(l);let v;h?(v=[t,a,h(t,a),1],d.aI(v,v,_)):(v=[t,a,0,1],ga(v,v,_));const w=v[3];return{point:new d.P(v[0]/w,v[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const l=d.ab.fromLngLat(t,a),h=l.meterInMercatorCoordinateUnits(),_=d.bk();return d.O(_,_,[l.x,l.y,l.z]),d.bh(_,_,Math.PI),d.bi(_,_,Math.PI/2),d.Q(_,_,[-h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const a=new d.a2(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),h=ui(a,this.worldSize);d.S(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const _=[d.a5,d.a5,this.worldSize/this._helper.pixelsPerMeter],v=d.bl();return d.Q(v,h,_),l.fallbackMatrix=v,l.mainMatrix=v,l}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Er(){d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function cu(m){if(m.useSlerp)if(m.k<1){const t=d.bm(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),a=d.bm(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),l=new Float64Array(4);d.bn(l,t,a,m.k);const h=d.bo(l);m.tr.setRoll(h.roll),m.tr.setPitch(h.pitch),m.tr.setBearing(h.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(d.G.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(d.G.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(d.G.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function Do(m,t,a,l,h){const _=h.padding,v=Mt(h.worldSize,a.getNorthWest()),w=Mt(h.worldSize,a.getNorthEast()),S=Mt(h.worldSize,a.getSouthEast()),A=Mt(h.worldSize,a.getSouthWest()),z=d.aq(-l),R=v.rotate(z),P=w.rotate(z),F=S.rotate(z),U=A.rotate(z),X=new d.P(Math.max(R.x,P.x,U.x,F.x),Math.max(R.y,P.y,U.y,F.y)),W=new d.P(Math.min(R.x,P.x,U.x,F.x),Math.min(R.y,P.y,U.y,F.y)),Y=X.sub(W),Q=(h.width-(_.left+_.right+t.left+t.right))/Y.x,ne=(h.height-(_.top+_.bottom+t.top+t.bottom))/Y.y;if(ne<0||Q<0)return void Er();const K=Math.min(d.au(h.scale*Math.min(Q,ne)),m.maxZoom),ae=d.P.convert(m.offset),le=new d.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(d.aq(l)),ee=ae.add(le).mult(h.scale/d.ar(K));return{center:Ft(h.worldSize,v.add(S).div(2).sub(ee)),zoom:K,bearing:l}}class Io{get useGlobeControls(){return!1}handlePanInertia(t,a){const l=t.mag(),h=Math.abs(yi(a));return{easingOffset:t.mult(Math.min(.75*h/l,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,l){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(l,t.around)}cameraForBoxAndBearing(t,a,l,h,_){return Do(t,a,l,h,_)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(d.V.convert(a.center))}handleEaseTo(t,a){const l=t.zoom,h=t.padding,_={roll:t.roll,pitch:t.pitch,bearing:t.bearing},v={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},w=a.zoom!==void 0,S=!t.isPaddingEqual(a.padding);let A=!1;const z=w?+a.zoom:t.zoom;let R=t.centerPoint.add(a.offsetAsPoint);const P=t.screenPointToLocation(R),{center:F,zoom:U}=t.applyConstrain(d.V.convert(a.center||P),z??l);Ka(t,F);const X=Mt(t.worldSize,P),W=Mt(t.worldSize,F).sub(X),Y=d.ar(U-l);return A=U!==l,{easeFunc:Q=>{if(A&&t.setZoom(d.G.number(l,U,Q)),d.bp(_,v)||cu({startEulerAngles:_,endEulerAngles:v,tr:t,k:Q,useSlerp:_.roll!=v.roll}),S&&(t.interpolatePadding(h,a.padding,Q),R=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const ne=d.ar(t.zoom-l),K=U>l?Math.min(2,Y):Math.max(.5,Y),ae=Math.pow(K,1-Q),le=Ft(t.worldSize,X.add(W.mult(Q*ae)).mult(ne));t.setLocationAtPoint(t.renderWorldCopies?le.wrap():le,R)}},isZooming:A,elevationCenter:F}}handleFlyTo(t,a){const l=a.zoom!==void 0,h=t.zoom,_=t.applyConstrain(d.V.convert(a.center||a.locationAtOffset),l?+a.zoom:h),v=_.center,w=_.zoom;Ka(t,v);const S=Mt(t.worldSize,a.locationAtOffset),A=Mt(t.worldSize,v).sub(S),z=A.mag(),R=d.ar(w-h);let P;if(a.minZoom!==void 0){const F=Math.min(+a.minZoom,h,w),U=t.applyConstrain(v,F).zoom;P=d.ar(U-h)}return{easeFunc:(F,U,X,W)=>{t.setZoom(F===1?w:h+d.au(U));const Y=F===1?v:Ft(t.worldSize,S.add(A.mult(X)).mult(U));t.setLocationAtPoint(t.renderWorldCopies?Y.wrap():Y,W)},scaleOfZoom:R,targetCenter:v,scaleOfMinZoom:P,pixelPathLength:z}}}class Ai{constructor(t,a,l){this.blendFunction=t,this.blendColor=a,this.mask=l}}Ai.Replace=[1,0],Ai.disabled=new Ai(Ai.Replace,d.bq.transparent,[!1,!1,!1,!1]),Ai.unblended=new Ai(Ai.Replace,d.bq.transparent,[!0,!0,!0,!0]),Ai.alphaBlended=new Ai([1,771],d.bq.transparent,[!0,!0,!0,!0]);const Ws=2305;class Kt{constructor(t,a,l){this.enable=t,this.mode=a,this.frontFace=l}}Kt.disabled=new Kt(!1,1029,Ws),Kt.backCCW=new Kt(!0,1029,Ws),Kt.frontCCW=new Kt(!0,1028,Ws);class Zt{constructor(t,a,l){this.func=t,this.mask=a,this.range=l}}Zt.ReadOnly=!1,Zt.ReadWrite=!0,Zt.disabled=new Zt(519,Zt.ReadOnly,[0,1]);const Po=7680;class hi{constructor(t,a,l,h,_,v){this.test=t,this.ref=a,this.mask=l,this.fail=h,this.depthFail=_,this.pass=v}}hi.disabled=new hi({func:519,mask:0},0,0,Po,Po,Po);const hu=new WeakMap;function ya(m){var t;if(hu.has(m))return hu.get(m);{const a=(t=m.getParameter(m.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return hu.set(m,a),a}}class Qs{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,l=a.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new d.aX;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const _=new d.aZ;_.emplaceBack(0,1,2),this._fullscreenTriangle=new Bi(a.createVertexBuffer(h,_a.members),a.createIndexBuffer(_),d.aY.simpleSegment(0,0,h.length,_.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(l.TEXTURE1);const v=l.createTexture();l.bindTexture(l.TEXTURE_2D,v),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),ya(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:d.bq.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,Zt.disabled,hi.disabled,Ai.unblended,Kt.disabled,((_,v)=>({u_input:_,u_output_expected:v}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&ya(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const _=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:_}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&ya(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return d.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Qs._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const Ks=d.a5/128;function bd(m,t){const a=m.granularity!==void 0?Math.max(m.granularity,1):1,l=a+(m.generateBorders?2:0),h=a+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),_=l+1,v=h+1,w=m.generateBorders?-1:0,S=m.generateBorders||m.extendToNorthPole?-1:0,A=a+(m.generateBorders?1:0),z=a+(m.generateBorders||m.extendToSouthPole?1:0),R=_*v,P=l*h*6,F=_*v>65536;if(F&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const U=F||t==="32bit",X=new Int16Array(2*R);let W=0;for(let ne=S;ne<=z;ne++)for(let K=w;K<=A;K++){let ae=K/a*d.a5;K===-1&&(ae=-Ks),K===a+1&&(ae=d.a5+Ks);let le=ne/a*d.a5;ne===-1&&(le=m.extendToNorthPole?d.bs:-Ks),ne===a+1&&(le=m.extendToSouthPole?d.bt:d.a5+Ks),X[W++]=ae,X[W++]=le}const Y=U?new Uint32Array(P):new Uint16Array(P);let Q=0;for(let ne=0;ne<h;ne++)for(let K=0;K<l;K++){const ae=K+1+ne*_,le=K+(ne+1)*_,ee=K+1+(ne+1)*_;Y[Q++]=K+ne*_,Y[Q++]=le,Y[Q++]=ae,Y[Q++]=ae,Y[Q++]=le,Y[Q++]=ee}return{vertices:X.buffer.slice(0),indices:Y.buffer.slice(0),uses32bitIndices:U}}const du=new d.aW({fill:new d.bu(128,2),line:new d.bu(512,0),tile:new d.bu(128,32),stencil:new d.bu(128,1),circle:3});class dh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return $i.projectionGlobe}get vertexShaderPreludeCode(){return $i.projectionMercator.vertexSource}get subdivisionGranularity(){return du}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new Qs(t));const a=d.X(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(a,l),_=xt();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=_);const v=Math.min(Math.max((_-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=d.bv(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,d.bw(v))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,l,h,_){const v=(_==="stencil"?du.stencil:du.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:v,generateBorders:l,extendToNorthPole:a.y===0&&h,extendToSouthPole:a.y===(1<<a.z)-1&&h})}_getMesh(t,a){const l=this._getMeshKey(a);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=(function(_,v){const w=bd(v,"16bit"),S=d.aX.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),A=d.aZ.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new Bi(_.createVertexBuffer(S,_a.members),_.createIndexBuffer(A),d.aY.simpleSegment(0,0,S.length,A.length))})(t,a);return this._tileMeshCache[l]=h,h}recalculate(t){}hasTransition(){const t=xt();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const Cf=new d.t({type:new d.D(d.u.projection.type)});class fh extends d.E{constructor(t){super(),this._transitionable=new d.x(Cf,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.H(0)),this._mercatorProjection=new Yn,this._verticalPerspectiveProjection=new dh}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof d.bx){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,l,h,_){return this.currentProjection.getMeshFromTileID(t,a,l,h,_)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function Ar(m){const t=Ro(m.worldSize,m.center.lat);return 2*Math.PI*t}function Ja(m,t,a,l,h){const _=1/(1<<h),v=t/d.a5*_+l*_,w=d.bz((m/d.a5*_+a*_)*Math.PI*2+Math.PI,2*Math.PI),S=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,A=Math.cos(S),z=new Float64Array(3);return z[0]=Math.sin(w)*A,z[1]=Math.sin(S),z[2]=Math.cos(w)*A,z}function Yi(m){return(function(t,a){const l=Math.cos(a),h=new Float64Array(3);return h[0]=Math.sin(t)*l,h[1]=Math.sin(a),h[2]=Math.cos(t)*l,h})(m.lng*Math.PI/180,m.lat*Math.PI/180)}function Ro(m,t){return m/(2*Math.PI)/Math.cos(t*Math.PI/180)}function fu(m){const t=Math.asin(m[1])/Math.PI*180,a=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(a>1e-6){const l=m[0]/a,h=Math.acos(m[2]/a),_=(l>0?h:-h)/Math.PI*180;return new d.V(d.W(_,-180,180),t)}return new d.V(0,t)}function pu(m){return Math.cos(m*Math.PI/180)}function gn(m,t){const a=pu(m),l=pu(t);return d.au(l/a)}function wd(m,t){const a=m.rotate(t.bearingInRadians),l=t.zoom+gn(t.center.lat,0),h=d.bv(1/pu(t.center.lat),1/pu(Math.min(Math.abs(t.center.lat),60)),d.by(l,7,3,0,1)),_=360/Ar({worldSize:t.worldSize,center:{lat:t.center.lat}});return new d.V(t.center.lng-a.x*_*h,d.ao(t.center.lat+a.y*_,-d.ap,d.ap))}function oc(m){const t=.5*m,a=Math.sin(t),l=Math.cos(t);return Math.log(a+l)-Math.log(l-a)}function Td(m,t,a,l){const h=m.lat+a*l;if(Math.abs(a)>1){const _=(Math.sign(m.lat+a)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,v=Math.abs(m.lat+a)*Math.PI/180,w=oc(_+l*(v-_)),S=oc(_),A=oc(v);return new d.V(m.lng+t*((w-S)/(A-S)),h)}return new d.V(m.lng+t*l,h)}class zf{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,l,h){const _=`${t.z}_${t.x}_${t.y}_${h?.terrain?"t":""}`,v=this._cache.get(_);if(v)return v;const w=this._cachePrevious.get(_);if(w)return this._cache.set(_,w),w;const S=this._boundingVolumeFactory(t,a,l,h);return this._cache.set(_,S),this._hadAnyChanges=!0,S}}class bl{constructor(t,a,l,h){this.min=l,this.max=h,this.points=t,this.planes=a}static fromAabb(t,a){const l=[];for(let h=0;h<8;h++)l.push([1&~h?t[0]:a[0],(h>>1&1)==1?a[1]:t[1],(h>>2&1)==1?a[2]:t[2]]);return new bl(l,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,l){const h=d.bC([],l[0],l[1],l[2]),_=d.bD([],[a[0],0,0],h),v=d.bD([],[0,a[1],0],h),w=d.bD([],[0,0,a[2]],h),S=[...t],A=[...t];for(let R=0;R<8;R++)for(let P=0;P<3;P++){const F=t[P]+_[P]*(1&~R?-1:1)+v[P]*((R>>1&1)==1?1:-1)+w[P]*((R>>2&1)==1?1:-1);S[P]=Math.min(S[P],F),A[P]=Math.max(A[P],F)}const z=[];for(let R=0;R<8;R++){const P=[...t];d.b1(P,P,d.b0([],_,1&~R?-1:1)),d.b1(P,P,d.b0([],v,(R>>1&1)==1?1:-1)),d.b1(P,P,d.b0([],w,(R>>2&1)==1?1:-1)),z.push(P)}return new bl(z,[[..._,-d.b6(_,z[0])],[...v,-d.b6(v,z[0])],[...w,-d.b6(w,z[0])],[-_[0],-_[1],-_[2],-d.b6(_,z[7])],[-v[0],-v[1],-v[2],-d.b6(v,z[7])],[-w[0],-w[1],-w[2],-d.b6(w,z[7])]],S,A)}intersectsFrustum(t){let a=!0;const l=this.points.length,h=this.planes.length,_=t.planes.length,v=t.points.length;for(let w=0;w<_;w++){const S=t.planes[w];let A=0;for(let z=0;z<l;z++){const R=this.points[z];S[0]*R[0]+S[1]*R[1]+S[2]*R[2]+S[3]>=0&&A++}if(A===0)return 0;A<l&&(a=!1)}if(a)return 2;for(let w=0;w<h;w++){const S=this.planes[w];let A=0;for(let z=0;z<v;z++){const R=t.points[z];S[0]*R[0]+S[1]*R[1]+S[2]*R[2]+S[3]>=0&&A++}if(A===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let l=0;for(let h=0;h<a;h++){const _=this.points[h];t[0]*_[0]+t[1]*_[1]+t[2]*_[2]+t[3]>=0&&l++}return l===a?2:l===0?0:1}}function lc(m,t,a){const l=m-t;return l<0?-l:Math.max(0,l-a)}function wl(m,t,a,l,h){const _=m-a;let v;return v=_<0?Math.min(-_,1+_-h):_>1?Math.min(Math.max(_-h,0),1-_):0,Math.max(v,lc(t,l,h))}class ph{constructor(){this._boundingVolumeCache=new zf(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,l,h){const _=1<<l.z,v=1/_,w=l.x/_,S=l.y/_;let A=2;return A=Math.min(A,wl(t,a,w,S,v)),A=Math.min(A,wl(t,a,w+.5,-S-v,v)),A=Math.min(A,wl(t,a,w+.5,2-S-v,v)),A}getWrap(t,a,l){const h=1<<a.z,_=1/h,v=a.x/h,w=lc(t.x,v,_),S=lc(t.x,v-1,_),A=lc(t.x,v+1,_),z=Math.min(w,S,A);return z===A?1:z===S?-1:0}allowVariableZoom(t,a){return Ei(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,l,h){return this._boundingVolumeCache.getTileBoundingVolume(t,a,l,h)}_computeTileBoundingVolume(t,a,l,h){var _,v;let w=0,S=0;if(h?.terrain){const A=new d.a2(t.z,a,t.z,t.x,t.y),z=h.terrain.getMinMaxElevation(A);w=(_=z.minElevation)!==null&&_!==void 0?_:Math.min(0,l),S=(v=z.maxElevation)!==null&&v!==void 0?v:Math.max(0,l)}if(w/=d.bF,S/=d.bF,w+=1,S+=1,t.z<=0)return bl.fromAabb([-S,-S,-S],[S,S,S]);if(t.z===1)return bl.fromAabb([t.x===0?-S:0,t.y===0?0:-S,-S],[t.x===0?0:S,t.y===0?S:0,S]);{const A=[Ja(0,0,t.x,t.y,t.z),Ja(d.a5,0,t.x,t.y,t.z),Ja(d.a5,d.a5,t.x,t.y,t.z),Ja(0,d.a5,t.x,t.y,t.z)],z=[];for(const Ee of A)z.push(d.b0([],Ee,S));if(S!==w)for(const Ee of A)z.push(d.b0([],Ee,w));t.y===0&&z.push([0,1,0]),t.y===(1<<t.z)-1&&z.push([0,-1,0]);const R=[1,1,1],P=[-1,-1,-1];for(const Ee of z)for(let Ce=0;Ce<3;Ce++)R[Ce]=Math.min(R[Ce],Ee[Ce]),P[Ce]=Math.max(P[Ce],Ee[Ce]);const F=Ja(d.a5/2,d.a5/2,t.x,t.y,t.z),U=d.b5([],[0,1,0],F);d.b4(U,U);const X=d.b5([],F,U);d.b4(X,X);const W=d.b5([],A[2],A[1]);d.b4(W,W);const Y=d.b5([],A[0],A[3]);d.b4(Y,Y),z.push(d.b0([],F,S)),t.y>=(1<<t.z)/2&&z.push(d.b0([],Ja(d.a5/2,0,t.x,t.y,t.z),S)),t.y<(1<<t.z)/2&&z.push(d.b0([],Ja(d.a5/2,d.a5,t.x,t.y,t.z),S));const Q=mu(F,z),ne=mu(X,z),K=[-F[0],-F[1],-F[2],Q.max],ae=[F[0],F[1],F[2],-Q.min],le=[-X[0],-X[1],-X[2],ne.max],ee=[X[0],X[1],X[2],-ne.min],de=[...W,0],Me=[...Y,0],be=[];return t.y===0?be.push(d.bE(Me,de,K),d.bE(Me,de,ae)):be.push(d.bE(le,de,K),d.bE(le,de,ae),d.bE(le,Me,K),d.bE(le,Me,ae)),t.y===(1<<t.z)-1?be.push(d.bE(Me,de,K),d.bE(Me,de,ae)):be.push(d.bE(ee,de,K),d.bE(ee,de,ae),d.bE(ee,Me,K),d.bE(ee,Me,ae)),new bl(be,[K,ae,le,ee,de,Me],R,P)}}}function mu(m,t){let a=1/0,l=-1/0;for(const h of t){const _=d.b6(m,h);a=Math.min(a,_),l=Math.max(l,_)}return{min:a,max:l}}class Tl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=d.bG(),this._projectionMatrix=d.bk(),this._globeViewProjMatrix32f=d.bj(),this._globeViewProjMatrixNoCorrection=d.bk(),this._globeViewProjMatrixNoCorrectionInverted=d.bk(),this._globeProjMatrixInverted=d.bk(),this._cameraPosition=d.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,l)=>{const h=d.ao(a.lat,-d.ap,d.ap),_=d.ao(+l,this.minZoom+gn(0,h),this.maxZoom);return{center:new d.V(a.lng,h),zoom:_}},this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new Ys({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._coveringTilesDetailsProvider=new ph}clone(){const t=new Tl;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=d.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:l}=t,h=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,l=this.cameraToCenterDistance/t,h=Math.sin(a)*l,_=Math.cos(a)*l+1,v=1/Math.sqrt(h*h+_*_)*1;let w=-h,S=_;const A=Math.sqrt(w*w+S*S);w/=A,S/=A;const z=[0,w,S];d.bH(z,z,[0,0,0],-this.bearingInRadians),d.bI(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),d.bJ(z,z,[0,0,0],this.center.lng*Math.PI/180);const R=1/d.b8(z);return d.b0(z,z,R),[...z,-v*R]}isLocationOccluded(t){return!this.isSurfacePointVisible(Yi(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),_=[Math.sin(a)*h,Math.sin(l),Math.cos(a)*h],v=[_[2],0,-_[0]],w=[0,0,0];d.b5(w,v,_),d.b4(v,v),d.b4(w,w);const S=[0,0,0];return d.b4(S,[v[0]*t[0]+w[0]*t[1]+_[0]*t[2],v[1]*t[0]+w[1]*t[1]+_[1]*t[2],v[2]*t[0]+w[2]*t[1]+_[2]*t[2]]),S}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,l){const h=(function(w,S,A){const z=1/(1<<A.z);return new d.ab(w/d.a5*z+A.x*z,S/d.a5*z+A.y*z)})(t,a,l.canonical),_=(v=h.y,[d.bz(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(_[1])}projectTileCoordinates(t,a,l,h){const _=l.canonical,v=Ja(t,a,_.x,_.y,_.z),w=1+(h?h(t,a):0)/d.bF,S=[v[0]*w,v[1]*w,v[2]*w,1];d.aI(S,S,this._globeViewProjMatrixNoCorrection);const A=this._cachedClippingPlane,z=A[0]*v[0]+A[1]*v[1]+A[2]*v[2]+A[3]<0;return{point:new d.P(S[0]/S[3],S[1]/S[3]),signedDistanceFromCamera:S[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Ro(this.worldSize,this.center.lat),a=d.bl(),l=d.bl();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),d.bf(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;a[8]=2*-h.x/this._helper._width,a[9]=2*h.y/this._helper._height,this._projectionMatrix=d.bg(a),this._globeProjMatrixInverted=d.bl(),d.aC(this._globeProjMatrixInverted,a),d.O(a,a,[0,0,-this.cameraToCenterDistance]),d.bh(a,a,this.rollInRadians),d.bi(a,a,-this.pitchInRadians),d.bh(a,a,this.bearingInRadians),d.O(a,a,[0,0,-t]);const _=d.bA();_[0]=t,_[1]=t,_[2]=t,d.bi(l,a,this.center.lat*Math.PI/180),d.bK(l,l,-this.center.lng*Math.PI/180),d.Q(l,l,_),this._globeViewProjMatrixNoCorrection=l,d.bi(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),d.bK(a,a,-this.center.lng*Math.PI/180),d.Q(a,a,_),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=d.bl(),d.aC(this._globeViewProjMatrixNoCorrectionInverted,l);const v=d.bA();this._cameraPosition=d.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,d.bH(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),d.bI(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),d.bH(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),d.b1(this._cameraPosition,this._cameraPosition,[0,0,1]),d.bI(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),d.bJ(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const w=d.bg(this._globeViewProjMatrixNoCorrectionInverted);d.Q(w,w,[1,1,-1]),this._cachedFrustum=Mr.fromInvProjectionMatrix(w,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){d.w("calculateFogMatrix is not supported on globe projection.");const a=d.bl();return d.as(a),a}getVisibleUnwrappedCoordinates(t){return[new d.bd(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&d.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Yi(t);d.b0(l,l,1+a/d.bF);const h=d.bG();return d.aI(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,l=[new d.P(0,0),new d.P(t,0),new d.P(this.width,0),new d.P(this.width,a),new d.P(this.width,this.height),new d.P(t,this.height),new d.P(0,this.height),new d.P(0,a)],h=[];for(const R of l)h.push(this.unprojectScreenPoint(R));let _=0,v=0,w=0,S=0;const A=this.center;for(const R of h){const P=d.bL(A.lng,R.lng),F=d.bL(A.lat,R.lat);P<v&&(v=P),P>_&&(_=P),F<S&&(S=F),F>w&&(w=F)}const z=[A.lng+v,A.lat+S,A.lng+_,A.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new fn(z)}calculateCenterFromCameraLngLatAlt(t,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,h)}setLocationAtPoint(t,a){const l=Yi(this.unprojectScreenPoint(a)),h=Yi(t),_=d.bA();d.bM(_);const v=d.bA();d.bJ(v,l,_,-this.center.lng*Math.PI/180),d.bI(v,v,_,this.center.lat*Math.PI/180);const w=h[0]*h[0]+h[2]*h[2],S=v[0]*v[0];if(w<S)return;const A=Math.sqrt(w-S),z=-A,R=d.bN(h[0],h[2],v[0],A),P=d.bN(h[0],h[2],v[0],z),F=d.bA();d.bJ(F,h,_,-R);const U=d.bN(F[1],F[2],v[1],v[2]),X=d.bA();d.bJ(X,h,_,-P);const W=d.bN(X[1],X[2],v[1],v[2]),Y=.5*Math.PI,Q=U>=-Y&&U<=Y,ne=W>=-Y&&W<=Y;let K,ae;if(Q&&ne){const Me=this.center.lng*Math.PI/180,be=this.center.lat*Math.PI/180;d.bO(R,Me)+d.bO(U,be)<d.bO(P,Me)+d.bO(W,be)?(K=R,ae=U):(K=P,ae=W)}else if(Q)K=R,ae=U;else{if(!ne)return;K=P,ae=W}const le=K/Math.PI*180,ee=ae/Math.PI*180,de=this.center.lat;this.setCenter(new d.V(le,d.ao(ee,-90,90))),this.setZoom(this.zoom+gn(de,this.center.lat))}locationToScreenPoint(t,a){const l=Yi(t);if(a){const h=a.getElevationForLngLatZoom(t,this._helper._tileZoom);d.b0(l,l,1+h/d.bF)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(t){const a=d.bG();return d.aI(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new d.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const l=a.pointCoordinate(t);if(l)return l}return d.ab.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var l;return(l=this.screenPointToMercatorCoordinate(t,a))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(t,a){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(t){const a=d.bG();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,d.aI(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const l=d.bA();l[0]=a[0]-this._cameraPosition[0],l[1]=a[1]-this._cameraPosition[1],l[2]=a[2]-this._cameraPosition[2];const h=d.bA();return d.b4(h,l),h}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=d.bG();return d.aI(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const l=d.b6(t,a),h=d.bA(),_=d.bA();d.b0(_,a,l),d.b3(h,t,_);const v=1-d.b6(h,h);if(v<0)return null;const w=d.b6(t,t)-1,S=-l+(l<0?1:-1)*Math.sqrt(v),A=w/S,z=S;return{tMin:Math.min(A,z),tMax:Math.max(A,z)}}unprojectScreenPoint(t){const a=this._cameraPosition,l=this.getRayDirectionFromPixel(t),h=this.rayPlanetIntersection(a,l);if(h){const z=d.bA();d.b1(z,a,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const R=d.bA();return d.b4(R,z),fu(R)}const _=this._cachedClippingPlane,v=_[0]*l[0]+_[1]*l[1]+_[2]*l[2],w=-d.bc(_,a)/v,S=d.bA();if(w>0)d.b1(S,a,[l[0]*w,l[1]*w,l[2]*w]);else{const z=d.bA();d.b1(z,a,[2*l[0],2*l[1],2*l[2]]);const R=d.bc(this._cachedClippingPlane,z);d.b3(S,z,[this._cachedClippingPlane[0]*R,this._cachedClippingPlane[1]*R,this._cachedClippingPlane[2]*R])}const A=(function(z){const R=d.bA();return R[0]=z[0]*-z[3],R[1]=z[1]*-z[3],R[2]=z[2]*-z[3],{center:R,radius:Math.sqrt(1-z[3]*z[3])}})(_);return fu((function(z,R,P){const F=d.bA();d.b3(F,P,z);const U=d.bA();return d.bB(U,z,F,R/d.ba(F)),U})(A.center,A.radius,S))}getMatrixForModel(t,a){const l=d.V.convert(t),h=1/d.bF,_=d.bk();return d.bK(_,_,l.lng/180*Math.PI),d.bi(_,_,-l.lat/180*Math.PI),d.O(_,_,[0,0,1+a/d.bF]),d.bi(_,_,.5*Math.PI),d.Q(_,_,[h,h,h]),_}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new d.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class Sl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,l){return this._helper.interpolatePadding(t,a,l)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,l=!0){this._helper.resize(t,a,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,l)=>this.currentTransform.defaultConstrain(a,l),this.applyConstrain=(a,l)=>this._helper.applyConstrain(a,l),this._helper=new Ys({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,l)=>this.defaultConstrain(a,l)},t),this._globeness=1,this._mercatorTransform=new Bn,this._verticalPerspectiveTransform=new Tl}clone(){const t=new Sl;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),l=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:a.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return d.bv(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return d.bv(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,l){const h=this._mercatorTransform.getPitchedTextCorrection(t,a,l),_=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,l);return d.bv(h,_,this._globeness)}projectTileCoordinates(t,a,l,h){return this.currentTransform.projectTileCoordinates(t,a,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,l,h)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return l.fallbackMatrix=a.mainMatrix,l}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Tn{get useGlobeControls(){return!0}handlePanInertia(t,a){const l=wd(t,a);return Math.abs(l.lng-a.center.lng)>180&&(l.lng=a.center.lng+179.5*Math.sign(l.lng-a.center.lng)),{easingCenter:l,easingOffset:new d.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const l=t.around,h=a.screenPointToLocation(l);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const _=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const v=a.zoom-_;if(v===0)return;const w=d.bL(a.center.lng,h.lng),S=w/(Math.abs(w/180)+1),A=d.bL(a.center.lat,h.lat),z=a.getRayDirectionFromPixel(l),R=a.cameraPosition,P=-1*d.b6(R,z),F=d.bA();d.b1(F,R,[z[0]*P,z[1]*P,z[2]*P]);const U=d.b8(F)-1,X=Math.exp(.5*-Math.max(U-.3,0)),W=Ro(a.worldSize,a.center.lat)/Math.min(a.width,a.height),Y=d.by(W,.9,.5,1,.25),Q=(1-d.ar(-v))*Math.min(X,Y),ne=a.center.lat,K=a.zoom,ae=new d.V(a.center.lng+S*Q,d.ao(a.center.lat+A*Q,-d.ap,d.ap));a.setLocationAtPoint(h,l);const le=a.center,ee=d.by(Math.abs(w),45,85,0,1),de=d.by(W,.75,.35,0,1),Me=Math.pow(Math.max(ee,de),.25),be=d.bL(le.lng,ae.lng),Ee=d.bL(le.lat,ae.lat);a.setCenter(new d.V(le.lng+be*Me,le.lat+Ee*Me).wrap()),a.setZoom(K+gn(ne,a.center.lat))}handleMapControlsPan(t,a,l){if(!t.panDelta)return;const h=a.center.lat,_=a.zoom;a.setCenter(wd(t.panDelta,a).wrap()),a.setZoom(_+gn(h,a.center.lat))}cameraForBoxAndBearing(t,a,l,h,_){const v=Do(t,a,l,h,_),w=a.left/_.width*2-1,S=(_.width-a.right)/_.width*2-1,A=a.top/_.height*-2+1,z=(_.height-a.bottom)/_.height*-2+1,R=d.bL(l.getWest(),l.getEast())<0,P=R?l.getEast():l.getWest(),F=R?l.getWest():l.getEast(),U=Math.max(l.getNorth(),l.getSouth()),X=Math.min(l.getNorth(),l.getSouth()),W=P+.5*d.bL(P,F),Y=U+.5*d.bL(U,X),Q=_.clone();Q.setCenter(v.center),Q.setBearing(v.bearing),Q.setPitch(0),Q.setRoll(0),Q.setZoom(v.zoom);const ne=Q.modelViewProjectionMatrix,K=[Yi(l.getNorthWest()),Yi(l.getNorthEast()),Yi(l.getSouthWest()),Yi(l.getSouthEast()),Yi(new d.V(F,Y)),Yi(new d.V(P,Y)),Yi(new d.V(W,U)),Yi(new d.V(W,X))],ae=Yi(v.center);let le=Number.POSITIVE_INFINITY;for(const ee of K)w<0&&(le=Tn.getLesserNonNegativeNonNull(le,Tn.solveVectorScale(ee,ae,ne,"x",w))),S>0&&(le=Tn.getLesserNonNegativeNonNull(le,Tn.solveVectorScale(ee,ae,ne,"x",S))),A>0&&(le=Tn.getLesserNonNegativeNonNull(le,Tn.solveVectorScale(ee,ae,ne,"y",A))),z<0&&(le=Tn.getLesserNonNegativeNonNull(le,Tn.solveVectorScale(ee,ae,ne,"y",z)));if(Number.isFinite(le)&&le!==0)return v.zoom=Q.zoom+d.au(le),v;Er()}handleJumpToCenterZoom(t,a){const l=t.center.lat,h=t.applyConstrain(a.center?d.V.convert(a.center):t.center,t.zoom).center;t.setCenter(h.wrap());const _=a.zoom!==void 0?+a.zoom:t.zoom+gn(l,h.lat);t.zoom!==_&&t.setZoom(_)}handleEaseTo(t,a){const l=t.zoom,h=t.center,_=t.padding,v={roll:t.roll,pitch:t.pitch,bearing:t.bearing},w={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},S=a.zoom!==void 0,A=!t.isPaddingEqual(a.padding);let z=!1;const R=a.center?d.V.convert(a.center):h,P=t.applyConstrain(R,l).center;Ka(t,P);const F=t.clone();F.setCenter(P),F.setZoom(S?+a.zoom:l+gn(h.lat,R.lat)),F.setBearing(a.bearing);const U=new d.P(d.ao(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),d.ao(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));F.setLocationAtPoint(P,U);const X=(a.offset&&a.offsetAsPoint.mag())>0?F.center:P,W=S?+a.zoom:l+gn(h.lat,X.lat),Y=l+gn(h.lat,0),Q=W+gn(X.lat,0),ne=d.bL(h.lng,X.lng),K=d.bL(h.lat,X.lat),ae=d.ar(Q-Y);return z=W!==l,{easeFunc:le=>{if(d.bp(v,w)||cu({startEulerAngles:v,endEulerAngles:w,tr:t,k:le,useSlerp:v.roll!=w.roll}),A&&t.interpolatePadding(_,a.padding,le),a.around)d.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const ee=Q>Y?Math.min(2,ae):Math.max(.5,ae),de=Math.pow(ee,1-le),Me=Td(h,ne,K,le*de);t.setCenter(Me.wrap())}if(z){const ee=d.G.number(Y,Q,le)+gn(0,t.center.lat);t.setZoom(ee)}},isZooming:z,elevationCenter:X}}handleFlyTo(t,a){const l=a.zoom!==void 0,h=t.center,_=t.zoom,v=t.padding,w=!t.isPaddingEqual(a.padding),S=t.applyConstrain(d.V.convert(a.center||a.locationAtOffset),_).center,A=l?+a.zoom:t.zoom+gn(t.center.lat,S.lat),z=t.clone();z.setCenter(S),z.setZoom(A),z.setBearing(a.bearing);const R=new d.P(d.ao(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),d.ao(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));z.setLocationAtPoint(S,R);const P=z.center;Ka(t,P);const F=(function(K,ae,le){const ee=Yi(ae),de=Yi(le),Me=d.b6(ee,de),be=Math.acos(Me),Ee=Ar(K);return be/(2*Math.PI)*Ee})(t,h,P),U=_+gn(h.lat,0),X=A+gn(P.lat,0),W=d.ar(X-U);let Y;if(typeof a.minZoom=="number"){const K=+a.minZoom+gn(P.lat,0),ae=Math.min(K,U,X)+gn(0,P.lat),le=t.applyConstrain(P,ae).zoom+gn(P.lat,0);Y=d.ar(le-U)}const Q=d.bL(h.lng,P.lng),ne=d.bL(h.lat,P.lat);return{easeFunc:(K,ae,le,ee)=>{const de=Td(h,Q,ne,le);w&&t.interpolatePadding(v,a.padding,K);const Me=K===1?P:de;t.setCenter(Me.wrap());const be=U+d.au(ae);t.setZoom(K===1?A:be+gn(0,Me.lat))},scaleOfZoom:W,targetCenter:P,scaleOfMinZoom:Y,pixelPathLength:F}}static solveVectorScale(t,a,l,h,_){const v=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],w=[l[3],l[7],l[11],l[15]],S=t[0]*v[0]+t[1]*v[1]+t[2]*v[2],A=t[0]*w[0]+t[1]*w[1]+t[2]*w[2],z=a[0]*v[0]+a[1]*v[1]+a[2]*v[2],R=a[0]*w[0]+a[1]*w[1]+a[2]*w[2];return z+_*A===S+_*R||w[3]*(S-z)+v[3]*(R-A)+S*R==z*A?null:(z+v[3]-_*R-_*w[3])/(z-S-_*R+_*A)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class Ml{constructor(t){this._globe=t,this._mercatorCameraHelper=new Io,this._verticalPerspectiveCameraHelper=new Tn}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,l){this.currentHelper.handleMapControlsPan(t,a,l)}cameraForBoxAndBearing(t,a,l,h,_){return this.currentHelper.cameraForBoxAndBearing(t,a,l,h,_)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const El=(m,t)=>d.B(m,t&&t.filter((a=>a.identifier!=="source.canvas"))),Al=d.bP();class Js extends d.E{constructor(t,a={}){var l,h;super(),this._rtlPluginLoaded=()=>{for(const v in this.tileManagers){const w=this.tileManagers[v].getSource().type;w!=="vector"&&w!=="geojson"||this.tileManagers[v].reload()}},this.map=t,this.dispatcher=new Jn(wi(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((v,w)=>this.getGlyphs(v,w))),this.dispatcher.registerMessageHandler("GI",((v,w)=>this.getImages(v,w))),this.dispatcher.registerMessageHandler("GDA",((v,w)=>this.getDashes(v,w))),this.imageManager=new Mi,this.imageManager.setEventedParent(this);const _=((l=t._container)===null||l===void 0?void 0:l.lang)||typeof document<"u"&&((h=document.documentElement)===null||h===void 0?void 0:h.lang)||void 0;this.glyphManager=new st(t._requestManager,a.localIdeographFontFamily,_),this.lineAtlas=new it(256,512),this.crossTileSymbolIndex=new Xn,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",d.bQ()),_e().on(se,this._rtlPluginLoaded),this.on("data",(v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const w=this.tileManagers[v.sourceId];if(!w)return;const S=w.getSource();if(S&&S.vectorLayerIds)for(const A in this._layers){const z=this._layers[A];z.source===S.id&&this._validateLayer(z)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new d.bR,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var l,h,_;this._checkLoaded();const v=a===null?(_=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[t])===null||h===void 0?void 0:h.default)!==null&&_!==void 0?_:null:a;if(d.bS(v,this._globalState[t]))return this;this._globalState[t]=v,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const l in t)!d.bS(this._globalState[l],t[l].default)&&(a.push(l),this._globalState[l]=t[l].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,l={};for(const h of t){l[h]=this._globalState[h];for(const _ in this._layers){const v=this._layers[_],w=v.getLayoutAffectingGlobalStateRefs(),S=v.getPaintAffectingGlobalStateRefs();if(w.has(h)&&a.add(v.source),S.has(h))for(const{name:A,value:z}of S.get(h))this._updatePaintProperty(v,A,z)}}this.dispatcher.broadcast("UGS",l);for(const h in this.tileManagers)a.has(h)&&(this._reloadSource(h),this._changed=!0)}loadURL(t,a={},l){this.fire(new d.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const h=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const _=this._loadStyleRequest;d.j(h,this._loadStyleRequest).then((v=>{this._loadStyleRequest=null,this._load(v.data,a,l)})).catch((v=>{this._loadStyleRequest=null,v&&!_.signal.aborted&&this.fire(new d.k(v))}))}loadJSON(t,a={},l){this.fire(new d.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,kt.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,l)})).catch((()=>{}))}loadEmpty(){this.fire(new d.l("dataloading",{dataType:"style"})),this._load(Al,{validate:!1})}_load(t,a,l){var h,_;let v=a.transformStyle?a.transformStyle(l,t):t;if(!a.validate||!El(this,d.C(v))){v=Object.assign({},v),this._loaded=!0,this.stylesheet=v;for(const w in v.sources)this.addSource(w,v.sources[w],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new tt(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new Ae(this.stylesheet.sky),this.map.setTerrain((_=this.stylesheet.terrain)!==null&&_!==void 0?_:null),this.fire(new d.l("data",{dataType:"style"})),this.fire(new d.l("style.load"))}}_createLayers(){var t,a,l;const h=d.bT(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",h),this._order=h.map((_=>_.id)),this._layers={},this._serializedLayers=null;for(const _ of h){const v=d.bU(_,this._globalState);if(v.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=v,d.bV(v)&&this.tileManagers[v.source]){const w=(l=(a=_.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&l!==void 0?l:v.paint.get("raster-fade-duration");this.tileManagers[v.source].setRasterFadeDuration(w)}}}_loadSprite(t,a=!1,l=void 0){this.imageManager.setLoaded(!1);const h=new AbortController;let _;this._spriteRequest=h,(function(v,w,S,A){return d._(this,void 0,void 0,(function*(){const z=Vi(v),R=S>1?"@2x":"",P={},F={};for(const{id:U,url:X}of z){const W=w.transformRequest(cn(X,R,".json"),"SpriteJSON");P[U]=d.j(W,A);const Y=w.transformRequest(cn(X,R,".png"),"SpriteImage");F[U]=bt.getImage(Y,A)}return yield Promise.all([...Object.values(P),...Object.values(F)]),(function(U,X){return d._(this,void 0,void 0,(function*(){const W={};for(const Y in U){W[Y]={};const Q=kt.getImageCanvasContext((yield X[Y]).data),ne=(yield U[Y]).data;for(const K in ne){const{width:ae,height:le,x:ee,y:de,sdf:Me,pixelRatio:be,stretchX:Ee,stretchY:Ce,content:He,textFitWidth:et,textFitHeight:qe}=ne[K];W[Y][K]={data:null,pixelRatio:be,sdf:Me,stretchX:Ee,stretchY:Ce,content:He,textFitWidth:et,textFitHeight:qe,spriteData:{width:ae,height:le,x:ee,y:de,context:Q}}}}return W}))})(P,F)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((v=>{if(this._spriteRequest=null,v)for(const w in v){this._spritesImagesIds[w]=[];const S=this._spritesImagesIds[w]?this._spritesImagesIds[w].filter((A=>!(A in v))):[];for(const A of S)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in v[w]){const z=w==="default"?A:`${w}:${A}`;this._spritesImagesIds[w].push(z),z in this.imageManager.images?this.imageManager.updateImage(z,v[w][A],!1):this.imageManager.addImage(z,v[w][A]),a&&(this._changedImages[z]=!0)}}})).catch((v=>{this._spriteRequest=null,_=v,h.signal.aborted||this.fire(new d.k(_))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"})),l&&l(_)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const l=t.sourceLayer;if(!l)return;const h=a.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const l=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?d.bW(l):l);const h=[];for(const _ of t)if(l[_]){const v=a?d.bW(l[_]):l[_];h.push(v)}return h}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const l of a){const h=this._layers[l];h.type!=="custom"&&(t[l]=h.serialize())}return t}hasTransitions(){var t,a,l;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.tileManagers)if(this.tileManagers[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const h=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(h.length||_.length)&&this._updateWorkerLayers(h,_);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const l={};for(const h in this.tileManagers){const _=this.tileManagers[h];l[h]=_.used,_.used=!1}for(const h of this._order){const _=this._layers[h];_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)&&_.source&&(this.tileManagers[_.source].used=!0)}for(const h in l){const _=this.tileManagers[h];!!l[h]!=!!_.used&&_.fire(new d.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new d.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var l;this._checkLoaded();const h=this.serialize();if(t=a.transformStyle?a.transformStyle(h,t):t,((l=a.validate)===null||l===void 0||l)&&El(this,d.C(t)))return!1;(t=d.bW(t)).layers=d.bT(t.layers);const _=d.bX(h,t),v=this._getOperationsToPerform(_);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],l=[];for(const h of t)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,h.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,h.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,h.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,h.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,h.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,h.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,h.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,h.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,h.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,h.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,h.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,h.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,h.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,h.args)));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,h.args)));break;case"setTransition":a.push((()=>{}));break;default:l.push(h.command)}return{operations:a,unimplemented:l}}addImage(t,a){if(this.getImage(t))return this.fire(new d.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new d.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,l={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(d.C.source,`sources.${t}`,a,null,l))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const h=this.tileManagers[t]=new Ui(t,a,this.dispatcher);h.style=this,h.setEventedParent(this,(()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:t}))),h.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===t)return this.fire(new d.k(new Error(`Source "${t}" cannot be removed while layer "${l}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new d.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const l=this.tileManagers[t].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,l={}){this._checkLoaded();const h=t.id;if(this.getLayer(h))return void this.fire(new d.k(new Error(`Layer "${h}" already exists on this map.`)));let _;if(t.type==="custom"){if(El(this,d.bY(t)))return;_=d.bU(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(h,t.source),t=d.bW(t),t=d.e(t,{source:h})),this._validate(d.C.layer,`layers.${h}`,t,{arrayIndex:-1},l))return;_=d.bU(t,this._globalState),this._validateLayer(_),_.setEventedParent(this,{layer:{id:h}})}const v=a?this._order.indexOf(a):this._order.length;if(a&&v===-1)this.fire(new d.k(new Error(`Cannot add layer "${h}" before non-existing layer "${a}".`)));else{if(this._order.splice(v,0,h),this._layerOrderChanged=!0,this._layers[h]=_,this._removedLayers[h]&&_.source&&_.type!=="custom"){const w=this._removedLayers[h];delete this._removedLayers[h],w.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.tileManagers[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new d.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const l=this._order.indexOf(t);this._order.splice(l,1);const h=a?this._order.indexOf(a):this._order.length;a&&h===-1?this.fire(new d.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(h,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new d.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const l=this._order.indexOf(t);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,l){this._checkLoaded();const h=this.getLayer(t);h?h.minzoom===a&&h.maxzoom===l||(a!=null&&(h.minzoom=a),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new d.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,l={}){this._checkLoaded();const h=this.getLayer(t);if(h){if(!d.bS(h.filter,a))return a==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(d.C.filter,`layers.${h.id}.filter`,a,null,l)||(h.setFilter(d.bW(a)),this._updateLayer(h)))}else this.fire(new d.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return d.bW(this.getLayer(t).filter)}setLayoutProperty(t,a,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?d.bS(_.getLayoutProperty(a),l)||(_.setLayoutProperty(a,l,h),this._updateLayer(_)):this.fire(new d.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const l=this.getLayer(t);if(l)return l.getLayoutProperty(a);this.fire(new d.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,l,h={}){this._checkLoaded();const _=this.getLayer(t);_?d.bS(_.getPaintProperty(a),l)||this._updatePaintProperty(_,a,l,h):this.fire(new d.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,l,h={}){t.setPaintProperty(a,l,h)&&this._updateLayer(t),d.bV(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(l),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const l=t.source,h=t.sourceLayer,_=this.tileManagers[l];if(_===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const v=_.getSource().type;v==="geojson"&&h?this.fire(new d.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||h?(t.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),_.setFeatureState(h,t.id,a)):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const l=t.source,h=this.tileManagers[l];if(h===void 0)return void this.fire(new d.k(new Error(`The source '${l}' does not exist in the map's style.`)));const _=h.getSource().type,v=_==="vector"?t.sourceLayer:void 0;_!=="vector"||v?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new d.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(v,t.id,a):this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,l=t.sourceLayer,h=this.tileManagers[a];if(h!==void 0)return h.getSource().type!=="vector"||l?(t.id===void 0&&this.fire(new d.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,t.id)):void this.fire(new d.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=d.bZ(this.tileManagers,(_=>_.serialize())),a=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return d.b_({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:t,layers:a,terrain:l},(_=>_!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=v=>this._layers[v].type==="fill-extrusion",l={},h=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(a(w)){l[w]=v;for(const S of t){const A=S[w];if(A)for(const z of A)h.push(z)}}}h.sort(((v,w)=>w.intersectionZ-v.intersectionZ));const _=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(a(w))for(let S=h.length-1;S>=0;S--){const A=h[S].feature;if(l[A.layer.id]<v)break;_.push(A),h.pop()}else for(const S of t){const A=S[w];if(A)for(const z of A)_.push(z.feature)}}return _}queryRenderedFeatures(t,a,l){a&&a.filter&&this._validate(d.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const h={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new d.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const A of a.layers){const z=this._layers[A];if(!z)return this.fire(new d.k(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];h[z.source]=!0}}const _=[];a.availableImages=this._availableImages;const v=this._serializedAllLayers(),w=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,S=Object.assign(Object.assign({},a),{layers:w,globalState:this._globalState});for(const A in this.tileManagers)a.layers&&!h[A]||_.push(fl(this.tileManagers[A],this._layers,v,t,S,l,this.map.terrain?(z,R,P)=>this.map.terrain.getElevation(z,R,P):void 0));return this.placement&&_.push((function(A,z,R,P,F,U,X){const W={},Y=U.queryRenderedSymbols(P),Q=[];for(const ne of Object.keys(Y).map(Number))Q.push(X[ne]);Q.sort(tn);for(const ne of Q){const K=ne.featureIndex.lookupSymbolFeatures(Y[ne.bucketInstanceId],z,ne.bucketIndex,ne.sourceLayerIndex,{filterSpec:F.filter,globalState:F.globalState},F.layers,F.availableImages,A);for(const ae in K){const le=W[ae]=W[ae]||[],ee=K[ae];ee.sort(((de,Me)=>{const be=ne.featureSortOrder;if(be){const Ee=be.indexOf(de.featureIndex);return be.indexOf(Me.featureIndex)-Ee}return Me.featureIndex-de.featureIndex}));for(const de of ee)le.push(de)}}return(function(ne,K,ae){for(const le in ne)for(const ee of ne[le])Or(ee,ae[K[le].source]);return ne})(W,A,R)})(this._layers,v,this.tileManagers,t,S,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,a){a?.filter&&this._validate(d.C.filter,"querySourceFeatures.filter",a.filter,null,a);const l=this.tileManagers[t];return l?(function(h,_){const v=h.getRenderableIds().map((A=>h.getTileByID(A))),w=[],S={};for(let A=0;A<v.length;A++){const z=v[A],R=z.tileID.canonical.key;S[R]||(S[R]=!0,z.querySourceFeatures(w,_))}return w})(l,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const v in t)if(!d.bS(t[v],l[v])){h=!0;break}if(!h)return;const _={now:xt(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(_)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!t&&!l)return;if(t&&!l)h=!0;else if(!t&&l)h=!0;else for(const v in t)if(!d.bS(t[v],l[v])){h=!0;break}if(!h)return;const _={now:xt(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(_)}_setProjectionInternal(t){const a=(function(l,h){const _={constrainOverride:h};if(Array.isArray(l)){const v=new fh({type:l});return{projection:v,transform:new Sl(_),cameraHelper:new Ml(v)}}switch(l){case"mercator":return{projection:new Yn,transform:new Bn(_),cameraHelper:new Io};case"globe":{const v=new fh({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:v,transform:new Sl(_),cameraHelper:new Ml(v)}}case"vertical-perspective":return{projection:new dh,transform:new Tl(_),cameraHelper:new Tn};default:return d.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new Yn,transform:new Bn(_),cameraHelper:new Io}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const l in this.tileManagers)this.tileManagers[l].reload()}_validate(t,a,l,h,_={}){return(!_||_.validate!==!1)&&El(this,t.call(d.C,d.e({key:a,style:this.serialize(),value:l,styleSpec:d.u},h)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),_e().off(se,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const l=this.tileManagers[a];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,l,h,_=!1){let v=!1,w=!1;const S={};for(const A of this._order){const z=this._layers[A];if(z.type!=="symbol")continue;if(!S[z.source]){const P=this.tileManagers[z.source];S[z.source]=P.getRenderableIds(!0).map((F=>P.getTileByID(F))).sort(((F,U)=>U.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(U.tileID)?-1:1)))}const R=this.crossTileSymbolIndex.addLayer(z,S[z.source],t.center.lng);v=v||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(xt(),t.zoom))&&(this.pauseablePlacement=new xl(t,this.map.terrain,this._order,_,a,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(xt()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const A of this._order){const z=this._layers[A];z.type==="symbol"&&this.placement.updateLayerOpacities(z,S[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(xt())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return d._(this,void 0,void 0,(function*(){const l=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const h=this.tileManagers[a.source];return h&&h.setDependencies(a.tileID.key,a.type,a.icons),l}))}getGlyphs(t,a){return d._(this,void 0,void 0,(function*(){const l=yield this.glyphManager.getGlyphs(a.stacks),h=this.tileManagers[a.source];return h&&h.setDependencies(a.tileID.key,a.type,[""]),l}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(d.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return d._(this,void 0,void 0,(function*(){const l={};for(const[h,_]of Object.entries(a.dashes))l[h]=this.lineAtlas.getDash(_.dasharray,_.round);return l}))}addSprite(t,a,l={},h){this._checkLoaded();const _=[{id:t,url:a}],v=[...Vi(this.stylesheet.sprite),..._];this._validate(d.C.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(_,!0,h))}removeSprite(t){this._checkLoaded();const a=Vi(this.stylesheet.sprite);if(a.find((l=>l.id===t))){if(this._spritesImagesIds[t])for(const l of this._spritesImagesIds[t])this.imageManager.removeImage(l),this._changedImages[l]=!0;a.splice(a.findIndex((l=>l.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.l("data",{dataType:"style"}))}else this.fire(new d.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Vi(this.stylesheet.sprite)}setSprite(t,a={},l){this._checkLoaded(),t&&this._validate(d.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,l):(this._unloadSprite(),l&&l(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Sd=d.aV([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class gu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,l,h,_,v,w,S,A){this.context=t;let z=this.boundPaintVertexBuffers.length!==h.length;for(let R=0;!z&&R<h.length;R++)this.boundPaintVertexBuffers[R]!==h[R]&&(z=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==_||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==A?this.freshBind(a,l,h,_,v,w,S,A):(t.bindVertexArray.set(this.vao),w&&w.bind(),_&&_.dynamicDraw&&_.bind(),S&&S.bind(),A&&A.bind())}freshBind(t,a,l,h,_,v,w,S){const A=t.numAttributes,z=this.context,R=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=S,a.enableAttributes(R,t);for(const P of l)P.enableAttributes(R,t);v&&v.enableAttributes(R,t),w&&w.enableAttributes(R,t),S&&S.enableAttributes(R,t),a.bind(),a.setVertexAttribPointers(R,t,_);for(const P of l)P.bind(),P.setVertexAttribPointers(R,t,_);v&&(v.bind(),v.setVertexAttribPointers(R,t,_)),h&&h.bind(),w&&(w.bind(),w.setVertexAttribPointers(R,t,_)),S&&(S.bind(),S.setVertexAttribPointers(R,t,_)),z.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Md=(m,t,a,l,h)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):d.bq.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:a?a.calculateFogBlendOpacity(l):0,u_horizon_color:a?a.properties.get("horizon-color"):d.bq.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Ra={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function uc(m){const t=[];for(let a=0;a<m.length;a++){if(m[a]===null)continue;const l=m[a].split(" ");t.push(l.pop())}return t}class Ed{constructor(t,a,l,h,_,v,w,S,A=[]){const z=t.gl;this.program=z.createProgram();const R=uc(a.staticAttributes),P=l?l.getBinderAttributes():[],F=R.concat(P),U=$i.prelude.staticUniforms?uc($i.prelude.staticUniforms):[],X=w.staticUniforms?uc(w.staticUniforms):[],W=a.staticUniforms?uc(a.staticUniforms):[],Y=l?l.getBinderUniforms():[],Q=U.concat(X).concat(W).concat(Y),ne=[];for(const be of Q)ne.indexOf(be)<0&&ne.push(be);const K=l?l.defines():[];ya(z)&&K.unshift("#version 300 es"),_&&K.push("#define OVERDRAW_INSPECTOR;"),v&&K.push("#define TERRAIN3D;"),S&&K.push(S),A&&K.push(...A);let ae=K.concat($i.prelude.fragmentSource,w.fragmentSource,a.fragmentSource).join(`
`),le=K.concat($i.prelude.vertexSource,w.vertexSource,a.vertexSource).join(`
`);ya(z)||(ae=(function(be){return be.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(ae),le=(function(be){return be.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(le));const ee=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(ee,ae),z.compileShader(ee),!z.getShaderParameter(ee,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(ee)}`);z.attachShader(this.program,ee);const de=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(de,le),z.compileShader(de),!z.getShaderParameter(de,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(de)}`);z.attachShader(this.program,de),this.attributes={};const Me={};this.numAttributes=F.length;for(let be=0;be<this.numAttributes;be++)F[be]&&(z.bindAttribLocation(this.program,be,F[be]),this.attributes[F[be]]=be);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(de),z.deleteShader(ee);for(let be=0;be<ne.length;be++){const Ee=ne[be];if(Ee&&!Me[Ee]){const Ce=z.getUniformLocation(this.program,Ee);Ce&&(Me[Ee]=Ce)}}this.fixedUniforms=h(t,Me),this.terrainUniforms=((be,Ee)=>({u_depth:new d.b$(be,Ee.u_depth),u_terrain:new d.b$(be,Ee.u_terrain),u_terrain_dim:new d.br(be,Ee.u_terrain_dim),u_terrain_matrix:new d.c1(be,Ee.u_terrain_matrix),u_terrain_unpack:new d.c2(be,Ee.u_terrain_unpack),u_terrain_exaggeration:new d.br(be,Ee.u_terrain_exaggeration)}))(t,Me),this.projectionUniforms=((be,Ee)=>({u_projection_matrix:new d.c1(be,Ee.u_projection_matrix),u_projection_tile_mercator_coords:new d.c2(be,Ee.u_projection_tile_mercator_coords),u_projection_clipping_plane:new d.c2(be,Ee.u_projection_clipping_plane),u_projection_transition:new d.br(be,Ee.u_projection_transition),u_projection_fallback_matrix:new d.c1(be,Ee.u_projection_fallback_matrix)}))(t,Me),this.binderUniforms=l?l.getUniforms(t,Me):[]}draw(t,a,l,h,_,v,w,S,A,z,R,P,F,U,X,W,Y,Q,ne){const K=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(l),t.setStencilMode(h),t.setColorMode(_),t.setCullFace(v),S){t.activeTexture.set(K.TEXTURE2),K.bindTexture(K.TEXTURE_2D,S.depthTexture),t.activeTexture.set(K.TEXTURE3),K.bindTexture(K.TEXTURE_2D,S.texture);for(const le in this.terrainUniforms)this.terrainUniforms[le].set(S[le])}if(A)for(const le in A)this.projectionUniforms[Ra[le]].set(A[le]);if(w)for(const le in this.fixedUniforms)this.fixedUniforms[le].set(w[le]);W&&W.setUniforms(t,this.binderUniforms,U,{zoom:X});let ae=0;switch(a){case K.LINES:ae=2;break;case K.TRIANGLES:ae=3;break;case K.LINE_STRIP:ae=1}for(const le of F.get()){const ee=le.vaos||(le.vaos={});(ee[z]||(ee[z]=new gu)).bind(t,this,R,W?W.getPaintVertexBuffers():[],P,le.vertexOffset,Y,Q,ne),K.drawElements(a,le.primitiveLength*ae,K.UNSIGNED_SHORT,le.primitiveOffset*ae*2)}}}function Ad(m,t,a){const l=1/d.aO(a,1,t.transform.tileZoom),h=Math.pow(2,a.tileID.overscaledZ),_=a.tileSize*Math.pow(2,t.transform.tileZoom)/h,v=_*(a.tileID.canonical.x+a.tileID.wrap*h),w=_*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[l,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const cc=(m,t,a,l)=>{const h=m.style.light,_=h.properties.get("position"),v=[_.x,_.y,_.z],w=d.c5();h.properties.get("anchor")==="viewport"&&d.c6(w,m.transform.bearingInRadians),d.c7(v,v,w);const S=m.transform.transformLightDirection(v),A=h.properties.get("color");return{u_lightpos:v,u_lightpos_globe:S,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:l}},hc=(m,t,a,l,h,_,v)=>d.e(cc(m,t,a,l),Ad(_,m,v),{u_height_factor:-Math.pow(2,h.overscaledZ)/v.tileSize/8}),Lo=(m,t,a,l)=>d.e(Ad(t,m,a),{u_fill_translate:l}),Cl=(m,t)=>({u_world:m,u_fill_translate:t}),Cd=(m,t,a,l,h)=>d.e(Lo(m,t,a,h),{u_world:l}),_u=(m,t,a,l,h)=>{const _=m.transform;let v,w,S=0;if(a.paint.get("circle-pitch-alignment")==="map"){const A=d.aO(t,1,_.zoom);v=!0,w=[A,A],S=A/(d.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*h}else v=!1,w=_.pixelsToGLUnits;return{u_camera_to_center_distance:_.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:S,u_translate:l}},eo=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),mh=m=>({u_viewport_size:[m.width,m.height]}),yu=(m,t=1)=>({u_color:m,u_overlay:0,u_overlay_scale:t}),to=(m,t,a,l)=>{const h=d.aO(m,1,t)/(d.a5*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:d.aO(m,1,t),u_intensity:a,u_globe_extrude_scale:h}},gh=(m,t,a,l)=>{const h=d.N();d.c8(h,0,m.width,m.height,0,0,1);const _=m.context.gl;return{u_matrix:h,u_world:[_.drawingBufferWidth,_.drawingBufferHeight],u_image:a,u_color_ramp:l,u_opacity:t.paint.get("heatmap-opacity")}},vu=(m,t,a)=>{const l=a.paint.get("hillshade-accent-color");let h;switch(a.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const _=a.getIlluminationProperties();for(let v=0;v<_.directionRadians.length;v++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(_.directionRadians[v]+=m.transform.bearingInRadians);return{u_image:0,u_latrange:Df(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:_.altitudeRadians,u_azimuths:_.directionRadians,u_accent:l,u_method:h,u_highlights:_.highlightColor,u_shadows:_.shadowColor}},zd=(m,t)=>{const a=t.stride,l=d.N();return d.c8(l,0,d.a5,-d.a5,0,0,1),d.O(l,l,[0,-d.a5,0]),{u_matrix:l,u_image:1,u_dimension:[a,a],u_zoom:m.overscaledZ,u_unpack:t.getUnpackVector()}};function Df(m,t){const a=Math.pow(2,t.canonical.z),l=t.canonical.y;return[new d.ab(0,l/a).toLngLat().lat,new d.ab(0,(l+1)/a).toLngLat().lat]}const Dd=(m,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:m.paint.get("color-relief-opacity")}),xu=(m,t,a,l)=>{const h=m.transform;return{u_translation:bu(m,t,a),u_ratio:l/d.aO(t,1,h.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Id=(m,t,a,l,h)=>d.e(xu(m,t,a,l),{u_image:0,u_image_height:h}),_h=(m,t,a,l,h)=>{const _=m.transform,v=va(t,_);return{u_translation:bu(m,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:l/d.aO(t,1,_.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Nr=(m,t,a,l,h)=>{const _=va(t,m.transform);return d.e(xu(m,t,a,l),{u_tileratio:_,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image:0,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})},io=(m,t,a,l,h,_)=>{const v=va(t,m.transform);return d.e(xu(m,t,a,l),{u_image:0,u_image_height:_,u_tileratio:v,u_crossfade_from:h.fromScale,u_crossfade_to:h.toScale,u_image_dash:1,u_mix:h.t,u_lineatlas_width:m.lineAtlas.width,u_lineatlas_height:m.lineAtlas.height})};function va(m,t){return 1/d.aO(m,1,t.tileZoom)}function bu(m,t,a){return d.aP(m.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const dc=(m,t,a,l,h)=>{return{u_tl_parent:m,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(v=l.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(_=l.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:fc(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var _,v};function fc(m){m*=Math.PI/180;const t=Math.sin(m),a=Math.cos(m);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const wu=(m,t,a,l,h,_,v,w,S,A,z,R,P)=>{const F=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:F.width/F.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:_,u_texsize:R,u_texture:0,u_translation:A,u_pitched_scale:P}},pc=(m,t,a,l,h,_,v,w,S,A,z,R,P,F)=>{const U=v.transform;return d.e(wu(m,t,a,l,h,_,v,w,S,A,z,R,F),{u_gamma_scale:l?Math.cos(U.pitch*Math.PI/180)*U.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},xa=(m,t,a,l,h,_,v,w,S,A,z,R,P)=>d.e(pc(m,t,a,l,h,_,v,w,S,A,!0,z,0,P),{u_texsize_icon:R,u_texture_icon:1}),Tu=(m,t)=>({u_opacity:m,u_color:t}),Su=(m,t,a,l,h)=>d.e((function(_,v,w,S){const A=w.imageManager.getPattern(_.from.toString()),z=w.imageManager.getPattern(_.to.toString()),{width:R,height:P}=w.imageManager.getPixelSize(),F=Math.pow(2,S.tileID.overscaledZ),U=S.tileSize*Math.pow(2,w.transform.tileZoom)/F,X=U*(S.tileID.canonical.x+S.tileID.wrap*F),W=U*S.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[R,P],u_mix:v.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/d.aO(S,1,w.transform.tileZoom),u_pixel_coord_upper:[X>>16,W>>16],u_pixel_coord_lower:[65535&X,65535&W]}})(a,h,t,l),{u_opacity:m}),mc=(m,t)=>{},Pd={fillExtrusion:(m,t)=>({u_lightpos:new d.c3(m,t.u_lightpos),u_lightpos_globe:new d.c3(m,t.u_lightpos_globe),u_lightintensity:new d.br(m,t.u_lightintensity),u_lightcolor:new d.c3(m,t.u_lightcolor),u_vertical_gradient:new d.br(m,t.u_vertical_gradient),u_opacity:new d.br(m,t.u_opacity),u_fill_translate:new d.c4(m,t.u_fill_translate)}),fillExtrusionPattern:(m,t)=>({u_lightpos:new d.c3(m,t.u_lightpos),u_lightpos_globe:new d.c3(m,t.u_lightpos_globe),u_lightintensity:new d.br(m,t.u_lightintensity),u_lightcolor:new d.c3(m,t.u_lightcolor),u_vertical_gradient:new d.br(m,t.u_vertical_gradient),u_height_factor:new d.br(m,t.u_height_factor),u_opacity:new d.br(m,t.u_opacity),u_fill_translate:new d.c4(m,t.u_fill_translate),u_image:new d.b$(m,t.u_image),u_texsize:new d.c4(m,t.u_texsize),u_pixel_coord_upper:new d.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c4(m,t.u_pixel_coord_lower),u_scale:new d.c3(m,t.u_scale),u_fade:new d.br(m,t.u_fade)}),fill:(m,t)=>({u_fill_translate:new d.c4(m,t.u_fill_translate)}),fillPattern:(m,t)=>({u_image:new d.b$(m,t.u_image),u_texsize:new d.c4(m,t.u_texsize),u_pixel_coord_upper:new d.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c4(m,t.u_pixel_coord_lower),u_scale:new d.c3(m,t.u_scale),u_fade:new d.br(m,t.u_fade),u_fill_translate:new d.c4(m,t.u_fill_translate)}),fillOutline:(m,t)=>({u_world:new d.c4(m,t.u_world),u_fill_translate:new d.c4(m,t.u_fill_translate)}),fillOutlinePattern:(m,t)=>({u_world:new d.c4(m,t.u_world),u_image:new d.b$(m,t.u_image),u_texsize:new d.c4(m,t.u_texsize),u_pixel_coord_upper:new d.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c4(m,t.u_pixel_coord_lower),u_scale:new d.c3(m,t.u_scale),u_fade:new d.br(m,t.u_fade),u_fill_translate:new d.c4(m,t.u_fill_translate)}),circle:(m,t)=>({u_camera_to_center_distance:new d.br(m,t.u_camera_to_center_distance),u_scale_with_map:new d.b$(m,t.u_scale_with_map),u_pitch_with_map:new d.b$(m,t.u_pitch_with_map),u_extrude_scale:new d.c4(m,t.u_extrude_scale),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_globe_extrude_scale:new d.br(m,t.u_globe_extrude_scale),u_translate:new d.c4(m,t.u_translate)}),collisionBox:(m,t)=>({u_pixel_extrude_scale:new d.c4(m,t.u_pixel_extrude_scale)}),collisionCircle:(m,t)=>({u_viewport_size:new d.c4(m,t.u_viewport_size)}),debug:(m,t)=>({u_color:new d.c0(m,t.u_color),u_overlay:new d.b$(m,t.u_overlay),u_overlay_scale:new d.br(m,t.u_overlay_scale)}),depth:mc,clippingMask:mc,heatmap:(m,t)=>({u_extrude_scale:new d.br(m,t.u_extrude_scale),u_intensity:new d.br(m,t.u_intensity),u_globe_extrude_scale:new d.br(m,t.u_globe_extrude_scale)}),heatmapTexture:(m,t)=>({u_matrix:new d.c1(m,t.u_matrix),u_world:new d.c4(m,t.u_world),u_image:new d.b$(m,t.u_image),u_color_ramp:new d.b$(m,t.u_color_ramp),u_opacity:new d.br(m,t.u_opacity)}),hillshade:(m,t)=>({u_image:new d.b$(m,t.u_image),u_latrange:new d.c4(m,t.u_latrange),u_exaggeration:new d.br(m,t.u_exaggeration),u_altitudes:new d.ca(m,t.u_altitudes),u_azimuths:new d.ca(m,t.u_azimuths),u_accent:new d.c0(m,t.u_accent),u_method:new d.b$(m,t.u_method),u_shadows:new d.c9(m,t.u_shadows),u_highlights:new d.c9(m,t.u_highlights)}),hillshadePrepare:(m,t)=>({u_matrix:new d.c1(m,t.u_matrix),u_image:new d.b$(m,t.u_image),u_dimension:new d.c4(m,t.u_dimension),u_zoom:new d.br(m,t.u_zoom),u_unpack:new d.c2(m,t.u_unpack)}),colorRelief:(m,t)=>({u_image:new d.b$(m,t.u_image),u_unpack:new d.c2(m,t.u_unpack),u_dimension:new d.c4(m,t.u_dimension),u_elevation_stops:new d.b$(m,t.u_elevation_stops),u_color_stops:new d.b$(m,t.u_color_stops),u_color_ramp_size:new d.b$(m,t.u_color_ramp_size),u_opacity:new d.br(m,t.u_opacity)}),line:(m,t)=>({u_translation:new d.c4(m,t.u_translation),u_ratio:new d.br(m,t.u_ratio),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c4(m,t.u_units_to_pixels)}),lineGradient:(m,t)=>({u_translation:new d.c4(m,t.u_translation),u_ratio:new d.br(m,t.u_ratio),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c4(m,t.u_units_to_pixels),u_image:new d.b$(m,t.u_image),u_image_height:new d.br(m,t.u_image_height)}),linePattern:(m,t)=>({u_translation:new d.c4(m,t.u_translation),u_texsize:new d.c4(m,t.u_texsize),u_ratio:new d.br(m,t.u_ratio),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_image:new d.b$(m,t.u_image),u_units_to_pixels:new d.c4(m,t.u_units_to_pixels),u_scale:new d.c3(m,t.u_scale),u_fade:new d.br(m,t.u_fade)}),lineSDF:(m,t)=>({u_translation:new d.c4(m,t.u_translation),u_ratio:new d.br(m,t.u_ratio),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c4(m,t.u_units_to_pixels),u_image:new d.b$(m,t.u_image),u_mix:new d.br(m,t.u_mix),u_tileratio:new d.br(m,t.u_tileratio),u_crossfade_from:new d.br(m,t.u_crossfade_from),u_crossfade_to:new d.br(m,t.u_crossfade_to),u_lineatlas_width:new d.br(m,t.u_lineatlas_width),u_lineatlas_height:new d.br(m,t.u_lineatlas_height)}),lineGradientSDF:(m,t)=>({u_translation:new d.c4(m,t.u_translation),u_ratio:new d.br(m,t.u_ratio),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_units_to_pixels:new d.c4(m,t.u_units_to_pixels),u_image:new d.b$(m,t.u_image),u_image_height:new d.br(m,t.u_image_height),u_tileratio:new d.br(m,t.u_tileratio),u_crossfade_from:new d.br(m,t.u_crossfade_from),u_crossfade_to:new d.br(m,t.u_crossfade_to),u_image_dash:new d.b$(m,t.u_image_dash),u_mix:new d.br(m,t.u_mix),u_lineatlas_width:new d.br(m,t.u_lineatlas_width),u_lineatlas_height:new d.br(m,t.u_lineatlas_height)}),raster:(m,t)=>({u_tl_parent:new d.c4(m,t.u_tl_parent),u_scale_parent:new d.br(m,t.u_scale_parent),u_buffer_scale:new d.br(m,t.u_buffer_scale),u_fade_t:new d.br(m,t.u_fade_t),u_opacity:new d.br(m,t.u_opacity),u_image0:new d.b$(m,t.u_image0),u_image1:new d.b$(m,t.u_image1),u_brightness_low:new d.br(m,t.u_brightness_low),u_brightness_high:new d.br(m,t.u_brightness_high),u_saturation_factor:new d.br(m,t.u_saturation_factor),u_contrast_factor:new d.br(m,t.u_contrast_factor),u_spin_weights:new d.c3(m,t.u_spin_weights),u_coords_top:new d.c2(m,t.u_coords_top),u_coords_bottom:new d.c2(m,t.u_coords_bottom)}),symbolIcon:(m,t)=>({u_is_size_zoom_constant:new d.b$(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.b$(m,t.u_is_size_feature_constant),u_size_t:new d.br(m,t.u_size_t),u_size:new d.br(m,t.u_size),u_camera_to_center_distance:new d.br(m,t.u_camera_to_center_distance),u_pitch:new d.br(m,t.u_pitch),u_rotate_symbol:new d.b$(m,t.u_rotate_symbol),u_aspect_ratio:new d.br(m,t.u_aspect_ratio),u_fade_change:new d.br(m,t.u_fade_change),u_label_plane_matrix:new d.c1(m,t.u_label_plane_matrix),u_coord_matrix:new d.c1(m,t.u_coord_matrix),u_is_text:new d.b$(m,t.u_is_text),u_pitch_with_map:new d.b$(m,t.u_pitch_with_map),u_is_along_line:new d.b$(m,t.u_is_along_line),u_is_variable_anchor:new d.b$(m,t.u_is_variable_anchor),u_texsize:new d.c4(m,t.u_texsize),u_texture:new d.b$(m,t.u_texture),u_translation:new d.c4(m,t.u_translation),u_pitched_scale:new d.br(m,t.u_pitched_scale)}),symbolSDF:(m,t)=>({u_is_size_zoom_constant:new d.b$(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.b$(m,t.u_is_size_feature_constant),u_size_t:new d.br(m,t.u_size_t),u_size:new d.br(m,t.u_size),u_camera_to_center_distance:new d.br(m,t.u_camera_to_center_distance),u_pitch:new d.br(m,t.u_pitch),u_rotate_symbol:new d.b$(m,t.u_rotate_symbol),u_aspect_ratio:new d.br(m,t.u_aspect_ratio),u_fade_change:new d.br(m,t.u_fade_change),u_label_plane_matrix:new d.c1(m,t.u_label_plane_matrix),u_coord_matrix:new d.c1(m,t.u_coord_matrix),u_is_text:new d.b$(m,t.u_is_text),u_pitch_with_map:new d.b$(m,t.u_pitch_with_map),u_is_along_line:new d.b$(m,t.u_is_along_line),u_is_variable_anchor:new d.b$(m,t.u_is_variable_anchor),u_texsize:new d.c4(m,t.u_texsize),u_texture:new d.b$(m,t.u_texture),u_gamma_scale:new d.br(m,t.u_gamma_scale),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_is_halo:new d.b$(m,t.u_is_halo),u_translation:new d.c4(m,t.u_translation),u_pitched_scale:new d.br(m,t.u_pitched_scale)}),symbolTextAndIcon:(m,t)=>({u_is_size_zoom_constant:new d.b$(m,t.u_is_size_zoom_constant),u_is_size_feature_constant:new d.b$(m,t.u_is_size_feature_constant),u_size_t:new d.br(m,t.u_size_t),u_size:new d.br(m,t.u_size),u_camera_to_center_distance:new d.br(m,t.u_camera_to_center_distance),u_pitch:new d.br(m,t.u_pitch),u_rotate_symbol:new d.b$(m,t.u_rotate_symbol),u_aspect_ratio:new d.br(m,t.u_aspect_ratio),u_fade_change:new d.br(m,t.u_fade_change),u_label_plane_matrix:new d.c1(m,t.u_label_plane_matrix),u_coord_matrix:new d.c1(m,t.u_coord_matrix),u_is_text:new d.b$(m,t.u_is_text),u_pitch_with_map:new d.b$(m,t.u_pitch_with_map),u_is_along_line:new d.b$(m,t.u_is_along_line),u_is_variable_anchor:new d.b$(m,t.u_is_variable_anchor),u_texsize:new d.c4(m,t.u_texsize),u_texsize_icon:new d.c4(m,t.u_texsize_icon),u_texture:new d.b$(m,t.u_texture),u_texture_icon:new d.b$(m,t.u_texture_icon),u_gamma_scale:new d.br(m,t.u_gamma_scale),u_device_pixel_ratio:new d.br(m,t.u_device_pixel_ratio),u_is_halo:new d.b$(m,t.u_is_halo),u_translation:new d.c4(m,t.u_translation),u_pitched_scale:new d.br(m,t.u_pitched_scale)}),background:(m,t)=>({u_opacity:new d.br(m,t.u_opacity),u_color:new d.c0(m,t.u_color)}),backgroundPattern:(m,t)=>({u_opacity:new d.br(m,t.u_opacity),u_image:new d.b$(m,t.u_image),u_pattern_tl_a:new d.c4(m,t.u_pattern_tl_a),u_pattern_br_a:new d.c4(m,t.u_pattern_br_a),u_pattern_tl_b:new d.c4(m,t.u_pattern_tl_b),u_pattern_br_b:new d.c4(m,t.u_pattern_br_b),u_texsize:new d.c4(m,t.u_texsize),u_mix:new d.br(m,t.u_mix),u_pattern_size_a:new d.c4(m,t.u_pattern_size_a),u_pattern_size_b:new d.c4(m,t.u_pattern_size_b),u_scale_a:new d.br(m,t.u_scale_a),u_scale_b:new d.br(m,t.u_scale_b),u_pixel_coord_upper:new d.c4(m,t.u_pixel_coord_upper),u_pixel_coord_lower:new d.c4(m,t.u_pixel_coord_lower),u_tile_units_to_pixels:new d.br(m,t.u_tile_units_to_pixels)}),terrain:(m,t)=>({u_texture:new d.b$(m,t.u_texture),u_ele_delta:new d.br(m,t.u_ele_delta),u_fog_matrix:new d.c1(m,t.u_fog_matrix),u_fog_color:new d.c0(m,t.u_fog_color),u_fog_ground_blend:new d.br(m,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.br(m,t.u_fog_ground_blend_opacity),u_horizon_color:new d.c0(m,t.u_horizon_color),u_horizon_fog_blend:new d.br(m,t.u_horizon_fog_blend),u_is_globe_mode:new d.br(m,t.u_is_globe_mode)}),terrainDepth:(m,t)=>({u_ele_delta:new d.br(m,t.u_ele_delta)}),terrainCoords:(m,t)=>({u_texture:new d.b$(m,t.u_texture),u_terrain_coords_id:new d.br(m,t.u_terrain_coords_id),u_ele_delta:new d.br(m,t.u_ele_delta)}),projectionErrorMeasurement:(m,t)=>({u_input:new d.br(m,t.u_input),u_output_expected:new d.br(m,t.u_output_expected)}),atmosphere:(m,t)=>({u_sun_pos:new d.c3(m,t.u_sun_pos),u_atmosphere_blend:new d.br(m,t.u_atmosphere_blend),u_globe_position:new d.c3(m,t.u_globe_position),u_globe_radius:new d.br(m,t.u_globe_radius),u_inv_proj_matrix:new d.c1(m,t.u_inv_proj_matrix)}),sky:(m,t)=>({u_sky_color:new d.c0(m,t.u_sky_color),u_horizon_color:new d.c0(m,t.u_horizon_color),u_horizon:new d.c4(m,t.u_horizon),u_horizon_normal:new d.c4(m,t.u_horizon_normal),u_sky_horizon_blend:new d.br(m,t.u_sky_horizon_blend),u_sky_blend:new d.br(m,t.u_sky_blend)})};class Bo{constructor(t,a,l){this.context=t;const h=t.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ko={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yh{constructor(t,a,l,h){this.length=a.length,this.attributes=l,this.itemSize=a.bytesPerElement,this.dynamicDraw=h,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let l=0;l<this.attributes.length;l++){const h=a.attributes[this.attributes[l].name];h!==void 0&&t.enableVertexAttribArray(h)}}setVertexAttribPointers(t,a,l){for(let h=0;h<this.attributes.length;h++){const _=this.attributes[h],v=a.attributes[_.name];v!==void 0&&t.vertexAttribPointer(v,_.components,t[ko[_.type]],!1,this.itemSize,_.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class mi{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class es extends mi{getDefault(){return d.bq.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Mu extends mi{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Eu extends mi{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class gc extends mi{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Oo extends mi{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Au extends mi{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class zl extends mi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ta extends mi{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class vh extends mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class _c extends mi{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class ia extends mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class ts extends mi{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Cr extends mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class bs extends mi{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Fo extends mi{getDefault(){return d.bq.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class No extends mi{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Cu extends mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class no extends mi{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ba extends mi{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class xh extends mi{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Dl extends mi{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Qt extends mi{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class yc extends mi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class na extends mi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class vc extends mi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ra extends mi{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rd extends mi{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class xc extends mi{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const l=this.gl;ya(l)?l.bindVertexArray(t):(a=l.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class ro extends mi{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class bh extends mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class bc extends mi{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ao extends mi{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class zu extends ao{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class zr extends ao{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class so extends ao{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const oo="Framebuffer is not complete";class jo{constructor(t,a,l,h,_){this.context=t,this.width=a,this.height=l;const v=t.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new zu(t,w),h)this.depthAttachment=_?new so(t,w):new zr(t,w);else if(_)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(oo)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}t.deleteFramebuffer(this.framebuffer)}}class lo{constructor(t){var a,l;if(this.gl=t,this.clearColor=new es(this),this.clearDepth=new Mu(this),this.clearStencil=new Eu(this),this.colorMask=new gc(this),this.depthMask=new Oo(this),this.stencilMask=new Au(this),this.stencilFunc=new zl(this),this.stencilOp=new ta(this),this.stencilTest=new vh(this),this.depthRange=new _c(this),this.depthTest=new ia(this),this.depthFunc=new ts(this),this.blend=new Cr(this),this.blendFunc=new bs(this),this.blendColor=new Fo(this),this.blendEquation=new No(this),this.cullFace=new Cu(this),this.cullFaceSide=new no(this),this.frontFace=new ba(this),this.program=new xh(this),this.activeTexture=new Dl(this),this.viewport=new Qt(this),this.bindFramebuffer=new yc(this),this.bindRenderbuffer=new na(this),this.bindTexture=new vc(this),this.bindVertexBuffer=new ra(this),this.bindElementBuffer=new Rd(this),this.bindVertexArray=new xc(this),this.pixelStoreUnpack=new ro(this),this.pixelStoreUnpackPremultiplyAlpha=new bh(this),this.pixelStoreUnpackFlipY=new bc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),ya(t)){this.HALF_FLOAT=t.HALF_FLOAT;const h=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:h?.RGBA16F_EXT,this.RGB16F=(l=t.RGB16F)!==null&&l!==void 0?l:h?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const h=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new Bo(this,t,a)}createVertexBuffer(t,a,l){return new yh(this,t,a,l)}createRenderbuffer(t,a,l){const h=this.gl,_=h.createRenderbuffer();return this.bindRenderbuffer.set(_),h.renderbufferStorage(h.RENDERBUFFER,t,a,l),this.bindRenderbuffer.set(null),_}createFramebuffer(t,a,l,h){return new jo(this,t,a,l,h)}clear({color:t,depth:a,stencil:l}){const h=this.gl;let _=0;t&&(_|=h.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(_|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),l!==void 0&&(_|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){d.bS(t.blendFunction,Ai.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return ya(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return ya(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let tr;function ir(m,t,a,l,h){const _=m.context,v=m.transform,w=_.gl,S=m.useProgram("collisionBox"),A=[];let z=0,R=0;for(let Y=0;Y<l.length;Y++){const Q=l[Y],ne=t.getTile(Q).getBucket(a);if(!ne)continue;const K=h?ne.textCollisionBox:ne.iconCollisionBox,ae=ne.collisionCircleArray;ae.length>0&&(A.push({circleArray:ae,circleOffset:R,coord:Q}),z+=ae.length/4,R=z),K&&S.draw(_,w.LINES,Zt.disabled,hi.disabled,m.colorModeForRenderPass(),Kt.disabled,eo(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q),v.getProjectionData({overscaledTileID:Q,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,null,m.transform.zoom,null,null,K.collisionVertexBuffer)}if(!h||!A.length)return;const P=m.useProgram("collisionCircle"),F=new d.cb;F.resize(4*z),F._trim();let U=0;for(const Y of A)for(let Q=0;Q<Y.circleArray.length/4;Q++){const ne=4*Q,K=Y.circleArray[ne+0],ae=Y.circleArray[ne+1],le=Y.circleArray[ne+2],ee=Y.circleArray[ne+3];F.emplace(U++,K,ae,le,ee,0),F.emplace(U++,K,ae,le,ee,1),F.emplace(U++,K,ae,le,ee,2),F.emplace(U++,K,ae,le,ee,3)}(!tr||tr.length<2*z)&&(tr=(function(Y){const Q=2*Y,ne=new d.cd;ne.resize(Q),ne._trim();for(let K=0;K<Q;K++){const ae=6*K;ne.uint16[ae+0]=4*K+0,ne.uint16[ae+1]=4*K+1,ne.uint16[ae+2]=4*K+2,ne.uint16[ae+3]=4*K+2,ne.uint16[ae+4]=4*K+3,ne.uint16[ae+5]=4*K+0}return ne})(z));const X=_.createIndexBuffer(tr,!0),W=_.createVertexBuffer(F,d.cc.members,!0);for(const Y of A){const Q=mh(m.transform);P.draw(_,w.TRIANGLES,Zt.disabled,hi.disabled,m.colorModeForRenderPass(),Kt.disabled,Q,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y.coord),null,a.id,W,X,d.aY.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,m.transform.zoom,null,null,null)}W.destroy(),X.destroy()}const is=d.as(new Float32Array(16));function ns(m,t,a,l,h,_){const{horizontalAlign:v,verticalAlign:w}=d.aT(m);return new d.P((-(v-.5)*t/h+l[0])*_,(-(w-.5)*a/h+l[1])*_)}function jr(m,t,a,l,h,_){const v=t.tileAnchorPoint.add(new d.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let w=l.mult(_);a||(w=w.rotate(-h));const S=v.add(w);return Gt(S.x,S.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const w=ci(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(m),S=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return m.add(l.rotate(S))}return m.add(l)}function ws(m,t,a,l,h,_,v,w,S,A,z,R){const P=m.text.placedSymbolArray,F=m.text.dynamicLayoutVertexArray,U=m.icon.dynamicLayoutVertexArray,X={};F.clear();for(let W=0;W<P.length;W++){const Y=P.get(W),Q=Y.hidden||!Y.crossTileID||m.allowVerticalPlacement&&!Y.placedOrientation?null:l[Y.crossTileID];if(Q){const ne=new d.P(Y.anchorX,Y.anchorY),K={getElevation:R,width:h.width,height:h.height,pitchedLabelPlaneMatrix:_,pitchWithMap:a,transform:h,tileAnchorPoint:ne,translation:A,unwrappedTileID:z},ae=a?_l(ne.x,ne.y,K):ci(ne.x,ne.y,K),le=Mo(h.cameraToCenterDistance,ae.signedDistanceFromCamera);let ee=d.aB(m.textSizeData,w,Y)*le/d.aN;a&&(ee*=m.tilePixelRatio/v);const{width:de,height:Me,anchor:be,textOffset:Ee,textBoxScale:Ce}=Q,He=ns(be,de,Me,Ee,Ce,ee),et=h.getPitchedTextCorrection(ne.x+A[0],ne.y+A[1],z),qe=jr(ae.point,K,t,He,-h.bearingInRadians,et),wt=m.allowVerticalPlacement&&Y.placedOrientation===d.aA.vertical?Math.PI/2:0;for(let Vt=0;Vt<Y.numGlyphs;Vt++)d.aH(F,qe,wt);S&&Y.associatedIconIndex>=0&&(X[Y.associatedIconIndex]={shiftedAnchor:qe,angle:wt})}else Qa(Y.numGlyphs,F)}if(S){U.clear();const W=m.icon.placedSymbolArray;for(let Y=0;Y<W.length;Y++){const Q=W.get(Y);if(Q.hidden)Qa(Q.numGlyphs,U);else{const ne=X[Y];if(ne)for(let K=0;K<Q.numGlyphs;K++)d.aH(U,ne.shiftedAnchor,ne.angle);else Qa(Q.numGlyphs,U)}}m.icon.dynamicLayoutVertexBuffer.updateData(U)}m.text.dynamicLayoutVertexBuffer.updateData(F)}function wh(m,t,a){return a.iconsInText&&t?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Vo(m,t,a,l,h,_,v,w,S,A,z,R,P){const F=m.context,U=F.gl,X=m.transform,W=w==="map",Y=S==="map",Q=w!=="viewport"&&a.layout.get("symbol-placement")!=="point",ne=W&&!Y&&!Q,K=!a.layout.get("symbol-sort-key").isConstant();let ae=!1;const le=m.getDepthModeForSublayer(0,Zt.ReadOnly),ee=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),de=[],Me=X.getCircleRadiusCorrection();for(const be of l){const Ee=t.getTile(be),Ce=Ee.getBucket(a);if(!Ce)continue;const He=h?Ce.text:Ce.icon;if(!He||!He.segments.get().length||!He.hasVisibleVertices)continue;const et=He.programConfigurations.get(a.id),qe=h||Ce.sdfIcons,wt=h?Ce.textSizeData:Ce.iconSizeData,Vt=Y||X.pitch!==0,_i=m.useProgram(wh(qe,h,Ce),et),Fi=d.az(wt,X.zoom),xi=m.style.map.terrain&&m.style.map.terrain.getTerrainData(be);let Zi,Ci,kn,Gi,On=[0,0],on=null;if(h)Ci=Ee.glyphAtlasTexture,kn=U.LINEAR,Zi=Ee.glyphAtlasTexture.size,Ce.iconsInText&&(On=Ee.imageAtlasTexture.size,on=Ee.imageAtlasTexture,Gi=Vt||m.options.rotating||m.options.zooming||wt.kind==="composite"||wt.kind==="camera"?U.LINEAR:U.NEAREST);else{const ln=a.layout.get("icon-size").constantOr(0)!==1||Ce.iconsNeedLinear;Ci=Ee.imageAtlasTexture,kn=qe||m.options.rotating||m.options.zooming||ln||Vt?U.LINEAR:U.NEAREST,Zi=Ee.imageAtlasTexture.size}const _n=d.aO(Ee,1,m.transform.zoom),ar=Kr(W,m.transform,_n),dr=d.N();d.aC(dr,ar);const Fa=rc(Y,W,m.transform,_n),ks=d.aP(X,Ee,_,v),Xo=X.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),Ic=ee&&Ce.hasTextData(),Yo=a.layout.get("icon-text-fit")!=="none"&&Ic&&Ce.hasIconData();if(Q){const ln=m.style.map.terrain?(Lr,Qi)=>m.style.map.terrain.getElevation(be,Lr,Qi):null,Nn=a.layout.get("text-rotation-alignment")==="map";ys(Ce,m,h,ar,dr,Y,A,Nn,be.toUnwrapped(),X.width,X.height,ks,ln)}const qr=h&&ee||Yo,Fn=Q||qr?is:Y?ar:m.transform.clipSpaceToPixelsMatrix,Wn=qe&&a.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let sr;sr=qe?Ce.iconsInText?xa(wt.kind,Fi,ne,Y,Q,qr,m,Fn,Fa,ks,Zi,On,Me):pc(wt.kind,Fi,ne,Y,Q,qr,m,Fn,Fa,ks,h,Zi,0,Me):wu(wt.kind,Fi,ne,Y,Q,qr,m,Fn,Fa,ks,h,Zi,Me);const ua={program:_i,buffers:He,uniformValues:sr,projectionData:Xo,atlasTexture:Ci,atlasTextureIcon:on,atlasInterpolation:kn,atlasInterpolationIcon:Gi,isSDF:qe,hasHalo:Wn};if(K&&Ce.canOverlap){ae=!0;const ln=He.segments.get();for(const Nn of ln)de.push({segments:new d.aY([Nn]),sortKey:Nn.sortKey,state:ua,terrainData:xi})}else de.push({segments:He.segments,sortKey:0,state:ua,terrainData:xi})}ae&&de.sort(((be,Ee)=>be.sortKey-Ee.sortKey));for(const be of de){const Ee=be.state;if(F.activeTexture.set(U.TEXTURE0),Ee.atlasTexture.bind(Ee.atlasInterpolation,U.CLAMP_TO_EDGE),Ee.atlasTextureIcon&&(F.activeTexture.set(U.TEXTURE1),Ee.atlasTextureIcon&&Ee.atlasTextureIcon.bind(Ee.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Ee.isSDF){const Ce=Ee.uniformValues;Ee.hasHalo&&(Ce.u_is_halo=1,Il(Ee.buffers,be.segments,a,m,Ee.program,le,z,R,Ce,Ee.projectionData,be.terrainData)),Ce.u_is_halo=0}Il(Ee.buffers,be.segments,a,m,Ee.program,le,z,R,Ee.uniformValues,Ee.projectionData,be.terrainData)}}function Il(m,t,a,l,h,_,v,w,S,A,z){const R=l.context;h.draw(R,R.gl.TRIANGLES,_,v,w,Kt.backCCW,S,z,A,a.id,m.layoutVertexBuffer,m.indexBuffer,t,a.paint,l.transform.zoom,m.programConfigurations.get(a.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Th(m,t,a,l,h){const _=m.context,v=_.gl,w=hi.disabled,S=new Ai([v.ONE,v.ONE],d.bq.transparent,[!0,!0,!0,!0]),A=t.getBucket(a);if(!A)return;const z=l.key;let R=a.heatmapFbos.get(z);R||(R=ki(_,t.tileSize,t.tileSize),a.heatmapFbos.set(z,R)),_.bindFramebuffer.set(R.framebuffer),_.viewport.set([0,0,t.tileSize,t.tileSize]),_.clear({color:d.bq.transparent});const P=A.programConfigurations.get(a.id),F=m.useProgram("heatmap",P,!h),U=m.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),X=m.style.map.terrain.getTerrainData(l);F.draw(_,v.TRIANGLES,Zt.disabled,w,S,Kt.disabled,to(t,m.transform.zoom,a.paint.get("heatmap-intensity"),1),X,U,a.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,a.paint,m.transform.zoom,P)}function nr(m,t,a,l,h){const _=m.context,v=_.gl,w=m.transform;_.setColorMode(m.colorModeForRenderPass());const S=ri(_,t),A=a.key,z=t.heatmapFbos.get(A);if(!z)return;_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,z.colorAttachment.get()),_.activeTexture.set(v.TEXTURE1),S.bind(v.LINEAR,v.CLAMP_TO_EDGE);const R=w.getProjectionData({overscaledTileID:a,applyTerrainMatrix:h,applyGlobeMatrix:!l});m.useProgram("heatmapTexture").draw(_,v.TRIANGLES,Zt.disabled,hi.disabled,m.colorModeForRenderPass(),Kt.disabled,gh(m,t,0,1),null,R,t.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,t.paint,w.zoom),z.destroy(),t.heatmapFbos.delete(A)}function ki(m,t,a){var l,h;const _=m.gl,v=_.createTexture();_.bindTexture(_.TEXTURE_2D,v),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,_.CLAMP_TO_EDGE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,_.LINEAR),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,_.LINEAR);const w=(l=m.HALF_FLOAT)!==null&&l!==void 0?l:_.UNSIGNED_BYTE,S=(h=m.RGBA16F)!==null&&h!==void 0?h:_.RGBA;_.texImage2D(_.TEXTURE_2D,0,S,t,a,0,_.RGBA,w,null);const A=m.createFramebuffer(t,a,!1,!1);return A.colorAttachment.set(v),A}function ri(m,t){return t.colorRampTexture||(t.colorRampTexture=new d.T(m,t.colorRamp,m.gl.RGBA)),t.colorRampTexture}function Ts(m,t,a,l,h,_,v,w){let S=256;if(h.stepInterpolant){const A=t.getSource().maxzoom,z=v.canonical.z===A?Math.ceil(1<<m.transform.maxZoom-v.canonical.z):1;S=d.ao(d.cf(_.maxLineLength/d.a5*1024*z),256,a.maxTextureSize)}return w.gradient=d.cg({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:S,image:w.gradient||void 0,clips:_.lineClipsArray}),w.texture?w.texture.update(w.gradient):w.texture=new d.T(a,w.gradient,l.RGBA),w.version=h.gradientVersion,w.texture}function aa(m,t,a,l,h){m.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),l.updatePaintBuffers(h)}function nn(m,t,a,l,h,_){(h||m.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),m.lineAtlas.bind(t)),l.updatePaintBuffers(_)}function Vr(m,t,a,l,h,_,v){const w=_.gradients[h.id];let S=w.texture;h.gradientVersion!==w.version&&(S=Ts(m,t,a,l,h,_,v,w)),a.activeTexture.set(l.TEXTURE0),S.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE)}function sa(m,t,a,l,h,_,v,w,S){const A=_.gradients[h.id];let z=A.texture;h.gradientVersion!==A.version&&(z=Ts(m,t,a,l,h,_,v,A)),a.activeTexture.set(l.TEXTURE0),z.bind(h.stepInterpolant?l.NEAREST:l.LINEAR,l.CLAMP_TO_EDGE),a.activeTexture.set(l.TEXTURE1),m.lineAtlas.bind(a),w.updatePaintBuffers(S)}function Du(m,t,a,l,h){if(!a||!l||!l.imageAtlas)return;const _=l.imageAtlas.patternPositions;let v=_[a.to.toString()],w=_[a.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const S=h.getPaintProperty(t);v=_[S],w=_[S]}v&&w&&m.setConstantPatternPositions(v,w)}function rs(m,t,a,l,h,_,v,w){const S=m.context.gl,A="fill-pattern",z=a.paint.get(A),R=z&&z.constantOr(1),P=a.getCrossfadeParameters();let F,U,X,W,Y;const Q=m.transform,ne=a.paint.get("fill-translate"),K=a.paint.get("fill-translate-anchor");v?(U=R&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=S.LINES):(U=R?"fillPattern":"fill",F=S.TRIANGLES);const ae=z.constantOr(null);for(const le of l){const ee=t.getTile(le);if(R&&!ee.patternsLoaded())continue;const de=ee.getBucket(a);if(!de)continue;const Me=de.programConfigurations.get(a.id),be=m.useProgram(U,Me),Ee=m.style.map.terrain&&m.style.map.terrain.getTerrainData(le);R&&(m.context.activeTexture.set(S.TEXTURE0),ee.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),Me.updatePaintBuffers(P)),Du(Me,A,ae,ee,a);const Ce=Q.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),He=d.aP(Q,ee,ne,K);if(v){W=de.indexBuffer2,Y=de.segments2;const qe=[S.drawingBufferWidth,S.drawingBufferHeight];X=U==="fillOutlinePattern"&&R?Cd(m,P,ee,qe,He):Cl(qe,He)}else W=de.indexBuffer,Y=de.segments,X=R?Lo(m,P,ee,He):{u_fill_translate:He};const et=m.stencilModeForClipping(le);be.draw(m.context,F,h,et,_,Kt.backCCW,X,Ee,Ce,a.id,de.layoutVertexBuffer,W,Y,a.paint,m.transform.zoom,Me)}}function as(m,t,a,l,h,_,v,w){const S=m.context,A=S.gl,z="fill-extrusion-pattern",R=a.paint.get(z),P=R.constantOr(1),F=a.getCrossfadeParameters(),U=a.paint.get("fill-extrusion-opacity"),X=R.constantOr(null),W=m.transform;for(const Y of l){const Q=t.getTile(Y),ne=Q.getBucket(a);if(!ne)continue;const K=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Y),ae=ne.programConfigurations.get(a.id),le=m.useProgram(P?"fillExtrusionPattern":"fillExtrusion",ae);P&&(m.context.activeTexture.set(A.TEXTURE0),Q.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ae.updatePaintBuffers(F));const ee=W.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!w,applyTerrainMatrix:!0});Du(ae,z,X,Q,a);const de=d.aP(W,Q,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Me=a.paint.get("fill-extrusion-vertical-gradient"),be=P?hc(m,Me,U,de,Y,F,Q):cc(m,Me,U,de);le.draw(S,S.gl.TRIANGLES,h,_,v,Kt.backCCW,be,K,ee,a.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,a.paint,m.transform.zoom,ae,m.style.map.terrain&&ne.centroidVertexBuffer)}}function ss(m,t,a,l,h,_,v,w,S){var A;const z=m.style.projection,R=m.context,P=m.transform,F=R.gl,U=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],X=m.useProgram("hillshade",null,!1,U),W=!m.options.moving;for(const Y of l){const Q=t.getTile(Y),ne=Q.fbo;if(!ne)continue;const K=z.getMeshFromTileID(R,Y.canonical,w,!0,"raster"),ae=(A=m.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(Y);R.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,ne.colorAttachment.get());const le=P.getProjectionData({overscaledTileID:Y,aligned:W,applyGlobeMatrix:!S,applyTerrainMatrix:!0});X.draw(R,F.TRIANGLES,_,h[Y.overscaledZ],v,Kt.backCCW,vu(m,Q,a),ae,le,a.id,K.vertexBuffer,K.indexBuffer,K.segments)}}function Ss(m,t,a,l,h,_,v,w,S){var A;const z=m.style.projection,R=m.context,P=m.transform,F=R.gl,U=m.useProgram("colorRelief"),X=!m.options.moving;let W=!0,Y=0;for(const Q of l){const ne=t.getTile(Q),K=ne.dem;if(W){const be=F.getParameter(F.MAX_TEXTURE_SIZE),{elevationTexture:Ee,colorTexture:Ce}=a.getColorRampTextures(R,be,K.getUnpackVector());R.activeTexture.set(F.TEXTURE1),Ee.bind(F.NEAREST,F.CLAMP_TO_EDGE),R.activeTexture.set(F.TEXTURE4),Ce.bind(F.LINEAR,F.CLAMP_TO_EDGE),W=!1,Y=Ee.size[0]}if(!K||!K.data)continue;const ae=K.stride,le=K.getPixels();if(R.activeTexture.set(F.TEXTURE0),R.pixelStoreUnpackPremultiplyAlpha.set(!1),ne.demTexture=ne.demTexture||m.getTileTexture(ae),ne.demTexture){const be=ne.demTexture;be.update(le,{premultiply:!1}),be.bind(F.LINEAR,F.CLAMP_TO_EDGE)}else ne.demTexture=new d.T(R,le,F.RGBA,{premultiply:!1}),ne.demTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const ee=z.getMeshFromTileID(R,Q.canonical,w,!0,"raster"),de=(A=m.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(Q),Me=P.getProjectionData({overscaledTileID:Q,aligned:X,applyGlobeMatrix:!S,applyTerrainMatrix:!0});U.draw(R,F.TRIANGLES,_,h[Q.overscaledZ],v,Kt.backCCW,Dd(a,ne.dem,Y),de,Me,a.id,ee.vertexBuffer,ee.indexBuffer,ee.segments)}}const Ms=[new d.P(0,0),new d.P(d.a5,0),new d.P(d.a5,d.a5),new d.P(0,d.a5)];function wa(m,t,a,l,h,_,v,w,S=!1,A=!1){const z=l[l.length-1].overscaledZ,R=m.context,P=R.gl,F=m.useProgram("raster"),U=m.transform,X=m.style.projection,W=m.colorModeForRenderPass(),Y=!m.options.moving,Q=a.paint.get("raster-opacity"),ne=a.paint.get("raster-resampling"),K=a.paint.get("raster-fade-duration"),ae=!!m.style.map.terrain;for(const le of l){const ee=m.getDepthModeForSublayer(le.overscaledZ-z,Q===1?Zt.ReadWrite:Zt.ReadOnly,P.LESS),de=t.getTile(le),Me=ne==="nearest"?P.NEAREST:P.LINEAR;R.activeTexture.set(P.TEXTURE0),de.texture.bind(Me,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(P.TEXTURE1);const{parentTile:be,parentScaleBy:Ee,parentTopLeft:Ce,fadeValues:He}=os(de,t,K,ae);de.fadeOpacity=He.tileOpacity,be?(be.fadeOpacity=He.parentTileOpacity,be.texture.bind(Me,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST)):de.texture.bind(Me,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),de.texture.useMipmap&&R.extTextureFilterAnisotropic&&m.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const et=m.style.map.terrain&&m.style.map.terrain.getTerrainData(le),qe=U.getProjectionData({overscaledTileID:le,aligned:Y,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),wt=dc(Ce,Ee,He.fadeMix,a,w),Vt=X.getMeshFromTileID(R,le.canonical,_,v,"raster");F.draw(R,P.TRIANGLES,ee,h?h[le.overscaledZ]:hi.disabled,W,S?Kt.frontCCW:Kt.backCCW,wt,et,qe,a.id,Vt.vertexBuffer,Vt.indexBuffer,Vt.segments)}}function os(m,t,a,l){const h={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||l)return h;if(m.fadingParentID){const _=t.getLoadedTile(m.fadingParentID);if(!_)return h;const v=Math.pow(2,_.tileID.overscaledZ-m.tileID.overscaledZ),w=[m.tileID.canonical.x*v%1,m.tileID.canonical.y*v%1],S=(function(A,z,R){const P=xt(),F=(P-z.timeAdded)/R,U=A.fadingDirection===Se.Incoming,X=d.ao((P-A.timeAdded)/R,0,1),W=d.ao(1-F,0,1),Y=U?X:W;return{tileOpacity:Y,parentTileOpacity:U?W:X,fadeMix:{opacity:1,mix:1-Y}}})(m,_,a);return{parentTile:_,parentScaleBy:v,parentTopLeft:w,fadeValues:S}}if(m.selfFading){const _=(function(v,w){const S=(xt()-v.timeAdded)/w,A=d.ao(S,0,1);return{tileOpacity:A,fadeMix:{opacity:A,mix:0}}})(m,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:_}}return h}const Es=new d.bq(1,0,0,1),ls=new d.bq(0,1,0,1),wc=new d.bq(0,0,1,1),Tc=new d.bq(1,0,1,1),Ta=new d.bq(0,1,1,1);function Pl(m,t,a,l){In(m,0,t+a/2,m.transform.width,a,l)}function As(m,t,a,l){In(m,t-a/2,0,a,m.transform.height,l)}function In(m,t,a,l,h,_){const v=m.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*m.pixelRatio,a*m.pixelRatio,l*m.pixelRatio,h*m.pixelRatio),v.clear({color:_}),w.disable(w.SCISSOR_TEST)}function Iu(m,t,a){const l=m.context,h=l.gl,_=m.useProgram("debug"),v=Zt.disabled,w=hi.disabled,S=m.colorModeForRenderPass(),A="$debug",z=m.style.map.terrain&&m.style.map.terrain.getTerrainData(a);l.activeTexture.set(h.TEXTURE0);const R=t.getTileByID(a.key).latestRawTileData,P=Math.floor((R&&R.byteLength||0)/1024),F=t.getTile(a).tileSize,U=512/Math.min(F,512)*(a.overscaledZ/m.transform.zoom)*.5;let X=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(X+=` => ${a.overscaledZ}`),(function(Y,Q){Y.initDebugOverlayCanvas();const ne=Y.debugOverlayCanvas,K=Y.context.gl,ae=Y.debugOverlayCanvas.getContext("2d");ae.clearRect(0,0,ne.width,ne.height),ae.shadowColor="white",ae.shadowBlur=2,ae.lineWidth=1.5,ae.strokeStyle="white",ae.textBaseline="top",ae.font="bold 36px Open Sans, sans-serif",ae.fillText(Q,5,5),ae.strokeText(Q,5,5),Y.debugOverlayTexture.update(ne),Y.debugOverlayTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE)})(m,`${X} ${P}kB`);const W=m.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(l,h.TRIANGLES,v,w,Ai.alphaBlended,Kt.disabled,yu(d.bq.transparent,U),null,W,A,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),_.draw(l,h.LINE_STRIP,v,w,S,Kt.disabled,yu(d.bq.red),z,W,A,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function Sc(m,t,a,l){const{isRenderingGlobe:h}=l,_=m.context,v=_.gl,w=m.transform,S=m.colorModeForRenderPass(),A=m.getDepthModeFor3D(),z=m.useProgram("terrain");_.bindFramebuffer.set(null),_.viewport.set([0,0,m.width,m.height]);for(const R of a){const P=t.getTerrainMesh(R.tileID),F=m.renderToTexture.getTexture(R),U=t.getTerrainData(R.tileID);_.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,F.texture);const X=t.getMeshFrameDelta(w.zoom),W=w.calculateFogMatrix(R.tileID.toUnwrapped()),Y=Md(X,W,m.style.sky,w.pitch,h),Q=w.getProjectionData({overscaledTileID:R.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(_,v.TRIANGLES,A,hi.disabled,S,Kt.backCCW,Y,U,Q,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}}function Sh(m,t){if(!t.mesh){const a=new d.aX;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const l=new d.aZ;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),t.mesh=new Bi(m.createVertexBuffer(a,_a.members),m.createIndexBuffer(l),d.aY.simpleSegment(0,0,a.length,l.length))}return t.mesh}class Ld{constructor(t,a){this.context=new lo(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.as(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ui.maxOverzooming+Ui.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Xn}resize(t,a,l){if(this.width=Math.floor(t*l),this.height=Math.floor(a*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const t=this.context,a=new d.aX;a.emplaceBack(0,0),a.emplaceBack(d.a5,0),a.emplaceBack(0,d.a5),a.emplaceBack(d.a5,d.a5),this.tileExtentBuffer=t.createVertexBuffer(a,_a.members),this.tileExtentSegments=d.aY.simpleSegment(0,0,4,2);const l=new d.aX;l.emplaceBack(0,0),l.emplaceBack(d.a5,0),l.emplaceBack(0,d.a5),l.emplaceBack(d.a5,d.a5),this.debugBuffer=t.createVertexBuffer(l,_a.members),this.debugSegments=d.aY.simpleSegment(0,0,4,5);const h=new d.ci;h.emplaceBack(0,0,0,0),h.emplaceBack(d.a5,0,d.a5,0),h.emplaceBack(0,d.a5,0,d.a5),h.emplaceBack(d.a5,d.a5,d.a5,d.a5),this.rasterBoundsBuffer=t.createVertexBuffer(h,Sd.members),this.rasterBoundsSegments=d.aY.simpleSegment(0,0,4,2);const _=new d.aX;_.emplaceBack(0,0),_.emplaceBack(d.a5,0),_.emplaceBack(0,d.a5),_.emplaceBack(d.a5,d.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(_,_a.members),this.rasterBoundsSegmentsPosOnly=d.aY.simpleSegment(0,0,4,5);const v=new d.aX;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(v,_a.members),this.viewportSegments=d.aY.simpleSegment(0,0,4,2);const w=new d.cj;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(w);const S=new d.aZ;S.emplaceBack(1,0,2),S.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const A=this.context.gl;this.stencilClearMode=new hi({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.tileExtentMesh=new Bi(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.N();d.c8(l,0,this.width,this.height,0,0,1),d.Q(l,l,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,Zt.disabled,this.stencilClearMode,Ai.disabled,Kt.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,l){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const h=this.context;h.setColorMode(Ai.disabled),h.setDepthMode(Zt.disabled);const _={};for(const v of a)_[v.key]=this.nextStencilID++;this._renderTileMasks(_,a,l,!0),this._renderTileMasks(_,a,l,!1),this._tileClippingMaskIDs=_}_renderTileMasks(t,a,l,h){const _=this.context,v=_.gl,w=this.style.projection,S=this.transform,A=this.useProgram("clippingMask");for(const z of a){const R=t[z.key],P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),F=w.getMeshFromTileID(this.context,z.canonical,h,!0,"stencil"),U=S.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!l,applyTerrainMatrix:!0});A.draw(_,v.TRIANGLES,Zt.disabled,new hi({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),Ai.disabled,l?Kt.disabled:Kt.backCCW,null,P,U,"$clipping",F.vertexBuffer,F.indexBuffer,F.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,l=this.style.projection,h=this.transform,_=this.useProgram("depth"),v=this.getDepthModeFor3D(),w=wn(h,{tileSize:h.tileSize});for(const S of w){const A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S),z=l.getMeshFromTileID(this.context,S.canonical,!0,!0,"raster"),R=h.getProjectionData({overscaledTileID:S,applyGlobeMatrix:!0,applyTerrainMatrix:!0});_.draw(t,a.TRIANGLES,v,hi.disabled,Ai.disabled,Kt.backCCW,null,A,R,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new hi({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new hi({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,l=t.sort(((v,w)=>w.overscaledZ-v.overscaledZ)),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let w=0;w<_;w++)v[w+h]=new hi({func:a.GEQUAL,mask:255},w+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=_,[v,l]}return[{[h]:hi.disabled},l]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,l=t.sort(((v,w)=>w.overscaledZ-v.overscaledZ)),h=l[l.length-1].overscaledZ,_=l[0].overscaledZ-h+1;if(this.clearStencil(),_>1){const v={},w={};for(let S=0;S<_;S++)v[S+h]=new hi({func:a.GREATER,mask:255},_+1+S,255,a.KEEP,a.KEEP,a.REPLACE),w[S+h]=new hi({func:a.GREATER,mask:255},1+S,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*_+1,[v,w,l]}return this.nextStencilID=3,[{[h]:new hi({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[h]:new hi({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},l]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ai([t.CONSTANT_COLOR,t.ONE],new d.bq(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ai.unblended:Ai.alphaBlended}getDepthModeForSublayer(t,a,l){if(!this.opaquePassEnabledForLayer())return Zt.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Zt(l||this.context.gl.LEQUAL,a,[h,h])}getDepthModeFor3D(){return new Zt(this.context.gl.LEQUAL,Zt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var l,h;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(xt()),this.imageManager.beginFrame();const _=this.style._order,v=this.style.tileManagers,w={},S={},A={},z={isRenderingToTexture:!1,isRenderingGlobe:((l=t.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const P in v){const F=v[P];F.used&&F.prepare(this.context),w[P]=F.getVisibleCoordinates(!1),S[P]=w[P].slice().reverse(),A[P]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<_.length;P++)if(this.style._layers[_[P]].is3D()){this.opaquePassCutoff=P;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const P of _){const F=this.style._layers[P];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const U=S[F.source];(F.type==="custom"||U.length)&&this.renderLayer(this,v[F.source],F,U,z)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:P=>this.useProgram(P)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?d.bq.black:d.bq.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(P,F){const U=P.context,X=U.gl,W=((le,ee,de)=>{const Me=Math.cos(ee.rollInRadians),be=Math.sin(ee.rollInRadians),Ee=yi(ee),Ce=ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:le.properties.get("sky-color"),u_horizon_color:le.properties.get("horizon-color"),u_horizon:[(ee.width/2-Ee*be)*de,(ee.height/2+Ee*Me)*de],u_horizon_normal:[-be,Me],u_sky_horizon_blend:le.properties.get("sky-horizon-blend")*ee.height/2*de,u_sky_blend:Ce}})(F,P.style.map.transform,P.pixelRatio),Y=new Zt(X.LEQUAL,Zt.ReadWrite,[0,1]),Q=hi.disabled,ne=P.colorModeForRenderPass(),K=P.useProgram("sky"),ae=Sh(U,F);K.draw(U,X.TRIANGLES,Y,Q,ne,Kt.disabled,W,null,void 0,"sky",ae.vertexBuffer,ae.indexBuffer,ae.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[_[this.currentLayer]],F=v[P.source],U=w[P.source];this._renderTileClippingMasks(P,U,!1),this.renderLayer(this,F,P,U,z)}this.renderPass="translucent";let R=!1;for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const P=this.style._layers[_[this.currentLayer]],F=v[P.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(P,z))continue;this.opaquePassEnabledForLayer()||R||(R=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const U=(P.type==="symbol"?A:S)[P.source];this._renderTileClippingMasks(P,w[P.source],!!this.renderToTexture),this.renderLayer(this,F,P,U,z)}if(z.isRenderingGlobe&&(function(P,F,U){const X=P.context,W=X.gl,Y=P.useProgram("atmosphere"),Q=new Zt(W.LEQUAL,Zt.ReadOnly,[0,1]),ne=P.transform,K=(function(Ce,He){const et=Ce.properties.get("position"),qe=[-et.x,-et.y,-et.z],wt=d.as(new Float64Array(16));return Ce.properties.get("anchor")==="map"&&(d.bh(wt,wt,He.rollInRadians),d.bi(wt,wt,-He.pitchInRadians),d.bh(wt,wt,He.bearingInRadians),d.bi(wt,wt,He.center.lat*Math.PI/180),d.bK(wt,wt,-He.center.lng*Math.PI/180)),d.ch(qe,qe,wt),qe})(U,P.transform),ae=ne.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),le=F.properties.get("atmosphere-blend")*ae.projectionTransition;if(le===0)return;const ee=Ro(ne.worldSize,ne.center.lat),de=ne.inverseProjectionMatrix,Me=new Float64Array(4);Me[3]=1,d.aI(Me,Me,ne.modelViewProjectionMatrix),Me[0]/=Me[3],Me[1]/=Me[3],Me[2]/=Me[3],Me[3]=1,d.aI(Me,Me,de),Me[0]/=Me[3],Me[1]/=Me[3],Me[2]/=Me[3],Me[3]=1;const be=((Ce,He,et,qe,wt)=>({u_sun_pos:Ce,u_atmosphere_blend:He,u_globe_position:et,u_globe_radius:qe,u_inv_proj_matrix:wt}))(K,le,[Me[0],Me[1],Me[2]],ee,de),Ee=Sh(X,F);Y.draw(X,W.TRIANGLES,Q,hi.disabled,Ai.alphaBlended,Kt.disabled,be,null,null,"atmosphere",Ee.vertexBuffer,Ee.indexBuffer,Ee.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const P=(function(F,U){let X=null;const W=Object.values(F._layers).flatMap((K=>K.source&&!K.isHidden(U)?[F.tileManagers[K.source]]:[])),Y=W.filter((K=>K.getSource().type==="vector")),Q=W.filter((K=>K.getSource().type!=="vector")),ne=K=>{(!X||X.getSource().maxzoom<K.getSource().maxzoom)&&(X=K)};return Y.forEach((K=>ne(K))),X||Q.forEach((K=>ne(K))),X})(this.style,this.transform.zoom);P&&(function(F,U,X){for(let W=0;W<X.length;W++)Iu(F,U,X[W])})(this,P,P.getVisibleCoordinates())}this.options.showPadding&&(function(P){const F=P.transform.padding;Pl(P,P.transform.height-(F.top||0),3,Es),Pl(P,F.bottom||0,3,ls),As(P,F.left||0,3,wc),As(P,P.transform.width-(F.right||0),3,Tc);const U=P.transform.centerPoint;(function(X,W,Y,Q){In(X,W-1,Y-10,2,20,Q),In(X,W-10,Y-1,20,2,Q)})(P,U.x,P.transform.height-U.y,Ta)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=t?!d.ck(a,l):!d.cl(a,l)),h||(h=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(d.cm(a,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(_,v){const w=_.context,S=w.gl,A=_.transform,z=Ai.unblended,R=new Zt(S.LEQUAL,Zt.ReadWrite,[0,1]),P=v.tileManager.getRenderableTiles(),F=_.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),w.clear({color:d.bq.transparent,depth:1});for(const U of P){const X=v.getTerrainMesh(U.tileID),W=v.getTerrainData(U.tileID),Y=A.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Q={u_ele_delta:v.getMeshFrameDelta(A.zoom)};F.draw(w,S.TRIANGLES,R,hi.disabled,z,Kt.backCCW,Q,W,Y,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain),(function(_,v){const w=_.context,S=w.gl,A=_.transform,z=Ai.unblended,R=new Zt(S.LEQUAL,Zt.ReadWrite,[0,1]),P=v.getCoordsTexture(),F=v.tileManager.getRenderableTiles(),U=_.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),w.clear({color:d.bq.transparent,depth:1}),v.coordsIndex=[];for(const X of F){const W=v.getTerrainMesh(X.tileID),Y=v.getTerrainData(X.tileID);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,P.texture);const Q={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(A.zoom)},ne=A.getProjectionData({overscaledTileID:X.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(w,S.TRIANGLES,R,hi.disabled,z,Kt.backCCW,Q,Y,ne,"terrain",W.vertexBuffer,W.indexBuffer,W.segments),v.coordsIndex.push(X.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,_.width,_.height])})(this,this.style.map.terrain))}renderLayer(t,a,l,h,_){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,d.cn(l)?(function(v,w,S,A,z,R){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:P}=R,F=hi.disabled,U=v.colorModeForRenderPass();(S._unevaluatedLayout.hasValue("text-variable-anchor")||S._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(X,W,Y,Q,ne,K,ae,le,ee){const de=W.transform,Me=W.style.map.terrain,be=ne==="map",Ee=K==="map";for(const Ce of X){const He=Q.getTile(Ce),et=He.getBucket(Y);if(!et||!et.text||!et.text.segments.get().length)continue;const qe=d.az(et.textSizeData,de.zoom),wt=d.aO(He,1,W.transform.zoom),Vt=Kr(be,W.transform,wt),_i=Y.layout.get("icon-text-fit")!=="none"&&et.hasIconData();if(qe){const Fi=Math.pow(2,de.zoom-He.tileID.overscaledZ),xi=Me?(Zi,Ci)=>Me.getElevation(Ce,Zi,Ci):null;ws(et,be,Ee,ee,de,Vt,Fi,qe,_i,d.aP(de,He,ae,le),Ce.toUnwrapped(),xi)}}})(A,v,S,w,S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),z),S.paint.get("icon-opacity").constantOr(1)!==0&&Vo(v,w,S,A,!1,S.paint.get("icon-translate"),S.paint.get("icon-translate-anchor"),S.layout.get("icon-rotation-alignment"),S.layout.get("icon-pitch-alignment"),S.layout.get("icon-keep-upright"),F,U,P),S.paint.get("text-opacity").constantOr(1)!==0&&Vo(v,w,S,A,!0,S.paint.get("text-translate"),S.paint.get("text-translate-anchor"),S.layout.get("text-rotation-alignment"),S.layout.get("text-pitch-alignment"),S.layout.get("text-keep-upright"),F,U,P),w.map.showCollisionBoxes&&(ir(v,w,S,A,!0),ir(v,w,S,A,!1))})(t,a,l,h,this.style.placement.variableOffsets,_):d.co(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,P=S.paint.get("circle-opacity"),F=S.paint.get("circle-stroke-width"),U=S.paint.get("circle-stroke-opacity"),X=!S.layout.get("circle-sort-key").isConstant();if(P.constantOr(1)===0&&(F.constantOr(1)===0||U.constantOr(1)===0))return;const W=v.context,Y=W.gl,Q=v.transform,ne=v.getDepthModeForSublayer(0,Zt.ReadOnly),K=hi.disabled,ae=v.colorModeForRenderPass(),le=[],ee=Q.getCircleRadiusCorrection();for(let de=0;de<A.length;de++){const Me=A[de],be=w.getTile(Me),Ee=be.getBucket(S);if(!Ee)continue;const Ce=S.paint.get("circle-translate"),He=S.paint.get("circle-translate-anchor"),et=d.aP(Q,be,Ce,He),qe=Ee.programConfigurations.get(S.id),wt=v.useProgram("circle",qe),Vt=Ee.layoutVertexBuffer,_i=Ee.indexBuffer,Fi=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Me),xi={programConfiguration:qe,program:wt,layoutVertexBuffer:Vt,indexBuffer:_i,uniformValues:_u(v,be,S,et,ee),terrainData:Fi,projectionData:Q.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!R,applyTerrainMatrix:!0})};if(X){const Zi=Ee.segments.get();for(const Ci of Zi)le.push({segments:new d.aY([Ci]),sortKey:Ci.sortKey,state:xi})}else le.push({segments:Ee.segments,sortKey:0,state:xi})}X&&le.sort(((de,Me)=>de.sortKey-Me.sortKey));for(const de of le){const{programConfiguration:Me,program:be,layoutVertexBuffer:Ee,indexBuffer:Ce,uniformValues:He,terrainData:et,projectionData:qe}=de.state;be.draw(W,Y.TRIANGLES,ne,K,ae,Kt.backCCW,He,et,qe,S.id,Ee,Ce,de.segments,S.paint,v.transform.zoom,Me)}})(t,a,l,h,_):d.cp(l)?(function(v,w,S,A,z){if(S.paint.get("heatmap-opacity")===0)return;const R=v.context,{isRenderingToTexture:P,isRenderingGlobe:F}=z;if(v.style.map.terrain){for(const U of A){const X=w.getTile(U);w.hasRenderableParent(U)||(v.renderPass==="offscreen"?Th(v,X,S,U,F):v.renderPass==="translucent"&&nr(v,S,U,P,F))}R.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?(function(U,X,W,Y){const Q=U.context,ne=Q.gl,K=U.transform,ae=hi.disabled,le=new Ai([ne.ONE,ne.ONE],d.bq.transparent,[!0,!0,!0,!0]);(function(ee,de,Me){const be=ee.gl;ee.activeTexture.set(be.TEXTURE1),ee.viewport.set([0,0,de.width/4,de.height/4]);let Ee=Me.heatmapFbos.get(d.ce);Ee?(be.bindTexture(be.TEXTURE_2D,Ee.colorAttachment.get()),ee.bindFramebuffer.set(Ee.framebuffer)):(Ee=ki(ee,de.width/4,de.height/4),Me.heatmapFbos.set(d.ce,Ee))})(Q,U,W),Q.clear({color:d.bq.transparent});for(let ee=0;ee<Y.length;ee++){const de=Y[ee];if(X.hasRenderableParent(de))continue;const Me=X.getTile(de),be=Me.getBucket(W);if(!be)continue;const Ee=be.programConfigurations.get(W.id),Ce=U.useProgram("heatmap",Ee),He=K.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),et=K.getCircleRadiusCorrection();Ce.draw(Q,ne.TRIANGLES,Zt.disabled,ae,le,Kt.backCCW,to(Me,K.zoom,W.paint.get("heatmap-intensity"),et),null,He,W.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,W.paint,K.zoom,Ee)}Q.viewport.set([0,0,U.width,U.height])})(v,w,S,A):v.renderPass==="translucent"&&(function(U,X){const W=U.context,Y=W.gl;W.setColorMode(U.colorModeForRenderPass());const Q=X.heatmapFbos.get(d.ce);Q&&(W.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,Q.colorAttachment.get()),W.activeTexture.set(Y.TEXTURE1),ri(W,X).bind(Y.LINEAR,Y.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw(W,Y.TRIANGLES,Zt.disabled,hi.disabled,U.colorModeForRenderPass(),Kt.disabled,gh(U,X,0,1),null,null,X.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,X.paint,U.transform.zoom))})(v,S)})(t,a,l,h,_):d.cq(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,P=S.paint.get("line-opacity"),F=S.paint.get("line-width");if(P.constantOr(1)===0||F.constantOr(1)===0)return;const U=v.getDepthModeForSublayer(0,Zt.ReadOnly),X=v.colorModeForRenderPass(),W=S.paint.get("line-dasharray"),Y=W.constantOr(1),Q=S.paint.get("line-pattern"),ne=Q.constantOr(1),K=S.paint.get("line-gradient"),ae=S.getCrossfadeParameters();let le;le=ne?"linePattern":Y&&K?"lineGradientSDF":Y?"lineSDF":K?"lineGradient":"line";const ee=v.context,de=ee.gl,Me=v.transform;let be=!0;for(const Ee of A){const Ce=w.getTile(Ee);if(ne&&!Ce.patternsLoaded())continue;const He=Ce.getBucket(S);if(!He)continue;const et=He.programConfigurations.get(S.id),qe=v.context.program.get(),wt=v.useProgram(le,et),Vt=be||wt.program!==qe,_i=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ee),Fi=Q.constantOr(null),xi=W&&W.constantOr(null);if(Fi&&Ce.imageAtlas){const On=Ce.imageAtlas,on=On.patternPositions[Fi.to.toString()],_n=On.patternPositions[Fi.from.toString()];on&&_n&&et.setConstantPatternPositions(on,_n)}else if(xi){const On=S.layout.get("line-cap")==="round",on=v.lineAtlas.getDash(xi.to,On),_n=v.lineAtlas.getDash(xi.from,On);et.setConstantDashPositions(on,_n)}const Zi=Me.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Ci=Me.getPixelScale();let kn;ne?(kn=_h(v,Ce,S,Ci,ae),aa(ee,de,Ce,et,ae)):Y&&K?(kn=io(v,Ce,S,Ci,ae,He.lineClipsArray.length),sa(v,w,ee,de,S,He,Ee,et,ae)):Y?(kn=Nr(v,Ce,S,Ci,ae),nn(v,ee,de,et,Vt,ae)):K?(kn=Id(v,Ce,S,Ci,He.lineClipsArray.length),Vr(v,w,ee,de,S,He,Ee)):kn=xu(v,Ce,S,Ci);const Gi=v.stencilModeForClipping(Ee);wt.draw(ee,de.TRIANGLES,U,Gi,X,Kt.disabled,kn,_i,Zi,S.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,S.paint,v.transform.zoom,et,He.layoutVertexBuffer2),be=!1}})(t,a,l,h,_):d.cr(l)?(function(v,w,S,A,z){const R=S.paint.get("fill-color"),P=S.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const{isRenderingToTexture:F}=z,U=v.colorModeForRenderPass(),X=S.paint.get("fill-pattern"),W=v.opaquePassEnabledForLayer()&&!X.constantOr(1)&&R.constantOr(d.bq.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===W){const Y=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?Zt.ReadWrite:Zt.ReadOnly);rs(v,w,S,A,Y,U,!1,F)}if(v.renderPass==="translucent"&&S.paint.get("fill-antialias")){const Y=v.getDepthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,Zt.ReadOnly);rs(v,w,S,A,Y,U,!0,F)}})(t,a,l,h,_):d.cs(l)?(function(v,w,S,A,z){const R=S.paint.get("fill-extrusion-opacity");if(R===0)return;const{isRenderingToTexture:P}=z;if(v.renderPass==="translucent"){const F=new Zt(v.context.gl.LEQUAL,Zt.ReadWrite,v.depthRangeFor3D);if(R!==1||S.paint.get("fill-extrusion-pattern").constantOr(1))as(v,w,S,A,F,hi.disabled,Ai.disabled,P),as(v,w,S,A,F,v.stencilModeFor3D(),v.colorModeForRenderPass(),P);else{const U=v.colorModeForRenderPass();as(v,w,S,A,F,hi.disabled,U,P)}}})(t,a,l,h,_):d.ct(l)?(function(v,w,S,A,z){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const{isRenderingToTexture:R}=z,P=v.context,F=v.style.projection.useSubdivision,U=v.getDepthModeForSublayer(0,Zt.ReadOnly),X=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(W,Y,Q,ne,K,ae,le){const ee=W.context,de=ee.gl;for(const Me of Q){const be=Y.getTile(Me),Ee=be.dem;if(!Ee||!Ee.data||!be.needsHillshadePrepare)continue;const Ce=Ee.dim,He=Ee.stride,et=Ee.getPixels();if(ee.activeTexture.set(de.TEXTURE1),ee.pixelStoreUnpackPremultiplyAlpha.set(!1),be.demTexture=be.demTexture||W.getTileTexture(He),be.demTexture){const wt=be.demTexture;wt.update(et,{premultiply:!1}),wt.bind(de.NEAREST,de.CLAMP_TO_EDGE)}else be.demTexture=new d.T(ee,et,de.RGBA,{premultiply:!1}),be.demTexture.bind(de.NEAREST,de.CLAMP_TO_EDGE);ee.activeTexture.set(de.TEXTURE0);let qe=be.fbo;if(!qe){const wt=new d.T(ee,{width:Ce,height:Ce,data:null},de.RGBA);wt.bind(de.LINEAR,de.CLAMP_TO_EDGE),qe=be.fbo=ee.createFramebuffer(Ce,Ce,!0,!1),qe.colorAttachment.set(wt.texture)}ee.bindFramebuffer.set(qe.framebuffer),ee.viewport.set([0,0,Ce,Ce]),W.useProgram("hillshadePrepare").draw(ee,de.TRIANGLES,K,ae,le,Kt.disabled,zd(be.tileID,Ee),null,null,ne.id,W.rasterBoundsBuffer,W.quadTriangleIndexBuffer,W.rasterBoundsSegments),be.needsHillshadePrepare=!1}})(v,w,A,S,U,hi.disabled,X),P.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(F){const[W,Y,Q]=v.stencilConfigForOverlapTwoPass(A);ss(v,w,S,Q,W,U,X,!1,R),ss(v,w,S,Q,Y,U,X,!0,R)}else{const[W,Y]=v.getStencilConfigForOverlapAndUpdateStencilID(A);ss(v,w,S,Y,W,U,X,!1,R)}})(t,a,l,h,_):d.cu(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent"||!A.length)return;const{isRenderingToTexture:R}=z,P=v.style.projection.useSubdivision,F=v.getDepthModeForSublayer(0,Zt.ReadOnly),U=v.colorModeForRenderPass();if(P){const[X,W,Y]=v.stencilConfigForOverlapTwoPass(A);Ss(v,w,S,Y,X,F,U,!1,R),Ss(v,w,S,Y,W,F,U,!0,R)}else{const[X,W]=v.getStencilConfigForOverlapAndUpdateStencilID(A);Ss(v,w,S,W,X,F,U,!1,R)}})(t,a,l,h,_):d.bV(l)?(function(v,w,S,A,z){if(v.renderPass!=="translucent"||S.paint.get("raster-opacity")===0||!A.length)return;const{isRenderingToTexture:R}=z,P=w.getSource(),F=v.style.projection.useSubdivision;if(P instanceof Fr)wa(v,w,S,A,null,!1,!1,P.tileCoords,P.flippedWindingOrder,R);else if(F){const[U,X,W]=v.stencilConfigForOverlapTwoPass(A);wa(v,w,S,W,U,!1,!0,Ms,!1,R),wa(v,w,S,W,X,!0,!0,Ms,!1,R)}else{const[U,X]=v.getStencilConfigForOverlapAndUpdateStencilID(A);wa(v,w,S,X,U,!1,!0,Ms,!1,R)}})(t,a,l,h,_):d.cv(l)?(function(v,w,S,A,z){const R=S.paint.get("background-color"),P=S.paint.get("background-opacity");if(P===0)return;const{isRenderingToTexture:F}=z,U=v.context,X=U.gl,W=v.style.projection,Y=v.transform,Q=Y.tileSize,ne=S.paint.get("background-pattern");if(v.isPatternMissing(ne))return;const K=!ne&&R.a===1&&P===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==K)return;const ae=hi.disabled,le=v.getDepthModeForSublayer(0,K==="opaque"?Zt.ReadWrite:Zt.ReadOnly),ee=v.colorModeForRenderPass(),de=v.useProgram(ne?"backgroundPattern":"background"),Me=A||wn(Y,{tileSize:Q,terrain:v.style.map.terrain});ne&&(U.activeTexture.set(X.TEXTURE0),v.imageManager.bind(v.context));const be=S.getCrossfadeParameters();for(const Ee of Me){const Ce=Y.getProjectionData({overscaledTileID:Ee,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),He=ne?Su(P,v,ne,{tileID:Ee,tileSize:Q},be):Tu(P,R),et=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ee),qe=W.getMeshFromTileID(U,Ee.canonical,!1,!0,"raster");de.draw(U,X.TRIANGLES,le,ae,ee,Kt.backCCW,He,et,Ce,S.id,qe.vertexBuffer,qe.indexBuffer,qe.segments)}})(t,0,l,h,_):d.cw(l)&&(function(v,w,S,A){const{isRenderingGlobe:z}=A,R=v.context,P=S.implementation,F=v.style.projection,U=v.transform,X=U.getProjectionDataForCustomLayer(z),W={farZ:U.farZ,nearZ:U.nearZ,fov:U.fov*Math.PI/180,modelViewProjectionMatrix:U.modelViewProjectionMatrix,projectionMatrix:U.projectionMatrix,shaderData:{variantName:F.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${F.shaderPreludeCode.vertexSource}`,define:F.shaderDefine},defaultProjectionData:X},Y=P.renderingMode?P.renderingMode:"2d";if(v.renderPass==="offscreen"){const Q=P.prerender;Q&&(v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),Q.call(P,R.gl,W),R.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),R.setStencilMode(hi.disabled);const Q=Y==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,Zt.ReadOnly);R.setDepthMode(Q),P.render(R.gl,W),R.setDirty(),v.setBaseState(),R.bindFramebuffer.set(null)}})(t,0,l,_))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),l=this.imageManager.getPattern(t.to.toString());return!a||!l}useProgram(t,a,l=!1,h=[]){this.cache=this.cache||{};const _=!!this.style.map.terrain,v=this.style.projection,w=l?$i.projectionMercator:v.shaderPreludeCode,S=l?mn:v.shaderDefine,A=t+(a?a.cacheKey:"")+`/${l?Sr:v.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(_?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[A]||(this.cache[A]=new Ed(this.context,$i[t],a,Pd[t],this._showOverdrawInspector,_,w,S,h)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const l in this._tileTextures){const h=this._tileTextures[l];if(h)for(const _ of h)_.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const l in this.cache){const h=this.cache[l];h&&h.program&&this.context.gl.deleteProgram(h.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function Mh(m,t){let a,l=!1,h=null,_=null;const v=()=>{h=null,l&&(m.apply(_,a),h=setTimeout(v,t),l=!1)};return(...w)=>(l=!0,_=this,a=w,h||v(),h)}class rn{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let l;return a.split("&").map((h=>h.split("="))).forEach((h=>{h[0]===this._hashName&&(l=h)})),(l&&l[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:l,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const l=a.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let _=window.location.hash.replace(h,"");_.startsWith("#&")?_=_.slice(0,1)+_.slice(2):_==="#"&&(_="");let v=window.location.href.replace(/(#.+)?$/,_);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Mh(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,h),v=Math.round(a.lng*_)/_,w=Math.round(a.lat*_)/_,S=this._map.getBearing(),A=this._map.getPitch();let z="";if(z+=t?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(S||A)&&(z+="/"+Math.round(10*S)/10),A&&(z+=`/${Math.round(A)}`),this._hashName){const R=this._hashName;let P=!1;const F=window.location.hash.slice(1).split("&").map((U=>{const X=U.split("=")[0];return X===R?(P=!0,`${X}=${z}`):U})).filter((U=>U));return P||F.push(`${R}=${z}`),`#${F.join("&")}`}return`#${z}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new d.V(+t[2],+t[1])}catch{return!1}const a=+t[0],l=+(t[3]||0),h=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const uo={linearity:.3,easing:d.cx(0,0,.3,1)},_r=d.e({deceleration:2500,maxSpeed:1400},uo),Dr=d.e({deceleration:20,maxSpeed:1400},uo),Mc=d.e({deceleration:1e3,maxSpeed:360},uo),yr=d.e({deceleration:1e3,maxSpeed:90},uo),Rl=d.e({deceleration:1e3,maxSpeed:360},uo);class Ll{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:xt(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=xt();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)a.zoom+=_.zoomDelta||0,a.bearing+=_.bearingDelta||0,a.pitch+=_.pitchDelta||0,a.roll+=_.rollDelta||0,_.panDelta&&a.pan._add(_.panDelta),_.around&&(a.around=_.around),_.pinchAround&&(a.pinchAround=_.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(a.pan.mag()){const _=Pu(a.pan.mag(),l,d.e({},_r,t||{})),v=a.pan.mult(_.amount/a.pan.mag()),w=this._map.cameraHelper.handlePanInertia(v,this._map.transform);h.center=w.easingCenter,h.offset=w.easingOffset,Bl(h,_)}if(a.zoom){const _=Pu(a.zoom,l,Dr);h.zoom=this._map.transform.zoom+_.amount,Bl(h,_)}if(a.bearing){const _=Pu(a.bearing,l,Mc);h.bearing=this._map.transform.bearing+d.ao(_.amount,-179,179),Bl(h,_)}if(a.pitch){const _=Pu(a.pitch,l,yr);h.pitch=this._map.transform.pitch+_.amount,Bl(h,_)}if(a.roll){const _=Pu(a.roll,l,Rl);h.roll=this._map.transform.roll+d.ao(_.amount,-179,179),Bl(h,_)}if(h.zoom||h.bearing){const _=a.pinchAround===void 0?a.around:a.pinchAround;h.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),d.e(h,{noMoveStart:!0})}}function Bl(m,t){(!m.duration||m.duration<t.duration)&&(m.duration=t.duration,m.easing=t.easing)}function Pu(m,t,a){const{maxSpeed:l,linearity:h,deceleration:_}=a,v=d.ao(m*h/(t/1e3),-l,l),w=Math.abs(v)/(_*h);return{easing:a.easing,duration:1e3*w,amount:v*(w/2)}}class Ur extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(t,l);const _=me.mousePos(a.getCanvas(),l),v=a.unproject(_);super(t,d.e({point:_,lngLat:v,originalEvent:l},h)),this._defaultPrevented=!1,this.target=a}}class La extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l){const h=t==="touchend"?l.changedTouches:l.touches,_=me.touchPos(a.getCanvasContainer(),h),v=_.map((S=>a.unproject(S))),w=_.reduce(((S,A,z,R)=>S.add(A.div(R.length))),new d.P(0,0));super(t,{points:_,point:w,lngLats:v,lngLat:a.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Ru extends d.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,l){super(t,{originalEvent:l}),this._defaultPrevented=!1}}class co{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Ru(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Ur(t.type,this._map,t))}mouseup(t){this._map.fire(new Ur(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Ur(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ur(t.type,this._map,t))}mouseover(t){this._map.fire(new Ur(t.type,this._map,t))}mouseout(t){this._map.fire(new Ur(t.type,this._map,t))}touchstart(t){return this._firePreventable(new La(t.type,this._map,t))}touchmove(t){this._map.fire(new La(t.type,this._map,t))}touchend(t){this._map.fire(new La(t.type,this._map,t))}touchcancel(t){this._map.fire(new La(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class us{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ur(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ur("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ur(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class lt{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(d.P.convert(t),this._map.terrain)}}class Lu{constructor(t,a){this._map=t,this._tr=new lt(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(me.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const l=a;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=me.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(h.x,l.x),v=Math.max(h.x,l.x),w=Math.min(h.y,l.y),S=Math.max(h.y,l.y);me.setTransform(this._box,`translate(${_}px,${w}px)`),this._box.style.width=v-_+"px",this._box.style.height=S-w+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const l=this._startPos,h=a;if(this.reset(),me.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new d.l("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(me.remove(this._box),this._box=null),me.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new d.l(t,{originalEvent:a}))}}function ho(m,t){if(m.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${t.length}`);const a={};for(let l=0;l<m.length;l++)a[m[l].identifier]=t[l];return a}class Bu{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),l.length===this.numTouches&&(this.centroid=(function(h){const _=new d.P(0,0);for(const v of h)_._add(v);return _.div(h.length)})(a),this.touches=ho(l,a)))}touchmove(t,a,l){if(this.aborted||!this.centroid)return;const h=ho(l,a);for(const _ in this.touches){const v=h[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,a,l){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class fo{constructor(t){this.singleTap=new Bu(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,l){this.singleTap.touchstart(t,a,l)}touchmove(t,a,l){this.singleTap.touchmove(t,a,l)}touchend(t,a,l){const h=this.singleTap.touchend(t,a,l);if(h){const _=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(h)<30;if(_&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class kl{constructor(t){this._tr=new lt(t),this._zoomIn=new fo({numTouches:1,numTaps:2}),this._zoomOut=new fo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,l){this._zoomIn.touchstart(t,a,l),this._zoomOut.touchstart(t,a,l)}touchmove(t,a,l){this._zoomIn.touchmove(t,a,l),this._zoomOut.touchmove(t,a,l)}touchend(t,a,l){const h=this._zoomIn.touchend(t,a,l),_=this._zoomOut.touchend(t,a,l),v=this._tr;return h?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(h)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oa{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const h=Array.isArray(a)?a[0]:a;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&me.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Uo=0,Ec=2,Eh={[Uo]:1,[Ec]:2};class Sa{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=me.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,l){const h=Eh[l];return a.buttons===void 0||(a.buttons&h)!==h})(t,this._eventButton)}isValidEndEvent(t){return me.mouseButton(t)===this._eventButton}}class ku{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Ou{constructor(t=new Sa({checkCorrectEvent:()=>!0}),a=new ku){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,l){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?l(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const po=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=t=>{t.preventDefault()}};class Ac{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,l){return this._calculateTransform(t,a,l)}touchmove(t,a,l){if(this._active){if(!this._shouldBePrevented(l.length))return t.preventDefault(),this._calculateTransform(t,a,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,l){this._calculateTransform(t,a,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,l){l.length>0&&(this._active=!0);const h=ho(l,a),_=new d.P(0,0),v=new d.P(0,0);let w=0;for(const A in h){const z=h[A],R=this._touches[A];R&&(_._add(z),v._add(z.sub(R)),w++,h[A]=z)}if(this._touches=h,this._shouldBePrevented(w)||!v.mag())return;const S=v.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(w),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,l){if(!this._firstTwoTouches)return;t.preventDefault();const[h,_]=this._firstTwoTouches,v=cs(l,a,h),w=cs(l,a,_);if(!v||!w)return;const S=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],S,t)}touchend(t,a,l){if(!this._firstTwoTouches)return;const[h,_]=this._firstTwoTouches,v=cs(l,a,h),w=cs(l,a,_);v&&w||(this._active&&me.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function cs(m,t,a){for(let l=0;l<m.length;l++)if(m[l].identifier===a)return t[l]}function Cc(m,t){return Math.log(m/t)/Math.LN2}class Cs extends Fu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const l=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Cc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cc(this._distance,l),pinchAround:a}}}function zc(m,t){return 180*m.angleWith(t)/Math.PI}class Ba extends Fu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,l){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:zc(this._vector,h),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,l=zc(t,this._startVector);return Math.abs(l)<a}}function si(m){return Math.abs(m.y)>Math.abs(m.x)}class zs extends Fu{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,l){super.touchstart(t,a,l),this._currentTouchCount=l.length}_start(t){this._lastPoints=t,si(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,_,l.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(h.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,l){if(this._valid!==void 0)return this._valid;const h=t.mag()>=2,_=a.mag()>=2;if(!h&&!_)return;if(!h||!_)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=t.y>0==a.y>0;return si(t)&&si(a)&&v}}const mo={panStep:100,bearingStep:15,pitchStep:10};class Go{constructor(t){this._tr=new lt(t);const a=mo;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,l=0,h=0,_=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?l=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?l=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?h=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?h=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:w=>{const S=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Nu,zoom:a?Math.round(S.zoom)+a*(t.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+h*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:S.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Nu(m){return m*(2-m)}const qo=4.000244140625,Ol=1/450;class Dc{constructor(t,a){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=t,this._tr=new lt(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ol}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const l=xt(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,a!==0&&a%qo==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(h*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=me.mousePos(this._map.getCanvas(),t),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(d.V.convert(l.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const w=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>qo?this._wheelZoomRate:this._defaultZoomRate;let S=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&S!==0&&(S=1/S);const A=typeof this._targetZoom!="number"?t.scale:d.ar(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),d.au(A*S)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let _,v=!1;if(this._type==="wheel"&&l&&h){const w=xt()-this._lastWheelEventTime,S=Math.min((w+5)/200,1),A=h(S);_=d.G.number(l,a,A),S<1?this._frameId||(this._frameId=!0):v=!0}else _=a,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=_,{noInertia:!0,needsRenderFrame:!v,zoomDelta:_-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=d.cz;if(this._prevEase){const l=this._prevEase,h=(xt()-l.start)/l.duration,_=l.easing(h+.01)-l.easing(h),v=.27/Math.sqrt(_*_+1e-4)*.01,w=Math.sqrt(.0729-v*v);a=d.cx(v,w,.25,1)}return this._prevEase={start:xt(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ah{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ir{constructor(t){this._tr=new lt(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zo{constructor(){this._tap=new fo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,l){if(!this._swipePoint)if(this._tapTime){const h=a[0],_=t.timeStamp-this._tapTime<500,v=this._tapPoint.dist(h)<30;_&&v?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(t,a,l)}touchmove(t,a,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=a[0],_=h.y-this._swipePoint.y;return this._swipePoint=h,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,a,l)}touchend(t,a,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(t,a,l);h&&(this._tapTime=t.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tt{constructor(t,a,l){this._el=t,this._mousePan=a,this._touchPan=l}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pt{constructor(t,a,l,h){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class go{constructor(t,a,l,h){this._el=t,this._touchZoom=a,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Pr{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=me.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=a,this._container.appendChild(h);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=l,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(me.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new d.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const rr=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class Sn extends d.l{}function Rr(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class Ch{constructor(t,a){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,_)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=h.type==="renderFrame"?void 0:h,w={needsRenderFrame:!1},S={},A={};for(const{handlerName:P,handler:F,allowed:U}of this._handlers){if(!F.isEnabled())continue;let X;if(this._blockedByActive(A,U,P))F.reset();else if(F[_||h.type]){if(d.cA(h,_||h.type)){const W=me.mousePos(this._map.getCanvas(),h);X=F[_||h.type](h,W)}else if(d.cB(h,_||h.type)){const W=this._getMapTouches(h.touches),Y=me.touchPos(this._map.getCanvas(),W);X=F[_||h.type](h,Y,W)}else d.cC(_||h.type)||(X=F[_||h.type](h));this.mergeHandlerResult(w,S,X,P,v),X&&X.needsRenderFrame&&this._triggerRenderFrame()}(X||F.isActive())&&(A[P]=F)}const z={};for(const P in this._previousActiveHandlers)A[P]||(z[P]=v);this._previousActiveHandlers=A,(Object.keys(z).length||Rr(w))&&(this._changes.push([w,S,z]),this._triggerRenderFrame()),(Object.keys(A).length||Rr(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=w;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ll(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,_,v]of this._listeners)me.addEventListener(h,_,h===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,a,l]of this._listeners)me.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(t){const a=this._map,l=a.getCanvasContainer();this._add("mapEvent",new co(a,t));const h=a.boxZoom=new Lu(a,t);this._add("boxZoom",h),t.interactive&&t.boxZoom&&h.enable();const _=a.cooperativeGestures=new Pr(a,t.cooperativeGestures);this._add("cooperativeGestures",_),t.cooperativeGestures&&_.enable();const v=new kl(a),w=new Ir(a);a.doubleClickZoom=new Ah(w,v),this._add("tapZoom",v),this._add("clickZoom",w),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const S=new Zo;this._add("tapDragZoom",S);const A=a.touchPitch=new zs(a);this._add("touchPitch",A),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const z=()=>a.project(a.getCenter()),R=(function({enable:K,clickTolerance:ae,aroundCenter:le=!0,minPixelCenterThreshold:ee=100,rotateDegreesPerPixelMoved:de=.8},Me){const be=new Sa({checkCorrectEvent:Ee=>me.mouseButton(Ee)===0&&Ee.ctrlKey||me.mouseButton(Ee)===2&&!Ee.ctrlKey});return new oa({clickTolerance:ae,move:(Ee,Ce)=>{const He=Me();if(le&&Math.abs(He.y-Ee.y)>ee)return{bearingDelta:d.cy(new d.P(Ee.x,Ce.y),Ce,He)};let et=(Ce.x-Ee.x)*de;return le&&Ce.y<He.y&&(et=-et),{bearingDelta:et}},moveStateManager:be,enable:K,assignEvents:po})})(t,z),P=(function({enable:K,clickTolerance:ae,pitchDegreesPerPixelMoved:le=-.5}){const ee=new Sa({checkCorrectEvent:de=>me.mouseButton(de)===0&&de.ctrlKey||me.mouseButton(de)===2});return new oa({clickTolerance:ae,move:(de,Me)=>({pitchDelta:(Me.y-de.y)*le}),moveStateManager:ee,enable:K,assignEvents:po})})(t),F=(function({enable:K,clickTolerance:ae,rollDegreesPerPixelMoved:le=.3},ee){const de=new Sa({checkCorrectEvent:Me=>me.mouseButton(Me)===2&&Me.ctrlKey});return new oa({clickTolerance:ae,move:(Me,be)=>{const Ee=ee();let Ce=(be.x-Me.x)*le;return be.y<Ee.y&&(Ce=-Ce),{rollDelta:Ce}},moveStateManager:de,enable:K,assignEvents:po})})(t,z);a.dragRotate=new Pt(t,R,P,F),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",P,["mouseRotate","mouseRoll"]),this._add("mouseRoll",F,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const U=(function({enable:K,clickTolerance:ae}){const le=new Sa({checkCorrectEvent:ee=>me.mouseButton(ee)===0&&!ee.ctrlKey});return new oa({clickTolerance:ae,move:(ee,de)=>({around:de,panDelta:de.sub(ee)}),activateOnStart:!0,moveStateManager:le,enable:K,assignEvents:po})})(t),X=new Ac(t,a);a.dragPan=new Tt(l,U,X),this._add("mousePan",U),this._add("touchPan",X,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const W=new Ba,Y=new Cs;a.touchZoomRotate=new go(l,Y,W,S),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new us(a));const Q=a.scrollZoom=new Dc(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Q,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const ne=a.keyboard=new Go(a);this._add("keyboard",ne),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,l){this._handlers.push({handlerName:t,handler:a,allowed:l}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!rr(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,l){for(const h in t)if(h!==l&&(!a||a.indexOf(h)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const l of t)this._el.contains(l.target)&&a.push(l);return a}mergeHandlerResult(t,a,l,h,_){if(!l)return;d.e(t,l);const v={handlerName:h,originalEvent:l.originalEvent||_};l.zoomDelta!==void 0&&(a.zoom=v),l.panDelta!==void 0&&(a.drag=v),l.rollDelta!==void 0&&(a.roll=v),l.pitchDelta!==void 0&&(a.pitch=v),l.bearingDelta!==void 0&&(a.rotate=v)}_applyChanges(){const t={},a={},l={};for(const[h,_,v]of this._changes)h.panDelta&&(t.panDelta=(t.panDelta||new d.P(0,0))._add(h.panDelta)),h.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(t.rollDelta=(t.rollDelta||0)+h.rollDelta),h.around!==void 0&&(t.around=h.around),h.pinchAround!==void 0&&(t.pinchAround=h.pinchAround),h.noInertia&&(t.noInertia=h.noInertia),d.e(a,_),d.e(l,v);this._updateMapTransform(t,a,l),this._changes=[]}_updateMapTransform(t,a,l){const h=this._map,_=h._getTransformForUpdate(),v=h.terrain;if(!(Rr(t)||v&&this._terrainMovement))return this._fireEvents(a,l,!0);h._stop(!0);let{panDelta:w,zoomDelta:S,bearingDelta:A,pitchDelta:z,rollDelta:R,around:P,pinchAround:F}=t;F!==void 0&&(P=F),P=P||h.transform.centerPoint,v&&!_.isPointOnMapSurface(P)&&(P=_.centerPoint);const U={panDelta:w,zoomDelta:S,rollDelta:R,pitchDelta:z,bearingDelta:A,around:P};this._map.cameraHelper.useGlobeControls&&!_.isPointOnMapSurface(P)&&(P=_.centerPoint);const X=P.distSqr(_.centerPoint)<.01?_.center:_.screenPointToLocation(w?P.sub(w):P);this._handleMapControls({terrain:v,tr:_,deltasForHelper:U,preZoomAroundLoc:X,combinedEventsInProgress:a,panDelta:w}),h._applyUpdatedTransform(_),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,l,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:l,preZoomAroundLoc:h,combinedEventsInProgress:_,panDelta:v}){const w=this._map.cameraHelper;if(w.handleMapControlsRollPitchBearingZoom(l,a),t)return w.useGlobeControls?(this._terrainMovement||!_.drag&&!_.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void w.handleMapControlsPan(l,a,h)):this._terrainMovement||!_.drag&&!_.zoom?void(_.drag&&this._terrainMovement&&v?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(v))):w.handleMapControlsPan(l,a,h)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void w.handleMapControlsPan(l,a,h));w.handleMapControlsPan(l,a,h)}_fireEvents(t,a,l){const h=rr(this._eventsInProgress),_=rr(t),v={};for(const R in t){const{originalEvent:P}=t[R];this._eventsInProgress[R]||(v[`${R}start`]=P),this._eventsInProgress[R]=t[R]}!h&&_&&this._fireEvent("movestart",_.originalEvent);for(const R in v)this._fireEvent(R,v[R]);_&&this._fireEvent("move",_.originalEvent);for(const R in t){const{originalEvent:P}=t[R];this._fireEvent(R,P)}const w={};let S;for(const R in this._eventsInProgress){const{handlerName:P,originalEvent:F}=this._eventsInProgress[R];this._handlersById[P].isActive()||(delete this._eventsInProgress[R],S=a[P]||F,w[`${R}end`]=S)}for(const R in w)this._fireEvent(R,w[R]);const A=rr(this._eventsInProgress),z=(h||_)&&!A;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const R=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&R.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(R)}if(l&&z){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!R||!R.essential&&kt.prefersReducedMotion?(this._map.fire(new d.l("moveend",{originalEvent:S})),P(this._map.getBearing())&&this._map.resetNorth()):(P(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new d.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new Sn("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class _o extends d.E{constructor(t,a,l){super(),this._renderFrameCallback=()=>{const h=Math.min((xt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new d.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,l){return t=d.P.convert(t).mult(-1),this.panTo(this.transform.center,d.e({offset:t},a),l)}panTo(t,a,l){return this.easeTo(d.e({center:t},a),l)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,l){return this.easeTo(d.e({zoom:t},a),l)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new d.l("movestart",a)).fire(new d.l("move",a)).fire(new d.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,l){return this.easeTo(d.e({bearing:t},a),l)}resetNorth(t,a){return this.rotateTo(0,d.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(d.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=fn.convert(t).adjustAntiMeridian();const l=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),l,a)}_cameraForBoxAndBearing(t,a,l,h){const _={top:0,bottom:0,right:0,left:0};if(typeof(h=d.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const A=h.padding;h.padding={top:A,bottom:A,right:A,left:A}}const v=d.e(_,h.padding);h.padding=v;const w=this.transform,S=new fn(t,a);return this.cameraHelper.cameraForBoxAndBearing(h,v,S,l,w)}fitBounds(t,a,l){return this._fitInternal(this.cameraForBounds(t,a),a,l)}fitScreenCoordinates(t,a,l,h,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(d.P.convert(t)),this.transform.screenPointToLocation(d.P.convert(a)),l,h),h,_)}_fitInternal(t,a,l){return t?(delete(a=d.e(t,a)).padding,a.linear?this.easeTo(a,l):this.flyTo(a,l)):this}jumpTo(t,a){this.stop();const l=this._getTransformForUpdate();let h=!1,_=!1,v=!1;const w=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,t);const S=l.zoom!==w;return"elevation"in t&&l.elevation!==+t.elevation&&l.setElevation(+t.elevation),"bearing"in t&&l.bearing!==+t.bearing&&(h=!0,l.setBearing(+t.bearing)),"pitch"in t&&l.pitch!==+t.pitch&&(_=!0,l.setPitch(+t.pitch)),"roll"in t&&l.roll!==+t.roll&&(v=!0,l.setRoll(+t.roll)),t.padding==null||l.isPaddingEqual(t.padding)||l.setPadding(t.padding),this._applyUpdatedTransform(l),this.fire(new d.l("movestart",a)).fire(new d.l("move",a)),S&&this.fire(new d.l("zoomstart",a)).fire(new d.l("zoom",a)).fire(new d.l("zoomend",a)),h&&this.fire(new d.l("rotatestart",a)).fire(new d.l("rotate",a)).fire(new d.l("rotateend",a)),_&&this.fire(new d.l("pitchstart",a)).fire(new d.l("pitch",a)).fire(new d.l("pitchend",a)),v&&this.fire(new d.l("rollstart",a)).fire(new d.l("roll",a)).fire(new d.l("rollend",a)),this.fire(new d.l("moveend",a))}calculateCameraOptionsFromTo(t,a,l,h=0){const _=d.ab.fromLngLat(t,a),v=d.ab.fromLngLat(l,h),w=v.x-_.x,S=v.y-_.y,A=v.z-_.z,z=Math.hypot(w,S,A);if(z===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(w,S),P=d.au(this.transform.cameraToCenterDistance/z/this.transform.tileSize),F=180*Math.atan2(w,-S)/Math.PI;let U=180*Math.acos(R/z)/Math.PI;return U=A<0?90-U:90+U,{center:v.toLngLat(),elevation:h,zoom:P,pitch:U,bearing:F}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,l,h,_){const v=this.transform.calculateCenterFromCameraLngLatAlt(t,a,l,h);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:l,pitch:h,roll:_}}easeTo(t,a){this._stop(!1,t.easeId),((t=d.e({offset:[0,0],duration:500,easing:d.cz},t)).animate===!1||!t.essential&&kt.prefersReducedMotion)&&(t.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),_=l.pitch,v=l.roll,w="bearing"in t?this._normalizeBearing(t.bearing,h):h,S="pitch"in t?+t.pitch:_,A="roll"in t?this._normalizeBearing(t.roll,v):v,z="padding"in t?t.padding:l.padding,R=d.P.convert(t.offset);let P,F;t.around&&(P=d.V.convert(t.around),F=l.locationToScreenPoint(P));const U={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},X=this.cameraHelper.handleEaseTo(l,{bearing:w,pitch:S,roll:A,padding:z,around:P,aroundPoint:F,offsetAsPoint:R,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||h!==w,this._pitching=this._pitching||S!==_,this._rolling=this._rolling||A!==v,this._padding=!l.isPaddingEqual(z),this._zooming=this._zooming||X.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,U),this.terrain&&this._prepareElevation(X.elevationCenter),this._ease((W=>{X.easeFunc(W),this.terrain&&!t.freezeElevation&&this._updateElevation(W),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),(W=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,W)}),t),this}_prepareEase(t,a,l={}){this._moving=!0,a||l.moving||this.fire(new d.l("movestart",t)),this._zooming&&!l.zooming&&this.fire(new d.l("zoomstart",t)),this._rotating&&!l.rotating&&this.fire(new d.l("rotatestart",t)),this._pitching&&!l.pitching&&this.fire(new d.l("pitchstart",t)),this._rolling&&!l.rolling&&this.fire(new d.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(l-(a-(l*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(d.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),l=t.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(l<h){const _=this.calculateCameraOptionsFromTo(a,h,t.center,t.elevation);return{pitch:_.pitch,zoom:_.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((h=>this._elevateCameraIfInsideTerrain(h))),this.transformCameraUpdate&&a.push((h=>this.transformCameraUpdate(h))),!a.length)return;const l=t.clone();for(const h of a){const _=l.clone(),{center:v,zoom:w,roll:S,pitch:A,bearing:z,elevation:R}=h(_);v&&_.setCenter(v),R!==void 0&&_.setElevation(R),w!==void 0&&_.setZoom(w),S!==void 0&&_.setRoll(S),A!==void 0&&_.setPitch(A),z!==void 0&&_.setBearing(z),l.apply(_)}this.transform.apply(l)}_fireMoveEvents(t){this.fire(new d.l("move",t)),this._zooming&&this.fire(new d.l("zoom",t)),this._rotating&&this.fire(new d.l("rotate",t)),this._pitching&&this.fire(new d.l("pitch",t)),this._rolling&&this.fire(new d.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const l=this._zooming,h=this._rotating,_=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new d.l("zoomend",t)),h&&this.fire(new d.l("rotateend",t)),_&&this.fire(new d.l("pitchend",t)),v&&this.fire(new d.l("rollend",t)),this.fire(new d.l("moveend",t))}flyTo(t,a){if(!t.essential&&kt.prefersReducedMotion){const Ce=d.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Ce,a)}this.stop(),t=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.cz},t);const l=this._getTransformForUpdate(),h=l.bearing,_=l.pitch,v=l.roll,w=l.padding,S="bearing"in t?this._normalizeBearing(t.bearing,h):h,A="pitch"in t?+t.pitch:_,z="roll"in t?this._normalizeBearing(t.roll,v):v,R="padding"in t?t.padding:l.padding,P=d.P.convert(t.offset);let F=l.centerPoint.add(P);const U=l.screenPointToLocation(F),X=this.cameraHelper.handleFlyTo(l,{bearing:S,pitch:A,roll:z,padding:R,locationAtOffset:U,offsetAsPoint:P,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let W=t.curve;const Y=Math.max(l.width,l.height),Q=Y/X.scaleOfZoom,ne=X.pixelPathLength;typeof X.scaleOfMinZoom=="number"&&(W=Math.sqrt(Y/X.scaleOfMinZoom/ne*2));const K=W*W;function ae(Ce){const He=(Q*Q-Y*Y+(Ce?-1:1)*K*K*ne*ne)/(2*(Ce?Q:Y)*K*ne);return Math.log(Math.sqrt(He*He+1)-He)}function le(Ce){return(Math.exp(Ce)-Math.exp(-Ce))/2}function ee(Ce){return(Math.exp(Ce)+Math.exp(-Ce))/2}const de=ae(!1);let Me=function(Ce){return ee(de)/ee(de+W*Ce)},be=function(Ce){return Y*((ee(de)*(le(He=de+W*Ce)/ee(He))-le(de))/K)/ne;var He},Ee=(ae(!0)-de)/W;if(Math.abs(ne)<2e-6||!isFinite(Ee)){if(Math.abs(Y-Q)<1e-6)return this.easeTo(t,a);const Ce=Q<Y?-1:1;Ee=Math.abs(Math.log(Q/Y))/W,be=()=>0,Me=He=>Math.exp(Ce*W*He)}return t.duration="duration"in t?+t.duration:1e3*Ee/("screenSpeed"in t?+t.screenSpeed/W:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=h!==S,this._pitching=A!==_,this._rolling=z!==v,this._padding=!l.isPaddingEqual(R),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(X.targetCenter),this._ease((Ce=>{const He=Ce*Ee,et=1/Me(He),qe=be(He);this._rotating&&l.setBearing(d.G.number(h,S,Ce)),this._pitching&&l.setPitch(d.G.number(_,A,Ce)),this._rolling&&l.setRoll(d.G.number(v,z,Ce)),this._padding&&(l.interpolatePadding(w,R,Ce),F=l.centerPoint.add(P)),X.easeFunc(Ce,et,qe,F),this.terrain&&!t.freezeElevation&&this._updateElevation(Ce),this._applyUpdatedTransform(l),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,a)}return t||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(t,a,l){l.animate===!1||l.duration===0?(t(1),a()):(this._easeStart=xt(),this._easeOptions=l,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=d.W(t,-180,180);const l=Math.abs(t-a);return Math.abs(t-360-a)<l&&(t-=360),Math.abs(t+360-a)<l&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(d.V.convert(t)):null}}const Gr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Mn{constructor(t=Gr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=me.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=me.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=me.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){me.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const l=this._map._getUIString(`AttributionControl.${a}`);t.title=l,t.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((h=>typeof h!="string"?"":h))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const a=this._map.style.tileManagers;for(const h in a){const _=a[h];if(_.used||_.usedForTerrain){const v=_.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t=t.filter((h=>String(h).trim())),t.sort(((h,_)=>h.length-_.length)),t=t.filter(((h,_)=>{for(let v=_+1;v<t.length;v++)if(t[v].indexOf(h)>=0)return!1;return!0}));const l=t.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,t.length?(this._innerContainer.innerHTML=me.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ds{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const l=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=me.create("div","maplibregl-ctrl");const a=me.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){me.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class vi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,l=a?this._queue.concat(a):this._queue;for(const h of l)if(h.id===t)return void(h.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const l of a)if(!l.cancelled&&(l.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var zt=d.aV([{name:"a_pos3d",type:"Int16",components:3}]);class Oi extends d.E{constructor(t){super(),this._lastTilesetChange=xt(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const l={};for(const h of wn(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),d.c8(h.terrainRttPosMatrix32f,0,d.a5,d.a5,0,0,1),this._tiles[h.key]=new je(h,this.tileSize),this._lastTilesetChange=xt());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(t){for(const a in this._tiles){const l=this._tiles[a];(!t||l.tileID.equals(t)||l.tileID.isChildOf(t)||t.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,_=t.clone(),v=d.bl();if(h.canonical.equals(t.canonical))d.c8(v,0,d.a5,d.a5,0,0,1);else if(h.canonical.isChildOf(t.canonical)){const w=h.canonical.z-t.canonical.z,S=h.canonical.x-(h.canonical.x>>w<<w),A=h.canonical.y-(h.canonical.y>>w<<w),z=d.a5>>w;d.c8(v,0,z,z,0,0,1),d.O(v,v,[-S*z,-A*z,0])}else{if(!t.canonical.isChildOf(h.canonical))continue;{const w=t.canonical.z-h.canonical.z,S=t.canonical.x-(t.canonical.x>>w<<w),A=t.canonical.y-(t.canonical.y>>w<<w),z=d.a5>>w;d.c8(v,0,d.a5,d.a5,0,0,1),d.O(v,v,[S*z,A*z,0]),d.Q(v,v,[1/2**w,1/2**w,0])}}_.terrainRttPosMatrix32f=new Float32Array(v),a[l]=_}return a}_getTerrainCoordsForTileRanges(t,a){const l={};for(const h of this._renderableTilesKeys){const _=this._tiles[h].tileID;if(!this._isWithinTileRanges(_,a))continue;const v=t.clone(),w=d.bl();if(_.canonical.z===t.canonical.z){const S=t.canonical.x-_.canonical.x,A=t.canonical.y-_.canonical.y;d.c8(w,0,d.a5,d.a5,0,0,1),d.O(w,w,[S*d.a5,A*d.a5,0])}else if(_.canonical.z>t.canonical.z){const S=_.canonical.z-t.canonical.z,A=_.canonical.x-(_.canonical.x>>S<<S),z=_.canonical.y-(_.canonical.y>>S<<S),R=t.canonical.x-(_.canonical.x>>S),P=t.canonical.y-(_.canonical.y>>S),F=d.a5>>S;d.c8(w,0,F,F,0,0,1),d.O(w,w,[-A*F+R*d.a5,-z*F+P*d.a5,0])}else{const S=t.canonical.z-_.canonical.z,A=t.canonical.x-(t.canonical.x>>S<<S),z=t.canonical.y-(t.canonical.y>>S<<S),R=(t.canonical.x>>S)-_.canonical.x,P=(t.canonical.y>>S)-_.canonical.y,F=d.a5<<S;d.c8(w,0,F,F,0,0,1),d.O(w,w,[A*d.a5+R*F,z*d.a5+P*F,0])}v.terrainRttPosMatrix32f=new Float32Array(w),l[h]=v}return l}getSourceTile(t,a){const l=this.tileManager._source;let h=t.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(h).key);let _=this.findTileInCaches(this._sourceTileCache[t.key]);if(!_?.dem&&a)for(;h>=l.minzoom&&!_?.dem;)_=this.findTileInCaches(t.scaledTo(h--).key);return _}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class an{constructor(t,a,l){this._meshCache={},this.painter=t,this.tileManager=new Oi(a),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,l,h=d.a5){var _;if(!(a>=0&&a<h&&l>=0&&l<h))return 0;const v=this.getTerrainData(t),w=(_=v.tile)===null||_===void 0?void 0:_.dem;if(!w)return 0;const S=d.cD([],[a/h*d.a5,l/h*d.a5],v.u_terrain_matrix),A=[S[0]*w.dim,S[1]*w.dim],z=Math.floor(A[0]),R=Math.floor(A[1]),P=A[0]-z,F=A[1]-R;return w.get(z,R)*(1-P)*(1-F)+w.get(z+1,R)*P*(1-F)+w.get(z,R+1)*(1-P)*F+w.get(z+1,R+1)*P*F}getElevationForLngLatZoom(t,a){if(!d.cE(a,t.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(l,h%d.a5,_%d.a5,d.a5)}getElevationForLngLat(t){return this.getElevationForLngLatZoom(t,this.tileManager.maxzoom)}getElevation(t,a,l,h=d.a5){return this.getDEMElevation(t,a,l,h)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const h=this.painter.context,_=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new d.T(h,_,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new d.T(h,new d.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.as([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const h=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new d.T(h,a.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),a.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const l=a&&a+a.tileID.key+t.key;if(l&&!this._demMatrixCache[l]){const h=this.tileManager.getSource().maxzoom;let _=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=h?_=t.canonical.z-h:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=t.canonical.x-(t.canonical.x>>_<<_),w=t.canonical.y-(t.canonical.y>>_<<_),S=d.cF(new Float64Array(16),[1/(d.a5<<_),1/(d.a5<<_),0]);d.O(S,S,[v*d.a5,w*d.a5,0]),this._demMatrixCache[t.key]={matrix:S,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,l=a.width/devicePixelRatio,h=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new d.T(a.context,{width:l,height:h,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new d.T(a.context,{width:l,height:h,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,v=0;_<this._coordsTextureSize;_++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)a[v+0]=255&w,a[v+1]=255&_,a[v+2]=w>>8<<4|_>>8,a[v+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),h=new d.T(t,l,t.gl.RGBA,{premultiply:!1});return h.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),l=this.painter.context,h=l.gl,_=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(_,w-v-1,1,1,h.RGBA,h.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null);const S=a[0]+(a[2]>>4<<8),A=a[1]+((15&a[2])<<8),z=this.coordsIndex[255-a[3]],R=z&&this.tileManager.getTileByID(z);if(!R)return null;const P=this._coordsTextureSize,F=(1<<R.tileID.canonical.z)*P;return new d.ab((R.tileID.canonical.x*P+S)/F+R.tileID.wrap,(R.tileID.canonical.y*P+A)/F,this.getElevation(R.tileID,S,A,P))}depthAtPoint(t){const a=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,a),l.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const l=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,h=l&&t.canonical.y===0,_=l&&t.canonical.y===(1<<t.canonical.z)-1,v=`m_${h?"n":""}_${_?"s":""}`;if(this._meshCache[v])return this._meshCache[v];const w=this.painter.context,S=new d.cG,A=new d.aZ,z=this.meshSize,R=d.a5/z,P=z*z;for(let ee=0;ee<=z;ee++)for(let de=0;de<=z;de++)S.emplaceBack(de*R,ee*R,0);for(let ee=0;ee<P;ee+=z+1)for(let de=0;de<z;de++)A.emplaceBack(de+ee,z+de+ee+1,z+de+ee+2),A.emplaceBack(de+ee,z+de+ee+2,de+ee+1);const F=S.length,U=F+(z+1),X=(z+1)*z,W=h?d.bs:0,Y=h?0:1,Q=_?d.bt:d.a5,ne=_?0:1;for(let ee=0;ee<=z;ee++)S.emplaceBack(ee*R,W,Y);for(let ee=0;ee<=z;ee++)S.emplaceBack(ee*R,Q,ne);for(let ee=0;ee<z;ee++)A.emplaceBack(X+ee,U+ee,U+ee+1),A.emplaceBack(X+ee,U+ee+1,X+ee+1),A.emplaceBack(0+ee,F+ee+1,F+ee),A.emplaceBack(0+ee,0+ee+1,F+ee+1);const K=S.length,ae=K+2*(z+1);for(const ee of[0,1])for(let de=0;de<=z;de++)for(const Me of[0,1])S.emplaceBack(ee*d.a5,de*R,Me);for(let ee=0;ee<2*z;ee+=2)A.emplaceBack(K+ee,K+ee+1,K+ee+3),A.emplaceBack(K+ee,K+ee+3,K+ee+2),A.emplaceBack(ae+ee,ae+ee+3,ae+ee+1),A.emplaceBack(ae+ee,ae+ee+2,ae+ee+3);const le=new Bi(w.createVertexBuffer(S,zt.members),w.createIndexBuffer(A),d.aY.simpleSegment(0,0,S.length,A.length));return this._meshCache[v]=le,le}getMeshFrameDelta(t){return 2*Math.PI*d.bF/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var l;if(!d.cE(a,t.wrap()))return 0;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,l={minElevation:null,maxElevation:null};return a&&a.dem&&(l.minElevation=a.dem.min*this.exaggeration,l.maxElevation=a.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(t,a){const l=d.ab.fromLngLat(t.wrap()),h=(1<<a)*d.a5,_=l.x*h,v=l.y*h,w=Math.floor(_/d.a5),S=Math.floor(v/d.a5);return{tileID:new d.a2(a,0,a,w,S),mercatorX:_,mercatorY:v}}}class Ho{constructor(t,a,l){this._context=t,this._size=a,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new d.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(l.texture),{id:t,fbo:a,texture:l,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const la={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Is{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new Ho(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((l=>!t._layers[l].isHidden(a))),this._coordsAscending={};for(const l in t.tileManagers){this._coordsAscending[l]={};const h=t.tileManagers[l].getVisibleCoordinates(),_=t.tileManagers[l].getSource(),v=_ instanceof Fr?_.terrainTileRanges:null;for(const w of h){const S=this.terrain.tileManager.getTerrainCoords(w,v);for(const A in S)this._coordsAscending[l][A]||(this._coordsAscending[l][A]=[]),this._coordsAscending[l][A].push(S[A])}}this._coordsAscendingStr={};for(const l of t._order){const h=t._layers[l],_=h.source;if(la[h.type]&&!this._coordsAscendingStr[_]){this._coordsAscendingStr[_]={};for(const v in this._coordsAscending[_])this._coordsAscendingStr[_][v]=this._coordsAscending[_][v].map((w=>w.key)).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const _=this._coordsAscendingStr[h][l.tileID.key];_&&_!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),h=t.type,_=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(la[h]&&(this._prevType&&la[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(t.id),!v))return!0;if(la[this._prevType]||la[h]&&v){this._prevType=h;const w=this._stacks.length-1,S=this._stacks[w]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(Sc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[w]){const R=this.pool.getObjectForId(A.rtt[w].id);if(R.stamp===A.rtt[w].stamp){this.pool.useObject(R);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),A.rtt[w]={id:z.id,stamp:z.stamp},_.context.bindFramebuffer.set(z.fbo.framebuffer),_.context.clear({color:d.bq.transparent,stencil:0}),_.currentStencilSource=void 0;for(let R=0;R<S.length;R++){const P=_.style._layers[S[R]],F=P.source?this._coordsAscending[P.source][A.tileID.key]:[A.tileID];_.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),_._renderTileClippingMasks(P,F,!0),_.renderLayer(_,_.style.tileManagers[P.source],P,F,l),P.source&&(A.rttCoords[P.source]=this._coordsAscendingStr[P.source][A.tileID.key])}}return Sc(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),la[h]}return!1}}const Fl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ps=ge,Rs={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Gr,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},zh={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class sn{constructor(t,a,l=!1){this.mousedown=_=>{this.startMove(_,me.mousePos(this.element,_)),me.addEventListener(window,"mousemove",this.mousemove),me.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=_=>{this.move(_,me.mousePos(this.element,_))},this.mouseup=_=>{this._rotatePitchHandler.dragEnd(_),this.offTemp()},this.touchstart=_=>{_.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=me.touchPos(this.element,_.targetTouches)[0],this.startMove(_,this._startPos),me.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.addEventListener(window,"touchend",this.touchend))},this.touchmove=_=>{_.targetTouches.length!==1?this.reset():(this._lastPos=me.touchPos(this.element,_.targetTouches)[0],this.move(_,this._lastPos))},this.touchend=_=>{_.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const h=new Ou;this._rotatePitchHandler=new oa({clickTolerance:3,move:(_,v)=>{const w=a.getBoundingClientRect(),S=new d.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:d.cy(new d.P(_.x,v.y),v,S),pitchDelta:l?-.5*(v.y-_.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=t,me.addEventListener(a,"mousedown",this.mousedown),me.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),me.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),me.disableDrag()}move(t,a){const l=this.map,{bearingDelta:h,pitchDelta:_}=this._rotatePitchHandler.dragMove(t,a)||{};h&&l.setBearing(l.getBearing()+h),_&&l.setPitch(l.getPitch()+_)}off(){const t=this.element;me.removeEventListener(t,"mousedown",this.mousedown),me.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),me.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.removeEventListener(window,"touchend",this.touchend),me.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){me.enableDrag(),me.removeEventListener(window,"mousemove",this.mousemove),me.removeEventListener(window,"mouseup",this.mouseup),me.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),me.removeEventListener(window,"touchend",this.touchend)}}let ka;function Nl(m,t,a,l=!1){if(l||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return m?.wrap();const h=new d.V(m.lng,m.lat);if(m=new d.V(m.lng,m.lat),t){const _=new d.V(m.lng-360,m.lat),v=new d.V(m.lng+360,m.lat),w=a.locationToScreenPoint(m).distSqr(t);a.locationToScreenPoint(_).distSqr(t)<w?m=_:a.locationToScreenPoint(v).distSqr(t)<w&&(m=v)}for(;Math.abs(m.lng-a.center.lng)>180;){const _=a.locationToScreenPoint(m);if(_.x>=0&&_.y>=0&&_.x<=a.width&&_.y<=a.height)break;m.lng>a.center.lng?m.lng-=360:m.lng+=360}return m.lng!==h.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(m))?m:h}const jl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ju(m,t,a){const l=m.classList;for(const h in jl)l.remove(`maplibregl-${a}-anchor-${h}`);l.add(`maplibregl-${a}-anchor-${t}`)}class Vu extends d.E{constructor(t){if(super(),this._onKeyPress=a=>{const l=a.code,h=a.charCode||a.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=a=>{const l=a.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=Nl(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let _="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?_="rotateX(0deg)":this._pitchAlignment==="map"&&(_=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),me.setTransform(this._element,`${jl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${_} ${h}`),kt.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.l("dragstart"))),this.fire(new d.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=d.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=me.create("div");const a=me.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${l}px`),a.setAttributeNS(null,"width",`${h}px`),a.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const _=me.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const v=me.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=me.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of S){const Q=me.createNS("http://www.w3.org/2000/svg","ellipse");Q.setAttributeNS(null,"opacity","0.04"),Q.setAttributeNS(null,"cx","10.5"),Q.setAttributeNS(null,"cy","5.80029008"),Q.setAttributeNS(null,"rx",Y.rx),Q.setAttributeNS(null,"ry",Y.ry),w.appendChild(Q)}const A=me.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const z=me.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(z);const R=me.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const P=me.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(P);const F=me.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");const U=me.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const X=me.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#000000"),X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962");const W=me.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#FFFFFF"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962"),U.appendChild(X),U.appendChild(W),v.appendChild(w),v.appendChild(A),v.appendChild(R),v.appendChild(F),v.appendChild(U),a.appendChild(v),a.setAttributeNS(null,"height",l*this._scale+"px"),a.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(a),this._offset=d.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),ju(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),me.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=d.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const h=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,l;const h=(a=this._map)===null||a===void 0?void 0:a.terrain,_=this._map.transform.isLocationOccluded(this._lngLat);if(!h||_){const F=_?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==F&&(this._element.style.opacity=F))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const v=this._map,w=v.terrain.depthAtPoint(this._pos),S=v.terrain.getElevationForLngLat(this._lngLat);if(v.transform.lngLatToCameraDepth(this._lngLat,S)-w<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/v.transform.pixelsPerMeter,z=Math.sin(v.getPitch()*Math.PI/180)*A,R=v.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),P=v.transform.lngLatToCameraDepth(this._lngLat,S+z)-R>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&P&&this._popup.remove(),this._element.style.opacity=P?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=d.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Uu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ls=0,Bs=!1;const hr={maxWidth:100,unit:"metric"};function Wi(m,t,a){const l=a&&a.maxWidth||100,h=m._container.clientHeight/2,_=m._container.clientWidth/2,v=m.unproject([_-l/2,h]),w=m.unproject([_+l/2,h]),S=Math.round(m.project(w).x-m.project(v).x),A=Math.min(l,S,m._container.clientWidth),z=v.distanceTo(w);if(a&&a.unit==="imperial"){const R=3.2808*z;R>5280?hs(t,A,R/5280,m._getUIString("ScaleControl.Miles")):hs(t,A,R,m._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?hs(t,A,z/1852,m._getUIString("ScaleControl.NauticalMiles")):z>=1e3?hs(t,A,z/1e3,m._getUIString("ScaleControl.Kilometers")):hs(t,A,z,m._getUIString("ScaleControl.Meters"))}function hs(m,t,a,l){const h=(function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let w=_/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:(function(S){const A=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*A)/A})(w),v*w})(a);m.style.width=t*(h/a)+"px",m.innerHTML=`${h}&nbsp;${l}`}const $o={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Vl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ul(m){if(m){if(typeof m=="number"){const t=Math.round(Math.abs(m)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,m),"top-left":new d.P(t,t),"top-right":new d.P(-t,t),bottom:new d.P(0,-m),"bottom-left":new d.P(t,-t),"bottom-right":new d.P(-t,-t),left:new d.P(m,0),right:new d.P(-m,0)}}if(m instanceof d.P||Array.isArray(m)){const t=d.P.convert(m);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:d.P.convert(m.center||[0,0]),top:d.P.convert(m.top||[0,0]),"top-left":d.P.convert(m["top-left"]||[0,0]),"top-right":d.P.convert(m["top-right"]||[0,0]),bottom:d.P.convert(m.bottom||[0,0]),"bottom-left":d.P.convert(m["bottom-left"]||[0,0]),"bottom-right":d.P.convert(m["bottom-right"]||[0,0]),left:d.P.convert(m.left||[0,0]),right:d.P.convert(m.right||[0,0])}}return Ul(new d.P(0,0))}const Oa=ge;k.AJAXError=d.cJ,k.Event=d.l,k.Evented=d.E,k.LngLat=d.V,k.MercatorCoordinate=d.ab,k.Point=d.P,k.addProtocol=d.cK,k.config=d.c,k.removeProtocol=d.cL,k.AttributionControl=Mn,k.BoxZoomHandler=Lu,k.CanvasSource=V,k.CooperativeGesturesHandler=Pr,k.DoubleClickZoomHandler=Ah,k.DragPanHandler=Tt,k.DragRotateHandler=Pt,k.EdgeInsets=Jr,k.FullscreenControl=class extends d.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){me.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const m=this._fullscreenButton=me.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);me.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},k.GeoJSONSource=er,k.GeolocateControl=class extends d.E{constructor(m){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new d.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new d.V(t.coords.longitude,t.coords.latitude),l=t.coords.accuracy,h=this._map.getBearing(),_=d.e({bearing:h},this.options.fitBoundsOptions),v=fn.fromLngLat(a,l);this._map.fitBounds(v,_,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new d.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&Bs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=me.create("button","maplibregl-ctrl-geolocate",this._container),me.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=me.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Vu({element:this._dotElement}),this._circleElement=me.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Vu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const l=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||l||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.l("trackuserlocationend")),this.fire(new d.l("userlocationlostfocus")))}))}},this.options=d.e({},Uu,m)}onAdd(m){return this._map=m,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return d._(this,arguments,void 0,(function*(t=!1){if(ka!==void 0&&!t)return ka;if(window.navigator.permissions===void 0)return ka=!!window.navigator.geolocation,ka;try{ka=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ka=!!window.navigator.geolocation}return ka}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),me.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,Ls=0,Bs=!1}_isOutOfMapMaxBounds(m){const t=this._map.getMaxBounds(),a=m.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const m=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&m))return;const t=this._map.project(m),a=this._map.unproject([t.x+100,t.y]),l=m.distanceTo(a)/100,h=2*this._accuracy/l;this._circleElement.style.width=`${h.toFixed(2)}px`,this._circleElement.style.height=`${h.toFixed(2)}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ls--,Bs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.l("trackuserlocationstart")),this.fire(new d.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ls++,Ls>1?(m={maximumAge:6e5,timeout:0},Bs=!0):(m=this.options.positionOptions,Bs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},k.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;const t=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=me.create("button","maplibregl-ctrl-globe",this._container),me.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){me.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},k.Hash=rn,k.ImageSource=Fr,k.KeyboardHandler=Go,k.LngLatBounds=fn,k.LogoControl=Ds,k.Map=class extends _o{constructor(m){var t,a;d.cH.mark(d.cI.create);const l=Object.assign(Object.assign(Object.assign({},Rs),m),{canvasContextAttributes:Object.assign(Object.assign({},Rs.canvasContextAttributes),m.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new Bn,_=new Io;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),l.transformConstrain!==null&&h.setConstrainOverride(l.transformConstrain),super(h,_,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new vi,this._controls=[],this._mapId=d.ah(),this._lostContextStyle={style:null,images:null},this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const S of Object.values(this.style._layers))if(S.type==="custom"&&console.warn(`Custom layer with id '${S.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),S._listeners)for(const[A]of Object.entries(S._listeners))console.warn(`Custom layer with id '${S.id}' had event listeners for event '${A}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new d.l("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new d.l("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Fl),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this._zoomLevelsToOverscale=l.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=l.transformCameraUpdate,this.transformConstrain=l.transformConstrain,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,l.reduceMotion!==void 0&&(kt.prefersReducedMotion=l.reduceMotion),this._imageQueueHandle=bt.addThrottleControl((()=>this.isMoving())),this._requestManager=new li(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1;const S=Mh((A=>{this._trackResize&&!this._removed&&(this.resize(A),this.redraw())}),50);this._resizeObserver=new ResizeObserver((A=>{w?S(A):w=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Ch(this,l),this._hash=l.hash&&new rn(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,d.e({},l.fitBoundsOptions,{duration:0}))));const v=typeof l.style=="string"||((a=(t=l.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new Mn(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Ds,l.logoPosition),this.on("style.load",(()=>{if(v||this._resizeTransform(),this.transform.unmodified){const w=d.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}})),this.on("data",(w=>{this._update(w.dataType==="style"),this.fire(new d.l(`${w.dataType}data`,w))})),this.on("dataloading",(w=>{this.fire(new d.l(`${w.dataType}dataloading`,w))})),this.on("dataabort",(w=>{this.fire(new d.l("sourcedataabort",w))}))}_getMapId(){return this._mapId}setGlobalStateProperty(m,t){return this.style.setGlobalStateProperty(m,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(m,t){if(t===void 0&&(t=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new d.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=m.onAdd(this);this._controls.push(m);const l=this._controlPositions[t];return t.indexOf("bottom")!==-1?l.insertBefore(a,l.firstChild):l.appendChild(a),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new d.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(m);return t>-1&&this._controls.splice(t,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}coveringTiles(m){return wn(this.transform,m)}calculateCameraOptionsFromTo(m,t,a,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLat(a)),super.calculateCameraOptionsFromTo(m,t,a,l)}resize(m,t=!0){const[a,l]=this._containerDimensions(),h=this._getClampedPixelRatio(a,l);if(this._resizeCanvas(a,l,h),this.painter.resize(a,l,h),this.painter.overLimit()){const v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];const w=this._getClampedPixelRatio(a,l);this._resizeCanvas(a,l,w),this.painter.resize(a,l,w)}this._resizeTransform(t);const _=!this._moving;return _&&(this.stop(),this.fire(new d.l("movestart",m)).fire(new d.l("move",m))),this.fire(new d.l("resize",m)),_&&this.fire(new d.l("moveend",m)),this}_resizeTransform(m=!0){var t;const[a,l]=this._containerDimensions();this.transform.resize(a,l,m),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,l,m)}_getClampedPixelRatio(m,t){const{0:a,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),_=m*h,v=t*h;return Math.min(_>a?a/_:1,v>l?l/v:1)*h}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(fn.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}setTransformConstrain(m){return this.transform.setConstrainOverride(m),this._update()}project(m){return this.transform.locationToScreenPoint(d.V.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(d.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,t,a){if(m==="mouseenter"||m==="mouseover"){let l=!1;return{layers:t,listener:a,delegates:{mousemove:_=>{const v=t.filter((S=>this.getLayer(S))),w=v.length!==0?this.queryRenderedFeatures(_.point,{layers:v}):[];w.length?l||(l=!0,a.call(this,new Ur(m,this,_.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(m==="mouseleave"||m==="mouseout"){let l=!1;return{layers:t,listener:a,delegates:{mousemove:v=>{const w=t.filter((S=>this.getLayer(S)));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?l=!0:l&&(l=!1,a.call(this,new Ur(m,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,a.call(this,new Ur(m,this,v.originalEvent)))}}}}{const l=h=>{const _=t.filter((w=>this.getLayer(w))),v=_.length!==0?this.queryRenderedFeatures(h.point,{layers:_}):[];v.length&&(h.features=v,a.call(this,h),delete h.features)};return{layers:t,listener:a,delegates:{[m]:l}}}}_saveDelegatedListener(m,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(t)}_removeDelegatedListener(m,t,a){if(!this._delegatedListeners||!this._delegatedListeners[m])return;const l=this._delegatedListeners[m];for(let h=0;h<l.length;h++){const _=l[h];if(_.listener===a&&_.layers.length===t.length&&_.layers.every((v=>t.includes(v)))){for(const v in _.delegates)this.off(v,_.delegates[v]);return void l.splice(h,1)}}}on(m,t,a){if(a===void 0)return super.on(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,a);this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.on(_,h.delegates[_]);return{unsubscribe:()=>{this._removeDelegatedListener(m,l,a)}}}once(m,t,a){if(a===void 0)return super.once(m,t);const l=typeof t=="string"?[t]:t,h=this._createDelegatedListener(m,l,a);for(const _ in h.delegates){const v=h.delegates[_];h.delegates[_]=(...w)=>{this._removeDelegatedListener(m,l,a),v(...w)}}this._saveDelegatedListener(m,h);for(const _ in h.delegates)this.once(_,h.delegates[_]);return this}off(m,t,a){return a===void 0?super.off(m,t):(this._removeDelegatedListener(m,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(m,t){if(!this.style)return[];let a;const l=m instanceof d.P||Array.isArray(m),h=l?m:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(l?{}:m)||{},h instanceof d.P||typeof h[0]=="number")a=[d.P.convert(h)];else{const _=d.P.convert(h[0]),v=d.P.convert(h[1]);a=[_,new d.P(v.x,_.y),v,new d.P(_.x,v.y),_]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(m,t){return this.style.querySourceFeatures(m,t)}setStyle(m,t){return(t=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(m,t))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){const t=this._locale[m];if(t==null)throw new Error(`Missing UI string '${m}'`);return t}_updateStyle(m,t){var a,l;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(m,t)));const h=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Js(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,t,h):this.style.loadJSON(m,t,h),this):((l=(a=this.style)===null||a===void 0?void 0:a.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Js(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,t){if(typeof m=="string"){const a=this._requestManager.transformRequest(m,"Style");d.j(a,new AbortController).then((l=>{this._updateDiff(l.data,t)})).catch((l=>{l&&this.fire(new d.k(l))}))}else typeof m=="object"&&this._updateDiff(m,t)}_updateDiff(m,t){try{this.style.setState(m,t)&&this._update(!0)}catch(a){d.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(m,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(m,t){return this._lazyInitEmptyStyle(),this.style.addSource(m,t),this._update(!0)}isSourceLoaded(m){const t=this.style&&this.style.tileManagers[m];if(t!==void 0)return t.loaded();this.fire(new d.k(new Error(`There is no tile manager with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){const t=this.style.tileManagers[m.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const l=this.style._layers[a];l.type==="hillshade"&&l.source===m.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===m.source&&d.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new an(this.painter,t,m),this.painter.renderToTexture=new Is(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var l;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=a.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new d.l("terrain",{terrain:m})),this}getTerrain(){var m,t;return(t=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const m=this.style&&this.style.tileManagers;for(const t of Object.values(m))if(!t.areTilesLoaded())return!1;return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}setSourceTileLodParams(m,t,a){if(a){const l=this.getSource(a);if(!l)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);l.calculateTileZoom=Si(Math.max(1,m),Math.max(1,t))}else for(const l in this.style.tileManagers)this.style.tileManagers[l].getSource().calculateTileZoom=Si(Math.max(1,m),Math.max(1,t));return this._update(!0),this}refreshTiles(m,t){const a=this.style.tileManagers[m];if(!a)throw new Error(`There is no tile manager with ID "${m}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((l=>new d.ae(l.z,l.x,l.y))))}addImage(m,t,a={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:_,stretchY:v,content:w,textFitWidth:S,textFitHeight:A}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||d.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:R,data:P}=t,F=t;return this.style.addImage(m,{data:new d.R({width:z,height:R},new Uint8Array(P)),pixelRatio:l,stretchX:_,stretchY:v,content:w,textFitWidth:S,textFitHeight:A,sdf:h,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m),this}}{const{width:z,height:R,data:P}=kt.getImageData(t);this.style.addImage(m,{data:new d.R({width:z,height:R},P),pixelRatio:l,stretchX:_,stretchY:v,content:w,textFitWidth:S,textFitHeight:A,sdf:h,version:0})}}updateImage(m,t){const a=this.style.getImage(m);if(!a)return this.fire(new d.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=t instanceof HTMLImageElement||d.b(t)?kt.getImageData(t):t,{width:h,height:_,data:v}=l;if(h===void 0||_===void 0)return this.fire(new d.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==a.data.width||_!==a.data.height)return this.fire(new d.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||d.b(t));return a.data.replace(v,w),this.style.updateImage(m,a),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new d.k(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return bt.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,t){return this._lazyInitEmptyStyle(),this.style.addLayer(m,t),this._update(!0)}moveLayer(m,t){return this.style.moveLayer(m,t),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,t,a){return this.style.setLayerZoomRange(m,t,a),this._update(!0)}setFilter(m,t,a={}){return this.style.setFilter(m,t,a),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,t,a,l={}){return this.style.setPaintProperty(m,t,a,l),this._update(!0)}getPaintProperty(m,t){return this.style.getPaintProperty(m,t)}setLayoutProperty(m,t,a,l={}){return this.style.setLayoutProperty(m,t,a,l),this._update(!0)}getLayoutProperty(m,t){return this.style.getLayoutProperty(m,t)}setGlyphs(m,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,t,a,(l=>{l||this._update(!0)})),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,t,(a=>{a||this._update(!0)})),this}setLight(m,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,t){return this.style.setFeatureState(m,t),this._update()}removeFeatureState(m,t){return this.style.removeFeatureState(m,t),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,t=0;return this._container&&(m=this._container.clientWidth||400,t=this._container.clientHeight||300),[m,t]}_setupContainer(){const m=this._container;m.classList.add("maplibregl-map");const t=this._canvasContainer=me.create("div","maplibregl-canvas-container",m);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=me.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),l=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],l);const h=this._controlContainer=me.create("div","maplibregl-control-container",m),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((v=>{_[v]=me.create("div",`maplibregl-ctrl-${v} `,h)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,t,a){this._canvas.width=Math.floor(a*m),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(l=>{t={requestedAttributes:m},l&&(t.statusMessage=l.statusMessage,t.type=l.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!a){const l="Failed to initialize WebGL";throw t?(t.message=l,new Error(JSON.stringify(t))):new Error(l)}this.painter=new Ld(a,this.transform),$t.testSupport(a)}migrateProjection(m,t){super.migrateProjection(m,t),this.painter.transform=m,this.fire(new d.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var t,a,l,h,_;const v=this._idleTriggered?this._fadeDuration:0,w=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let S=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,P=xt();this.style.zoomHistory.update(R,P);const F=new d.H(R,{now:P,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=F.crossFadingFactor();U===1&&U===this._crossFadingFactor||(S=!0,this._crossFadingFactor=U),this.style.update(F)}const A=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==w;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(_=this.style.projection)===null||_===void 0?void 0:_.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||A)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,A),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new d.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.cH.mark(d.cI.load),this.fire(new d.l("load"))),this.style&&(this.style.hasTransitions()||S)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,d.cH.mark(d.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),bt.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),me.remove(this._canvasContainer),me.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),d.cH.clearMetrics(),this._removed=!0,this.fire(new d.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,kt.frame(this._frameRequest,(m=>{d.cH.frame(m),this._frameRequest=null;try{this._render(m)}catch(t){if(!d.Z(t)&&!(function(a){return a.message===oo})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return Ps}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},k.MapMouseEvent=Ur,k.MapTouchEvent=La,k.MapWheelEvent=Ru,k.Marker=Vu,k.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),l=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const l=this._map._getUIString(`NavigationControl.${a}`);t.title=l,t.setAttribute("aria-label",l)},this.options=d.e({},zh,m),this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),me.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),me.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=me.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new sn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){me.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,t){const a=me.create("button",m,this._container);return a.type="button",a.addEventListener("click",t),a}},k.Popup=class extends d.E{constructor(m){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&me.remove(this._content),this._container&&(me.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=me.create("div","maplibregl-popup",this._map.getContainer()),this._tip=me.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const v of this.options.className.split(" "))this._container.classList.add(v);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Nl(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=Ul(this.options.offset);if(!l){const v=this._container.offsetWidth,w=this._container.offsetHeight;let S;S=a.y+h.bottom.y<w?["top"]:a.y>this._map.transform.height-w?["bottom"]:[],a.x<v/2?S.push("left"):a.x>this._map.transform.width-v/2&&S.push("right"),l=S.length===0?"bottom":S.join("-")}let _=a.add(h[l]);this.options.subpixelPositioning||(_=_.round()),me.setTransform(this._container,`${jl[l]} translate(${_.x}px,${_.y}px)`),ju(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=d.e(Object.create($o),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=d.V.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const t=document.createDocumentFragment(),a=document.createElement("body");let l;for(a.innerHTML=m;l=a.firstChild,l;)t.appendChild(l);return this.setDOMContent(t)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=me.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=me.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(Vl);m&&m.focus()}},k.RasterDEMTileSource=Ha,k.RasterTileSource=Zs,k.ScaleControl=class{constructor(m){this._onMove=()=>{Wi(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Wi(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},hr),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){me.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},k.ScrollZoomHandler=Dc,k.Style=Js,k.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=me.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=me.create("button","maplibregl-ctrl-terrain",this._container),me.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){me.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},k.TwoFingersTouchPitchHandler=zs,k.TwoFingersTouchRotateHandler=Ba,k.TwoFingersTouchZoomHandler=Cs,k.TwoFingersTouchZoomRotateHandler=go,k.VectorTileSource=_s,k.VideoSource=ve,k.addSourceType=(m,t)=>d._(void 0,void 0,void 0,(function*(){if(H(m))throw new Error(`A source type called "${m}" already exists.`);((a,l)=>{j[a]=l})(m,t)})),k.clearPrewarmedResources=function(){const m=Et;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Qe),Et=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},k.createTileMesh=bd,k.getMaxParallelImageRequests=function(){return d.c.MAX_PARALLEL_IMAGE_REQUESTS},k.getRTLTextPluginStatus=function(){return _e().getRTLTextPluginStatus()},k.getVersion=function(){return Oa},k.getWorkerCount=function(){return ht.workerCount},k.getWorkerUrl=function(){return d.c.WORKER_URL},k.importScriptInWorkers=function(m){return qs().broadcast("IS",m)},k.isTimeFrozen=function(){return Ht.isFrozen()},k.now=xt,k.prewarm=function(){wi().acquire(Qe)},k.restoreNow=function(){Ht.restoreNow()},k.setMaxParallelImageRequests=function(m){d.c.MAX_PARALLEL_IMAGE_REQUESTS=m},k.setNow=function(m){Ht.setNow(m)},k.setRTLTextPlugin=function(m,t){return _e().setRTLTextPlugin(m,t)},k.setWorkerCount=function(m){ht.workerCount=m},k.setWorkerUrl=function(m){d.c.WORKER_URL=m}}));var yt=Xe;return yt}))})(Bm)),Bm.exports}var D_=z_();const vg=h_(D_);function I_(fe,ot={}){const Xe=Yg(fe),oe=(Xe[0]+Xe[2])/2,rt=(Xe[1]+Xe[3])/2;return w_([oe,rt],ot.properties,ot)}var P_=I_;const R_="pk.eyJ1Ijoib3BlbmFlcmlhbG1hcCIsImEiOiJjbWowaThzc2swOTVtM2NxMXA2Y2J3bDdzIn0.gmFG84efi2_zK6Yx5ot_5Q";function Qg({features:fe,selectedFeature:ot,onMapInit:Xe,searchBbox:oe,onSearchArea:rt,onSelect:yt,layerMode:k,setLayerMode:d,previewedIds:ge,hiddenIds:Be,basemap:ut}){const mt=Ot.useRef(null),Ke=Ot.useRef(null),kt=Ot.useRef(null),Ht=Ot.useRef(null),xt=Ot.useRef(!1),me=Ot.useRef(rt),$t=Ot.useRef(yt),jt=Ot.useRef(ot),[dt,Dt]=Ot.useState(!1),[Yt,It]=Ot.useState(0),[bt,li]=Ot.useState("");Ot.useEffect(()=>{$t.current=yt},[yt]),Ot.useEffect(()=>{jt.current=ot},[ot]),Ot.useEffect(()=>{me.current=rt},[rt]);const{largeFeatures:Vi,smallFeatures:cn}=Ot.useMemo(()=>{const Re=fe.filter(ie=>ie.properties.is_large),tt=fe.filter(ie=>!ie.properties.is_large);return{largeFeatures:Re,smallFeatures:tt}},[fe]),hn=(Re,tt)=>Math.floor((Re+180)/360*Math.pow(2,tt)),Mi=(Re,tt)=>Math.floor((1-Math.log(Math.tan(Re*Math.PI/180)+1/Math.cos(Re*Math.PI/180))/Math.PI)/2*Math.pow(2,tt)),dn=(Re,tt)=>Re/Math.pow(2,tt)*360-180,Kn=(Re,tt)=>{const ie=Math.PI-2*Math.PI*Re/Math.pow(2,tt);return 180/Math.PI*Math.atan(.5*(Math.exp(ie)-Math.exp(-ie)))},Hi=(Re,tt,ie)=>{const Ae=dn(Re,ie),it=dn(Re+1,ie),Qe=Kn(tt,ie),ht=Kn(tt+1,ie);return T_([[[Ae,Qe],[it,Qe],[it,ht],[Ae,ht],[Ae,Qe]]],{x:Re,y:tt,z:ie})},Ve=()=>{const Re=new URLSearchParams(window.location.search),tt=parseFloat(Re.get("lat")),ie=parseFloat(Re.get("lon")),Ae=parseFloat(Re.get("zoom"));return!isNaN(tt)&&!isNaN(ie)&&!isNaN(Ae)?{center:[ie,tt],zoom:Ae}:{center:[0,20],zoom:2}},st=()=>{if(!Ke.current)return;const Re=Ke.current.getCenter(),tt=Ke.current.getZoom(),ie=new URLSearchParams(window.location.search);ie.set("lat",Re.lat.toFixed(4)),ie.set("lon",Re.lng.toFixed(4)),ie.set("zoom",tt.toFixed(1));const Ae=`${window.location.pathname}?${ie.toString()}`;window.history.replaceState({},"",Ae)},Lt=Re=>{if(!(!Ke.current||!Ke.current.getSource("oam-grid"))){if(!Re||Re.length===0){Ke.current.getSource("oam-grid").setData({type:"FeatureCollection",features:[]});return}try{const tt=Ke.current.getZoom();let ie;tt<4?ie=3:tt<6?ie=4:tt<8?ie=6:ie=Math.min(10,Math.floor(tt)+1);const Ae=new Qg;for(const Qe of Re)if(Qe.geometry)try{const ht=P_(Qe),ft=ht.geometry.coordinates[0],Et=ht.geometry.coordinates[1],ii=hn(ft,ie),wi=Mi(Et,ie),Jn=`${ii},${wi}`;Ae.set(Jn,(Ae.get(Jn)||0)+1)}catch{}const it=[];for(const[Qe,ht]of Ae){const[ft,Et]=Qe.split(",").map(Number),ii=Hi(ft,Et,ie);ii.properties={count:ht},it.push(ii)}console.log(`Grid: ${it.length} tiles at gridZoom ${ie}, mapZoom ${tt.toFixed(1)}`),Ke.current.getSource("oam-grid").setData({type:"FeatureCollection",features:it})}catch(tt){console.error("Grid update error:",tt)}}};return Ot.useEffect(()=>{if(Ke.current)return;const{center:Re,zoom:tt}=Ve();Ke.current=new vg.Map({container:mt.current,style:{version:8,sources:{"basemap-source":{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap &copy; CARTO"}},layers:[{id:"basemap-layer",type:"raster",source:"basemap-source"}]},center:Re,zoom:tt,attributionControl:!1}),Xe&&Xe(Ke.current),Ke.current.addControl(new vg.AttributionControl,"bottom-right"),Ke.current.on("load",()=>{Dt(!0),st(),Ke.current.addSource("oam-imagery",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),Ke.current.addSource("oam-large-imagery",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),Ke.current.addSource("oam-small-imagery",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),Ke.current.addSource("oam-grid",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),Ke.current.addLayer({id:"grid-fill",type:"fill",source:"oam-grid",maxzoom:10,paint:{"fill-color":["interpolate",["linear"],["get","count"],1,"#cceeff",5,"#66b3ff",20,"#0066cc",50,"#003366"],"fill-opacity":.65}}),Ke.current.addLayer({id:"grid-count",type:"symbol",source:"oam-grid",maxzoom:10,filter:[">",["get","count"],0],layout:{"text-field":"{count}","text-size":12,"text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-allow-overlap":!1},paint:{"text-color":"#003366","text-halo-color":"#ffffff","text-halo-width":2}}),Ke.current.addLayer({id:"oam-large-fill",type:"fill",source:"oam-large-imagery",minzoom:8,maxzoom:22,paint:{"fill-color":"#00E5FF","fill-opacity":.1}}),Ke.current.addLayer({id:"oam-large-line",type:"line",source:"oam-large-imagery",minzoom:8,maxzoom:22,paint:{"line-color":"#00B0FF","line-width":2,"line-opacity":.8}}),Ke.current.addLayer({id:"oam-small-fill",type:"fill",source:"oam-small-imagery",minzoom:10,maxzoom:22,paint:{"fill-color":"#00E5FF","fill-opacity":.1}}),Ke.current.addLayer({id:"oam-small-line",type:"line",source:"oam-small-imagery",minzoom:10,maxzoom:22,paint:{"line-color":"#00B0FF","line-width":2,"line-opacity":.8}}),Ke.current.addLayer({id:"oam-highlight",type:"line",source:"oam-imagery",filter:["==","id",""],paint:{"line-color":"#FF0000","line-width":3}}),Ke.current.on("click",["oam-large-fill","oam-small-fill"],Ae=>{if(Ae.features&&Ae.features.length>0){xt.current=!0;const it={type:"Feature",geometry:Ae.features[0].geometry,properties:Ae.features[0].properties};$t.current&&$t.current(it)}}),Ke.current.on("click","grid-fill",Ae=>{if(Ae.features[0].properties.count>0){const it=Lm(Ae.features[0]);Ke.current.fitBounds(it,{padding:20})}}),Ke.current.on("click",Ae=>{Ke.current.queryRenderedFeatures(Ae.point,{layers:["oam-large-fill","oam-small-fill","grid-fill"]}).length===0&&$t.current&&$t.current(null)}),["oam-large-fill","oam-small-fill","grid-fill"].forEach(Ae=>{Ke.current.on("mouseenter",Ae,()=>{Ke.current.getCanvas().style.cursor="pointer"}),Ke.current.on("mouseleave",Ae,()=>{Ke.current.getCanvas().style.cursor=""})}),Ke.current.on("movestart",()=>{kt.current&&clearTimeout(kt.current)}),Ke.current.on("moveend",()=>{st(),Ht.current&&clearTimeout(Ht.current),Ht.current=setTimeout(()=>{It(Qe=>Qe+1)},300);const Ae=Ke.current.getZoom(),it=jt.current;if(it){const Qe=it.properties.is_large;(!Qe&&Ae<10||Qe&&Ae<8)&&$t.current&&$t.current(null)}if(xt.current){xt.current=!1;return}kt.current=setTimeout(()=>{if(!Ke.current)return;const Qe=Ke.current.getBounds(),ht=Ke.current.getCenter(),ft=Ke.current.getZoom(),Et=[Qe.getWest(),Qe.getSouth(),Qe.getEast(),Qe.getNorth()];me.current&&me.current(Et,[ht.lng,ht.lat],[Qe.getWest(),Qe.getSouth(),Qe.getEast(),Qe.getNorth()],ft)},1500)})})},[]),Ot.useEffect(()=>{!Ke.current||!dt||!Ke.current.getSource("oam-imagery")||(Ke.current.getSource("oam-imagery").setData(gg(fe)),Ke.current.getSource("oam-large-imagery")&&Ke.current.getSource("oam-large-imagery").setData(gg(Vi)),Ke.current.getSource("oam-small-imagery")&&Ke.current.getSource("oam-small-imagery").setData(gg(cn)),Lt(fe))},[fe,dt,Yt,Vi,cn]),Ot.useEffect(()=>{if(!(!Ke.current||!dt||!oe))try{xt.current=!0,Ke.current.fitBounds(oe,{padding:50,maxZoom:14})}catch{}},[oe,dt]),Ot.useEffect(()=>{if(!Ke.current||!dt)return;let Re=[];ut==="carto"?Re=["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"]:ut==="hot"?Re=["https://a.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png"]:ut==="satellite"&&(Re=[`https://api.mapbox.com/v4/mapbox.satellite/{z}/{x}/{y}@2x.png?access_token=${R_}`]);const tt=Ke.current.getSource("basemap-source");tt&&tt.setTiles(Re)},[ut,dt]),Ot.useEffect(()=>{if(!Ke.current||!dt)return;const Re=Ke.current;if(Re.getLayer("selected-thumbnail")&&Re.removeLayer("selected-thumbnail"),Re.getSource("selected-thumbnail-source")&&Re.removeSource("selected-thumbnail-source"),!ot){Re.setFilter("oam-highlight",["==","id",""]);return}const tt=ot.properties.id,ie=ot.properties.thumbnail;Re.setFilter("oam-highlight",["==","id",tt]);try{const Ae=Lm(ot);if(xt.current||Re.fitBounds(Ae,{padding:50,maxZoom:18,duration:1500}),ie){const it=`https://corsproxy.io/?${encodeURIComponent(ie)}`,Qe=[[Ae[0],Ae[3]],[Ae[2],Ae[3]],[Ae[2],Ae[1]],[Ae[0],Ae[1]]];Re.addSource("selected-thumbnail-source",{type:"image",url:it,coordinates:Qe}),Re.addLayer({id:"selected-thumbnail",type:"raster",source:"selected-thumbnail-source",paint:{"raster-opacity":.9,"raster-fade-duration":0}},"oam-highlight")}}catch{}},[ot,dt]),Ot.useEffect(()=>{if(!Ke.current||!dt)return;const Re=Ke.current,tt=new Set,ie=k==="previews",Ae=Re.getZoom();ie?Ae<8?li("Zoom in to see images"):(li(""),fe.forEach(Qe=>{Be.has(Qe.properties.id)||tt.add(Qe.properties.id)})):li(""),ge.forEach(Qe=>tt.add(Qe));const it=Re.getStyle();it&&it.layers&&it.layers.forEach(Qe=>{if(Qe.id.startsWith("preview-")){const ht=Qe.id.replace("preview-","");tt.has(ht)||(Re.removeLayer(Qe.id),Re.getSource(Qe.id)&&Re.removeSource(Qe.id))}}),tt.forEach(Qe=>{const ht=`preview-${Qe}`;if(Re.getLayer(ht))return;const ft=fe.find(Et=>Et.properties.id===Qe);if(ft&&ft.properties.thumbnail)try{const Et=Lm(ft),ii=[[Et[0],Et[3]],[Et[2],Et[3]],[Et[2],Et[1]],[Et[0],Et[1]]],wi=`https://corsproxy.io/?${encodeURIComponent(ft.properties.thumbnail)}`;Re.addSource(ht,{type:"image",url:wi,coordinates:ii}),Re.addLayer({id:ht,type:"raster",source:ht,paint:{"raster-opacity":.9,"raster-fade-duration":0}},"oam-highlight")}catch(Et){console.error("Error adding layer",Qe,Et)}}),Re.getLayer("oam-large-fill")&&(Re.setPaintProperty("oam-large-fill","fill-opacity",.1),Re.setPaintProperty("oam-small-fill","fill-opacity",.1),Re.getLayer("grid-fill")&&(Re.setLayoutProperty("grid-fill","visibility","visible"),Re.setLayoutProperty("grid-count","visibility","visible")))},[k,fe,dt,ge,Be]),Le.jsxs("div",{className:"relative w-full h-full",children:[Le.jsx("div",{ref:mt,className:"w-full h-full"}),Le.jsxs("div",{className:"absolute bottom-8 left-4 z-10 bg-white rounded-md shadow-md border border-gray-200 flex flex-col overflow-hidden",children:[Le.jsx("button",{onClick:()=>d("none"),className:`px-4 py-2 text-xs font-semibold text-left hover:bg-gray-50 border-b border-gray-100 ${k==="none"?"bg-gray-100 text-cyan-700":"text-gray-600"}`,children:"Footprints Only"}),Le.jsx("button",{onClick:()=>d("previews"),className:`px-4 py-2 text-xs font-semibold text-left hover:bg-gray-50 ${k==="previews"?"bg-cyan-50 text-cyan-700":"text-gray-600"}`,children:"Live Previews"})]}),k==="previews"&&bt&&Le.jsx("div",{className:"absolute bottom-8 left-36 z-30 bg-black/80 text-white text-xs px-4 py-2 rounded-full shadow-lg animate-fade-in pointer-events-none whitespace-nowrap",children:bt})]})}function L_({filters:fe,onChange:ot}){const[Xe,oe]=Ot.useState(null),[rt,yt]=Ot.useState(!1),k=Ot.useRef(null);Ot.useEffect(()=>{function Dt(Yt){k.current&&!k.current.contains(Yt.target)&&oe(null)}return document.addEventListener("mousedown",Dt),()=>document.removeEventListener("mousedown",Dt)},[]);const d=(Dt,Yt)=>{ot({...fe,[Dt]:Yt}),oe(null)},ge=new Date().toISOString().split("T")[0],Be=Dt=>{const Yt=new Date;Yt.setDate(Yt.getDate()-Dt);const It=Yt.toISOString().split("T")[0];ot({...fe,dateEnd:ge,dateStart:It}),oe(null)},ut=()=>{const Dt=new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0];ot({...fe,dateEnd:ge,dateStart:Dt}),oe(null)},mt=()=>{ot({...fe,dateStart:"",dateEnd:""}),oe(null)},Ke=Dt=>{if(!fe.dateStart||!fe.dateEnd)return!1;const Yt=new Date;return Yt.setDate(Yt.getDate()-Dt),fe.dateStart===Yt.toISOString().split("T")[0]&&fe.dateEnd===ge},kt=()=>{if(!fe.dateStart)return!1;const Dt=new Date(new Date().getFullYear(),0,1).toISOString().split("T")[0];return fe.dateStart===Dt},Ht=!fe.dateStart&&!fe.dateEnd,xt=()=>({satellite:"Satellite",uav:"Drone",aircraft:"Other"})[fe.platform]||"All Platforms",me=()=>Ht?"Any Date":Ke(7)?"Past Week":Ke(30)?"Past Month":kt()?"This Year":"Custom Date",$t=()=>fe.license?fe.license.includes("BY-SA")?"CC BY-SA 4.0":fe.license.includes("BY-NC")?"CC BY-NC 4.0":fe.license.includes("CC-BY")?"CC BY 4.0":"License":"Any License",jt="px-4 py-2 bg-white rounded-full shadow-md text-sm font-bold text-gray-600 border border-gray-200 hover:bg-gray-50 flex items-center gap-2 transition-all",dt="border-cyan-500 text-cyan-700 bg-cyan-50 ring-2 ring-cyan-100";return Le.jsxs("div",{ref:k,className:"flex flex-wrap gap-3 font-sans",children:[Le.jsxs("div",{className:"relative",children:[Le.jsxs("button",{onClick:()=>oe(Xe==="platform"?null:"platform"),className:`${jt} ${fe.platform?dt:""}`,children:[xt()," ",Le.jsx("span",{className:"text-[10px] text-gray-400",children:""})]}),Xe==="platform"&&Le.jsx("div",{className:"absolute top-full mt-2 left-0 w-48 bg-white rounded-lg shadow-xl border border-gray-100 py-1 overflow-hidden animate-fade-in z-50",children:[{label:"All Platforms",val:""},{label:"Satellite",val:"satellite"},{label:"Drone (UAV)",val:"uav"},{label:"Other / Aircraft",val:"aircraft"}].map(Dt=>Le.jsx("button",{onClick:()=>d("platform",Dt.val),className:`w-full text-left px-4 py-2.5 text-sm hover:bg-gray-50 ${fe.platform===Dt.val?"text-cyan-600 font-bold bg-cyan-50":"text-gray-700"}`,children:Dt.label},Dt.label))})]}),Le.jsxs("div",{className:"relative",children:[Le.jsxs("button",{onClick:()=>oe(Xe==="date"?null:"date"),className:`${jt} ${Ht?"":dt}`,children:[me()," ",Le.jsx("span",{className:"text-[10px] text-gray-400",children:""})]}),Xe==="date"&&Le.jsxs("div",{className:"absolute top-full mt-2 left-0 w-64 bg-white rounded-lg shadow-xl border border-gray-100 p-2 animate-fade-in z-50",children:[Le.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[Le.jsx("button",{onClick:mt,className:`px-3 py-2 rounded text-xs font-medium border ${Ht?"bg-cyan-100 border-cyan-500 text-cyan-800":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:"Any Date"}),Le.jsx("button",{onClick:()=>Be(7),className:`px-3 py-2 rounded text-xs font-medium border ${Ke(7)?"bg-cyan-100 border-cyan-500 text-cyan-800":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:"Past Week"}),Le.jsx("button",{onClick:()=>Be(30),className:`px-3 py-2 rounded text-xs font-medium border ${Ke(30)?"bg-cyan-100 border-cyan-500 text-cyan-800":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:"Past Month"}),Le.jsx("button",{onClick:ut,className:`px-3 py-2 rounded text-xs font-medium border ${kt()?"bg-cyan-100 border-cyan-500 text-cyan-800":"bg-white border-gray-200 text-gray-600 hover:bg-gray-50"}`,children:"This Year"})]}),Le.jsx("button",{onClick:()=>yt(!rt),className:"w-full text-xs text-center text-gray-400 hover:text-cyan-600 underline py-1",children:rt?"Hide Custom":"Custom Range..."}),rt&&Le.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-100 flex gap-1 items-center",children:[Le.jsx("input",{type:"date",max:ge,value:fe.dateStart,onChange:Dt=>d("dateStart",Dt.target.value),className:"w-full text-[10px] border rounded px-1 py-1"}),Le.jsx("span",{className:"text-gray-300",children:"-"}),Le.jsx("input",{type:"date",max:ge,value:fe.dateEnd,onChange:Dt=>d("dateEnd",Dt.target.value),className:"w-full text-[10px] border rounded px-1 py-1"})]})]})]}),Le.jsxs("div",{className:"relative",children:[Le.jsxs("button",{onClick:()=>oe(Xe==="license"?null:"license"),className:`${jt} ${fe.license?dt:""}`,children:[$t()," ",Le.jsx("span",{className:"text-[10px] text-gray-400",children:""})]}),Xe==="license"&&Le.jsx("div",{className:"absolute top-full mt-2 left-0 w-48 bg-white rounded-lg shadow-xl border border-gray-100 py-1 overflow-hidden animate-fade-in z-50",children:[{label:"Any License",val:""},{label:"CC BY 4.0",val:"CC-BY 4.0"},{label:"CC BY-NC 4.0",val:"CC BY-NC 4.0"},{label:"CC BY-SA 4.0",val:"CC BY-SA 4.0"}].map(Dt=>Le.jsx("button",{onClick:()=>d("license",Dt.val),className:`w-full text-left px-4 py-2.5 text-sm hover:bg-gray-50 ${fe.license===Dt.val?"text-cyan-600 font-bold bg-cyan-50":"text-gray-700"}`,children:Dt.label},Dt.label))})]}),(fe.platform||fe.dateStart||fe.license)&&Le.jsx("button",{onClick:()=>ot({dateStart:"",dateEnd:"",platform:"",license:""}),className:"px-3 py-2 bg-white/90 rounded-full text-xs font-bold text-red-500 hover:bg-red-50 border border-transparent hover:border-red-100 shadow-sm transition-all",children:" Clear"})]})}const Rm={Plus:()=>Le.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"}),Minus:()=>Le.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"}),Search:()=>Le.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"}),Layers:()=>Le.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0121 18.382V7.618a1 1 0 01-.447-.894L15 7m0 13V7"})};function B_({mapInstance:fe,onLocationSelect:ot,basemap:Xe,setBasemap:oe,className:rt}){const[yt,k]=Ot.useState(null),[d,ge]=Ot.useState(""),[Be,ut]=Ot.useState(!1),mt=()=>fe?.zoomIn(),Ke=()=>fe?.zoomOut(),kt=dt=>{k(yt===dt?null:dt)},Ht=async dt=>{if(dt.preventDefault(),!!d){ut(!0);try{const Yt=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(d)}`)).json();if(Yt&&Yt.length>0){const It=Yt[0],bt=[parseFloat(It.boundingbox[2]),parseFloat(It.boundingbox[0]),parseFloat(It.boundingbox[3]),parseFloat(It.boundingbox[1])];ot(bt,It.display_name),k(null),ge("")}else alert("Location not found")}catch(Dt){console.error(Dt)}ut(!1)}},xt="w-9 h-9 bg-white border border-gray-200 text-gray-600 hover:text-cyan-600 hover:bg-gray-50 flex items-center justify-center transition-colors shadow-sm relative z-20",me="rounded-t-md",$t="rounded-b-md",jt="border-t-0";return Le.jsxs("div",{className:`flex flex-col font-sans shadow-lg rounded-md ${rt}`,children:[Le.jsxs("div",{className:"relative group",children:[Le.jsx("button",{onClick:()=>kt("search"),className:`${xt} ${me} ${yt==="search"?"text-cyan-600 bg-cyan-50":""}`,title:"Search Location",children:Le.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Le.jsx(Rm.Search,{})})}),yt==="search"&&Le.jsx("div",{className:"absolute left-10 top-0 bg-white p-2 rounded shadow-xl border border-gray-200 w-64 animate-fade-in-right flex gap-1 h-9 items-center z-50",children:Le.jsxs("form",{onSubmit:Ht,className:"flex gap-1 w-full",children:[Le.jsx("input",{autoFocus:!0,type:"text",value:d,onChange:dt=>ge(dt.target.value),placeholder:"City, Country...",className:"flex-1 text-xs border border-gray-300 rounded px-2 py-1 outline-none focus:border-cyan-500"}),Le.jsx("button",{type:"submit",disabled:Be,className:"bg-cyan-500 text-white px-2 py-1 rounded text-xs font-bold hover:bg-cyan-600",children:Be?"..":"Go"})]})})]}),Le.jsxs("div",{className:"relative",children:[Le.jsx("button",{onClick:()=>kt("layers"),className:`${xt} ${jt} ${yt==="layers"?"text-cyan-600 bg-cyan-50":""}`,title:"Change Basemap",children:Le.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Le.jsx(Rm.Layers,{})})}),yt==="layers"&&Le.jsxs("div",{className:"absolute left-10 top-0 bg-white rounded shadow-xl border border-gray-200 overflow-hidden w-48 animate-fade-in-right z-50",children:[Le.jsx("div",{className:"text-[10px] uppercase font-bold text-gray-400 px-3 py-2 bg-gray-50 border-b border-gray-100",children:"Basemap"}),[{id:"carto",label:"Carto Light"},{id:"hot",label:"Humanitarian OSM"},{id:"satellite",label:"Mapbox Satellite"}].map(dt=>Le.jsx("button",{onClick:()=>{oe(dt.id),k(null)},className:`block w-full text-left px-4 py-2 text-xs font-medium hover:bg-gray-50 border-b border-gray-50 last:border-0 ${Xe===dt.id?"text-cyan-600 bg-cyan-50":"text-gray-700"}`,children:dt.label},dt.id))]})]}),Le.jsx("button",{onClick:mt,className:`${xt} ${jt}`,title:"Zoom In",children:Le.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Le.jsx(Rm.Plus,{})})}),Le.jsx("button",{onClick:Ke,className:`${xt} ${jt} ${$t}`,title:"Zoom Out",children:Le.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Le.jsx(Rm.Minus,{})})})]})}function k_({center:fe,zoom:ot,bounds:Xe}){const oe=Ot.useRef(null),rt=Ot.useRef(null);return Ot.useEffect(()=>{rt.current||(rt.current=new vg.Map({container:oe.current,style:{version:8,sources:{osm:{type:"raster",tiles:["https://a.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png"],tileSize:256,attribution:""},box:{type:"geojson",data:{type:"FeatureCollection",features:[]}}},layers:[{id:"osm",type:"raster",source:"osm",minzoom:0,maxzoom:22},{id:"box-line",type:"line",source:"box",paint:{"line-color":"#EF4444","line-width":2}},{id:"box-fill",type:"fill",source:"box",paint:{"fill-color":"#EF4444","fill-opacity":.1}}]},center:fe||[0,20],zoom:0,interactive:!1,attributionControl:!1}))},[]),Ot.useEffect(()=>{if(rt.current&&(fe&&rt.current.setCenter(fe),Xe)){const[yt,k,d,ge]=Xe,Be={type:"Polygon",coordinates:[[[yt,ge],[d,ge],[d,k],[yt,k],[yt,ge]]]},ut=rt.current.getSource("box");ut&&ut.setData({type:"Feature",properties:{},geometry:Be})}},[fe,Xe]),Le.jsxs("div",{className:"relative group",children:[Le.jsx("div",{ref:oe,className:"w-32 h-32 border-2 border-white rounded shadow-lg bg-gray-100 pointer-events-none"}),Le.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none opacity-20",children:[Le.jsx("div",{className:"w-full h-[1px] bg-black"}),Le.jsx("div",{className:"h-full w-[1px] bg-black absolute"})]})]})}function O_(){const[fe,ot]=Ot.useState(!1),Xe=[{label:"Upload Imagery",href:"https://upload.openaerialmap.org/"},{label:"About OAM",href:"http://openaerialmap.org/about"},{label:"Documentation",href:"http://docs.openaerialmap.org"},{label:"System Status",href:"https://uptime.hotosm.org/"},{label:"Contact Support",href:"mailto:info@openaerialmap.org"}];return Le.jsxs("div",{className:"absolute top-4 right-4 z-50 font-sans",children:[Le.jsx("button",{onClick:()=>ot(!fe),className:"w-10 h-10 bg-white rounded shadow-md border border-gray-200 flex items-center justify-center text-gray-600 hover:text-cyan-600 hover:bg-gray-50 transition-all",children:fe?Le.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Le.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):Le.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:Le.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),fe&&Le.jsx("div",{className:"absolute top-12 right-0 w-48 bg-white rounded-lg shadow-xl border border-gray-100 overflow-hidden animate-fade-in origin-top-right",children:Le.jsx("div",{className:"py-1",children:Xe.map(oe=>Le.jsx("a",{href:oe.href,target:"_blank",rel:"noreferrer",className:"block px-4 py-2.5 text-sm text-gray-700 hover:bg-cyan-50 hover:text-cyan-700 transition-colors border-b border-gray-50 last:border-0",onClick:()=>ot(!1),children:oe.label},oe.label))})})]})}function F_(fe){return M_(fe,(ot,Xe)=>ot+N_(Xe),0)}function N_(fe){let ot=0,Xe;switch(fe.type){case"Polygon":return qg(fe.coordinates);case"MultiPolygon":for(Xe=0;Xe<fe.coordinates.length;Xe++)ot+=qg(fe.coordinates[Xe]);return ot;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function qg(fe){let ot=0;if(fe&&fe.length>0){ot+=Math.abs(Zg(fe[0]));for(let Xe=1;Xe<fe.length;Xe++)ot-=Math.abs(Zg(fe[Xe]))}return ot}var j_=Vg*Vg/2,yg=Math.PI/180;function Zg(fe){const ot=fe.length-1;if(ot<=2)return 0;let Xe=0,oe=0;for(;oe<ot;){const rt=fe[oe],yt=fe[oe+1===ot?0:oe+1],k=fe[oe+2>=ot?(oe+2)%ot:oe+2],d=rt[0]*yg,ge=yt[1]*yg,Be=k[0]*yg;Xe+=(Be-d)*Math.sin(ge),oe++}return Xe*j_}var V_=F_;const Hg=100,U_=25,G_=8;function q_(){const[fe,ot]=Ot.useState([]),[Xe,oe]=Ot.useState(null),[rt,yt]=Ot.useState(null),[k,d]=Ot.useState(null),[ge,Be]=Ot.useState([0,20]),[ut,mt]=Ot.useState(2),[Ke,kt]=Ot.useState(null),[Ht,xt]=Ot.useState(!1),me=Ot.useRef(!1),[$t,jt]=Ot.useState("none"),[dt,Dt]=Ot.useState(new Set),[Yt,It]=Ot.useState(new Set),[bt,li]=Ot.useState("carto"),[Vi,cn]=Ot.useState({dateStart:"",dateEnd:"",platform:"",license:""}),hn=Re=>{const tt=new URLSearchParams(window.location.search);Re?tt.set("selected_id",Re.properties.id):tt.delete("selected_id"),window.history.replaceState({},"",`${window.location.pathname}?${tt.toString()}`)},Mi=Re=>{oe(Re),hn(Re)},dn=Re=>{$t==="previews"?It(tt=>{const ie=new Set(tt);return ie.has(Re)?ie.delete(Re):ie.add(Re),ie}):Dt(tt=>{const ie=new Set(tt);return ie.has(Re)?ie.delete(Re):ie.add(Re),ie})},Kn=Re=>{if(!Re)return"Unknown";const tt=1073741824,ie=1048576;return Re>=tt?`${(Re/tt).toFixed(2)} GB`:`${Math.round(Re/ie)} MB`},Hi=async(Re=null,tt=Vi)=>{xt(!0);try{let ie=`https://api.openaerialmap.org/meta?limit=${Hg}&order_by=acquisition_end&sort=desc`;if(Re&&(ie+=`&bbox=${Re.join(",")}`),tt.dateStart&&(ie+=`&acquisition_from=${tt.dateStart}`),tt.dateEnd&&(ie+=`&acquisition_to=${tt.dateEnd}`),tt.platform){const ht=tt.platform==="other"?"aircraft":tt.platform;ie+=`&platform=${ht}`}const Ae=`https://api.allorigins.win/raw?url=${encodeURIComponent(ie)}`,Qe=await(await fetch(Ae)).json();if(Qe.results){let ht=Qe.results.map(ft=>{const Et=ft.platform||ft.properties?.platform||"unknown",ii=ft.geojson?V_(ft.geojson):0;return{type:"Feature",geometry:ft.geojson,properties:{id:ft._id,uuid:ft.uuid,title:ft.title||"Untitled Image",provider:ft.provider,thumbnail:ft.properties?.thumbnail||null,date:ft.acquisition_end||"Unknown Date",is_large:ii/1e6>=U_,platform:Et.toLowerCase(),sensor:ft.sensor||ft.properties?.sensor||"Unknown Sensor",gsd:ft.gsd?`${ft.gsd.toFixed(2)} m`:"N/A",file_size:Kn(ft.file_size),license:ft.license||ft.properties?.license||"Unknown License",tags:ft.tags?ft.tags.join(", "):"None"}}});if(tt.platform&&(ht=ht.filter(ft=>{const Et=ft.properties.platform;return tt.platform==="satellite"?Et==="satellite":tt.platform==="uav"?Et==="uav"||Et==="drone":tt.platform==="aircraft"?Et!=="satellite"&&Et!=="uav"&&Et!=="drone":!0})),tt.license){const ft=tt.license.replace(/[\s-]/g,"").toLowerCase();ht=ht.filter(Et=>(Et.properties.license||"").replace(/[\s-]/g,"").toLowerCase().includes(ft))}ot(ht)}else ot([])}catch(ie){console.error("Fetch error:",ie)}xt(!1)};Ot.useEffect(()=>{Hi()},[]),Ot.useEffect(()=>{if(fe.length>0&&!me.current){const tt=new URLSearchParams(window.location.search).get("selected_id");if(tt){const ie=fe.find(Ae=>Ae.properties.id===tt);ie&&oe(ie)}me.current=!0}},[fe]);const Ve=Re=>{cn(Re),Hi(rt,Re)},st=(Re,tt)=>{yt(Re),Hi(Re)},Lt=(Re,tt,ie,Ae)=>{yt(Re),Be(tt),kt(ie),mt(Ae),Ae>=G_?Hi(Re):Hi(null)};return Le.jsxs("div",{className:"flex w-full h-screen overflow-hidden bg-gray-100 font-sans",children:[Le.jsx("div",{className:"flex flex-col w-96 h-full bg-white border-r border-gray-200 shadow-xl z-20 relative",children:Le.jsx(A_,{features:fe,onSelect:Mi,selectedFeature:Xe,isLoading:Ht,limit:Hg,layerMode:$t,previewedIds:dt,hiddenIds:Yt,onTogglePreview:dn})}),Le.jsxs("div",{className:"flex-1 h-full relative",children:[Le.jsx("div",{className:"absolute top-4 left-4 z-30 w-full max-w-2xl",children:Le.jsx(L_,{filters:Vi,onChange:Ve})}),Le.jsx(O_,{}),Le.jsx("div",{className:"absolute bottom-8 right-4 z-30",children:Le.jsx(k_,{center:ge,bounds:Ke})}),Le.jsx(B_,{className:"absolute bottom-36 left-4 z-30",mapInstance:k,onLocationSelect:st,basemap:bt,setBasemap:li}),Le.jsx(Qg,{onMapInit:d,features:fe,selectedFeature:Xe,onSelect:Mi,searchBbox:rt,onSearchArea:Lt,layerMode:$t,setLayerMode:jt,previewedIds:dt,hiddenIds:Yt,basemap:bt})]})]})}b_.createRoot(document.getElementById("root")).render(Le.jsx(Ot.StrictMode,{children:Le.jsx(q_,{})}));
